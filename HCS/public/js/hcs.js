window.requestAnimationFrame = function() {
    return window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame || function(t) {
        window.setTimeout(t, 1e3 / 60)
    }
}(), window.cancelRequestAnimationFrame = function() {
    return window.cancelAnimationFrame || window.webkitCancelRequestAnimationFrame || window.mozCancelRequestAnimationFrame || window.oCancelRequestAnimationFrame || window.msCancelRequestAnimationFrame || clearTimeout
}(), String.prototype.startsWith = String.prototype.startsWith || function(t) {
    return t = String(t), String(this).substring(0, t.length) === t
}, String.prototype.endsWith = String.prototype.endsWith || function(t) {
    t = String(t);
    var e = String(this);
    return e.substring(e.length - t.length) === t
}, String.prototype.trimLeft = String.prototype.trimLeft || function() {
    return this.replace(/^\s+/, "")
}, String.prototype.trimRight = String.prototype.trimRight || function() {
    return this.replace(/\s+$/, "")
}, String.prototype.trim = String.prototype.trim || function() {
    return this.replace(/^\s+|\s+$/g, "")
}, Math.sign = function(t) {
    return 0 > t ? -1 : 1
};
var Logger = function() {
    var t = !1, e = function(e) {
        t && console.log(e)
    }, n = function(e) {
        t && console.warn(e)
    }, i = function(e) {
        t && console.error(e)
    }, o = function(e) {
        if (t) {
            var n = document.getElementById("debugArea");
            n.innerHTML = "<div>" + e + "</div>" + n.innerHTML
        }
    }, r = function() {
        if (t) {
            var e = document.getElementById("debugArea");
            e.innerHTML = ""
        }
    }, s = function(e) {
        t = e ? !0 : !1
    };
    return {message: e,warning: n,error: i,setDebugMode: s,out: o,clear: r}
}();
var HANDJS = HANDJS || {};
!function() {
    function t() {
        D = !0, clearTimeout(B), B = setTimeout(function() {
                                                D = !1
                                                }, 700)
    }
    function e(t) {
        var e = [];
        if (t)
            for (e.unshift(t); t.parentNode; )
                e.unshift(t.parentNode), t = t.parentNode;
        return e
    }
    function n(t, n) {
        for (var i = e(t), o = e(n), r = null; i.length > 0 && i[0] == o.shift(); )
            r = i.shift();
        return r
    }
    function i(t, e, i) {
        for (var o = n(t, e), r = t, s = []; r && r != o; )
            f(r, "pointerenter") && s.push(r), r = r.parentNode;
        for (; s.length > 0; )
            i(s.pop())
            }
    function o(t, e, i) {
        for (var o = n(t, e), r = t; r && r != o; )
            f(r, "pointerleave") && i(r), r = r.parentNode
            }
    function r(t, e) {
        ["pointerdown", "pointermove", "pointerup", "pointerover", "pointerout"].forEach(function(n) {
                                                                                         window.addEventListener(t(n), function(t) {
                                                                                                                 !D && y(t.target, n) && e(t, n, !0)
                                                                                                                 })
                                                                                         }), void 0 === window["on" + t("pointerenter").toLowerCase()] && window.addEventListener(t("pointerover"), function(t) {
                                                                                                                                                                                  if (!D) {
                                                                                                                                                                                  var n = y(t.target, "pointerenter");
                                                                                                                                                                                  n && n !== window && (n.contains(t.relatedTarget) || i(n, t.relatedTarget, function(n) {
                                                                                                                                                                                                                                         e(t, "pointerenter", !1, n, t.relatedTarget)
                                                                                                                                                                                                                                         }))
                                                                                                                                                                                  }
                                                                                                                                                                                  }), void 0 === window["on" + t("pointerleave").toLowerCase()] && window.addEventListener(t("pointerout"), function(t) {
                                                                                                                                                                                                                                                                           if (!D) {
                                                                                                                                                                                                                                                                           var n = y(t.target, "pointerleave");
                                                                                                                                                                                                                                                                           n && n !== window && (n.contains(t.relatedTarget) || o(n, t.relatedTarget, function(n) {
                                                                                                                                                                                                                                                                                                                                  e(t, "pointerleave", !1, n, t.relatedTarget)
                                                                                                                                                                                                                                                                                                                                  }))
                                                                                                                                                                                                                                                                           }
                                                                                                                                                                                                                                                                           })
    }
    if (!window.PointerEvent) {
        Array.prototype.indexOf || (Array.prototype.indexOf = function(t) {
                                    var e = Object(this), n = e.length >>> 0;
                                    if (0 === n)
                                    return -1;
                                    var i = 0;
                                    if (arguments.length > 0 && (i = Number(arguments[1]), i != i ? i = 0 : 0 != i && 1 / 0 != i && i != -1 / 0 && (i = (i > 0 || -1) * Math.floor(Math.abs(i)))), i >= n)
                                    return -1;
                                    for (var o = i >= 0 ? i : Math.max(n - Math.abs(i), 0); n > o; o++)
                                    if (o in e && e[o] === t)
                                    return o;
                                    return -1
                                    }), Array.prototype.forEach || (Array.prototype.forEach = function(t, e) {
                                                                    if (!(this && t instanceof Function))
                                                                    throw new TypeError;
                                                                    for (var n = 0; n < this.length; n++)
                                                                    t.call(e, this[n], n, this)
                                                                    }), String.prototype.trim || (String.prototype.trim = function() {
                                                                                                  return this.replace(/^\s+|\s+$/, "")
                                                                                                  });
        var s = ["pointerdown", "pointerup", "pointermove", "pointerover", "pointerout", "pointercancel", "pointerenter", "pointerleave"], a = ["PointerDown", "PointerUp", "PointerMove", "PointerOver", "PointerOut", "PointerCancel", "PointerEnter", "PointerLeave"], l = "touch", h = "pen", c = "mouse", u = {}, p = function(t) {
            for (; t && !t.handjs_forcePreventDefault; )
                t = t.parentNode;
            return !!t || window.handjs_forcePreventDefault
        }, d = function(t, e, n, i, o) {
            var r;
            if (document.createEvent ? (r = document.createEvent("MouseEvents"), r.initMouseEvent(e, n, !0, window, 1, t.screenX, t.screenY, t.clientX, t.clientY, t.ctrlKey, t.altKey, t.shiftKey, t.metaKey, t.button, o || t.relatedTarget)) : (r = document.createEventObject(), r.screenX = t.screenX, r.screenY = t.screenY, r.clientX = t.clientX, r.clientY = t.clientY, r.ctrlKey = t.ctrlKey, r.altKey = t.altKey, r.shiftKey = t.shiftKey, r.metaKey = t.metaKey, r.button = t.button, r.relatedTarget = o || t.relatedTarget), void 0 === r.offsetX && (void 0 !== t.offsetX ? (Object && void 0 !== Object.defineProperty && (Object.defineProperty(r, "offsetX", {writable: !0}), Object.defineProperty(r, "offsetY", {writable: !0})), r.offsetX = t.offsetX, r.offsetY = t.offsetY) : Object && void 0 !== Object.defineProperty ? (Object.defineProperty(r, "offsetX", {get: function() {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          return this.currentTarget && this.currentTarget.offsetLeft ? t.clientX - this.currentTarget.offsetLeft : t.clientX
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          }}), Object.defineProperty(r, "offsetY", {get: function() {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     return this.currentTarget && this.currentTarget.offsetTop ? t.clientY - this.currentTarget.offsetTop : t.clientY
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     }})) : void 0 !== t.layerX && (r.offsetX = t.layerX - t.currentTarget.offsetLeft, r.offsetY = t.layerY - t.currentTarget.offsetTop)), r.isPrimary = void 0 !== t.isPrimary ? t.isPrimary : !0, t.pressure)
                r.pressure = t.pressure;
            else {
                var s = 0;
                void 0 !== t.which ? s = t.which : void 0 !== t.button && (s = t.button), r.pressure = 0 == s ? 0 : .5
            }
            if (r.rotation = t.rotation ? t.rotation : 0, r.hwTimestamp = t.hwTimestamp ? t.hwTimestamp : 0, r.tiltX = t.tiltX ? t.tiltX : 0, r.tiltY = t.tiltY ? t.tiltY : 0, r.height = t.height ? t.height : 0, r.width = t.width ? t.width : 0, r.preventDefault = function() {
                void 0 !== t.preventDefault && t.preventDefault()
                }, void 0 !== r.stopPropagation) {
                var a = r.stopPropagation;
                r.stopPropagation = function() {
                    void 0 !== t.stopPropagation && t.stopPropagation(), a.call(this)
                }
            }
            switch (r.pointerId = t.pointerId, r.pointerType = t.pointerType, r.pointerType) {
                case 2:
                    r.pointerType = l;
                    break;
                case 3:
                    r.pointerType = h;
                    break;
                case 4:
                    r.pointerType = c
            }
            i ? i.dispatchEvent(r) : t.target ? t.target.dispatchEvent(r) : t.srcElement.fireEvent("on" + v(e), r)
        }, m = function(t, e, n, i, o) {
            t.pointerId = 1, t.pointerType = c, d(t, e, n, i, o)
        }, g = function(t, e, n, i, o, r) {
            var s = e.identifier + 2;
            e.pointerId = s, e.pointerType = l, e.currentTarget = n, void 0 !== i.preventDefault && (e.preventDefault = function() {
                                                                                                     i.preventDefault()
                                                                                                     }), d(e, t, o, n, r)
        }, f = function(t, e) {
            return t.__handjsGlobalRegisteredEvents && t.__handjsGlobalRegisteredEvents[e]
        }, y = function(t, e) {
            for (; t && !f(t, e); )
                t = t.parentNode;
            return t ? t : f(window, e) ? window : void 0
        }, _ = function(t, e, n, i, o, r) {
            y(n, t) && g(t, e, n, i, o, r)
        }, v = function(t) {
            return t.toLowerCase().replace("pointer", "mouse")
        }, b = function(t, e) {
            var n = s.indexOf(e), i = t + a[n];
            return i
        }, w = function(t, e, n, i) {
            if (void 0 === t.__handjsRegisteredEvents && (t.__handjsRegisteredEvents = []), i) {
                if (void 0 !== t.__handjsRegisteredEvents[e])
                    return void t.__handjsRegisteredEvents[e]++;
                t.__handjsRegisteredEvents[e] = 1, t.addEventListener(e, n, !1)
            } else {
                if (-1 !== t.__handjsRegisteredEvents.indexOf(e) && (t.__handjsRegisteredEvents[e]--, 0 != t.__handjsRegisteredEvents[e]))
                    return;
                t.removeEventListener(e, n), t.__handjsRegisteredEvents[e] = 0
            }
        }, x = function(t, e, n) {
            if (t.__handjsGlobalRegisteredEvents || (t.__handjsGlobalRegisteredEvents = []), n) {
                if (void 0 !== t.__handjsGlobalRegisteredEvents[e])
                    return void t.__handjsGlobalRegisteredEvents[e]++;
                t.__handjsGlobalRegisteredEvents[e] = 1
            } else
                void 0 !== t.__handjsGlobalRegisteredEvents[e] && (t.__handjsGlobalRegisteredEvents[e]--, t.__handjsGlobalRegisteredEvents[e] < 0 && (t.__handjsGlobalRegisteredEvents[e] = 0));
            var i, o;
            switch (window.MSPointerEvent ? (i = function(t) {
                                             return b("MS", t)
                                             }, o = d) : (i = v, o = m), e) {
                case "pointerenter":
                case "pointerleave":
                    var r = i(e);
                    void 0 !== t["on" + r.toLowerCase()] && w(t, r, function(t) {
                                                              o(t, e)
                                                              }, n)
            }
        }, C = function(t) {
            var e = t.prototype ? t.prototype.addEventListener : t.addEventListener, n = function(t, n, i) {
                -1 != s.indexOf(t) && x(this, t, !0), void 0 === e ? this.attachEvent("on" + v(t), n) : e.call(this, t, n, i)
            };
            t.prototype ? t.prototype.addEventListener = n : t.addEventListener = n
        }, M = function(t) {
            var e = t.prototype ? t.prototype.removeEventListener : t.removeEventListener, n = function(t, n, i) {
                -1 != s.indexOf(t) && x(this, t, !1), void 0 === e ? this.detachEvent(v(t), n) : e.call(this, t, n, i)
            };
            t.prototype ? t.prototype.removeEventListener = n : t.removeEventListener = n
        };
        C(window), C(window.HTMLElement || window.Element), C(document), C(HTMLBodyElement), C(HTMLDivElement), C(HTMLImageElement), C(HTMLUListElement), C(HTMLAnchorElement), C(HTMLLIElement), C(HTMLTableElement), window.HTMLSpanElement && C(HTMLSpanElement), window.HTMLCanvasElement && C(HTMLCanvasElement), window.SVGElement && C(SVGElement), M(window), M(window.HTMLElement || window.Element), M(document), M(HTMLBodyElement), M(HTMLDivElement), M(HTMLImageElement), M(HTMLUListElement), M(HTMLAnchorElement), M(HTMLLIElement), M(HTMLTableElement), window.HTMLSpanElement && M(HTMLSpanElement), window.HTMLCanvasElement && M(HTMLCanvasElement), window.SVGElement && M(SVGElement);
        var D = !1, B = -1;
        !function() {
            window.MSPointerEvent ? r(function(t) {
                                      return b("MS", t)
                                      }, d) : (r(v, m), void 0 !== window.ontouchstart && (window.addEventListener("touchstart", function(e) {
                                                                                                                   for (var n = 0; n < e.changedTouches.length; ++n) {
                                                                                                                   var o = e.changedTouches[n];
                                                                                                                   u[o.identifier] = o.target, _("pointerover", o, o.target, e, !0), i(o.target, null, function(t) {
                                                                                                                                                                                       g("pointerenter", o, t, e, !1)
                                                                                                                                                                                       }), _("pointerdown", o, o.target, e, !0)
                                                                                                                   }
                                                                                                                   t()
                                                                                                                   }), window.addEventListener("touchend", function(e) {
                                                                                                                                               for (var n = 0; n < e.changedTouches.length; ++n) {
                                                                                                                                               var i = e.changedTouches[n], r = u[i.identifier];
                                                                                                                                               _("pointerup", i, r, e, !0), _("pointerout", i, r, e, !0), o(r, null, function(t) {
                                                                                                                                                                                                            g("pointerleave", i, t, e, !1)
                                                                                                                                                                                                            })
                                                                                                                                               }
                                                                                                                                               t()
                                                                                                                                               }), window.addEventListener("touchmove", function(e) {
                                                                                                                                                                           for (var n = 0; n < e.changedTouches.length; ++n) {
                                                                                                                                                                           var r = e.changedTouches[n], s = document.elementFromPoint(r.clientX, r.clientY), a = u[r.identifier];
                                                                                                                                                                           a && p(a) === !0 && e.preventDefault(), _("pointermove", r, a, e, !0), a !== s && (a && (_("pointerout", r, a, e, !0, s), a.contains(s) || o(a, s, function(t) {
                                                                                                                                                                                                                                                                                                                        g("pointerleave", r, t, e, !1, s)
                                                                                                                                                                                                                                                                                                                        })), s && (_("pointerover", r, s, e, !0, a), s.contains(a) || i(s, a, function(t) {
                                                                                                                                                                                                                                                                                                                                                                                        g("pointerenter", r, t, e, !1, a)
                                                                                                                                                                                                                                                                                                                                                                                        })), u[r.identifier] = s)
                                                                                                                                                                           }
                                                                                                                                                                           t()
                                                                                                                                                                           }), window.addEventListener("touchcancel", function(t) {
                                                                                                                                                                                                       for (var e = 0; e < t.changedTouches.length; ++e) {
                                                                                                                                                                                                       var n = t.changedTouches[e];
                                                                                                                                                                                                       _("pointercancel", n, u[n.identifier], t, !0)
                                                                                                                                                                                                       }
                                                                                                                                                                                                       })))
        }(), void 0 === navigator.pointerEnabled && (navigator.pointerEnabled = !0, navigator.msPointerEnabled && (navigator.maxTouchPoints = navigator.msMaxTouchPoints)), document.styleSheets && document.addEventListener && document.addEventListener("DOMContentLoaded", function() {
                                                                                                                                                                                                                                                           if (!HANDJS.doNotProcessCSS && void 0 === document.body.style.touchAction) {
                                                                                                                                                                                                                                                           var t = new RegExp(".+?{.*?}", "m"), e = new RegExp(".+?{", "m"), n = function(n) {
                                                                                                                                                                                                                                                           var i = t.exec(n);
                                                                                                                                                                                                                                                           if (i) {
                                                                                                                                                                                                                                                           var o = i[0];
                                                                                                                                                                                                                                                           n = n.replace(o, "").trim();
                                                                                                                                                                                                                                                           var r = e.exec(o)[0].replace("{", "").trim();
                                                                                                                                                                                                                                                           if (-1 != o.replace(/\s/g, "").indexOf("touch-action:none"))
                                                                                                                                                                                                                                                           for (var s = document.querySelectorAll(r), a = 0; a < s.length; a++) {
                                                                                                                                                                                                                                                           var l = s[a];
                                                                                                                                                                                                                                                           void 0 !== l.style.msTouchAction ? l.style.msTouchAction = "none" : l.handjs_forcePreventDefault = !0
                                                                                                                                                                                                                                                           }
                                                                                                                                                                                                                                                           return n
                                                                                                                                                                                                                                                           }
                                                                                                                                                                                                                                                           }, i = function(t) {
                                                                                                                                                                                                                                                           if (window.setImmediate)
                                                                                                                                                                                                                                                           t && setImmediate(i, n(t));
                                                                                                                                                                                                                                                           else
                                                                                                                                                                                                                                                           for (; t; )
                                                                                                                                                                                                                                                           t = n(t)
                                                                                                                                                                                                                                                           };
                                                                                                                                                                                                                                                           try {
                                                                                                                                                                                                                                                           for (var o = 0; o < document.styleSheets.length; o++) {
                                                                                                                                                                                                                                                           var r = document.styleSheets[o];
                                                                                                                                                                                                                                                           if (void 0 != r.href) {
                                                                                                                                                                                                                                                           var s = new XMLHttpRequest;
                                                                                                                                                                                                                                                           s.open("get", r.href), s.send();
                                                                                                                                                                                                                                                           var a = s.responseText.replace(/(\n|\r)/g, "");
                                                                                                                                                                                                                                                           i(a)
                                                                                                                                                                                                                                                           }
                                                                                                                                                                                                                                                           }
                                                                                                                                                                                                                                                           } catch (l) {
                                                                                                                                                                                                                                                           }
                                                                                                                                                                                                                                                           for (var h = document.getElementsByTagName("style"), o = 0; o < h.length; o++) {
                                                                                                                                                                                                                                                           var c = h[o], u = c.innerHTML.replace(/(\n|\r)/g, "").trim();
                                                                                                                                                                                                                                                           i(u)
                                                                                                                                                                                                                                                           }
                                                                                                                                                                                                                                                           }
                                                                                                                                                                                                                                                           }, !1)
    }
}();

var BABYLON;
!function(t) {
    var e = function() {
        function t(t, e, n) {
            "undefined" == typeof t && (t = 0), "undefined" == typeof e && (e = 0), "undefined" == typeof n && (n = 0), this.r = t, this.g = e, this.b = n
        }
        return t.prototype.toString = function() {
            return "{R: " + this.r + " G:" + this.g + " B:" + this.b + "}"
        }, t.prototype.toArray = function(t, e) {
            void 0 === e && (e = 0), t[e] = this.r, t[e + 1] = this.g, t[e + 2] = this.b
        }, t.prototype.asArray = function() {
            var t = [];
            return this.toArray(t, 0), t
        }, t.prototype.multiply = function(e) {
            return new t(this.r * e.r, this.g * e.g, this.b * e.b)
        }, t.prototype.multiplyToRef = function(t, e) {
            e.r = this.r * t.r, e.g = this.g * t.g, e.b = this.b * t.b
        }, t.prototype.equals = function(t) {
            return t && this.r === t.r && this.g === t.g && this.b === t.b
        }, t.prototype.scale = function(e) {
            return new t(this.r * e, this.g * e, this.b * e)
        }, t.prototype.scaleToRef = function(t, e) {
            e.r = this.r * t, e.g = this.g * t, e.b = this.b * t
        }, t.prototype.add = function(e) {
            return new t(this.r + e.r, this.g + e.g, this.b + e.b)
        }, t.prototype.addToRef = function(t, e) {
            e.r = this.r + t.r, e.g = this.g + t.g, e.b = this.b + t.b
        }, t.prototype.subtract = function(e) {
            return new t(this.r - e.r, this.g - e.g, this.b - e.b)
        }, t.prototype.subtractToRef = function(t, e) {
            e.r = this.r - t.r, e.g = this.g - t.g, e.b = this.b - t.b
        }, t.prototype.clone = function() {
            return new t(this.r, this.g, this.b)
        }, t.prototype.copyFrom = function(t) {
            this.r = t.r, this.g = t.g, this.b = t.b
        }, t.prototype.copyFromFloats = function(t, e, n) {
            this.r = t, this.g = e, this.b = n
        }, t.FromArray = function(e) {
            return new t(e[0], e[1], e[2])
        }, t.FromInts = function(e, n, i) {
            return new t(e / 255, n / 255, i / 255)
        }, t.Lerp = function(e, n, i) {
            var o = e.r + (n.r - e.r) * i, r = e.g + (n.g - e.g) * i, s = e.b + (n.b - e.b) * i;
            return new t(o, r, s)
        }, t.Red = function() {
            return new t(1, 0, 0)
        }, t.Green = function() {
            return new t(0, 1, 0)
        }, t.Blue = function() {
            return new t(0, 0, 1)
        }, t.Black = function() {
            return new t(0, 0, 0)
        }, t.White = function() {
            return new t(1, 1, 1)
        }, t.Purple = function() {
            return new t(.5, 0, .5)
        }, t.Magenta = function() {
            return new t(1, 0, 1)
        }, t.Yellow = function() {
            return new t(1, 1, 0)
        }, t.Gray = function() {
            return new t(.5, .5, .5)
        }, t
    }();
    t.Color3 = e;
    var n = function() {
        function e(t, e, n, i) {
            this.r = t, this.g = e, this.b = n, this.a = i
        }
        return e.prototype.addInPlace = function(t) {
            this.r += t.r, this.g += t.g, this.b += t.b, this.a += t.a
        }, e.prototype.asArray = function() {
            var t = [];
            return this.toArray(t, 0), t
        }, e.prototype.toArray = function(t, e) {
            void 0 === e && (e = 0), t[e] = this.r, t[e + 1] = this.g, t[e + 2] = this.b, t[e + 3] = this.a
        }, e.prototype.add = function(t) {
            return new e(this.r + t.r, this.g + t.g, this.b + t.b, this.a + t.a)
        }, e.prototype.subtract = function(t) {
            return new e(this.r - t.r, this.g - t.g, this.b - t.b, this.a - t.a)
        }, e.prototype.subtractToRef = function(t, e) {
            e.r = this.r - t.r, e.g = this.g - t.g, e.b = this.b - t.b, e.a = this.a - t.a
        }, e.prototype.scale = function(t) {
            return new e(this.r * t, this.g * t, this.b * t, this.a * t)
        }, e.prototype.scaleToRef = function(t, e) {
            e.r = this.r * t, e.g = this.g * t, e.b = this.b * t, e.a = this.a * t
        }, e.prototype.toString = function() {
            return "{R: " + this.r + " G:" + this.g + " B:" + this.b + " A:" + this.a + "}"
        }, e.prototype.clone = function() {
            return new e(this.r, this.g, this.b, this.a)
        }, e.Lerp = function(n, i, o) {
            var r = new e(0, 0, 0, 0);
            return t.Color4.LerpToRef(n, i, o, r), r
        }, e.LerpToRef = function(t, e, n, i) {
            i.r = t.r + (e.r - t.r) * n, i.g = t.g + (e.g - t.g) * n, i.b = t.b + (e.b - t.b) * n, i.a = t.a + (e.a - t.a) * n
        }, e.FromArray = function(t, n) {
            return "undefined" == typeof n && (n = 0), new e(t[n], t[n + 1], t[n + 2], t[n + 3])
        }, e.FromInts = function(t, n, i, o) {
            return new e(t / 255, n / 255, i / 255, o / 255)
        }, e
    }();
    t.Color4 = n;
    var i = function() {
        function t(t, e) {
            this.x = t, this.y = e
        }
        return t.prototype.toString = function() {
            return "{X: " + this.x + " Y:" + this.y + "}"
        }, t.prototype.toArray = function(t, e) {
            void 0 === e && (e = 0), t[e] = this.x, t[e + 1] = this.y
        }, t.prototype.asArray = function() {
            var t = [];
            return this.toArray(t, 0), t
        }, t.prototype.copyFrom = function(t) {
            this.x = t.x, this.y = t.y
        }, t.prototype.add = function(e) {
            return new t(this.x + e.x, this.y + e.y)
        }, t.prototype.subtract = function(e) {
            return new t(this.x - e.x, this.y - e.y)
        }, t.prototype.negate = function() {
            return new t(-this.x, -this.y)
        }, t.prototype.scaleInPlace = function(t) {
            return this.x *= t, this.y *= t, this
        }, t.prototype.scale = function(e) {
            return new t(this.x * e, this.y * e)
        }, t.prototype.equals = function(t) {
            return t && this.x === t.x && this.y === t.y
        }, t.prototype.length = function() {
            return Math.sqrt(this.x * this.x + this.y * this.y)
        }, t.prototype.lengthSquared = function() {
            return this.x * this.x + this.y * this.y
        }, t.prototype.normalize = function() {
            var t = this.length();
            if (0 === t)
                return this;
            var e = 1 / t;
            return this.x *= e, this.y *= e, this
        }, t.prototype.clone = function() {
            return new t(this.x, this.y)
        }, t.Zero = function() {
            return new t(0, 0)
        }, t.FromArray = function(e, n) {
            return n || (n = 0), new t(e[n], e[n + 1])
        }, t.CatmullRom = function(e, n, i, o, r) {
            var s = r * r, a = r * s, l = .5 * (2 * n.x + (-e.x + i.x) * r + (2 * e.x - 5 * n.x + 4 * i.x - o.x) * s + (-e.x + 3 * n.x - 3 * i.x + o.x) * a), h = .5 * (2 * n.y + (-e.y + i.y) * r + (2 * e.y - 5 * n.y + 4 * i.y - o.y) * s + (-e.y + 3 * n.y - 3 * i.y + o.y) * a);
            return new t(l, h)
        }, t.Clamp = function(e, n, i) {
            var o = e.x;
            o = o > i.x ? i.x : o, o = o < n.x ? n.x : o;
            var r = e.y;
            return r = r > i.y ? i.y : r, r = r < n.y ? n.y : r, new t(o, r)
        }, t.Hermite = function(e, n, i, o, r) {
            var s = r * r, a = r * s, l = 2 * a - 3 * s + 1, h = -2 * a + 3 * s, c = a - 2 * s + r, u = a - s, p = e.x * l + i.x * h + n.x * c + o.x * u, d = e.y * l + i.y * h + n.y * c + o.y * u;
            return new t(p, d)
        }, t.Lerp = function(e, n, i) {
            var o = e.x + (n.x - e.x) * i, r = e.y + (n.y - e.y) * i;
            return new t(o, r)
        }, t.Dot = function(t, e) {
            return t.x * e.x + t.y * e.y
        }, t.Normalize = function(t) {
            var e = t.clone();
            return e.normalize(), e
        }, t.Minimize = function(e, n) {
            var i = e.x < n.x ? e.x : n.x, o = e.y < n.y ? e.y : n.y;
            return new t(i, o)
        }, t.Maximize = function(e, n) {
            var i = e.x > n.x ? e.x : n.x, o = e.y > n.y ? e.y : n.y;
            return new t(i, o)
        }, t.Transform = function(e, n) {
            var i = e.x * n.m[0] + e.y * n.m[4], o = e.x * n.m[1] + e.y * n.m[5];
            return new t(i, o)
        }, t.Distance = function(e, n) {
            return Math.sqrt(t.DistanceSquared(e, n))
        }, t.DistanceSquared = function(t, e) {
            var n = t.x - e.x, i = t.y - e.y;
            return n * n + i * i
        }, t
    }();
    t.Vector2 = i;
    var o = function() {
        function e(t, e, n) {
            this.x = t, this.y = e, this.z = n
        }
        return e.prototype.toString = function() {
            return "{X: " + this.x + " Y:" + this.y + " Z:" + this.z + "}"
        }, e.prototype.asArray = function() {
            var t = [];
            return this.toArray(t, 0), t
        }, e.prototype.toArray = function(t, e) {
            void 0 === e && (e = 0), t[e] = this.x, t[e + 1] = this.y, t[e + 2] = this.z
        }, e.prototype.addInPlace = function(t) {
            this.x += t.x, this.y += t.y, this.z += t.z
        }, e.prototype.add = function(t) {
            return new e(this.x + t.x, this.y + t.y, this.z + t.z)
        }, e.prototype.addToRef = function(t, e) {
            e.x = this.x + t.x, e.y = this.y + t.y, e.z = this.z + t.z
        }, e.prototype.subtractInPlace = function(t) {
            this.x -= t.x, this.y -= t.y, this.z -= t.z
        }, e.prototype.subtract = function(t) {
            return new e(this.x - t.x, this.y - t.y, this.z - t.z)
        }, e.prototype.subtractToRef = function(t, e) {
            e.x = this.x - t.x, e.y = this.y - t.y, e.z = this.z - t.z
        }, e.prototype.subtractFromFloats = function(t, n, i) {
            return new e(this.x - t, this.y - n, this.z - i)
        }, e.prototype.subtractFromFloatsToRef = function(t, e, n, i) {
            i.x = this.x - t, i.y = this.y - e, i.z = this.z - n
        }, e.prototype.negate = function() {
            return new e(-this.x, -this.y, -this.z)
        }, e.prototype.scaleInPlace = function(t) {
            return this.x *= t, this.y *= t, this.z *= t, this
        }, e.prototype.scale = function(t) {
            return new e(this.x * t, this.y * t, this.z * t)
        }, e.prototype.scaleToRef = function(t, e) {
            e.x = this.x * t, e.y = this.y * t, e.z = this.z * t
        }, e.prototype.equals = function(t) {
            return t && this.x === t.x && this.y === t.y && this.z === t.z
        }, e.prototype.equalsToFloats = function(t, e, n) {
            return this.x === t && this.y === e && this.z === n
        }, e.prototype.multiplyInPlace = function(t) {
            this.x *= t.x, this.y *= t.y, this.z *= t.z
        }, e.prototype.multiply = function(t) {
            return new e(this.x * t.x, this.y * t.y, this.z * t.z)
        }, e.prototype.multiplyToRef = function(t, e) {
            e.x = this.x * t.x, e.y = this.y * t.y, e.z = this.z * t.z
        }, e.prototype.multiplyByFloats = function(t, n, i) {
            return new e(this.x * t, this.y * n, this.z * i)
        }, e.prototype.divide = function(t) {
            return new e(this.x / t.x, this.y / t.y, this.z / t.z)
        }, e.prototype.divideToRef = function(t, e) {
            e.x = this.x / t.x, e.y = this.y / t.y, e.z = this.z / t.z
        }, e.prototype.MinimizeInPlace = function(t) {
            t.x < this.x && (this.x = t.x), t.y < this.y && (this.y = t.y), t.z < this.z && (this.z = t.z)
        }, e.prototype.MaximizeInPlace = function(t) {
            t.x > this.x && (this.x = t.x), t.y > this.y && (this.y = t.y), t.z > this.z && (this.z = t.z)
        }, e.prototype.length = function() {
            return Math.sqrt(this.x * this.x + this.y * this.y + this.z * this.z)
        }, e.prototype.lengthSquared = function() {
            return this.x * this.x + this.y * this.y + this.z * this.z
        }, e.prototype.normalize = function() {
            var t = this.length();
            if (0 === t)
                return this;
            var e = 1 / t;
            return this.x *= e, this.y *= e, this.z *= e, this
        }, e.prototype.clone = function() {
            return new e(this.x, this.y, this.z)
        }, e.prototype.copyFrom = function(t) {
            return this.x = t.x, this.y = t.y, this.z = t.z, this
        }, e.prototype.copyFromFloats = function(t, e, n) {
            return this.x = t, this.y = e, this.z = n, this
        }, e.FromArray = function(t, n) {
            return n || (n = 0), new e(t[n], t[n + 1], t[n + 2])
        }, e.FromArrayToRef = function(t, e, n) {
            n.x = t[e], n.y = t[e + 1], n.z = t[e + 2]
        }, e.FromFloatArrayToRef = function(t, e, n) {
            n.x = t[e], n.y = t[e + 1], n.z = t[e + 2]
        }, e.FromFloatsToRef = function(t, e, n, i) {
            i.x = t, i.y = e, i.z = n
        }, e.Zero = function() {
            return new e(0, 0, 0)
        }, e.Up = function() {
            return new e(0, 1, 0)
        }, e.TransformCoordinates = function(t, n) {
            var i = e.Zero();
            return e.TransformCoordinatesToRef(t, n, i), i
        }, e.TransformCoordinatesToRef = function(t, e, n) {
            var i = t.x * e.m[0] + t.y * e.m[4] + t.z * e.m[8] + e.m[12], o = t.x * e.m[1] + t.y * e.m[5] + t.z * e.m[9] + e.m[13], r = t.x * e.m[2] + t.y * e.m[6] + t.z * e.m[10] + e.m[14], s = t.x * e.m[3] + t.y * e.m[7] + t.z * e.m[11] + e.m[15];
            n.x = i / s, n.y = o / s, n.z = r / s
        }, e.TransformCoordinatesFromFloatsToRef = function(t, e, n, i, o) {
            var r = t * i.m[0] + e * i.m[4] + n * i.m[8] + i.m[12], s = t * i.m[1] + e * i.m[5] + n * i.m[9] + i.m[13], a = t * i.m[2] + e * i.m[6] + n * i.m[10] + i.m[14], l = t * i.m[3] + e * i.m[7] + n * i.m[11] + i.m[15];
            o.x = r / l, o.y = s / l, o.z = a / l
        }, e.TransformNormal = function(t, n) {
            var i = e.Zero();
            return e.TransformNormalToRef(t, n, i), i
        }, e.TransformNormalToRef = function(t, e, n) {
            n.x = t.x * e.m[0] + t.y * e.m[4] + t.z * e.m[8], n.y = t.x * e.m[1] + t.y * e.m[5] + t.z * e.m[9], n.z = t.x * e.m[2] + t.y * e.m[6] + t.z * e.m[10]
        }, e.TransformNormalFromFloatsToRef = function(t, e, n, i, o) {
            o.x = t * i.m[0] + e * i.m[4] + n * i.m[8], o.y = t * i.m[1] + e * i.m[5] + n * i.m[9], o.z = t * i.m[2] + e * i.m[6] + n * i.m[10]
        }, e.CatmullRom = function(t, n, i, o, r) {
            var s = r * r, a = r * s, l = .5 * (2 * n.x + (-t.x + i.x) * r + (2 * t.x - 5 * n.x + 4 * i.x - o.x) * s + (-t.x + 3 * n.x - 3 * i.x + o.x) * a), h = .5 * (2 * n.y + (-t.y + i.y) * r + (2 * t.y - 5 * n.y + 4 * i.y - o.y) * s + (-t.y + 3 * n.y - 3 * i.y + o.y) * a), c = .5 * (2 * n.z + (-t.z + i.z) * r + (2 * t.z - 5 * n.z + 4 * i.z - o.z) * s + (-t.z + 3 * n.z - 3 * i.z + o.z) * a);
            return new e(l, h, c)
        }, e.Clamp = function(t, n, i) {
            var o = t.x;
            o = o > i.x ? i.x : o, o = o < n.x ? n.x : o;
            var r = t.y;
            r = r > i.y ? i.y : r, r = r < n.y ? n.y : r;
            var s = t.z;
            return s = s > i.z ? i.z : s, s = s < n.z ? n.z : s, new e(o, r, s)
        }, e.Hermite = function(t, n, i, o, r) {
            var s = r * r, a = r * s, l = 2 * a - 3 * s + 1, h = -2 * a + 3 * s, c = a - 2 * s + r, u = a - s, p = t.x * l + i.x * h + n.x * c + o.x * u, d = t.y * l + i.y * h + n.y * c + o.y * u, m = t.z * l + i.z * h + n.z * c + o.z * u;
            return new e(p, d, m)
        }, e.Lerp = function(t, n, i) {
            var o = t.x + (n.x - t.x) * i, r = t.y + (n.y - t.y) * i, s = t.z + (n.z - t.z) * i;
            return new e(o, r, s)
        }, e.Dot = function(t, e) {
            return t.x * e.x + t.y * e.y + t.z * e.z
        }, e.Cross = function(t, n) {
            var i = e.Zero();
            return e.CrossToRef(t, n, i), i
        }, e.CrossToRef = function(t, e, n) {
            n.x = t.y * e.z - t.z * e.y, n.y = t.z * e.x - t.x * e.z, n.z = t.x * e.y - t.y * e.x
        }, e.Normalize = function(t) {
            var n = e.Zero();
            return e.NormalizeToRef(t, n), n
        }, e.NormalizeToRef = function(t, e) {
            e.copyFrom(t), e.normalize()
        }, e.Project = function(n, i, o, r) {
            var s = r.width, a = r.height, l = r.x, h = r.y, c = t.Matrix.FromValues(s / 2, 0, 0, 0, 0, -a / 2, 0, 0, 0, 0, 1, 0, l + s / 2, a / 2 + h, 0, 1), u = i.multiply(o).multiply(c);
            return e.TransformCoordinates(n, u)
        }, e.Unproject = function(e, n, i, o, r, s) {
            var a = o.multiply(r).multiply(s);
            a.invert(), e.x = e.x / n * 2 - 1, e.y = -(e.y / i * 2 - 1);
            var l = t.Vector3.TransformCoordinates(e, a), h = e.x * a.m[3] + e.y * a.m[7] + e.z * a.m[11] + a.m[15];
            return t.Tools.WithinEpsilon(h, 1) && (l = l.scale(1 / h)), l
        }, e.Minimize = function(t, e) {
            var n = t.clone();
            return n.MinimizeInPlace(e), n
        }, e.Maximize = function(t, e) {
            var n = t.clone();
            return n.MaximizeInPlace(e), n
        }, e.Distance = function(t, n) {
            return Math.sqrt(e.DistanceSquared(t, n))
        }, e.DistanceSquared = function(t, e) {
            var n = t.x - e.x, i = t.y - e.y, o = t.z - e.z;
            return n * n + i * i + o * o
        }, e.Center = function(t, e) {
            var n = t.add(e);
            return n.scaleInPlace(.5), n
        }, e
    }();
    t.Vector3 = o;
    var r = function() {
        function t(t, e, n, i) {
            "undefined" == typeof t && (t = 0), "undefined" == typeof e && (e = 0), "undefined" == typeof n && (n = 0), "undefined" == typeof i && (i = 0), this.x = t, this.y = e, this.z = n, this.w = i
        }
        return t.prototype.toString = function() {
            return "{X: " + this.x + " Y:" + this.y + " Z:" + this.z + " W:" + this.w + "}"
        }, t.prototype.asArray = function() {
            return [this.x, this.y, this.z, this.w]
        }, t.prototype.equals = function(t) {
            return t && this.x === t.x && this.y === t.y && this.z === t.z && this.w === t.w
        }, t.prototype.clone = function() {
            return new t(this.x, this.y, this.z, this.w)
        }, t.prototype.copyFrom = function(t) {
            this.x = t.x, this.y = t.y, this.z = t.z, this.w = t.w
        }, t.prototype.add = function(e) {
            return new t(this.x + e.x, this.y + e.y, this.z + e.z, this.w + e.w)
        }, t.prototype.subtract = function(e) {
            return new t(this.x - e.x, this.y - e.y, this.z - e.z, this.w - e.w)
        }, t.prototype.scale = function(e) {
            return new t(this.x * e, this.y * e, this.z * e, this.w * e)
        }, t.prototype.multiply = function(e) {
            var n = new t(0, 0, 0, 1);
            return this.multiplyToRef(e, n), n
        }, t.prototype.multiplyToRef = function(t, e) {
            e.x = this.x * t.w + this.y * t.z - this.z * t.y + this.w * t.x, e.y = -this.x * t.z + this.y * t.w + this.z * t.x + this.w * t.y, e.z = this.x * t.y - this.y * t.x + this.z * t.w + this.w * t.z, e.w = -this.x * t.x - this.y * t.y - this.z * t.z + this.w * t.w
        }, t.prototype.length = function() {
            return Math.sqrt(this.x * this.x + this.y * this.y + this.z * this.z + this.w * this.w)
        }, t.prototype.normalize = function() {
            var t = 1 / this.length();
            this.x *= t, this.y *= t, this.z *= t, this.w *= t
        }, t.prototype.toEulerAngles = function() {
            var t = this.x, e = this.y, n = this.z, i = this.w, r = t * t, s = e * e, a = n * n, l = Math.atan2(2 * (e * i - t * n), 1 - 2 * (s + a)), h = Math.asin(2 * (t * e + n * i)), c = Math.atan2(2 * (t * i - e * n), 1 - 2 * (r + a)), u = t * e + n * i;
            return u > .499 ? (l = 2 * Math.atan2(t, i), c = 0) : -.499 > u && (l = -2 * Math.atan2(t, i), c = 0), new o(h, l, c)
        }, t.prototype.toRotationMatrix = function(t) {
            var e = this.x * this.x, n = this.y * this.y, i = this.z * this.z, o = this.x * this.y, r = this.z * this.w, s = this.z * this.x, a = this.y * this.w, l = this.y * this.z, h = this.x * this.w;
            t.m[0] = 1 - 2 * (n + i), t.m[1] = 2 * (o + r), t.m[2] = 2 * (s - a), t.m[3] = 0, t.m[4] = 2 * (o - r), t.m[5] = 1 - 2 * (i + e), t.m[6] = 2 * (l + h), t.m[7] = 0, t.m[8] = 2 * (s + a), t.m[9] = 2 * (l - h), t.m[10] = 1 - 2 * (n + e), t.m[11] = 0, t.m[12] = 0, t.m[13] = 0, t.m[14] = 0, t.m[15] = 1
        }, t.RotationAxis = function(e, n) {
            var i = new t, o = Math.sin(n / 2);
            return i.w = Math.cos(n / 2), i.x = e.x * o, i.y = e.y * o, i.z = e.z * o, i
        }, t.FromArray = function(e, n) {
            return n || (n = 0), new t(e[n], e[n + 1], e[n + 2], e[n + 3])
        }, t.RotationYawPitchRoll = function(e, n, i) {
            var o = new t;
            return t.RotationYawPitchRollToRef(e, n, i, o), o
        }, t.RotationYawPitchRollToRef = function(t, e, n, i) {
            var o = .5 * n, r = .5 * e, s = .5 * t, a = Math.sin(o), l = Math.cos(o), h = Math.sin(r), c = Math.cos(r), u = Math.sin(s), p = Math.cos(s);
            i.x = p * h * l + u * c * a, i.y = u * c * l - p * h * a, i.z = p * c * a - u * h * l, i.w = p * c * l + u * h * a
        }, t.Slerp = function(e, n, i) {
            var o, r, s = i, a = e.x * n.x + e.y * n.y + e.z * n.z + e.w * n.w, l = !1;
            if (0 > a && (l = !0, a = -a), a > .999999)
                r = 1 - s, o = l ? -s : s;
            else {
                var h = Math.acos(a), c = 1 / Math.sin(h);
                r = Math.sin((1 - s) * h) * c, o = l ? -Math.sin(s * h) * c : Math.sin(s * h) * c
            }
            return new t(r * e.x + o * n.x, r * e.y + o * n.y, r * e.z + o * n.z, r * e.w + o * n.w)
        }, t
    }();
    t.Quaternion = r;
    var s = function() {
        function t() {
            this.m = new Float32Array(16)
        }
        return t.prototype.isIdentity = function() {
            return 1 != this.m[0] || 1 != this.m[5] || 1 != this.m[10] || 1 != this.m[15] ? !1 : 0 != this.m[1] || 0 != this.m[2] || 0 != this.m[3] || 0 != this.m[4] || 0 != this.m[6] || 0 != this.m[7] || 0 != this.m[8] || 0 != this.m[9] || 0 != this.m[11] || 0 != this.m[12] || 0 != this.m[13] || 0 != this.m[14] ? !1 : !0
        }, t.prototype.determinant = function() {
            var t = this.m[10] * this.m[15] - this.m[11] * this.m[14], e = this.m[9] * this.m[15] - this.m[11] * this.m[13], n = this.m[9] * this.m[14] - this.m[10] * this.m[13], i = this.m[8] * this.m[15] - this.m[11] * this.m[12], o = this.m[8] * this.m[14] - this.m[10] * this.m[12], r = this.m[8] * this.m[13] - this.m[9] * this.m[12];
            return this.m[0] * (this.m[5] * t - this.m[6] * e + this.m[7] * n) - this.m[1] * (this.m[4] * t - this.m[6] * i + this.m[7] * o) + this.m[2] * (this.m[4] * e - this.m[5] * i + this.m[7] * r) - this.m[3] * (this.m[4] * n - this.m[5] * o + this.m[6] * r)
        }, t.prototype.toArray = function() {
            return this.m
        }, t.prototype.asArray = function() {
            return this.toArray()
        }, t.prototype.invert = function() {
            this.invertToRef(this)
        }, t.prototype.invertToRef = function(t) {
            var e = this.m[0], n = this.m[1], i = this.m[2], o = this.m[3], r = this.m[4], s = this.m[5], a = this.m[6], l = this.m[7], h = this.m[8], c = this.m[9], u = this.m[10], p = this.m[11], d = this.m[12], m = this.m[13], g = this.m[14], f = this.m[15], y = u * f - p * g, _ = c * f - p * m, v = c * g - u * m, b = h * f - p * d, w = h * g - u * d, x = h * m - c * d, C = s * y - a * _ + l * v, M = -(r * y - a * b + l * w), D = r * _ - s * b + l * x, B = -(r * v - s * w + a * x), A = 1 / (e * C + n * M + i * D + o * B), E = a * f - l * g, T = s * f - l * m, S = s * g - a * m, L = r * f - l * d, O = r * g - a * d, P = r * m - s * d, I = a * p - l * u, N = s * p - l * c, R = s * u - a * c, k = r * p - l * h, V = r * u - a * h, F = r * c - s * h;
            t.m[0] = C * A, t.m[4] = M * A, t.m[8] = D * A, t.m[12] = B * A, t.m[1] = -(n * y - i * _ + o * v) * A, t.m[5] = (e * y - i * b + o * w) * A, t.m[9] = -(e * _ - n * b + o * x) * A, t.m[13] = (e * v - n * w + i * x) * A, t.m[2] = (n * E - i * T + o * S) * A, t.m[6] = -(e * E - i * L + o * O) * A, t.m[10] = (e * T - n * L + o * P) * A, t.m[14] = -(e * S - n * O + i * P) * A, t.m[3] = -(n * I - i * N + o * R) * A, t.m[7] = (e * I - i * k + o * V) * A, t.m[11] = -(e * N - n * k + o * F) * A, t.m[15] = (e * R - n * V + i * F) * A
        }, t.prototype.setTranslation = function(t) {
            this.m[12] = t.x, this.m[13] = t.y, this.m[14] = t.z
        }, t.prototype.multiply = function(e) {
            var n = new t;
            return this.multiplyToRef(e, n), n
        }, t.prototype.copyFrom = function(t) {
            for (var e = 0; 16 > e; e++)
                this.m[e] = t.m[e]
                }, t.prototype.copyToArray = function(t, e) {
                    "undefined" == typeof e && (e = 0);
                    for (var n = 0; 16 > n; n++)
                        t[e + n] = this.m[n]
                        }, t.prototype.multiplyToRef = function(t, e) {
                            this.multiplyToArray(t, e.m, 0)
                        }, t.prototype.multiplyToArray = function(t, e, n) {
                            var i = this.m[0], o = this.m[1], r = this.m[2], s = this.m[3], a = this.m[4], l = this.m[5], h = this.m[6], c = this.m[7], u = this.m[8], p = this.m[9], d = this.m[10], m = this.m[11], g = this.m[12], f = this.m[13], y = this.m[14], _ = this.m[15], v = t.m[0], b = t.m[1], w = t.m[2], x = t.m[3], C = t.m[4], M = t.m[5], D = t.m[6], B = t.m[7], A = t.m[8], E = t.m[9], T = t.m[10], S = t.m[11], L = t.m[12], O = t.m[13], P = t.m[14], I = t.m[15];
                            e[n] = i * v + o * C + r * A + s * L, e[n + 1] = i * b + o * M + r * E + s * O, e[n + 2] = i * w + o * D + r * T + s * P, e[n + 3] = i * x + o * B + r * S + s * I, e[n + 4] = a * v + l * C + h * A + c * L, e[n + 5] = a * b + l * M + h * E + c * O, e[n + 6] = a * w + l * D + h * T + c * P, e[n + 7] = a * x + l * B + h * S + c * I, e[n + 8] = u * v + p * C + d * A + m * L, e[n + 9] = u * b + p * M + d * E + m * O, e[n + 10] = u * w + p * D + d * T + m * P, e[n + 11] = u * x + p * B + d * S + m * I, e[n + 12] = g * v + f * C + y * A + _ * L, e[n + 13] = g * b + f * M + y * E + _ * O, e[n + 14] = g * w + f * D + y * T + _ * P, e[n + 15] = g * x + f * B + y * S + _ * I
                        }, t.prototype.equals = function(t) {
                            return t && this.m[0] === t.m[0] && this.m[1] === t.m[1] && this.m[2] === t.m[2] && this.m[3] === t.m[3] && this.m[4] === t.m[4] && this.m[5] === t.m[5] && this.m[6] === t.m[6] && this.m[7] === t.m[7] && this.m[8] === t.m[8] && this.m[9] === t.m[9] && this.m[10] === t.m[10] && this.m[11] === t.m[11] && this.m[12] === t.m[12] && this.m[13] === t.m[13] && this.m[14] === t.m[14] && this.m[15] === t.m[15]
                        }, t.prototype.clone = function() {
                            return t.FromValues(this.m[0], this.m[1], this.m[2], this.m[3], this.m[4], this.m[5], this.m[6], this.m[7], this.m[8], this.m[9], this.m[10], this.m[11], this.m[12], this.m[13], this.m[14], this.m[15])
                        }, t.FromArray = function(e, n) {
                            var i = new t;
                            return n || (n = 0), t.FromArrayToRef(e, n, i), i
                        }, t.FromArrayToRef = function(t, e, n) {
                            for (var i = 0; 16 > i; i++)
                                n.m[i] = t[i + e]
                                }, t.FromValuesToRef = function(t, e, n, i, o, r, s, a, l, h, c, u, p, d, m, g, f) {
                                    f.m[0] = t, f.m[1] = e, f.m[2] = n, f.m[3] = i, f.m[4] = o, f.m[5] = r, f.m[6] = s, f.m[7] = a, f.m[8] = l, f.m[9] = h, f.m[10] = c, f.m[11] = u, f.m[12] = p, f.m[13] = d, f.m[14] = m, f.m[15] = g
                                }, t.FromValues = function(e, n, i, o, r, s, a, l, h, c, u, p, d, m, g, f) {
                                    var y = new t;
                                    return y.m[0] = e, y.m[1] = n, y.m[2] = i, y.m[3] = o, y.m[4] = r, y.m[5] = s, y.m[6] = a, y.m[7] = l, y.m[8] = h, y.m[9] = c, y.m[10] = u, y.m[11] = p, y.m[12] = d, y.m[13] = m, y.m[14] = g, y.m[15] = f, y
                                }, t.Identity = function() {
                                    return t.FromValues(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1)
                                }, t.IdentityToRef = function(e) {
                                    t.FromValuesToRef(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, e)
                                }, t.Zero = function() {
                                    return t.FromValues(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0)
                                }, t.RotationX = function(e) {
                                    var n = new t;
                                    return t.RotationXToRef(e, n), n
                                }, t.RotationXToRef = function(t, e) {
                                    var n = Math.sin(t), i = Math.cos(t);
                                    e.m[0] = 1, e.m[15] = 1, e.m[5] = i, e.m[10] = i, e.m[9] = -n, e.m[6] = n, e.m[1] = 0, e.m[2] = 0, e.m[3] = 0, e.m[4] = 0, e.m[7] = 0, e.m[8] = 0, e.m[11] = 0, e.m[12] = 0, e.m[13] = 0, e.m[14] = 0
                                }, t.RotationY = function(e) {
                                    var n = new t;
                                    return t.RotationYToRef(e, n), n
                                }, t.RotationYToRef = function(t, e) {
                                    var n = Math.sin(t), i = Math.cos(t);
                                    e.m[5] = 1, e.m[15] = 1, e.m[0] = i, e.m[2] = -n, e.m[8] = n, e.m[10] = i, e.m[1] = 0, e.m[3] = 0, e.m[4] = 0, e.m[6] = 0, e.m[7] = 0, e.m[9] = 0, e.m[11] = 0, e.m[12] = 0, e.m[13] = 0, e.m[14] = 0
                                }, t.RotationZ = function(e) {
                                    var n = new t;
                                    return t.RotationZToRef(e, n), n
                                }, t.RotationZToRef = function(t, e) {
                                    var n = Math.sin(t), i = Math.cos(t);
                                    e.m[10] = 1, e.m[15] = 1, e.m[0] = i, e.m[1] = n, e.m[4] = -n, e.m[5] = i, e.m[2] = 0, e.m[3] = 0, e.m[6] = 0, e.m[7] = 0, e.m[8] = 0, e.m[9] = 0, e.m[11] = 0, e.m[12] = 0, e.m[13] = 0, e.m[14] = 0
                                }, t.RotationAxis = function(e, n) {
                                    var i = Math.sin(-n), o = Math.cos(-n), r = 1 - o;
                                    e.normalize();
                                    var s = t.Zero();
                                    return s.m[0] = e.x * e.x * r + o, s.m[1] = e.x * e.y * r - e.z * i, s.m[2] = e.x * e.z * r + e.y * i, s.m[3] = 0, s.m[4] = e.y * e.x * r + e.z * i, s.m[5] = e.y * e.y * r + o, s.m[6] = e.y * e.z * r - e.x * i, s.m[7] = 0, s.m[8] = e.z * e.x * r - e.y * i, s.m[9] = e.z * e.y * r + e.x * i, s.m[10] = e.z * e.z * r + o, s.m[11] = 0, s.m[15] = 1, s
                                }, t.RotationYawPitchRoll = function(e, n, i) {
                                    var o = new t;
                                    return t.RotationYawPitchRollToRef(e, n, i, o), o
                                }, t.RotationYawPitchRollToRef = function(t, e, n, i) {
                                    r.RotationYawPitchRollToRef(t, e, n, this._tempQuaternion), this._tempQuaternion.toRotationMatrix(i)
                                }, t.Scaling = function(e, n, i) {
                                    var o = t.Zero();
                                    return t.ScalingToRef(e, n, i, o), o
                                }, t.ScalingToRef = function(t, e, n, i) {
                                    i.m[0] = t, i.m[1] = 0, i.m[2] = 0, i.m[3] = 0, i.m[4] = 0, i.m[5] = e, i.m[6] = 0, i.m[7] = 0, i.m[8] = 0, i.m[9] = 0, i.m[10] = n, i.m[11] = 0, i.m[12] = 0, i.m[13] = 0, i.m[14] = 0, i.m[15] = 1
                                }, t.Translation = function(e, n, i) {
                                    var o = t.Identity();
                                    return t.TranslationToRef(e, n, i, o), o
                                }, t.TranslationToRef = function(e, n, i, o) {
                                    t.FromValuesToRef(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, e, n, i, 1, o)
                                }, t.LookAtLH = function(e, n, i) {
                                    var o = t.Zero();
                                    return t.LookAtLHToRef(e, n, i, o), o
                                }, t.LookAtLHToRef = function(e, n, i, r) {
                                    n.subtractToRef(e, this._zAxis), this._zAxis.normalize(), o.CrossToRef(i, this._zAxis, this._xAxis), this._xAxis.normalize(), o.CrossToRef(this._zAxis, this._xAxis, this._yAxis), this._yAxis.normalize();
                                    var s = -o.Dot(this._xAxis, e), a = -o.Dot(this._yAxis, e), l = -o.Dot(this._zAxis, e);
                                    return t.FromValuesToRef(this._xAxis.x, this._yAxis.x, this._zAxis.x, 0, this._xAxis.y, this._yAxis.y, this._zAxis.y, 0, this._xAxis.z, this._yAxis.z, this._zAxis.z, 0, s, a, l, 1, r)
                                }, t.OrthoLH = function(e, n, i, o) {
                                    var r = 2 / e, s = 2 / n, a = 1 / (o - i), l = i / (i - o);
                                    return t.FromValues(r, 0, 0, 0, 0, s, 0, 0, 0, 0, a, 0, 0, 0, l, 1)
                                }, t.OrthoOffCenterLH = function(e, n, i, o, r, s) {
                                    var a = t.Zero();
                                    return t.OrthoOffCenterLHToRef(e, n, i, o, r, s, a), a
                                }, t.OrthoOffCenterLHToRef = function(t, e, n, i, o, r, s) {
                                    s.m[0] = 2 / (e - t), s.m[1] = s.m[2] = s.m[3] = 0, s.m[5] = 2 / (i - n), s.m[4] = s.m[6] = s.m[7] = 0, s.m[10] = -1 / (o - r), s.m[8] = s.m[9] = s.m[11] = 0, s.m[12] = (t + e) / (t - e), s.m[13] = (i + n) / (n - i), s.m[14] = o / (o - r), s.m[15] = 1
                                }, t.PerspectiveLH = function(e, n, i, o) {
                                    var r = t.Zero();
                                    return r.m[0] = 2 * i / e, r.m[1] = r.m[2] = r.m[3] = 0, r.m[5] = 2 * i / n, r.m[4] = r.m[6] = r.m[7] = 0, r.m[10] = -o / (i - o), r.m[8] = r.m[9] = 0, r.m[11] = 1, r.m[12] = r.m[13] = r.m[15] = 0, r.m[14] = i * o / (i - o), r
                                }, t.PerspectiveFovLH = function(e, n, i, o) {
                                    var r = t.Zero();
                                    return t.PerspectiveFovLHToRef(e, n, i, o, r), r
                                }, t.PerspectiveFovLHToRef = function(t, e, n, i, o) {
                                    var r = 1 / Math.tan(.5 * t);
                                    o.m[0] = r / e, o.m[1] = o.m[2] = o.m[3] = 0, o.m[5] = r, o.m[4] = o.m[6] = o.m[7] = 0, o.m[8] = o.m[9] = 0, o.m[10] = -i / (n - i), o.m[11] = 1, o.m[12] = o.m[13] = o.m[15] = 0, o.m[14] = n * i / (n - i)
                                }, t.GetFinalMatrix = function(e, n, i, o, r, s) {
                                    var a = e.width, l = e.height, h = e.x, c = e.y, u = t.FromValues(a / 2, 0, 0, 0, 0, -l / 2, 0, 0, 0, 0, s - r, 0, h + a / 2, l / 2 + c, r, 1);
                                    return n.multiply(i).multiply(o).multiply(u)
                                }, t.Transpose = function(e) {
                                    var n = new t;
                                    return n.m[0] = e.m[0], n.m[1] = e.m[4], n.m[2] = e.m[8], n.m[3] = e.m[12], n.m[4] = e.m[1], n.m[5] = e.m[5], n.m[6] = e.m[9], n.m[7] = e.m[13], n.m[8] = e.m[2], n.m[9] = e.m[6], n.m[10] = e.m[10], n.m[11] = e.m[14], n.m[12] = e.m[3], n.m[13] = e.m[7], n.m[14] = e.m[11], n.m[15] = e.m[15], n
                                }, t.Reflection = function(e) {
                                    var n = new t;
                                    return t.ReflectionToRef(e, n), n
                                }, t.ReflectionToRef = function(t, e) {
                                    t.normalize();
                                    var n = t.normal.x, i = t.normal.y, o = t.normal.z, r = -2 * n, s = -2 * i, a = -2 * o;
                                    e.m[0] = r * n + 1, e.m[1] = s * n, e.m[2] = a * n, e.m[3] = 0, e.m[4] = r * i, e.m[5] = s * i + 1, e.m[6] = a * i, e.m[7] = 0, e.m[8] = r * o, e.m[9] = s * o, e.m[10] = a * o + 1, e.m[11] = 0, e.m[12] = r * t.d, e.m[13] = s * t.d, e.m[14] = a * t.d, e.m[15] = 1
                                }, t._tempQuaternion = new r, t._xAxis = o.Zero(), t._yAxis = o.Zero(), t._zAxis = o.Zero(), t
    }();
    t.Matrix = s;
    var a = function() {
        function e(t, e, n, i) {
            this.normal = new o(t, e, n), this.d = i
        }
        return e.prototype.asArray = function() {
            return [this.normal.x, this.normal.y, this.normal.z, this.d]
        }, e.prototype.clone = function() {
            return new e(this.normal.x, this.normal.y, this.normal.z, this.d)
        }, e.prototype.normalize = function() {
            var t = Math.sqrt(this.normal.x * this.normal.x + this.normal.y * this.normal.y + this.normal.z * this.normal.z), e = 0;
            0 != t && (e = 1 / t), this.normal.x *= e, this.normal.y *= e, this.normal.z *= e, this.d *= e
        }, e.prototype.transform = function(e) {
            var n = t.Matrix.Transpose(e), i = this.normal.x, o = this.normal.y, r = this.normal.z, s = this.d, a = i * n.m[0] + o * n.m[1] + r * n.m[2] + s * n.m[3], l = i * n.m[4] + o * n.m[5] + r * n.m[6] + s * n.m[7], h = i * n.m[8] + o * n.m[9] + r * n.m[10] + s * n.m[11], c = i * n.m[12] + o * n.m[13] + r * n.m[14] + s * n.m[15];
            return new t.Plane(a, l, h, c)
        }, e.prototype.dotCoordinate = function(t) {
            return this.normal.x * t.x + this.normal.y * t.y + this.normal.z * t.z + this.d
        }, e.prototype.copyFromPoints = function(t, e, n) {
            var i, o = e.x - t.x, r = e.y - t.y, s = e.z - t.z, a = n.x - t.x, l = n.y - t.y, h = n.z - t.z, c = r * h - s * l, u = s * a - o * h, p = o * l - r * a, d = Math.sqrt(c * c + u * u + p * p);
            i = 0 != d ? 1 / d : 0, this.normal.x = c * i, this.normal.y = u * i, this.normal.z = p * i, this.d = -(this.normal.x * t.x + this.normal.y * t.y + this.normal.z * t.z)
        }, e.prototype.isFrontFacingTo = function(t, e) {
            var n = o.Dot(this.normal, t);
            return e >= n
        }, e.prototype.signedDistanceTo = function(t) {
            return o.Dot(t, this.normal) + this.d
        }, e.FromArray = function(e) {
            return new t.Plane(e[0], e[1], e[2], e[3])
        }, e.FromPoints = function(e, n, i) {
            var o = new t.Plane(0, 0, 0, 0);
            return o.copyFromPoints(e, n, i), o
        }, e.FromPositionAndNormal = function(e, n) {
            var i = new t.Plane(0, 0, 0, 0);
            return n.normalize(), i.normal = n, i.d = -(n.x * e.x + n.y * e.y + n.z * e.z), i
        }, e.SignedDistanceToPlaneFromPositionAndNormal = function(t, e, n) {
            var i = -(e.x * t.x + e.y * t.y + e.z * t.z);
            return o.Dot(n, e) + i
        }, e
    }();
    t.Plane = a;
    var l = function() {
        function t(t, e, n, i) {
            this.x = t, this.y = e, this.width = n, this.height = i
        }
        return t.prototype.toGlobal = function(e) {
            var n = e.getRenderWidth(), i = e.getRenderHeight();
            return new t(this.x * n, this.y * i, this.width * n, this.height * i)
        }, t
    }();
    t.Viewport = l;
    var h = function() {
        function t() {
        }
        return t.GetPlanes = function(e) {
            for (var n = [], i = 0; 6 > i; i++)
                n.push(new a(0, 0, 0, 0));
            return t.GetPlanesToRef(e, n), n
        }, t.GetPlanesToRef = function(t, e) {
            e[0].normal.x = t.m[3] + t.m[2], e[0].normal.y = t.m[7] + t.m[6], e[0].normal.z = t.m[10] + t.m[10], e[0].d = t.m[15] + t.m[14], e[0].normalize(), e[1].normal.x = t.m[3] - t.m[2], e[1].normal.y = t.m[7] - t.m[6], e[1].normal.z = t.m[11] - t.m[10], e[1].d = t.m[15] - t.m[14], e[1].normalize(), e[2].normal.x = t.m[3] + t.m[0], e[2].normal.y = t.m[7] + t.m[4], e[2].normal.z = t.m[11] + t.m[8], e[2].d = t.m[15] + t.m[12], e[2].normalize(), e[3].normal.x = t.m[3] - t.m[0], e[3].normal.y = t.m[7] - t.m[4], e[3].normal.z = t.m[11] - t.m[8], e[3].d = t.m[15] - t.m[12], e[3].normalize(), e[4].normal.x = t.m[3] - t.m[1], e[4].normal.y = t.m[7] - t.m[5], e[4].normal.z = t.m[11] - t.m[9], e[4].d = t.m[15] - t.m[13], e[4].normalize(), e[5].normal.x = t.m[3] + t.m[1], e[5].normal.y = t.m[7] + t.m[5], e[5].normal.z = t.m[11] + t.m[9], e[5].d = t.m[15] + t.m[13], e[5].normalize()
        }, t
    }();
    t.Frustum = h;
    var c = function() {
        function e(t, e) {
            this.origin = t, this.direction = e
        }
        return e.prototype.intersectsBoxMinMax = function(t, e) {
            var n = 0, i = Number.MAX_VALUE;
            if (Math.abs(this.direction.x) < 1e-7) {
                if (this.origin.x < t.x || this.origin.x > e.x)
                    return !1
                    } else {
                        var o = 1 / this.direction.x, r = (t.x - this.origin.x) * o, s = (e.x - this.origin.x) * o;
                        if (r > s) {
                            var a = r;
                            r = s, s = a
                        }
                        if (n = Math.max(r, n), i = Math.min(s, i), n > i)
                            return !1
                            }
            if (Math.abs(this.direction.y) < 1e-7) {
                if (this.origin.y < t.y || this.origin.y > e.y)
                    return !1
                    } else if (o = 1 / this.direction.y, r = (t.y - this.origin.y) * o, s = (e.y - this.origin.y) * o, r > s && (a = r, r = s, s = a), n = Math.max(r, n), i = Math.min(s, i), n > i)
                        return !1;
            if (Math.abs(this.direction.z) < 1e-7) {
                if (this.origin.z < t.z || this.origin.z > e.z)
                    return !1
                    } else if (o = 1 / this.direction.z, r = (t.z - this.origin.z) * o, s = (e.z - this.origin.z) * o, r > s && (a = r, r = s, s = a), n = Math.max(r, n), i = Math.min(s, i), n > i)
                        return !1;
            return !0
        }, e.prototype.intersectsBox = function(t) {
            return this.intersectsBoxMinMax(t.minimum, t.maximum)
        }, e.prototype.intersectsSphere = function(t) {
            var e = t.center.x - this.origin.x, n = t.center.y - this.origin.y, i = t.center.z - this.origin.z, o = e * e + n * n + i * i, r = t.radius * t.radius;
            if (r >= o)
                return !0;
            var s = e * this.direction.x + n * this.direction.y + i * this.direction.z;
            if (0 > s)
                return !1;
            var a = o - s * s;
            return r >= a
        }, e.prototype.intersectsTriangle = function(e, n, i) {
            this._edge1 || (this._edge1 = t.Vector3.Zero(), this._edge2 = t.Vector3.Zero(), this._pvec = t.Vector3.Zero(), this._tvec = t.Vector3.Zero(), this._qvec = t.Vector3.Zero()), n.subtractToRef(e, this._edge1), i.subtractToRef(e, this._edge2), t.Vector3.CrossToRef(this.direction, this._edge2, this._pvec);
            var r = o.Dot(this._edge1, this._pvec);
            if (0 === r)
                return null;
            var s = 1 / r;
            this.origin.subtractToRef(e, this._tvec);
            var a = o.Dot(this._tvec, this._pvec) * s;
            if (0 > a || a > 1)
                return null;
            o.CrossToRef(this._tvec, this._edge1, this._qvec);
            var l = o.Dot(this.direction, this._qvec) * s;
            return 0 > l || a + l > 1 ? null : new t.IntersectionInfo(a, l, o.Dot(this._edge2, this._qvec) * s)
        }, e.CreateNew = function(n, i, o, r, s, a, l) {
            var h = t.Vector3.Unproject(new t.Vector3(n, i, 0), o, r, s, a, l), c = t.Vector3.Unproject(new t.Vector3(n, i, 1), o, r, s, a, l), u = c.subtract(h);
            return u.normalize(), new e(h, u)
        }, e.Transform = function(n, i) {
            var o = t.Vector3.TransformCoordinates(n.origin, i), r = t.Vector3.TransformNormal(n.direction, i);
            return new e(o, r)
        }, e
    }();
    t.Ray = c, function(t) {
        t[t.LOCAL = 0] = "LOCAL", t[t.WORLD = 1] = "WORLD"
    }(t.Space || (t.Space = {}));
    var u = (t.Space, function() {
             function e() {
             }
             return e.X = new t.Vector3(1, 0, 0), e.Y = new t.Vector3(0, 1, 0), e.Z = new t.Vector3(0, 0, 1), e
             }());
    t.Axis = u
}(BABYLON || (BABYLON = {}));
var BABYLON;
!function(t) {
    var e = function() {
        function e(e, n) {
            this.idbFactory = window.indexedDB || window.mozIndexedDB || window.webkitIndexedDB || window.msIndexedDB, this.callbackManifestChecked = n, this.currentSceneUrl = t.Database.ReturnFullUrlLocation(e), this.db = null, this.enableSceneOffline = !1, this.enableTexturesOffline = !1, this.manifestVersionFound = 0, this.mustUpdateRessources = !1, this.hasReachedQuota = !1, this.checkManifestFile()
        }
        return e.prototype.checkManifestFile = function() {
            function e() {
                t.Tools.Log("Valid manifest file not found. Scene & textures will be loaded directly from the web server."), n.enableSceneOffline = !1, n.enableTexturesOffline = !1, n.callbackManifestChecked(!1)
            }
            var n = this, i = this.currentSceneUrl + " ", o = new XMLHttpRequest, r = i;
			//var n = this, i = this.currentSceneUrl + ".manifest", o = new XMLHttpRequest, r = i + (null == i.match(/\?/) ? "?" : "&") + (new Date).getTime();
            o.open("GET", r, !0), o.addEventListener("load", function() {
                                                     if (200 === o.status || t.Tools.ValidateXHRData(o, 1))
                                                     try {
                                                     var i = JSON.parse(o.response);
                                                     n.enableSceneOffline = i.enableSceneOffline, n.enableTexturesOffline = i.enableTexturesOffline, i.version && !isNaN(parseInt(i.version)) && (n.manifestVersionFound = i.version), n.callbackManifestChecked && n.callbackManifestChecked(!0)
                                                     } catch (r) {
                                                     e()
                                                     }
                                                     else
                                                     e()
                                                     }, !1), o.addEventListener("error", function() {
                                                                                e()
                                                                                }, !1);
            try {
                o.send()
            } catch (s) {
                //                t.Tools.Error("Error on XHR send request."), n.callbackManifestChecked(!1)
            }
        }, e.prototype.openAsync = function(e, n) {
            function i() {
                o.isSupported = !1, n && n()
            }
            var o = this;
            if (this.idbFactory && (this.enableSceneOffline || this.enableTexturesOffline))
                if (this.db)
                    e && e();
                else {
                    this.hasReachedQuota = !1, this.isSupported = !0;
                    var r = this.idbFactory.open("babylonjs", 1);
                    r.onerror = function() {
                        i()
                    }, r.onblocked = function() {
                        t.Tools.Error("IDB request blocked. Please reload the page."), i()
                    }, r.onsuccess = function() {
                        o.db = r.result, e()
                    }, r.onupgradeneeded = function(e) {
                        o.db = e.target.result;
                        try {
                            e.oldVersion > 0 && (o.db.deleteObjectStore("scenes"), o.db.deleteObjectStore("versions"), o.db.deleteObjectStore("textures"));
                            {
                                o.db.createObjectStore("scenes", {keyPath: "sceneUrl"}), o.db.createObjectStore("versions", {keyPath: "sceneUrl"}), o.db.createObjectStore("textures", {keyPath: "textureUrl"})
                            }
                        } catch (n) {
                            t.Tools.Error("Error while creating object stores. Exception: " + n.message), i()
                        }
                    }
                }
                else
                    this.isSupported = !1, n && n()
                    }, e.prototype.loadImageFromDB = function(e, n) {
                        var i = this, o = t.Database.ReturnFullUrlLocation(e), r = function() {
                            i.hasReachedQuota || null === i.db ? n.src = e : i._saveImageIntoDBAsync(o, n)
                        };
                        this.mustUpdateRessources ? r() : this._loadImageFromDBAsync(o, n, r)
                    }, e.prototype._loadImageFromDBAsync = function(e, n, i) {
                        if (this.isSupported && null !== this.db) {
                            var o, r = this.db.transaction(["textures"]);
                            r.onabort = function() {
                                n.src = e
                            }, r.oncomplete = function() {
                                var r;
                                if (o) {
                                    var s = window.URL || window.webkitURL;
                                    r = s.createObjectURL(o.data, {oneTimeOnly: !0}), n.onerror = function() {
                                        t.Tools.Error("Error loading image from blob URL: " + r + " switching back to web url: " + e), n.src = e
                                    }, n.src = r
                                } else
                                    i()
                                    };
                            var s = r.objectStore("textures").get(e);
                            s.onsuccess = function(t) {
                                o = t.target.result
                            }, s.onerror = function() {
                                t.Tools.Error("Error loading texture " + e + " from DB."), n.src = e
                            }
                        } else
                            t.Tools.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."), n.src = e
                            }, e.prototype._saveImageIntoDBAsync = function(e, n) {
                                if (this.isSupported) {
                                    var i = function() {
                                        var t;
                                        if (o) {
                                            var e = window.URL || window.webkitURL;
                                            try {
                                                t = e.createObjectURL(o, {oneTimeOnly: !0})
                                            } catch (i) {
                                                t = e.createObjectURL(o)
                                            }
                                        }
                                        n.src = t
                                    };
                                    if (t.Database.isUASupportingBlobStorage) {
                                        var o, r = this, s = new XMLHttpRequest;
                                        s.open("GET", e, !0), s.responseType = "blob", s.addEventListener("load", function() {
                                                                                                          if (200 === s.status) {
                                                                                                          o = s.response;
                                                                                                          var a = r.db.transaction(["textures"], "readwrite");
                                                                                                          a.onabort = function(t) {
                                                                                                          try {
                                                                                                          "QuotaExceededError" === t.srcElement.error.name && (r.hasReachedQuota = !0)
                                                                                                          } catch (e) {
                                                                                                          }
                                                                                                          i()
                                                                                                          }, a.oncomplete = function() {
                                                                                                          i()
                                                                                                          };
                                                                                                          var l = {textureUrl: e,data: o};
                                                                                                          try {
                                                                                                          var h = a.objectStore("textures").put(l);
                                                                                                          h.onsuccess = function() {
                                                                                                          }, h.onerror = function() {
                                                                                                          i()
                                                                                                          }
                                                                                                          } catch (c) {
                                                                                                          25 === c.code && (t.Database.isUASupportingBlobStorage = !1), n.src = e
                                                                                                          }
                                                                                                          } else
                                                                                                          n.src = e
                                                                                                          }, !1), s.addEventListener("error", function() {
                                                                                                                                     t.Tools.Error("Error in XHR request in BABYLON.Database."), n.src = e
                                                                                                                                     }, !1), s.send()
                                    } else
                                        n.src = e
                                        } else
                                            t.Tools.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."), n.src = e
                                            }, e.prototype._checkVersionFromDB = function(t, e) {
                                                var n = this, i = function() {
                                                    n._saveVersionIntoDBAsync(t, e)
                                                };
                                                this._loadVersionFromDBAsync(t, e, i)
                                            }, e.prototype._loadVersionFromDBAsync = function(e, n, i) {
                                                if (this.isSupported) {
                                                    var o, r = this;
                                                    try {
                                                        var s = this.db.transaction(["versions"]);
                                                        s.oncomplete = function() {
                                                            o ? r.manifestVersionFound > o.data ? (r.mustUpdateRessources = !0, i()) : n(o.data) : (r.mustUpdateRessources = !0, i())
                                                        }, s.onabort = function() {
                                                            n(-1)
                                                        };
                                                        var a = s.objectStore("versions").get(e);
                                                        a.onsuccess = function(t) {
                                                            o = t.target.result
                                                        }, a.onerror = function() {
                                                            t.Tools.Error("Error loading version for scene " + e + " from DB."), n(-1)
                                                        }
                                                    } catch (l) {
                                                        t.Tools.Error("Error while accessing 'versions' object store (READ OP). Exception: " + l.message), n(-1)
                                                    }
                                                } else
                                                    t.Tools.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."), n(-1)
                                                    }, e.prototype._saveVersionIntoDBAsync = function(e, n) {
                                                        if (this.isSupported && !this.hasReachedQuota) {
                                                            var i = this;
                                                            try {
                                                                var o = this.db.transaction(["versions"], "readwrite");
                                                                o.onabort = function(t) {
                                                                    try {
                                                                        "QuotaExceededError" === t.srcElement.error.name && (i.hasReachedQuota = !0)
                                                                    } catch (e) {
                                                                    }
                                                                    n(-1)
                                                                }, o.oncomplete = function() {
                                                                    n(i.manifestVersionFound)
                                                                };
                                                                var r = {sceneUrl: e,data: this.manifestVersionFound}, s = o.objectStore("versions").put(r);
                                                                s.onsuccess = function() {
                                                                }, s.onerror = function() {
                                                                    t.Tools.Error("Error in DB add version request in BABYLON.Database.")
                                                                }
                                                            } catch (a) {
                                                                t.Tools.Error("Error while accessing 'versions' object store (WRITE OP). Exception: " + a.message), n(-1)
                                                            }
                                                        } else
                                                            n(-1)
                                                            }, e.prototype.loadFileFromDB = function(e, n, i, o, r) {
                                                                var s = this, a = t.Database.ReturnFullUrlLocation(e), l = function() {
                                                                    s._saveFileIntoDBAsync(a, n, i)
                                                                };
                                                                this._checkVersionFromDB(a, function(t) {
                                                                                         -1 !== t ? s.mustUpdateRessources ? s._saveFileIntoDBAsync(a, n, i, r) : s._loadFileFromDBAsync(a, n, l, r) : o()
                                                                                         })
                                                            }, e.prototype._loadFileFromDBAsync = function(e, n, i) {
                                                                if (this.isSupported) {
                                                                    var o;
                                                                    o = -1 !== e.indexOf(".babylon") ? "scenes" : "textures";
                                                                    var r, s = this.db.transaction([o]);
                                                                    s.oncomplete = function() {
                                                                        r ? n(r.data) : i()
                                                                    }, s.onabort = function() {
                                                                        i()
                                                                    };
                                                                    var a = s.objectStore(o).get(e);
                                                                    a.onsuccess = function(t) {
                                                                        r = t.target.result
                                                                    }, a.onerror = function() {
                                                                        t.Tools.Error("Error loading file " + e + " from DB."), i()
                                                                    }
                                                                } else
                                                                    t.Tools.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."), n()
                                                                    }, e.prototype._saveFileIntoDBAsync = function(e, n, i, o) {
                                                                        if (this.isSupported) {
                                                                            var r;
                                                                            r = -1 !== e.indexOf(".babylon") ? "scenes" : "textures";
                                                                            var s, a = new XMLHttpRequest, l = this;
                                                                            a.open("GET", e, !0), o && (a.responseType = "arraybuffer"), a.onprogress = i, a.addEventListener("load", function() {
                                                                                                                                                                              if (200 === a.status || t.Tools.ValidateXHRData(a, o ? 6 : 1))
                                                                                                                                                                              if (s = o ? a.response : a.responseText, l.hasReachedQuota)
                                                                                                                                                                              n(s);
                                                                                                                                                                              else {
                                                                                                                                                                              var i = l.db.transaction([r], "readwrite");
                                                                                                                                                                              i.onabort = function(t) {
                                                                                                                                                                              try {
                                                                                                                                                                              "QuotaExceededError" === t.srcElement.error.name && (l.hasReachedQuota = !0)
                                                                                                                                                                              } catch (e) {
                                                                                                                                                                              }
                                                                                                                                                                              n(s)
                                                                                                                                                                              }, i.oncomplete = function() {
                                                                                                                                                                              n(s)
                                                                                                                                                                              };
                                                                                                                                                                              var h;
                                                                                                                                                                              h = "scenes" === r ? {sceneUrl: e,data: s,version: l.manifestVersionFound} : {textureUrl: e,data: s};
                                                                                                                                                                              try {
                                                                                                                                                                              var c = i.objectStore(r).put(h);
                                                                                                                                                                              c.onsuccess = function() {
                                                                                                                                                                              }, c.onerror = function() {
                                                                                                                                                                              t.Tools.Error("Error in DB add file request in BABYLON.Database.")
                                                                                                                                                                              }
                                                                                                                                                                              } catch (u) {
                                                                                                                                                                              n(s)
                                                                                                                                                                              }
                                                                                                                                                                              }
                                                                                                                                                                              else
                                                                                                                                                                              n()
                                                                                                                                                                              }, !1), a.addEventListener("error", function() {
                                                                                                                                                                                                         t.Tools.Error("error on XHR request."), n()
                                                                                                                                                                                                         }, !1), a.send()
                                                                        } else
                                                                            t.Tools.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."), n()
                                                                            }, e.isUASupportingBlobStorage = !0, e.parseURL = function(t) {
                                                                                var e = document.createElement("a");
                                                                                e.href = t;
                                                                                var n = t.substring(t.lastIndexOf("/") + 1, t.length), i = t.substring(0, t.indexOf(n, 0));
                                                                                return i
                                                                            }, e.ReturnFullUrlLocation = function(e) {
                                                                                return -1 === e.indexOf("http:/") ? t.Database.parseURL(window.location.href) + e : e
                                                                            }, e
    }();
    t.Database = e
}(BABYLON || (BABYLON = {}));
var BABYLON;
!function(t) {
    !function(e) {
        var n = function() {
            function e() {
            }
            return e.GetTGAHeader = function(t) {
                var e = 0, n = {id_length: t[e++],colormap_type: t[e++],image_type: t[e++],colormap_index: t[e++] | t[e++] << 8,colormap_length: t[e++] | t[e++] << 8,colormap_size: t[e++],origin: [t[e++] | t[e++] << 8, t[e++] | t[e++] << 8],width: t[e++] | t[e++] << 8,height: t[e++] | t[e++] << 8,pixel_size: t[e++],flags: t[e++]};
                return n
            }, e.UploadContent = function(n, i) {
                if (i.length < 19)
                    return void t.Tools.Error("Unable to load TGA file - Not enough data to contain header");
                var o = 18, r = e.GetTGAHeader(i);
                if (r.id_length + o > i.length)
                    return void t.Tools.Error("Unable to load TGA file - Not enough data");
                o += r.id_length;
                var s = !1, a = !1, l = !1, h = !1;
                switch (r.image_type) {
                    case e._TYPE_RLE_INDEXED:
                        s = !0;
                    case e._TYPE_INDEXED:
                        a = !0;
                        break;
                    case e._TYPE_RLE_RGB:
                        s = !0;
                    case e._TYPE_RGB:
                        l = !0;
                        break;
                    case e._TYPE_RLE_GREY:
                        s = !0;
                    case e._TYPE_GREY:
                        h = !0
                }
                var c, u, p = (15 & r.flags, r.pixel_size >> 3), d = r.width * r.height * p;
                if (a && (u = i.subarray(o, o += r.colormap_length * (r.colormap_size >> 3))), s) {
                    c = new Uint8Array(d);
                    for (var m, g, f, y = 0, _ = new Uint8Array(p); d > o; )
                        if (m = i[o++], g = (127 & m) + 1, 128 & m) {
                            for (f = 0; p > f; ++f)
                                _[f] = i[o++];
                            for (f = 0; g > f; ++f)
                                c.set(_, y + f * p);
                            y += p * g
                        } else {
                            for (g *= p, f = 0; g > f; ++f)
                                c[y + f] = i[o++];
                            y += g
                        }
                } else
                    c = i.subarray(o, o += a ? r.width * r.height : d);
                var v, b, w, x, C, M;
                switch ((r.flags & e._ORIGIN_MASK) >> e._ORIGIN_SHIFT) {
                    default:
                    case e._ORIGIN_UL:
                        v = 0, w = 1, M = r.width, b = 0, x = 1, C = r.height;
                        break;
                    case e._ORIGIN_BL:
                        v = 0, w = 1, M = r.width, b = r.height - 1, x = -1, C = -1;
                        break;
                    case e._ORIGIN_UR:
                        v = r.width - 1, w = -1, M = -1, b = 0, x = 1, C = r.height;
                        break;
                    case e._ORIGIN_BR:
                        v = r.width - 1, w = -1, M = -1, b = r.height - 1, x = -1, C = -1
                }
                var D = "_getImageData" + (h ? "Grey" : "") + r.pixel_size + "bits", B = e[D](r, u, c, b, x, C, v, w, M);
                n.texImage2D(n.TEXTURE_2D, 0, n.RGBA, r.width, r.height, 0, n.RGBA, n.UNSIGNED_BYTE, B)
            }, e._getImageData8bits = function(t, e, n, i, o, r, s, a, l) {
                var h, c, u, p = n, d = e, m = t.width, g = t.height, f = 0, y = new Uint8Array(m * g * 4);
                for (u = i; u !== r; u += o)
                    for (c = s; c !== l; c += a, f++)
                        h = p[f], y[4 * (c + m * u) + 3] = 255, y[4 * (c + m * u) + 2] = d[3 * h + 0], y[4 * (c + m * u) + 1] = d[3 * h + 1], y[4 * (c + m * u) + 0] = d[3 * h + 2];
                return y
            }, e._getImageData16bits = function(t, e, n, i, o, r, s, a, l) {
                var h, c, u, p = n, d = t.width, m = t.height, g = 0, f = new Uint8Array(d * m * 4);
                for (u = i; u !== r; u += o)
                    for (c = s; c !== l; c += a, g += 2)
                        h = p[g + 0] + (p[g + 1] << 8), f[4 * (c + d * u) + 0] = (31744 & h) >> 7, f[4 * (c + d * u) + 1] = (992 & h) >> 2, f[4 * (c + d * u) + 2] = (31 & h) >> 3, f[4 * (c + d * u) + 3] = 32768 & h ? 0 : 255;
                return f
            }, e._getImageData24bits = function(t, e, n, i, o, r, s, a, l) {
                var h, c, u = n, p = t.width, d = t.height, m = 0, g = new Uint8Array(p * d * 4);
                for (c = i; c !== r; c += o)
                    for (h = s; h !== l; h += a, m += 3)
                        g[4 * (h + p * c) + 3] = 255, g[4 * (h + p * c) + 2] = u[m + 0], g[4 * (h + p * c) + 1] = u[m + 1], g[4 * (h + p * c) + 0] = u[m + 2];
                return g
            }, e._getImageData32bits = function(t, e, n, i, o, r, s, a, l) {
                var h, c, u = n, p = t.width, d = t.height, m = 0, g = new Uint8Array(p * d * 4);
                for (c = i; c !== r; c += o)
                    for (h = s; h !== l; h += a, m += 4)
                        g[4 * (h + p * c) + 2] = u[m + 0], g[4 * (h + p * c) + 1] = u[m + 1], g[4 * (h + p * c) + 0] = u[m + 2], g[4 * (h + p * c) + 3] = u[m + 3];
                return g
            }, e._getImageDataGrey8bits = function(t, e, n, i, o, r, s, a, l) {
                var h, c, u, p = n, d = t.width, m = t.height, g = 0, f = new Uint8Array(d * m * 4);
                for (u = i; u !== r; u += o)
                    for (c = s; c !== l; c += a, g++)
                        h = p[g], f[4 * (c + d * u) + 0] = h, f[4 * (c + d * u) + 1] = h, f[4 * (c + d * u) + 2] = h, f[4 * (c + d * u) + 3] = 255;
                return f
            }, e._getImageDataGrey16bits = function(t, e, n, i, o, r, s, a, l) {
                var h, c, u = n, p = t.width, d = t.height, m = 0, g = new Uint8Array(p * d * 4);
                for (c = i; c !== r; c += o)
                    for (h = s; h !== l; h += a, m += 2)
                        g[4 * (h + p * c) + 0] = u[m + 0], g[4 * (h + p * c) + 1] = u[m + 0], g[4 * (h + p * c) + 2] = u[m + 0], g[4 * (h + p * c) + 3] = u[m + 1];
                return g
            }, e._TYPE_NO_DATA = 0, e._TYPE_INDEXED = 1, e._TYPE_RGB = 2, e._TYPE_GREY = 3, e._TYPE_RLE_INDEXED = 9, e._TYPE_RLE_RGB = 10, e._TYPE_RLE_GREY = 11, e._ORIGIN_MASK = 48, e._ORIGIN_SHIFT = 4, e._ORIGIN_BL = 0, e._ORIGIN_BR = 1, e._ORIGIN_UL = 2, e._ORIGIN_UR = 3, e
        }();
        e.TGATools = n
    }(t.Internals || (t.Internals = {}));
    t.Internals
}(BABYLON || (BABYLON = {}));
var BABYLON;
!function(t) {
    !function(e) {
        function n(t) {
            return t.charCodeAt(0) + (t.charCodeAt(1) << 8) + (t.charCodeAt(2) << 16) + (t.charCodeAt(3) << 24)
        }
        function i(t) {
            return String.fromCharCode(255 & t, t >> 8 & 255, t >> 16 & 255, t >> 24 & 255)
        }
        var o = 542327876, r = 131072, s = 512, a = 4, l = 64, h = 131072, c = n("DXT1"), u = n("DXT3"), p = n("DXT5"), d = 31, m = 0, g = 1, f = 2, y = 3, _ = 4, v = 7, b = 20, w = 21, x = 22, C = 28, M = function() {
            function e() {
            }
            return e.GetDDSInfo = function(t) {
                var e = new Int32Array(t, 0, d), n = 1;
                return e[f] & r && (n = Math.max(1, e[v])), {width: e[_],height: e[y],mipmapCount: n,isFourCC: (e[b] & a) === a,isRGB: (e[b] & l) === l,isLuminance: (e[b] & h) === h,isCube: (e[C] & s) === s}
            }, e.GetRGBAArrayBuffer = function(t, e, n, i, o) {
                for (var r = new Uint8Array(i), s = new Uint8Array(o), a = 0, l = e - 1; l >= 0; l--)
                    for (var h = 0; t > h; h++) {
                        var c = n + 4 * (h + l * t);
                        r[a + 2] = s[c], r[a + 1] = s[c + 1], r[a] = s[c + 2], r[a + 3] = s[c + 3], a += 4
                    }
                return r
            }, e.GetRGBArrayBuffer = function(t, e, n, i, o) {
                for (var r = new Uint8Array(i), s = new Uint8Array(o), a = 0, l = e - 1; l >= 0; l--)
                    for (var h = 0; t > h; h++) {
                        var c = n + 3 * (h + l * t);
                        r[a + 2] = s[c], r[a + 1] = s[c + 1], r[a] = s[c + 2], a += 3
                    }
                return r
            }, e.GetLuminanceArrayBuffer = function(t, e, n, i, o) {
                for (var r = new Uint8Array(i), s = new Uint8Array(o), a = 0, l = e - 1; l >= 0; l--)
                    for (var h = 0; t > h; h++) {
                        var c = n + (h + l * t);
                        r[a] = s[c], a++
                    }
                return r
            }, e.UploadDDSLevels = function(n, s, a, l, h, b) {
                var C, M, D, B, A, E, T, S, L, O, P = new Int32Array(a, 0, d);
                if (P[m] != o)
                    return void t.Tools.Error("Invalid magic number in DDS header");
                if (!l.isFourCC && !l.isRGB && !l.isLuminance)
                    return void t.Tools.Error("Unsupported format, must contain a FourCC, RGB or LUMINANCE code");
                if (l.isFourCC)
                    switch (C = P[w]) {
                        case c:
                            M = 8, D = s.COMPRESSED_RGBA_S3TC_DXT1_EXT;
                            break;
                        case u:
                            M = 16, D = s.COMPRESSED_RGBA_S3TC_DXT3_EXT;
                            break;
                        case p:
                            M = 16, D = s.COMPRESSED_RGBA_S3TC_DXT5_EXT;
                            break;
                        default:
                            return void console.error("Unsupported FourCC code:", i(C))
                    }
                L = 1, P[f] & r && h !== !1 && (L = Math.max(1, P[v]));
                for (var I = P[x], N = 0; b > N; N++) {
                    var R = 1 == b ? n.TEXTURE_2D : n.TEXTURE_CUBE_MAP_POSITIVE_X + N;
                    for (B = P[_], A = P[y], T = P[g] + 4, O = 0; L > O; ++O) {
                        if (l.isRGB)
                            24 == I ? (E = B * A * 3, S = e.GetRGBArrayBuffer(B, A, T, E, a), n.texImage2D(R, O, n.RGB, B, A, 0, n.RGB, n.UNSIGNED_BYTE, S)) : (E = B * A * 4, S = e.GetRGBAArrayBuffer(B, A, T, E, a), n.texImage2D(R, O, n.RGBA, B, A, 0, n.RGBA, n.UNSIGNED_BYTE, S));
                        else if (l.isLuminance) {
                            var k = n.getParameter(n.UNPACK_ALIGNMENT), V = B, F = Math.floor((B + k - 1) / k) * k;
                            E = F * (A - 1) + V, S = e.GetLuminanceArrayBuffer(B, A, T, E, a), n.texImage2D(R, O, n.LUMINANCE, B, A, 0, n.LUMINANCE, n.UNSIGNED_BYTE, S)
                        } else
                            E = Math.max(4, B) / 4 * Math.max(4, A) / 4 * M, S = new Uint8Array(a, T, E), n.compressedTexImage2D(R, O, D, B, A, 0, S);
                        T += E, B *= .5, A *= .5, B = Math.max(1, B), A = Math.max(1, A)
                    }
                }
            }, e
        }();
        e.DDSTools = M
    }(t.Internals || (t.Internals = {}));
    t.Internals
}(BABYLON || (BABYLON = {}));
var BABYLON;
!function(t) {
    var e = function() {
        function t(e) {
            this.length = 0, this._duplicateId = 0, this.data = new Array(e), this._id = t._GlobalId++
        }
        return t.prototype.push = function(t) {
            this.data[this.length++] = t, this.length > this.data.length && (this.data.length *= 2), t.__smartArrayFlags || (t.__smartArrayFlags = {}), t.__smartArrayFlags[this._id] = this._duplicateId
        }, t.prototype.pushNoDuplicate = function(t) {
            t.__smartArrayFlags && t.__smartArrayFlags[this._id] === this._duplicateId || this.push(t)
        }, t.prototype.sort = function(t) {
            this.data.sort(t)
        }, t.prototype.reset = function() {
            this.length = 0, this._duplicateId++
        }, t.prototype.concat = function(t) {
            if (0 !== t.length) {
                this.length + t.length > this.data.length && (this.data.length = 2 * (this.length + t.length));
                for (var e = 0; e < t.length; e++)
                    this.data[this.length++] = (t.data || t)[e]
                    }
        }, t.prototype.concatWithNoDuplicate = function(t) {
            if (0 !== t.length) {
                this.length + t.length > this.data.length && (this.data.length = 2 * (this.length + t.length));
                for (var e = 0; e < t.length; e++) {
                    var n = (t.data || t)[e];
                    this.pushNoDuplicate(n)
                }
            }
        }, t.prototype.indexOf = function(t) {
            var e = this.data.indexOf(t);
            return e >= this.length ? -1 : e
        }, t._GlobalId = 0, t
    }();
    t.SmartArray = e
}(BABYLON || (BABYLON = {}));
var BABYLON;
!function(t) {
    var e, n = 60, i = [], o = 60, r = 0, s = function(e, n) {
        return e ? e instanceof t.Mesh ? null : e instanceof t.SubMesh ? e.clone(n) : e.clone ? e.clone() : null : null
    }, a = function() {
        function a() {
        }
        return a.GetFilename = function(t) {
            var e = t.lastIndexOf("/");
            return 0 > e ? t : t.substring(e + 1)
        }, a.GetDOMTextContent = function(t) {
            for (var e = "", n = t.firstChild; n; )
                3 == n.nodeType && (e += n.textContent), n = n.nextSibling;
            return e
        }, a.ToDegrees = function(t) {
            return 180 * t / Math.PI
        }, a.ToRadians = function(t) {
            return t * Math.PI / 180
        }, a.ExtractMinAndMaxIndexed = function(e, n, i, o) {
            for (var r = new t.Vector3(Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE), s = new t.Vector3(-Number.MAX_VALUE, -Number.MAX_VALUE, -Number.MAX_VALUE), a = i; i + o > a; a++) {
                var l = new t.Vector3(e[3 * n[a]], e[3 * n[a] + 1], e[3 * n[a] + 2]);
                r = t.Vector3.Minimize(l, r), s = t.Vector3.Maximize(l, s)
            }
            return {minimum: r,maximum: s}
        }, a.ExtractMinAndMax = function(e, n, i) {
            for (var o = new t.Vector3(Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE), r = new t.Vector3(-Number.MAX_VALUE, -Number.MAX_VALUE, -Number.MAX_VALUE), s = n; n + i > s; s++) {
                var a = new t.Vector3(e[3 * s], e[3 * s + 1], e[3 * s + 2]);
                o = t.Vector3.Minimize(a, o), r = t.Vector3.Maximize(a, r)
            }
            return {minimum: o,maximum: r}
        }, a.MakeArray = function(t, e) {
            return e === !0 || void 0 !== t && null != t ? Array.isArray(t) ? t : [t] : void 0
        }, a.GetPointerPrefix = function() {
            var t = "pointer";
            return navigator.pointerEnabled || (t = "mouse"), t
        }, a.QueueNewFrame = function(t) {
            window.requestAnimationFrame ? window.requestAnimationFrame(t) : window.msRequestAnimationFrame ? window.msRequestAnimationFrame(t) : window.webkitRequestAnimationFrame ? window.webkitRequestAnimationFrame(t) : window.mozRequestAnimationFrame ? window.mozRequestAnimationFrame(t) : window.oRequestAnimationFrame ? window.oRequestAnimationFrame(t) : window.setTimeout(t, 16)
        }, a.RequestFullscreen = function(t) {
            t.requestFullscreen ? t.requestFullscreen() : t.msRequestFullscreen ? t.msRequestFullscreen() : t.webkitRequestFullscreen ? t.webkitRequestFullscreen() : t.mozRequestFullScreen && t.mozRequestFullScreen()
        }, a.ExitFullscreen = function() {
            document.exitFullscreen ? document.exitFullscreen() : document.mozCancelFullScreen ? document.mozCancelFullScreen() : document.webkitCancelFullScreen ? document.webkitCancelFullScreen() : document.msCancelFullScreen && document.msCancelFullScreen()
        }, a.CleanUrl = function(t) {
            return t = t.replace(/#/gm, "%23")
        }, a.LoadImage = function(e, n, i, o) {
            e = a.CleanUrl(e);
            var r = new Image;
            r.crossOrigin = "anonymous", r.onload = function() {
                n(r)
            }, r.onerror = function(t) {
                i(r, t)
            };
            var s = function() {
                r.src = e
            }, l = function() {
                o.loadImageFromDB(e, r)
            };
            if (o && o.enableTexturesOffline && t.Database.isUASupportingBlobStorage)
                o.openAsync(l, s);
            else if (-1 === e.indexOf("file:"))
                s();
            else
                try {
                    var h, c = e.substring(5);
                    try {
                        h = URL.createObjectURL(t.FilesInput.FilesTextures[c], {oneTimeOnly: !0})
                    } catch (u) {
                        h = URL.createObjectURL(t.FilesInput.FilesTextures[c])
                    }
                    r.src = h
                } catch (p) {
                    a.Log("Error while trying to load texture: " + c), r.src = null
                }
            return r
        }, a.LoadFile = function(e, n, i, o, r) {
            e = a.CleanUrl(e);
            var s = function() {
                var o = new XMLHttpRequest, s = a.BaseUrl + e;
                o.open("GET", s, !0), r && (o.responseType = "arraybuffer"), o.onprogress = i, o.onreadystatechange = function() {
                    if (4 == o.readyState) {
                        if (200 != o.status && !t.Tools.ValidateXHRData(o, r ? 6 : 1))
                            throw new Error("Error status: " + o.status + " - Unable to load " + s);
                        n(r ? o.response : o.responseText)
                    }
                }, o.send(null)
            }, l = function() {
                o.loadFileFromDB(e, n, i, s, r)
            };
            if (-1 !== e.indexOf("file:")) {
                var h = e.substring(5);
                t.Tools.ReadFile(t.FilesInput.FilesToLoad[h], n, i, !0)
            } else
                o && o.enableSceneOffline ? o.openAsync(l, s) : s()
                }, a.ReadFile = function(t, e, n, i) {
                    var o = new FileReader;
                    o.onload = function(t) {
                        e(t.target.result)
                    }, o.onprogress = n, i ? o.readAsArrayBuffer(t) : o.readAsText(t)
                }, a.CheckExtends = function(t, e, n) {
                    t.x < e.x && (e.x = t.x), t.y < e.y && (e.y = t.y), t.z < e.z && (e.z = t.z), t.x > n.x && (n.x = t.x), t.y > n.y && (n.y = t.y), t.z > n.z && (n.z = t.z)
                }, a.WithinEpsilon = function(t, e) {
                    var n = t - e;
                    return n >= -1.401298e-45 && 1.401298e-45 >= n
                }, a.DeepCopy = function(t, e, n, i) {
                    for (var o in t)
                        if (("_" !== o[0] || i && -1 !== i.indexOf(o)) && (!n || -1 === n.indexOf(o))) {
                            var r = t[o], a = typeof r;
                            if ("function" != a)
                                if ("object" == a)
                                    if (r instanceof Array) {
                                        if (e[o] = [], r.length > 0)
                                            if ("object" == typeof r[0])
                                                for (var l = 0; l < r.length; l++) {
                                                    var h = s(r[l], e);
                                                    -1 === e[o].indexOf(h) && e[o].push(h)
                                                }
                                            else
                                                e[o] = r.slice(0)
                                                } else
                                                    e[o] = s(r, e);
                                    else
                                        e[o] = r
                                        }
                }, a.IsEmpty = function(t) {
                    for (var e in t)
                        return !1;
                    return !0
                }, a.RegisterTopRootEvents = function(t) {
                    for (var e = 0; e < t.length; e++) {
                        var n = t[e];
                        window.addEventListener(n.name, n.handler, !1);
                        try {
                            window.parent && window.parent.addEventListener(n.name, n.handler, !1)
                        } catch (i) {
                        }
                    }
                }, a.UnregisterTopRootEvents = function(t) {
                    for (var e = 0; e < t.length; e++) {
                        var n = t[e];
                        window.removeEventListener(n.name, n.handler);
                        try {
                            window.parent && window.parent.removeEventListener(n.name, n.handler)
                        } catch (i) {
                        }
                    }
                }, a.GetFps = function() {
                    return o
                }, a.GetDeltaTime = function() {
                    return r
                }, a._MeasureFps = function() {
                    i.push((new Date).getTime());
                    var t = i.length;
                    if (t >= 2 && (r = i[t - 1] - i[t - 2]), t >= n) {
                        t > n && (i.splice(0, 1), t = i.length);
                        for (var e = 0, s = 0; t - 1 > s; s++)
                            e += i[s + 1] - i[s];
                        o = 1e3 / (e / (t - 1))
                    }
                }, a.CreateScreenshot = function(n, i, o) {
                    var r, s, l = i.getScene(), h = null;
                    if (l.activeCamera !== i && (h = l.activeCamera, l.activeCamera = i), o.precision)
                        r = Math.round(n.getRenderWidth() * o.precision), s = Math.round(r / n.getAspectRatio(i)), o = {width: r,height: s};
                    else if (o.width && o.height)
                        r = o.width, s = o.height;
                    else if (o.width && !o.height)
                        r = o.width, s = Math.round(r / n.getAspectRatio(i)), o = {width: r,height: s};
                    else if (o.height && !o.width)
                        s = o.height, r = Math.round(s * n.getAspectRatio(i)), o = {width: r,height: s};
                    else {
                        if (isNaN(o))
                            return void a.Error("Invalid 'size' parameter !");
                        s = o, r = o
                    }
                    var c = new t.RenderTargetTexture("screenShot", o, n.scenes[0], !1, !1);
                    c.renderList = n.scenes[0].meshes, c.onAfterRender = function() {
                        for (var t = 4 * r, i = s / 2, o = n.readPixels(0, 0, r, s), a = 0; i > a; a++)
                            for (var l = 0; t > l; l++) {
                                var h = l + a * t, c = s - a - 1, u = l + c * t, p = o[h];
                                o[h] = o[u], o[u] = p
                            }
                        e || (e = document.createElement("canvas")), e.width = r, e.height = s;
                        var d = e.getContext("2d"), m = d.createImageData(r, s);
                        m.data.set(o), d.putImageData(m, 0, 0);
                        var g = e.toDataURL();
                        if ("download" in document.createElement("a")) {
                            var f = window.document.createElement("a");
                            f.href = g;
                            var y = new Date, _ = y.getFullYear() + "/" + y.getMonth() + "/" + y.getDate() + "-" + y.getHours() + ":" + y.getMinutes();
                            f.setAttribute("download", "screenshot-" + _ + ".png"), window.document.body.appendChild(f), f.addEventListener("click", function() {
                                                                                                                                            f.parentElement.removeChild(f)
                                                                                                                                            }), f.click()
                        } else {
                            var v = window.open(""), b = v.document.createElement("img");
                            b.src = g, v.document.body.appendChild(b)
                        }
                    }, c.render(!0), c.dispose(), h && (l.activeCamera = h)
                }, a.ValidateXHRData = function(e, n) {
                    "undefined" == typeof n && (n = 7);
                    try {
                        if (1 & n) {
                            if (e.responseText && e.responseText.length > 0)
                                return !0;
                            if (1 === n)
                                return !1
                                }
                        if (2 & n) {
                            var i = t.Internals.TGATools.GetTGAHeader(e.response);
                            if (i.width && i.height && i.width > 0 && i.height > 0)
                                return !0;
                            if (2 === n)
                                return !1
                                }
                        if (4 & n) {
                            var o = new Uint8Array(e.response, 0, 3);
                            return 68 == o[0] && 68 == o[1] && 83 == o[2] ? !0 : !1
                        }
                    } catch (r) {
                    }
                    return !1
                }, Object.defineProperty(a, "NoneLogLevel", {get: function() {
                                         return a._NoneLogLevel
                                         },enumerable: !0,configurable: !0}), Object.defineProperty(a, "MessageLogLevel", {get: function() {
                                                                                                    return a._MessageLogLevel
                                                                                                    },enumerable: !0,configurable: !0}), Object.defineProperty(a, "WarningLogLevel", {get: function() {
                                                                                                                                                               return a._WarningLogLevel
                                                                                                                                                               },enumerable: !0,configurable: !0}), Object.defineProperty(a, "ErrorLogLevel", {get: function() {
                                                                                                                                                                                                                          return a._ErrorLogLevel
                                                                                                                                                                                                                          },enumerable: !0,configurable: !0}), Object.defineProperty(a, "AllLogLevel", {get: function() {
                                                                                                                                                                                                                                                                                     return a._MessageLogLevel | a._WarningLogLevel | a._ErrorLogLevel
                                                                                                                                                                                                                                                                                     },enumerable: !0,configurable: !0}), a._FormatMessage = function(t) {
                    var e = function(t) {
                        return 10 > t ? "0" + t : "" + t
                    }, n = new Date;
                    return "BJS - [" + e(n.getHours()) + ":" + e(n.getMinutes()) + ":" + e(n.getSeconds()) + "]: " + t
                }, a._LogDisabled = function() {
                }, a._LogEnabled = function(t) {
                    console.log(a._FormatMessage(t))
                }, a._WarnDisabled = function() {
                }, a._WarnEnabled = function(t) {
                    console.warn(a._FormatMessage(t))
                }, a._ErrorDisabled = function() {
                }, a._ErrorEnabled = function(t) {
                    console.error(a._FormatMessage(t))
                }, Object.defineProperty(a, "LogLevels", {set: function(t) {
                                         a.Log = (t & a.MessageLogLevel) === a.MessageLogLevel ? a._LogEnabled : a._LogDisabled, a.Warn = (t & a.WarningLogLevel) === a.WarningLogLevel ? a._WarnEnabled : a._WarnDisabled, a.Error = (t & a.ErrorLogLevel) === a.ErrorLogLevel ? a._ErrorEnabled : a._ErrorDisabled
                                         },enumerable: !0,configurable: !0}), a.BaseUrl = "", a._NoneLogLevel = 0, a._MessageLogLevel = 1, a._WarningLogLevel = 2, a._ErrorLogLevel = 4, a.Log = a._LogEnabled, a.Warn = a._WarnEnabled, a.Error = a._ErrorEnabled, a
    }();
    t.Tools = a
}(BABYLON || (BABYLON = {}));
var BABYLON;
!function(t) {
    var e = function(t, e, n, i) {
        var o = t.createShader("vertex" === n ? t.VERTEX_SHADER : t.FRAGMENT_SHADER);
        if (t.shaderSource(o, (i ? i + "\n" : "") + e), t.compileShader(o), !t.getShaderParameter(o, t.COMPILE_STATUS))
            throw new Error(t.getShaderInfoLog(o));
        return o
    }, n = function(e, n, i) {
        var o = i.NEAREST, r = i.NEAREST;
        return e === t.Texture.BILINEAR_SAMPLINGMODE ? (o = i.LINEAR, r = n ? i.LINEAR_MIPMAP_NEAREST : i.LINEAR) : e === t.Texture.TRILINEAR_SAMPLINGMODE ? (o = i.LINEAR, r = n ? i.LINEAR_MIPMAP_LINEAR : i.LINEAR) : e === t.Texture.NEAREST_SAMPLINGMODE && (o = i.NEAREST, r = n ? i.NEAREST_MIPMAP_LINEAR : i.NEAREST), {min: r,mag: o}
    }, i = function(t, e) {
        var n = 1;
        do
            n *= 2;
        while (t > n);
        return n > e && (n = e), n
    }, o = function(e, o, r, s, a, l, h, c, u, p) {
        "undefined" == typeof p && (p = t.Texture.TRILINEAR_SAMPLINGMODE);
        var d = r.getEngine(), m = i(s, d.getCaps().maxTextureSize), g = i(a, d.getCaps().maxTextureSize);
        o.bindTexture(o.TEXTURE_2D, e), o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL, void 0 === l ? 1 : l ? 1 : 0), u(m, g);
        var f = n(p, !h, o);
        o.texParameteri(o.TEXTURE_2D, o.TEXTURE_MAG_FILTER, f.mag), o.texParameteri(o.TEXTURE_2D, o.TEXTURE_MIN_FILTER, f.min), h || c || o.generateMipmap(o.TEXTURE_2D), o.bindTexture(o.TEXTURE_2D, null), d._activeTexturesCache = [], e._baseWidth = s, e._baseHeight = a, e._width = m, e._height = g, e.isReady = !0, r._removePendingData(e)
    }, r = function(e, n, i, o, s, a) {
        var l, h = function() {
            i.push(l), o._removePendingData(l), n != a.length - 1 ? r(e, n + 1, i, o, s, a) : s(i)
        }, c = function() {
            o._removePendingData(l)
        };
        l = t.Tools.LoadImage(e + a[n], h, c, o.database), o._addPendingData(l)
    }, s = function() {
        function t() {
        }
        return t
    }();
    t.EngineCapabilities = s;
    var a = function() {
        function a(t, e, n) {
            var i = this;
            this.isFullscreen = !1, this.isPointerLock = !1, this.forceWireframe = !1, this.cullBackFaces = !0, this.renderEvenInBackground = !0, this.scenes = new Array, this._windowIsBackground = !1, this._runningLoop = !1, this._loadedTexturesCache = new Array, this._activeTexturesCache = new Array, this._compiledEffects = {}, this._depthMask = !1, this._renderingCanvas = t, this._canvasClientRect = this._renderingCanvas.getBoundingClientRect(), n = n || {}, n.antialias = e;
            try {
                this._gl = t.getContext("webgl", n) || t.getContext("experimental-webgl", n)
            } catch (o) {
                throw new Error("WebGL not supported")
            }
            if (!this._gl)
                throw new Error("WebGL not supported");
            this._onBlur = function() {
                i._windowIsBackground = !0
            }, this._onFocus = function() {
                i._windowIsBackground = !1
            }, window.addEventListener("blur", this._onBlur), window.addEventListener("focus", this._onFocus), this._workingCanvas = document.createElement("canvas"), this._workingContext = this._workingCanvas.getContext("2d"), this._hardwareScalingLevel = 1 / (window.devicePixelRatio || 1), this.resize(), this._caps = new s, this._caps.maxTexturesImageUnits = this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS), this._caps.maxTextureSize = this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE), this._caps.maxCubemapTextureSize = this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE), this._caps.maxRenderTextureSize = this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE), this._caps.standardDerivatives = null !== this._gl.getExtension("OES_standard_derivatives"), this._caps.s3tc = this._gl.getExtension("WEBGL_compressed_texture_s3tc"), this._caps.textureFloat = null !== this._gl.getExtension("OES_texture_float"), this._caps.textureAnisotropicFilterExtension = this._gl.getExtension("EXT_texture_filter_anisotropic") || this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic") || this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"), this._caps.maxAnisotropy = this._caps.textureAnisotropicFilterExtension ? this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT) : 0, this._caps.instancedArrays = null, this.setDepthBuffer(!0), this.setDepthFunctionToLessOrEqual(), this.setDepthWrite(!0), this._onFullscreenChange = function() {
                void 0 !== document.fullscreen ? i.isFullscreen = document.fullscreen : void 0 !== document.mozFullScreen ? i.isFullscreen = document.mozFullScreen : void 0 !== document.webkitIsFullScreen ? i.isFullscreen = document.webkitIsFullScreen : void 0 !== document.msIsFullScreen && (i.isFullscreen = document.msIsFullScreen), i.isFullscreen && i._pointerLockRequested && (t.requestPointerLock = t.requestPointerLock || t.msRequestPointerLock || t.mozRequestPointerLock || t.webkitRequestPointerLock, t.requestPointerLock && t.requestPointerLock())
            }, document.addEventListener("fullscreenchange", this._onFullscreenChange, !1), document.addEventListener("mozfullscreenchange", this._onFullscreenChange, !1), document.addEventListener("webkitfullscreenchange", this._onFullscreenChange, !1), document.addEventListener("msfullscreenchange", this._onFullscreenChange, !1), this._onPointerLockChange = function() {
                i.isPointerLock = document.mozPointerLockElement === t || document.webkitPointerLockElement === t || document.msPointerLockElement === t || document.pointerLockElement === t
            }, document.addEventListener("pointerlockchange", this._onPointerLockChange, !1), document.addEventListener("mspointerlockchange", this._onPointerLockChange, !1), document.addEventListener("mozpointerlockchange", this._onPointerLockChange, !1), document.addEventListener("webkitpointerlockchange", this._onPointerLockChange, !1)
        }
        return Object.defineProperty(a, "ALPHA_DISABLE", {get: function() {
                                     return a._ALPHA_DISABLE
                                     },enumerable: !0,configurable: !0}), Object.defineProperty(a, "ALPHA_ADD", {get: function() {
                                                                                                return a._ALPHA_ADD
                                                                                                },enumerable: !0,configurable: !0}), Object.defineProperty(a, "ALPHA_COMBINE", {get: function() {
                                                                                                                                                           return a._ALPHA_COMBINE
                                                                                                                                                           },enumerable: !0,configurable: !0}), Object.defineProperty(a, "DELAYLOADSTATE_NONE", {get: function() {
                                                                                                                                                                                                                      return a._DELAYLOADSTATE_NONE
                                                                                                                                                                                                                      },enumerable: !0,configurable: !0}), Object.defineProperty(a, "DELAYLOADSTATE_LOADED", {get: function() {
                                                                                                                                                                                                                                                                                 return a._DELAYLOADSTATE_LOADED
                                                                                                                                                                                                                                                                                 },enumerable: !0,configurable: !0}), Object.defineProperty(a, "DELAYLOADSTATE_LOADING", {get: function() {
                                                                                                                                                                                                                                                                                                                                            return a._DELAYLOADSTATE_LOADING
                                                                                                                                                                                                                                                                                                                                            },enumerable: !0,configurable: !0}), Object.defineProperty(a, "DELAYLOADSTATE_NOTLOADED", {get: function() {
                                                                                                                                                                                                                                                                                                                                                                                                       return a._DELAYLOADSTATE_NOTLOADED
                                                                                                                                                                                                                                                                                                                                                                                                       },enumerable: !0,configurable: !0}), Object.defineProperty(a, "Version", {get: function() {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                  return "1.13.0"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                  },enumerable: !0,configurable: !0}), a.prototype.getAspectRatio = function(t) {
            var e = t.viewport;
            return this.getRenderWidth() * e.width / (this.getRenderHeight() * e.height)
        }, a.prototype.getRenderWidth = function() {
            return this._currentRenderTarget ? this._currentRenderTarget._width : this._renderingCanvas.width
        }, a.prototype.getRenderHeight = function() {
            return this._currentRenderTarget ? this._currentRenderTarget._height : this._renderingCanvas.height
        }, a.prototype.getRenderingCanvas = function() {
            return this._renderingCanvas
        }, a.prototype.getRenderingCanvasClientRect = function() {
            return this._renderingCanvas.getBoundingClientRect()
        }, a.prototype.setHardwareScalingLevel = function(t) {
            this._hardwareScalingLevel = t, this.resize()
        }, a.prototype.getHardwareScalingLevel = function() {
            return this._hardwareScalingLevel
        }, a.prototype.getLoadedTexturesCache = function() {
            return this._loadedTexturesCache
        }, a.prototype.getCaps = function() {
            return this._caps
        }, a.prototype.setDepthFunctionToGreater = function() {
            this._gl.depthFunc(this._gl.GREATER)
        }, a.prototype.setDepthFunctionToGreaterOrEqual = function() {
            this._gl.depthFunc(this._gl.GEQUAL)
        }, a.prototype.setDepthFunctionToLess = function() {
            this._gl.depthFunc(this._gl.LESS)
        }, a.prototype.setDepthFunctionToLessOrEqual = function() {
            this._gl.depthFunc(this._gl.LEQUAL)
        }, a.prototype.stopRenderLoop = function() {
            this._renderFunction = null, this._runningLoop = !1
        }, a.prototype._renderLoop = function() {
            var e = this, n = !0;
            !this.renderEvenInBackground && this._windowIsBackground && (n = !1), n && (this.beginFrame(), this._renderFunction && this._renderFunction(), this.endFrame()), this._runningLoop && t.Tools.QueueNewFrame(function() {
                                                                                                                                                                                                                        e._renderLoop()
                                                                                                                                                                                                                        })
        }, a.prototype.runRenderLoop = function(e) {
            var n = this;
            this._runningLoop = !0, this._renderFunction = e, t.Tools.QueueNewFrame(function() {
                                                                                    n._renderLoop()
                                                                                    })
        }, a.prototype.switchFullscreen = function(e) {
            this.isFullscreen ? t.Tools.ExitFullscreen() : (this._pointerLockRequested = e, t.Tools.RequestFullscreen(this._renderingCanvas))
        }, a.prototype.clear = function(t, e, n) {
            this._gl.clearColor(t.r, t.g, t.b, void 0 !== t.a ? t.a : 1), this._depthMask && this._gl.clearDepth(1);
            var i = 0;
            e && (i |= this._gl.COLOR_BUFFER_BIT), n && this._depthMask && (i |= this._gl.DEPTH_BUFFER_BIT), this._gl.clear(i)
        }, a.prototype.setViewport = function(t, e, n) {
            var i = e || this._renderingCanvas.width, o = n || this._renderingCanvas.height, r = t.x || 0, s = t.y || 0;
            this._cachedViewport = t, this._gl.viewport(r * i, s * o, i * t.width, o * t.height)
        }, a.prototype.setDirectViewport = function(t, e, n, i) {
            this._cachedViewport = null, this._gl.viewport(t, e, n, i)
        }, a.prototype.beginFrame = function() {
            t.Tools._MeasureFps()
        }, a.prototype.endFrame = function() {
            this.flushFramebuffer()
        }, a.prototype.resize = function() {
            this._renderingCanvas.width = this._renderingCanvas.clientWidth / this._hardwareScalingLevel, this._renderingCanvas.height = this._renderingCanvas.clientHeight / this._hardwareScalingLevel, this._canvasClientRect = this._renderingCanvas.getBoundingClientRect()
        }, a.prototype.bindFramebuffer = function(t) {
            this._currentRenderTarget = t;
            var e = this._gl;
            e.bindFramebuffer(e.FRAMEBUFFER, t._framebuffer), this._gl.viewport(0, 0, t._width, t._height), this.wipeCaches()
        }, a.prototype.unBindFramebuffer = function(t) {
            if (this._currentRenderTarget = null, t.generateMipMaps) {
                var e = this._gl;
                e.bindTexture(e.TEXTURE_2D, t), e.generateMipmap(e.TEXTURE_2D), e.bindTexture(e.TEXTURE_2D, null)
            }
            this._gl.bindFramebuffer(this._gl.FRAMEBUFFER, null)
        }, a.prototype.flushFramebuffer = function() {
            this._gl.flush()
        }, a.prototype.restoreDefaultFramebuffer = function() {
            this._gl.bindFramebuffer(this._gl.FRAMEBUFFER, null), this.setViewport(this._cachedViewport), this.wipeCaches()
        }, a.prototype._resetVertexBufferBinding = function() {
            this._gl.bindBuffer(this._gl.ARRAY_BUFFER, null), this._cachedVertexBuffers = null
        }, a.prototype.createVertexBuffer = function(t) {
            var e = this._gl.createBuffer();
            return this._gl.bindBuffer(this._gl.ARRAY_BUFFER, e), this._gl.bufferData(this._gl.ARRAY_BUFFER, new Float32Array(t), this._gl.STATIC_DRAW), this._resetVertexBufferBinding(), e.references = 1, e
        }, a.prototype.createDynamicVertexBuffer = function(t) {
            var e = this._gl.createBuffer();
            return this._gl.bindBuffer(this._gl.ARRAY_BUFFER, e), this._gl.bufferData(this._gl.ARRAY_BUFFER, t, this._gl.DYNAMIC_DRAW), this._resetVertexBufferBinding(), e.references = 1, e
        }, a.prototype.updateDynamicVertexBuffer = function(t, e) {
            this._gl.bindBuffer(this._gl.ARRAY_BUFFER, t), e instanceof Float32Array ? this._gl.bufferSubData(this._gl.ARRAY_BUFFER, 0, e) : this._gl.bufferSubData(this._gl.ARRAY_BUFFER, 0, new Float32Array(e)), this._resetVertexBufferBinding()
        }, a.prototype._resetIndexBufferBinding = function() {
            this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER, null), this._cachedIndexBuffer = null
        }, a.prototype.createIndexBuffer = function(t) {
            var e = this._gl.createBuffer();
            return this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER, e), this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER, new Uint16Array(t), this._gl.STATIC_DRAW), this._resetIndexBufferBinding(), e.references = 1, e
        }, a.prototype.bindBuffers = function(t, e, n, i, o) {
            if (this._cachedVertexBuffers !== t || this._cachedEffectForVertexBuffers !== o) {
                this._cachedVertexBuffers = t, this._cachedEffectForVertexBuffers = o, this._gl.bindBuffer(this._gl.ARRAY_BUFFER, t);
                for (var r = 0, s = 0; s < n.length; s++) {
                    var a = o.getAttributeLocation(s);
                    a >= 0 && this._gl.vertexAttribPointer(a, n[s], this._gl.FLOAT, !1, i, r), r += 4 * n[s]
                }
            }
            this._cachedIndexBuffer !== e && (this._cachedIndexBuffer = e, this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER, e))
        }, a.prototype.bindMultiBuffers = function(t, e, n) {
            if (this._cachedVertexBuffers !== t || this._cachedEffectForVertexBuffers !== n) {
                this._cachedVertexBuffers = t, this._cachedEffectForVertexBuffers = n;
                for (var i = n.getAttributesNames(), o = 0; o < i.length; o++) {
                    var r = n.getAttributeLocation(o);
                    if (r >= 0) {
                        var s = t[i[o]];
                        if (!s)
                            continue;
                        var a = s.getStrideSize();
                        this._gl.bindBuffer(this._gl.ARRAY_BUFFER, s.getBuffer()), this._gl.vertexAttribPointer(r, a, this._gl.FLOAT, !1, 4 * a, 0)
                    }
                }
            }
            this._cachedIndexBuffer !== e && (this._cachedIndexBuffer = e, this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER, e))
        }, a.prototype._releaseBuffer = function(t) {
            return t.references--, 0 === t.references ? (this._gl.deleteBuffer(t), !0) : !1
        }, a.prototype.createInstancesBuffer = function(t) {
            var e = this._gl.createBuffer();
            return e.capacity = t, this._gl.bindBuffer(this._gl.ARRAY_BUFFER, e), this._gl.bufferData(this._gl.ARRAY_BUFFER, t, this._gl.DYNAMIC_DRAW), e
        }, a.prototype.deleteInstancesBuffer = function(t) {
            this._gl.deleteBuffer(t)
        }, a.prototype.updateAndBindInstancesBuffer = function(t, e, n) {
            this._gl.bindBuffer(this._gl.ARRAY_BUFFER, t), this._gl.bufferSubData(this._gl.ARRAY_BUFFER, 0, e);
            for (var i = 0; 4 > i; i++) {
                var o = n[i];
                this._gl.enableVertexAttribArray(o), this._gl.vertexAttribPointer(o, 4, this._gl.FLOAT, !1, 64, 16 * i), this._caps.instancedArrays.vertexAttribDivisorANGLE(o, 1)
            }
        }, a.prototype.unBindInstancesBuffer = function(t, e) {
            this._gl.bindBuffer(this._gl.ARRAY_BUFFER, t);
            for (var n = 0; 4 > n; n++) {
                var i = e[n];
                this._gl.disableVertexAttribArray(i), this._caps.instancedArrays.vertexAttribDivisorANGLE(i, 0)
            }
        }, a.prototype.draw = function(t, e, n, i) {
            return i ? void this._caps.instancedArrays.drawElementsInstancedANGLE(t ? this._gl.TRIANGLES : this._gl.LINES, n, this._gl.UNSIGNED_SHORT, 2 * e, i) : void this._gl.drawElements(t ? this._gl.TRIANGLES : this._gl.LINES, n, this._gl.UNSIGNED_SHORT, 2 * e)
        }, a.prototype._releaseEffect = function(t) {
            this._compiledEffects[t._key] && (delete this._compiledEffects[t._key], t.getProgram() && this._gl.deleteProgram(t.getProgram()))
        }, a.prototype.createEffect = function(e, n, i, o, r, s, a, l) {
            var h = e.vertexElement || e.vertex || e, c = e.fragmentElement || e.fragment || e, u = h + "+" + c + "@" + r;
            if (this._compiledEffects[u])
                return this._compiledEffects[u];
            var p = new t.Effect(e, n, i, o, this, r, s, a, l);
            return p._key = u, this._compiledEffects[u] = p, p
        }, a.prototype.createShaderProgram = function(t, n, i) {
            var o = e(this._gl, t, "vertex", i), r = e(this._gl, n, "fragment", i), s = this._gl.createProgram();
            this._gl.attachShader(s, o), this._gl.attachShader(s, r), this._gl.linkProgram(s);
            var a = this._gl.getProgramParameter(s, this._gl.LINK_STATUS);
            if (!a) {
                var l = this._gl.getProgramInfoLog(s);
                if (l)
                    throw new Error(l)
                    }
            return this._gl.deleteShader(o), this._gl.deleteShader(r), s
        }, a.prototype.getUniforms = function(t, e) {
            for (var n = [], i = 0; i < e.length; i++)
                n.push(this._gl.getUniformLocation(t, e[i]));
            return n
        }, a.prototype.getAttributes = function(t, e) {
            for (var n = [], i = 0; i < e.length; i++)
                try {
                    n.push(this._gl.getAttribLocation(t, e[i]))
                } catch (o) {
                    n.push(-1)
                }
            return n
        }, a.prototype.enableEffect = function(t) {
            if (!t || !t.getAttributesCount() || this._currentEffect === t)
                return !1;
            this._vertexAttribArrays = this._vertexAttribArrays || [], this._gl.useProgram(t.getProgram());
            for (var e in this._vertexAttribArrays)
                e > this._gl.VERTEX_ATTRIB_ARRAY_ENABLED || !this._vertexAttribArrays[e] || (this._vertexAttribArrays[e] = !1, this._gl.disableVertexAttribArray(e));
            for (var n = t.getAttributesCount(), i = 0; n > i; i++) {
                var o = t.getAttributeLocation(i);
                o >= 0 && (this._vertexAttribArrays[o] = !0, this._gl.enableVertexAttribArray(o))
            }
            return this._currentEffect = t, !0
        }, a.prototype.setArray = function(t, e) {
            t && this._gl.uniform1fv(t, e)
        }, a.prototype.setMatrices = function(t, e) {
            t && this._gl.uniformMatrix4fv(t, !1, e)
        }, a.prototype.setMatrix = function(t, e) {
            t && this._gl.uniformMatrix4fv(t, !1, e.toArray())
        }, a.prototype.setFloat = function(t, e) {
            t && this._gl.uniform1f(t, e)
        }, a.prototype.setFloat2 = function(t, e, n) {
            t && this._gl.uniform2f(t, e, n)
        }, a.prototype.setFloat3 = function(t, e, n, i) {
            t && this._gl.uniform3f(t, e, n, i)
        }, a.prototype.setBool = function(t, e) {
            t && this._gl.uniform1i(t, e)
        }, a.prototype.setFloat4 = function(t, e, n, i, o) {
            t && this._gl.uniform4f(t, e, n, i, o)
        }, a.prototype.setColor3 = function(t, e) {
            t && this._gl.uniform3f(t, e.r, e.g, e.b)
        }, a.prototype.setColor4 = function(t, e, n) {
            t && this._gl.uniform4f(t, e.r, e.g, e.b, n)
        }, a.prototype.setState = function(t) {
            this._cullingState !== t && (t ? (this._gl.cullFace(this.cullBackFaces ? this._gl.BACK : this._gl.FRONT), this._gl.enable(this._gl.CULL_FACE)) : this._gl.disable(this._gl.CULL_FACE), this._cullingState = t)
        }, a.prototype.setDepthBuffer = function(t) {
            t ? this._gl.enable(this._gl.DEPTH_TEST) : this._gl.disable(this._gl.DEPTH_TEST)
        }, a.prototype.setDepthWrite = function(t) {
            this._gl.depthMask(t), this._depthMask = t
        }, a.prototype.setColorWrite = function(t) {
            this._gl.colorMask(t, t, t, t)
        }, a.prototype.setAlphaMode = function(e) {
            switch (e) {
                case t.Engine.ALPHA_DISABLE:
                    this.setDepthWrite(!0), this._gl.disable(this._gl.BLEND);
                    break;
                case t.Engine.ALPHA_COMBINE:
                    this.setDepthWrite(!1), this._gl.blendFuncSeparate(this._gl.SRC_ALPHA, this._gl.ONE_MINUS_SRC_ALPHA, this._gl.ONE, this._gl.ONE), this._gl.enable(this._gl.BLEND);
                    break;
                case t.Engine.ALPHA_ADD:
                    this.setDepthWrite(!1), this._gl.blendFuncSeparate(this._gl.ONE, this._gl.ONE, this._gl.ZERO, this._gl.ONE), this._gl.enable(this._gl.BLEND)
            }
        }, a.prototype.setAlphaTesting = function(t) {
            this._alphaTest = t
        }, a.prototype.getAlphaTesting = function() {
            return this._alphaTest
        }, a.prototype.wipeCaches = function() {
            this._activeTexturesCache = [], this._currentEffect = null, this._cullingState = null, this._cachedVertexBuffers = null, this._cachedIndexBuffer = null, this._cachedEffectForVertexBuffers = null
        }, a.prototype.setSamplingMode = function(e, n) {
            var i = this._gl;
            i.bindTexture(i.TEXTURE_2D, e);
            var o = i.NEAREST, r = i.NEAREST;
            n === t.Texture.BILINEAR_SAMPLINGMODE ? (o = i.LINEAR, r = i.LINEAR) : n === t.Texture.TRILINEAR_SAMPLINGMODE && (o = i.LINEAR, r = i.LINEAR_MIPMAP_LINEAR), i.texParameteri(i.TEXTURE_2D, i.TEXTURE_MAG_FILTER, o), i.texParameteri(i.TEXTURE_2D, i.TEXTURE_MIN_FILTER, r), i.bindTexture(i.TEXTURE_2D, null)
        }, a.prototype.createTexture = function(e, n, i, r, s) {
            var a = this;
            "undefined" == typeof s && (s = t.Texture.TRILINEAR_SAMPLINGMODE);
            var l = this._gl.createTexture(), h = e.substr(e.length - 4, 4).toLowerCase(), c = this.getCaps().s3tc && ".dds" === h, u = ".tga" === h;
            if (r._addPendingData(l), l.url = e, l.noMipmap = n, l.references = 1, this._loadedTexturesCache.push(l), u)
                t.Tools.LoadFile(e, function(e) {
                                 var h = new Uint8Array(e), c = t.Internals.TGATools.GetTGAHeader(h);
                                 o(l, a._gl, r, c.width, c.height, i, n, !1, function() {
                                   t.Internals.TGATools.UploadContent(a._gl, h)
                                   }, s)
                                 }, null, r.database, !0);
            else if (c)
                t.Tools.LoadFile(e, function(h) {
                                 var c = t.Internals.DDSTools.GetDDSInfo(h), u = (c.isRGB || c.isLuminance || c.mipmapCount > 1) && !n && c.width >> c.mipmapCount - 1 == 1;
                                 o(l, a._gl, r, c.width, c.height, i, !u, c.isFourCC, function() {
                                   console.log("loading " + e), t.Internals.DDSTools.UploadDDSLevels(a._gl, a.getCaps().s3tc, h, c, u, 1)
                                   }, s)
                                 }, null, r.database, !0);
            else {
                var p = function(t) {
                    o(l, a._gl, r, t.width, t.height, i, n, !1, function(e, n) {
                      var i = t.width == e && t.height == n;
                      i || (a._workingCanvas.width = e, a._workingCanvas.height = n, a._workingContext.drawImage(t, 0, 0, t.width, t.height, 0, 0, e, n)), a._gl.texImage2D(a._gl.TEXTURE_2D, 0, a._gl.RGBA, a._gl.RGBA, a._gl.UNSIGNED_BYTE, i ? t : a._workingCanvas)
                      }, s)
                }, d = function() {
                    r._removePendingData(l)
                };
                t.Tools.LoadImage(e, p, d, r.database)
            }
            return l
        }, a.prototype.createDynamicTexture = function(t, e, o, r) {
            var s = this._gl.createTexture();
            t = i(t, this._caps.maxTextureSize), e = i(e, this._caps.maxTextureSize), this._gl.bindTexture(this._gl.TEXTURE_2D, s);
            var a = n(r, o, this._gl);
            return this._gl.texParameteri(this._gl.TEXTURE_2D, this._gl.TEXTURE_MAG_FILTER, a.mag), this._gl.texParameteri(this._gl.TEXTURE_2D, this._gl.TEXTURE_MIN_FILTER, a.min), this._gl.bindTexture(this._gl.TEXTURE_2D, null), this._activeTexturesCache = [], s._baseWidth = t, s._baseHeight = e, s._width = t, s._height = e, s.isReady = !1, s.generateMipMaps = o, s.references = 1, this._loadedTexturesCache.push(s), s
        }, a.prototype.updateDynamicTexture = function(t, e, n) {
            this._gl.bindTexture(this._gl.TEXTURE_2D, t), this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL, n ? 1 : 0), this._gl.texImage2D(this._gl.TEXTURE_2D, 0, this._gl.RGBA, this._gl.RGBA, this._gl.UNSIGNED_BYTE, e), t.generateMipMaps && this._gl.generateMipmap(this._gl.TEXTURE_2D), this._gl.bindTexture(this._gl.TEXTURE_2D, null), this._activeTexturesCache = [], t.isReady = !0
        }, a.prototype.updateVideoTexture = function(t, e, n) {
            this._gl.bindTexture(this._gl.TEXTURE_2D, t), this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL, n ? 0 : 1), e.videoWidth !== t._width || e.videoHeight !== t._height ? (t._workingCanvas || (t._workingCanvas = document.createElement("canvas"), t._workingContext = t._workingCanvas.getContext("2d"), t._workingCanvas.width = t._width, t._workingCanvas.height = t._height), t._workingContext.drawImage(e, 0, 0, e.videoWidth, e.videoHeight, 0, 0, t._width, t._height), this._gl.texImage2D(this._gl.TEXTURE_2D, 0, this._gl.RGBA, this._gl.RGBA, this._gl.UNSIGNED_BYTE, t._workingCanvas)) : this._gl.texImage2D(this._gl.TEXTURE_2D, 0, this._gl.RGBA, this._gl.RGBA, this._gl.UNSIGNED_BYTE, e), t.generateMipMaps && this._gl.generateMipmap(this._gl.TEXTURE_2D), this._gl.bindTexture(this._gl.TEXTURE_2D, null), this._activeTexturesCache = [], t.isReady = !0
        }, a.prototype.createRenderTargetTexture = function(e, i) {
            var o = !1, r = !0, s = t.Texture.TRILINEAR_SAMPLINGMODE;
            void 0 !== i && (o = void 0 === i.generateMipMaps ? i : i.generateMipmaps, r = void 0 === i.generateDepthBuffer ? !0 : i.generateDepthBuffer, void 0 !== i.samplingMode && (s = i.samplingMode));
            var a = this._gl, l = a.createTexture();
            a.bindTexture(a.TEXTURE_2D, l);
            var h = e.width || e, c = e.height || e, u = n(s, o, a);
            a.texParameteri(a.TEXTURE_2D, a.TEXTURE_MAG_FILTER, u.mag), a.texParameteri(a.TEXTURE_2D, a.TEXTURE_MIN_FILTER, u.min), a.texParameteri(a.TEXTURE_2D, a.TEXTURE_WRAP_S, a.CLAMP_TO_EDGE), a.texParameteri(a.TEXTURE_2D, a.TEXTURE_WRAP_T, a.CLAMP_TO_EDGE), a.texImage2D(a.TEXTURE_2D, 0, a.RGBA, h, c, 0, a.RGBA, a.UNSIGNED_BYTE, null);
            var p;
            r && (p = a.createRenderbuffer(), a.bindRenderbuffer(a.RENDERBUFFER, p), a.renderbufferStorage(a.RENDERBUFFER, a.DEPTH_COMPONENT16, h, c));
            var d = a.createFramebuffer();
            return a.bindFramebuffer(a.FRAMEBUFFER, d), a.framebufferTexture2D(a.FRAMEBUFFER, a.COLOR_ATTACHMENT0, a.TEXTURE_2D, l, 0), r && a.framebufferRenderbuffer(a.FRAMEBUFFER, a.DEPTH_ATTACHMENT, a.RENDERBUFFER, p), a.bindTexture(a.TEXTURE_2D, null), a.bindRenderbuffer(a.RENDERBUFFER, null), a.bindFramebuffer(a.FRAMEBUFFER, null), l._framebuffer = d, r && (l._depthBuffer = p), l._width = h, l._height = c, l.isReady = !0, l.generateMipMaps = o, l.references = 1, this._activeTexturesCache = [], this._loadedTexturesCache.push(l), l
        }, a.prototype.createCubeTexture = function(e, n, o, s) {
            var a = this, l = this._gl, h = l.createTexture();
            h.isCube = !0, h.url = e, h.references = 1, this._loadedTexturesCache.push(h);
            var c = e.substr(e.length - 4, 4).toLowerCase(), u = this.getCaps().s3tc && ".dds" === c;
            return u ? t.Tools.LoadFile(e, function(e) {
                                        var n = t.Internals.DDSTools.GetDDSInfo(e), i = (n.isRGB || n.isLuminance || n.mipmapCount > 1) && !s;
                                        l.bindTexture(l.TEXTURE_CUBE_MAP, h), l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL, 1), t.Internals.DDSTools.UploadDDSLevels(a._gl, a.getCaps().s3tc, e, n, i, 6), s || n.isFourCC || 1 != n.mipmapCount || l.generateMipmap(l.TEXTURE_CUBE_MAP), l.texParameteri(l.TEXTURE_CUBE_MAP, l.TEXTURE_MAG_FILTER, l.LINEAR), l.texParameteri(l.TEXTURE_CUBE_MAP, l.TEXTURE_MIN_FILTER, i ? l.LINEAR_MIPMAP_LINEAR : l.LINEAR), l.texParameteri(l.TEXTURE_CUBE_MAP, l.TEXTURE_WRAP_S, l.CLAMP_TO_EDGE), l.texParameteri(l.TEXTURE_CUBE_MAP, l.TEXTURE_WRAP_T, l.CLAMP_TO_EDGE), l.bindTexture(l.TEXTURE_CUBE_MAP, null), a._activeTexturesCache = [], h._width = n.width, h._height = n.height, h.isReady = !0
                                        }) : r(e, 0, [], n, function(t) {
                                               var e = i(t[0].width, a._caps.maxCubemapTextureSize), n = e;
                                               a._workingCanvas.width = e, a._workingCanvas.height = n;
                                               var o = [l.TEXTURE_CUBE_MAP_POSITIVE_X, l.TEXTURE_CUBE_MAP_POSITIVE_Y, l.TEXTURE_CUBE_MAP_POSITIVE_Z, l.TEXTURE_CUBE_MAP_NEGATIVE_X, l.TEXTURE_CUBE_MAP_NEGATIVE_Y, l.TEXTURE_CUBE_MAP_NEGATIVE_Z];
                                               l.bindTexture(l.TEXTURE_CUBE_MAP, h), l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL, 0);
                                               for (var r = 0; r < o.length; r++)
                                               a._workingContext.drawImage(t[r], 0, 0, t[r].width, t[r].height, 0, 0, e, n), l.texImage2D(o[r], 0, l.RGBA, l.RGBA, l.UNSIGNED_BYTE, a._workingCanvas);
                                               s || l.generateMipmap(l.TEXTURE_CUBE_MAP), l.texParameteri(l.TEXTURE_CUBE_MAP, l.TEXTURE_MAG_FILTER, l.LINEAR), l.texParameteri(l.TEXTURE_CUBE_MAP, l.TEXTURE_MIN_FILTER, s ? l.LINEAR : l.LINEAR_MIPMAP_LINEAR), l.texParameteri(l.TEXTURE_CUBE_MAP, l.TEXTURE_WRAP_S, l.CLAMP_TO_EDGE), l.texParameteri(l.TEXTURE_CUBE_MAP, l.TEXTURE_WRAP_T, l.CLAMP_TO_EDGE), l.bindTexture(l.TEXTURE_CUBE_MAP, null), a._activeTexturesCache = [], h._width = e, h._height = n, h.isReady = !0
                                               }, o), h
        }, a.prototype._releaseTexture = function(t) {
            var e = this._gl;
            t._framebuffer && e.deleteFramebuffer(t._framebuffer), t._depthBuffer && e.deleteRenderbuffer(t._depthBuffer), e.deleteTexture(t);
            for (var n = 0; n < this._caps.maxTexturesImageUnits; n++)
                this._gl.activeTexture(this._gl["TEXTURE" + n]), this._gl.bindTexture(this._gl.TEXTURE_2D, null), this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP, null), this._activeTexturesCache[n] = null;
            var i = this._loadedTexturesCache.indexOf(t);
            -1 !== i && this._loadedTexturesCache.splice(i, 1)
        }, a.prototype.bindSamplers = function(t) {
            this._gl.useProgram(t.getProgram());
            for (var e = t.getSamplers(), n = 0; n < e.length; n++) {
                var i = t.getUniform(e[n]);
                this._gl.uniform1i(i, n)
            }
            this._currentEffect = null
        }, a.prototype._bindTexture = function(t, e) {
            this._gl.activeTexture(this._gl["TEXTURE" + t]), this._gl.bindTexture(this._gl.TEXTURE_2D, e), this._activeTexturesCache[t] = null
        }, a.prototype.setTextureFromPostProcess = function(t, e) {
            this._bindTexture(t, e._textures.data[e._currentRenderTextureInd])
        }, a.prototype.setTexture = function(e, n) {
            if (!(0 > e)) {
                if (!n || !n.isReady())
                    return void (null != this._activeTexturesCache[e] && (this._gl.activeTexture(this._gl["TEXTURE" + e]), this._gl.bindTexture(this._gl.TEXTURE_2D, null), this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP, null), this._activeTexturesCache[e] = null));
                if (n instanceof t.VideoTexture)
                    n.update() && (this._activeTexturesCache[e] = null);
                else if (n.delayLoadState == t.Engine.DELAYLOADSTATE_NOTLOADED)
                    return void n.delayLoad();
                if (this._activeTexturesCache[e] != n) {
                    this._activeTexturesCache[e] = n;
                    var i = n.getInternalTexture();
                    if (this._gl.activeTexture(this._gl["TEXTURE" + e]), i.isCube) {
                        if (this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP, i), i._cachedCoordinatesMode !== n.coordinatesMode) {
                            i._cachedCoordinatesMode = n.coordinatesMode;
                            var o = n.coordinatesMode !== t.Texture.CUBIC_MODE && n.coordinatesMode !== t.Texture.SKYBOX_MODE ? this._gl.REPEAT : this._gl.CLAMP_TO_EDGE;
                            this._gl.texParameteri(this._gl.TEXTURE_CUBE_MAP, this._gl.TEXTURE_WRAP_S, o), this._gl.texParameteri(this._gl.TEXTURE_CUBE_MAP, this._gl.TEXTURE_WRAP_T, o)
                        }
                        this._setAnisotropicLevel(this._gl.TEXTURE_CUBE_MAP, n)
                    } else {
                        if (this._gl.bindTexture(this._gl.TEXTURE_2D, i), i._cachedWrapU !== n.wrapU)
                            switch (i._cachedWrapU = n.wrapU, n.wrapU) {
                                case t.Texture.WRAP_ADDRESSMODE:
                                    this._gl.texParameteri(this._gl.TEXTURE_2D, this._gl.TEXTURE_WRAP_S, this._gl.REPEAT);
                                    break;
                                case t.Texture.CLAMP_ADDRESSMODE:
                                    this._gl.texParameteri(this._gl.TEXTURE_2D, this._gl.TEXTURE_WRAP_S, this._gl.CLAMP_TO_EDGE);
                                    break;
                                case t.Texture.MIRROR_ADDRESSMODE:
                                    this._gl.texParameteri(this._gl.TEXTURE_2D, this._gl.TEXTURE_WRAP_S, this._gl.MIRRORED_REPEAT)
                            }
                        if (i._cachedWrapV !== n.wrapV)
                            switch (i._cachedWrapV = n.wrapV, n.wrapV) {
                                case t.Texture.WRAP_ADDRESSMODE:
                                    this._gl.texParameteri(this._gl.TEXTURE_2D, this._gl.TEXTURE_WRAP_T, this._gl.REPEAT);
                                    break;
                                case t.Texture.CLAMP_ADDRESSMODE:
                                    this._gl.texParameteri(this._gl.TEXTURE_2D, this._gl.TEXTURE_WRAP_T, this._gl.CLAMP_TO_EDGE);
                                    break;
                                case t.Texture.MIRROR_ADDRESSMODE:
                                    this._gl.texParameteri(this._gl.TEXTURE_2D, this._gl.TEXTURE_WRAP_T, this._gl.MIRRORED_REPEAT)
                            }
                        this._setAnisotropicLevel(this._gl.TEXTURE_2D, n)
                    }
                }
            }
        }, a.prototype._setAnisotropicLevel = function(t, e) {
            var n = this._caps.textureAnisotropicFilterExtension;
            n && e._cachedAnisotropicFilteringLevel !== e.anisotropicFilteringLevel && (this._gl.texParameterf(t, n.TEXTURE_MAX_ANISOTROPY_EXT, Math.min(e.anisotropicFilteringLevel, this._caps.maxAnisotropy)), e._cachedAnisotropicFilteringLevel = e.anisotropicFilteringLevel)
        }, a.prototype.readPixels = function(t, e, n, i) {
            var o = new Uint8Array(i * n * 4);
            return this._gl.readPixels(0, 0, n, i, this._gl.RGBA, this._gl.UNSIGNED_BYTE, o), o
        }, a.prototype.dispose = function() {
            for (this.stopRenderLoop(); this.scenes.length; )
                this.scenes[0].dispose();
            for (var t in this._compiledEffects)
                this._gl.deleteProgram(this._compiledEffects[t]._program);
            for (var e in this._vertexAttribArrays)
                e > this._gl.VERTEX_ATTRIB_ARRAY_ENABLED || !this._vertexAttribArrays[e] || this._gl.disableVertexAttribArray(e);
            window.removeEventListener("blur", this._onBlur), window.removeEventListener("focus", this._onFocus), document.removeEventListener("fullscreenchange", this._onFullscreenChange), document.removeEventListener("mozfullscreenchange", this._onFullscreenChange), document.removeEventListener("webkitfullscreenchange", this._onFullscreenChange), document.removeEventListener("msfullscreenchange", this._onFullscreenChange), document.removeEventListener("pointerlockchange", this._onPointerLockChange), document.removeEventListener("mspointerlockchange", this._onPointerLockChange), document.removeEventListener("mozpointerlockchange", this._onPointerLockChange), document.removeEventListener("webkitpointerlockchange", this._onPointerLockChange)
        }, a.isSupported = function() {
            try {
                var t = document.createElement("canvas"), e = t.getContext("webgl") || t.getContext("experimental-webgl");
                return null != e && !!window.WebGLRenderingContext
            } catch (n) {
                return !1
            }
        }, a._ALPHA_DISABLE = 0, a._ALPHA_ADD = 1, a._ALPHA_COMBINE = 2, a._DELAYLOADSTATE_NONE = 0, a._DELAYLOADSTATE_LOADED = 1, a._DELAYLOADSTATE_LOADING = 2, a._DELAYLOADSTATE_NOTLOADED = 4, a.Epsilon = .001, a.CollisionsEpsilon = .001, a.ShadersRepository = "Babylon/Shaders/", a
    }();
    t.Engine = a
}(BABYLON || (BABYLON = {}));
var BABYLON;
!function(t) {
    var e = function() {
        function e(t, e) {
            this.state = "", this.animations = new Array, this._childrenFlag = -1, this._isEnabled = !0, this._isReady = !0, this._currentRenderId = -1, this.name = t, this.id = t, this._scene = e, this._initCache()
        }
        return e.prototype.getScene = function() {
            return this._scene
        }, e.prototype.getEngine = function() {
            return this._scene.getEngine()
        }, e.prototype.getWorldMatrix = function() {
            return t.Matrix.Identity()
        }, e.prototype._initCache = function() {
            this._cache = {}, this._cache.parent = void 0
        }, e.prototype.updateCache = function(t) {
            (t || !this.isSynchronized()) && (this._cache.parent = this.parent, this._updateCache())
        }, e.prototype._updateCache = function() {
        }, e.prototype._isSynchronized = function() {
            return !0
        }, e.prototype.isSynchronizedWithParent = function() {
            return this.parent ? this.parent._currentRenderId <= this._currentRenderId : !0
        }, e.prototype.isSynchronized = function(t) {
            var e = this.hasNewParent();
            return e = e || !this.isSynchronizedWithParent(), e = e || !this._isSynchronized(), t && this.updateCache(!0), !e
        }, e.prototype.hasNewParent = function(t) {
            return this._cache.parent === this.parent ? !1 : (t && (this._cache.parent = this.parent), !0)
        }, e.prototype.isReady = function() {
            return this._isReady
        }, e.prototype.isEnabled = function() {
            return this._isEnabled ? this.parent ? this.parent.isEnabled() : !0 : !1
        }, e.prototype.setEnabled = function(t) {
            this._isEnabled = t
        }, e.prototype.isDescendantOf = function(t) {
            return this.parent ? this.parent === t ? !0 : this.parent.isDescendantOf(t) : !1
        }, e.prototype._getDescendants = function(t, e) {
            for (var n = 0; n < t.length; n++) {
                var i = t[n];
                i.isDescendantOf(this) && e.push(i)
            }
        }, e.prototype.getDescendants = function() {
            var t = [];
            return this._getDescendants(this._scene.meshes, t), this._getDescendants(this._scene.lights, t), this._getDescendants(this._scene.cameras, t), t
        }, e.prototype._setReady = function(t) {
            if (t != this._isReady) {
                if (!t)
                    return void (this._isReady = !1);
                this._isReady = !0, this.onReady && this.onReady(this)
            }
        }, e
    }();
    t.Node = e
}(BABYLON || (BABYLON = {}));
var BABYLON;
!function(t) {
    var e = function() {
        function e(t, e, n, i, o, r, s, a) {
            this.engine = t, this.canvas = n, this.currentScene = e, this.sceneLoadedCallback = i, this.progressCallback = o, this.additionnalRenderLoopLogicCallback = r, this.textureLoadingCallback = s, this.startingProcessingFilesCallback = a
        }
        return e.prototype.monitorElementForDragNDrop = function(t) {
            var e = this;
            t && (this.elementToMonitor = t, this.elementToMonitor.addEventListener("dragenter", function(t) {
                                                                                    e.drag(t)
                                                                                    }, !1), this.elementToMonitor.addEventListener("dragover", function(t) {
                                                                                                                                   e.drag(t)
                                                                                                                                   }, !1), this.elementToMonitor.addEventListener("drop", function(t) {
                                                                                                                                                                                  e.drop(t)
                                                                                                                                                                                  }, !1))
        }, e.prototype.renderFunction = function() {
            if (this.additionnalRenderLoopLogicCallback && this.additionnalRenderLoopLogicCallback(), this.currentScene) {
                if (this.textureLoadingCallback) {
                    var t = this.currentScene.getWaitingItemsCount();
                    t > 0 && this.textureLoadingCallback(t)
                }
                this.currentScene.render()
            }
        }, e.prototype.drag = function(t) {
            t.stopPropagation(), t.preventDefault()
        }, e.prototype.drop = function(t) {
            t.stopPropagation(), t.preventDefault(), this.loadFiles(t)
        }, e.prototype.loadFiles = function(e) {
            var n = this, i = this;
            this.startingProcessingFilesCallback && this.startingProcessingFilesCallback();
            var o, r;
            if (e && e.dataTransfer && e.dataTransfer.files && (r = e.dataTransfer.files), e && e.target && e.target.files && (r = e.target.files), r && r.length > 0) {
                for (var s = 0; s < r.length; s++)
                    switch (r[s].type) {
                        case "image/jpeg":
                        case "image/png":
                            t.FilesInput.FilesTextures[r[s].name] = r[s];
                            break;
                        case "image/targa":
                        case "image/vnd.ms-dds":
                            t.FilesInput.FilesToLoad[r[s].name] = r[s];
                            break;
                        default:
                            -1 !== r[s].name.indexOf(".babylon") && -1 === r[s].name.indexOf(".manifest") && -1 === r[s].name.indexOf(".incremental") && -1 === r[s].name.indexOf(".babylonmeshdata") && -1 === r[s].name.indexOf(".babylongeometrydata") && (o = r[s])
                    }
                o ? (this.currentScene && (this.engine.stopRenderLoop(), this.currentScene.dispose()), t.SceneLoader.Load("file:", o, this.engine, function(t) {
                                                                                                                          i.currentScene = t, i.currentScene.executeWhenReady(function() {
                                                                                                                                                                              i.currentScene.activeCamera && i.currentScene.activeCamera.attachControl(i.canvas), i.sceneLoadedCallback && i.sceneLoadedCallback(o, i.currentScene), i.engine.runRenderLoop(function() {
                                                                                                                                                                                                                                                                                                                                                            i.renderFunction()
                                                                                                                                                                                                                                                                                                                                                            })
                                                                                                                                                                              })
                                                                                                                          }, function(t) {
                                                                                                                          n.progressCallback && n.progressCallback(t)
                                                                                                                          })) : t.Tools.Error("Please provide a valid .babylon file.")
            }
        }, e.FilesTextures = new Array, e.FilesToLoad = new Array, e
    }();
    t.FilesInput = e
}(BABYLON || (BABYLON = {}));
var BABYLON;
!function(t) {
    var e = function() {
        function t(t, e, n) {
            this.bu = t, this.bv = e, this.distance = n, this.faceId = 0
        }
        return t
    }();
    t.IntersectionInfo = e;
    var n = function() {
        function e() {
            this.hit = !1, this.distance = 0, this.pickedPoint = null, this.pickedMesh = null, this.pickedSubMeshIndex = null, this.bu = 0, this.bv = 0, this.faceId = -1
        }
        return e.prototype.getNormal = function() {
            if (!this.pickedMesh || !this.pickedMesh.isVerticesDataPresent(t.VertexBuffer.NormalKind))
                return null;
            var e = this.pickedMesh.getIndices(), n = this.pickedMesh.getVerticesData(t.VertexBuffer.NormalKind), i = t.Vector3.FromArray(n, 3 * e[3 * this.faceId]), o = t.Vector3.FromArray(n, 3 * e[3 * this.faceId + 1]), r = t.Vector3.FromArray(n, 3 * e[3 * this.faceId + 2]);
            return i = i.scale(this.bu), o = o.scale(this.bv), r = r.scale(1 - this.bu - this.bv), new t.Vector3(i.x + o.x + r.x, i.y + o.y + r.y, i.z + o.z + r.z)
        }, e.prototype.getTextureCoordinates = function() {
            if (!this.pickedMesh || !this.pickedMesh.isVerticesDataPresent(t.VertexBuffer.UVKind))
                return null;
            var e = this.pickedMesh.getIndices(), n = this.pickedMesh.getVerticesData(t.VertexBuffer.UVKind), i = t.Vector2.FromArray(n, 2 * e[3 * this.faceId]), o = t.Vector2.FromArray(n, 2 * e[3 * this.faceId + 1]), r = t.Vector2.FromArray(n, 2 * e[3 * this.faceId + 2]);
            return i = i.scale(this.bu), o = o.scale(this.bv), r = r.scale(1 - this.bu - this.bv), new t.Vector2(i.x + o.x + r.x, i.y + o.y + r.y)
        }, e
    }();
    t.PickingInfo = n
}(BABYLON || (BABYLON = {}));
var BABYLON;
!function(t) {
    var e = function() {
        function e(e, n) {
            this.minimum = e, this.maximum = n, this._tempRadiusVector = t.Vector3.Zero();
            var i = t.Vector3.Distance(e, n);
            this.center = t.Vector3.Lerp(e, n, .5), this.radius = .5 * i, this.centerWorld = t.Vector3.Zero(), this._update(t.Matrix.Identity())
        }
        return e.prototype._update = function(e) {
            t.Vector3.TransformCoordinatesToRef(this.center, e, this.centerWorld), t.Vector3.TransformNormalFromFloatsToRef(1, 1, 1, e, this._tempRadiusVector), this.radiusWorld = Math.max(Math.abs(this._tempRadiusVector.x), Math.abs(this._tempRadiusVector.y), Math.abs(this._tempRadiusVector.z)) * this.radius
        }, e.prototype.isInFrustum = function(t) {
            for (var e = 0; 6 > e; e++)
                if (t[e].dotCoordinate(this.centerWorld) <= -this.radiusWorld)
                    return !1;
            return !0
        }, e.prototype.intersectsPoint = function(e) {
            var n = this.centerWorld.x - e.x, i = this.centerWorld.y - e.y, o = this.centerWorld.z - e.z, r = Math.sqrt(n * n + i * i + o * o);
            return Math.abs(this.radiusWorld - r) < t.Engine.Epsilon ? !1 : !0
        }, e.Intersects = function(t, e) {
            var n = t.centerWorld.x - e.centerWorld.x, i = t.centerWorld.y - e.centerWorld.y, o = t.centerWorld.z - e.centerWorld.z, r = Math.sqrt(n * n + i * i + o * o);
            return t.radiusWorld + e.radiusWorld < r ? !1 : !0
        }, e
    }();
    t.BoundingSphere = e
}(BABYLON || (BABYLON = {}));
var BABYLON;
!function(t) {
    var e = function() {
        function e(e, n) {
            this.minimum = e, this.maximum = n, this.vectors = new Array, this.vectorsWorld = new Array, this.vectors.push(this.minimum.clone()), this.vectors.push(this.maximum.clone()), this.vectors.push(this.minimum.clone()), this.vectors[2].x = this.maximum.x, this.vectors.push(this.minimum.clone()), this.vectors[3].y = this.maximum.y, this.vectors.push(this.minimum.clone()), this.vectors[4].z = this.maximum.z, this.vectors.push(this.maximum.clone()), this.vectors[5].z = this.minimum.z, this.vectors.push(this.maximum.clone()), this.vectors[6].x = this.minimum.x, this.vectors.push(this.maximum.clone()), this.vectors[7].y = this.minimum.y, this.center = this.maximum.add(this.minimum).scale(.5), this.extends = this.maximum.subtract(this.minimum).scale(.5), this.directions = [t.Vector3.Zero(), t.Vector3.Zero(), t.Vector3.Zero()];
            for (var i = 0; i < this.vectors.length; i++)
                this.vectorsWorld[i] = t.Vector3.Zero();
            this.minimumWorld = t.Vector3.Zero(), this.maximumWorld = t.Vector3.Zero(), this._update(t.Matrix.Identity())
        }
        return e.prototype.getWorldMatrix = function() {
            return this._worldMatrix
        }, e.prototype._update = function(e) {
            t.Vector3.FromFloatsToRef(Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE, this.minimumWorld), t.Vector3.FromFloatsToRef(-Number.MAX_VALUE, -Number.MAX_VALUE, -Number.MAX_VALUE, this.maximumWorld);
            for (var n = 0; n < this.vectors.length; n++) {
                var i = this.vectorsWorld[n];
                t.Vector3.TransformCoordinatesToRef(this.vectors[n], e, i), i.x < this.minimumWorld.x && (this.minimumWorld.x = i.x), i.y < this.minimumWorld.y && (this.minimumWorld.y = i.y), i.z < this.minimumWorld.z && (this.minimumWorld.z = i.z), i.x > this.maximumWorld.x && (this.maximumWorld.x = i.x), i.y > this.maximumWorld.y && (this.maximumWorld.y = i.y), i.z > this.maximumWorld.z && (this.maximumWorld.z = i.z)
            }
            this.maximumWorld.addToRef(this.minimumWorld, this.center), this.center.scaleInPlace(.5), t.Vector3.FromFloatArrayToRef(e.m, 0, this.directions[0]), t.Vector3.FromFloatArrayToRef(e.m, 4, this.directions[1]), t.Vector3.FromFloatArrayToRef(e.m, 8, this.directions[2]), this._worldMatrix = e
        }, e.prototype.isInFrustum = function(t) {
            return e.IsInFrustum(this.vectorsWorld, t)
        }, e.prototype.intersectsPoint = function(e) {
            var n = t.Engine.Epsilon;
            return this.maximumWorld.x - e.x < n || n > e.x - this.minimumWorld.x ? !1 : this.maximumWorld.y - e.y < n || n > e.y - this.minimumWorld.y ? !1 : this.maximumWorld.z - e.z < n || n > e.z - this.minimumWorld.z ? !1 : !0
        }, e.prototype.intersectsSphere = function(t) {
            return e.IntersectsSphere(this.minimumWorld, this.maximumWorld, t.centerWorld, t.radiusWorld)
        }, e.prototype.intersectsMinMax = function(t, e) {
            return this.maximumWorld.x < t.x || this.minimumWorld.x > e.x ? !1 : this.maximumWorld.y < t.y || this.minimumWorld.y > e.y ? !1 : this.maximumWorld.z < t.z || this.minimumWorld.z > e.z ? !1 : !0
        }, e.Intersects = function(t, e) {
            return t.maximumWorld.x < e.minimumWorld.x || t.minimumWorld.x > e.maximumWorld.x ? !1 : t.maximumWorld.y < e.minimumWorld.y || t.minimumWorld.y > e.maximumWorld.y ? !1 : t.maximumWorld.z < e.minimumWorld.z || t.minimumWorld.z > e.maximumWorld.z ? !1 : !0
        }, e.IntersectsSphere = function(e, n, i, o) {
            var r = t.Vector3.Clamp(i, e, n), s = t.Vector3.DistanceSquared(i, r);
            return o * o >= s
        }, e.IsInFrustum = function(t, e) {
            for (var n = 0; 6 > n; n++) {
                for (var i = 8, o = 0; 8 > o && e[n].dotCoordinate(t[o]) < 0; o++)
                    --i;
                if (0 == i)
                    return !1
                    }
            return !0
        }, e
    }();
    t.BoundingBox = e
}(BABYLON || (BABYLON = {}));
var BABYLON;
!function(t) {
    var e = function(e, n) {
        var i = t.Vector3.Dot(n.center, e), o = Math.abs(t.Vector3.Dot(n.directions[0], e)) * n.extends.x, r = Math.abs(t.Vector3.Dot(n.directions[1], e)) * n.extends.y, s = Math.abs(t.Vector3.Dot(n.directions[2], e)) * n.extends.z, a = o + r + s;
        return {min: i - a,max: i + a}
    }, n = function(t, e, n, i) {
        return !(t > i || n > e)
    }, i = function(t, i, o) {
        var r = e(t, i), s = e(t, o);
        return n(r.min, r.max, s.min, s.max)
    }, o = function() {
        function e(e, n) {
            this.minimum = e, this.maximum = n, this.boundingBox = new t.BoundingBox(e, n), this.boundingSphere = new t.BoundingSphere(e, n)
        }
        return e.prototype._update = function(t) {
            this.boundingBox._update(t), this.boundingSphere._update(t)
        }, e.prototype.isInFrustum = function(t) {
            return this.boundingSphere.isInFrustum(t) ? this.boundingBox.isInFrustum(t) : !1
        }, e.prototype._checkCollision = function(t) {
            return t._canDoCollision(this.boundingSphere.centerWorld, this.boundingSphere.radiusWorld, this.boundingBox.minimumWorld, this.boundingBox.maximumWorld)
        }, e.prototype.intersectsPoint = function(t) {
            return this.boundingSphere.centerWorld && this.boundingSphere.intersectsPoint(t) && this.boundingBox.intersectsPoint(t) ? !0 : !1
        }, e.prototype.intersects = function(e, n) {
            if (!this.boundingSphere.centerWorld || !e.boundingSphere.centerWorld)
                return !1;
            if (!t.BoundingSphere.Intersects(this.boundingSphere, e.boundingSphere))
                return !1;
            if (!t.BoundingBox.Intersects(this.boundingBox, e.boundingBox))
                return !1;
            if (!n)
                return !0;
            var o = this.boundingBox, r = e.boundingBox;
            return i(o.directions[0], o, r) && i(o.directions[1], o, r) && i(o.directions[2], o, r) && i(r.directions[0], o, r) && i(r.directions[1], o, r) && i(r.directions[2], o, r) && i(t.Vector3.Cross(o.directions[0], r.directions[0]), o, r) && i(t.Vector3.Cross(o.directions[0], r.directions[1]), o, r) && i(t.Vector3.Cross(o.directions[0], r.directions[2]), o, r) && i(t.Vector3.Cross(o.directions[1], r.directions[0]), o, r) && i(t.Vector3.Cross(o.directions[1], r.directions[1]), o, r) && i(t.Vector3.Cross(o.directions[1], r.directions[2]), o, r) && i(t.Vector3.Cross(o.directions[2], r.directions[0]), o, r) && i(t.Vector3.Cross(o.directions[2], r.directions[1]), o, r) && i(t.Vector3.Cross(o.directions[2], r.directions[2]), o, r) ? !0 : !1
        }, e
    }();
    t.BoundingInfo = o
}(BABYLON || (BABYLON = {}));
var __extends = this.__extends || function(t, e) {
    function n() {
        this.constructor = t
    }
    for (var i in e)
        e.hasOwnProperty(i) && (t[i] = e[i]);
    n.prototype = e.prototype, t.prototype = new n
}, BABYLON;
!function(t) {
    var e = function(e) {
        function n(n, i) {
            e.call(this, n, i), this.position = new t.Vector3(0, 0, 0), this.rotation = new t.Vector3(0, 0, 0), this.scaling = new t.Vector3(1, 1, 1), this.billboardMode = t.AbstractMesh.BILLBOARDMODE_NONE, this.visibility = 1, this.infiniteDistance = !1, this.isVisible = !0, this.isPickable = !0, this.showBoundingBox = !1, this.showSubMeshesBoundingBox = !1, this.onDispose = null, this.checkCollisions = !1, this.renderingGroupId = 0, this.receiveShadows = !1, this.useOctreeForRenderingSelection = !0, this.useOctreeForPicking = !0, this.useOctreeForCollisions = !0, this.layerMask = 4294967295, this._physicImpostor = t.PhysicsEngine.NoImpostor, this.ellipsoid = new t.Vector3(.5, 1, .5), this.ellipsoidOffset = new t.Vector3(0, 0, 0), this._collider = new t.Collider, this._oldPositionForCollisions = new t.Vector3(0, 0, 0), this._diffPositionForCollisions = new t.Vector3(0, 0, 0), this._newPositionForCollisions = new t.Vector3(0, 0, 0), this._localScaling = t.Matrix.Zero(), this._localRotation = t.Matrix.Zero(), this._localTranslation = t.Matrix.Zero(), this._localBillboard = t.Matrix.Zero(), this._localPivotScaling = t.Matrix.Zero(), this._localPivotScalingRotation = t.Matrix.Zero(), this._localWorld = t.Matrix.Zero(), this._worldMatrix = t.Matrix.Zero(), this._rotateYByPI = t.Matrix.RotationY(Math.PI), this._absolutePosition = t.Vector3.Zero(), this._collisionsTransformMatrix = t.Matrix.Zero(), this._collisionsScalingMatrix = t.Matrix.Zero(), this._isDirty = !1, this._pivotMatrix = t.Matrix.Identity(), this._isDisposed = !1, this._renderId = 0, this._intersectionsInProgress = new Array, i.meshes.push(this)
        }
        return __extends(n, e), Object.defineProperty(n, "BILLBOARDMODE_NONE", {get: function() {
                                                      return n._BILLBOARDMODE_NONE
                                                      },enumerable: !0,configurable: !0}), Object.defineProperty(n, "BILLBOARDMODE_X", {get: function() {
                                                                                                                 return n._BILLBOARDMODE_X
                                                                                                                 },enumerable: !0,configurable: !0}), Object.defineProperty(n, "BILLBOARDMODE_Y", {get: function() {
                                                                                                                                                                            return n._BILLBOARDMODE_Y
                                                                                                                                                                            },enumerable: !0,configurable: !0}), Object.defineProperty(n, "BILLBOARDMODE_Z", {get: function() {
                                                                                                                                                                                                                                       return n._BILLBOARDMODE_Z
                                                                                                                                                                                                                                       },enumerable: !0,configurable: !0}), Object.defineProperty(n, "BILLBOARDMODE_ALL", {get: function() {
                                                                                                                                                                                                                                                                                                  return n._BILLBOARDMODE_ALL
                                                                                                                                                                                                                                                                                                  },enumerable: !0,configurable: !0}), n.prototype.getTotalVertices = function() {
            return 0
        }, n.prototype.getIndices = function() {
            return null
        }, n.prototype.getVerticesData = function() {
            return null
        }, n.prototype.isVerticesDataPresent = function() {
            return !1
        }, n.prototype.getBoundingInfo = function() {
            return this._boundingInfo || this._updateBoundingInfo(), this._boundingInfo
        }, n.prototype._preActivate = function() {
        }, n.prototype._activate = function(t) {
            this._renderId = t
        }, n.prototype.getWorldMatrix = function() {
            return this._currentRenderId !== this.getScene().getRenderId() && this.computeWorldMatrix(), this._worldMatrix
        }, Object.defineProperty(n.prototype, "worldMatrixFromCache", {get: function() {
                                 return this._worldMatrix
                                 },enumerable: !0,configurable: !0}), Object.defineProperty(n.prototype, "absolutePosition", {get: function() {
                                                                                            return this._absolutePosition
                                                                                            },enumerable: !0,configurable: !0}), n.prototype.rotate = function(e, n, i) {
            if (this.rotationQuaternion || (this.rotationQuaternion = t.Quaternion.RotationYawPitchRoll(this.rotation.y, this.rotation.x, this.rotation.z), this.rotation = t.Vector3.Zero()), i && 0 != i) {
                if (this.parent) {
                    var o = this.parent.getWorldMatrix().clone();
                    o.invert(), e = t.Vector3.TransformNormal(e, o)
                }
                r = t.Quaternion.RotationAxis(e, n), this.rotationQuaternion = r.multiply(this.rotationQuaternion)
            } else {
                var r = t.Quaternion.RotationAxis(e, n);
                this.rotationQuaternion = this.rotationQuaternion.multiply(r)
            }
        }, n.prototype.translate = function(t, e, n) {
            var i = t.scale(e);
            if (n && 0 != n)
                this.setAbsolutePosition(this.getAbsolutePosition().add(i));
            else {
                var o = this.getPositionExpressedInLocalSpace().add(i);
                this.setPositionWithLocalVector(o)
            }
        }, n.prototype.getAbsolutePosition = function() {
            return this.computeWorldMatrix(), this._absolutePosition
        }, n.prototype.setAbsolutePosition = function(e) {
            if (e) {
                var n, i, o;
                if (void 0 === e.x) {
                    if (arguments.length < 3)
                        return;
                    n = arguments[0], i = arguments[1], o = arguments[2]
                } else
                    n = e.x, i = e.y, o = e.z;
                if (this.parent) {
                    var r = this.parent.getWorldMatrix().clone();
                    r.invert();
                    var s = new t.Vector3(n, i, o);
                    this.position = t.Vector3.TransformCoordinates(s, r)
                } else
                    this.position.x = n, this.position.y = i, this.position.z = o
                    }
        }, n.prototype.setPivotMatrix = function(t) {
            this._pivotMatrix = t, this._cache.pivotMatrixUpdated = !0
        }, n.prototype.getPivotMatrix = function() {
            return this._pivotMatrix
        }, n.prototype._isSynchronized = function() {
            if (this._isDirty)
                return !1;
            if (this.billboardMode !== n.BILLBOARDMODE_NONE)
                return !1;
            if (this._cache.pivotMatrixUpdated)
                return !1;
            if (this.infiniteDistance)
                return !1;
            if (!this._cache.position.equals(this.position))
                return !1;
            if (this.rotationQuaternion) {
                if (!this._cache.rotationQuaternion.equals(this.rotationQuaternion))
                    return !1
                    } else if (!this._cache.rotation.equals(this.rotation))
                        return !1;
            return this._cache.scaling.equals(this.scaling) ? !0 : !1
        }, n.prototype._initCache = function() {
            e.prototype._initCache.call(this), this._cache.localMatrixUpdated = !1, this._cache.position = t.Vector3.Zero(), this._cache.scaling = t.Vector3.Zero(), this._cache.rotation = t.Vector3.Zero(), this._cache.rotationQuaternion = new t.Quaternion(0, 0, 0, 0)
        }, n.prototype.markAsDirty = function(t) {
            "rotation" === t && (this.rotationQuaternion = null), this._currentRenderId = Number.MAX_VALUE, this._isDirty = !0
        }, n.prototype._updateBoundingInfo = function() {
            if (this._boundingInfo = this._boundingInfo || new t.BoundingInfo(this.absolutePosition, this.absolutePosition), this._boundingInfo._update(this.worldMatrixFromCache), this.subMeshes)
                for (var e = 0; e < this.subMeshes.length; e++) {
                    var n = this.subMeshes[e];
                    n.updateBoundingInfo(this.worldMatrixFromCache)
                }
        }, n.prototype.computeWorldMatrix = function(e) {
            if (!e && (this._currentRenderId == this.getScene().getRenderId() || this.isSynchronized(!0)))
                return this._worldMatrix;
            if (this._cache.position.copyFrom(this.position), this._cache.scaling.copyFrom(this.scaling), this._cache.pivotMatrixUpdated = !1, this._currentRenderId = this.getScene().getRenderId(), this._isDirty = !1, t.Matrix.ScalingToRef(this.scaling.x, this.scaling.y, this.scaling.z, this._localScaling), this.rotationQuaternion ? (this.rotationQuaternion.toRotationMatrix(this._localRotation), this._cache.rotationQuaternion.copyFrom(this.rotationQuaternion)) : (t.Matrix.RotationYawPitchRollToRef(this.rotation.y, this.rotation.x, this.rotation.z, this._localRotation), this._cache.rotation.copyFrom(this.rotation)), this.infiniteDistance && !this.parent) {
                var i = this.getScene().activeCamera, o = i.getWorldMatrix(), r = new t.Vector3(o.m[12], o.m[13], o.m[14]);
                t.Matrix.TranslationToRef(this.position.x + r.x, this.position.y + r.y, this.position.z + r.z, this._localTranslation)
            } else
                t.Matrix.TranslationToRef(this.position.x, this.position.y, this.position.z, this._localTranslation);
            if (this._pivotMatrix.multiplyToRef(this._localScaling, this._localPivotScaling), this._localPivotScaling.multiplyToRef(this._localRotation, this._localPivotScalingRotation), this.billboardMode !== n.BILLBOARDMODE_NONE) {
                var s = this.position.clone(), a = this.getScene().activeCamera.position.clone();
                this.parent && this.parent.position && (s.addInPlace(this.parent.position), t.Matrix.TranslationToRef(s.x, s.y, s.z, this._localTranslation)), (this.billboardMode & n.BILLBOARDMODE_ALL) === n.BILLBOARDMODE_ALL ? a = this.getScene().activeCamera.position : (this.billboardMode & t.AbstractMesh.BILLBOARDMODE_X && (a.x = s.x + t.Engine.Epsilon), this.billboardMode & t.AbstractMesh.BILLBOARDMODE_Y && (a.y = s.y + .001), this.billboardMode & t.AbstractMesh.BILLBOARDMODE_Z && (a.z = s.z + .001)), t.Matrix.LookAtLHToRef(s, a, t.Vector3.Up(), this._localBillboard), this._localBillboard.m[12] = this._localBillboard.m[13] = this._localBillboard.m[14] = 0, this._localBillboard.invert(), this._localPivotScalingRotation.multiplyToRef(this._localBillboard, this._localWorld), this._rotateYByPI.multiplyToRef(this._localWorld, this._localPivotScalingRotation)
            }
            return this._localPivotScalingRotation.multiplyToRef(this._localTranslation, this._localWorld), this.parent && this.parent.getWorldMatrix && this.billboardMode === t.AbstractMesh.BILLBOARDMODE_NONE ? this._localWorld.multiplyToRef(this.parent.getWorldMatrix(), this._worldMatrix) : this._worldMatrix.copyFrom(this._localWorld), this._updateBoundingInfo(), this._absolutePosition.copyFromFloats(this._worldMatrix.m[12], this._worldMatrix.m[13], this._worldMatrix.m[14]), this._worldMatrix
        }, n.prototype.setPositionWithLocalVector = function(e) {
            this.computeWorldMatrix(), this.position = t.Vector3.TransformNormal(e, this._localWorld)
        }, n.prototype.getPositionExpressedInLocalSpace = function() {
            this.computeWorldMatrix();
            var e = this._localWorld.clone();
            return e.invert(), t.Vector3.TransformNormal(this.position, e)
        }, n.prototype.locallyTranslate = function(e) {
            this.computeWorldMatrix(), this.position = t.Vector3.TransformCoordinates(e, this._localWorld)
        }, n.prototype.lookAt = function(e, n, i, o) {
            n = n || 0, i = i || 0, o = o || 0;
            var r = e.subtract(this.position), s = -Math.atan2(r.z, r.x) - Math.PI / 2, a = Math.sqrt(r.x * r.x + r.z * r.z), l = Math.atan2(r.y, a);
            this.rotationQuaternion = t.Quaternion.RotationYawPitchRoll(s + n, l + i, o)
        }, n.prototype.isInFrustum = function(t) {
            return this._boundingInfo.isInFrustum(t) ? !0 : !1
        }, n.prototype.intersectsMesh = function(t, e) {
            return this._boundingInfo && t._boundingInfo ? this._boundingInfo.intersects(t._boundingInfo, e) : !1
        }, n.prototype.intersectsPoint = function(t) {
            return this._boundingInfo ? this._boundingInfo.intersectsPoint(t) : !1
        }, n.prototype.setPhysicsState = function(e, n) {
            var i = this.getScene().getPhysicsEngine();
            if (i) {
                if (e.impostor && (n = e, e = e.impostor), e = e || t.PhysicsEngine.NoImpostor, e === t.PhysicsEngine.NoImpostor)
                    return void i._unregisterMesh(this);
                n.mass = n.mass || 0, n.friction = n.friction || .2, n.restitution = n.restitution || .9, this._physicImpostor = e, this._physicsMass = n.mass, this._physicsFriction = n.friction, this._physicRestitution = n.restitution, i._registerMesh(this, e, n)
            }
        }, n.prototype.getPhysicsImpostor = function() {
            return this._physicImpostor ? this._physicImpostor : t.PhysicsEngine.NoImpostor
        }, n.prototype.getPhysicsMass = function() {
            return this._physicsMass ? this._physicsMass : 0
        }, n.prototype.getPhysicsFriction = function() {
            return this._physicsFriction ? this._physicsFriction : 0
        }, n.prototype.getPhysicsRestitution = function() {
            return this._physicRestitution ? this._physicRestitution : 0
        }, n.prototype.applyImpulse = function(t, e) {
            this._physicImpostor && this.getScene().getPhysicsEngine()._applyImpulse(this, t, e)
        }, n.prototype.setPhysicsLinkWith = function(t, e, n) {
            this._physicImpostor && this.getScene().getPhysicsEngine()._createLink(this, t, e, n)
        }, n.prototype.moveWithCollisions = function(e) {
            var n = this.getAbsolutePosition();
            n.subtractFromFloatsToRef(0, this.ellipsoid.y, 0, this._oldPositionForCollisions), this._oldPositionForCollisions.addInPlace(this.ellipsoidOffset), this._collider.radius = this.ellipsoid, this.getScene()._getNewPosition(this._oldPositionForCollisions, e, this._collider, 3, this._newPositionForCollisions, this), this._newPositionForCollisions.subtractToRef(this._oldPositionForCollisions, this._diffPositionForCollisions), this._diffPositionForCollisions.length() > t.Engine.CollisionsEpsilon && this.position.addInPlace(this._diffPositionForCollisions)
        }, n.prototype.createOrUpdateSubmeshesOctree = function(e, n) {
            "undefined" == typeof e && (e = 64), "undefined" == typeof n && (n = 2), this._submeshesOctree || (this._submeshesOctree = new t.Octree(t.Octree.CreationFuncForSubMeshes, e, n)), this.computeWorldMatrix(!0);
            var i = this.getBoundingInfo().boundingBox;
            return this._submeshesOctree.update(i.minimumWorld, i.maximumWorld, this.subMeshes), this._submeshesOctree
        }, n.prototype._collideForSubMesh = function(e, n, i) {
            if (this._generatePointsArray(), !e._lastColliderWorldVertices || !e._lastColliderTransformMatrix.equals(n)) {
                e._lastColliderTransformMatrix = n.clone(), e._lastColliderWorldVertices = [], e._trianglePlanes = [];
                for (var o = e.verticesStart, r = e.verticesStart + e.verticesCount, s = o; r > s; s++)
                    e._lastColliderWorldVertices.push(t.Vector3.TransformCoordinates(this._positions[s], n))
                    }
            i._collide(e, e._lastColliderWorldVertices, this.getIndices(), e.indexStart, e.indexStart + e.indexCount, e.verticesStart)
        }, n.prototype._processCollisionsForSubMeshes = function(t, e) {
            var n, i;
            if (this._submeshesOctree && this.useOctreeForCollisions) {
                var o = t.velocityWorldLength + Math.max(t.radius.x, t.radius.y, t.radius.z), r = this._submeshesOctree.intersects(t.basePointWorld, o);
                i = r.length, n = r.data
            } else
                n = this.subMeshes, i = n.length;
            for (var s = 0; i > s; s++) {
                var a = n[s];
                i > 1 && !a._checkCollision(t) || this._collideForSubMesh(a, e, t)
            }
        }, n.prototype._checkCollision = function(e) {
            this._boundingInfo._checkCollision(e) && (t.Matrix.ScalingToRef(1 / e.radius.x, 1 / e.radius.y, 1 / e.radius.z, this._collisionsScalingMatrix), this.worldMatrixFromCache.multiplyToRef(this._collisionsScalingMatrix, this._collisionsTransformMatrix), this._processCollisionsForSubMeshes(e, this._collisionsTransformMatrix))
        }, n.prototype._generatePointsArray = function() {
            return !1
        }, n.prototype.intersects = function(e, n, i, o) {
            var r = new t.PickingInfo;
            if (!(this.subMeshes && this._boundingInfo && e.intersectsSphere(this._boundingInfo.boundingSphere) && e.intersectsBox(this._boundingInfo.boundingBox)))
                return r;
            if (!this._generatePointsArray())
                return r;
            var s, a, l, h = null;
            if (this._submeshesOctree && this.useOctreeForPicking) {
                var c = t.Ray.Transform(e, this.getWorldMatrix()), u = this._submeshesOctree.intersectsRay(c);
                l = u.length, a = u.data
            } else
                a = this.subMeshes, l = a.length;
            for (var p = 0; l > p; p++) {
                var d = a[p];
                if (!(l > 1) || d.canIntersects(e)) {
                    var m = d.intersects(e, this._positions, this.getIndices(), n, o);
                    if (m) {
                        if (i && d.getMaterial().alpha < .3)
                            continue;
                        if ((n || !h || m.distance < h.distance) && (h = m, s = p, n))
                            break
                            }
                }
            }
            if (h) {
                var g = this.getWorldMatrix(), f = t.Vector3.TransformCoordinates(e.origin, g), y = e.direction.clone();
                y.normalize(), y = y.scale(h.distance);
                var _ = t.Vector3.TransformNormal(y, g), v = f.add(_);
                return r.hit = !0, r.distance = t.Vector3.Distance(f, v), r.pickedPoint = v, r.pickedMesh = this, r.pickedSubMeshIndex = s, r.bu = h.bu, r.bv = h.bv, r.faceId = h.faceId, r
            }
            return r
        }, n.prototype.clone = function() {
            return null
        }, n.prototype.releaseSubMeshes = function() {
            if (this.subMeshes)
                for (; this.subMeshes.length; )
                    this.subMeshes[0].dispose();
            else
                this.subMeshes = new Array
                }, n.prototype.dispose = function(e) {
                    for (this.getPhysicsImpostor() != t.PhysicsEngine.NoImpostor && this.setPhysicsState(t.PhysicsEngine.NoImpostor), o = 0; o < this._intersectionsInProgress.length; o++) {
                        var n = this._intersectionsInProgress[o], i = n._intersectionsInProgress.indexOf(this);
                        n._intersectionsInProgress.splice(i, 1)
                    }
                    this._intersectionsInProgress = [], this.releaseSubMeshes();
                    var o = this.getScene().meshes.indexOf(this);
                    if (this.getScene().meshes.splice(o, 1), e)
                        for (o = 0; o < this.getScene().meshes.length; o++) {
                            var r = this.getScene().meshes[o];
                            r.parent === this && (r.parent = null, r.computeWorldMatrix(!0))
                        }
                    else {
                        for (o = 0; o < this.getScene().particleSystems.length; o++)
                            this.getScene().particleSystems[o].emitter == this && (this.getScene().particleSystems[o].dispose(), o--);
                        var s = this.getScene().meshes.slice(0);
                        for (o = 0; o < s.length; o++)
                            s[o].parent == this && s[o].dispose()
                            }
                    this._isDisposed = !0, this.onDispose && this.onDispose()
                }, n._BILLBOARDMODE_NONE = 0, n._BILLBOARDMODE_X = 1, n._BILLBOARDMODE_Y = 2, n._BILLBOARDMODE_Z = 4, n._BILLBOARDMODE_ALL = 7, n
    }(t.Node);
    t.AbstractMesh = e
}(BABYLON || (BABYLON = {}));
var __extends = this.__extends || function(t, e) {
    function n() {
        this.constructor = t
    }
    for (var i in e)
        e.hasOwnProperty(i) && (t[i] = e[i]);
    n.prototype = e.prototype, t.prototype = new n
}, BABYLON;
!function(t) {
    var e = function(e) {
        function n(n, i) {
            e.call(this, n, i), this.diffuse = new t.Color3(1, 1, 1), this.specular = new t.Color3(1, 1, 1), this.intensity = 1, this.range = Number.MAX_VALUE, this.excludedMeshes = new Array, this._excludedMeshesIds = new Array, i.lights.push(this)
        }
        return __extends(n, e), n.prototype.getShadowGenerator = function() {
            return this._shadowGenerator
        }, n.prototype.transferToEffect = function() {
        }, n.prototype._getWorldMatrix = function() {
            return t.Matrix.Identity()
        }, n.prototype.getWorldMatrix = function() {
            this._currentRenderId = this.getScene().getRenderId();
            var e = this._getWorldMatrix();
            return this.parent && this.parent.getWorldMatrix ? (this._parentedWorldMatrix || (this._parentedWorldMatrix = t.Matrix.Identity()), e.multiplyToRef(this.parent.getWorldMatrix(), this._parentedWorldMatrix), this._parentedWorldMatrix) : e
        }, n.prototype.dispose = function() {
            this._shadowGenerator && (this._shadowGenerator.dispose(), this._shadowGenerator = null);
            var t = this.getScene().lights.indexOf(this);
            this.getScene().lights.splice(t, 1)
        }, n
    }(t.Node);
    t.Light = e
}(BABYLON || (BABYLON = {}));
var __extends = this.__extends || function(t, e) {
    function n() {
        this.constructor = t
    }
    for (var i in e)
        e.hasOwnProperty(i) && (t[i] = e[i]);
    n.prototype = e.prototype, t.prototype = new n
}, BABYLON;
!function(t) {
    var e = function(e) {
        function n(t, n, i) {
            e.call(this, t, i), this.position = n
        }
        return __extends(n, e), n.prototype.transferToEffect = function(e, n) {
            return this.parent && this.parent.getWorldMatrix ? (this._transformedPosition || (this._transformedPosition = t.Vector3.Zero()), t.Vector3.TransformCoordinatesToRef(this.position, this.parent.getWorldMatrix(), this._transformedPosition), void e.setFloat4(n, this._transformedPosition.x, this._transformedPosition.y, this._transformedPosition.z, 0)) : void e.setFloat4(n, this.position.x, this.position.y, this.position.z, 0)
        }, n.prototype.getShadowGenerator = function() {
            return null
        }, n.prototype._getWorldMatrix = function() {
            return this._worldMatrix || (this._worldMatrix = t.Matrix.Identity()), t.Matrix.TranslationToRef(this.position.x, this.position.y, this.position.z, this._worldMatrix), this._worldMatrix
        }, n
    }(t.Light);
    t.PointLight = e
}(BABYLON || (BABYLON = {}));
var __extends = this.__extends || function(t, e) {
    function n() {
        this.constructor = t
    }
    for (var i in e)
        e.hasOwnProperty(i) && (t[i] = e[i]);
    n.prototype = e.prototype, t.prototype = new n
}, BABYLON;
!function(t) {
    var e = function(e) {
        function n(t, n, i, o, r, s) {
            e.call(this, t, s), this.position = n, this.direction = i, this.angle = o, this.exponent = r
        }
        return __extends(n, e), n.prototype.setDirectionToTarget = function(e) {
            return this.direction = t.Vector3.Normalize(e.subtract(this.position)), this.direction
        }, n.prototype.transferToEffect = function(e, n, i) {
            var o;
            if (this.parent && this.parent.getWorldMatrix) {
                this._transformedDirection || (this._transformedDirection = t.Vector3.Zero()), this._transformedPosition || (this._transformedPosition = t.Vector3.Zero());
                var r = this.parent.getWorldMatrix();
                t.Vector3.TransformCoordinatesToRef(this.position, r, this._transformedPosition), t.Vector3.TransformNormalToRef(this.direction, r, this._transformedDirection), e.setFloat4(n, this._transformedPosition.x, this._transformedPosition.y, this._transformedPosition.z, this.exponent), o = t.Vector3.Normalize(this._transformedDirection)
            } else
                e.setFloat4(n, this.position.x, this.position.y, this.position.z, this.exponent), o = t.Vector3.Normalize(this.direction);
            e.setFloat4(i, o.x, o.y, o.z, Math.cos(.5 * this.angle))
        }, n.prototype._getWorldMatrix = function() {
            return this._worldMatrix || (this._worldMatrix = t.Matrix.Identity()), t.Matrix.TranslationToRef(this.position.x, this.position.y, this.position.z, this._worldMatrix), this._worldMatrix
        }, n
    }(t.Light);
    t.SpotLight = e
}(BABYLON || (BABYLON = {}));
var __extends = this.__extends || function(t, e) {
    function n() {
        this.constructor = t
    }
    for (var i in e)
        e.hasOwnProperty(i) && (t[i] = e[i]);
    n.prototype = e.prototype, t.prototype = new n
}, BABYLON;
!function(t) {
    var e = function(e) {
        function n(n, i, o) {
            e.call(this, n, o), this.direction = i, this.groundColor = new t.Color3(0, 0, 0)
        }
        return __extends(n, e), n.prototype.setDirectionToTarget = function(e) {
            return this.direction = t.Vector3.Normalize(e.subtract(t.Vector3.Zero())), this.direction
        }, n.prototype.getShadowGenerator = function() {
            return null
        }, n.prototype.transferToEffect = function(e, n, i) {
            var o = t.Vector3.Normalize(this.direction);
            e.setFloat4(n, o.x, o.y, o.z, 0), e.setColor3(i, this.groundColor.scale(this.intensity))
        }, n.prototype._getWorldMatrix = function() {
            return this._worldMatrix || (this._worldMatrix = t.Matrix.Identity()), this._worldMatrix
        }, n
    }(t.Light);
    t.HemisphericLight = e
}(BABYLON || (BABYLON = {}));
var __extends = this.__extends || function(t, e) {
    function n() {
        this.constructor = t
    }
    for (var i in e)
        e.hasOwnProperty(i) && (t[i] = e[i]);
    n.prototype = e.prototype, t.prototype = new n
}, BABYLON;
!function(t) {
    var e = function(e) {
        function n(t, n, i) {
            e.call(this, t, i), this.direction = n, this.position = n.scale(-1)
        }
        return __extends(n, e), n.prototype.setDirectionToTarget = function(e) {
            return this.direction = t.Vector3.Normalize(e.subtract(this.position)), this.direction
        }, n.prototype._computeTransformedPosition = function() {
            return this.parent && this.parent.getWorldMatrix ? (this._transformedPosition || (this._transformedPosition = t.Vector3.Zero()), t.Vector3.TransformCoordinatesToRef(this.position, this.parent.getWorldMatrix(), this._transformedPosition), !0) : !1
        }, n.prototype.transferToEffect = function(e, n) {
            return this.parent && this.parent.getWorldMatrix ? (this._transformedDirection || (this._transformedDirection = t.Vector3.Zero()), t.Vector3.TransformNormalToRef(this.direction, this.parent.getWorldMatrix(), this._transformedDirection), void e.setFloat4(n, this._transformedDirection.x, this._transformedDirection.y, this._transformedDirection.z, 1)) : void e.setFloat4(n, this.direction.x, this.direction.y, this.direction.z, 1)
        }, n.prototype._getWorldMatrix = function() {
            return this._worldMatrix || (this._worldMatrix = t.Matrix.Identity()), t.Matrix.TranslationToRef(this.position.x, this.position.y, this.position.z, this._worldMatrix), this._worldMatrix
        }, n
    }(t.Light);
    t.DirectionalLight = e
}(BABYLON || (BABYLON = {}));
var BABYLON;
!function(t) {
    var e = function() {
        function e(n, i) {
            var o = this;
            this.filter = e.FILTER_VARIANCESHADOWMAP, this.usePoissonSampling = !1, this._darkness = 0, this._transparencyShadow = !1, this._viewMatrix = t.Matrix.Zero(), this._projectionMatrix = t.Matrix.Zero(), this._transformMatrix = t.Matrix.Zero(), this._worldViewProjection = t.Matrix.Zero(), this._light = i, this._scene = i.getScene(), i._shadowGenerator = this, this._shadowMap = new t.RenderTargetTexture(i.name + "_shadowMap", n, this._scene, !1), this._shadowMap.wrapU = t.Texture.CLAMP_ADDRESSMODE, this._shadowMap.wrapV = t.Texture.CLAMP_ADDRESSMODE, this._shadowMap.renderParticles = !1;
            var r = function(e) {
                var n = e.getRenderingMesh(), i = o._scene, r = i.getEngine();
                r.setState(e.getMaterial().backFaceCulling);
                var s = n._getInstancesRenderList(e._id);
                if (!s.mustReturn) {
                    var a = null !== r.getCaps().instancedArrays && null !== s.visibleInstances;
                    if (o.isReady(e, a)) {
                        r.enableEffect(o._effect), n._bind(e, o._effect, !1);
                        var l = e.getMaterial();
                        if (o._effect.setMatrix("viewProjection", o.getTransformMatrix()), l && l.needAlphaTesting()) {
                            var h = l.getAlphaTestTexture();
                            o._effect.setTexture("diffuseSampler", h), o._effect.setMatrix("diffuseMatrix", h.getTextureMatrix())
                        }
                        var c = n.skeleton && n.isVerticesDataPresent(t.VertexBuffer.MatricesIndicesKind) && n.isVerticesDataPresent(t.VertexBuffer.MatricesWeightsKind);
                        if (c && o._effect.setMatrices("mBones", n.skeleton.getTransformMatrices()), a)
                            n._renderWithInstances(e, !1, s, o._effect, r);
                        else if (s.renderSelf[e._id] && (o._effect.setMatrix("world", n.getWorldMatrix()), n._draw(e, !0)), s.visibleInstances[e._id])
                            for (var u = 0; u < s.visibleInstances[e._id].length; u++) {
                                var p = s.visibleInstances[e._id][u];
                                o._effect.setMatrix("world", p.getWorldMatrix()), n._draw(e, !0)
                            }
                    } else
                        o._shadowMap.resetRefreshCounter()
                        }
            };
            this._shadowMap.customRenderFunction = function(t, e, n) {
                var i;
                for (i = 0; i < t.length; i++)
                    r(t.data[i]);
                for (i = 0; i < e.length; i++)
                    r(e.data[i]);
                if (o._transparencyShadow)
                    for (i = 0; i < n.length; i++)
                        r(n.data[i])
                        }
        }
        return Object.defineProperty(e, "FILTER_NONE", {get: function() {
                                     return e._FILTER_NONE
                                     },enumerable: !0,configurable: !0}), Object.defineProperty(e, "FILTER_VARIANCESHADOWMAP", {get: function() {
                                                                                                return e._FILTER_VARIANCESHADOWMAP
                                                                                                },enumerable: !0,configurable: !0}), Object.defineProperty(e, "FILTER_POISSONSAMPLING", {get: function() {
                                                                                                                                                           return e._FILTER_POISSONSAMPLING
                                                                                                                                                           },enumerable: !0,configurable: !0}), Object.defineProperty(e.prototype, "useVarianceShadowMap", {get: function() {
                                                                                                                                                                                                                      return this.filter === e.FILTER_VARIANCESHADOWMAP
                                                                                                                                                                                                                      },set: function(t) {
                                                                                                                                                                                                                      this.filter = t ? e.FILTER_VARIANCESHADOWMAP : e.FILTER_NONE
                                                                                                                                                                                                                      },enumerable: !0,configurable: !0}), Object.defineProperty(e.prototype, "usePoissonSampling", {get: function() {
                                                                                                                                                                                                                                                                                 return this.filter === e.FILTER_POISSONSAMPLING
                                                                                                                                                                                                                                                                                 },set: function(t) {
                                                                                                                                                                                                                                                                                 this.filter = t ? e.FILTER_POISSONSAMPLING : e.FILTER_NONE
                                                                                                                                                                                                                                                                                 },enumerable: !0,configurable: !0}), e.prototype.isReady = function(e, n) {
            var i = [];
            this.useVarianceShadowMap && i.push("#define VSM");
            var o = [t.VertexBuffer.PositionKind], r = e.getMesh(), s = e.getMaterial();
            s && s.needAlphaTesting() && (i.push("#define ALPHATEST"), r.isVerticesDataPresent(t.VertexBuffer.UVKind) && (o.push(t.VertexBuffer.UVKind), i.push("#define UV1")), r.isVerticesDataPresent(t.VertexBuffer.UV2Kind) && (o.push(t.VertexBuffer.UV2Kind), i.push("#define UV2"))), r.skeleton && r.isVerticesDataPresent(t.VertexBuffer.MatricesIndicesKind) && r.isVerticesDataPresent(t.VertexBuffer.MatricesWeightsKind) && (o.push(t.VertexBuffer.MatricesIndicesKind), o.push(t.VertexBuffer.MatricesWeightsKind), i.push("#define BONES"), i.push("#define BonesPerMesh " + (r.skeleton.bones.length + 1))), n && (i.push("#define INSTANCES"), o.push("world0"), o.push("world1"), o.push("world2"), o.push("world3"));
            var a = i.join("\n");
            return this._cachedDefines != a && (this._cachedDefines = a, this._effect = this._scene.getEngine().createEffect("shadowMap", o, ["world", "mBones", "viewProjection", "diffuseMatrix"], ["diffuseSampler"], a)), this._effect.isReady()
        }, e.prototype.getShadowMap = function() {
            return this._shadowMap
        }, e.prototype.getLight = function() {
            return this._light
        }, e.prototype.getTransformMatrix = function() {
            var e = this._light.position, n = this._light.direction;
            if (this._light._computeTransformedPosition() && (e = this._light._transformedPosition), !(this._cachedPosition && this._cachedDirection && e.equals(this._cachedPosition) && n.equals(this._cachedDirection))) {
                this._cachedPosition = e.clone(), this._cachedDirection = n.clone();
                var i = this._scene.activeCamera;
                t.Matrix.LookAtLHToRef(e, this._light.position.add(n), t.Vector3.Up(), this._viewMatrix), t.Matrix.PerspectiveFovLHToRef(Math.PI / 2, 1, i.minZ, i.maxZ, this._projectionMatrix), this._viewMatrix.multiplyToRef(this._projectionMatrix, this._transformMatrix)
            }
            return this._transformMatrix
        }, e.prototype.getDarkness = function() {
            return this._darkness
        }, e.prototype.setDarkness = function(t) {
            this._darkness = t >= 1 ? 1 : 0 >= t ? 0 : t
        }, e.prototype.setTransparencyShadow = function(t) {
            this._transparencyShadow = t
        }, e.prototype.dispose = function() {
            this._shadowMap.dispose()
        }, e._FILTER_NONE = 0, e._FILTER_VARIANCESHADOWMAP = 1, e._FILTER_POISSONSAMPLING = 2, e
    }();
    t.ShadowGenerator = e
}(BABYLON || (BABYLON = {}));
var BABYLON;
!function(t) {
    var e = function(t, e, n, i) {
        return t.x > n.x + i ? !1 : n.x - i > e.x ? !1 : t.y > n.y + i ? !1 : n.y - i > e.y ? !1 : t.z > n.z + i ? !1 : n.z - i > e.z ? !1 : !0
    }, n = function(t, e, n, i) {
        var o = e * e - 4 * t * n, r = {root: 0,found: !1};
        if (0 > o)
            return r;
        var s = Math.sqrt(o), a = (-e - s) / (2 * t), l = (-e + s) / (2 * t);
        if (a > l) {
            var h = l;
            l = a, a = h
        }
        return a > 0 && i > a ? (r.root = a, r.found = !0, r) : l > 0 && i > l ? (r.root = l, r.found = !0, r) : r
    }, i = function() {
        function i() {
            this.radius = new t.Vector3(1, 1, 1), this.retry = 0, this.basePointWorld = t.Vector3.Zero(), this.velocityWorld = t.Vector3.Zero(), this.normalizedVelocity = t.Vector3.Zero(), this._collisionPoint = t.Vector3.Zero(), this._planeIntersectionPoint = t.Vector3.Zero(), this._tempVector = t.Vector3.Zero(), this._tempVector2 = t.Vector3.Zero(), this._tempVector3 = t.Vector3.Zero(), this._tempVector4 = t.Vector3.Zero(), this._edge = t.Vector3.Zero(), this._baseToVertex = t.Vector3.Zero(), this._destinationPoint = t.Vector3.Zero(), this._slidePlaneNormal = t.Vector3.Zero(), this._displacementVector = t.Vector3.Zero()
        }
        return i.prototype._initialize = function(e, n, i) {
            this.velocity = n, t.Vector3.NormalizeToRef(n, this.normalizedVelocity), this.basePoint = e, e.multiplyToRef(this.radius, this.basePointWorld), n.multiplyToRef(this.radius, this.velocityWorld), this.velocityWorldLength = this.velocityWorld.length(), this.epsilon = i, this.collisionFound = !1
        }, i.prototype._checkPointInTriangle = function(e, n, i, o, r) {
            n.subtractToRef(e, this._tempVector), i.subtractToRef(e, this._tempVector2), t.Vector3.CrossToRef(this._tempVector, this._tempVector2, this._tempVector4);
            var s = t.Vector3.Dot(this._tempVector4, r);
            return 0 > s ? !1 : (o.subtractToRef(e, this._tempVector3), t.Vector3.CrossToRef(this._tempVector2, this._tempVector3, this._tempVector4), s = t.Vector3.Dot(this._tempVector4, r), 0 > s ? !1 : (t.Vector3.CrossToRef(this._tempVector3, this._tempVector, this._tempVector4), s = t.Vector3.Dot(this._tempVector4, r), s >= 0))
        }, i.prototype._canDoCollision = function(n, i, o, r) {
            var s = t.Vector3.Distance(this.basePointWorld, n), a = Math.max(this.radius.x, this.radius.y, this.radius.z);
            return s > this.velocityWorldLength + a + i ? !1 : e(o, r, this.basePointWorld, this.velocityWorldLength + a) ? !0 : !1
        }, i.prototype._testTriangle = function(e, i, o, r, s) {
            var a, l = !1;
            i._trianglePlanes || (i._trianglePlanes = []), i._trianglePlanes[e] || (i._trianglePlanes[e] = new t.Plane(0, 0, 0, 0), i._trianglePlanes[e].copyFromPoints(o, r, s));
            var h = i._trianglePlanes[e];
            if (i.getMaterial() || h.isFrontFacingTo(this.normalizedVelocity, 0)) {
                var c = h.signedDistanceTo(this.basePoint), u = t.Vector3.Dot(h.normal, this.velocity);
                if (0 == u) {
                    if (Math.abs(c) >= 1)
                        return;
                    l = !0, a = 0
                } else {
                    a = (-1 - c) / u;
                    var p = (1 - c) / u;
                    if (a > p) {
                        var d = p;
                        p = a, a = d
                    }
                    if (a > 1 || 0 > p)
                        return;
                    0 > a && (a = 0), a > 1 && (a = 1)
                }
                this._collisionPoint.copyFromFloats(0, 0, 0);
                var m = !1, g = 1;
                if (l || (this.basePoint.subtractToRef(h.normal, this._planeIntersectionPoint), this.velocity.scaleToRef(a, this._tempVector), this._planeIntersectionPoint.addInPlace(this._tempVector), this._checkPointInTriangle(this._planeIntersectionPoint, o, r, s, h.normal) && (m = !0, g = a, this._collisionPoint.copyFrom(this._planeIntersectionPoint))), !m) {
                    var f = this.velocity.lengthSquared(), y = f;
                    this.basePoint.subtractToRef(o, this._tempVector);
                    var _ = 2 * t.Vector3.Dot(this.velocity, this._tempVector), v = this._tempVector.lengthSquared() - 1, b = n(y, _, v, g);
                    b.found && (g = b.root, m = !0, this._collisionPoint.copyFrom(o)), this.basePoint.subtractToRef(r, this._tempVector), _ = 2 * t.Vector3.Dot(this.velocity, this._tempVector), v = this._tempVector.lengthSquared() - 1, b = n(y, _, v, g), b.found && (g = b.root, m = !0, this._collisionPoint.copyFrom(r)), this.basePoint.subtractToRef(s, this._tempVector), _ = 2 * t.Vector3.Dot(this.velocity, this._tempVector), v = this._tempVector.lengthSquared() - 1, b = n(y, _, v, g), b.found && (g = b.root, m = !0, this._collisionPoint.copyFrom(s)), r.subtractToRef(o, this._edge), o.subtractToRef(this.basePoint, this._baseToVertex);
                    var w = this._edge.lengthSquared(), x = t.Vector3.Dot(this._edge, this.velocity), C = t.Vector3.Dot(this._edge, this._baseToVertex);
                    if (y = w * -f + x * x, _ = 2 * w * t.Vector3.Dot(this.velocity, this._baseToVertex) - 2 * x * C, v = w * (1 - this._baseToVertex.lengthSquared()) + C * C, b = n(y, _, v, g), b.found) {
                        var M = (x * b.root - C) / w;
                        M >= 0 && 1 >= M && (g = b.root, m = !0, this._edge.scaleInPlace(M), o.addToRef(this._edge, this._collisionPoint))
                    }
                    s.subtractToRef(r, this._edge), r.subtractToRef(this.basePoint, this._baseToVertex), w = this._edge.lengthSquared(), x = t.Vector3.Dot(this._edge, this.velocity), C = t.Vector3.Dot(this._edge, this._baseToVertex), y = w * -f + x * x, _ = 2 * w * t.Vector3.Dot(this.velocity, this._baseToVertex) - 2 * x * C, v = w * (1 - this._baseToVertex.lengthSquared()) + C * C, b = n(y, _, v, g), b.found && (M = (x * b.root - C) / w, M >= 0 && 1 >= M && (g = b.root, m = !0, this._edge.scaleInPlace(M), r.addToRef(this._edge, this._collisionPoint))), o.subtractToRef(s, this._edge), s.subtractToRef(this.basePoint, this._baseToVertex), w = this._edge.lengthSquared(), x = t.Vector3.Dot(this._edge, this.velocity), C = t.Vector3.Dot(this._edge, this._baseToVertex), y = w * -f + x * x, _ = 2 * w * t.Vector3.Dot(this.velocity, this._baseToVertex) - 2 * x * C, v = w * (1 - this._baseToVertex.lengthSquared()) + C * C, b = n(y, _, v, g), b.found && (M = (x * b.root - C) / w, M >= 0 && 1 >= M && (g = b.root, m = !0, this._edge.scaleInPlace(M), s.addToRef(this._edge, this._collisionPoint)))
                }
                if (m) {
                    var D = g * this.velocity.length();
                    (!this.collisionFound || D < this.nearestDistance) && (this.intersectionPoint ? this.intersectionPoint.copyFrom(this._collisionPoint) : this.intersectionPoint = this._collisionPoint.clone(), this.nearestDistance = D, this.collisionFound = !0, this.collidedMesh = i.getMesh())
                }
            }
        }, i.prototype._collide = function(t, e, n, i, o, r) {
            for (var s = i; o > s; s += 3) {
                var a = e[n[s] - r], l = e[n[s + 1] - r], h = e[n[s + 2] - r];
                this._testTriangle(s, t, h, l, a)
            }
        }, i.prototype._getResponse = function(e, n) {
            e.addToRef(n, this._destinationPoint), n.scaleInPlace(this.nearestDistance / n.length()), this.basePoint.addToRef(n, e), e.subtractToRef(this.intersectionPoint, this._slidePlaneNormal), this._slidePlaneNormal.normalize(), this._slidePlaneNormal.scaleToRef(this.epsilon, this._displacementVector), e.addInPlace(this._displacementVector), this.intersectionPoint.addInPlace(this._displacementVector), this._slidePlaneNormal.scaleInPlace(t.Plane.SignedDistanceToPlaneFromPositionAndNormal(this.intersectionPoint, this._slidePlaneNormal, this._destinationPoint)), this._destinationPoint.subtractInPlace(this._slidePlaneNormal), this._destinationPoint.subtractToRef(this.intersectionPoint, n)
        }, i
    }();
    t.Collider = i
}(BABYLON || (BABYLON = {}));
var __extends = this.__extends || function(t, e) {
    function n() {
        this.constructor = t
    }
    for (var i in e)
        e.hasOwnProperty(i) && (t[i] = e[i]);
    n.prototype = e.prototype, t.prototype = new n
}, BABYLON;
!function(t) {
    var e = function(e) {
        function n(i, o, r) {
            e.call(this, i, r), this.position = o, this.upVector = t.Vector3.Up(), this.orthoLeft = null, this.orthoRight = null, this.orthoBottom = null, this.orthoTop = null, this.fov = .8, this.minZ = .1, this.maxZ = 1e3, this.inertia = .9, this.mode = n.PERSPECTIVE_CAMERA, this.isIntermediate = !1, this.viewport = new t.Viewport(0, 0, 1, 1), this.subCameras = [], this.layerMask = 4294967295, this._computedViewMatrix = t.Matrix.Identity(), this._projectionMatrix = new t.Matrix, this._postProcesses = new Array, this._postProcessesTakenIndices = [], r.cameras.push(this), r.activeCamera || (r.activeCamera = this)
        }
        return __extends(n, e), n.prototype._initCache = function() {
            e.prototype._initCache.call(this), this._cache.position = new t.Vector3(Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE), this._cache.upVector = new t.Vector3(Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE), this._cache.mode = void 0, this._cache.minZ = void 0, this._cache.maxZ = void 0, this._cache.fov = void 0, this._cache.aspectRatio = void 0, this._cache.orthoLeft = void 0, this._cache.orthoRight = void 0, this._cache.orthoBottom = void 0, this._cache.orthoTop = void 0, this._cache.renderWidth = void 0, this._cache.renderHeight = void 0
        }, n.prototype._updateCache = function(t) {
            t || e.prototype._updateCache.call(this);
            var n = this.getEngine();
            this._cache.position.copyFrom(this.position), this._cache.upVector.copyFrom(this.upVector), this._cache.mode = this.mode, this._cache.minZ = this.minZ, this._cache.maxZ = this.maxZ, this._cache.fov = this.fov, this._cache.aspectRatio = n.getAspectRatio(this), this._cache.orthoLeft = this.orthoLeft, this._cache.orthoRight = this.orthoRight, this._cache.orthoBottom = this.orthoBottom, this._cache.orthoTop = this.orthoTop, this._cache.renderWidth = n.getRenderWidth(), this._cache.renderHeight = n.getRenderHeight()
        }, n.prototype._updateFromScene = function() {
            this.updateCache(), this._update()
        }, n.prototype._isSynchronized = function() {
            return this._isSynchronizedViewMatrix() && this._isSynchronizedProjectionMatrix()
        }, n.prototype._isSynchronizedViewMatrix = function() {
            return e.prototype._isSynchronized.call(this) ? this._cache.position.equals(this.position) && this._cache.upVector.equals(this.upVector) && this.isSynchronizedWithParent() : !1
        }, n.prototype._isSynchronizedProjectionMatrix = function() {
            var e = this._cache.mode === this.mode && this._cache.minZ === this.minZ && this._cache.maxZ === this.maxZ;
            if (!e)
                return !1;
            var n = this.getEngine();
            return e = this.mode === t.Camera.PERSPECTIVE_CAMERA ? this._cache.fov === this.fov && this._cache.aspectRatio === n.getAspectRatio(this) : this._cache.orthoLeft === this.orthoLeft && this._cache.orthoRight === this.orthoRight && this._cache.orthoBottom === this.orthoBottom && this._cache.orthoTop === this.orthoTop && this._cache.renderWidth === n.getRenderWidth() && this._cache.renderHeight === n.getRenderHeight()
        }, n.prototype.attachControl = function() {
        }, n.prototype.detachControl = function() {
        }, n.prototype._update = function() {
        }, n.prototype.attachPostProcess = function(e, n) {
            if ("undefined" == typeof n && (n = null), !e.isReusable() && this._postProcesses.indexOf(e) > -1)
                return t.Tools.Error("You're trying to reuse a post process not defined as reusable."), 0;
            if (null == n || 0 > n)
                return this._postProcesses.push(e), this._postProcessesTakenIndices.push(this._postProcesses.length - 1), this._postProcesses.length - 1;
            var i = 0;
            if (this._postProcesses[n]) {
                for (var o = this._postProcesses.length - 1, r = o; r >= n + 1; --r)
                    this._postProcesses[r + 1] = this._postProcesses[r];
                i = 1
            }
            for (r = 0; r < this._postProcessesTakenIndices.length; ++r)
                if (!(this._postProcessesTakenIndices[r] < n)) {
                    o = this._postProcessesTakenIndices.length - 1;
                    for (var s = o; s >= r; --s)
                        this._postProcessesTakenIndices[s + 1] = this._postProcessesTakenIndices[s] + i;
                    this._postProcessesTakenIndices[r] = n;
                    break
                }
            i || -1 != this._postProcessesTakenIndices.indexOf(n) || this._postProcessesTakenIndices.push(n);
            var a = n + i;
            return this._postProcesses[a] = e, a
        }, n.prototype.detachPostProcess = function(t, e) {
            "undefined" == typeof e && (e = null);
            var n = [];
            if (e)
                for (e = e instanceof Array ? e : [e], r = 0; r < e.length; r++) {
                    var i = this._postProcesses[e[r]];
                    i === t ? (delete this._postProcesses[e[r]], s = this._postProcessesTakenIndices.indexOf(e[r]), this._postProcessesTakenIndices.splice(s, 1)) : n.push(r)
                }
            else
                for (var o = this._postProcesses.length, r = 0; o > r; r++)
                    if (this._postProcesses[r] === t) {
                        delete this._postProcesses[r];
                        var s = this._postProcessesTakenIndices.indexOf(r);
                        this._postProcessesTakenIndices.splice(s, 1)
                    }
            return n
        }, n.prototype.getWorldMatrix = function() {
            this._worldMatrix || (this._worldMatrix = t.Matrix.Identity());
            var e = this.getViewMatrix();
            return e.invertToRef(this._worldMatrix), this._worldMatrix
        }, n.prototype._getViewMatrix = function() {
            return t.Matrix.Identity()
        }, n.prototype.getViewMatrix = function() {
            return this._computedViewMatrix = this._computeViewMatrix(), this.parent && this.parent.getWorldMatrix && !this.isSynchronized() ? (this._worldMatrix || (this._worldMatrix = t.Matrix.Identity()), this._computedViewMatrix.invertToRef(this._worldMatrix), this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(), this._computedViewMatrix), this._computedViewMatrix.invert(), this._currentRenderId = this.getScene().getRenderId(), this._computedViewMatrix) : this._computedViewMatrix
        }, n.prototype._computeViewMatrix = function(t) {
            return !t && this._isSynchronizedViewMatrix() ? this._computedViewMatrix : (this._computedViewMatrix = this._getViewMatrix(), this.parent && this.parent.getWorldMatrix || (this._currentRenderId = this.getScene().getRenderId()), this._computedViewMatrix)
        }, n.prototype.getProjectionMatrix = function(e) {
            if (!e && this._isSynchronizedProjectionMatrix())
                return this._projectionMatrix;
            var n = this.getEngine();
            if (this.mode === t.Camera.PERSPECTIVE_CAMERA)
                return this.minZ <= 0 && (this.minZ = .1), t.Matrix.PerspectiveFovLHToRef(this.fov, n.getAspectRatio(this), this.minZ, this.maxZ, this._projectionMatrix), this._projectionMatrix;
            var i = n.getRenderWidth() / 2, o = n.getRenderHeight() / 2;
            return t.Matrix.OrthoOffCenterLHToRef(this.orthoLeft || -i, this.orthoRight || i, this.orthoBottom || -o, this.orthoTop || o, this.minZ, this.maxZ, this._projectionMatrix), this._projectionMatrix
        }, n.prototype.dispose = function() {
            var t = this.getScene().cameras.indexOf(this);
            this.getScene().cameras.splice(t, 1);
            for (var e = 0; e < this._postProcessesTakenIndices.length; ++e)
                this._postProcesses[this._postProcessesTakenIndices[e]].dispose(this)
                }, n.PERSPECTIVE_CAMERA = 0, n.ORTHOGRAPHIC_CAMERA = 1, n
    }(t.Node);
    t.Camera = e
}(BABYLON || (BABYLON = {}));
var __extends = this.__extends || function(t, e) {
    function n() {
        this.constructor = t
    }
    for (var i in e)
        e.hasOwnProperty(i) && (t[i] = e[i]);
    n.prototype = e.prototype, t.prototype = new n
}, BABYLON;
!function(t) {
    var e = function(e) {
        function n(n, i, o) {
            e.call(this, n, i, o), this.cameraDirection = new t.Vector3(0, 0, 0), this.cameraRotation = new t.Vector2(0, 0), this.rotation = new t.Vector3(0, 0, 0), this.ellipsoid = new t.Vector3(.5, 1, .5), this.keysUp = [38], this.keysDown = [40], this.keysLeft = [37], this.keysRight = [39], this.speed = 2, this.checkCollisions = !1, this.applyGravity = !1, this.noRotationConstraint = !1, this.angularSensibility = 2e3, this.lockedTarget = null, this.onCollide = null, this._keys = [], this._collider = new t.Collider, this._needMoveForGravity = !0, this._currentTarget = t.Vector3.Zero(), this._viewMatrix = t.Matrix.Zero(), this._camMatrix = t.Matrix.Zero(), this._cameraTransformMatrix = t.Matrix.Zero(), this._cameraRotationMatrix = t.Matrix.Zero(), this._referencePoint = new t.Vector3(0, 0, 1), this._transformedReferencePoint = t.Vector3.Zero(), this._oldPosition = t.Vector3.Zero(), this._diffPosition = t.Vector3.Zero(), this._newPosition = t.Vector3.Zero(), this._lookAtTemp = t.Matrix.Zero(), this._tempMatrix = t.Matrix.Zero()
        }
        return __extends(n, e), n.prototype._getLockedTargetPosition = function() {
            return this.lockedTarget ? this.lockedTarget.position || this.lockedTarget : null
        }, n.prototype._initCache = function() {
            e.prototype._initCache.call(this), this._cache.lockedTarget = new t.Vector3(Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE), this._cache.rotation = new t.Vector3(Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE)
        }, n.prototype._updateCache = function(t) {
            t || e.prototype._updateCache.call(this);
            var n = this._getLockedTargetPosition();
            n ? this._cache.lockedTarget ? this._cache.lockedTarget.copyFrom(n) : this._cache.lockedTarget = n.clone() : this._cache.lockedTarget = null, this._cache.rotation.copyFrom(this.rotation)
        }, n.prototype._isSynchronizedViewMatrix = function() {
            if (!e.prototype._isSynchronizedViewMatrix.call(this))
                return !1;
            var t = this._getLockedTargetPosition();
            return (this._cache.lockedTarget ? this._cache.lockedTarget.equals(t) : !t) && this._cache.rotation.equals(this.rotation)
        }, n.prototype._computeLocalCameraSpeed = function() {
            return this.speed * (t.Tools.GetDeltaTime() / (10 * t.Tools.GetFps()))
        }, n.prototype.setTarget = function(e) {
            this.upVector.normalize(), t.Matrix.LookAtLHToRef(this.position, e, this.upVector, this._camMatrix), this._camMatrix.invert(), this.rotation.x = Math.atan(this._camMatrix.m[6] / this._camMatrix.m[10]);
            var n = e.subtract(this.position);
            this.rotation.y = n.x >= 0 ? -Math.atan(n.z / n.x) + Math.PI / 2 : -Math.atan(n.z / n.x) - Math.PI / 2, this.rotation.z = -Math.acos(t.Vector3.Dot(new t.Vector3(0, 1, 0), this.upVector)), isNaN(this.rotation.x) && (this.rotation.x = 0), isNaN(this.rotation.y) && (this.rotation.y = 0), isNaN(this.rotation.z) && (this.rotation.z = 0)
        }, n.prototype.getTarget = function() {
            return this._currentTarget
        }, n.prototype.attachControl = function(e, n) {
            var i, o = this, r = this.getEngine();
            this._attachedElement || (this._attachedElement = e, void 0 === this._onMouseDown && (this._onMouseDown = function(t) {
                                                                                                  i = {x: t.clientX,y: t.clientY}, n || t.preventDefault()
                                                                                                  }, this._onMouseUp = function(t) {
                                                                                                  i = null, n || t.preventDefault()
                                                                                                  }, this._onMouseOut = function(t) {
                                                                                                  i = null, o._keys = [], n || t.preventDefault()
                                                                                                  }, this._onMouseMove = function(t) {
                                                                                                  if (i || r.isPointerLock) {
                                                                                                  var e, s;
                                                                                                  r.isPointerLock ? (e = t.movementX || t.mozMovementX || t.webkitMovementX || t.msMovementX || 0, s = t.movementY || t.mozMovementY || t.webkitMovementY || t.msMovementY || 0) : (e = t.clientX - i.x, s = t.clientY - i.y), o.cameraRotation.y += e / o.angularSensibility, o.cameraRotation.x += s / o.angularSensibility, i = {x: t.clientX,y: t.clientY}, n || t.preventDefault()
                                                                                                  }
                                                                                                  }, this._onKeyDown = function(t) {
                                                                                                  if (-1 !== o.keysUp.indexOf(t.keyCode) || -1 !== o.keysDown.indexOf(t.keyCode) || -1 !== o.keysLeft.indexOf(t.keyCode) || -1 !== o.keysRight.indexOf(t.keyCode)) {
                                                                                                  var e = o._keys.indexOf(t.keyCode);
                                                                                                  -1 === e && o._keys.push(t.keyCode), n || t.preventDefault()
                                                                                                  }
                                                                                                  }, this._onKeyUp = function(t) {
                                                                                                  if (-1 !== o.keysUp.indexOf(t.keyCode) || -1 !== o.keysDown.indexOf(t.keyCode) || -1 !== o.keysLeft.indexOf(t.keyCode) || -1 !== o.keysRight.indexOf(t.keyCode)) {
                                                                                                  var e = o._keys.indexOf(t.keyCode);
                                                                                                  e >= 0 && o._keys.splice(e, 1), n || t.preventDefault()
                                                                                                  }
                                                                                                  }, this._onLostFocus = function() {
                                                                                                  o._keys = []
                                                                                                  }, this._reset = function() {
                                                                                                  o._keys = [], i = null, o.cameraDirection = new t.Vector3(0, 0, 0), o.cameraRotation = new t.Vector2(0, 0)
                                                                                                  }), e.addEventListener("mousedown", this._onMouseDown, !1), e.addEventListener("mouseup", this._onMouseUp, !1), e.addEventListener("mouseout", this._onMouseOut, !1), e.addEventListener("mousemove", this._onMouseMove, !1), t.Tools.RegisterTopRootEvents([{name: "keydown",handler: this._onKeyDown}, {name: "keyup",handler: this._onKeyUp}, {name: "blur",handler: this._onLostFocus}]))
        }, n.prototype.detachControl = function(e) {
            this._attachedElement == e && (e.removeEventListener("mousedown", this._onMouseDown), e.removeEventListener("mouseup", this._onMouseUp), e.removeEventListener("mouseout", this._onMouseOut), e.removeEventListener("mousemove", this._onMouseMove), t.Tools.UnregisterTopRootEvents([{name: "keydown",handler: this._onKeyDown}, {name: "keyup",handler: this._onKeyUp}, {name: "blur",handler: this._onLostFocus}]), this._attachedElement = null, this._reset && this._reset())
        }, n.prototype._collideWithWorld = function(e) {
            var n;
            n = this.parent ? t.Vector3.TransformCoordinates(this.position, this.parent.getWorldMatrix()) : this.position, n.subtractFromFloatsToRef(0, this.ellipsoid.y, 0, this._oldPosition), this._collider.radius = this.ellipsoid, this.getScene()._getNewPosition(this._oldPosition, e, this._collider, 3, this._newPosition), this._newPosition.subtractToRef(this._oldPosition, this._diffPosition), this._diffPosition.length() > t.Engine.CollisionsEpsilon && (this.position.addInPlace(this._diffPosition), this.onCollide && this.onCollide(this._collider.collidedMesh))
        }, n.prototype._checkInputs = function() {
            this._localDirection || (this._localDirection = t.Vector3.Zero(), this._transformedDirection = t.Vector3.Zero());
            for (var e = 0; e < this._keys.length; e++) {
                var n = this._keys[e], i = this._computeLocalCameraSpeed();
                -1 !== this.keysLeft.indexOf(n) ? this._localDirection.copyFromFloats(-i, 0, 0) : -1 !== this.keysUp.indexOf(n) ? this._localDirection.copyFromFloats(0, 0, i) : -1 !== this.keysRight.indexOf(n) ? this._localDirection.copyFromFloats(i, 0, 0) : -1 !== this.keysDown.indexOf(n) && this._localDirection.copyFromFloats(0, 0, -i), this.getViewMatrix().invertToRef(this._cameraTransformMatrix), t.Vector3.TransformNormalToRef(this._localDirection, this._cameraTransformMatrix, this._transformedDirection), this.cameraDirection.addInPlace(this._transformedDirection)
            }
        }, n.prototype._update = function() {
            this._checkInputs();
            var e = this._needMoveForGravity || Math.abs(this.cameraDirection.x) > 0 || Math.abs(this.cameraDirection.y) > 0 || Math.abs(this.cameraDirection.z) > 0, n = Math.abs(this.cameraRotation.x) > 0 || Math.abs(this.cameraRotation.y) > 0;
            if (e)
                if (this.checkCollisions && this.getScene().collisionsEnabled) {
                    if (this._collideWithWorld(this.cameraDirection), this.applyGravity) {
                        var i = this.position;
                        this._collideWithWorld(this.getScene().gravity), this._needMoveForGravity = 0 != t.Vector3.DistanceSquared(i, this.position)
                    }
                } else
                    this.position.addInPlace(this.cameraDirection);
            if (n && (this.rotation.x += this.cameraRotation.x, this.rotation.y += this.cameraRotation.y, !this.noRotationConstraint)) {
                var o = Math.PI / 2 * .95;
                this.rotation.x > o && (this.rotation.x = o), this.rotation.x < -o && (this.rotation.x = -o)
            }
            e && (Math.abs(this.cameraDirection.x) < t.Engine.Epsilon && (this.cameraDirection.x = 0), Math.abs(this.cameraDirection.y) < t.Engine.Epsilon && (this.cameraDirection.y = 0), Math.abs(this.cameraDirection.z) < t.Engine.Epsilon && (this.cameraDirection.z = 0), this.cameraDirection.scaleInPlace(this.inertia)), n && (Math.abs(this.cameraRotation.x) < t.Engine.Epsilon && (this.cameraRotation.x = 0), Math.abs(this.cameraRotation.y) < t.Engine.Epsilon && (this.cameraRotation.y = 0), this.cameraRotation.scaleInPlace(this.inertia))
        }, n.prototype._getViewMatrix = function() {
            return this.lockedTarget ? this._currentTarget.copyFrom(this._getLockedTargetPosition()) : (0 != this.upVector.x || 1 != this.upVector.y || 0 != this.upVector.z ? (t.Matrix.LookAtLHToRef(t.Vector3.Zero(), this._referencePoint, this.upVector, this._lookAtTemp), t.Matrix.RotationYawPitchRollToRef(this.rotation.y, this.rotation.x, this.rotation.z, this._cameraRotationMatrix), this._lookAtTemp.multiplyToRef(this._cameraRotationMatrix, this._tempMatrix), this._lookAtTemp.invert(), this._tempMatrix.multiplyToRef(this._lookAtTemp, this._cameraRotationMatrix)) : t.Matrix.RotationYawPitchRollToRef(this.rotation.y, this.rotation.x, this.rotation.z, this._cameraRotationMatrix), t.Vector3.TransformCoordinatesToRef(this._referencePoint, this._cameraRotationMatrix, this._transformedReferencePoint), this.position.addToRef(this._transformedReferencePoint, this._currentTarget)), t.Matrix.LookAtLHToRef(this.position, this._currentTarget, this.upVector, this._viewMatrix), this._viewMatrix
        }, n
    }(t.Camera);
    t.FreeCamera = e
}(BABYLON || (BABYLON = {}));
var __extends = this.__extends || function(t, e) {
    function n() {
        this.constructor = t
    }
    for (var i in e)
        e.hasOwnProperty(i) && (t[i] = e[i]);
    n.prototype = e.prototype, t.prototype = new n
}, BABYLON;
!function(t) {
    var e = function(e) {
        function n(t, n, i) {
            e.call(this, t, n, i), this._offsetX = null, this._offsetY = null, this._pointerCount = 0, this._pointerPressed = [], this.angularSensibility = 2e5, this.moveSensibility = 500
        }
        return __extends(n, e), n.prototype.attachControl = function(e, n) {
            var i, o = this;
            this._attachedCanvas || (this._attachedCanvas = e, void 0 === this._onPointerDown && (this._onPointerDown = function(t) {
                                                                                                  n || t.preventDefault(), o._pointerPressed.push(t.pointerId), 1 === o._pointerPressed.length && (i = {x: t.clientX,y: t.clientY})
                                                                                                  }, this._onPointerUp = function(t) {
                                                                                                  n || t.preventDefault();
                                                                                                  var e = o._pointerPressed.indexOf(t.pointerId);
                                                                                                  -1 !== e && (o._pointerPressed.splice(e, 1), 0 == e && (i = null, o._offsetX = null, o._offsetY = null))
                                                                                                  }, this._onPointerMove = function(t) {
                                                                                                  if (n || t.preventDefault(), i) {
                                                                                                  var e = o._pointerPressed.indexOf(t.pointerId);
                                                                                                  0 == e && (o._offsetX = t.clientX - i.x, o._offsetY = -(t.clientY - i.y))
                                                                                                  }
                                                                                                  }, this._onLostFocus = function() {
                                                                                                  o._offsetX = null, o._offsetY = null
                                                                                                  }), e.addEventListener("pointerdown", this._onPointerDown), e.addEventListener("pointerup", this._onPointerUp), e.addEventListener("pointerout", this._onPointerUp), e.addEventListener("pointermove", this._onPointerMove), t.Tools.RegisterTopRootEvents([{name: "blur",handler: this._onLostFocus}]))
        }, n.prototype.detachControl = function(e) {
            this._attachedCanvas == e && (e.removeEventListener("pointerdown", this._onPointerDown), e.removeEventListener("pointerup", this._onPointerUp), e.removeEventListener("pointerout", this._onPointerUp), e.removeEventListener("pointermove", this._onPointerMove), t.Tools.UnregisterTopRootEvents([{name: "blur",handler: this._onLostFocus}]), this._attachedCanvas = null)
        }, n.prototype._checkInputs = function() {
            if (this._offsetX)
                if (this.cameraRotation.y += this._offsetX / this.angularSensibility, this._pointerPressed.length > 1)
                    this.cameraRotation.x += -this._offsetY / this.angularSensibility;
                else {
                    var e = this._computeLocalCameraSpeed(), n = new t.Vector3(0, 0, e * this._offsetY / this.moveSensibility);
                    t.Matrix.RotationYawPitchRollToRef(this.rotation.y, this.rotation.x, 0, this._cameraRotationMatrix), this.cameraDirection.addInPlace(t.Vector3.TransformCoordinates(n, this._cameraRotationMatrix))
                }
        }, n
    }(t.FreeCamera);
    t.TouchCamera = e
}(BABYLON || (BABYLON = {}));
var __extends = this.__extends || function(t, e) {
    function n() {
        this.constructor = t
    }
    for (var i in e)
        e.hasOwnProperty(i) && (t[i] = e[i]);
    n.prototype = e.prototype, t.prototype = new n
}, BABYLON;
!function(t) {
    var e = t.Tools.GetPointerPrefix(), n = function(n) {
        function i(e, i, o, r, s, a) {
            n.call(this, e, t.Vector3.Zero(), a), this.alpha = i, this.beta = o, this.radius = r, this.target = s, this.inertialAlphaOffset = 0, this.inertialBetaOffset = 0, this.inertialRadiusOffset = 0, this.lowerAlphaLimit = null, this.upperAlphaLimit = null, this.lowerBetaLimit = .01, this.upperBetaLimit = Math.PI, this.lowerRadiusLimit = null, this.upperRadiusLimit = null, this.angularSensibility = 1e3, this.wheelPrecision = 3, this.keysUp = [38], this.keysDown = [40], this.keysLeft = [37], this.keysRight = [39], this.zoomOnFactor = 1, this._keys = [], this._viewMatrix = new t.Matrix, this.getViewMatrix()
        }
        return __extends(i, n), i.prototype._getTargetPosition = function() {
            return this.target.position || this.target
        }, i.prototype._initCache = function() {
            n.prototype._initCache.call(this), this._cache.target = new t.Vector3(Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE), this._cache.alpha = void 0, this._cache.beta = void 0, this._cache.radius = void 0
        }, i.prototype._updateCache = function(t) {
            t || n.prototype._updateCache.call(this), this._cache.target.copyFrom(this._getTargetPosition()), this._cache.alpha = this.alpha, this._cache.beta = this.beta, this._cache.radius = this.radius
        }, i.prototype._isSynchronizedViewMatrix = function() {
            return n.prototype._isSynchronizedViewMatrix.call(this) ? this._cache.target.equals(this._getTargetPosition()) && this._cache.alpha === this.alpha && this._cache.beta === this.beta && this._cache.radius === this.radius : !1
        }, i.prototype.attachControl = function(n, i) {
            var o, r, s = this;
            if (!this._attachedElement) {
                this._attachedElement = n;
                var a = this.getEngine();
                void 0 === this._onPointerDown && (this._onPointerDown = function(t) {
                                                   r || (r = t.pointerId, o = {x: t.clientX,y: t.clientY}, i || t.preventDefault())
                                                   }, this._onPointerUp = function(t) {
                                                   o = null, r = null, i || t.preventDefault()
                                                   }, this._onPointerMove = function(t) {
                                                   if (o && r === t.pointerId) {
                                                   var e = t.clientX - o.x, n = t.clientY - o.y;
                                                   s.inertialAlphaOffset -= e / s.angularSensibility, s.inertialBetaOffset -= n / s.angularSensibility, o = {x: t.clientX,y: t.clientY}, i || t.preventDefault()
                                                   }
                                                   }, this._onMouseMove = function(t) {
                                                   if (a.isPointerLock) {
                                                   var e = t.movementX || t.mozMovementX || t.webkitMovementX || t.msMovementX || 0, n = t.movementY || t.mozMovementY || t.webkitMovementY || t.msMovementY || 0;
                                                   s.inertialAlphaOffset -= e / s.angularSensibility, s.inertialBetaOffset -= n / s.angularSensibility, i || t.preventDefault()
                                                   }
                                                   }, this._wheel = function(t) {
                                                   var e = 0;
                                                   t.wheelDelta ? e = t.wheelDelta / (40 * s.wheelPrecision) : t.detail && (e = -t.detail / s.wheelPrecision), e && (s.inertialRadiusOffset += e), t.preventDefault && (i || t.preventDefault())
                                                   }, this._onKeyDown = function(t) {
                                                   if (-1 !== s.keysUp.indexOf(t.keyCode) || -1 !== s.keysDown.indexOf(t.keyCode) || -1 !== s.keysLeft.indexOf(t.keyCode) || -1 !== s.keysRight.indexOf(t.keyCode)) {
                                                   var e = s._keys.indexOf(t.keyCode);
                                                   -1 === e && s._keys.push(t.keyCode), t.preventDefault && (i || t.preventDefault())
                                                   }
                                                   }, this._onKeyUp = function(t) {
                                                   if (-1 !== s.keysUp.indexOf(t.keyCode) || -1 !== s.keysDown.indexOf(t.keyCode) || -1 !== s.keysLeft.indexOf(t.keyCode) || -1 !== s.keysRight.indexOf(t.keyCode)) {
                                                   var e = s._keys.indexOf(t.keyCode);
                                                   e >= 0 && s._keys.splice(e, 1), t.preventDefault && (i || t.preventDefault())
                                                   }
                                                   }, this._onLostFocus = function() {
                                                   s._keys = [], r = null
                                                   }, this._onGestureStart = function(t) {
                                                   void 0 !== window.MSGesture && (s._MSGestureHandler || (s._MSGestureHandler = new MSGesture, s._MSGestureHandler.target = n), s._MSGestureHandler.addPointer(t.pointerId))
                                                   }, this._onGesture = function(t) {
                                                   s.radius *= t.scale, t.preventDefault && (i || (t.stopPropagation(), t.preventDefault()))
                                                   }, this._reset = function() {
                                                   s._keys = [], s.inertialAlphaOffset = 0, s.inertialBetaOffset = 0, s.inertialRadiusOffset = 0, o = null, r = null
                                                   }), n.addEventListener(e + "down", this._onPointerDown, !1), n.addEventListener(e + "up", this._onPointerUp, !1), n.addEventListener(e + "out", this._onPointerUp, !1), n.addEventListener(e + "move", this._onPointerMove, !1), n.addEventListener("mousemove", this._onMouseMove, !1), n.addEventListener("MSPointerDown", this._onGestureStart, !1), n.addEventListener("MSGestureChange", this._onGesture, !1), n.addEventListener("mousewheel", this._wheel, !1), n.addEventListener("DOMMouseScroll", this._wheel, !1), t.Tools.RegisterTopRootEvents([{name: "keydown",handler: this._onKeyDown}, {name: "keyup",handler: this._onKeyUp}, {name: "blur",handler: this._onLostFocus}])
            }
        }, i.prototype.detachControl = function(n) {
            this._attachedElement == n && (n.removeEventListener(e + "down", this._onPointerDown), n.removeEventListener(e + "up", this._onPointerUp), n.removeEventListener(e + "out", this._onPointerUp), n.removeEventListener(e + "move", this._onPointerMove), n.removeEventListener("mousemove", this._onMouseMove), n.removeEventListener("MSPointerDown", this._onGestureStart), n.removeEventListener("MSGestureChange", this._onGesture), n.removeEventListener("mousewheel", this._wheel), n.removeEventListener("DOMMouseScroll", this._wheel), t.Tools.UnregisterTopRootEvents([{name: "keydown",handler: this._onKeyDown}, {name: "keyup",handler: this._onKeyUp}, {name: "blur",handler: this._onLostFocus}]), this._MSGestureHandler = null, this._attachedElement = null, this._reset && this._reset())
        }, i.prototype._update = function() {
            for (var e = 0; e < this._keys.length; e++) {
                var n = this._keys[e];
                -1 !== this.keysLeft.indexOf(n) ? this.inertialAlphaOffset -= .01 : -1 !== this.keysUp.indexOf(n) ? this.inertialBetaOffset -= .01 : -1 !== this.keysRight.indexOf(n) ? this.inertialAlphaOffset += .01 : -1 !== this.keysDown.indexOf(n) && (this.inertialBetaOffset += .01)
            }
            (0 != this.inertialAlphaOffset || 0 != this.inertialBetaOffset || 0 != this.inertialRadiusOffset) && (this.alpha += this.inertialAlphaOffset, this.beta += this.inertialBetaOffset, this.radius -= this.inertialRadiusOffset, this.inertialAlphaOffset *= this.inertia, this.inertialBetaOffset *= this.inertia, this.inertialRadiusOffset *= this.inertia, Math.abs(this.inertialAlphaOffset) < t.Engine.Epsilon && (this.inertialAlphaOffset = 0), Math.abs(this.inertialBetaOffset) < t.Engine.Epsilon && (this.inertialBetaOffset = 0), Math.abs(this.inertialRadiusOffset) < t.Engine.Epsilon && (this.inertialRadiusOffset = 0)), this.lowerAlphaLimit && this.alpha < this.lowerAlphaLimit && (this.alpha = this.lowerAlphaLimit), this.upperAlphaLimit && this.alpha > this.upperAlphaLimit && (this.alpha = this.upperAlphaLimit), this.lowerBetaLimit && this.beta < this.lowerBetaLimit && (this.beta = this.lowerBetaLimit), this.upperBetaLimit && this.beta > this.upperBetaLimit && (this.beta = this.upperBetaLimit), this.lowerRadiusLimit && this.radius < this.lowerRadiusLimit && (this.radius = this.lowerRadiusLimit), this.upperRadiusLimit && this.radius > this.upperRadiusLimit && (this.radius = this.upperRadiusLimit)
        }, i.prototype.setPosition = function(t) {
            var e = t.subtract(this._getTargetPosition());
            this.radius = e.length(), this.alpha = Math.acos(e.x / Math.sqrt(Math.pow(e.x, 2) + Math.pow(e.z, 2))), e.z < 0 && (this.alpha = 2 * Math.PI - this.alpha), this.beta = Math.acos(e.y / this.radius)
        }, i.prototype._getViewMatrix = function() {
            var e = Math.cos(this.alpha), n = Math.sin(this.alpha), i = Math.cos(this.beta), o = Math.sin(this.beta), r = this._getTargetPosition();
            return r.addToRef(new t.Vector3(this.radius * e * o, this.radius * i, this.radius * n * o), this.position), t.Matrix.LookAtLHToRef(this.position, r, this.upVector, this._viewMatrix), this._viewMatrix
        }, i.prototype.zoomOn = function(e) {
            e = e || this.getScene().meshes;
            var n = t.Mesh.MinMax(e), i = t.Vector3.Distance(n.min, n.max);
            this.radius = i * this.zoomOnFactor, this.focusOn({min: n.min,max: n.max,distance: i})
        }, i.prototype.focusOn = function(e) {
            var n, i;
            void 0 === e.min ? (n = e || this.getScene().meshes, n = t.Mesh.MinMax(n), i = t.Vector3.Distance(n.min, n.max)) : (n = e, i = e.distance), this.target = t.Mesh.Center(n), this.maxZ = 2 * i
        }, i
    }(t.Camera);
    t.ArcRotateCamera = n
}(BABYLON || (BABYLON = {}));
var __extends = this.__extends || function(t, e) {
    function n() {
        this.constructor = t
    }
    for (var i in e)
        e.hasOwnProperty(i) && (t[i] = e[i]);
    n.prototype = e.prototype, t.prototype = new n
}, BABYLON;
!function(t) {
    var e = function(e) {
        function n(t, n, i) {
            var o = this;
            e.call(this, t, n, i), this._offsetX = null, this._offsetY = null, this._orientationGamma = 0, this._orientationBeta = 0, this._initialOrientationGamma = 0, this._initialOrientationBeta = 0, this.angularSensibility = 1e4, this.moveSensibility = 50, window.addEventListener("resize", function() {
                                                                                                                                                                                                                                                                                             o._initialOrientationGamma = null
                                                                                                                                                                                                                                                                                             }, !1)
        }
        return __extends(n, e), n.prototype.attachControl = function(t) {
            var e = this;
            this._attachedCanvas || (this._attachedCanvas = t, this._orientationChanged || (this._orientationChanged = function(t) {
                                                                                            e._initialOrientationGamma || (e._initialOrientationGamma = t.gamma, e._initialOrientationBeta = t.beta), e._orientationGamma = t.gamma, e._orientationBeta = t.beta, e._offsetY = e._initialOrientationBeta - e._orientationBeta, e._offsetX = e._initialOrientationGamma - e._orientationGamma
                                                                                            }), window.addEventListener("deviceorientation", this._orientationChanged))
        }, n.prototype.detachControl = function(t) {
            this._attachedCanvas == t && (window.removeEventListener("deviceorientation", this._orientationChanged), this._attachedCanvas = null, this._orientationGamma = 0, this._orientationBeta = 0, this._initialOrientationGamma = 0, this._initialOrientationBeta = 0)
        }, n.prototype._checkInputs = function() {
            if (this._offsetX) {
                this.cameraRotation.y -= this._offsetX / this.angularSensibility;
                var e = this._computeLocalCameraSpeed(), n = new t.Vector3(0, 0, e * this._offsetY / this.moveSensibility);
                t.Matrix.RotationYawPitchRollToRef(this.rotation.y, this.rotation.x, 0, this._cameraRotationMatrix), this.cameraDirection.addInPlace(t.Vector3.TransformCoordinates(n, this._cameraRotationMatrix))
            }
        }, n
    }(t.FreeCamera);
    t.DeviceOrientationCamera = e
}(BABYLON || (BABYLON = {}));
var BABYLON;
!function(t) {
    var e = function() {
        function e(t) {
            this._renderingGroups = new Array, this._scene = t
        }
        return e.prototype._renderParticles = function(t, e) {
            if (0 !== this._scene._activeParticleSystems.length) {
                for (var n = (new Date).getTime(), i = 0; i < this._scene._activeParticleSystems.length; i++) {
                    var o = this._scene._activeParticleSystems.data[i];
                    o.renderingGroupId === t && (this._clearDepthBuffer(), o.emitter.position && e && -1 === e.indexOf(o.emitter) || (this._scene._activeParticles += o.render()))
                }
                this._scene._particlesDuration += (new Date).getTime() - n
            }
        }, e.prototype._renderSprites = function(t) {
            if (0 !== this._scene.spriteManagers.length) {
                for (var e = (new Date).getTime(), n = 0; n < this._scene.spriteManagers.length; n++) {
                    var i = this._scene.spriteManagers[n];
                    i.renderingGroupId === t && (this._clearDepthBuffer(), i.render())
                }
                this._scene._spritesDuration += (new Date).getTime() - e
            }
        }, e.prototype._clearDepthBuffer = function() {
            this._depthBufferAlreadyCleaned || (this._scene.getEngine().clear(0, !1, !0), this._depthBufferAlreadyCleaned = !0)
        }, e.prototype.render = function(e, n, i, o) {
            for (var r = this, s = 0; s < t.RenderingManager.MAX_RENDERINGGROUPS; s++) {
                this._depthBufferAlreadyCleaned = !1;
                var a = this._renderingGroups[s];
                a ? (this._clearDepthBuffer(), a.render(e, function() {
                                                        o && r._renderSprites(s)
                                                        }) || this._renderingGroups.splice(s, 1)) : o && this._renderSprites(s), i && this._renderParticles(s, n)
            }
        }, e.prototype.reset = function() {
            for (var t in this._renderingGroups) {
                var e = this._renderingGroups[t];
                e.prepare()
            }
        }, e.prototype.dispatch = function(e) {
            var n = e.getMesh(), i = n.renderingGroupId || 0;
            this._renderingGroups[i] || (this._renderingGroups[i] = new t.RenderingGroup(i, this._scene)), this._renderingGroups[i].dispatch(e)
        }, e.MAX_RENDERINGGROUPS = 4, e
    }();
    t.RenderingManager = e
}(BABYLON || (BABYLON = {}));
var BABYLON;
!function(t) {
    var e = function() {
        function e(e, n) {
            this.index = e, this._opaqueSubMeshes = new t.SmartArray(256), this._transparentSubMeshes = new t.SmartArray(256), this._alphaTestSubMeshes = new t.SmartArray(256), this._scene = n
        }
        return e.prototype.render = function(e, n) {
            if (e)
                return e(this._opaqueSubMeshes, this._alphaTestSubMeshes, this._transparentSubMeshes, n), !0;
            if (0 === this._opaqueSubMeshes.length && 0 === this._alphaTestSubMeshes.length && 0 === this._transparentSubMeshes.length)
                return !1;
            var i, o, r = this._scene.getEngine();
            for (this._opaqueSubMeshes.sort(function(t, e) {
                                            return (t.category || 0) - (e.category || 0)
                                            }), i = 0; i < this._opaqueSubMeshes.length; i++)
                o = this._opaqueSubMeshes.data[i], this._activeVertices += o.verticesCount, o.render();
            for (r.setAlphaTesting(!0), i = 0; i < this._alphaTestSubMeshes.length; i++)
                o = this._alphaTestSubMeshes.data[i], this._activeVertices += o.verticesCount, o.render();
            if (r.setAlphaTesting(!1), n && n(), this._transparentSubMeshes.length) {
                for (i = 0; i < this._transparentSubMeshes.length; i++)
                    o = this._transparentSubMeshes.data[i], o._distanceToCamera = o.getBoundingInfo().boundingSphere.centerWorld.subtract(this._scene.activeCamera.position).length();
                var s = this._transparentSubMeshes.data.slice(0, this._transparentSubMeshes.length);
                for (s.sort(function(t, e) {
                            return t._distanceToCamera < e._distanceToCamera ? 1 : t._distanceToCamera > e._distanceToCamera ? -1 : 0
                            }), r.setAlphaMode(t.Engine.ALPHA_COMBINE), i = 0; i < s.length; i++)
                    o = s[i], this._activeVertices += o.verticesCount, o.render();
                r.setAlphaMode(t.Engine.ALPHA_DISABLE)
            }
            return !0
        }, e.prototype.prepare = function() {
            this._opaqueSubMeshes.reset(), this._transparentSubMeshes.reset(), this._alphaTestSubMeshes.reset()
        }, e.prototype.dispatch = function(t) {
            var e = t.getMaterial(), n = t.getMesh();
            e.needAlphaBlending() || n.visibility < 1 ? (e.alpha > 0 || n.visibility < 1) && this._transparentSubMeshes.push(t) : e.needAlphaTesting() ? this._alphaTestSubMeshes.push(t) : this._opaqueSubMeshes.push(t)
        }, e
    }();
    t.RenderingGroup = e
}(BABYLON || (BABYLON = {}));
var BABYLON;
!function(t) {
    var e = function() {
        function e(e) {
            this.autoClear = !0, this.clearColor = new t.Color3(.2, .2, .3), this.ambientColor = new t.Color3(0, 0, 0), this.forceWireframe = !1, this.cameraToUseForPointers = null, this.fogMode = t.Scene.FOGMODE_NONE, this.fogColor = new t.Color3(.2, .2, .3), this.fogDensity = .1, this.fogStart = 0, this.fogEnd = 1e3, this.lightsEnabled = !0, this.lights = new Array, this.cameras = new Array, this.activeCameras = new Array, this.meshes = new Array, this._geometries = new Array, this.materials = new Array, this.multiMaterials = new Array, this.defaultMaterial = new t.StandardMaterial("default material", this), this.texturesEnabled = !0, this.textures = new Array, this.particlesEnabled = !0, this.particleSystems = new Array, this.spriteManagers = new Array, this.layers = new Array, this.skeletons = new Array, this.lensFlareSystems = new Array, this.collisionsEnabled = !0, this.gravity = new t.Vector3(0, -9, 0), this.postProcessesEnabled = !0, this.renderTargetsEnabled = !0, this.customRenderTargets = new Array, this.importedMeshesFiles = new Array, this._actionManagers = new Array, this._meshesForIntersections = new t.SmartArray(256), this._totalVertices = 0, this._activeVertices = 0, this._activeParticles = 0, this._lastFrameDuration = 0, this._evaluateActiveMeshesDuration = 0, this._renderTargetsDuration = 0, this._particlesDuration = 0, this._renderDuration = 0, this._spritesDuration = 0, this._animationRatio = 0, this._renderId = 0, this._executeWhenReadyTimeoutId = -1, this._toBeDisposed = new t.SmartArray(256), this._onReadyCallbacks = new Array, this._pendingData = [], this._onBeforeRenderCallbacks = new Array, this._activeMeshes = new t.SmartArray(256), this._processedMaterials = new t.SmartArray(256), this._renderTargets = new t.SmartArray(256), this._activeParticleSystems = new t.SmartArray(256), this._activeSkeletons = new t.SmartArray(32), this._activeAnimatables = new Array, this._transformMatrix = t.Matrix.Zero(), this._scaledPosition = t.Vector3.Zero(), this._scaledVelocity = t.Vector3.Zero(), this._engine = e, e.scenes.push(this), this._renderingManager = new t.RenderingManager(this), this.postProcessManager = new t.PostProcessManager(this), this.postProcessRenderPipelineManager = new t.PostProcessRenderPipelineManager, this._boundingBoxRenderer = new t.BoundingBoxRenderer(this)
        }
        return Object.defineProperty(e.prototype, "meshUnderPointer", {get: function() {
                                     return this._meshUnderPointer
                                     },enumerable: !0,configurable: !0}), Object.defineProperty(e.prototype, "pointerX", {get: function() {
                                                                                                return this._pointerX
                                                                                                },enumerable: !0,configurable: !0}), Object.defineProperty(e.prototype, "pointerY", {get: function() {
                                                                                                                                                           return this._pointerY
                                                                                                                                                           },enumerable: !0,configurable: !0}), e.prototype.getBoundingBoxRenderer = function() {
            return this._boundingBoxRenderer
        }, e.prototype.getEngine = function() {
            return this._engine
        }, e.prototype.getTotalVertices = function() {
            return this._totalVertices
        }, e.prototype.getActiveVertices = function() {
            return this._activeVertices
        }, e.prototype.getActiveParticles = function() {
            return this._activeParticles
        }, e.prototype.getLastFrameDuration = function() {
            return this._lastFrameDuration
        }, e.prototype.getEvaluateActiveMeshesDuration = function() {
            return this._evaluateActiveMeshesDuration
        }, e.prototype.getActiveMeshes = function() {
            return this._activeMeshes
        }, e.prototype.getRenderTargetsDuration = function() {
            return this._renderTargetsDuration
        }, e.prototype.getRenderDuration = function() {
            return this._renderDuration
        }, e.prototype.getParticlesDuration = function() {
            return this._particlesDuration
        }, e.prototype.getSpritesDuration = function() {
            return this._spritesDuration
        }, e.prototype.getAnimationRatio = function() {
            return this._animationRatio
        }, e.prototype.getRenderId = function() {
            return this._renderId
        }, e.prototype._updatePointerPosition = function(t) {
            var e = this._engine.getRenderingCanvasClientRect();
            this._pointerX = t.clientX - e.left, this._pointerY = t.clientY - e.top, this.cameraToUseForPointers && (this._pointerX = this._pointerX - this.cameraToUseForPointers.viewport.x * this._engine.getRenderWidth(), this._pointerY = this._pointerY - this.cameraToUseForPointers.viewport.y * this._engine.getRenderHeight())
        }, e.prototype.attachControl = function() {
            var e = this;
            this._onPointerMove = function(t) {
                var n = e._engine.getRenderingCanvas();
                e._updatePointerPosition(t);
                var i = e.pick(e._pointerX, e._pointerY, function(t) {
                               return t.isPickable && t.isVisible && t.isReady() && t.actionManager && t.actionManager.hasPointerTriggers
                               }, !1, e.cameraToUseForPointers);
                i.hit ? (e.setPointerOverMesh(i.pickedMesh), n.style.cursor = "pointer", e._meshUnderPointer = i.pickedMesh) : (e.setPointerOverMesh(null), n.style.cursor = "", e._meshUnderPointer = null)
            }, this._onPointerDown = function(n) {
                var i = null;
                e.onPointerDown || (i = function(t) {
                                    return t.isPickable && t.isVisible && t.isReady() && t.actionManager && t.actionManager.hasPickTriggers
                                    }), e._updatePointerPosition(n);
                var o = e.pick(e._pointerX, e._pointerY, i, !1, e.cameraToUseForPointers);
                if (o.hit && o.pickedMesh.actionManager) {
                    switch (n.button) {
                        case 0:
                            o.pickedMesh.actionManager.processTrigger(t.ActionManager.OnLeftPickTrigger, t.ActionEvent.CreateNew(o.pickedMesh));
                            break;
                        case 1:
                            o.pickedMesh.actionManager.processTrigger(t.ActionManager.OnCenterPickTrigger, t.ActionEvent.CreateNew(o.pickedMesh));
                            break;
                        case 2:
                            o.pickedMesh.actionManager.processTrigger(t.ActionManager.OnRightPickTrigger, t.ActionEvent.CreateNew(o.pickedMesh))
                    }
                    o.pickedMesh.actionManager.processTrigger(t.ActionManager.OnPickTrigger, t.ActionEvent.CreateNew(o.pickedMesh))
                }
                e.onPointerDown && e.onPointerDown(n, o)
            };
            var n = t.Tools.GetPointerPrefix();
            this._engine.getRenderingCanvas().addEventListener(n + "move", this._onPointerMove, !1), this._engine.getRenderingCanvas().addEventListener(n + "down", this._onPointerDown, !1)
        }, e.prototype.detachControl = function() {
            var e = t.Tools.GetPointerPrefix();
            this._engine.getRenderingCanvas().removeEventListener(e + "move", this._onPointerMove), this._engine.getRenderingCanvas().removeEventListener(e + "down", this._onPointerDown)
        }, e.prototype.isReady = function() {
            if (this._pendingData.length > 0)
                return !1;
            for (var e = 0; e < this._geometries.length; e++) {
                var n = this._geometries[e];
                if (n.delayLoadState === t.Engine.DELAYLOADSTATE_LOADING)
                    return !1
                    }
            for (e = 0; e < this.meshes.length; e++) {
                var i = this.meshes[e];
                if (!i.isReady())
                    return !1;
                var o = i.material;
                if (o && !o.isReady(i))
                    return !1
                    }
            return !0
        }, e.prototype.registerBeforeRender = function(t) {
            this._onBeforeRenderCallbacks.push(t)
        }, e.prototype.unregisterBeforeRender = function(t) {
            var e = this._onBeforeRenderCallbacks.indexOf(t);
            e > -1 && this._onBeforeRenderCallbacks.splice(e, 1)
        }, e.prototype._addPendingData = function(t) {
            this._pendingData.push(t)
        }, e.prototype._removePendingData = function(t) {
            var e = this._pendingData.indexOf(t);
            -1 !== e && this._pendingData.splice(e, 1)
        }, e.prototype.getWaitingItemsCount = function() {
            return this._pendingData.length
        }, e.prototype.executeWhenReady = function(t) {
            var e = this;
            this._onReadyCallbacks.push(t), -1 === this._executeWhenReadyTimeoutId && (this._executeWhenReadyTimeoutId = setTimeout(function() {
                                                                                                                                    e._checkIsReady()
                                                                                                                                    }, 150))
        }, e.prototype._checkIsReady = function() {
            var t = this;
            return this.isReady() ? (this._onReadyCallbacks.forEach(function(t) {
                                                                    t()
                                                                    }), this._onReadyCallbacks = [], void (this._executeWhenReadyTimeoutId = -1)) : void (this._executeWhenReadyTimeoutId = setTimeout(function() {
                                                                                                                                                                                                       t._checkIsReady()
                                                                                                                                                                                                       }, 150))
        }, e.prototype.beginAnimation = function(e, n, i, o, r, s, a) {
            if (void 0 === r && (r = 1), this.stopAnimation(e), a || (a = new t.Animatable(this, e, n, i, o, r, s)), e.animations && a.appendAnimations(e, e.animations), e.getAnimatables)
                for (var l = e.getAnimatables(), h = 0; h < l.length; h++)
                    this.beginAnimation(l[h], n, i, o, r, s, a);
            return a
        }, e.prototype.beginDirectAnimation = function(e, n, i, o, r, s, a) {
            void 0 === s && (s = 1);
            var l = new t.Animatable(this, e, i, o, r, s, a, n);
            return l
        }, e.prototype.getAnimatableByTarget = function(t) {
            for (var e = 0; e < this._activeAnimatables.length; e++)
                if (this._activeAnimatables[e].target === t)
                    return this._activeAnimatables[e];
            return null
        }, e.prototype.stopAnimation = function(t) {
            var e = this.getAnimatableByTarget(t);
            e && e.stop()
        }, e.prototype._animate = function() {
            this._animationStartDate || (this._animationStartDate = (new Date).getTime());
            for (var t = (new Date).getTime(), e = t - this._animationStartDate, n = 0; n < this._activeAnimatables.length; n++)
                this._activeAnimatables[n]._animate(e) || (this._activeAnimatables.splice(n, 1), n--)
                }, e.prototype.getViewMatrix = function() {
                    return this._viewMatrix
                }, e.prototype.getProjectionMatrix = function() {
                    return this._projectionMatrix
                }, e.prototype.getTransformMatrix = function() {
                    return this._transformMatrix
                }, e.prototype.setTransformMatrix = function(t, e) {
                    this._viewMatrix = t, this._projectionMatrix = e, this._viewMatrix.multiplyToRef(this._projectionMatrix, this._transformMatrix)
                }, e.prototype.setActiveCameraByID = function(t) {
                    var e = this.getCameraByID(t);
                    return e ? (this.activeCamera = e, e) : null
                }, e.prototype.setActiveCameraByName = function(t) {
                    var e = this.getCameraByName(t);
                    return e ? (this.activeCamera = e, e) : null
                }, e.prototype.getMaterialByID = function(t) {
                    for (var e = 0; e < this.materials.length; e++)
                        if (this.materials[e].id === t)
                            return this.materials[e];
                    return null
                }, e.prototype.getMaterialByName = function(t) {
                    for (var e = 0; e < this.materials.length; e++)
                        if (this.materials[e].name === t)
                            return this.materials[e];
                    return null
                }, e.prototype.getCameraByID = function(t) {
                    for (var e = 0; e < this.cameras.length; e++)
                        if (this.cameras[e].id === t)
                            return this.cameras[e];
                    return null
                }, e.prototype.getCameraByName = function(t) {
                    for (var e = 0; e < this.cameras.length; e++)
                        if (this.cameras[e].name === t)
                            return this.cameras[e];
                    return null
                }, e.prototype.getLightByName = function(t) {
                    for (var e = 0; e < this.lights.length; e++)
                        if (this.lights[e].name === t)
                            return this.lights[e];
                    return null
                }, e.prototype.getLightByID = function(t) {
                    for (var e = 0; e < this.lights.length; e++)
                        if (this.lights[e].id === t)
                            return this.lights[e];
                    return null
                }, e.prototype.getGeometryByID = function(t) {
                    for (var e = 0; e < this._geometries.length; e++)
                        if (this._geometries[e].id === t)
                            return this._geometries[e];
                    return null
                }, e.prototype.pushGeometry = function(t, e) {
                    return !e && this.getGeometryByID(t.id) ? !1 : (this._geometries.push(t), !0)
                }, e.prototype.getGeometries = function() {
                    return this._geometries
                }, e.prototype.getMeshByID = function(t) {
                    for (var e = 0; e < this.meshes.length; e++)
                        if (this.meshes[e].id === t)
                            return this.meshes[e];
                    return null
                }, e.prototype.getLastMeshByID = function(t) {
                    for (var e = this.meshes.length - 1; e >= 0; e--)
                        if (this.meshes[e].id === t)
                            return this.meshes[e];
                    return null
                }, e.prototype.getLastEntryByID = function(t) {
                    for (var e = this.meshes.length - 1; e >= 0; e--)
                        if (this.meshes[e].id === t)
                            return this.meshes[e];
                    for (e = this.cameras.length - 1; e >= 0; e--)
                        if (this.cameras[e].id === t)
                            return this.cameras[e];
                    for (e = this.lights.length - 1; e >= 0; e--)
                        if (this.lights[e].id === t)
                            return this.lights[e];
                    return null
                }, e.prototype.getMeshByName = function(t) {
                    for (var e = 0; e < this.meshes.length; e++)
                        if (this.meshes[e].name === t)
                            return this.meshes[e];
                    return null
                }, e.prototype.getLastSkeletonByID = function(t) {
                    for (var e = this.skeletons.length - 1; e >= 0; e--)
                        if (this.skeletons[e].id === t)
                            return this.skeletons[e];
                    return null
                }, e.prototype.getSkeletonById = function(t) {
                    for (var e = 0; e < this.skeletons.length; e++)
                        if (this.skeletons[e].id === t)
                            return this.skeletons[e];
                    return null
                }, e.prototype.getSkeletonByName = function(t) {
                    for (var e = 0; e < this.skeletons.length; e++)
                        if (this.skeletons[e].name === t)
                            return this.skeletons[e];
                    return null
                }, e.prototype.isActiveMesh = function(t) {
                    return -1 !== this._activeMeshes.indexOf(t)
                }, e.prototype._evaluateSubMesh = function(t, e) {
                    if (1 == e.subMeshes.length || t.isInFrustum(this._frustumPlanes)) {
                        var n = t.getMaterial();
                        e.showSubMeshesBoundingBox && this._boundingBoxRenderer.renderList.push(t.getBoundingInfo().boundingBox), n && (n.getRenderTargetTextures && -1 === this._processedMaterials.indexOf(n) && (this._processedMaterials.push(n), this._renderTargets.concat(n.getRenderTargetTextures())), this._activeVertices += t.verticesCount, this._renderingManager.dispatch(t))
                    }
                }, e.prototype._evaluateActiveMeshes = function() {
                    this._activeMeshes.reset(), this._renderingManager.reset(), this._processedMaterials.reset(), this._activeParticleSystems.reset(), this._activeSkeletons.reset(), this._boundingBoxRenderer.reset(), this._frustumPlanes ? t.Frustum.GetPlanesToRef(this._transformMatrix, this._frustumPlanes) : this._frustumPlanes = t.Frustum.GetPlanes(this._transformMatrix);
                    var e, n;
                    if (this._selectionOctree) {
                        var i = this._selectionOctree.select(this._frustumPlanes);
                        e = i.data, n = i.length
                    } else
                        n = this.meshes.length, e = this.meshes;
                    for (var o = 0; n > o; o++) {
                        var r = e[o];
                        this._totalVertices += r.getTotalVertices(), r.isReady() && (r.computeWorldMatrix(), r._preActivate(), r.actionManager && r.actionManager.hasSpecificTriggers([t.ActionManager.OnIntersectionEnterTrigger, t.ActionManager.OnIntersectionExitTrigger]) && this._meshesForIntersections.pushNoDuplicate(r), r.isEnabled() && r.isVisible && r.visibility > 0 && 0 != (r.layerMask & this.activeCamera.layerMask) && r.isInFrustum(this._frustumPlanes) && (this._activeMeshes.push(r), r._activate(this._renderId), this._activeMesh(r)))
                    }
                    var s = (new Date).getTime();
                    if (this.particlesEnabled)
                        for (var a = 0; a < this.particleSystems.length; a++) {
                            var l = this.particleSystems[a];
                            l.isStarted() && (!l.emitter.position || l.emitter && l.emitter.isEnabled()) && (this._activeParticleSystems.push(l), l.animate())
                        }
                    this._particlesDuration += (new Date).getTime() - s
                }, e.prototype._activeMesh = function(t) {
                    if (t.skeleton && this._activeSkeletons.pushNoDuplicate(t.skeleton), t.showBoundingBox && this._boundingBoxRenderer.renderList.push(t.getBoundingInfo().boundingBox), t.subMeshes) {
                        var e, n;
                        if (t._submeshesOctree && t.useOctreeForRenderingSelection) {
                            var i = t._submeshesOctree.select(this._frustumPlanes);
                            e = i.length, n = i.data
                        } else
                            n = t.subMeshes, e = n.length;
                        for (var o = 0; e > o; o++) {
                            var r = n[o];
                            this._evaluateSubMesh(r, t)
                        }
                    }
                }, e.prototype.updateTransformMatrix = function(t) {
                    this.setTransformMatrix(this.activeCamera.getViewMatrix(), this.activeCamera.getProjectionMatrix(t))
                }, e.prototype._renderForCamera = function(t) {
                    var e = this._engine;
                    if (this.activeCamera = t, !this.activeCamera)
                        throw new Error("Active camera not set");
                    e.setViewport(this.activeCamera.viewport), this._renderId++, this.updateTransformMatrix(), this.beforeCameraRender && this.beforeCameraRender(this.activeCamera);
                    var n = (new Date).getTime();
                    this._evaluateActiveMeshes(), this._evaluateActiveMeshesDuration += (new Date).getTime() - n;
                    for (var i = 0; i < this._activeSkeletons.length; i++) {
                        var o = this._activeSkeletons.data[i];
                        o.prepare()
                    }
                    for (var r = 0; r < this.customRenderTargets.length; r++) {
                        var s = this.customRenderTargets[r];
                        this._renderTargets.push(s)
                    }
                    var a = (new Date).getTime();
                    if (this.renderTargetsEnabled) {
                        for (var l = 0; l < this._renderTargets.length; l++)
                            s = this._renderTargets.data[l], s._shouldRender() && (this._renderId++, s.render());
                        this._renderId++
                    }
                    this._renderTargets.length > 0 && e.restoreDefaultFramebuffer(), this._renderTargetsDuration = (new Date).getTime() - a, this.postProcessManager._prepareFrame();
                    var h = (new Date).getTime();
                    if (this.layers.length) {
                        e.setDepthBuffer(!1);
                        var c, u;
                        for (c = 0; c < this.layers.length; c++)
                            u = this.layers[c], u.isBackground && u.render();
                        e.setDepthBuffer(!0)
                    }
                    this._renderingManager.render(null, null, !0, !0), this._boundingBoxRenderer.render();
                    for (var p = 0; p < this.lensFlareSystems.length; p++)
                        this.lensFlareSystems[p].render();
                    if (this.layers.length) {
                        for (e.setDepthBuffer(!1), c = 0; c < this.layers.length; c++)
                            u = this.layers[c], u.isBackground || u.render();
                        e.setDepthBuffer(!0)
                    }
                    this._renderDuration += (new Date).getTime() - h, this.postProcessManager._finalizeFrame(t.isIntermediate), this.activeCamera._updateFromScene(), this._renderTargets.reset(), this.afterCameraRender && this.afterCameraRender(this.activeCamera)
                }, e.prototype._processSubCameras = function(t) {
                    if (0 == t.subCameras.length)
                        return void this._renderForCamera(t);
                    for (var e = 0; e < t.subCameras.length; e++)
                        this._renderForCamera(t.subCameras[e]);
                    this.activeCamera = t, this.setTransformMatrix(this.activeCamera.getViewMatrix(), this.activeCamera.getProjectionMatrix()), this.activeCamera._updateFromScene()
                }, e.prototype._checkIntersections = function() {
                    for (var e = 0; e < this._meshesForIntersections.length; e++)
                        for (var n = this._meshesForIntersections.data[e], i = 0; i < n.actionManager.actions.length; i++) {
                            var o = n.actionManager.actions[i];
                            if (o.trigger == t.ActionManager.OnIntersectionEnterTrigger || o.trigger == t.ActionManager.OnIntersectionExitTrigger) {
                                var r = o.getTriggerParameter(), s = r.intersectsMesh(n, !1), a = n._intersectionsInProgress.indexOf(r);
                                if (s && -1 === a && o.trigger == t.ActionManager.OnIntersectionEnterTrigger)
                                    n.actionManager.processTrigger(t.ActionManager.OnIntersectionEnterTrigger, t.ActionEvent.CreateNew(n)), n._intersectionsInProgress.push(r);
                                else if (!s && a > -1 && o.trigger == t.ActionManager.OnIntersectionExitTrigger) {
                                    n.actionManager.processTrigger(t.ActionManager.OnIntersectionExitTrigger, t.ActionEvent.CreateNew(n));
                                    var l = n._intersectionsInProgress.indexOf(r);
                                    l > -1 && n._intersectionsInProgress.splice(l, 1)
                                }
                            }
                        }
                }, e.prototype.render = function() {
                    var n = (new Date).getTime();
                    this._particlesDuration = 0, this._spritesDuration = 0, this._activeParticles = 0, this._renderDuration = 0, this._evaluateActiveMeshesDuration = 0, this._totalVertices = 0, this._activeVertices = 0, this._meshesForIntersections.reset(), this.actionManager && this.actionManager.processTrigger(t.ActionManager.OnEveryFrameTrigger, null), this.beforeRender && this.beforeRender();
                    for (var i = 0; i < this._onBeforeRenderCallbacks.length; i++)
                        this._onBeforeRenderCallbacks[i]();
                    var o = Math.max(e.MinDeltaTime, Math.min(t.Tools.GetDeltaTime(), e.MaxDeltaTime));
                    this._animationRatio = .06 * o, this._animate(), this._physicsEngine && this._physicsEngine._runOneStep(o / 1e3), this._engine.clear(this.clearColor, this.autoClear || this.forceWireframe, !0);
                    for (var r = 0; r < this.lights.length; r++) {
                        var s = this.lights[r], a = s.getShadowGenerator();
                        s.isEnabled() && a && -1 !== a.getShadowMap().getScene().textures.indexOf(a.getShadowMap()) && this._renderTargets.push(a.getShadowMap())
                    }
                    if (this.postProcessRenderPipelineManager.update(), this.activeCameras.length > 0)
                        for (var l = this._renderId, h = 0; h < this.activeCameras.length; h++)
                            this._renderId = l, this._processSubCameras(this.activeCameras[h]);
                    else
                        this._processSubCameras(this.activeCamera);
                    this._checkIntersections(), this.afterRender && this.afterRender();
                    for (var c = 0; c < this._toBeDisposed.length; c++)
                        this._toBeDisposed.data[c].dispose(), this._toBeDisposed[c] = null;
                    this._toBeDisposed.reset(), this._lastFrameDuration = (new Date).getTime() - n
                }, e.prototype.dispose = function() {
                    this.beforeRender = null, this.afterRender = null, this.skeletons = [], this._boundingBoxRenderer.dispose(), this.onDispose && this.onDispose(), this.detachControl();
                    var t, e = this._engine.getRenderingCanvas();
                    for (t = 0; t < this.cameras.length; t++)
                        this.cameras[t].detachControl(e);
                    for (; this.lights.length; )
                        this.lights[0].dispose();
                    for (; this.meshes.length; )
                        this.meshes[0].dispose(!0);
                    for (; this.cameras.length; )
                        this.cameras[0].dispose();
                    for (; this.materials.length; )
                        this.materials[0].dispose();
                    for (; this.particleSystems.length; )
                        this.particleSystems[0].dispose();
                    for (; this.spriteManagers.length; )
                        this.spriteManagers[0].dispose();
                    for (; this.layers.length; )
                        this.layers[0].dispose();
                    for (; this.textures.length; )
                        this.textures[0].dispose();
                    this.postProcessManager.dispose(), this._physicsEngine && this.disablePhysicsEngine(), t = this._engine.scenes.indexOf(this), this._engine.scenes.splice(t, 1), this._engine.wipeCaches()
                }, e.prototype._getNewPosition = function(t, e, n, i, o, r) {
                    "undefined" == typeof r && (r = null), t.divideToRef(n.radius, this._scaledPosition), e.divideToRef(n.radius, this._scaledVelocity), n.retry = 0, n.initialVelocity = this._scaledVelocity, n.initialPosition = this._scaledPosition, this._collideWithWorld(this._scaledPosition, this._scaledVelocity, n, i, o, r), o.multiplyInPlace(n.radius)
                }, e.prototype._collideWithWorld = function(e, n, i, o, r, s) {
                    "undefined" == typeof s && (s = null);
                    var a = 10 * t.Engine.CollisionsEpsilon;
                    if (i.retry >= o)
                        return void r.copyFrom(e);
                    i._initialize(e, n, a);
                    for (var l = 0; l < this.meshes.length; l++) {
                        var h = this.meshes[l];
                        h.isEnabled() && h.checkCollisions && h.subMeshes && h !== s && h._checkCollision(i)
                    }
                    return i.collisionFound ? ((0 != n.x || 0 != n.y || 0 != n.z) && i._getResponse(e, n), n.length() <= a ? void r.copyFrom(e) : (i.retry++, void this._collideWithWorld(e, n, i, o, r, s))) : void e.addToRef(n, r)
                }, e.prototype.createOrUpdateSelectionOctree = function(e, n) {
                    "undefined" == typeof e && (e = 64), "undefined" == typeof n && (n = 2), this._selectionOctree || (this._selectionOctree = new t.Octree(t.Octree.CreationFuncForMeshes, e, n));
                    for (var i = new t.Vector3(Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE), o = new t.Vector3(-Number.MAX_VALUE, -Number.MAX_VALUE, -Number.MAX_VALUE), r = 0; r < this.meshes.length; r++) {
                        var s = this.meshes[r];
                        s.computeWorldMatrix(!0);
                        var a = s.getBoundingInfo().boundingBox.minimumWorld, l = s.getBoundingInfo().boundingBox.maximumWorld;
                        t.Tools.CheckExtends(a, i, o), t.Tools.CheckExtends(l, i, o)
                    }
                    return this._selectionOctree.update(i, o, this.meshes), this._selectionOctree
                }, e.prototype.createPickingRay = function(e, n, i, o) {
                    var r = this._engine;
                    if (!o) {
                        if (!this.activeCamera)
                            throw new Error("Active camera not set");
                        o = this.activeCamera
                    }
                    var s = o.viewport, a = s.toGlobal(r);
                    return e = e / this._engine.getHardwareScalingLevel() - a.x, n = n / this._engine.getHardwareScalingLevel() - (this._engine.getRenderHeight() - a.y - a.height), t.Ray.CreateNew(e / window.devicePixelRatio, n / window.devicePixelRatio, a.width, a.height, i ? i : t.Matrix.Identity(), o.getViewMatrix(), o.getProjectionMatrix())
                }, e.prototype._internalPick = function(e, n, i) {
                    for (var o = null, r = 0; r < this.meshes.length; r++) {
                        var s = this.meshes[r];
                        if (n) {
                            if (!n(s))
                                continue
                                } else if (!s.isEnabled() || !s.isVisible || !s.isPickable)
                                    continue;
                        var a = s.getWorldMatrix(), l = e(a), h = s.intersects(l, i);
                        if (h && h.hit && (i || null == o || !(h.distance >= o.distance)) && (o = h, i))
                            break
                            }
                    return o || new t.PickingInfo
                }, e.prototype.pick = function(t, e, n, i, o) {
                    var r = this;
                    return this._internalPick(function(n) {
                                              return r.createPickingRay(t, e, n, o)
                                              }, n, i)
                }, e.prototype.pickWithRay = function(e, n, i) {
                    var o = this;
                    return this._internalPick(function(n) {
                                              return o._pickWithRayInverseMatrix || (o._pickWithRayInverseMatrix = t.Matrix.Identity()), n.invertToRef(o._pickWithRayInverseMatrix), t.Ray.Transform(e, o._pickWithRayInverseMatrix)
                                              }, n, i)
                }, e.prototype.setPointerOverMesh = function(e) {
                    this._pointerOverMesh !== e && (this._pointerOverMesh && this._pointerOverMesh.actionManager && this._pointerOverMesh.actionManager.processTrigger(t.ActionManager.OnPointerOutTrigger, t.ActionEvent.CreateNew(this._pointerOverMesh)), this._pointerOverMesh = e, this._pointerOverMesh && this._pointerOverMesh.actionManager && this._pointerOverMesh.actionManager.processTrigger(t.ActionManager.OnPointerOverTrigger, t.ActionEvent.CreateNew(this._pointerOverMesh)))
                }, e.prototype.getPointerOverMesh = function() {
                    return this._pointerOverMesh
                }, e.prototype.getPhysicsEngine = function() {
                    return this._physicsEngine
                }, e.prototype.enablePhysics = function(e, n) {
                    return this._physicsEngine ? !0 : (this._physicsEngine = new t.PhysicsEngine(n), this._physicsEngine.isSupported() ? (this._physicsEngine._initialize(e), !0) : (this._physicsEngine = null, !1))
                }, e.prototype.disablePhysicsEngine = function() {
                    this._physicsEngine && (this._physicsEngine.dispose(), this._physicsEngine = void 0)
                }, e.prototype.isPhysicsEnabled = function() {
                    return void 0 !== this._physicsEngine
                }, e.prototype.setGravity = function(t) {
                    this._physicsEngine && this._physicsEngine._setGravity(t)
                }, e.prototype.createCompoundImpostor = function(t, e) {
                    if (t.parts && (e = t, t = t.parts), !this._physicsEngine)
                        return null;
                    for (var n = 0; n < t.length; n++) {
                        var i = t[n].mesh;
                        i._physicImpostor = t[n].impostor, i._physicsMass = e.mass / t.length, i._physicsFriction = e.friction, i._physicRestitution = e.restitution
                    }
                    return this._physicsEngine._registerMeshesAsCompound(t, e)
                }, e.prototype.deleteCompoundImpostor = function(e) {
                    for (var n = 0; n < e.parts.length; n++) {
                        var i = e.parts[n].mesh;
                        i._physicImpostor = t.PhysicsEngine.NoImpostor, this._physicsEngine._unregisterMesh(i)
                    }
                }, e.prototype._getByTags = function(e, n) {
                    if (void 0 === n)
                        return e;
                    var i = [];
                    for (var o in e) {
                        var r = e[o];
                        t.Tags.MatchesQuery(r, n) && i.push(r)
                    }
                    return i
                }, e.prototype.getMeshesByTags = function(t) {
                    return this._getByTags(this.meshes, t)
                }, e.prototype.getCamerasByTags = function(t) {
                    return this._getByTags(this.cameras, t)
                }, e.prototype.getLightsByTags = function(t) {
                    return this._getByTags(this.lights, t)
                }, e.prototype.getMaterialByTags = function(t) {
                    return this._getByTags(this.materials, t).concat(this._getByTags(this.multiMaterials, t))
                }, e.FOGMODE_NONE = 0, e.FOGMODE_EXP = 1, e.FOGMODE_EXP2 = 2, e.FOGMODE_LINEAR = 3, e.MinDeltaTime = 1, e.MaxDeltaTime = 1e3, e
    }();
    t.Scene = e
}(BABYLON || (BABYLON = {}));
var BABYLON;
!function(t) {
    var e = function() {
        function e(n, i, o, r, s) {
            switch (this._engine = n instanceof t.Mesh ? n.getScene().getEngine() : n, this._updatable = r, this._data = i, s || this.create(), this._kind = o, o) {
                case e.PositionKind:
                    this._strideSize = 3;
                    break;
                case e.NormalKind:
                    this._strideSize = 3;
                    break;
                case e.UVKind:
                    this._strideSize = 2;
                    break;
                case e.UV2Kind:
                    this._strideSize = 2;
                    break;
                case e.ColorKind:
                    this._strideSize = 3;
                    break;
                case e.MatricesIndicesKind:
                    this._strideSize = 4;
                    break;
                case e.MatricesWeightsKind:
                    this._strideSize = 4
            }
        }
        return e.prototype.isUpdatable = function() {
            return this._updatable
        }, e.prototype.getData = function() {
            return this._data
        }, e.prototype.getBuffer = function() {
            return this._buffer
        }, e.prototype.getStrideSize = function() {
            return this._strideSize
        }, e.prototype.create = function(t) {
            (t || !this._buffer) && (t = t || this._data, this._buffer || (this._buffer = this._updatable ? this._engine.createDynamicVertexBuffer(4 * t.length) : this._engine.createVertexBuffer(t)), this._updatable && (this._engine.updateDynamicVertexBuffer(this._buffer, t), this._data = t))
        }, e.prototype.update = function(t) {
            this.create(t)
        }, e.prototype.dispose = function() {
            this._buffer && this._engine._releaseBuffer(this._buffer) && (this._buffer = null)
        }, Object.defineProperty(e, "PositionKind", {get: function() {
                                 return e._PositionKind
                                 },enumerable: !0,configurable: !0}), Object.defineProperty(e, "NormalKind", {get: function() {
                                                                                            return e._NormalKind
                                                                                            },enumerable: !0,configurable: !0}), Object.defineProperty(e, "UVKind", {get: function() {
                                                                                                                                                       return e._UVKind
                                                                                                                                                       },enumerable: !0,configurable: !0}), Object.defineProperty(e, "UV2Kind", {get: function() {
                                                                                                                                                                                                                  return e._UV2Kind
                                                                                                                                                                                                                  },enumerable: !0,configurable: !0}), Object.defineProperty(e, "ColorKind", {get: function() {
                                                                                                                                                                                                                                                                             return e._ColorKind
                                                                                                                                                                                                                                                                             },enumerable: !0,configurable: !0}), Object.defineProperty(e, "MatricesIndicesKind", {get: function() {
                                                                                                                                                                                                                                                                                                                                        return e._MatricesIndicesKind
                                                                                                                                                                                                                                                                                                                                        },enumerable: !0,configurable: !0}), Object.defineProperty(e, "MatricesWeightsKind", {get: function() {
                                                                                                                                                                                                                                                                                                                                                                                                   return e._MatricesWeightsKind
                                                                                                                                                                                                                                                                                                                                                                                                   },enumerable: !0,configurable: !0}), e._PositionKind = "position", e._NormalKind = "normal", e._UVKind = "uv", e._UV2Kind = "uv2", e._ColorKind = "color", e._MatricesIndicesKind = "matricesIndices", e._MatricesWeightsKind = "matricesWeights", e
    }();
    t.VertexBuffer = e
}(BABYLON || (BABYLON = {}));
var __extends = this.__extends || function(t, e) {
    function n() {
        this.constructor = t
    }
    for (var i in e)
        e.hasOwnProperty(i) && (t[i] = e[i]);
    n.prototype = e.prototype, t.prototype = new n
}, BABYLON;
!function(t) {
    var e = function(e) {
        function n(t, n) {
            e.call(this, t, n.getScene()), n.instances.push(this), this._sourceMesh = n, this.position.copyFrom(n.position), this.rotation.copyFrom(n.rotation), this.scaling.copyFrom(n.scaling), n.rotationQuaternion && (this.rotationQuaternion = n.rotationQuaternion.clone()), this.infiniteDistance = n.infiniteDistance, this.setPivotMatrix(n.getPivotMatrix()), this.refreshBoundingInfo(), this._syncSubMeshes()
        }
        return __extends(n, e), Object.defineProperty(n.prototype, "receiveShadows", {get: function() {
                                                      return this._sourceMesh.receiveShadows
                                                      },enumerable: !0,configurable: !0}), Object.defineProperty(n.prototype, "material", {get: function() {
                                                                                                                 return this._sourceMesh.material
                                                                                                                 },enumerable: !0,configurable: !0}), Object.defineProperty(n.prototype, "visibility", {get: function() {
                                                                                                                                                                            return this._sourceMesh.visibility
                                                                                                                                                                            },enumerable: !0,configurable: !0}), Object.defineProperty(n.prototype, "skeleton", {get: function() {
                                                                                                                                                                                                                                       return this._sourceMesh.skeleton
                                                                                                                                                                                                                                       },enumerable: !0,configurable: !0}), n.prototype.getTotalVertices = function() {
            return this._sourceMesh.getTotalVertices()
        }, Object.defineProperty(n.prototype, "sourceMesh", {get: function() {
                                 return this._sourceMesh
                                 },enumerable: !0,configurable: !0}), n.prototype.getVerticesData = function(t) {
            return this._sourceMesh.getVerticesData(t)
        }, n.prototype.isVerticesDataPresent = function(t) {
            return this._sourceMesh.isVerticesDataPresent(t)
        }, n.prototype.getIndices = function() {
            return this._sourceMesh.getIndices()
        }, Object.defineProperty(n.prototype, "_positions", {get: function() {
                                 return this._sourceMesh._positions
                                 },enumerable: !0,configurable: !0}), n.prototype.refreshBoundingInfo = function() {
            var e = this._sourceMesh.getVerticesData(t.VertexBuffer.PositionKind);
            if (e) {
                var n = t.Tools.ExtractMinAndMax(e, 0, this._sourceMesh.getTotalVertices());
                this._boundingInfo = new t.BoundingInfo(n.minimum, n.maximum)
            }
            this._updateBoundingInfo()
        }, n.prototype._activate = function(t) {
            this.sourceMesh._registerInstanceForRenderId(this, t)
        }, n.prototype._syncSubMeshes = function() {
            this.releaseSubMeshes();
            for (var t = 0; t < this._sourceMesh.subMeshes.length; t++)
                this._sourceMesh.subMeshes[t].clone(this, this._sourceMesh)
                }, n.prototype._generatePointsArray = function() {
                    return this._sourceMesh._generatePointsArray()
                }, n.prototype.clone = function(e, n, i) {
                    var o = this._sourceMesh.createInstance(e);
                    if (t.Tools.DeepCopy(this, o, ["name"], []), this.refreshBoundingInfo(), n && (o.parent = n), !i)
                        for (var r = 0; r < this.getScene().meshes.length; r++) {
                            var s = this.getScene().meshes[r];
                            s.parent == this && s.clone(s.name, o)
                        }
                    return o.computeWorldMatrix(!0), o
                }, n.prototype.dispose = function(t) {
                    var n = this._sourceMesh.instances.indexOf(this);
                    this._sourceMesh.instances.splice(n, 1), e.prototype.dispose.call(this, t)
                }, n
    }(t.AbstractMesh);
    t.InstancedMesh = e
}(BABYLON || (BABYLON = {}));
var __extends = this.__extends || function(t, e) {
    function n() {
        this.constructor = t
    }
    for (var i in e)
        e.hasOwnProperty(i) && (t[i] = e[i]);
    n.prototype = e.prototype, t.prototype = new n
}, BABYLON;
!function(t) {
    var e = function() {
        function t() {
            this.mustReturn = !1, this.visibleInstances = new Array, this.renderSelf = new Array
        }
        return t
    }();
    t._InstancesBatch = e;
    var n = function(n) {
        function i(i, o) {
            n.call(this, i, o), this.delayLoadState = t.Engine.DELAYLOADSTATE_NONE, this.instances = new Array, this._onBeforeRenderCallbacks = [], this._visibleInstances = {}, this._renderIdForInstances = new Array, this._batchCache = new e, this._instancesBufferSize = 2048
        }
        return __extends(i, n), i.prototype.getTotalVertices = function() {
            return this._geometry ? this._geometry.getTotalVertices() : 0
        }, i.prototype.getVerticesData = function(t) {
            return this._geometry ? this._geometry.getVerticesData(t) : null
        }, i.prototype.getVertexBuffer = function(t) {
            return this._geometry ? this._geometry.getVertexBuffer(t) : void 0
        }, i.prototype.isVerticesDataPresent = function(t) {
            return this._geometry ? this._geometry.isVerticesDataPresent(t) : this._delayInfo ? -1 !== this._delayInfo.indexOf(t) : !1
        }, i.prototype.getVerticesDataKinds = function() {
            if (!this._geometry) {
                var t = [];
                if (this._delayInfo)
                    for (var e in this._delayInfo)
                        t.push(e);
                return t
            }
            return this._geometry.getVerticesDataKinds()
        }, i.prototype.getTotalIndices = function() {
            return this._geometry ? this._geometry.getTotalIndices() : 0
        }, i.prototype.getIndices = function() {
            return this._geometry ? this._geometry.getIndices() : []
        }, i.prototype.isReady = function() {
            return this.delayLoadState === t.Engine.DELAYLOADSTATE_LOADING ? !1 : n.prototype.isReady.call(this)
        }, i.prototype.isDisposed = function() {
            return this._isDisposed
        }, i.prototype._preActivate = function() {
            this._visibleInstances = null
        }, i.prototype._registerInstanceForRenderId = function(t, e) {
            this._visibleInstances || (this._visibleInstances = {}, this._visibleInstances.defaultRenderId = e, this._visibleInstances.selfDefaultRenderId = this._renderId), this._visibleInstances[e] || (this._visibleInstances[e] = new Array), this._visibleInstances[e].push(t)
        }, i.prototype.refreshBoundingInfo = function() {
            var e = this.getVerticesData(t.VertexBuffer.PositionKind);
            if (e) {
                var n = t.Tools.ExtractMinAndMax(e, 0, this.getTotalVertices());
                this._boundingInfo = new t.BoundingInfo(n.minimum, n.maximum)
            }
            if (this.subMeshes)
                for (var i = 0; i < this.subMeshes.length; i++)
                    this.subMeshes[i].refreshBoundingInfo();
            this._updateBoundingInfo()
        }, i.prototype._createGlobalSubMesh = function() {
            var e = this.getTotalVertices();
            return e && this.getIndices() ? (this.releaseSubMeshes(), new t.SubMesh(0, 0, e, 0, this.getTotalIndices(), this)) : null
        }, i.prototype.subdivide = function(e) {
            if (!(1 > e)) {
                for (var n = this.getTotalIndices(), i = n / e | 0, o = 0; i % 3 != 0; )
                    i++;
                this.releaseSubMeshes();
                for (var r = 0; e > r && !(o >= n); r++)
                    t.SubMesh.CreateFromIndices(0, o, Math.min(i, n - o), this), o += i;
                this.synchronizeInstances()
            }
        }, i.prototype.setVerticesData = function(e, n, i) {
            if (e instanceof Array) {
                var o = n;
                n = e, e = o, t.Tools.Warn("Deprecated usage of setVerticesData detected (since v1.12). Current signature is setVerticesData(kind, data, updatable).")
            }
            if (this._geometry)
                this._geometry.setVerticesData(e, n, i);
            else {
                var r = new t.VertexData;
                r.set(n, e);
                var s = this.getScene();
                new t.Geometry(t.Geometry.RandomId(), s, r, i, this)
            }
        }, i.prototype.updateVerticesData = function(t, e, n, i) {
            this._geometry && (i ? (this.makeGeometryUnique(), this.updateVerticesData(t, e, n, !1)) : this._geometry.updateVerticesData(t, e, n))
        }, i.prototype.makeGeometryUnique = function() {
            if (this._geometry) {
                var e = this._geometry.copy(t.Geometry.RandomId());
                e.applyToMesh(this)
            }
        }, i.prototype.setIndices = function(e) {
            if (this._geometry)
                this._geometry.setIndices(e);
            else {
                var n = new t.VertexData;
                n.indices = e;
                var i = this.getScene();
                new t.Geometry(t.Geometry.RandomId(), i, n, !1, this)
            }
        }, i.prototype._bind = function(t, e, n) {
            var i = this.getScene().getEngine(), o = this._geometry.getIndexBuffer();
            n && (o = t.getLinesIndexBuffer(this.getIndices(), i)), i.bindMultiBuffers(this._geometry.getVertexBuffers(), o, e)
        }, i.prototype._draw = function(t, e, n) {
            if (this._geometry && this._geometry.getVertexBuffers() && this._geometry.getIndexBuffer()) {
                var i = this.getScene().getEngine();
                i.draw(e, e ? t.indexStart : 0, e ? t.indexCount : t.linesIndexCount, n)
            }
        }, i.prototype.registerBeforeRender = function(t) {
            this._onBeforeRenderCallbacks.push(t)
        }, i.prototype.unregisterBeforeRender = function(t) {
            var e = this._onBeforeRenderCallbacks.indexOf(t);
            e > -1 && this._onBeforeRenderCallbacks.splice(e, 1)
        }, i.prototype._getInstancesRenderList = function(t) {
            var e = this.getScene();
            if (this._batchCache.mustReturn = !1, this._batchCache.renderSelf[t] = !0, this._batchCache.visibleInstances[t] = null, this._visibleInstances) {
                var n = e.getRenderId();
                this._batchCache.visibleInstances[t] = this._visibleInstances[n];
                var i = this._renderId;
                if (!this._batchCache.visibleInstances[t] && this._visibleInstances.defaultRenderId && (this._batchCache.visibleInstances[t] = this._visibleInstances[this._visibleInstances.defaultRenderId], n = this._visibleInstances.defaultRenderId, i = this._visibleInstances.selfDefaultRenderId), this._batchCache.visibleInstances[t] && this._batchCache.visibleInstances[t].length) {
                    if (this._renderIdForInstances[t] === n)
                        return this._batchCache.mustReturn = !0, this._batchCache;
                    n !== i && (this._batchCache.renderSelf[t] = !1)
                }
                this._renderIdForInstances[t] = n
            }
            return this._batchCache
        }, i.prototype._renderWithInstances = function(t, e, n, i, o) {
            for (var r = this.instances.length + 1, s = 16 * r * 4; this._instancesBufferSize < s; )
                this._instancesBufferSize *= 2;
            (!this._worldMatricesInstancesBuffer || this._worldMatricesInstancesBuffer.capacity < this._instancesBufferSize) && (this._worldMatricesInstancesBuffer && o.deleteInstancesBuffer(this._worldMatricesInstancesBuffer), this._worldMatricesInstancesBuffer = o.createInstancesBuffer(this._instancesBufferSize), this._worldMatricesInstancesArray = new Float32Array(this._instancesBufferSize / 4));
            var a = 0, l = 0, h = this.getWorldMatrix();
            n.renderSelf[t._id] && (h.copyToArray(this._worldMatricesInstancesArray, a), a += 16, l++);
            var c = n.visibleInstances[t._id];
            if (c)
                for (var u = 0; u < c.length; u++) {
                    var p = c[u];
                    p.getWorldMatrix().copyToArray(this._worldMatricesInstancesArray, a), a += 16, l++
                }
            var d = i.getAttributeLocationByName("world0"), m = i.getAttributeLocationByName("world1"), g = i.getAttributeLocationByName("world2"), f = i.getAttributeLocationByName("world3"), y = [d, m, g, f];
            o.updateAndBindInstancesBuffer(this._worldMatricesInstancesBuffer, this._worldMatricesInstancesArray, y), this._draw(t, !e, l), o.unBindInstancesBuffer(this._worldMatricesInstancesBuffer, y)
        }, i.prototype.render = function(t) {
            var e = this.getScene(), n = this._getInstancesRenderList(t._id);
            if (!n.mustReturn && this._geometry && this._geometry.getVertexBuffers() && this._geometry.getIndexBuffer()) {
                for (var i = 0; i < this._onBeforeRenderCallbacks.length; i++)
                    this._onBeforeRenderCallbacks[i]();
                var o = e.getEngine(), r = null !== o.getCaps().instancedArrays && null !== n.visibleInstances[t._id], s = t.getMaterial();
                if (s && s.isReady(this, r)) {
                    s._preBind();
                    var a = s.getEffect(), l = o.forceWireframe || s.wireframe;
                    this._bind(t, a, l);
                    var h = this.getWorldMatrix();
                    if (s.bind(h, this), r)
                        this._renderWithInstances(t, l, n, a, o);
                    else if (n.renderSelf[t._id] && this._draw(t, !l), n.visibleInstances[t._id])
                        for (var c = 0; c < n.visibleInstances[t._id].length; c++) {
                            var u = n.visibleInstances[t._id][c];
                            h = u.getWorldMatrix(), s.bindOnlyWorldMatrix(h), this._draw(t, !l)
                        }
                    s.unbind()
                }
            }
        }, i.prototype.getEmittedParticleSystems = function() {
            for (var t = new Array, e = 0; e < this.getScene().particleSystems.length; e++) {
                var n = this.getScene().particleSystems[e];
                n.emitter === this && t.push(n)
            }
            return t
        }, i.prototype.getHierarchyEmittedParticleSystems = function() {
            var t = new Array, e = this.getDescendants();
            e.push(this);
            for (var n = 0; n < this.getScene().particleSystems.length; n++) {
                var i = this.getScene().particleSystems[n];
                -1 !== e.indexOf(i.emitter) && t.push(i)
            }
            return t
        }, i.prototype.getChildren = function() {
            for (var t = [], e = 0; e < this.getScene().meshes.length; e++) {
                var n = this.getScene().meshes[e];
                n.parent == this && t.push(n)
            }
            return t
        }, i.prototype._checkDelayState = function() {
            var e = this, n = this, i = this.getScene();
            this._geometry ? this._geometry.load(i) : n.delayLoadState === t.Engine.DELAYLOADSTATE_NOTLOADED && (n.delayLoadState = t.Engine.DELAYLOADSTATE_LOADING, i._addPendingData(n), t.Tools.LoadFile(this.delayLoadingFile, function(n) {
                                                                                                                                                                                                            e._delayLoadingFunction(JSON.parse(n), e), e.delayLoadState = t.Engine.DELAYLOADSTATE_LOADED, i._removePendingData(e)
                                                                                                                                                                                                            }, function() {
                                                                                                                                                                                                            }, i.database))
        }, i.prototype.isInFrustum = function(e) {
            return this.delayLoadState === t.Engine.DELAYLOADSTATE_LOADING ? !1 : n.prototype.isInFrustum.call(this, e) ? (this._checkDelayState(), !0) : !1
        }, i.prototype.setMaterialByID = function(t) {
            for (var e = this.getScene().materials, n = e.length - 1; n >= 0; n--)
                if (e[n].id == t)
                    return void (this.material = e[n]);
            var i = this.getScene().multiMaterials;
            for (n = 0; n < i.length; n++)
                if (i[n].id == t)
                    return void (this.material = i[n])
                    }, i.prototype.getAnimatables = function() {
                        var t = [];
                        return this.material && t.push(this.material), t
                    }, i.prototype.bakeTransformIntoVertices = function(e) {
                        if (this.isVerticesDataPresent(t.VertexBuffer.PositionKind)) {
                            this._resetPointsArrayCache();
                            for (var n = this.getVerticesData(t.VertexBuffer.PositionKind), i = [], o = 0; o < n.length; o += 3)
                                t.Vector3.TransformCoordinates(t.Vector3.FromArray(n, o), e).toArray(i, o);
                            if (this.setVerticesData(t.VertexBuffer.PositionKind, i, this.getVertexBuffer(t.VertexBuffer.PositionKind).isUpdatable()), this.isVerticesDataPresent(t.VertexBuffer.NormalKind)) {
                                for (n = this.getVerticesData(t.VertexBuffer.NormalKind), i = [], o = 0; o < n.length; o += 3)
                                    t.Vector3.TransformNormal(t.Vector3.FromArray(n, o), e).toArray(i, o);
                                this.setVerticesData(t.VertexBuffer.NormalKind, i, this.getVertexBuffer(t.VertexBuffer.NormalKind).isUpdatable())
                            }
                        }
                    }, i.prototype._resetPointsArrayCache = function() {
                        this._positions = null
                    }, i.prototype._generatePointsArray = function() {
                        if (this._positions)
                            return !0;
                        this._positions = [];
                        var e = this.getVerticesData(t.VertexBuffer.PositionKind);
                        if (!e)
                            return !1;
                        for (var n = 0; n < e.length; n += 3)
                            this._positions.push(t.Vector3.FromArray(e, n));
                        return !0
                    }, i.prototype.clone = function(t, e, n) {
                        return this.duplicate(t, e, n)
                    }, i.prototype.dispose = function(t) {
                        for (this._geometry && this._geometry.releaseForMesh(this, !0), this._worldMatricesInstancesBuffer && (this.getEngine().deleteInstancesBuffer(this._worldMatricesInstancesBuffer), this._worldMatricesInstancesBuffer = null); this.instances.length; )
                            this.instances[0].dispose();
                        n.prototype.dispose.call(this, t)
                    }, i.prototype.convertToFlatShadedMesh = function() {
                        for (var e = this.getVerticesDataKinds(), n = [], i = [], o = [], r = !1, s = 0; s < e.length; s++) {
                            var a = e[s], l = this.getVertexBuffer(a);
                            a !== t.VertexBuffer.NormalKind ? (n[a] = l, i[a] = n[a].getData(), o[a] = []) : (r = l.isUpdatable(), e.splice(s, 1), s--)
                        }
                        var h = this.subMeshes.slice(0), c = this.getIndices(), u = this.getTotalIndices();
                        for (y = 0; u > y; y++) {
                            var p = c[y];
                            for (s = 0; s < e.length; s++) {
                                a = e[s];
                                for (var d = n[a].getStrideSize(), m = 0; d > m; m++)
                                    o[a].push(i[a][p * d + m])
                                    }
                        }
                        for (var g = [], f = o[t.VertexBuffer.PositionKind], y = 0; u > y; y += 3) {
                            c[y] = y, c[y + 1] = y + 1, c[y + 2] = y + 2;
                            for (var _ = t.Vector3.FromArray(f, 3 * y), v = t.Vector3.FromArray(f, 3 * (y + 1)), b = t.Vector3.FromArray(f, 3 * (y + 2)), w = _.subtract(v), x = b.subtract(v), C = t.Vector3.Normalize(t.Vector3.Cross(w, x)), M = 0; 3 > M; M++)
                                g.push(C.x), g.push(C.y), g.push(C.z)
                                }
                        for (this.setIndices(c), this.setVerticesData(t.VertexBuffer.NormalKind, g, r), s = 0; s < e.length; s++)
                            a = e[s], this.setVerticesData(a, o[a], n[a].isUpdatable());
                        this.releaseSubMeshes();
                        for (var D = 0; D < h.length; D++) {
                            var B = h[D];
                            new t.SubMesh(B.materialIndex, B.indexStart, B.indexCount, B.indexStart, B.indexCount, this)
                        }
                        this.synchronizeInstances()
                    }, i.prototype.createInstance = function(e) {
                        return new t.InstancedMesh(e, this)
                    }, i.prototype.synchronizeInstances = function() {
                        for (var t = 0; t < this.instances.length; t++) {
                            var e = this.instances[t];
                            e._syncSubMeshes()
                        }
                    }, i.CreateBox = function(e, n, i, o) {
                        var r = new t.Mesh(e, i), s = t.VertexData.CreateBox(n);
                        return s.applyToMesh(r, o), r
                    }, i.CreateSphere = function(e, n, i, o, r) {
                        var s = new t.Mesh(e, o), a = t.VertexData.CreateSphere(n, i);
                        return a.applyToMesh(s, r), s
                    }, i.CreateCylinder = function(e, n, i, o, r, s, a, l, h) {
                        void 0 !== l && l instanceof t.Scene || (void 0 !== l && (h = l), l = s, s = 1);
                        var c = new t.Mesh(e, l), u = t.VertexData.CreateCylinder(n, i, o, r, s, a);
                        return u.applyToMesh(c, h), c
                    }, i.CreateTorus = function(e, n, i, o, r, s) {
                        var a = new t.Mesh(e, r), l = t.VertexData.CreateTorus(n, i, o);
                        return l.applyToMesh(a, s), a
                    }, i.CreateTorusKnot = function(e, n, i, o, r, s, a, l, h) {
                        var c = new t.Mesh(e, l), u = t.VertexData.CreateTorusKnot(n, i, o, r, s, a);
                        return u.applyToMesh(c, h), c
                    }, i.CreateLines = function(e, n, i, o) {
                        var r = new t.LinesMesh(e, i, o), s = t.VertexData.CreateLines(n);
                        return s.applyToMesh(r, o), r
                    }, i.CreatePlane = function(e, n, i, o) {
                        var r = new t.Mesh(e, i), s = t.VertexData.CreatePlane(n);
                        return s.applyToMesh(r, o), r
                    }, i.CreateGround = function(e, n, i, o, r, s) {
                        var a = new t.GroundMesh(e, r);
                        a._setReady(!1), a._subdivisions = o;
                        var l = t.VertexData.CreateGround(n, i, o);
                        return l.applyToMesh(a, s), a._setReady(!0), a
                    }, i.CreateTiledGround = function(e, n, i, o, r, s, a, l, h) {
                        var c = new t.Mesh(e, l), u = t.VertexData.CreateTiledGround(n, i, o, r, s, a);
                        return u.applyToMesh(c, h), c
                    }, i.CreateGroundFromHeightMap = function(e, n, i, o, r, s, a, l, h) {
                        var c = new t.GroundMesh(e, l);
                        c._subdivisions = r, c._setReady(!1);
                        var u = function(e) {
                            var n = document.createElement("canvas"), l = n.getContext("2d"), u = e.width, p = e.height;
                            n.width = u, n.height = p, l.drawImage(e, 0, 0);
                            var d = l.getImageData(0, 0, u, p).data, m = t.VertexData.CreateGroundFromHeightMap(i, o, r, s, a, d, u, p);
                            m.applyToMesh(c, h), c._setReady(!0)
                        };
                        return t.Tools.LoadImage(n, u, function() {
                                                 }, l.database), c
                    }, i.MinMax = function(t) {
                        var e = null, n = null;
                        for (var i in t) {
                            var o = t[i], r = o.getBoundingInfo().boundingBox;
                            e ? (e.MinimizeInPlace(r.minimumWorld), n.MaximizeInPlace(r.maximumWorld)) : (e = r.minimumWorld, n = r.maximumWorld)
                        }
                        return {min: e,max: n}
                    }, i.Center = function(e) {
                        var n = void 0 !== e.min ? e : t.Mesh.MinMax(e);
                        return t.Vector3.Center(n.min, n.max)
                    }, i
    }(t.AbstractMesh);
    t.Mesh = n
}(BABYLON || (BABYLON = {}));
var __extends = this.__extends || function(t, e) {
    function n() {
        this.constructor = t
    }
    for (var i in e)
        e.hasOwnProperty(i) && (t[i] = e[i]);
    n.prototype = e.prototype, t.prototype = new n
}, BABYLON;
!function(t) {
    var e = function(e) {
        function n(n, i) {
            e.call(this, n, i), this.generateOctree = !1, this._worldInverse = new t.Matrix
        }
        return __extends(n, e), Object.defineProperty(n.prototype, "subdivisions", {get: function() {
                                                      return this._subdivisions
                                                      },enumerable: !0,configurable: !0}), n.prototype.optimize = function() {
            this.subdivide(this._subdivisions), this.createOrUpdateSubmeshesOctree(32)
        }, n.prototype.getHeightAtCoordinates = function(e, n) {
            var i = new t.Ray(new t.Vector3(e, this.getBoundingInfo().boundingBox.maximumWorld.y + 1, n), new t.Vector3(0, -1, 0));
            this.getWorldMatrix().invertToRef(this._worldInverse), i = t.Ray.Transform(i, this._worldInverse);
            var o = this.intersects(i);
            return o.hit ? o.pickedPoint.y : 0
        }, n
    }(t.Mesh);
    t.GroundMesh = e
}(BABYLON || (BABYLON = {}));
var BABYLON;
!function(t) {
    var e = function() {
        function e(t, e, n, i, o, r, s, a) {
            "undefined" == typeof a && (a = !0), this.materialIndex = t, this.verticesStart = e, this.verticesCount = n, this.indexStart = i, this.indexCount = o, this._renderId = 0, this._mesh = r, this._renderingMesh = s || r, r.subMeshes.push(this), this._id = r.subMeshes.length - 1, a && this.refreshBoundingInfo()
        }
        return e.prototype.getBoundingInfo = function() {
            return this._boundingInfo
        }, e.prototype.getMesh = function() {
            return this._mesh
        }, e.prototype.getRenderingMesh = function() {
            return this._renderingMesh
        }, e.prototype.getMaterial = function() {
            var e = this._renderingMesh.material;
            if (e && e instanceof t.MultiMaterial) {
                var n = e;
                return n.getSubMaterial(this.materialIndex)
            }
            return e ? e : this._mesh.getScene().defaultMaterial
        }, e.prototype.refreshBoundingInfo = function() {
            var e = this._renderingMesh.getVerticesData(t.VertexBuffer.PositionKind);
            if (!e)
                return void (this._boundingInfo = this._mesh._boundingInfo);
            var n, i = this._renderingMesh.getIndices();
            n = 0 === this.indexStart && this.indexCount === i.length ? t.Tools.ExtractMinAndMax(e, this.verticesStart, this.verticesCount) : t.Tools.ExtractMinAndMaxIndexed(e, i, this.indexStart, this.indexCount), this._boundingInfo = new t.BoundingInfo(n.minimum, n.maximum)
        }, e.prototype._checkCollision = function(t) {
            return this._boundingInfo._checkCollision(t)
        }, e.prototype.updateBoundingInfo = function(t) {
            this._boundingInfo || this.refreshBoundingInfo(), this._boundingInfo._update(t)
        }, e.prototype.isInFrustum = function(t) {
            return this._boundingInfo.isInFrustum(t)
        }, e.prototype.render = function() {
            this._renderingMesh.render(this)
        }, e.prototype.getLinesIndexBuffer = function(t, e) {
            if (!this._linesIndexBuffer) {
                for (var n = [], i = this.indexStart; i < this.indexStart + this.indexCount; i += 3)
                    n.push(t[i], t[i + 1], t[i + 1], t[i + 2], t[i + 2], t[i]);
                this._linesIndexBuffer = e.createIndexBuffer(n), this.linesIndexCount = n.length
            }
            return this._linesIndexBuffer
        }, e.prototype.canIntersects = function(t) {
            return t.intersectsBox(this._boundingInfo.boundingBox)
        }, e.prototype.intersects = function(e, n, i, o, r) {
            for (var s = null, a = this.indexStart; a < this.indexStart + this.indexCount; a += 3) {
                var l = n[i[a]], h = n[i[a + 1]], c = n[i[a + 2]], u = e.intersectsTriangle(l, h, c);
                if (u && (o || !s || u.distance < s.distance)) {
                    if (r) {
                        var p = t.PickingInfo.GetNormal(l, h, c), d = e.direction.dot(p);
                        if (d > 0)
                            continue
                            }
                    if (s = u, s.faceId = a / 3, o)
                        break
                        }
            }
            return s
        }, e.prototype.clone = function(n, i) {
            var o = new e(this.materialIndex, this.verticesStart, this.verticesCount, this.indexStart, this.indexCount, n, i, !1);
            return o._boundingInfo = new t.BoundingInfo(this._boundingInfo.minimum, this._boundingInfo.maximum), o
        }, e.prototype.dispose = function() {
            this._linesIndexBuffer && (this._mesh.getScene().getEngine()._releaseBuffer(this._linesIndexBuffer), this._linesIndexBuffer = null);
            var t = this._mesh.subMeshes.indexOf(this);
            this._mesh.subMeshes.splice(t, 1)
        }, e.CreateFromIndices = function(e, n, i, o, r) {
            var s = Number.MAX_VALUE, a = -Number.MAX_VALUE;
            r = r || o;
            for (var l = r.getIndices(), h = n; n + i > h; h++) {
                var c = l[h];
                s > c && (s = c), c > a && (a = c)
            }
            return new t.SubMesh(e, s, a - s + 1, n, i, o, r)
        }, e
    }();
    t.SubMesh = e
}(BABYLON || (BABYLON = {}));
var BABYLON;
!function(t) {
    var e = function() {
        function e(e) {
            this.delayLoadState = t.Engine.DELAYLOADSTATE_NONE, this.hasAlpha = !1, this.getAlphaFromRGB = !1, this.level = 1, this.isCube = !1, this.isRenderTarget = !1, this.animations = new Array, this.coordinatesIndex = 0, this.coordinatesMode = t.Texture.EXPLICIT_MODE, this.wrapU = t.Texture.WRAP_ADDRESSMODE, this.wrapV = t.Texture.WRAP_ADDRESSMODE, this.anisotropicFilteringLevel = 4, this._scene = e, this._scene.textures.push(this)
        }
        return e.prototype.getScene = function() {
            return this._scene
        }, e.prototype.getTextureMatrix = function() {
            return null
        }, e.prototype.getReflectionTextureMatrix = function() {
            return null
        }, e.prototype.getInternalTexture = function() {
            return this._texture
        }, e.prototype.isReady = function() {
            return this.delayLoadState === t.Engine.DELAYLOADSTATE_NOTLOADED ? !0 : this._texture ? this._texture.isReady : !1
        }, e.prototype.getSize = function() {
            return this._texture._width ? {width: this._texture._width,height: this._texture._height} : this._texture._size ? {width: this._texture._size,height: this._texture._size} : {width: 0,height: 0}
        }, e.prototype.getBaseSize = function() {
            return this.isReady() ? this._texture._size ? {width: this._texture._size,height: this._texture._size} : {width: this._texture._baseWidth,height: this._texture._baseHeight} : {width: 0,height: 0}
        }, e.prototype._getFromCache = function(t, e) {
            for (var n = this._scene.getEngine().getLoadedTexturesCache(), i = 0; i < n.length; i++) {
                var o = n[i];
                if (o.url === t && o.noMipmap === e)
                    return o.references++, o
                    }
            return null
        }, e.prototype.delayLoad = function() {
        }, e.prototype.releaseInternalTexture = function() {
            if (this._texture) {
                var t = this._scene.getEngine().getLoadedTexturesCache();
                if (this._texture.references--, 0 == this._texture.references) {
                    var e = t.indexOf(this._texture);
                    t.splice(e, 1), this._scene.getEngine()._releaseTexture(this._texture), delete this._texture
                }
            }
        }, e.prototype.clone = function() {
            return null
        }, e.prototype.dispose = function() {
            var t = this._scene.textures.indexOf(this);
            t >= 0 && this._scene.textures.splice(t, 1), void 0 !== this._texture && (this.releaseInternalTexture(), this.onDispose && this.onDispose())
        }, e
    }();
    t.BaseTexture = e
}(BABYLON || (BABYLON = {}));
var __extends = this.__extends || function(t, e) {
    function n() {
        this.constructor = t
    }
    for (var i in e)
        e.hasOwnProperty(i) && (t[i] = e[i]);
    n.prototype = e.prototype, t.prototype = new n
}, BABYLON;
!function(t) {
    var e = function(e) {
        function n(i, o, r, s, a) {
            "undefined" == typeof a && (a = n.TRILINEAR_SAMPLINGMODE), e.call(this, o), this.uOffset = 0, this.vOffset = 0, this.uScale = 1, this.vScale = 1, this.uAng = 0, this.vAng = 0, this.wAng = 0, this.name = i, this.url = i, this._noMipmap = r, this._invertY = s, this._samplingMode = a, i && (this._texture = this._getFromCache(i, r), this._texture || (o.useDelayedTextureLoading ? this.delayLoadState = t.Engine.DELAYLOADSTATE_NOTLOADED : this._texture = o.getEngine().createTexture(i, r, s, o, this._samplingMode)))
        }
        return __extends(n, e), n.prototype.delayLoad = function() {
            this.delayLoadState == t.Engine.DELAYLOADSTATE_NOTLOADED && (this.delayLoadState = t.Engine.DELAYLOADSTATE_LOADED, this._texture = this._getFromCache(this.url, this._noMipmap), this._texture || (this._texture = this.getScene().getEngine().createTexture(this.url, this._noMipmap, this._invertY, this.getScene(), this._samplingMode)))
        }, n.prototype._prepareRowForTextureGeneration = function(e, n, i, o) {
            e -= this.uOffset + .5, n -= this.vOffset + .5, i -= .5, t.Vector3.TransformCoordinatesFromFloatsToRef(e, n, i, this._rowGenerationMatrix, o), o.x *= this.uScale, o.y *= this.vScale, o.x += .5, o.y += .5, o.z += .5
        }, n.prototype.getTextureMatrix = function() {
            return this.uOffset === this._cachedUOffset && this.vOffset === this._cachedVOffset && this.uScale === this._cachedUScale && this.vScale === this._cachedVScale && this.uAng === this._cachedUAng && this.vAng === this._cachedVAng && this.wAng === this._cachedWAng ? this._cachedTextureMatrix : (this._cachedUOffset = this.uOffset, this._cachedVOffset = this.vOffset, this._cachedUScale = this.uScale, this._cachedVScale = this.vScale, this._cachedUAng = this.uAng, this._cachedVAng = this.vAng, this._cachedWAng = this.wAng, this._cachedTextureMatrix || (this._cachedTextureMatrix = t.Matrix.Zero(), this._rowGenerationMatrix = new t.Matrix, this._t0 = t.Vector3.Zero(), this._t1 = t.Vector3.Zero(), this._t2 = t.Vector3.Zero()), t.Matrix.RotationYawPitchRollToRef(this.vAng, this.uAng, this.wAng, this._rowGenerationMatrix), this._prepareRowForTextureGeneration(0, 0, 0, this._t0), this._prepareRowForTextureGeneration(1, 0, 0, this._t1), this._prepareRowForTextureGeneration(0, 1, 0, this._t2), this._t1.subtractInPlace(this._t0), this._t2.subtractInPlace(this._t0), t.Matrix.IdentityToRef(this._cachedTextureMatrix), this._cachedTextureMatrix.m[0] = this._t1.x, this._cachedTextureMatrix.m[1] = this._t1.y, this._cachedTextureMatrix.m[2] = this._t1.z, this._cachedTextureMatrix.m[4] = this._t2.x, this._cachedTextureMatrix.m[5] = this._t2.y, this._cachedTextureMatrix.m[6] = this._t2.z, this._cachedTextureMatrix.m[8] = this._t0.x, this._cachedTextureMatrix.m[9] = this._t0.y, this._cachedTextureMatrix.m[10] = this._t0.z, this._cachedTextureMatrix)
        }, n.prototype.getReflectionTextureMatrix = function() {
            if (this.uOffset === this._cachedUOffset && this.vOffset === this._cachedVOffset && this.uScale === this._cachedUScale && this.vScale === this._cachedVScale && this.coordinatesMode === this._cachedCoordinatesMode)
                return this._cachedTextureMatrix;
            switch (this._cachedTextureMatrix || (this._cachedTextureMatrix = t.Matrix.Zero(), this._projectionModeMatrix = t.Matrix.Zero()), this.coordinatesMode) {
                case t.Texture.SPHERICAL_MODE:
                    t.Matrix.IdentityToRef(this._cachedTextureMatrix), this._cachedTextureMatrix[0] = -.5 * this.uScale, this._cachedTextureMatrix[5] = -.5 * this.vScale, this._cachedTextureMatrix[12] = .5 + this.uOffset, this._cachedTextureMatrix[13] = .5 + this.vOffset;
                    break;
                case t.Texture.PLANAR_MODE:
                    t.Matrix.IdentityToRef(this._cachedTextureMatrix), this._cachedTextureMatrix[0] = this.uScale, this._cachedTextureMatrix[5] = this.vScale, this._cachedTextureMatrix[12] = this.uOffset, this._cachedTextureMatrix[13] = this.vOffset;
                    break;
                case t.Texture.PROJECTION_MODE:
                    t.Matrix.IdentityToRef(this._projectionModeMatrix), this._projectionModeMatrix.m[0] = .5, this._projectionModeMatrix.m[5] = -.5, this._projectionModeMatrix.m[10] = 0, this._projectionModeMatrix.m[12] = .5, this._projectionModeMatrix.m[13] = .5, this._projectionModeMatrix.m[14] = 1, this._projectionModeMatrix.m[15] = 1, this.getScene().getProjectionMatrix().multiplyToRef(this._projectionModeMatrix, this._cachedTextureMatrix);
                    break;
                default:
                    t.Matrix.IdentityToRef(this._cachedTextureMatrix)
            }
            return this._cachedTextureMatrix
        }, n.prototype.clone = function() {
            var e = new t.Texture(this._texture.url, this.getScene(), this._noMipmap, this._invertY);
            return e.hasAlpha = this.hasAlpha, e.level = this.level, e.wrapU = this.wrapU, e.wrapV = this.wrapV, e.coordinatesIndex = this.coordinatesIndex, e.coordinatesMode = this.coordinatesMode, e.uOffset = this.uOffset, e.vOffset = this.vOffset, e.uScale = this.uScale, e.vScale = this.vScale, e.uAng = this.uAng, e.vAng = this.vAng, e.wAng = this.wAng, e
        }, n.NEAREST_SAMPLINGMODE = 1, n.BILINEAR_SAMPLINGMODE = 2, n.TRILINEAR_SAMPLINGMODE = 3, n.EXPLICIT_MODE = 0, n.SPHERICAL_MODE = 1, n.PLANAR_MODE = 2, n.CUBIC_MODE = 3, n.PROJECTION_MODE = 4, n.SKYBOX_MODE = 5, n.CLAMP_ADDRESSMODE = 0, n.WRAP_ADDRESSMODE = 1, n.MIRROR_ADDRESSMODE = 2, n
    }(t.BaseTexture);
    t.Texture = e
}(BABYLON || (BABYLON = {}));
var __extends = this.__extends || function(t, e) {
    function n() {
        this.constructor = t
    }
    for (var i in e)
        e.hasOwnProperty(i) && (t[i] = e[i]);
    n.prototype = e.prototype, t.prototype = new n
}, BABYLON;
!function(t) {
    var e = function(e) {
        function n(n, i, o, r) {
            e.call(this, i), this.coordinatesMode = t.Texture.CUBIC_MODE, this.name = n, this.url = n, this._noMipmap = r, this.hasAlpha = !1, this._texture = this._getFromCache(n, r), o || (o = ["_px.jpg", "_py.jpg", "_pz.jpg", "_nx.jpg", "_ny.jpg", "_nz.jpg"]), this._extensions = o, this._texture || (i.useDelayedTextureLoading ? this.delayLoadState = t.Engine.DELAYLOADSTATE_NOTLOADED : this._texture = i.getEngine().createCubeTexture(n, i, o, r)), this.isCube = !0, this._textureMatrix = t.Matrix.Identity()
        }
        return __extends(n, e), n.prototype.clone = function() {
            var e = new t.CubeTexture(this.url, this.getScene(), this._extensions, this._noMipmap);
            return e.level = this.level, e.wrapU = this.wrapU, e.wrapV = this.wrapV, e.coordinatesIndex = this.coordinatesIndex, e.coordinatesMode = this.coordinatesMode, e
        }, n.prototype.delayLoad = function() {
            this.delayLoadState == t.Engine.DELAYLOADSTATE_NOTLOADED && (this.delayLoadState = t.Engine.DELAYLOADSTATE_LOADED, this._texture = this._getFromCache(this.url, this._noMipmap), this._texture || (this._texture = this.getScene().getEngine().createCubeTexture(this.url, this.getScene(), this._extensions)))
        }, n.prototype.getReflectionTextureMatrix = function() {
            return this._textureMatrix
        }, n
    }(t.BaseTexture);
    t.CubeTexture = e
}(BABYLON || (BABYLON = {}));
var __extends = this.__extends || function(t, e) {
    function n() {
        this.constructor = t
    }
    for (var i in e)
        e.hasOwnProperty(i) && (t[i] = e[i]);
    n.prototype = e.prototype, t.prototype = new n
}, BABYLON;
!function(t) {
    var e = function(e) {
        function n(n, i, o, r, s) {
            "undefined" == typeof s && (s = !0), e.call(this, null, o, !r), this.renderList = new Array, this.renderParticles = !0, this.renderSprites = !1, this.coordinatesMode = t.Texture.PROJECTION_MODE, this._currentRefreshId = -1, this._refreshRate = 1, this.name = n, this.isRenderTarget = !0, this._size = i, this._generateMipMaps = r, this._doNotChangeAspectRatio = s, this._texture = o.getEngine().createRenderTargetTexture(i, r), this._renderingManager = new t.RenderingManager(o)
        }
        return __extends(n, e), n.prototype.resetRefreshCounter = function() {
            this._currentRefreshId = -1
        }, Object.defineProperty(n.prototype, "refreshRate", {get: function() {
                                 return this._refreshRate
                                 },set: function(t) {
                                 this._refreshRate = t, this.resetRefreshCounter()
                                 },enumerable: !0,configurable: !0}), n.prototype._shouldRender = function() {
            return -1 === this._currentRefreshId ? (this._currentRefreshId = 1, !0) : this.refreshRate == this._currentRefreshId ? (this._currentRefreshId = 1, !0) : (this._currentRefreshId++, !1)
        }, n.prototype.getRenderSize = function() {
            return this._size
        }, n.prototype.resize = function(t, e) {
            this.releaseInternalTexture(), this._texture = this.getScene().getEngine().createRenderTargetTexture(t, e)
        }, n.prototype.render = function(t) {
            var e = this.getScene(), n = e.getEngine();
            if (this._waitingRenderList) {
                this.renderList = [];
                for (var i = 0; i < this._waitingRenderList.length; i++) {
                    var o = this._waitingRenderList[i];
                    this.renderList.push(e.getMeshByID(o))
                }
                delete this._waitingRenderList
            }
            if (this.renderList && 0 != this.renderList.length) {
                t && e.postProcessManager._prepareFrame(this._texture) || n.bindFramebuffer(this._texture), n.clear(e.clearColor, !0, !0), this._renderingManager.reset();
                for (var r = 0; r < this.renderList.length; r++) {
                    var s = this.renderList[r];
                    if (s) {
                        if (!s.isReady() || s.material && !s.material.isReady(s)) {
                            this.resetRefreshCounter();
                            continue
                        }
                        if (s.isEnabled() && s.isVisible && s.subMeshes && 0 != (s.layerMask & e.activeCamera.layerMask)) {
                            s._activate(e.getRenderId());
                            for (var a = 0; a < s.subMeshes.length; a++) {
                                var l = s.subMeshes[a];
                                e._activeVertices += l.verticesCount, this._renderingManager.dispatch(l)
                            }
                        }
                    }
                }
                this._doNotChangeAspectRatio || e.updateTransformMatrix(!0), this.onBeforeRender && this.onBeforeRender(), this._renderingManager.render(this.customRenderFunction, this.renderList, this.renderParticles, this.renderSprites), t && e.postProcessManager._finalizeFrame(!1, this._texture), this.onAfterRender && this.onAfterRender(), n.unBindFramebuffer(this._texture), this._doNotChangeAspectRatio || e.updateTransformMatrix(!0)
            }
        }, n.prototype.clone = function() {
            var e = this.getSize(), n = new t.RenderTargetTexture(this.name, e.width, this.getScene(), this._generateMipMaps);
            return n.hasAlpha = this.hasAlpha, n.level = this.level, n.coordinatesMode = this.coordinatesMode, n.renderList = this.renderList.slice(0), n
        }, n
    }(t.Texture);
    t.RenderTargetTexture = e
}(BABYLON || (BABYLON = {}));
var __extends = this.__extends || function(t, e) {
    function n() {
        this.constructor = t
    }
    for (var i in e)
        e.hasOwnProperty(i) && (t[i] = e[i]);
    n.prototype = e.prototype, t.prototype = new n
}, BABYLON;
!function(t) {
    var e = function(e) {
        function n(n, i, o, r) {
            var s = this;
            e.call(this, n, i, o, r, !0), this.mirrorPlane = new t.Plane(0, 1, 0, 1), this._transformMatrix = t.Matrix.Zero(), this._mirrorMatrix = t.Matrix.Zero(), this.onBeforeRender = function() {
                t.Matrix.ReflectionToRef(s.mirrorPlane, s._mirrorMatrix), s._savedViewMatrix = o.getViewMatrix(), s._mirrorMatrix.multiplyToRef(s._savedViewMatrix, s._transformMatrix), o.setTransformMatrix(s._transformMatrix, o.getProjectionMatrix()), o.clipPlane = s.mirrorPlane, o.getEngine().cullBackFaces = !1
            }, this.onAfterRender = function() {
                o.setTransformMatrix(s._savedViewMatrix, o.getProjectionMatrix()), o.getEngine().cullBackFaces = !0, delete o.clipPlane
            }
        }
        return __extends(n, e), n.prototype.clone = function() {
            var e = this.getSize(), n = new t.MirrorTexture(this.name, e.width, this.getScene(), this._generateMipMaps);
            return n.hasAlpha = this.hasAlpha, n.level = this.level, n.mirrorPlane = this.mirrorPlane.clone(), n.renderList = this.renderList.slice(0), n
        }, n
    }(t.RenderTargetTexture);
    t.MirrorTexture = e
}(BABYLON || (BABYLON = {}));
var __extends = this.__extends || function(t, e) {
    function n() {
        this.constructor = t
    }
    for (var i in e)
        e.hasOwnProperty(i) && (t[i] = e[i]);
    n.prototype = e.prototype, t.prototype = new n
}, BABYLON;
!function(t) {
    var e = function(e) {
        function n(n, i, o, r, s) {
            "undefined" == typeof s && (s = t.Texture.TRILINEAR_SAMPLINGMODE), e.call(this, null, o, !r), this.name = n, this.wrapU = t.Texture.CLAMP_ADDRESSMODE, this.wrapV = t.Texture.CLAMP_ADDRESSMODE, this._generateMipMaps = r, i.getContext ? (this._canvas = i, this._texture = o.getEngine().createDynamicTexture(i.width, i.height, r, s)) : (this._canvas = document.createElement("canvas"), this._texture = i.width ? o.getEngine().createDynamicTexture(i.width, i.height, r, s) : o.getEngine().createDynamicTexture(i, i, r, s));
            var a = this.getSize();
            this._canvas.width = a.width, this._canvas.height = a.height, this._context = this._canvas.getContext("2d")
        }
        return __extends(n, e), n.prototype.getContext = function() {
            return this._context
        }, n.prototype.update = function(t) {
            this.getScene().getEngine().updateDynamicTexture(this._texture, this._canvas, void 0 === t ? !0 : t)
        }, n.prototype.drawText = function(t, e, n, i, o, r, s) {
            var a = this.getSize();
            if (r && (this._context.fillStyle = r, this._context.fillRect(0, 0, a.width, a.height)), this._context.font = i, null === e) {
                var l = this._context.measureText(t);
                e = (a.width - l.width) / 2
            }
            this._context.fillStyle = o, this._context.fillText(t, e, n), this.update(s)
        }, n.prototype.clone = function() {
            var e = this.getSize(), n = new t.DynamicTexture(this.name, e.width, this.getScene(), this._generateMipMaps);
            return n.hasAlpha = this.hasAlpha, n.level = this.level, n.wrapU = this.wrapU, n.wrapV = this.wrapV, n
        }, n
    }(t.Texture);
    t.DynamicTexture = e
}(BABYLON || (BABYLON = {}));
var __extends = this.__extends || function(t, e) {
    function n() {
        this.constructor = t
    }
    for (var i in e)
        e.hasOwnProperty(i) && (t[i] = e[i]);
    n.prototype = e.prototype, t.prototype = new n
}, BABYLON;
!function(t) {
    var e = function(e) {
        function n(n, i, o, r, s, a, l) {
            "undefined" == typeof l && (l = t.Texture.TRILINEAR_SAMPLINGMODE);
            var h = this;
            e.call(this, null, r, !s, a), this._autoLaunch = !0, this.name = n, this.wrapU = t.Texture.WRAP_ADDRESSMODE, this.wrapV = t.Texture.WRAP_ADDRESSMODE;
            var c = o.width || o, u = o.height || o;
            this._texture = r.getEngine().createDynamicTexture(c, u, s, l);
            var p = this.getSize();
            this.video = document.createElement("video"), this.video.width = p.width, this.video.height = p.height, this.video.autoplay = !1, this.video.loop = !0, this.video.addEventListener("canplaythrough", function() {
                                                                                                                                                                                                h._texture && (h._texture.isReady = !0)
                                                                                                                                                                                                }), i.forEach(function(t) {
                                                                                                                                                                                                              var e = document.createElement("source");
                                                                                                                                                                                                              e.src = t, h.video.appendChild(e)
                                                                                                                                                                                                              }), this._lastUpdate = (new Date).getTime()
        }
        return __extends(n, e), n.prototype.update = function() {
            this._autoLaunch && (this._autoLaunch = !1, this.video.play());
            var t = (new Date).getTime();
            return t - this._lastUpdate < 15 ? !1 : (this._lastUpdate = t, this.getScene().getEngine().updateVideoTexture(this._texture, this.video, this._invertY), !0)
        }, n
    }(t.Texture);
    t.VideoTexture = e
}(BABYLON || (BABYLON = {}));
var BABYLON;
!function(t) {
    var e = function() {
        function e(t, e, n, i, o, r, s, a, l) {
            var h = this;
            this._isReady = !1, this._compilationError = "", this._valueCache = [], this._engine = o, this.name = t, this.defines = r, this._uniformsNames = n.concat(i), this._samplers = i, this._attributesNames = e, this.onError = l, this.onCompiled = a;
            var c, u;
            t.vertexElement ? (c = document.getElementById(t.vertexElement), u = document.getElementById(t.fragmentElement)) : (c = t.vertexElement || t.vertex || t, u = t.fragmentElement || t.fragment || t), this._loadVertexShader(c, function(t) {
                                                                                                                                                                                                                                        h._loadFragmentShader(u, function(n) {
                                                                                                                                                                                                                                                              h._prepareEffect(t, n, e, r, s)
                                                                                                                                                                                                                                                              })
                                                                                                                                                                                                                                        })
        }
        return e.prototype.isReady = function() {
            return this._isReady
        }, e.prototype.getProgram = function() {
            return this._program
        }, e.prototype.getAttributesNames = function() {
            return this._attributesNames
        }, e.prototype.getAttributeLocation = function(t) {
            return this._attributes[t]
        }, e.prototype.getAttributeLocationByName = function(t) {
            var e = this._attributesNames.indexOf(t);
            return this._attributes[e]
        }, e.prototype.getAttributesCount = function() {
            return this._attributes.length
        }, e.prototype.getUniformIndex = function(t) {
            return this._uniformsNames.indexOf(t)
        }, e.prototype.getUniform = function(t) {
            return this._uniforms[this._uniformsNames.indexOf(t)]
        }, e.prototype.getSamplers = function() {
            return this._samplers
        }, e.prototype.getCompilationError = function() {
            return this._compilationError
        }, e.prototype._loadVertexShader = function(e, n) {
            if (e instanceof HTMLElement) {
                var i = t.Tools.GetDOMTextContent(e);
                return void n(i)
            }
            if (t.Effect.ShadersStore[e + "VertexShader"])
                return void n(t.Effect.ShadersStore[e + "VertexShader"]);
            var o;
            o = "." === e[0] ? e : t.Engine.ShadersRepository + e, t.Tools.LoadFile(o + ".vertex.fx", n)
        }, e.prototype._loadFragmentShader = function(e, n) {
            if (e instanceof HTMLElement) {
                var i = t.Tools.GetDOMTextContent(e);
                return void n(i)
            }
            if (t.Effect.ShadersStore[e + "PixelShader"])
                return void n(t.Effect.ShadersStore[e + "PixelShader"]);
            var o;
            o = "." === e[0] ? e : t.Engine.ShadersRepository + e, t.Tools.LoadFile(o + ".fragment.fx", n)
        }, e.prototype._prepareEffect = function(e, n, i, o, r, s) {
            try {
                var a = this._engine;
                this._program = a.createShaderProgram(e, n, o), this._uniforms = a.getUniforms(this._program, this._uniformsNames), this._attributes = a.getAttributes(this._program, i);
                for (var l = 0; l < this._samplers.length; l++) {
                    var h = this.getUniform(this._samplers[l]);
                    null == h && (this._samplers.splice(l, 1), l--)
                }
                a.bindSamplers(this), this._isReady = !0, this.onCompiled && this.onCompiled(this)
            } catch (c) {
                if (!s && r) {
                    for (l = 0; l < r.length; l++)
                        o = o.replace(r[l], "");
                    this._prepareEffect(e, n, i, o, r, !0)
                } else
                    t.Tools.Error("Unable to compile effect: " + this.name), t.Tools.Error("Defines: " + o), t.Tools.Error("Optional defines: " + r), t.Tools.Error("Error: " + c.message), this._compilationError = c.message, this.onError && this.onError(this, this._compilationError)
                    }
        }, e.prototype._bindTexture = function(t, e) {
            this._engine._bindTexture(this._samplers.indexOf(t), e)
        }, e.prototype.setTexture = function(t, e) {
            this._engine.setTexture(this._samplers.indexOf(t), e)
        }, e.prototype.setTextureFromPostProcess = function(t, e) {
            this._engine.setTextureFromPostProcess(this._samplers.indexOf(t), e)
        }, e.prototype._cacheFloat2 = function(t, e, n) {
            return this._valueCache[t] ? (this._valueCache[t][0] = e, void (this._valueCache[t][1] = n)) : void (this._valueCache[t] = [e, n])
        }, e.prototype._cacheFloat3 = function(t, e, n, i) {
            return this._valueCache[t] ? (this._valueCache[t][0] = e, this._valueCache[t][1] = n, void (this._valueCache[t][2] = i)) : void (this._valueCache[t] = [e, n, i])
        }, e.prototype._cacheFloat4 = function(t, e, n, i, o) {
            return this._valueCache[t] ? (this._valueCache[t][0] = e, this._valueCache[t][1] = n, this._valueCache[t][2] = i, void (this._valueCache[t][3] = o)) : void (this._valueCache[t] = [e, n, i, o])
        }, e.prototype.setArray = function(t, e) {
            return this._engine.setArray(this.getUniform(t), e), this
        }, e.prototype.setMatrices = function(t, e) {
            return this._engine.setMatrices(this.getUniform(t), e), this
        }, e.prototype.setMatrix = function(t, e) {
            return this._engine.setMatrix(this.getUniform(t), e), this
        }, e.prototype.setFloat = function(t, e) {
            return this._valueCache[t] && this._valueCache[t] === e ? this : (this._valueCache[t] = e, this._engine.setFloat(this.getUniform(t), e), this)
        }, e.prototype.setBool = function(t, e) {
            return this._valueCache[t] && this._valueCache[t] === e ? this : (this._valueCache[t] = e, this._engine.setBool(this.getUniform(t), e ? 1 : 0), this)
        }, e.prototype.setVector2 = function(t, e) {
            return this._valueCache[t] && this._valueCache[t][0] == e.x && this._valueCache[t][1] == e.y ? this : (this._cacheFloat2(t, e.x, e.y), this._engine.setFloat2(this.getUniform(t), e.x, e.y), this)
        }, e.prototype.setFloat2 = function(t, e, n) {
            return this._valueCache[t] && this._valueCache[t][0] == e && this._valueCache[t][1] == n ? this : (this._cacheFloat2(t, e, n), this._engine.setFloat2(this.getUniform(t), e, n), this)
        }, e.prototype.setVector3 = function(t, e) {
            return this._valueCache[t] && this._valueCache[t][0] == e.x && this._valueCache[t][1] == e.y && this._valueCache[t][2] == e.z ? this : (this._cacheFloat3(t, e.x, e.y, e.z), this._engine.setFloat3(this.getUniform(t), e.x, e.y, e.z), this)
        }, e.prototype.setFloat3 = function(t, e, n, i) {
            return this._valueCache[t] && this._valueCache[t][0] == e && this._valueCache[t][1] == n && this._valueCache[t][2] == i ? this : (this._cacheFloat3(t, e, n, i), this._engine.setFloat3(this.getUniform(t), e, n, i), this)
        }, e.prototype.setFloat4 = function(t, e, n, i, o) {
            return this._valueCache[t] && this._valueCache[t][0] == e && this._valueCache[t][1] == n && this._valueCache[t][2] == i && this._valueCache[t][3] == o ? this : (this._cacheFloat4(t, e, n, i, o), this._engine.setFloat4(this.getUniform(t), e, n, i, o), this)
        }, e.prototype.setColor3 = function(t, e) {
            return this._valueCache[t] && this._valueCache[t][0] == e.r && this._valueCache[t][1] == e.g && this._valueCache[t][2] == e.b ? this : (this._cacheFloat3(t, e.r, e.g, e.b), this._engine.setColor3(this.getUniform(t), e), this)
        }, e.prototype.setColor4 = function(t, e, n) {
            return this._valueCache[t] && this._valueCache[t][0] == e.r && this._valueCache[t][1] == e.g && this._valueCache[t][2] == e.b && this._valueCache[t][3] == n ? this : (this._cacheFloat4(t, e.r, e.g, e.b, n), this._engine.setColor4(this.getUniform(t), e, n), this)
        }, e.ShadersStore = {}, e
    }();
    t.Effect = e
}(BABYLON || (BABYLON = {}));
var BABYLON;
!function(t) {
    var e = function() {
        function t(t, e, n) {
            this.name = t, this.checkReadyOnEveryCall = !1, this.checkReadyOnlyOnce = !0, this.state = "", this.alpha = 1, this.wireframe = !1, this.backFaceCulling = !0, this._wasPreviouslyReady = !1, this.id = t, this._scene = e, n || e.materials.push(this)
        }
        return t.prototype.isReady = function() {
            return !0
        }, t.prototype.getEffect = function() {
            return this._effect
        }, t.prototype.getScene = function() {
            return this._scene
        }, t.prototype.needAlphaBlending = function() {
            return this.alpha < 1
        }, t.prototype.needAlphaTesting = function() {
            return !1
        }, t.prototype.getAlphaTestTexture = function() {
            return null
        }, t.prototype.trackCreation = function() {
        }, t.prototype._preBind = function() {
            var t = this._scene.getEngine();
            return t.setState(this.backFaceCulling), t.enableEffect(this._effect)
        }, t.prototype.bind = function() {
        }, t.prototype.bindOnlyWorldMatrix = function() {
        }, t.prototype.unbind = function() {
        }, t.prototype.dispose = function(t) {
            var e = this._scene.materials.indexOf(this);
            this._scene.materials.splice(e, 1), t && this._effect && (this._scene.getEngine()._releaseEffect(this._effect), this._effect = null), this.onDispose && this.onDispose()
        }, t
    }();
    t.Material = e
}(BABYLON || (BABYLON = {}));
var __extends = this.__extends || function(t, e) {
    function n() {
        this.constructor = t
    }
    for (var i in e)
        e.hasOwnProperty(i) && (t[i] = e[i]);
    n.prototype = e.prototype, t.prototype = new n
}, BABYLON;
!function(t) {
    var e = 4, n = function(n) {
        function i(e, i) {
            var o = this;
            n.call(this, e, i), this.ambientColor = new t.Color3(0, 0, 0), this.diffuseColor = new t.Color3(1, 1, 1), this.specularColor = new t.Color3(1, 1, 1), this.specularPower = 64, this.emissiveColor = new t.Color3(0, 0, 0), this.useAlphaFromDiffuseTexture = !1, this._cachedDefines = null, this._renderTargets = new t.SmartArray(16), this._worldViewProjectionMatrix = t.Matrix.Zero(), this._globalAmbientColor = new t.Color3(0, 0, 0), this._baseColor = new t.Color3, this._scaledDiffuse = new t.Color3, this._scaledSpecular = new t.Color3, this.getRenderTargetTextures = function() {
                return o._renderTargets.reset(), o.reflectionTexture && o.reflectionTexture.isRenderTarget && o._renderTargets.push(o.reflectionTexture), o._renderTargets
            }
        }
        return __extends(i, n), i.prototype.needAlphaBlending = function() {
            return this.alpha < 1 || null != this.opacityTexture || this._shouldUseAlphaFromDiffuseTexture()
        }, i.prototype.needAlphaTesting = function() {
            return null != this.diffuseTexture && this.diffuseTexture.hasAlpha && !this.diffuseTexture.getAlphaFromRGB
        }, i.prototype._shouldUseAlphaFromDiffuseTexture = function() {
            return null != this.diffuseTexture && this.diffuseTexture.hasAlpha && this.useAlphaFromDiffuseTexture
        }, i.prototype.getAlphaTestTexture = function() {
            return this.diffuseTexture
        }, i.prototype._shouldUseAlphaFromDiffuseTexture = function() {
            return null != this.diffuseTexture && this.diffuseTexture.hasAlpha && this.useAlphaFromDiffuseTexture
        }, i.prototype.isReady = function(n, i) {
            if (this.checkReadyOnlyOnce && this._wasPreviouslyReady)
                return !0;
            var o = this.getScene();
            if (!this.checkReadyOnEveryCall && this._renderId === o.getRenderId())
                return !0;
            var r = o.getEngine(), s = [], a = new Array;
            if (o.texturesEnabled) {
                if (this.diffuseTexture && t.StandardMaterial.DiffuseTextureEnabled) {
                    if (!this.diffuseTexture.isReady())
                        return !1;
                    s.push("#define DIFFUSE")
                }
                if (this.ambientTexture && t.StandardMaterial.AmbientTextureEnabled) {
                    if (!this.ambientTexture.isReady())
                        return !1;
                    s.push("#define AMBIENT")
                }
                if (this.opacityTexture && t.StandardMaterial.OpacityTextureEnabled) {
                    if (!this.opacityTexture.isReady())
                        return !1;
                    s.push("#define OPACITY"), this.opacityTexture.getAlphaFromRGB && s.push("#define OPACITYRGB")
                }
                if (this.reflectionTexture && t.StandardMaterial.ReflectionTextureEnabled) {
                    if (!this.reflectionTexture.isReady())
                        return !1;
                    s.push("#define REFLECTION")
                }
                if (this.emissiveTexture && t.StandardMaterial.EmissiveTextureEnabled) {
                    if (!this.emissiveTexture.isReady())
                        return !1;
                    s.push("#define EMISSIVE")
                }
                if (this.specularTexture && t.StandardMaterial.SpecularTextureEnabled) {
                    if (!this.specularTexture.isReady())
                        return !1;
                    s.push("#define SPECULAR"), a.push(s[s.length - 1])
                }
            }
            if (o.getEngine().getCaps().standardDerivatives && this.bumpTexture && t.StandardMaterial.BumpTextureEnabled) {
                if (!this.bumpTexture.isReady())
                    return !1;
                s.push("#define BUMP"), a.push(s[s.length - 1])
            }
            o.clipPlane && s.push("#define CLIPPLANE"), r.getAlphaTesting() && s.push("#define ALPHATEST"), this._shouldUseAlphaFromDiffuseTexture() && s.push("#define ALPHAFROMDIFFUSE"), o.fogMode !== t.Scene.FOGMODE_NONE && (s.push("#define FOG"), a.push(s[s.length - 1]));
            var l = !1, h = 0;
            if (o.lightsEnabled)
                for (var c = 0; c < o.lights.length; c++) {
                    var u = o.lights[c];
                    if (u.isEnabled()) {
                        if (u._excludedMeshesIds.length > 0) {
                            for (var p = 0; p < u._excludedMeshesIds.length; p++) {
                                var d = o.getMeshByID(u._excludedMeshesIds[p]);
                                d && u.excludedMeshes.push(d)
                            }
                            u._excludedMeshesIds = []
                        }
                        if (!n || -1 === u.excludedMeshes.indexOf(n)) {
                            s.push("#define LIGHT" + h), h > 0 && a.push(s[s.length - 1]);
                            var m;
                            m = u instanceof t.SpotLight ? "#define SPOTLIGHT" + h : u instanceof t.HemisphericLight ? "#define HEMILIGHT" + h : "#define POINTDIRLIGHT" + h, s.push(m), h > 0 && a.push(s[s.length - 1]);
                            var g = u.getShadowGenerator();
                            if (n && n.receiveShadows && g && (s.push("#define SHADOW" + h), h > 0 && a.push(s[s.length - 1]), l || (s.push("#define SHADOWS"), l = !0), g.useVarianceShadowMap && (s.push("#define SHADOWVSM" + h), h > 0 && a.push(s[s.length - 1])), g.usePoissonSampling && (s.push("#define SHADOWPCF" + h), h > 0 && a.push(s[s.length - 1]))), h++, h == e)
                                break
                                }
                    }
                }
            var f = [t.VertexBuffer.PositionKind, t.VertexBuffer.NormalKind];
            n && (n.isVerticesDataPresent(t.VertexBuffer.UVKind) && (f.push(t.VertexBuffer.UVKind), s.push("#define UV1")), n.isVerticesDataPresent(t.VertexBuffer.UV2Kind) && (f.push(t.VertexBuffer.UV2Kind), s.push("#define UV2")), n.isVerticesDataPresent(t.VertexBuffer.ColorKind) && (f.push(t.VertexBuffer.ColorKind), s.push("#define VERTEXCOLOR")), n.skeleton && n.isVerticesDataPresent(t.VertexBuffer.MatricesIndicesKind) && n.isVerticesDataPresent(t.VertexBuffer.MatricesWeightsKind) && (f.push(t.VertexBuffer.MatricesIndicesKind), f.push(t.VertexBuffer.MatricesWeightsKind), s.push("#define BONES"), s.push("#define BonesPerMesh " + (n.skeleton.bones.length + 1)), s.push("#define BONES4"), a.push(s[s.length - 1])), i && (s.push("#define INSTANCES"), f.push("world0"), f.push("world1"), f.push("world2"), f.push("world3")));
            var y = s.join("\n");
            if (this._cachedDefines != y) {
                this._cachedDefines = y;
                var _ = "default";
                o.getEngine().getCaps().standardDerivatives || (_ = "legacydefault"), this._effect = o.getEngine().createEffect(_, f, ["world", "view", "viewProjection", "vEyePosition", "vLightsType", "vAmbientColor", "vDiffuseColor", "vSpecularColor", "vEmissiveColor", "vLightData0", "vLightDiffuse0", "vLightSpecular0", "vLightDirection0", "vLightGround0", "lightMatrix0", "vLightData1", "vLightDiffuse1", "vLightSpecular1", "vLightDirection1", "vLightGround1", "lightMatrix1", "vLightData2", "vLightDiffuse2", "vLightSpecular2", "vLightDirection2", "vLightGround2", "lightMatrix2", "vLightData3", "vLightDiffuse3", "vLightSpecular3", "vLightDirection3", "vLightGround3", "lightMatrix3", "vFogInfos", "vFogColor", "vDiffuseInfos", "vAmbientInfos", "vOpacityInfos", "vReflectionInfos", "vEmissiveInfos", "vSpecularInfos", "vBumpInfos", "mBones", "vClipPlane", "diffuseMatrix", "ambientMatrix", "opacityMatrix", "reflectionMatrix", "emissiveMatrix", "specularMatrix", "bumpMatrix", "darkness0", "darkness1", "darkness2", "darkness3"], ["diffuseSampler", "ambientSampler", "opacitySampler", "reflectionCubeSampler", "reflection2DSampler", "emissiveSampler", "specularSampler", "bumpSampler", "shadowSampler0", "shadowSampler1", "shadowSampler2", "shadowSampler3"], y, a, this.onCompiled, this.onError)
            }
            return this._effect.isReady() ? (this._renderId = o.getRenderId(), this._wasPreviouslyReady = !0, !0) : !1
        }, i.prototype.unbind = function() {
            this.reflectionTexture && this.reflectionTexture.isRenderTarget && this._effect.setTexture("reflection2DSampler", null)
        }, i.prototype.bindOnlyWorldMatrix = function(t) {
            this._effect.setMatrix("world", t)
        }, i.prototype.bind = function(n, i) {
            var o = this.getScene();
            if (this._baseColor.copyFrom(this.diffuseColor), this.bindOnlyWorldMatrix(n), this._effect.setMatrix("viewProjection", o.getTransformMatrix()), i.skeleton && i.isVerticesDataPresent(t.VertexBuffer.MatricesIndicesKind) && i.isVerticesDataPresent(t.VertexBuffer.MatricesWeightsKind) && this._effect.setMatrices("mBones", i.skeleton.getTransformMatrices()), this.diffuseTexture && t.StandardMaterial.DiffuseTextureEnabled && (this._effect.setTexture("diffuseSampler", this.diffuseTexture), this._effect.setFloat2("vDiffuseInfos", this.diffuseTexture.coordinatesIndex, this.diffuseTexture.level), this._effect.setMatrix("diffuseMatrix", this.diffuseTexture.getTextureMatrix()), this._baseColor.copyFromFloats(1, 1, 1)), this.ambientTexture && t.StandardMaterial.AmbientTextureEnabled && (this._effect.setTexture("ambientSampler", this.ambientTexture), this._effect.setFloat2("vAmbientInfos", this.ambientTexture.coordinatesIndex, this.ambientTexture.level), this._effect.setMatrix("ambientMatrix", this.ambientTexture.getTextureMatrix())), this.opacityTexture && t.StandardMaterial.OpacityTextureEnabled && (this._effect.setTexture("opacitySampler", this.opacityTexture), this._effect.setFloat2("vOpacityInfos", this.opacityTexture.coordinatesIndex, this.opacityTexture.level), this._effect.setMatrix("opacityMatrix", this.opacityTexture.getTextureMatrix())), this.reflectionTexture && t.StandardMaterial.ReflectionTextureEnabled && (this.reflectionTexture.isCube ? this._effect.setTexture("reflectionCubeSampler", this.reflectionTexture) : this._effect.setTexture("reflection2DSampler", this.reflectionTexture), this._effect.setMatrix("reflectionMatrix", this.reflectionTexture.getReflectionTextureMatrix()), this._effect.setFloat3("vReflectionInfos", this.reflectionTexture.coordinatesMode, this.reflectionTexture.level, this.reflectionTexture.isCube ? 1 : 0)), this.emissiveTexture && t.StandardMaterial.EmissiveTextureEnabled && (this._effect.setTexture("emissiveSampler", this.emissiveTexture), this._effect.setFloat2("vEmissiveInfos", this.emissiveTexture.coordinatesIndex, this.emissiveTexture.level), this._effect.setMatrix("emissiveMatrix", this.emissiveTexture.getTextureMatrix())), this.specularTexture && t.StandardMaterial.SpecularTextureEnabled && (this._effect.setTexture("specularSampler", this.specularTexture), this._effect.setFloat2("vSpecularInfos", this.specularTexture.coordinatesIndex, this.specularTexture.level), this._effect.setMatrix("specularMatrix", this.specularTexture.getTextureMatrix())), this.bumpTexture && o.getEngine().getCaps().standardDerivatives && t.StandardMaterial.BumpTextureEnabled && (this._effect.setTexture("bumpSampler", this.bumpTexture), this._effect.setFloat2("vBumpInfos", this.bumpTexture.coordinatesIndex, this.bumpTexture.level), this._effect.setMatrix("bumpMatrix", this.bumpTexture.getTextureMatrix())), o.ambientColor.multiplyToRef(this.ambientColor, this._globalAmbientColor), this._effect.setVector3("vEyePosition", o.activeCamera.position), this._effect.setColor3("vAmbientColor", this._globalAmbientColor), this._effect.setColor4("vDiffuseColor", this._baseColor, this.alpha * i.visibility), this._effect.setColor4("vSpecularColor", this.specularColor, this.specularPower), this._effect.setColor3("vEmissiveColor", this.emissiveColor), o.lightsEnabled)
                for (var r = 0, s = 0; s < o.lights.length; s++) {
                    var a = o.lights[s];
                    if (a.isEnabled() && (!i || -1 === a.excludedMeshes.indexOf(i))) {
                        a instanceof t.PointLight ? a.transferToEffect(this._effect, "vLightData" + r) : a instanceof t.DirectionalLight ? a.transferToEffect(this._effect, "vLightData" + r) : a instanceof t.SpotLight ? a.transferToEffect(this._effect, "vLightData" + r, "vLightDirection" + r) : a instanceof t.HemisphericLight && a.transferToEffect(this._effect, "vLightData" + r, "vLightGround" + r), a.diffuse.scaleToRef(a.intensity, this._scaledDiffuse), a.specular.scaleToRef(a.intensity, this._scaledSpecular), this._effect.setColor4("vLightDiffuse" + r, this._scaledDiffuse, a.range), this._effect.setColor3("vLightSpecular" + r, this._scaledSpecular);
                        var l = a.getShadowGenerator();
                        if (i.receiveShadows && l && (this._effect.setMatrix("lightMatrix" + r, l.getTransformMatrix()), this._effect.setTexture("shadowSampler" + r, l.getShadowMap()), this._effect.setFloat("darkness" + r, l.getDarkness())), r++, r == e)
                            break
                            }
                }
            if (o.clipPlane) {
                var h = o.clipPlane;
                this._effect.setFloat4("vClipPlane", h.normal.x, h.normal.y, h.normal.z, h.d)
            }
            (o.fogMode !== t.Scene.FOGMODE_NONE || this.reflectionTexture) && this._effect.setMatrix("view", o.getViewMatrix()), o.fogMode !== t.Scene.FOGMODE_NONE && (this._effect.setFloat4("vFogInfos", o.fogMode, o.fogStart, o.fogEnd, o.fogDensity), this._effect.setColor3("vFogColor", o.fogColor))
        }, i.prototype.getAnimatables = function() {
            var t = [];
            return this.diffuseTexture && this.diffuseTexture.animations && this.diffuseTexture.animations.length > 0 && t.push(this.diffuseTexture), this.ambientTexture && this.ambientTexture.animations && this.ambientTexture.animations.length > 0 && t.push(this.ambientTexture), this.opacityTexture && this.opacityTexture.animations && this.opacityTexture.animations.length > 0 && t.push(this.opacityTexture), this.reflectionTexture && this.reflectionTexture.animations && this.reflectionTexture.animations.length > 0 && t.push(this.reflectionTexture), this.emissiveTexture && this.emissiveTexture.animations && this.emissiveTexture.animations.length > 0 && t.push(this.emissiveTexture), this.specularTexture && this.specularTexture.animations && this.specularTexture.animations.length > 0 && t.push(this.specularTexture), this.bumpTexture && this.bumpTexture.animations && this.bumpTexture.animations.length > 0 && t.push(this.bumpTexture), t
        }, i.prototype.dispose = function(t) {
            this.diffuseTexture && this.diffuseTexture.dispose(), this.ambientTexture && this.ambientTexture.dispose(), this.opacityTexture && this.opacityTexture.dispose(), this.reflectionTexture && this.reflectionTexture.dispose(), this.emissiveTexture && this.emissiveTexture.dispose(), this.specularTexture && this.specularTexture.dispose(), this.bumpTexture && this.bumpTexture.dispose(), n.prototype.dispose.call(this, t)
        }, i.prototype.clone = function(e) {
            var n = new t.StandardMaterial(e, this.getScene());
            return n.checkReadyOnEveryCall = this.checkReadyOnEveryCall, n.alpha = this.alpha, n.wireframe = this.wireframe, n.backFaceCulling = this.backFaceCulling, this.diffuseTexture && this.diffuseTexture.clone && (n.diffuseTexture = this.diffuseTexture.clone()), this.ambientTexture && this.ambientTexture.clone && (n.ambientTexture = this.ambientTexture.clone()), this.opacityTexture && this.opacityTexture.clone && (n.opacityTexture = this.opacityTexture.clone()), this.reflectionTexture && this.reflectionTexture.clone && (n.reflectionTexture = this.reflectionTexture.clone()), this.emissiveTexture && this.emissiveTexture.clone && (n.emissiveTexture = this.emissiveTexture.clone()), this.specularTexture && this.specularTexture.clone && (n.specularTexture = this.specularTexture.clone()), this.bumpTexture && this.bumpTexture.clone && (n.bumpTexture = this.bumpTexture.clone()), n.ambientColor = this.ambientColor.clone(), n.diffuseColor = this.diffuseColor.clone(), n.specularColor = this.specularColor.clone(), n.specularPower = this.specularPower, n.emissiveColor = this.emissiveColor.clone(), n
        }, i.DiffuseTextureEnabled = !0, i.AmbientTextureEnabled = !0, i.OpacityTextureEnabled = !0, i.ReflectionTextureEnabled = !0, i.EmissiveTextureEnabled = !0, i.SpecularTextureEnabled = !0, i.BumpTextureEnabled = !0, i
    }(t.Material);
    t.StandardMaterial = n
}(BABYLON || (BABYLON = {}));
var __extends = this.__extends || function(t, e) {
    function n() {
        this.constructor = t
    }
    for (var i in e)
        e.hasOwnProperty(i) && (t[i] = e[i]);
    n.prototype = e.prototype, t.prototype = new n
}, BABYLON;
!function(t) {
    var e = function(t) {
        function e(e, n) {
            t.call(this, e, n, !0), this.subMaterials = new Array, n.multiMaterials.push(this)
        }
        return __extends(e, t), e.prototype.getSubMaterial = function(t) {
            return 0 > t || t >= this.subMaterials.length ? this.getScene().defaultMaterial : this.subMaterials[t]
        }, e.prototype.isReady = function(t) {
            for (var e = 0; e < this.subMaterials.length; e++) {
                var n = this.subMaterials[e];
                if (n && !this.subMaterials[e].isReady(t))
                    return !1
                    }
            return !0
        }, e
    }(t.Material);
    t.MultiMaterial = e
}(BABYLON || (BABYLON = {}));
var BABYLON;
!function(t) {
    var e = function() {
        function e() {
        }
        return Object.defineProperty(e, "ForceFullSceneLoadingForIncremental", {get: function() {
                                     return e._ForceFullSceneLoadingForIncremental
                                     },set: function(t) {
                                     e._ForceFullSceneLoadingForIncremental = t
                                     },enumerable: !0,configurable: !0}), e._getPluginForFilename = function(t) {
            for (var e = t.lastIndexOf("."), n = t.substring(e).toLowerCase(), i = 0; i < this._registeredPlugins.length; i++) {
                var o = this._registeredPlugins[i];
                if (-1 !== o.extensions.indexOf(n))
                    return o
                    }
            return this._registeredPlugins[this._registeredPlugins.length - 1]
        }, e.RegisterPlugin = function(t) {
            t.extensions = t.extensions.toLowerCase(), e._registeredPlugins.push(t)
        }, e.ImportMesh = function(e, n, i, o, r, s, a) {
            var l = this, h = function() {
                o.database = c;
                var h = l._getPluginForFilename(i), u = function(t) {
                    var s = [], l = [], c = [];
                    return h.importMesh(e, o, t, n, s, l, c) ? void (r && (o.importedMeshesFiles.push(n + i), r(s, l, c))) : void (a && a(o))
                };
                return i.substr && "data:" === i.substr(0, 5) ? void u(i.substr(5)) : void t.Tools.LoadFile(n + i, function(t) {
                                                                                                            u(t)
                                                                                                            }, s, c)
            }, c = new t.Database(n + i, h)
        }, e.Load = function(e, n, i, o, r, s) {
            var a, l = this._getPluginForFilename(n.name || n), h = function(n) {
                var r = new t.Scene(i);
                return r.database = a, l.load(r, n, e) ? void (o && o(r)) : void (s && s(r))
            }, c = function() {
                t.Tools.LoadFile(e + n, h, r, a)
            };
            return n.substr && "data:" === n.substr(0, 5) ? void h(n.substr(5)) : void (-1 === e.indexOf("file:") ? a = new t.Database(e + n, c) : t.Tools.ReadFile(n, h, r))
        }, e._ForceFullSceneLoadingForIncremental = !1, e._registeredPlugins = new Array, e
    }();
    t.SceneLoader = e
}(BABYLON || (BABYLON = {}));
var BABYLON;
!function(t) {
    !function() {
        var e = function(e, n, i) {
            var o = new t.CubeTexture(e + n.name, i);
            return o.name = n.name, o.hasAlpha = n.hasAlpha, o.level = n.level, o.coordinatesMode = n.coordinatesMode, o
        }, n = function(n, i, o) {
            if (!i.name && !i.isRenderTarget)
                return null;
            if (i.isCube)
                return e(n, i, o);
            var r;
            if (i.mirrorPlane ? (r = new t.MirrorTexture(i.name, i.renderTargetSize, o), r._waitingRenderList = i.renderList, r.mirrorPlane = t.Plane.FromArray(i.mirrorPlane)) : i.isRenderTarget ? (r = new t.RenderTargetTexture(i.name, i.renderTargetSize, o), r._waitingRenderList = i.renderList) : r = new t.Texture(n + i.name, o), r.name = i.name, r.hasAlpha = i.hasAlpha, r.getAlphaFromRGB = i.getAlphaFromRGB, r.level = i.level, r.coordinatesIndex = i.coordinatesIndex, r.coordinatesMode = i.coordinatesMode, r.uOffset = i.uOffset, r.vOffset = i.vOffset, r.uScale = i.uScale, r.vScale = i.vScale, r.uAng = i.uAng, r.vAng = i.vAng, r.wAng = i.wAng, r.wrapU = i.wrapU, r.wrapV = i.wrapV, i.animations)
                for (var s = 0; s < i.animations.length; s++) {
                    var a = i.animations[s];
                    r.animations.push(c(a))
                }
            return r
        }, i = function(e, n) {
            for (var i = new t.Skeleton(e.name, e.id, n), o = 0; o < e.bones.length; o++) {
                var r = e.bones[o], s = null;
                r.parentBoneIndex > -1 && (s = i.bones[r.parentBoneIndex]);
                var a = new t.Bone(r.name, i, s, t.Matrix.FromArray(r.matrix));
                r.animation && a.animations.push(c(r.animation))
            }
            return i
        }, o = function(e, i, o) {
            var r;
            return r = new t.StandardMaterial(e.name, i), r.ambientColor = t.Color3.FromArray(e.ambient), r.diffuseColor = t.Color3.FromArray(e.diffuse), r.specularColor = t.Color3.FromArray(e.specular), r.specularPower = e.specularPower, r.emissiveColor = t.Color3.FromArray(e.emissive), r.alpha = e.alpha, r.id = e.id, t.Tags.AddTagsTo(r, e.tags), r.backFaceCulling = e.backFaceCulling, r.wireframe = e.wireframe, e.diffuseTexture && (r.diffuseTexture = n(o, e.diffuseTexture, i)), e.ambientTexture && (r.ambientTexture = n(o, e.ambientTexture, i)), e.opacityTexture && (r.opacityTexture = n(o, e.opacityTexture, i)), e.reflectionTexture && (r.reflectionTexture = n(o, e.reflectionTexture, i)), e.emissiveTexture && (r.emissiveTexture = n(o, e.emissiveTexture, i)), e.specularTexture && (r.specularTexture = n(o, e.specularTexture, i)), e.bumpTexture && (r.bumpTexture = n(o, e.bumpTexture, i)), r
        }, r = function(t, e, n, i) {
            for (var r = 0; r < e.materials.length; r++) {
                var s = e.materials[r];
                if (s.id === t)
                    return o(s, n, i)
                    }
            return null
        }, s = function(e, n) {
            var i = new t.MultiMaterial(e.name, n);
            i.id = e.id, t.Tags.AddTagsTo(i, e.tags);
            for (var o = 0; o < e.materials.length; o++) {
                var r = e.materials[o];
                i.subMaterials.push(r ? n.getMaterialByID(r) : null)
            }
            return i
        }, a = function(e, n, i) {
            var o = n.getLastEntryByID(e.emitterId), r = new t.LensFlareSystem("lensFlareSystem#" + e.emitterId, o, n);
            r.borderLimit = e.borderLimit;
            for (var s = 0; s < e.flares.length; s++) {
                var a = e.flares[s];
                new t.LensFlare(a.size, a.position, t.Color3.FromArray(a.color), i + a.textureName, r)
            }
            return r
        }, l = function(e, n, i) {
            var o = n.getLastMeshByID(e.emitterId), r = new t.ParticleSystem("particles#" + o.name, e.capacity, n);
            return e.textureName && (r.particleTexture = new t.Texture(i + e.textureName, n), r.particleTexture.name = e.textureName), r.minAngularSpeed = e.minAngularSpeed, r.maxAngularSpeed = e.maxAngularSpeed, r.minSize = e.minSize, r.maxSize = e.maxSize, r.minLifeTime = e.minLifeTime, r.maxLifeTime = e.maxLifeTime, r.emitter = o, r.emitRate = e.emitRate, r.minEmitBox = t.Vector3.FromArray(e.minEmitBox), r.maxEmitBox = t.Vector3.FromArray(e.maxEmitBox), r.gravity = t.Vector3.FromArray(e.gravity), r.direction1 = t.Vector3.FromArray(e.direction1), r.direction2 = t.Vector3.FromArray(e.direction2), r.color1 = t.Color4.FromArray(e.color1), r.color2 = t.Color4.FromArray(e.color2), r.colorDead = t.Color4.FromArray(e.colorDead), r.updateSpeed = e.updateSpeed, r.targetStopDuration = e.targetStopFrame, r.textureMask = t.Color4.FromArray(e.textureMask), r.blendMode = e.blendMode, r.start(), r
        }, h = function(e, n) {
            for (var i = n.getLightByID(e.lightId), o = new t.ShadowGenerator(e.mapSize, i), r = 0; r < e.renderList.length; r++) {
                var s = n.getMeshByID(e.renderList[r]);
                o.getShadowMap().renderList.push(s)
            }
            return e.usePoissonSampling ? o.usePoissonSampling = !0 : o.useVarianceShadowMap = e.useVarianceShadowMap, o
        }, c = function(e) {
            for (var n = new t.Animation(e.name, e.property, e.framePerSecond, e.dataType, e.loopBehavior), i = e.dataType, o = [], r = 0; r < e.keys.length; r++) {
                var s, a = e.keys[r];
                switch (i) {
                    case t.Animation.ANIMATIONTYPE_FLOAT:
                        s = a.values[0];
                        break;
                    case t.Animation.ANIMATIONTYPE_QUATERNION:
                        s = t.Quaternion.FromArray(a.values);
                        break;
                    case t.Animation.ANIMATIONTYPE_MATRIX:
                        s = t.Matrix.FromArray(a.values);
                        break;
                    case t.Animation.ANIMATIONTYPE_VECTOR3:
                    default:
                        s = t.Vector3.FromArray(a.values)
                }
                o.push({frame: a.frame,value: s})
            }
            return n.setKeys(o), n
        }, u = function(e, n) {
            var i;
            switch (e.type) {
                case 0:
                    i = new t.PointLight(e.name, t.Vector3.FromArray(e.position), n);
                    break;
                case 1:
                    i = new t.DirectionalLight(e.name, t.Vector3.FromArray(e.direction), n), i.position = t.Vector3.FromArray(e.position);
                    break;
                case 2:
                    i = new t.SpotLight(e.name, t.Vector3.FromArray(e.position), t.Vector3.FromArray(e.direction), e.angle, e.exponent, n);
                    break;
                case 3:
                    i = new t.HemisphericLight(e.name, t.Vector3.FromArray(e.direction), n), i.groundColor = t.Color3.FromArray(e.groundColor)
            }
            if (i.id = e.id, t.Tags.AddTagsTo(i, e.tags), void 0 !== e.intensity && (i.intensity = e.intensity), e.range && (i.range = e.range), i.diffuse = t.Color3.FromArray(e.diffuse), i.specular = t.Color3.FromArray(e.specular), e.excludedMeshesIds && (i._excludedMeshesIds = e.excludedMeshesIds), e.animations)
                for (var o = 0; o < e.animations.length; o++) {
                    var r = e.animations[o];
                    i.animations.push(c(r))
                }
            e.autoAnimate && n.beginAnimation(i, e.autoAnimateFrom, e.autoAnimateTo, e.autoAnimateLoop, 1)
        }, p = function(e, n) {
            var i = new t.FreeCamera(e.name, t.Vector3.FromArray(e.position), n);
            if (i.id = e.id, t.Tags.AddTagsTo(i, e.tags), e.parentId && (i._waitingParentId = e.parentId), e.target ? i.setTarget(t.Vector3.FromArray(e.target)) : i.rotation = t.Vector3.FromArray(e.rotation), e.lockedTargetId && (i._waitingLockedTargetId = e.lockedTargetId), i.fov = e.fov, i.minZ = e.minZ, i.maxZ = e.maxZ, i.speed = e.speed, i.inertia = e.inertia, i.checkCollisions = e.checkCollisions, i.applyGravity = e.applyGravity, e.ellipsoid && (i.ellipsoid = t.Vector3.FromArray(e.ellipsoid)), e.animations)
                for (var o = 0; o < e.animations.length; o++) {
                    var r = e.animations[o];
                    i.animations.push(c(r))
                }
            return e.autoAnimate && n.beginAnimation(i, e.autoAnimateFrom, e.autoAnimateTo, e.autoAnimateLoop, 1), i.layerMask = e.layerMask && !isNaN(e.layerMask) ? Math.abs(parseInt(e.layerMask)) : 4294967295, i
        }, d = function(t, e) {
            var n = t.id;
            return e.getGeometryByID(n)
        }, m = function(e, n) {
            if (d(e, n))
                return null;
            var i = new t.Geometry.Primitives.Box(e.id, n, e.size, e.canBeRegenerated, null);
            return t.Tags.AddTagsTo(i, e.tags), n.pushGeometry(i, !0), i
        }, g = function(e, n) {
            if (d(e, n))
                return null;
            var i = new t.Geometry.Primitives.Sphere(e.id, n, e.segments, e.diameter, e.canBeRegenerated, null);
            return t.Tags.AddTagsTo(i, e.tags), n.pushGeometry(i, !0), i
        }, f = function(e, n) {
            if (d(e, n))
                return null;
            var i = new t.Geometry.Primitives.Cylinder(e.id, n, e.height, e.diameterTop, e.diameterBottom, e.tessellation, e.subdivisions, e.canBeRegenerated, null);
            return t.Tags.AddTagsTo(i, e.tags), n.pushGeometry(i, !0), i
        }, y = function(e, n) {
            if (d(e, n))
                return null;
            var i = new t.Geometry.Primitives.Torus(e.id, n, e.diameter, e.thickness, e.tessellation, e.canBeRegenerated, null);
            return t.Tags.AddTagsTo(i, e.tags), n.pushGeometry(i, !0), i
        }, _ = function(e, n) {
            if (d(e, n))
                return null;
            var i = new t.Geometry.Primitives.Ground(e.id, n, e.width, e.height, e.subdivisions, e.canBeRegenerated, null);
            return t.Tags.AddTagsTo(i, e.tags), n.pushGeometry(i, !0), i
        }, v = function(e, n) {
            if (d(e, n))
                return null;
            var i = new t.Geometry.Primitives.Plane(e.id, n, e.size, e.canBeRegenerated, null);
            return t.Tags.AddTagsTo(i, e.tags), n.pushGeometry(i, !0), i
        }, b = function(e, n) {
            if (d(e, n))
                return null;
            var i = new t.Geometry.Primitives.TorusKnot(e.id, n, e.radius, e.tube, e.radialSegments, e.tubularSegments, e.p, e.q, e.canBeRegenerated, null);
            return t.Tags.AddTagsTo(i, e.tags), n.pushGeometry(i, !0), i
        }, w = function(e, n, i) {
            if (d(e, n))
                return null;
            var o = new t.Geometry(e.id, n);
            return t.Tags.AddTagsTo(o, e.tags), e.delayLoadingFile ? (o.delayLoadState = t.Engine.DELAYLOADSTATE_NOTLOADED, o.delayLoadingFile = i + e.delayLoadingFile, o._boundingInfo = new t.BoundingInfo(t.Vector3.FromArray(e.boundingBoxMinimum), t.Vector3.FromArray(e.boundingBoxMaximum)), o._delayInfo = [], e.hasUVs && o._delayInfo.push(t.VertexBuffer.UVKind), e.hasUVs2 && o._delayInfo.push(t.VertexBuffer.UV2Kind), e.hasColors && o._delayInfo.push(t.VertexBuffer.ColorKind), e.hasMatricesIndices && o._delayInfo.push(t.VertexBuffer.MatricesIndicesKind), e.hasMatricesWeights && o._delayInfo.push(t.VertexBuffer.MatricesWeightsKind), o._delayLoadingFunction = M) : M(e, o), n.pushGeometry(o, !0), o
        }, x = function(e, n, i) {
            var o = new t.Mesh(e.name, n);
            if (o.id = e.id, t.Tags.AddTagsTo(o, e.tags), o.position = t.Vector3.FromArray(e.position), e.rotationQuaternion ? o.rotationQuaternion = t.Quaternion.FromArray(e.rotationQuaternion) : e.rotation && (o.rotation = t.Vector3.FromArray(e.rotation)), o.scaling = t.Vector3.FromArray(e.scaling), e.localMatrix ? o.setPivotMatrix(t.Matrix.FromArray(e.localMatrix)) : e.pivotMatrix && o.setPivotMatrix(t.Matrix.FromArray(e.pivotMatrix)), o.setEnabled(e.isEnabled), o.isVisible = e.isVisible, o.infiniteDistance = e.infiniteDistance, o.showBoundingBox = e.showBoundingBox, o.showSubMeshesBoundingBox = e.showSubMeshesBoundingBox, void 0 !== e.pickable && (o.isPickable = e.pickable), o.receiveShadows = e.receiveShadows, o.billboardMode = e.billboardMode, void 0 !== e.visibility && (o.visibility = e.visibility), o.checkCollisions = e.checkCollisions, o._shouldGenerateFlatShading = e.useFlatShading, e.parentId && (o.parent = n.getLastEntryByID(e.parentId)), e.delayLoadingFile ? (o.delayLoadState = t.Engine.DELAYLOADSTATE_NOTLOADED, o.delayLoadingFile = i + e.delayLoadingFile, o._boundingInfo = new t.BoundingInfo(t.Vector3.FromArray(e.boundingBoxMinimum), t.Vector3.FromArray(e.boundingBoxMaximum)), o._delayInfo = [], e.hasUVs && o._delayInfo.push(t.VertexBuffer.UVKind), e.hasUVs2 && o._delayInfo.push(t.VertexBuffer.UV2Kind), e.hasColors && o._delayInfo.push(t.VertexBuffer.ColorKind), e.hasMatricesIndices && o._delayInfo.push(t.VertexBuffer.MatricesIndicesKind), e.hasMatricesWeights && o._delayInfo.push(t.VertexBuffer.MatricesWeightsKind), o._delayLoadingFunction = D, t.SceneLoader.ForceFullSceneLoadingForIncremental && o._checkDelayState()) : D(e, o), e.materialId ? o.setMaterialByID(e.materialId) : o.material = null, e.skeletonId > -1 && (o.skeleton = n.getLastSkeletonByID(e.skeletonId)), e.physicsImpostor && (n.isPhysicsEnabled() || n.enablePhysics(), o.setPhysicsState({impostor: e.physicsImpostor,mass: e.physicsMass,friction: e.physicsFriction,restitution: e.physicsRestitution})), e.animations)
                for (var r = 0; r < e.animations.length; r++) {
                    var s = e.animations[r];
                    o.animations.push(c(s))
                }
            if (e.autoAnimate && n.beginAnimation(o, e.autoAnimateFrom, e.autoAnimateTo, e.autoAnimateLoop, 1), o.layerMask = e.layerMask && !isNaN(e.layerMask) ? Math.abs(parseInt(e.layerMask)) : 4294967295, e.instances)
                for (var a = 0; a < e.instances.length; a++) {
                    var l = e.instances[a], h = o.createInstance(l.name);
                    if (t.Tags.AddTagsTo(h, l.tags), h.position = t.Vector3.FromArray(l.position), l.rotationQuaternion ? h.rotationQuaternion = t.Quaternion.FromArray(l.rotationQuaternion) : l.rotation && (h.rotation = t.Vector3.FromArray(l.rotation)), h.scaling = t.Vector3.FromArray(l.scaling), h.checkCollisions = o.checkCollisions, e.animations)
                        for (r = 0; r < e.animations.length; r++)
                            s = e.animations[r], h.animations.push(c(s))
                            }
            return o
        }, C = function(t, e, n) {
            e = e instanceof Array ? e : [e];
            for (var i in e)
                if (t.name === e[i])
                    return n.push(t.id), !0;
            return t.parentId && -1 !== n.indexOf(t.parentId) ? (n.push(t.id), !0) : !1
        }, M = function(e, n) {
            var i = new t.VertexData, o = e.positions;
            o && i.set(o, t.VertexBuffer.PositionKind);
            var r = e.normals;
            r && i.set(r, t.VertexBuffer.NormalKind);
            var s = e.uvs;
            s && i.set(s, t.VertexBuffer.UVKind);
            var a = e.uv2s;
            a && i.set(a, t.VertexBuffer.UV2Kind);
            var l = e.colors;
            l && i.set(l, t.VertexBuffer.ColorKind);
            var h = e.matricesIndices;
            h && i.set(h, t.VertexBuffer.MatricesIndicesKind);
            var c = e.matricesWeights;
            c && i.set(c, t.VertexBuffer.MatricesWeightsKind);
            var u = e.indices;
            u && (i.indices = u), n.setAllVerticesData(i, e.updatable)
        }, D = function(e, n) {
            var i = n.getScene(), o = e.geometryId;
            if (o) {
                var r = i.getGeometryByID(o);
                r && r.applyToMesh(n)
            } else if (e.positions && e.normals && e.indices) {
                if (n.setVerticesData(t.VertexBuffer.PositionKind, e.positions, !1), n.setVerticesData(t.VertexBuffer.NormalKind, e.normals, !1), e.uvs && n.setVerticesData(t.VertexBuffer.UVKind, e.uvs, !1), e.uvs2 && n.setVerticesData(t.VertexBuffer.UV2Kind, e.uvs2, !1), e.colors && n.setVerticesData(t.VertexBuffer.ColorKind, e.colors, !1), e.matricesIndices)
                    if (e.matricesIndices._isExpanded)
                        delete e.matricesIndices._isExpanded, n.setVerticesData(t.VertexBuffer.MatricesIndicesKind, e.matricesIndices, !1);
                    else {
                        for (var s = [], a = 0; a < e.matricesIndices.length; a++) {
                            var l = e.matricesIndices[a];
                            s.push(255 & l), s.push((65280 & l) >> 8), s.push((16711680 & l) >> 16), s.push(l >> 24)
                        }
                        n.setVerticesData(t.VertexBuffer.MatricesIndicesKind, s, !1)
                    }
                e.matricesWeights && n.setVerticesData(t.VertexBuffer.MatricesWeightsKind, e.matricesWeights, !1), n.setIndices(e.indices)
            }
            if (e.subMeshes) {
                n.subMeshes = [];
                for (var h = 0; h < e.subMeshes.length; h++) {
                    var c = e.subMeshes[h];
                    new t.SubMesh(c.materialIndex, c.verticesStart, c.verticesCount, c.indexStart, c.indexCount, n)
                }
            }
            n._shouldGenerateFlatShading && (n.convertToFlatShadedMesh(), delete n._shouldGenerateFlatShading), n.computeWorldMatrix(!0), i._selectionOctree && i._selectionOctree.addMesh(n)
        };
        t.SceneLoader.RegisterPlugin({extensions: ".babylon",importMesh: function(t, e, n, o, a, h, c) {
                                     for (var u = JSON.parse(n), p = [], d = [], m = [], g = 0; g < u.meshes.length; g++) {
                                     var f = u.meshes[g];
                                     if (!t || C(f, t, m)) {
                                     if (t instanceof Array && delete t[t.indexOf(f.name)], f.materialId) {
                                     var y = -1 !== d.indexOf(f.materialId);
                                     if (!y)
                                     for (var _ = 0; _ < u.multiMaterials.length; _++) {
                                     var v = u.multiMaterials[_];
                                     if (v.id == f.materialId) {
                                     for (var b = 0; b < v.materials.length; b++) {
                                     var w = v.materials[b];
                                     d.push(w), r(w, u, e, o)
                                     }
                                     d.push(v.id), s(v, e), y = !0;
                                     break
                                     }
                                     }
                                     y || (d.push(f.materialId), r(f.materialId, u, e, o))
                                     }
                                     if (f.skeletonId > -1 && e.skeletons) {
                                     var M = p.indexOf(f.skeletonId) > -1;
                                     if (!M)
                                     for (var D = 0; D < u.skeletons.length; D++) {
                                     var B = u.skeletons[D];
                                     B.id === f.skeletonId && (c.push(i(B, e)), p.push(B.id))
                                     }
                                     }
                                     var A = x(f, e, o);
                                     a.push(A)
                                     }
                                     }
                                     if (u.particleSystems)
                                     for (g = 0; g < u.particleSystems.length; g++) {
                                     var E = u.particleSystems[g];
                                     -1 !== m.indexOf(E.emitterId) && h.push(l(E, e, o))
                                     }
                                     return !0
                                     },load: function(e, n, r) {
                                     var c = JSON.parse(n);
                                     e.useDelayedTextureLoading = c.useDelayedTextureLoading && !t.SceneLoader.ForceFullSceneLoadingForIncremental, e.autoClear = c.autoClear, e.clearColor = t.Color3.FromArray(c.clearColor), e.ambientColor = t.Color3.FromArray(c.ambientColor), e.gravity = t.Vector3.FromArray(c.gravity), c.fogMode && 0 !== c.fogMode && (e.fogMode = c.fogMode, e.fogColor = t.Color3.FromArray(c.fogColor), e.fogStart = c.fogStart, e.fogEnd = c.fogEnd, e.fogDensity = c.fogDensity);
                                     for (var d = 0; d < c.lights.length; d++) {
                                     var C = c.lights[d];
                                     u(C, e)
                                     }
                                     for (d = 0; d < c.cameras.length; d++) {
                                     var M = c.cameras[d];
                                     p(M, e)
                                     }
                                     if (c.activeCameraID && e.setActiveCameraByID(c.activeCameraID), c.materials)
                                     for (d = 0; d < c.materials.length; d++) {
                                     var D = c.materials[d];
                                     o(D, e, r)
                                     }
                                     if (c.multiMaterials)
                                     for (d = 0; d < c.multiMaterials.length; d++) {
                                     var B = c.multiMaterials[d];
                                     s(B, e)
                                     }
                                     if (c.skeletons)
                                     for (d = 0; d < c.skeletons.length; d++) {
                                     var A = c.skeletons[d];
                                     i(A, e)
                                     }
                                     var E = c.geometries;
                                     if (E) {
                                     var T = E.boxes;
                                     if (T)
                                     for (d = 0; d < T.length; d++) {
                                     var S = T[d];
                                     m(S, e)
                                     }
                                     var L = E.spheres;
                                     if (L)
                                     for (d = 0; d < L.length; d++) {
                                     var O = L[d];
                                     g(O, e)
                                     }
                                     var P = E.cylinders;
                                     if (P)
                                     for (d = 0; d < P.length; d++) {
                                     var I = P[d];
                                     f(I, e)
                                     }
                                     var N = E.toruses;
                                     if (N)
                                     for (d = 0; d < N.length; d++) {
                                     var R = N[d];
                                     y(R, e)
                                     }
                                     var k = E.grounds;
                                     if (k)
                                     for (d = 0; d < k.length; d++) {
                                     var V = k[d];
                                     _(V, e)
                                     }
                                     var F = E.planes;
                                     if (F)
                                     for (d = 0; d < F.length; d++) {
                                     var Y = F[d];
                                     v(Y, e)
                                     }
                                     var z = E.torusKnots;
                                     if (z)
                                     for (d = 0; d < z.length; d++) {
                                     var j = z[d];
                                     b(j, e)
                                     }
                                     var W = E.vertexData;
                                     if (W)
                                     for (d = 0; d < W.length; d++) {
                                     var G = W[d];
                                     w(G, e, r)
                                     }
                                     }
                                     for (d = 0; d < c.meshes.length; d++) {
                                     var U = c.meshes[d];
                                     x(U, e, r)
                                     }
                                     for (d = 0; d < e.cameras.length; d++) {
                                     var H = e.cameras[d];
                                     if (H._waitingParentId && (H.parent = e.getLastEntryByID(H._waitingParentId), delete H._waitingParentId), H instanceof t.FreeCamera) {
                                     var q = H;
                                     q._waitingLockedTargetId && (q.lockedTarget = e.getLastEntryByID(q._waitingLockedTargetId), delete q._waitingLockedTargetId)
                                     }
                                     }
                                     if (c.particleSystems)
                                     for (d = 0; d < c.particleSystems.length; d++) {
                                     var X = c.particleSystems[d];
                                     l(X, e, r)
                                     }
                                     if (c.lensFlareSystems)
                                     for (d = 0; d < c.lensFlareSystems.length; d++) {
                                     var K = c.lensFlareSystems[d];
                                     a(K, e, r)
                                     }
                                     if (c.shadowGenerators)
                                     for (d = 0; d < c.shadowGenerators.length; d++) {
                                     var Z = c.shadowGenerators[d];
                                     h(Z, e)
                                     }
                                     return !0
                                     }})
    }(t.Internals || (t.Internals = {}));
    t.Internals
}(BABYLON || (BABYLON = {}));
var BABYLON;
!function(t) {
    var e = function() {
        function e(e, n, i, o, r, s) {
            this.name = e, this.cellSize = o, this.sprites = new Array, this.renderingGroupId = 0, this._vertexDeclaration = [3, 4, 4, 4], this._vertexStrideSize = 60, this._capacity = i, this._spriteTexture = new t.Texture(n, r, !0, !1), this._spriteTexture.wrapU = t.Texture.CLAMP_ADDRESSMODE, this._spriteTexture.wrapV = t.Texture.CLAMP_ADDRESSMODE, this._epsilon = void 0 === s ? .01 : s, this._scene = r, this._scene.spriteManagers.push(this), this._vertexDeclaration = [3, 4, 4, 4], this._vertexStrideSize = 60, this._vertexBuffer = r.getEngine().createDynamicVertexBuffer(i * this._vertexStrideSize * 4);
            for (var a = [], l = 0, h = 0; i > h; h++)
                a.push(l), a.push(l + 1), a.push(l + 2), a.push(l), a.push(l + 2), a.push(l + 3), l += 4;
            this._indexBuffer = r.getEngine().createIndexBuffer(a), this._vertices = new Float32Array(i * this._vertexStrideSize), this._effectBase = this._scene.getEngine().createEffect("sprites", ["position", "options", "cellInfo", "color"], ["view", "projection", "textureInfos", "alphaTest"], ["diffuseSampler"], ""), this._effectFog = this._scene.getEngine().createEffect("sprites", ["position", "options", "cellInfo", "color"], ["view", "projection", "textureInfos", "alphaTest", "vFogInfos", "vFogColor"], ["diffuseSampler"], "#define FOG")
        }
        return e.prototype._appendSpriteVertex = function(t, e, n, i, o) {
            var r = 15 * t;
            0 == n ? n = this._epsilon : 1 == n && (n = 1 - this._epsilon), 0 == i ? i = this._epsilon : 1 == i && (i = 1 - this._epsilon), this._vertices[r] = e.position.x, this._vertices[r + 1] = e.position.y, this._vertices[r + 2] = e.position.z, this._vertices[r + 3] = e.angle, this._vertices[r + 4] = e.size, this._vertices[r + 5] = n, this._vertices[r + 6] = i, this._vertices[r + 7] = e.invertU ? 1 : 0, this._vertices[r + 8] = e.invertV ? 1 : 0;
            var s = e.cellIndex / o >> 0;
            this._vertices[r + 9] = e.cellIndex - s * o, this._vertices[r + 10] = s, this._vertices[r + 11] = e.color.r, this._vertices[r + 12] = e.color.g, this._vertices[r + 13] = e.color.b, this._vertices[r + 14] = e.color.a
        }, e.prototype.render = function() {
            if (this._effectBase.isReady() && this._effectFog.isReady() && this._spriteTexture && this._spriteTexture.isReady()) {
                for (var e = this._scene.getEngine(), n = this._spriteTexture.getBaseSize(), i = t.Tools.GetDeltaTime(), o = Math.min(this._capacity, this.sprites.length), r = n.width / this.cellSize, s = 0, a = 0; o > a; a++) {
                    var l = this.sprites[a];
                    l && (l._animate(i), this._appendSpriteVertex(s++, l, 0, 0, r), this._appendSpriteVertex(s++, l, 1, 0, r), this._appendSpriteVertex(s++, l, 1, 1, r), this._appendSpriteVertex(s++, l, 0, 1, r))
                }
                e.updateDynamicVertexBuffer(this._vertexBuffer, this._vertices, o * this._vertexStrideSize);
                var h = this._effectBase;
                this._scene.fogMode !== t.Scene.FOGMODE_NONE && (h = this._effectFog), e.enableEffect(h);
                var c = this._scene.getViewMatrix();
                h.setTexture("diffuseSampler", this._spriteTexture), h.setMatrix("view", c), h.setMatrix("projection", this._scene.getProjectionMatrix()), h.setFloat2("textureInfos", this.cellSize / n.width, this.cellSize / n.height), this._scene.fogMode !== t.Scene.FOGMODE_NONE && (h.setFloat4("vFogInfos", this._scene.fogMode, this._scene.fogStart, this._scene.fogEnd, this._scene.fogDensity), h.setColor3("vFogColor", this._scene.fogColor)), e.bindBuffers(this._vertexBuffer, this._indexBuffer, this._vertexDeclaration, this._vertexStrideSize, h), h.setBool("alphaTest", !0), e.setColorWrite(!1), e.draw(!0, 0, 6 * o), e.setColorWrite(!0), h.setBool("alphaTest", !1), e.setAlphaMode(t.Engine.ALPHA_COMBINE), e.draw(!0, 0, 6 * o), e.setAlphaMode(t.Engine.ALPHA_DISABLE)
            }
        }, e.prototype.dispose = function() {
            this._vertexBuffer && (this._scene.getEngine()._releaseBuffer(this._vertexBuffer), this._vertexBuffer = null), this._indexBuffer && (this._scene.getEngine()._releaseBuffer(this._indexBuffer), this._indexBuffer = null), this._spriteTexture && (this._spriteTexture.dispose(), this._spriteTexture = null);
            var t = this._scene.spriteManagers.indexOf(this);
            this._scene.spriteManagers.splice(t, 1), this.onDispose && this.onDispose()
        }, e
    }();
    t.SpriteManager = e
}(BABYLON || (BABYLON = {}));
var BABYLON;
!function(t) {
    var e = function() {
        function e(e, n) {
            this.name = e, this.color = new t.Color4(1, 1, 1, 1), this.size = 1, this.angle = 0, this.cellIndex = 0, this.invertU = 0, this.invertV = 0, this.animations = new Array, this._animationStarted = !1, this._loopAnimation = !1, this._fromIndex = 0, this._toIndex = 0, this._delay = 0, this._direction = 1, this._frameCount = 0, this._time = 0, this._manager = n, this._manager.sprites.push(this), this.position = t.Vector3.Zero(), this._colliderMesh = t.Mesh.CreatePlane("_sprite_" + e, n.cellSize / 4, n._scene), this._colliderMesh.material = new t.StandardMaterial("_", n._scene), this._colliderMesh.material.backFaceCulling = !1, this._colliderMesh.sprite = this, this._colliderMesh.isVisible = !1, this._colliderMesh.position = this.position, this._colliderMesh.rotation = t.Vector3.Zero()
        }
        return e.prototype.playAnimation = function(t, e, n, i) {
            this._fromIndex = t, this._toIndex = e, this._loopAnimation = n, this._delay = i, this._animationStarted = !0, this._direction = e > t ? 1 : -1, this.cellIndex = t, this._time = 0
        }, e.prototype.stopAnimation = function() {
            this._animationStarted = !1
        }, e.prototype.updateCollider = function() {
            var t = this._manager._scene.activeCamera.position, e = t.subtract(this.position).normalize();
            this._colliderMesh.position = this.position, this._colliderMesh.rotation.x = Math.acos(e.y) + Math.PI / 2, this._colliderMesh.rotation.y = Math.atan2(e.x, e.z), this._colliderMesh.rotation.z = 0
        }, e.prototype._animate = function(t) {
            this._animationStarted && (this._time += t, this._time > this._delay && (this._time = this._time % this._delay, this.cellIndex += this._direction, this.cellIndex == this._toIndex && (this._loopAnimation ? this.cellIndex = this._fromIndex : (this._animationStarted = !1, this.disposeWhenFinishedAnimating && this.dispose()))))
        }, e.prototype.dispose = function() {
            for (var t = 0; t < this._manager.sprites.length; t++)
                this._manager.sprites[t] == this && this._manager.sprites.splice(t, 1);
            this._colliderMesh.dispose()
        }, e
    }();
    t.Sprite = e
}(BABYLON || (BABYLON = {}));
var BABYLON;
!function(t) {
    var e = function() {
        function e(e, n, i, o, r) {
            this.name = e, this._vertexDeclaration = [2], this._vertexStrideSize = 8, this.texture = n ? new t.Texture(n, i, !0) : null, this.isBackground = void 0 === o ? !0 : o, this.color = void 0 === r ? new t.Color4(1, 1, 1, 1) : r, this._scene = i, this._scene.layers.push(this);
            var s = [];
            s.push(1, 1), s.push(-1, 1), s.push(-1, -1), s.push(1, -1), this._vertexBuffer = i.getEngine().createVertexBuffer(s);
            var a = [];
            a.push(0), a.push(1), a.push(2), a.push(0), a.push(2), a.push(3), this._indexBuffer = i.getEngine().createIndexBuffer(a), this._effect = this._scene.getEngine().createEffect("layer", ["position"], ["textureMatrix", "color"], ["textureSampler"], "")
        }
        return e.prototype.render = function() {
            if (this._effect.isReady() && this.texture && this.texture.isReady()) {
                var e = this._scene.getEngine();
                e.enableEffect(this._effect), e.setState(!1), this._effect.setTexture("textureSampler", this.texture), this._effect.setMatrix("textureMatrix", this.texture.getTextureMatrix()), this._effect.setFloat4("color", this.color.r, this.color.g, this.color.b, this.color.a), e.bindBuffers(this._vertexBuffer, this._indexBuffer, this._vertexDeclaration, this._vertexStrideSize, this._effect), e.setAlphaMode(t.Engine.ALPHA_COMBINE), e.draw(!0, 0, 6), e.setAlphaMode(t.Engine.ALPHA_DISABLE)
            }
        }, e.prototype.dispose = function() {
            this._vertexBuffer && (this._scene.getEngine()._releaseBuffer(this._vertexBuffer), this._vertexBuffer = null), this._indexBuffer && (this._scene.getEngine()._releaseBuffer(this._indexBuffer), this._indexBuffer = null), this.texture && (this.texture.dispose(), this.texture = null);
            var t = this._scene.layers.indexOf(this);
            this._scene.layers.splice(t, 1), this.onDispose && this.onDispose()
        }, e
    }();
    t.Layer = e
}(BABYLON || (BABYLON = {}));
var BABYLON;
!function(t) {
    var e = function() {
        function e() {
            this.position = t.Vector3.Zero(), this.direction = t.Vector3.Zero(), this.color = new t.Color4(0, 0, 0, 0), this.colorStep = new t.Color4(0, 0, 0, 0), this.lifeTime = 1, this.age = 0, this.size = 0, this.angle = 0, this.angularSpeed = 0
        }
        return e
    }();
    t.Particle = e
}(BABYLON || (BABYLON = {}));
var BABYLON;
!function(t) {
    var e = function(t, e) {
        if (t == e)
            return t;
        var n = Math.random();
        return n * (e - t) + t
    }, n = function() {
        function n(n, i, o) {
            var r = this;
            this.name = n, this.renderingGroupId = 0, this.emitter = null, this.emitRate = 10, this.manualEmitCount = -1, this.updateSpeed = .01, this.targetStopDuration = 0, this.disposeOnStop = !1, this.minEmitPower = 1, this.maxEmitPower = 1, this.minLifeTime = 1, this.maxLifeTime = 1, this.minSize = 1, this.maxSize = 1, this.minAngularSpeed = 0, this.maxAngularSpeed = 0, this.blendMode = t.ParticleSystem.BLENDMODE_ONEONE, this.forceDepthWrite = !1, this.gravity = t.Vector3.Zero(), this.direction1 = new t.Vector3(0, 1, 0), this.direction2 = new t.Vector3(0, 1, 0), this.minEmitBox = new t.Vector3(-.5, -.5, -.5), this.maxEmitBox = new t.Vector3(.5, .5, .5), this.color1 = new t.Color4(1, 1, 1, 1), this.color2 = new t.Color4(1, 1, 1, 1), this.colorDead = new t.Color4(0, 0, 0, 1), this.textureMask = new t.Color4(1, 1, 1, 1), this.particles = new Array, this._vertexDeclaration = [3, 4, 4], this._vertexStrideSize = 44, this._stockParticles = new Array, this._newPartsExcess = 0, this._scaledColorStep = new t.Color4(0, 0, 0, 0), this._colorDiff = new t.Color4(0, 0, 0, 0), this._scaledDirection = t.Vector3.Zero(), this._scaledGravity = t.Vector3.Zero(), this._currentRenderId = -1, this._started = !1, this._stopped = !1, this._actualFrame = 0, this.id = n, this._capacity = i, this._scene = o, o.particleSystems.push(this), this._vertexBuffer = o.getEngine().createDynamicVertexBuffer(i * this._vertexStrideSize * 4);
            for (var s = [], a = 0, l = 0; i > l; l++)
                s.push(a), s.push(a + 1), s.push(a + 2), s.push(a), s.push(a + 2), s.push(a + 3), a += 4;
            this._indexBuffer = o.getEngine().createIndexBuffer(s), this._vertices = new Float32Array(i * this._vertexStrideSize), this.startDirectionFunction = function(n, i, o) {
                var s = e(r.direction1.x, r.direction2.x), a = e(r.direction1.y, r.direction2.y), l = e(r.direction1.z, r.direction2.z);
                t.Vector3.TransformNormalFromFloatsToRef(s * n, a * n, l * n, i, o)
            }, this.startPositionFunction = function(n, i) {
                var o = e(r.minEmitBox.x, r.maxEmitBox.x), s = e(r.minEmitBox.y, r.maxEmitBox.y), a = e(r.minEmitBox.z, r.maxEmitBox.z);
                t.Vector3.TransformCoordinatesFromFloatsToRef(o, s, a, n, i)
            }
        }
        return n.prototype.getCapacity = function() {
            return this._capacity
        }, n.prototype.isAlive = function() {
            return this._alive
        }, n.prototype.isStarted = function() {
            return this._started
        }, n.prototype.start = function() {
            this._started = !0, this._stopped = !1, this._actualFrame = 0
        }, n.prototype.stop = function() {
            this._stopped = !0
        }, n.prototype._appendParticleVertex = function(t, e, n, i) {
            var o = 11 * t;
            this._vertices[o] = e.position.x, this._vertices[o + 1] = e.position.y, this._vertices[o + 2] = e.position.z, this._vertices[o + 3] = e.color.r, this._vertices[o + 4] = e.color.g, this._vertices[o + 5] = e.color.b, this._vertices[o + 6] = e.color.a, this._vertices[o + 7] = e.angle, this._vertices[o + 8] = e.size, this._vertices[o + 9] = n, this._vertices[o + 10] = i
        }, n.prototype._update = function(n) {
            this._alive = this.particles.length > 0;
            for (var i = 0; i < this.particles.length; i++) {
                var o = this.particles[i];
                o.age += this._scaledUpdateSpeed, o.age >= o.lifeTime ? (this._stockParticles.push(this.particles.splice(i, 1)[0]), i--) : (o.colorStep.scaleToRef(this._scaledUpdateSpeed, this._scaledColorStep), o.color.addInPlace(this._scaledColorStep), o.color.a < 0 && (o.color.a = 0), o.angle += o.angularSpeed * this._scaledUpdateSpeed, o.direction.scaleToRef(this._scaledUpdateSpeed, this._scaledDirection), o.position.addInPlace(this._scaledDirection), this.gravity.scaleToRef(this._scaledUpdateSpeed, this._scaledGravity), o.direction.addInPlace(this._scaledGravity))
            }
            var r;
            for (r = this.emitter.position ? this.emitter.getWorldMatrix() : t.Matrix.Translation(this.emitter.x, this.emitter.y, this.emitter.z), i = 0; n > i && this.particles.length != this._capacity; i++) {
                0 !== this._stockParticles.length ? (o = this._stockParticles.pop(), o.age = 0) : o = new t.Particle, this.particles.push(o);
                var s = e(this.minEmitPower, this.maxEmitPower);
                this.startDirectionFunction(s, r, o.direction), o.lifeTime = e(this.minLifeTime, this.maxLifeTime), o.size = e(this.minSize, this.maxSize), o.angularSpeed = e(this.minAngularSpeed, this.maxAngularSpeed), this.startPositionFunction(r, o.position);
                var a = e(0, 1);
                t.Color4.LerpToRef(this.color1, this.color2, a, o.color), this.colorDead.subtractToRef(o.color, this._colorDiff), this._colorDiff.scaleToRef(1 / o.lifeTime, o.colorStep)
            }
        }, n.prototype._getEffect = function() {
            var t = [];
            this._scene.clipPlane && t.push("#define CLIPPLANE");
            var e = t.join("\n");
            return this._cachedDefines != e && (this._cachedDefines = e, this._effect = this._scene.getEngine().createEffect("particles", ["position", "color", "options"], ["invView", "view", "projection", "vClipPlane", "textureMask"], ["diffuseSampler"], e)), this._effect
        }, n.prototype.animate = function() {
            if (this._started) {
                var t = this._getEffect();
                if (this.emitter && t.isReady() && this.particleTexture && this.particleTexture.isReady() && this._currentRenderId !== this._scene.getRenderId()) {
                    this._currentRenderId = this._scene.getRenderId(), this._scaledUpdateSpeed = this.updateSpeed * this._scene.getAnimationRatio();
                    var e;
                    this.manualEmitCount > -1 ? (e = this.manualEmitCount, this.manualEmitCount = 0) : e = this.emitRate;
                    var n = e * this._scaledUpdateSpeed >> 0;
                    this._newPartsExcess += e * this._scaledUpdateSpeed - n, this._newPartsExcess > 1 && (n += this._newPartsExcess >> 0, this._newPartsExcess -= this._newPartsExcess >> 0), this._alive = !1, this._stopped ? n = 0 : (this._actualFrame += this._scaledUpdateSpeed, this.targetStopDuration && this._actualFrame >= this.targetStopDuration && this.stop()), this._update(n), this._stopped && (this._alive || (this._started = !1, this.disposeOnStop && this._scene._toBeDisposed.push(this)));
                    for (var i = 0, o = 0; o < this.particles.length; o++) {
                        var r = this.particles[o];
                        this._appendParticleVertex(i++, r, 0, 0), this._appendParticleVertex(i++, r, 1, 0), this._appendParticleVertex(i++, r, 1, 1), this._appendParticleVertex(i++, r, 0, 1)
                    }
                    var s = this._scene.getEngine();
                    s.updateDynamicVertexBuffer(this._vertexBuffer, this._vertices, this.particles.length * this._vertexStrideSize)
                }
            }
        }, n.prototype.render = function() {
            var e = this._getEffect();
            if (!(this.emitter && e.isReady() && this.particleTexture && this.particleTexture.isReady() && this.particles.length))
                return 0;
            var n = this._scene.getEngine();
            n.enableEffect(e);
            var i = this._scene.getViewMatrix();
            if (e.setTexture("diffuseSampler", this.particleTexture), e.setMatrix("view", i), e.setMatrix("projection", this._scene.getProjectionMatrix()), e.setFloat4("textureMask", this.textureMask.r, this.textureMask.g, this.textureMask.b, this.textureMask.a), this._scene.clipPlane) {
                var o = this._scene.clipPlane, r = i.clone();
                r.invert(), e.setMatrix("invView", r), e.setFloat4("vClipPlane", o.normal.x, o.normal.y, o.normal.z, o.d)
            }
            return n.bindBuffers(this._vertexBuffer, this._indexBuffer, this._vertexDeclaration, this._vertexStrideSize, e), n.setAlphaMode(this.blendMode === t.ParticleSystem.BLENDMODE_ONEONE ? t.Engine.ALPHA_ADD : t.Engine.ALPHA_COMBINE), this.forceDepthWrite && n.setDepthWrite(!0), n.draw(!0, 0, 6 * this.particles.length), n.setAlphaMode(t.Engine.ALPHA_DISABLE), this.particles.length
        }, n.prototype.dispose = function() {
            this._vertexBuffer && (this._scene.getEngine()._releaseBuffer(this._vertexBuffer), this._vertexBuffer = null), this._indexBuffer && (this._scene.getEngine()._releaseBuffer(this._indexBuffer), this._indexBuffer = null), this.particleTexture && (this.particleTexture.dispose(), this.particleTexture = null);
            var t = this._scene.particleSystems.indexOf(this);
            this._scene.particleSystems.splice(t, 1), this.onDispose && this.onDispose()
        }, n.prototype.clone = function(e, n) {
            var i = new t.ParticleSystem(e, this._capacity, this._scene);
            return t.Tools.DeepCopy(this, i, ["particles"], ["_vertexDeclaration", "_vertexStrideSize"]), void 0 === n && (n = this.emitter), i.emitter = n, this.particleTexture && (i.particleTexture = new t.Texture(this.particleTexture.url, this._scene)), i.start(), i
        }, n.BLENDMODE_ONEONE = 0, n.BLENDMODE_STANDARD = 1, n
    }();
    t.ParticleSystem = n
}(BABYLON || (BABYLON = {}));

var BABYLON;
!function(t) {
    var e = function() {
        function e(t, n, i, o, r) {
            this.name = t, this.targetProperty = n, this.framePerSecond = i, this.dataType = o, this.loopMode = r, this._offsetsCache = {}, this._highLimitsCache = {}, this._stopped = !1, this.targetPropertyPath = n.split("."), this.dataType = o, this.loopMode = void 0 === r ? e.ANIMATIONLOOPMODE_CYCLE : r
        }
        return e.prototype.isStopped = function() {
            return this._stopped
        }, e.prototype.getKeys = function() {
            return this._keys
        }, e.prototype.floatInterpolateFunction = function(t, e, n) {
            return t + (e - t) * n
        }, e.prototype.quaternionInterpolateFunction = function(e, n, i) {
            return t.Quaternion.Slerp(e, n, i)
        }, e.prototype.vector3InterpolateFunction = function(e, n, i) {
            return t.Vector3.Lerp(e, n, i)
        }, e.prototype.color3InterpolateFunction = function(e, n, i) {
            return t.Color3.Lerp(e, n, i)
        }, e.prototype.clone = function() {
            var t = new e(this.name, this.targetPropertyPath.join("."), this.framePerSecond, this.dataType, this.loopMode);
            return t.setKeys(this._keys), t
        }, e.prototype.setKeys = function(t) {
            this._keys = t.slice(0), this._offsetsCache = {}, this._highLimitsCache = {}
        }, e.prototype._interpolate = function(t, n, i, o, r) {
            if (i === e.ANIMATIONLOOPMODE_CONSTANT && n > 0)
                return r.clone ? r.clone() : r;
            this.currentFrame = t;
            for (var s = 0; s < this._keys.length; s++)
                if (this._keys[s + 1].frame >= t) {
                    var a = this._keys[s].value, l = this._keys[s + 1].value, h = (t - this._keys[s].frame) / (this._keys[s + 1].frame - this._keys[s].frame);
                    switch (this.dataType) {
                        case e.ANIMATIONTYPE_FLOAT:
                            switch (i) {
                                case e.ANIMATIONLOOPMODE_CYCLE:
                                case e.ANIMATIONLOOPMODE_CONSTANT:
                                    return this.floatInterpolateFunction(a, l, h);
                                case e.ANIMATIONLOOPMODE_RELATIVE:
                                    return o * n + this.floatInterpolateFunction(a, l, h)
                            }
                            break;
                        case e.ANIMATIONTYPE_QUATERNION:
                            var c = null;
                            switch (i) {
                                case e.ANIMATIONLOOPMODE_CYCLE:
                                case e.ANIMATIONLOOPMODE_CONSTANT:
                                    c = this.quaternionInterpolateFunction(a, l, h);
                                    break;
                                case e.ANIMATIONLOOPMODE_RELATIVE:
                                    c = this.quaternionInterpolateFunction(a, l, h).add(o.scale(n))
                            }
                            return c;
                        case e.ANIMATIONTYPE_VECTOR3:
                            switch (i) {
                                case e.ANIMATIONLOOPMODE_CYCLE:
                                case e.ANIMATIONLOOPMODE_CONSTANT:
                                    return this.vector3InterpolateFunction(a, l, h);
                                case e.ANIMATIONLOOPMODE_RELATIVE:
                                    return this.vector3InterpolateFunction(a, l, h).add(o.scale(n))
                            }
                        case e.ANIMATIONTYPE_COLOR3:
                            switch (i) {
                                case e.ANIMATIONLOOPMODE_CYCLE:
                                case e.ANIMATIONLOOPMODE_CONSTANT:
                                    return this.color3InterpolateFunction(a, l, h);
                                case e.ANIMATIONLOOPMODE_RELATIVE:
                                    return this.color3InterpolateFunction(a, l, h).add(o.scale(n))
                            }
                        case e.ANIMATIONTYPE_MATRIX:
                            switch (i) {
                                case e.ANIMATIONLOOPMODE_CYCLE:
                                case e.ANIMATIONLOOPMODE_CONSTANT:
                                case e.ANIMATIONLOOPMODE_RELATIVE:
                                    return a
                            }
                    }
                    break
                }
            return this._keys[this._keys.length - 1].value
        }, e.prototype.animate = function(t, n, i, o, r) {
            if (!this.targetPropertyPath || this.targetPropertyPath.length < 1)
                return this._stopped = !0, !1;
            var s = !0;
            if (0 != this._keys[0].frame) {
                var a = {frame: 0,value: this._keys[0].value};
                this._keys.splice(0, 0, a)
            }
            (n < this._keys[0].frame || n > this._keys[this._keys.length - 1].frame) && (n = this._keys[0].frame), (i < this._keys[0].frame || i > this._keys[this._keys.length - 1].frame) && (i = this._keys[this._keys.length - 1].frame);
            var l = i - n, h = t * this.framePerSecond * r / 1e3;
            if (h > l && !o)
                c = 0, s = !1, u = this._keys[this._keys.length - 1].value;
            else {
                var c = 0, u = 0;
                if (this.loopMode != e.ANIMATIONLOOPMODE_CYCLE) {
                    var p = i.toString() + n.toString();
                    if (!this._offsetsCache[p]) {
                        var d = this._interpolate(n, 0, e.ANIMATIONLOOPMODE_CYCLE), m = this._interpolate(i, 0, e.ANIMATIONLOOPMODE_CYCLE);
                        switch (this.dataType) {
                            case e.ANIMATIONTYPE_FLOAT:
                                this._offsetsCache[p] = m - d;
                                break;
                            case e.ANIMATIONTYPE_QUATERNION:
                                this._offsetsCache[p] = m.subtract(d);
                                break;
                            case e.ANIMATIONTYPE_VECTOR3:
                                this._offsetsCache[p] = m.subtract(d);
                            case e.ANIMATIONTYPE_COLOR3:
                                this._offsetsCache[p] = m.subtract(d)
                        }
                        this._highLimitsCache[p] = m
                    }
                    u = this._highLimitsCache[p], c = this._offsetsCache[p]
                }
            }
            var g = h / l >> 0, f = s ? n + h % l : i, y = this._interpolate(f, g, this.loopMode, c, u);
            if (this.targetPropertyPath.length > 1) {
                for (var _ = this._target[this.targetPropertyPath[0]], v = 1; v < this.targetPropertyPath.length - 1; v++)
                    _ = _[this.targetPropertyPath[v]];
                _[this.targetPropertyPath[this.targetPropertyPath.length - 1]] = y
            } else
                this._target[this.targetPropertyPath[0]] = y;
            return this._target.markAsDirty && this._target.markAsDirty(this.targetProperty), s || (this._stopped = !0), s
        }, Object.defineProperty(e, "ANIMATIONTYPE_FLOAT", {get: function() {
                                 return e._ANIMATIONTYPE_FLOAT
                                 },enumerable: !0,configurable: !0}), Object.defineProperty(e, "ANIMATIONTYPE_VECTOR3", {get: function() {
                                                                                            return e._ANIMATIONTYPE_VECTOR3
                                                                                            },enumerable: !0,configurable: !0}), Object.defineProperty(e, "ANIMATIONTYPE_QUATERNION", {get: function() {
                                                                                                                                                       return e._ANIMATIONTYPE_QUATERNION
                                                                                                                                                       },enumerable: !0,configurable: !0}), Object.defineProperty(e, "ANIMATIONTYPE_MATRIX", {get: function() {
                                                                                                                                                                                                                  return e._ANIMATIONTYPE_MATRIX
                                                                                                                                                                                                                  },enumerable: !0,configurable: !0}), Object.defineProperty(e, "ANIMATIONTYPE_COLOR3", {get: function() {
                                                                                                                                                                                                                                                                             return e._ANIMATIONTYPE_COLOR3
                                                                                                                                                                                                                                                                             },enumerable: !0,configurable: !0}), Object.defineProperty(e, "ANIMATIONLOOPMODE_RELATIVE", {get: function() {
                                                                                                                                                                                                                                                                                                                                        return e._ANIMATIONLOOPMODE_RELATIVE
                                                                                                                                                                                                                                                                                                                                        },enumerable: !0,configurable: !0}), Object.defineProperty(e, "ANIMATIONLOOPMODE_CYCLE", {get: function() {
                                                                                                                                                                                                                                                                                                                                                                                                   return e._ANIMATIONLOOPMODE_CYCLE
                                                                                                                                                                                                                                                                                                                                                                                                   },enumerable: !0,configurable: !0}), Object.defineProperty(e, "ANIMATIONLOOPMODE_CONSTANT", {get: function() {
                                                                                                                                                                                                                                                                                                                                                                                                                                                              return e._ANIMATIONLOOPMODE_CONSTANT
                                                                                                                                                                                                                                                                                                                                                                                                                                                              },enumerable: !0,configurable: !0}), e._ANIMATIONTYPE_FLOAT = 0, e._ANIMATIONTYPE_VECTOR3 = 1, e._ANIMATIONTYPE_QUATERNION = 2, e._ANIMATIONTYPE_MATRIX = 3, e._ANIMATIONTYPE_COLOR3 = 4, e._ANIMATIONLOOPMODE_RELATIVE = 0, e._ANIMATIONLOOPMODE_CYCLE = 1, e._ANIMATIONLOOPMODE_CONSTANT = 2, e
    }();
    t.Animation = e
}(BABYLON || (BABYLON = {}));
var BABYLON;
!function(t) {
    var e = function() {
        function t(t, e, n, i, o, r, s, a) {
            "undefined" == typeof n && (n = 0), "undefined" == typeof i && (i = 100), "undefined" == typeof o && (o = !1), "undefined" == typeof r && (r = 1), this.target = e, this.fromFrame = n, this.toFrame = i, this.loopAnimation = o, this.speedRatio = r, this.onAnimationEnd = s, this._animations = new Array, this._paused = !1, this.animationStarted = !1, a && this.appendAnimations(e, a), this._scene = t, t._activeAnimatables.push(this)
        }
        return t.prototype.appendAnimations = function(t, e) {
            for (var n = 0; n < e.length; n++) {
                var i = e[n];
                i._target = t, this._animations.push(i)
            }
        }, t.prototype.getAnimationByTargetProperty = function(t) {
            for (var e = this._animations, n = 0; n < e.length; n++)
                if (e[n].targetProperty === t)
                    return e[n];
            return null
        }, t.prototype.pause = function() {
            this._paused = !0
        }, t.prototype.restart = function() {
            this._paused = !1
        }, t.prototype.stop = function() {
            var t = this._scene._activeAnimatables.indexOf(this);
            t > -1 && this._scene._activeAnimatables.splice(t, 1), this.onAnimationEnd && this.onAnimationEnd()
        }, t.prototype._animate = function(t) {
            if (this._paused)
                return !0;
            this._localDelayOffset || (this._localDelayOffset = t);
            for (var e = !1, n = this._animations, i = 0; i < n.length; i++) {
                var o = n[i], r = o.animate(t - this._localDelayOffset, this.fromFrame, this.toFrame, this.loopAnimation, this.speedRatio);
                e = e || r
            }
            return !e && this.onAnimationEnd && this.onAnimationEnd(), e
        }, t
    }();
    t.Animatable = e
}(BABYLON || (BABYLON = {}));
var BABYLON;
!function(t) {
    var e = function() {
        function e(e, n, i) {
            "undefined" == typeof i && (i = 2), this.maxDepth = i, this.dynamicContent = new Array, this._maxBlockCapacity = n || 64, this._selectionContent = new t.SmartArray(1024), this._creationFunc = e
        }
        return e.prototype.update = function(t, n, i) {
            e._CreateBlocks(t, n, i, this._maxBlockCapacity, 0, this.maxDepth, this, this._creationFunc)
        }, e.prototype.addMesh = function(t) {
            for (var e = 0; e < this.blocks.length; e++) {
                var n = this.blocks[e];
                n.addEntry(t)
            }
        }, e.prototype.select = function(t, e) {
            this._selectionContent.reset();
            for (var n = 0; n < this.blocks.length; n++) {
                var i = this.blocks[n];
                i.select(t, this._selectionContent, e)
            }
            return e ? this._selectionContent.concat(this.dynamicContent) : this._selectionContent.concatWithNoDuplicate(this.dynamicContent), this._selectionContent
        }, e.prototype.intersects = function(t, e, n) {
            this._selectionContent.reset();
            for (var i = 0; i < this.blocks.length; i++) {
                var o = this.blocks[i];
                o.intersects(t, e, this._selectionContent, n)
            }
            return n ? this._selectionContent.concat(this.dynamicContent) : this._selectionContent.concatWithNoDuplicate(this.dynamicContent), this._selectionContent
        }, e.prototype.intersectsRay = function(t) {
            this._selectionContent.reset();
            for (var e = 0; e < this.blocks.length; e++) {
                var n = this.blocks[e];
                n.intersectsRay(t, this._selectionContent)
            }
            return this._selectionContent.concatWithNoDuplicate(this.dynamicContent), this._selectionContent
        }, e._CreateBlocks = function(e, n, i, o, r, s, a, l) {
            a.blocks = new Array;
            for (var h = new t.Vector3((n.x - e.x) / 2, (n.y - e.y) / 2, (n.z - e.z) / 2), c = 0; 2 > c; c++)
                for (var u = 0; 2 > u; u++)
                    for (var p = 0; 2 > p; p++) {
                        var d = e.add(h.multiplyByFloats(c, u, p)), m = e.add(h.multiplyByFloats(c + 1, u + 1, p + 1)), g = new t.OctreeBlock(d, m, o, r + 1, s, l);
                        g.addEntries(i), a.blocks.push(g)
                    }
        }, e.CreationFuncForMeshes = function(t, e) {
            t.getBoundingInfo().boundingBox.intersectsMinMax(e.minPoint, e.maxPoint) && e.entries.push(t)
        }, e.CreationFuncForSubMeshes = function(t, e) {
            t.getBoundingInfo().boundingBox.intersectsMinMax(e.minPoint, e.maxPoint) && e.entries.push(t)
        }, e
    }();
    t.Octree = e
}(BABYLON || (BABYLON = {}));
var BABYLON;
!function(t) {
    var e = function() {
        function e(t, e, n, i, o, r) {
            this.entries = new Array, this._boundingVectors = new Array, this._capacity = n, this._depth = i, this._maxDepth = o, this._creationFunc = r, this._minPoint = t, this._maxPoint = e, this._boundingVectors.push(t.clone()), this._boundingVectors.push(e.clone()), this._boundingVectors.push(t.clone()), this._boundingVectors[2].x = e.x, this._boundingVectors.push(t.clone()), this._boundingVectors[3].y = e.y, this._boundingVectors.push(t.clone()), this._boundingVectors[4].z = e.z, this._boundingVectors.push(e.clone()), this._boundingVectors[5].z = t.z, this._boundingVectors.push(e.clone()), this._boundingVectors[6].x = t.x, this._boundingVectors.push(e.clone()), this._boundingVectors[7].y = t.y
        }
        return Object.defineProperty(e.prototype, "capacity", {get: function() {
                                     return this._capacity
                                     },enumerable: !0,configurable: !0}), Object.defineProperty(e.prototype, "minPoint", {get: function() {
                                                                                                return this._minPoint
                                                                                                },enumerable: !0,configurable: !0}), Object.defineProperty(e.prototype, "maxPoint", {get: function() {
                                                                                                                                                           return this._maxPoint
                                                                                                                                                           },enumerable: !0,configurable: !0}), e.prototype.addEntry = function(t) {
            if (this.blocks)
                for (var e = 0; e < this.blocks.length; e++) {
                    var n = this.blocks[e];
                    n.addEntry(t)
                }
            else
                this._creationFunc(t, this), this.entries.length > this.capacity && this._depth < this._maxDepth && this.createInnerBlocks()
                }, e.prototype.addEntries = function(t) {
                    for (var e = 0; e < t.length; e++) {
                        var n = t[e];
                        this.addEntry(n)
                    }
                }, e.prototype.select = function(e, n, i) {
                    if (t.BoundingBox.IsInFrustum(this._boundingVectors, e)) {
                        if (this.blocks) {
                            for (var o = 0; o < this.blocks.length; o++) {
                                var r = this.blocks[o];
                                r.select(e, n, i)
                            }
                            return
                        }
                        i ? n.concat(this.entries) : n.concatWithNoDuplicate(this.entries)
                    }
                }, e.prototype.intersects = function(e, n, i, o) {
                    if (t.BoundingBox.IntersectsSphere(this._minPoint, this._maxPoint, e, n)) {
                        if (this.blocks) {
                            for (var r = 0; r < this.blocks.length; r++) {
                                var s = this.blocks[r];
                                s.intersects(e, n, i, o)
                            }
                            return
                        }
                        o ? i.concat(this.entries) : i.concatWithNoDuplicate(this.entries)
                    }
                }, e.prototype.intersectsRay = function(t, e) {
                    if (t.intersectsBoxMinMax(this._minPoint, this._maxPoint)) {
                        if (this.blocks) {
                            for (var n = 0; n < this.blocks.length; n++) {
                                var i = this.blocks[n];
                                i.intersectsRay(t, e)
                            }
                            return
                        }
                        e.concatWithNoDuplicate(this.entries)
                    }
                }, e.prototype.createInnerBlocks = function() {
                    t.Octree._CreateBlocks(this._minPoint, this._maxPoint, this.entries, this._capacity, this._depth, this._maxDepth, this, this._creationFunc)
                }, e
    }();
    t.OctreeBlock = e
}(BABYLON || (BABYLON = {}));
var BABYLON;
!function(t) {
    var e = function() {
        function e(e, n, i, o) {
            this.name = e, this.children = new Array, this.animations = new Array, this._worldTransform = new t.Matrix, this._absoluteTransform = new t.Matrix, this._invertedAbsoluteTransform = new t.Matrix, this._skeleton = n, this._matrix = o, this._baseMatrix = o, n.bones.push(this), i ? (this._parent = i, i.children.push(this)) : this._parent = null, this._updateDifferenceMatrix()
        }
        return e.prototype.getParent = function() {
            return this._parent
        }, e.prototype.getLocalMatrix = function() {
            return this._matrix
        }, e.prototype.getBaseMatrix = function() {
            return this._baseMatrix
        }, e.prototype.getWorldMatrix = function() {
            return this._worldTransform
        }, e.prototype.getInvertedAbsoluteTransform = function() {
            return this._invertedAbsoluteTransform
        }, e.prototype.getAbsoluteMatrix = function() {
            for (var t = this._matrix.clone(), e = this._parent; e; )
                t = t.multiply(e.getLocalMatrix()), e = e.getParent();
            return t
        }, e.prototype.updateMatrix = function(t) {
            this._matrix = t, this._skeleton._markAsDirty(), this._updateDifferenceMatrix()
        }, e.prototype._updateDifferenceMatrix = function() {
            this._parent ? this._matrix.multiplyToRef(this._parent._absoluteTransform, this._absoluteTransform) : this._absoluteTransform.copyFrom(this._matrix), this._absoluteTransform.invertToRef(this._invertedAbsoluteTransform);
            for (var t = 0; t < this.children.length; t++)
                this.children[t]._updateDifferenceMatrix()
                }, e.prototype.markAsDirty = function() {
                    this._skeleton._markAsDirty()
                }, e
    }();
    t.Bone = e
}(BABYLON || (BABYLON = {}));
var BABYLON;
!function(t) {
    var e = function() {
        function e(e, n, i) {
            this.name = e, this.id = n, this.bones = new Array, this._isDirty = !0, this._identity = t.Matrix.Identity(), this.bones = [], this._scene = i, i.skeletons.push(this)
        }
        return e.prototype.getTransformMatrices = function() {
            return this._transformMatrices
        }, e.prototype._markAsDirty = function() {
            this._isDirty = !0
        }, e.prototype.prepare = function() {
            if (this._isDirty) {
                this._transformMatrices && this._transformMatrices.length === 16 * (this.bones.length + 1) || (this._transformMatrices = new Float32Array(16 * (this.bones.length + 1)));
                for (var t = 0; t < this.bones.length; t++) {
                    var e = this.bones[t], n = e.getParent();
                    n ? e.getLocalMatrix().multiplyToRef(n.getWorldMatrix(), e.getWorldMatrix()) : e.getWorldMatrix().copyFrom(e.getLocalMatrix()), e.getInvertedAbsoluteTransform().multiplyToArray(e.getWorldMatrix(), this._transformMatrices, 16 * t)
                }
                this._identity.copyToArray(this._transformMatrices, 16 * this.bones.length), this._isDirty = !1
            }
        }, e.prototype.getAnimatables = function() {
            if (!this._animatables || this._animatables.length != this.bones.length) {
                this._animatables = [];
                for (var t = 0; t < this.bones.length; t++)
                    this._animatables.push(this.bones[t])
                    }
            return this._animatables
        }, e.prototype.clone = function(e, n) {
            for (var i = new t.Skeleton(e, n || e, this._scene), o = 0; o < this.bones.length; o++) {
                var r = this.bones[o], s = null;
                if (r.getParent()) {
                    var a = this.bones.indexOf(r.getParent());
                    s = i.bones[a]
                }
                var l = new t.Bone(r.name, i, s, r.getBaseMatrix());
                t.Tools.DeepCopy(r.animations, l.animations)
            }
            return i
        }, e
    }();
    t.Skeleton = e
}(BABYLON || (BABYLON = {}));
var BABYLON;
!function(t) {
    var e = function() {
        function e(e, n, i) {
            this.name = e, this.id = n, this.bones = new Array, this._isDirty = !0, this._identity = t.Matrix.Identity(), this.bones = [], this._scene = i, i.skeletons.push(this)
        }
        return e.prototype.getTransformMatrices = function() {
            return this._transformMatrices
        }, e.prototype._markAsDirty = function() {
            this._isDirty = !0
        }, e.prototype.prepare = function() {
            if (this._isDirty) {
                this._transformMatrices && this._transformMatrices.length === 16 * (this.bones.length + 1) || (this._transformMatrices = new Float32Array(16 * (this.bones.length + 1)));
                for (var t = 0; t < this.bones.length; t++) {
                    var e = this.bones[t], n = e.getParent();
                    n ? e.getLocalMatrix().multiplyToRef(n.getWorldMatrix(), e.getWorldMatrix()) : e.getWorldMatrix().copyFrom(e.getLocalMatrix()), e.getInvertedAbsoluteTransform().multiplyToArray(e.getWorldMatrix(), this._transformMatrices, 16 * t)
                }
                this._identity.copyToArray(this._transformMatrices, 16 * this.bones.length), this._isDirty = !1
            }
        }, e.prototype.getAnimatables = function() {
            if (!this._animatables || this._animatables.length != this.bones.length) {
                this._animatables = [];
                for (var t = 0; t < this.bones.length; t++)
                    this._animatables.push(this.bones[t])
                    }
            return this._animatables
        }, e.prototype.clone = function(e, n) {
            for (var i = new t.Skeleton(e, n || e, this._scene), o = 0; o < this.bones.length; o++) {
                var r = this.bones[o], s = null;
                if (r.getParent()) {
                    var a = this.bones.indexOf(r.getParent());
                    s = i.bones[a]
                }
                var l = new t.Bone(r.name, i, s, r.getBaseMatrix());
                t.Tools.DeepCopy(r.animations, l.animations)
            }
            return i
        }, e
    }();
    t.Skeleton = e
}(BABYLON || (BABYLON = {}));
var BABYLON;
!function(t) {
    var e = function() {
        function e(e, n, i, o, r, s, a, l, h) {
            this.name = e, this.width = -1, this.height = -1, this._reusable = !1, this._textures = new t.SmartArray(2), this._currentRenderTextureInd = 0, null != s ? (this._camera = s, this._scene = s.getScene(), s.attachPostProcess(this), this._engine = this._scene.getEngine()) : this._engine = l, this._renderRatio = r, this.renderTargetSamplingMode = a ? a : t.Texture.NEAREST_SAMPLINGMODE, this._reusable = h || !1, o = o || [], o.push("textureSampler"), this._effect = this._engine.createEffect({vertex: "postprocess",fragment: n}, ["position"], i || [], o, "")
        }
        return e.prototype.isReusable = function() {
            return this._reusable
        }, e.prototype.activate = function(t, e) {
            t = t || this._camera;
            var n = t.getScene(), i = (e ? e._width : this._engine.getRenderingCanvas().width) * this._renderRatio, o = (e ? e._height : this._engine.getRenderingCanvas().height) * this._renderRatio;
            if (this.width !== i || this.height !== o) {
                if (this._textures.length > 0) {
                    for (var r = 0; r < this._textures.length; r++)
                        this._engine._releaseTexture(this._textures.data[r]);
                    this._textures.reset()
                }
                this.width = i, this.height = o, this._textures.push(this._engine.createRenderTargetTexture({width: this.width,height: this.height}, {generateMipMaps: !1,generateDepthBuffer: t._postProcesses.indexOf(this) === t._postProcessesTakenIndices[0],samplingMode: this.renderTargetSamplingMode})), this._reusable && this._textures.push(this._engine.createRenderTargetTexture({width: this.width,height: this.height}, {generateMipMaps: !1,generateDepthBuffer: t._postProcesses.indexOf(this) === t._postProcessesTakenIndices[0],samplingMode: this.renderTargetSamplingMode})), this.onSizeChanged && this.onSizeChanged()
            }
            this._engine.bindFramebuffer(this._textures.data[this._currentRenderTextureInd]), this.onActivate && this.onActivate(t), this._engine.clear(n.clearColor, n.autoClear || n.forceWireframe, !0), this._reusable && (this._currentRenderTextureInd = (this._currentRenderTextureInd + 1) % 2)
        }, e.prototype.apply = function() {
            return this._effect.isReady() ? (this._engine.enableEffect(this._effect), this._engine.setState(!1), this._engine.setAlphaMode(t.Engine.ALPHA_DISABLE), this._engine.setDepthBuffer(!1), this._engine.setDepthWrite(!1), this._effect._bindTexture("textureSampler", this._textures.data[this._currentRenderTextureInd]), this.onApply && this.onApply(this._effect), this._effect) : null
        }, e.prototype.dispose = function(t) {
            if (t = t || this._camera, this._textures.length > 0) {
                for (var e = 0; e < this._textures.length; e++)
                    this._engine._releaseTexture(this._textures.data[e]);
                this._textures.reset()
            }
            t.detachPostProcess(this);
            var n = t._postProcesses.indexOf(this);
            n === t._postProcessesTakenIndices[0] && t._postProcessesTakenIndices.length > 0 && (this._camera._postProcesses[t._postProcessesTakenIndices[0]].width = -1)
        }, e
    }();
    t.PostProcess = e
}(BABYLON || (BABYLON = {}));
var BABYLON;
!function(t) {
    var e = function() {
        function t(t) {
            this._vertexDeclaration = [2], this._vertexStrideSize = 8, this._scene = t;
            var e = [];
            e.push(1, 1), e.push(-1, 1), e.push(-1, -1), e.push(1, -1), this._vertexBuffer = t.getEngine().createVertexBuffer(e);
            var n = [];
            n.push(0), n.push(1), n.push(2), n.push(0), n.push(2), n.push(3), this._indexBuffer = t.getEngine().createIndexBuffer(n)
        }
        return t.prototype._prepareFrame = function(t) {
            var e = this._scene.activeCamera._postProcesses, n = this._scene.activeCamera._postProcessesTakenIndices;
            return 0 !== n.length && this._scene.postProcessesEnabled ? (e[this._scene.activeCamera._postProcessesTakenIndices[0]].activate(this._scene.activeCamera, t), !0) : !1
        }, t.prototype._finalizeFrame = function(t, e) {
            var n = this._scene.activeCamera._postProcesses, i = this._scene.activeCamera._postProcessesTakenIndices;
            if (0 !== i.length && this._scene.postProcessesEnabled) {
                for (var o = this._scene.getEngine(), r = 0; r < i.length && (r < i.length - 1 ? n[i[r + 1]].activate(this._scene.activeCamera) : e ? o.bindFramebuffer(e) : o.restoreDefaultFramebuffer(), !t); r++) {
                    var s = n[i[r]].apply();
                    s && (o.bindBuffers(this._vertexBuffer, this._indexBuffer, this._vertexDeclaration, this._vertexStrideSize, s), o.draw(!0, 0, 6))
                }
                o.setDepthBuffer(!0), o.setDepthWrite(!0)
            }
        }, t.prototype.dispose = function() {
            this._vertexBuffer && (this._scene.getEngine()._releaseBuffer(this._vertexBuffer), this._vertexBuffer = null), this._indexBuffer && (this._scene.getEngine()._releaseBuffer(this._indexBuffer), this._indexBuffer = null)
        }, t
    }();
    t.PostProcessManager = e
}(BABYLON || (BABYLON = {}));
var __extends = this.__extends || function(t, e) {
    function n() {
        this.constructor = t
    }
    for (var i in e)
        e.hasOwnProperty(i) && (t[i] = e[i]);
    n.prototype = e.prototype, t.prototype = new n
}, BABYLON;
!function(t) {
    var e = function(t) {
        function e(e, n, i, o, r, s) {
            t.call(this, e, "pass", null, null, n, i, o, r, s)
        }
        return __extends(e, t), e
    }(t.PostProcess);
    t.PassPostProcess = e
}(BABYLON || (BABYLON = {}));
var __extends = this.__extends || function(t, e) {
    function n() {
        this.constructor = t
    }
    for (var i in e)
        e.hasOwnProperty(i) && (t[i] = e[i]);
    n.prototype = e.prototype, t.prototype = new n
}, BABYLON;
!function(t) {
    var e = function(e) {
        function n(n, i, o, r, s, a, l, h) {
            "undefined" == typeof a && (a = t.Texture.BILINEAR_SAMPLINGMODE);
            var c = this;
            e.call(this, n, "blur", ["screenSize", "direction", "blurWidth"], null, r, s, a, l, h), this.direction = i, this.blurWidth = o, this.onApply = function(t) {
                t.setFloat2("screenSize", c.width, c.height), t.setVector2("direction", c.direction), t.setFloat("blurWidth", c.blurWidth)
            }
        }
        return __extends(n, e), n
    }(t.PostProcess);
    t.BlurPostProcess = e
}(BABYLON || (BABYLON = {}));
var __extends = this.__extends || function(t, e) {
    function n() {
        this.constructor = t
    }
    for (var i in e)
        e.hasOwnProperty(i) && (t[i] = e[i]);
    n.prototype = e.prototype, t.prototype = new n
}, BABYLON;
!function(t) {
    var e = function(e) {
        function n(n, i, o, r, s, a, l, h, c, u) {
            var p = this;
            e.call(this, n, "refraction", ["baseColor", "depth", "colorLevel"], ["refractionSampler"], a, l, h, c, u), this.color = o, this.depth = r, this.colorLevel = s, this.onActivate = function(e) {
                p._refRexture = p._refRexture || new t.Texture(i, e.getScene())
            }, this.onApply = function(t) {
                t.setColor3("baseColor", p.color), t.setFloat("depth", p.depth), t.setFloat("colorLevel", p.colorLevel), t.setTexture("refractionSampler", p._refRexture)
            }
        }
        return __extends(n, e), n.prototype.dispose = function(t) {
            this._refRexture && this._refRexture.dispose(), e.prototype.dispose.call(this, t)
        }, n
    }(t.PostProcess);
    t.RefractionPostProcess = e
}(BABYLON || (BABYLON = {}));
var __extends = this.__extends || function(t, e) {
    function n() {
        this.constructor = t
    }
    for (var i in e)
        e.hasOwnProperty(i) && (t[i] = e[i]);
    n.prototype = e.prototype, t.prototype = new n
}, BABYLON;
!function(t) {
    var e = function(t) {
        function e(e, n, i, o, r, s) {
            t.call(this, e, "blackAndWhite", null, null, n, i, o, r, s)
        }
        return __extends(e, t), e
    }(t.PostProcess);
    t.BlackAndWhitePostProcess = e
}(BABYLON || (BABYLON = {}));
var __extends = this.__extends || function(t, e) {
    function n() {
        this.constructor = t
    }
    for (var i in e)
        e.hasOwnProperty(i) && (t[i] = e[i]);
    n.prototype = e.prototype, t.prototype = new n
}, BABYLON;
!function(t) {
    var e = function(t) {
        function e(e, n, i, o, r, s, a) {
            var l = this;
            t.call(this, e, "convolution", ["kernel", "screenSize"], null, i, o, r, s, a), this.kernel = n, this.onApply = function(t) {
                t.setFloat2("screenSize", l.width, l.height), t.setArray("kernel", l.kernel)
            }
        }
        return __extends(e, t), e.EdgeDetect0Kernel = [1, 0, -1, 0, 0, 0, -1, 0, 1], e.EdgeDetect1Kernel = [0, 1, 0, 1, -4, 1, 0, 1, 0], e.EdgeDetect2Kernel = [-1, -1, -1, -1, 8, -1, -1, -1, -1], e.SharpenKernel = [0, -1, 0, -1, 5, -1, 0, -1, 0], e.EmbossKernel = [-2, -1, 0, -1, 1, 1, 0, 1, 2], e.GaussianKernel = [0, 1, 0, 1, 1, 1, 0, 1, 0], e
    }(t.PostProcess);
    t.ConvolutionPostProcess = e
}(BABYLON || (BABYLON = {}));
var __extends = this.__extends || function(t, e) {
    function n() {
        this.constructor = t
    }
    for (var i in e)
        e.hasOwnProperty(i) && (t[i] = e[i]);
    n.prototype = e.prototype, t.prototype = new n
}, BABYLON;
!function(t) {
    var e = function(t) {
        function e(e, n, i, o, r, s, a) {
            var l = this;
            t.call(this, e, "filter", ["kernelMatrix"], null, i, o, r, s, a), this.kernelMatrix = n, this.onApply = function(t) {
                t.setMatrix("kernelMatrix", l.kernelMatrix)
            }
        }
        return __extends(e, t), e
    }(t.PostProcess);
    t.FilterPostProcess = e
}(BABYLON || (BABYLON = {}));
var __extends = this.__extends || function(t, e) {
    function n() {
        this.constructor = t
    }
    for (var i in e)
        e.hasOwnProperty(i) && (t[i] = e[i]);
    n.prototype = e.prototype, t.prototype = new n
}, BABYLON;
!function(t) {
    var e = function(t) {
        function e(e, n, i, o, r, s) {
            var a = this;
            t.call(this, e, "fxaa", ["texelSize"], null, n, i, o, r, s), this.onSizeChanged = function() {
                a.texelWidth = 1 / a.width, a.texelHeight = 1 / a.height
            }, this.onApply = function(t) {
                t.setFloat2("texelSize", a.texelWidth, a.texelHeight)
            }
        }
        return __extends(e, t), e
    }(t.PostProcess);
    t.FxaaPostProcess = e
}(BABYLON || (BABYLON = {}));
var BABYLON;
!function(t) {
    var e = function() {
        function e(e, n, i, o, r) {
            this.size = e, this.position = n, this.dispose = function() {
                this.texture && this.texture.dispose();
                var t = this._system.lensFlares.indexOf(this);
                this._system.lensFlares.splice(t, 1)
            }, this.color = i || new t.Color3(1, 1, 1), this.texture = o ? new t.Texture(o, r.getScene(), !0) : null, this._system = r, r.lensFlares.push(this)
        }
        return e
    }();
    t.LensFlare = e
}(BABYLON || (BABYLON = {}));
var BABYLON;
!function(t) {
    var e = function() {
        function e(t, e, n) {
            this.name = t, this.lensFlares = new Array, this.borderLimit = 300, this._vertexDeclaration = [2], this._vertexStrideSize = 8, this._isEnabled = !0, this._scene = n, this._emitter = e, n.lensFlareSystems.push(this), this.meshesSelectionPredicate = function(t) {
                return t.material && t.isVisible && t.isEnabled() && t.checkCollisions && 0 != (t.layerMask & n.activeCamera.layerMask)
            };
            var i = [];
            i.push(1, 1), i.push(-1, 1), i.push(-1, -1), i.push(1, -1), this._vertexBuffer = n.getEngine().createVertexBuffer(i);
            var o = [];
            o.push(0), o.push(1), o.push(2), o.push(0), o.push(2), o.push(3), this._indexBuffer = n.getEngine().createIndexBuffer(o), this._effect = this._scene.getEngine().createEffect("lensFlare", ["position"], ["color", "viewportMatrix"], ["textureSampler"], "")
        }
        return Object.defineProperty(e.prototype, "isEnabled", {get: function() {
                                     return this._isEnabled
                                     },set: function(t) {
                                     this._isEnabled = t
                                     },enumerable: !0,configurable: !0}), e.prototype.getScene = function() {
            return this._scene
        }, e.prototype.getEmitter = function() {
            return this._emitter
        }, e.prototype.getEmitterPosition = function() {
            return this._emitter.getAbsolutePosition ? this._emitter.getAbsolutePosition() : this._emitter.position
        }, e.prototype.computeEffectivePosition = function(e) {
            var n = this.getEmitterPosition();
            return n = t.Vector3.Project(n, t.Matrix.Identity(), this._scene.getTransformMatrix(), e), this._positionX = n.x, this._positionY = n.y, n = t.Vector3.TransformCoordinates(this.getEmitterPosition(), this._scene.getViewMatrix()), n.z > 0 && this._positionX > e.x && this._positionX < e.x + e.width && this._positionY > e.y && this._positionY < e.y + e.height ? !0 : !1
        }, e.prototype._isVisible = function() {
            if (!this._isEnabled)
                return !1;
            var e = this.getEmitterPosition(), n = e.subtract(this._scene.activeCamera.position), i = n.length();
            n.normalize();
            var o = new t.Ray(this._scene.activeCamera.position, n), r = this._scene.pickWithRay(o, this.meshesSelectionPredicate, !0);
            return !r.hit || r.distance > i
        }, e.prototype.render = function() {
            if (!this._effect.isReady())
                return !1;
            var e = this._scene.getEngine(), n = this._scene.activeCamera.viewport, i = n.toGlobal(e);
            if (!this.computeEffectivePosition(i))
                return !1;
            if (!this._isVisible())
                return !1;
            var o, r;
            o = this._positionX < this.borderLimit + i.x ? this.borderLimit + i.x - this._positionX : this._positionX > i.x + i.width - this.borderLimit ? this._positionX - i.x - i.width + this.borderLimit : 0, r = this._positionY < this.borderLimit + i.y ? this.borderLimit + i.y - this._positionY : this._positionY > i.y + i.height - this.borderLimit ? this._positionY - i.y - i.height + this.borderLimit : 0;
            var s = o > r ? o : r;
            s > this.borderLimit && (s = this.borderLimit);
            var a = 1 - s / this.borderLimit;
            if (0 > a)
                return !1;
            a > 1 && (a = 1);
            var l = i.x + i.width / 2, h = i.y + i.height / 2, c = l - this._positionX, u = h - this._positionY;
            e.enableEffect(this._effect), e.setState(!1), e.setDepthBuffer(!1), e.setAlphaMode(t.Engine.ALPHA_ADD), e.bindBuffers(this._vertexBuffer, this._indexBuffer, this._vertexDeclaration, this._vertexStrideSize, this._effect);
            for (var p = 0; p < this.lensFlares.length; p++) {
                var d = this.lensFlares[p], m = l - c * d.position, g = h - u * d.position, f = d.size, y = d.size * e.getAspectRatio(this._scene.activeCamera), _ = 2 * (m / i.width) - 1, v = 1 - 2 * (g / i.height), b = t.Matrix.FromValues(f / 2, 0, 0, 0, 0, y / 2, 0, 0, 0, 0, 1, 0, _, v, 0, 1);
                this._effect.setMatrix("viewportMatrix", b), this._effect.setTexture("textureSampler", d.texture), this._effect.setFloat4("color", d.color.r * a, d.color.g * a, d.color.b * a, 1), e.draw(!0, 0, 6)
            }
            return e.setDepthBuffer(!0), e.setAlphaMode(t.Engine.ALPHA_DISABLE), !0
        }, e.prototype.dispose = function() {
            for (this._vertexBuffer && (this._scene.getEngine()._releaseBuffer(this._vertexBuffer), this._vertexBuffer = null), this._indexBuffer && (this._scene.getEngine()._releaseBuffer(this._indexBuffer), this._indexBuffer = null); this.lensFlares.length; )
                this.lensFlares[0].dispose();
            var t = this._scene.lensFlareSystems.indexOf(this);
            this._scene.lensFlareSystems.splice(t, 1)
        }, e
    }();
    t.LensFlareSystem = e
}(BABYLON || (BABYLON = {}));
var BABYLON;
!function(t) {
    var e = function() {
        function e() {
            this._registeredMeshes = [], this._physicsMaterials = []
        }
        return e.prototype.initialize = function(t) {
            "undefined" == typeof t && (t = 10), this._world = new CANNON.World, this._world.broadphase = new CANNON.NaiveBroadphase, this._world.solver.iterations = t
        }, e.prototype._checkWithEpsilon = function(e) {
            return e < t.PhysicsEngine.Epsilon ? t.PhysicsEngine.Epsilon : e
        }, e.prototype.runOneStep = function(e) {
            this._world.step(e);
            for (var n = 0; n < this._registeredMeshes.length; n++) {
                var i = this._registeredMeshes[n];
                i.isChild || (i.mesh.position.x = i.body.position.x, i.mesh.position.y = i.body.position.z, i.mesh.position.z = i.body.position.y, i.mesh.rotationQuaternion || (i.mesh.rotationQuaternion = new t.Quaternion(0, 0, 0, 1)), i.mesh.rotationQuaternion.x = i.body.quaternion.x, i.mesh.rotationQuaternion.y = i.body.quaternion.z, i.mesh.rotationQuaternion.z = i.body.quaternion.y, i.mesh.rotationQuaternion.w = -i.body.quaternion.w)
            }
        }, e.prototype.setGravity = function(t) {
            this._world.gravity.set(t.x, t.z, t.y)
        }, e.prototype.registerMesh = function(e, n, i) {
            switch (this.unregisterMesh(e), e.computeWorldMatrix(!0), n) {
                case t.PhysicsEngine.SphereImpostor:
                    var o = e.getBoundingInfo().boundingBox, r = o.maximumWorld.x - o.minimumWorld.x, s = o.maximumWorld.y - o.minimumWorld.y, a = o.maximumWorld.z - o.minimumWorld.z;
                    return this._createSphere(Math.max(this._checkWithEpsilon(r), this._checkWithEpsilon(s), this._checkWithEpsilon(a)) / 2, e, i);
                case t.PhysicsEngine.BoxImpostor:
                    o = e.getBoundingInfo().boundingBox;
                    var l = o.minimumWorld, h = o.maximumWorld, c = h.subtract(l).scale(.5);
                    return this._createBox(this._checkWithEpsilon(c.x), this._checkWithEpsilon(c.y), this._checkWithEpsilon(c.z), e, i);
                case t.PhysicsEngine.PlaneImpostor:
                    return this._createPlane(e, i);
                case t.PhysicsEngine.MeshImpostor:
                    var u = e.getVerticesData(t.VertexBuffer.PositionKind), p = e.getIndices();
                    return this._createConvexPolyhedron(u, p, e, i)
            }
            return null
        }, e.prototype._createSphere = function(t, e, n) {
            var i = new CANNON.Sphere(t);
            return n ? this._createRigidBodyFromShape(i, e, n.mass, n.friction, n.restitution) : i
        }, e.prototype._createBox = function(t, e, n, i, o) {
            var r = new CANNON.Box(new CANNON.Vec3(t, n, e));
            return o ? this._createRigidBodyFromShape(r, i, o.mass, o.friction, o.restitution) : r
        }, e.prototype._createPlane = function(t, e) {
            var n = new CANNON.Plane;
            return e ? this._createRigidBodyFromShape(n, t, e.mass, e.friction, e.restitution) : n
        }, e.prototype._createConvexPolyhedron = function(e, n, i, o) {
            var r = [], s = [];
            i.computeWorldMatrix(!0);
            for (var a = 0; a < e.length; a += 3) {
                var l = t.Vector3.Zero();
                t.Vector3.TransformNormalFromFloatsToRef(e[a], e[a + 1], e[a + 2], i.getWorldMatrix(), l), r.push(new CANNON.Vec3(l.x, l.z, l.y))
            }
            for (var h = 0; h < n.length; h += 3)
                s.push([n[h], n[h + 2], n[h + 1]]);
            var c = new CANNON.ConvexPolyhedron(r, s);
            return o ? this._createRigidBodyFromShape(c, i, o.mass, o.friction, o.restitution) : c
        }, e.prototype._addMaterial = function(t, e) {
            var n, i;
            for (n = 0; n < this._physicsMaterials.length; n++)
                if (i = this._physicsMaterials[n], i.friction === t && i.restitution === e)
                    return i;
            var o = new CANNON.Material;
            for (o.friction = t, o.restitution = e, this._physicsMaterials.push(o), n = 0; n < this._physicsMaterials.length; n++) {
                i = this._physicsMaterials[n];
                var r = new CANNON.ContactMaterial(i, o, i.friction * o.friction, i.restitution * o.restitution);
                r.contactEquationStiffness = 1e10, r.contactEquationRegularizationTime = 10, this._world.addContactMaterial(r)
            }
            return o
        }, e.prototype._createRigidBodyFromShape = function(e, n, i, o, r) {
            var s = null;
            n.rotationQuaternion && (s = n.rotationQuaternion.clone(), n.rotationQuaternion = new t.Quaternion(0, 0, 0, 1));
            var a = this._addMaterial(o, r), l = new CANNON.RigidBody(i, e, a);
            return s && (l.quaternion.x = s.x, l.quaternion.z = s.y, l.quaternion.y = s.z, l.quaternion.w = -s.w), l.position.set(n.position.x, n.position.z, n.position.y), this._world.add(l), this._registeredMeshes.push({mesh: n,body: l,material: a}), l
        }, e.prototype.registerMeshesAsCompound = function(t, e) {
            for (var n = new CANNON.Compound, i = 0; i < t.length; i++) {
                var o = t[i].mesh, r = this.registerMesh(o, t[i].impostor);
                0 == i ? n.addChild(r, new CANNON.Vec3(0, 0, 0)) : n.addChild(r, new CANNON.Vec3(o.position.x, o.position.z, o.position.y))
            }
            var s = t[0].mesh, a = this._createRigidBodyFromShape(n, s, e.mass, e.friction, e.restitution);
            return a.parts = t, a
        }, e.prototype._unbindBody = function(t) {
            for (var e = 0; e < this._registeredMeshes.length; e++) {
                var n = this._registeredMeshes[e];
                n.body === t && (n.body = null)
            }
        }, e.prototype.unregisterMesh = function(t) {
            for (var e = 0; e < this._registeredMeshes.length; e++) {
                var n = this._registeredMeshes[e];
                if (n.mesh === t)
                    return n.body && (this._world.remove(n.body), this._unbindBody(n.body)), void this._registeredMeshes.splice(e, 1)
                    }
        }, e.prototype.applyImpulse = function(t, e, n) {
            for (var i = new CANNON.Vec3(n.x, n.z, n.y), o = new CANNON.Vec3(e.x, e.z, e.y), r = 0; r < this._registeredMeshes.length; r++) {
                var s = this._registeredMeshes[r];
                if (s.mesh === t)
                    return void s.body.applyImpulse(o, i)
                    }
        }, e.prototype.createLink = function(t, e, n, i) {
            for (var o = null, r = null, s = 0; s < this._registeredMeshes.length; s++) {
                var a = this._registeredMeshes[s];
                a.mesh === t ? o = a.body : a.mesh === e && (r = a.body)
            }
            if (!o || !r)
                return !1;
            var l = new CANNON.PointToPointConstraint(o, new CANNON.Vec3(n.x, n.z, n.y), r, new CANNON.Vec3(i.x, i.z, i.y));
            return this._world.addConstraint(l), !0
        }, e.prototype.dispose = function() {
            for (; this._registeredMeshes.length; )
                this.unregisterMesh(this._registeredMeshes[0].mesh)
                }, e.prototype.isSupported = function() {
                    return void 0 !== window.CANNON
                }, e
    }();
    t.CannonJSPlugin = e
}(BABYLON || (BABYLON = {}));
var BABYLON;
!function(t) {
    var e = function() {
        function e(e) {
            this._currentPlugin = e || new t.CannonJSPlugin
        }
        return e.prototype._initialize = function(t) {
            this._currentPlugin.initialize(), this._setGravity(t)
        }, e.prototype._runOneStep = function(t) {
            t > .1 ? t = .1 : 0 >= t && (t = 1 / 60), this._currentPlugin.runOneStep(t)
        }, e.prototype._setGravity = function(e) {
            this.gravity = e || new t.Vector3(0, -9.82, 0), this._currentPlugin.setGravity(this.gravity)
        }, e.prototype._registerMesh = function(t, e, n) {
            return this._currentPlugin.registerMesh(t, e, n)
        }, e.prototype._registerMeshesAsCompound = function(t, e) {
            return this._currentPlugin.registerMeshesAsCompound(t, e)
        }, e.prototype._unregisterMesh = function(t) {
            this._currentPlugin.unregisterMesh(t)
        }, e.prototype._applyImpulse = function(t, e, n) {
            this._currentPlugin.applyImpulse(t, e, n)
        }, e.prototype._createLink = function(t, e, n, i) {
            return this._currentPlugin.createLink(t, e, n, i)
        }, e.prototype.dispose = function() {
            this._currentPlugin.dispose()
        }, e.prototype.isSupported = function() {
            return this._currentPlugin.isSupported()
        }, e.NoImpostor = 0, e.SphereImpostor = 1, e.BoxImpostor = 2, e.PlaneImpostor = 3, e.CompoundImpostor = 4, e.MeshImpostor = 4, e.CapsuleImpostor = 5, e.ConeImpostor = 6, e.CylinderImpostor = 7, e.ConvexHullImpostor = 8, e.Epsilon = .001, e
    }();
    t.PhysicsEngine = e
}(BABYLON || (BABYLON = {}));
var BABYLON;
!function(t) {
    var e = function(e) {
        var n = {};
        if (n.name = e.name, n.id = e.id, n.tags = t.Tags.GetTags(e), e instanceof t.PointLight)
            n.type = 0, n.position = e.position.asArray();
        else if (e instanceof t.DirectionalLight) {
            n.type = 1;
            var i = e;
            n.position = i.position.asArray(), n.direction = i.direction.asArray()
        } else if (e instanceof t.SpotLight) {
            n.type = 2;
            var o = e;
            n.position = o.position.asArray(), n.direction = o.position.asArray(), n.angle = o.angle, n.exponent = o.exponent
        } else if (e instanceof t.HemisphericLight) {
            n.type = 3;
            var r = e;
            n.direction = r.direction.asArray(), n.groundColor = r.groundColor.asArray()
        }
        return e.intensity && (n.intensity = e.intensity), n.range = e.range, n.diffuse = e.diffuse.asArray(), n.specular = e.specular.asArray(), n
    }, n = function(e) {
        var n = {};
        return n.name = e.name, n.tags = t.Tags.GetTags(e), n.id = e.id, n.position = e.position.asArray(), e.parent && (n.parentId = e.parent.id), n.rotation = e.rotation.asArray(), e.lockedTarget && e.lockedTarget.id && (n.lockedTargetId = e.lockedTarget.id), n.fov = e.fov, n.minZ = e.minZ, n.maxZ = e.maxZ, n.speed = e.speed, n.inertia = e.inertia, n.checkCollisions = e.checkCollisions, n.applyGravity = e.applyGravity, e.ellipsoid && (n.ellipsoid = e.ellipsoid.asArray()), i(e, n), n.layerMask = e.layerMask, n
    }, i = function(t, e) {
        if (t.animations) {
            e.animations = [];
            for (var n = 0; n < t.animations.length; n++) {
                var i = t.animations[n];
                e.animations.push(o(i))
            }
        }
    }, o = function(e) {
        var n = {};
        n.name = e.name, n.property = e.targetProperty, n.framePerSecond = e.framePerSecond, n.dataType = e.dataType, n.loopBehavior = e.loopMode;
        var i = e.dataType;
        n.keys = [];
        for (var o = e.getKeys(), r = 0; r < o.length; r++) {
            var s = o[r], a = {};
            switch (a.frame = s.frame, i) {
                case t.Animation.ANIMATIONTYPE_FLOAT:
                    a.values = [s.value];
                    break;
                case t.Animation.ANIMATIONTYPE_QUATERNION:
                case t.Animation.ANIMATIONTYPE_MATRIX:
                case t.Animation.ANIMATIONTYPE_VECTOR3:
                    a.values = s.value.asArray()
            }
            n.keys.push(a)
        }
        return n
    }, r = function(e) {
        var n = {};
        n.name = e.name, n.id = e.id, n.tags = t.Tags.GetTags(e), n.materials = [];
        for (var i = 0; i < e.subMaterials.length; i++) {
            var o = e.subMaterials[i];
            n.materials.push(o ? o.id : null)
        }
        return n
    }, s = function(e) {
        var n = {};
        return n.name = e.name, n.ambient = e.ambientColor.asArray(), n.diffuse = e.diffuseColor.asArray(), n.specular = e.specularColor.asArray(), n.specularPower = e.specularPower, n.emissive = e.emissiveColor.asArray(), n.alpha = e.alpha, n.id = e.id, n.tags = t.Tags.GetTags(e), n.backFaceCulling = e.backFaceCulling, e.diffuseTexture && (n.diffuseTexture = a(e.diffuseTexture)), e.ambientTexture && (n.ambientTexture = a(e.ambientTexture)), e.opacityTexture && (n.opacityTexture = a(e.opacityTexture)), e.reflectionTexture && (n.reflectionTexture = a(e.reflectionTexture)), e.emissiveTexture && (n.emissiveTexture = a(e.emissiveTexture)), e.specularTexture && (n.specularTexture = a(e.specularTexture)), e.bumpTexture && (n.bumpTexture = a(e.bumpTexture)), n
    }, a = function(e) {
        var n = {};
        if (!e.name)
            return null;
        if (e instanceof t.CubeTexture)
            return n.name = e.name, n.hasAlpha = e.hasAlpha, n.level = e.level, n.coordinatesMode = e.coordinatesMode, n;
        if (e instanceof t.MirrorTexture) {
            var o = e;
            n.renderTargetSize = o.getRenderSize(), n.renderList = [];
            for (var r = 0; r < o.renderList.length; r++)
                n.renderList.push(o.renderList[r].id);
            n.mirrorPlane = o.mirrorPlane.asArray()
        } else if (e instanceof t.RenderTargetTexture) {
            var s = e;
            for (n.renderTargetSize = s.getRenderSize(), n.renderList = [], r = 0; r < s.renderList.length; r++)
                n.renderList.push(s.renderList[r].id)
                }
        var a = e;
        return n.name = e.name, n.hasAlpha = e.hasAlpha, n.level = e.level, n.coordinatesIndex = e.coordinatesIndex, n.coordinatesMode = e.coordinatesMode, n.uOffset = a.uOffset, n.vOffset = a.vOffset, n.uScale = a.uScale, n.vScale = a.vScale, n.uAng = a.uAng, n.vAng = a.vAng, n.wAng = a.wAng, n.wrapU = e.wrapU, n.wrapV = e.wrapV, i(e, n), n
    }, l = function(t) {
        var e = {};
        e.name = t.name, e.id = t.id, e.bones = [];
        for (var n = 0; n < t.bones.length; n++) {
            var i = t.bones[n], r = {parentBoneIndex: i.getParent() ? t.bones.indexOf(i.getParent()) : -1,name: i.name,matrix: i.getLocalMatrix().toArray()};
            e.bones.push(r), i.animations && i.animations.length > 0 && (r.animation = o(i.animations[0]))
        }
        return e
    }, h = function(t) {
        var e = {};
        return e.emitterId = t.emitter.id, e.capacity = t.getCapacity(), t.particleTexture && (e.textureName = t.particleTexture.name), e.minAngularSpeed = t.minAngularSpeed, e.maxAngularSpeed = t.maxAngularSpeed, e.minSize = t.minSize, e.maxSize = t.maxSize, e.minLifeTime = t.minLifeTime, e.maxLifeTime = t.maxLifeTime, e.emitRate = t.emitRate, e.minEmitBox = t.minEmitBox.asArray(), e.maxEmitBox = t.maxEmitBox.asArray(), e.gravity = t.gravity.asArray(), e.direction1 = t.direction1.asArray(), e.direction2 = t.direction2.asArray(), e.color1 = t.color1.asArray(), e.color2 = t.color2.asArray(), e.colorDead = t.colorDead.asArray(), e.updateSpeed = t.updateSpeed, e.targetStopDuration = t.targetStopDuration, e.textureMask = t.textureMask.asArray(), e.blendMode = t.blendMode, e
    }, c = function(e) {
        var n = {};
        n.emitterId = e.getEmitter().id, n.borderLimit = e.borderLimit, n.flares = [];
        for (var i = 0; i < e.lensFlares.length; i++) {
            var o = e.lensFlares[i];
            n.flares.push({size: o.size,position: o.position,color: o.color.asArray(),textureName: t.Tools.GetFilename(o.texture.name)})
        }
        return n
    }, u = function(t) {
        var e = {}, n = t.getShadowGenerator();
        e.lightId = t.id, e.mapSize = n.getShadowMap().getRenderSize(), e.useVarianceShadowMap = n.useVarianceShadowMap, e.usePoissonSampling = n.usePoissonSampling, e.renderList = [];
        for (var i = 0; i < n.getShadowMap().renderList.length; i++) {
            var o = n.getShadowMap().renderList[i];
            e.renderList.push(o.id)
        }
        return e
    }, p = [], d = function(e, n) {
        if (!p[e.id]) {
            if (e instanceof t.Geometry.Primitives.Box)
                n.boxes.push(y(e));
            else if (e instanceof t.Geometry.Primitives.Sphere)
                n.spheres.push(_(e));
            else if (e instanceof t.Geometry.Primitives.Cylinder)
                n.cylinders.push(v(e));
            else if (e instanceof t.Geometry.Primitives.Torus)
                n.toruses.push(b(e));
            else if (e instanceof t.Geometry.Primitives.Ground)
                n.grounds.push(w(e));
            else if (e instanceof t.Geometry.Primitives.Plane)
                n.planes.push(x(e));
            else if (e instanceof t.Geometry.Primitives.TorusKnot)
                n.torusKnots.push(C(e));
            else {
                if (e instanceof t.Geometry.Primitives._Primitive)
                    throw new Error("Unknow primitive type");
                n.vertexData.push(g(e))
            }
            p[e.id] = !0
        }
    }, m = function(e) {
        var n = {};
        return n.id = e.id, t.Tags.HasTags(e) && (n.tags = t.Tags.GetTags(e)), n
    }, g = function(e) {
        var n = m(e);
        return e.isVerticesDataPresent(t.VertexBuffer.PositionKind) && (n.positions = e.getVerticesData(t.VertexBuffer.PositionKind)), e.isVerticesDataPresent(t.VertexBuffer.NormalKind) && (n.normals = e.getVerticesData(t.VertexBuffer.NormalKind)), e.isVerticesDataPresent(t.VertexBuffer.UVKind) && (n.uvs = e.getVerticesData(t.VertexBuffer.UVKind)), e.isVerticesDataPresent(t.VertexBuffer.UV2Kind) && (n.uvs2 = e.getVerticesData(t.VertexBuffer.UV2Kind)), e.isVerticesDataPresent(t.VertexBuffer.ColorKind) && (n.colors = e.getVerticesData(t.VertexBuffer.ColorKind)), e.isVerticesDataPresent(t.VertexBuffer.MatricesIndicesKind) && (n.matricesIndices = e.getVerticesData(t.VertexBuffer.MatricesIndicesKind), n.matricesIndices._isExpanded = !0), e.isVerticesDataPresent(t.VertexBuffer.MatricesWeightsKind) && (n.matricesWeights = e.getVerticesData(t.VertexBuffer.MatricesWeightsKind)), n.indices = e.getIndices(), n
    }, f = function(t) {
        var e = m(t);
        return e.canBeRegenerated = t.canBeRegenerated(), e
    }, y = function(t) {
        var e = f(t);
        return e.size = t.size, e
    }, _ = function(t) {
        var e = f(t);
        return e.segments = t.segments, e.diameter = t.diameter, e
    }, v = function(t) {
        var e = f(t);
        return e.height = t.height, e.diameterTop = t.diameterTop, e.diameterBottom = t.diameterBottom, e.tessellation = t.tessellation, e
    }, b = function(t) {
        var e = f(t);
        return e.diameter = t.diameter, e.thickness = t.thickness, e.tessellation = t.tessellation, e
    }, w = function(t) {
        var e = f(t);
        return e.width = t.width, e.height = t.height, e.subdivisions = t.subdivisions, e
    }, x = function(t) {
        var e = f(t);
        return e.size = t.size, e
    }, C = function(t) {
        var e = f(t);
        return e.radius = t.radius, e.tube = t.tube, e.radialSegments = t.radialSegments, e.tubularSegments = t.tubularSegments, e.p = t.p, e.q = t.q, e
    }, M = function(e, n) {
        var o = {};
        o.name = e.name, o.id = e.id, t.Tags.HasTags(e) && (o.tags = t.Tags.GetTags(e)), o.position = e.position.asArray(), e.rotationQuaternion ? o.rotationQuaternion = e.rotationQuaternion.asArray() : e.rotation && (o.rotation = e.rotation.asArray()), o.scaling = e.scaling.asArray(), o.localMatrix = e.getPivotMatrix().asArray(), o.isEnabled = e.isEnabled(), o.isVisible = e.isVisible, o.infiniteDistance = e.infiniteDistance, o.pickable = e.isPickable, o.receiveShadows = e.receiveShadows, o.billboardMode = e.billboardMode, o.visibility = e.visibility, o.checkCollisions = e.checkCollisions, e.parent && (o.parentId = e.parent.id);
        var r = e._geometry;
        if (r) {
            var s = r.id;
            o.geometryId = s, e.getScene().getGeometryByID(s) || d(r, n.geometries), o.subMeshes = [];
            for (var a = 0; a < e.subMeshes.length; a++) {
                var l = e.subMeshes[a];
                o.subMeshes.push({materialIndex: l.materialIndex,verticesStart: l.verticesStart,verticesCount: l.verticesCount,indexStart: l.indexStart,indexCount: l.indexCount})
            }
        }
        if (e.material ? o.materialId = e.material.id : e.material = null, e.skeleton && (o.skeletonId = e.skeleton.id), e.getPhysicsImpostor() !== t.PhysicsEngine.NoImpostor)
            switch (o.physicsMass = e.getPhysicsMass(), o.physicsFriction = e.getPhysicsFriction(), o.physicsRestitution = e.getPhysicsRestitution(), e.getPhysicsImpostor()) {
                case t.PhysicsEngine.BoxImpostor:
                    o.physicsImpostor = 1;
                    break;
                case t.PhysicsEngine.SphereImpostor:
                    o.physicsImpostor = 2
            }
        return i(e, o), o.layerMask = e.layerMask, o
    }, D = function() {
        function i() {
        }
        return i.Serialize = function(i) {
            var o = {};
            o.useDelayedTextureLoading = i.useDelayedTextureLoading, o.autoClear = i.autoClear, o.clearColor = i.clearColor.asArray(), o.ambientColor = i.ambientColor.asArray(), o.gravity = i.gravity.asArray(), i.fogMode && 0 !== i.fogMode && (o.fogMode = i.fogMode, o.fogColor = i.fogColor.asArray(), o.fogStart = i.fogStart, o.fogEnd = i.fogEnd, o.fogDensity = i.fogDensity), o.lights = [];
            for (var a = 0; a < i.lights.length; a++) {
                var m = i.lights[a];
                o.lights.push(e(m))
            }
            for (o.cameras = [], a = 0; a < i.cameras.length; a++) {
                var g = i.cameras[a];
                g instanceof t.FreeCamera && o.cameras.push(n(g))
            }
            for (i.activeCamera && (o.activeCameraID = i.activeCamera.id), o.materials = [], o.multiMaterials = [], a = 0; a < i.materials.length; a++) {
                var f = i.materials[a];
                f instanceof t.StandardMaterial ? o.materials.push(s(f)) : f instanceof t.MultiMaterial && o.multiMaterials.push(r(f))
            }
            for (o.skeletons = [], a = 0; a < i.skeletons.length; a++)
                o.skeletons.push(l(i.skeletons[a]));
            o.geometries = {}, o.geometries.boxes = [], o.geometries.spheres = [], o.geometries.cylinders = [], o.geometries.toruses = [], o.geometries.grounds = [], o.geometries.planes = [], o.geometries.torusKnots = [], o.geometries.vertexData = [], p = [];
            for (var y = i.getGeometries(), a = 0; a < y.length; a++) {
                var _ = y[a];
                _.isReady() && d(_, o.geometries)
            }
            for (o.meshes = [], a = 0; a < i.meshes.length; a++) {
                var v = i.meshes[a];
                if (v instanceof t.Mesh) {
                    var b = v;
                    (b.delayLoadState === t.Engine.DELAYLOADSTATE_LOADED || b.delayLoadState === t.Engine.DELAYLOADSTATE_NONE) && o.meshes.push(M(b, o))
                }
            }
            for (o.particleSystems = [], a = 0; a < i.particleSystems.length; a++)
                o.particleSystems.push(h(i.particleSystems[a]));
            for (o.lensFlareSystems = [], a = 0; a < i.lensFlareSystems.length; a++)
                o.lensFlareSystems.push(c(i.lensFlareSystems[a]));
            for (o.shadowGenerators = [], a = 0; a < i.lights.length; a++)
                m = i.lights[a], m.getShadowGenerator() && o.shadowGenerators.push(u(m));
            return o
        }, i
    }();
    t.SceneSerializer = D
}(BABYLON || (BABYLON = {}));
var BABYLON;
!function(t) {
    var e = 0, n = function() {
        function e(t, e, n) {
            this.pos = t, this.normal = e, this.uv = n
        }
        return e.prototype.clone = function() {
            return new e(this.pos.clone(), this.normal.clone(), this.uv.clone())
        }, e.prototype.flip = function() {
            this.normal.scaleInPlace(-1)
        }, e.prototype.interpolate = function(n, i) {
            return new e(t.Vector3.Lerp(this.pos, n.pos, i), t.Vector3.Lerp(this.normal, n.normal, i), t.Vector2.Lerp(this.uv, n.uv, i))
        }, e
    }(), i = function() {
        function e(t, e) {
            this.normal = t, this.w = e
        }
        return e.FromPoints = function(n, i, o) {
            var r = o.subtract(n), s = i.subtract(n);
            if (0 === r.lengthSquared() || 0 === s.lengthSquared())
                return null;
            var a = t.Vector3.Normalize(t.Vector3.Cross(r, s));
            return new e(a, t.Vector3.Dot(a, n))
        }, e.prototype.clone = function() {
            return new e(this.normal.clone(), this.w)
        }, e.prototype.flip = function() {
            this.normal.scaleInPlace(-1), this.w = -this.w
        }, e.prototype.splitPolygon = function(n, i, r, s, a) {
            for (var l = 0, h = 1, c = 2, u = 3, p = 0, d = [], m = 0; m < n.vertices.length; m++) {
                var g = t.Vector3.Dot(this.normal, n.vertices[m].pos) - this.w, f = g < -e.EPSILON ? c : g > e.EPSILON ? h : l;
                p |= f, d.push(f)
            }
            switch (p) {
                case l:
                    (t.Vector3.Dot(this.normal, n.plane.normal) > 0 ? i : r).push(n);
                    break;
                case h:
                    s.push(n);
                    break;
                case c:
                    a.push(n);
                    break;
                case u:
                    var y = [], _ = [];
                    for (m = 0; m < n.vertices.length; m++) {
                        var v = (m + 1) % n.vertices.length, b = d[m], w = d[v], x = n.vertices[m], C = n.vertices[v];
                        if (b != c && y.push(x), b != h && _.push(b != c ? x.clone() : x), (b | w) == u) {
                            g = (this.w - t.Vector3.Dot(this.normal, x.pos)) / t.Vector3.Dot(this.normal, C.pos.subtract(x.pos));
                            var M = x.interpolate(C, g);
                            y.push(M), _.push(M.clone())
                        }
                    }
                    if (y.length >= 3) {
                        var D = new o(y, n.shared);
                        D.plane && s.push(D)
                    }
                    if (_.length >= 3) {
                        var D = new o(_, n.shared);
                        D.plane && a.push(D)
                    }
            }
        }, e.EPSILON = 1e-5, e
    }(), o = function() {
        function t(t, e) {
            this.vertices = t, this.shared = e, this.plane = i.FromPoints(t[0].pos, t[1].pos, t[2].pos)
        }
        return t.prototype.clone = function() {
            var e = this.vertices.map(function(t) {
                                      return t.clone()
                                      });
            return new t(e, this.shared)
        }, t.prototype.flip = function() {
            this.vertices.reverse().map(function(t) {
                                        t.flip()
                                        }), this.plane.flip()
        }, t
    }(), r = function() {
        function t(t) {
            this.plane = null, this.front = null, this.back = null, this.polygons = [], t && this.build(t)
        }
        return t.prototype.clone = function() {
            var e = new t;
            return e.plane = this.plane && this.plane.clone(), e.front = this.front && this.front.clone(), e.back = this.back && this.back.clone(), e.polygons = this.polygons.map(function(t) {
                                                                                                                                                                                   return t.clone()
                                                                                                                                                                                   }), e
        }, t.prototype.invert = function() {
            for (var t = 0; t < this.polygons.length; t++)
                this.polygons[t].flip();
            this.plane && this.plane.flip(), this.front && this.front.invert(), this.back && this.back.invert();
            var e = this.front;
            this.front = this.back, this.back = e
        }, t.prototype.clipPolygons = function(t) {
            if (!this.plane)
                return t.slice();
            for (var e = [], n = [], i = 0; i < t.length; i++)
                this.plane.splitPolygon(t[i], e, n, e, n);
            return this.front && (e = this.front.clipPolygons(e)), n = this.back ? this.back.clipPolygons(n) : [], e.concat(n)
        }, t.prototype.clipTo = function(t) {
            this.polygons = t.clipPolygons(this.polygons), this.front && this.front.clipTo(t), this.back && this.back.clipTo(t)
        }, t.prototype.allPolygons = function() {
            var t = this.polygons.slice();
            return this.front && (t = t.concat(this.front.allPolygons())), this.back && (t = t.concat(this.back.allPolygons())), t
        }, t.prototype.debug = function() {
        }, t.prototype.build = function(e) {
            if (e.length) {
                this.plane || (this.plane = e[0].plane.clone());
                for (var n = [], i = [], o = 0; o < e.length; o++)
                    this.plane.splitPolygon(e[o], this.polygons, this.polygons, n, i);
                n.length && (this.front || (this.front = new t), this.front.build(n)), i.length && (this.back || (this.back = new t), this.back.build(i))
            }
        }, t
    }(), s = function() {
        function i() {
            this.polygons = new Array, this.matrix = t.Matrix.Identity(), this.position = new t.Vector3(0, 0, 0), this.rotation = new t.Vector3(0, 0, 0), this.scaling = new t.Vector3(1, 1, 1)
        }
        return i.FromMesh = function(r) {
            var s, a, l, h, c, u, p = [];
            if (!(r instanceof t.Mesh))
                throw "BABYLON.CSG: Wrong Mesh type, must be BABYLON.Mesh";
            r.computeWorldMatrix(!0);
            for (var d = r.getWorldMatrix(), m = r.position.clone(), g = r.rotation.clone(), f = r.scaling.clone(), y = r.getIndices(), _ = r.getVerticesData(t.VertexBuffer.PositionKind), v = r.getVerticesData(t.VertexBuffer.NormalKind), b = r.getVerticesData(t.VertexBuffer.UVKind), w = r.subMeshes, x = w.length - 1; x >= 0; x--)
                for (var C = w[x].indexStart, M = w[x].indexCount + w[x].indexStart; M > C; C += 3) {
                    u = [];
                    for (var D = 0; 3 > D; D++)
                        a = new t.Vector3(v[3 * y[C + D]], v[3 * y[C + D] + 1], v[3 * y[C + D] + 2]), l = new t.Vector2(b[2 * y[C + D]], b[2 * y[C + D] + 1]), h = new t.Vector3(_[3 * y[C + D]], _[3 * y[C + D] + 1], _[3 * y[C + D] + 2]), t.Vector3.TransformCoordinatesToRef(h, d, h), t.Vector3.TransformNormalToRef(a, d, a), s = new n(h, a, l), u.push(s);
                    c = new o(u, {subMeshId: x,meshId: e,materialIndex: w[x].materialIndex,objectInstance: w[x].objectInstance,boundingBox: w[x].boundingBox}), c.plane && p.push(c)
                }
            var B = i.FromPolygons(p);
            return B.matrix = d, B.position = m, B.rotation = g, B.scaling = f, e++, B
        }, i.FromPolygons = function(e) {
            var n = new t.CSG;
            return n.polygons = e, n
        }, i.prototype.clone = function() {
            var e = new t.CSG;
            return e.polygons = this.polygons.map(function(t) {
                                                  return t.clone()
                                                  }), e.copyTransformAttributes(this), e
        }, i.prototype.toPolygons = function() {
            return this.polygons
        }, i.prototype.unionInPlace = function(t) {
            var e = new r(this.polygons), n = new r(t.polygons);
            e.clipTo(n), n.clipTo(e), n.invert(), n.clipTo(e), n.invert(), e.build(n.allPolygons()), this.polygons = e.allPolygons()
        }, i.prototype.union = function(t) {
            var e = new r(this.clone().polygons), n = new r(t.clone().polygons);
            return e.clipTo(n), n.clipTo(e), n.invert(), n.clipTo(e), n.invert(), e.build(n.allPolygons()), i.FromPolygons(e.allPolygons()).copyTransformAttributes(this)
        }, i.prototype.subtractInPlace = function(t) {
            var e = new r(this.polygons), n = new r(t.polygons);
            e.invert(), e.clipTo(n), n.clipTo(e), n.invert(), n.clipTo(e), n.invert(), e.build(n.allPolygons()), e.invert(), this.polygons = e.allPolygons()
        }, i.prototype.subtract = function(t) {
            var e = new r(this.clone().polygons), n = new r(t.clone().polygons);
            return e.invert(), e.clipTo(n), n.clipTo(e), n.invert(), n.clipTo(e), n.invert(), e.build(n.allPolygons()), e.invert(), i.FromPolygons(e.allPolygons()).copyTransformAttributes(this)
        }, i.prototype.intersectInPlace = function(t) {
            var e = new r(this.polygons), n = new r(t.polygons);
            e.invert(), n.clipTo(e), n.invert(), e.clipTo(n), n.clipTo(e), e.build(n.allPolygons()), e.invert(), this.polygons = e.allPolygons()
        }, i.prototype.intersect = function(t) {
            var e = new r(this.clone().polygons), n = new r(t.clone().polygons);
            return e.invert(), n.clipTo(e), n.invert(), e.clipTo(n), n.clipTo(e), e.build(n.allPolygons()), e.invert(), i.FromPolygons(e.allPolygons()).copyTransformAttributes(this)
        }, i.prototype.inverseInPlace = function() {
            this.polygons.map(function(t) {
                              t.flip()
                              })
        }, i.prototype.inverse = function() {
            var t = this.clone();
            return t.polygons.map(function(t) {
                                  t.flip()
                                  }), t
        }, i.prototype.copyTransformAttributes = function(t) {
            return this.matrix = t.matrix, this.position = t.position, this.rotation = t.rotation, this.scaling = t.scaling, this
        }, i.prototype.buildMeshGeometry = function(e, n, i) {
            var o = this.matrix.clone();
            o.invert();
            var r, s, a, l = new t.Mesh(e, n), h = [], c = [], u = [], p = [], d = t.Vector3.Zero(), m = t.Vector3.Zero(), g = t.Vector2.Zero(), f = this.polygons, y = [0, 0, 0], _ = {}, v = 0, b = {};
            i && f.sort(function(t, e) {
                        return t.shared.meshId === e.shared.meshId ? t.shared.subMeshId - e.shared.subMeshId : t.shared.meshId - e.shared.meshId
                        });
            for (var w = 0, x = f.length; x > w; w++) {
                r = f[w], b[r.shared.meshId] || (b[r.shared.meshId] = {}), b[r.shared.meshId][r.shared.subMeshId] || (b[r.shared.meshId][r.shared.subMeshId] = {indexStart: +1 / 0,indexEnd: -1 / 0,materialIndex: r.shared.materialIndex,objectInstance: r.shared.objectInstance,boundingBox: r.shared.boundingBox}), a = b[r.shared.meshId][r.shared.subMeshId];
                for (var C = 2, M = r.vertices.length; M > C; C++) {
                    y[0] = 0, y[1] = C - 1, y[2] = C;
                    for (var D = 0; 3 > D; D++)
                        d.copyFrom(r.vertices[y[D]].pos), m.copyFrom(r.vertices[y[D]].normal), g.copyFrom(r.vertices[y[D]].uv), t.Vector3.TransformCoordinatesToRef(d, o, d), t.Vector3.TransformNormalToRef(m, o, m), s = _[d.x + "," + d.y + "," + d.z], ("undefined" == typeof s || u[3 * s] !== m.x || u[3 * s + 1] !== m.y || u[3 * s + 2] !== m.z || p[2 * s] !== g.x || p[2 * s + 1] !== g.y) && (h.push(d.x, d.y, d.z), p.push(g.x, g.y), u.push(m.x, m.y, m.z), s = _[d.x + "," + d.y + "," + d.z] = h.length / 3 - 1), c.push(s), a.indexStart = Math.min(v, a.indexStart), a.indexEnd = Math.max(v, a.indexEnd), v++
                        }
            }
            if (l.setVerticesData(t.VertexBuffer.PositionKind, h), l.setVerticesData(t.VertexBuffer.NormalKind, u), l.setVerticesData(t.VertexBuffer.UVKind, p), l.setIndices(c), i) {
                var B, A = 0;
                l.subMeshes = [];
                for (var E in b) {
                    B = -1;
                    for (var T in b[E]) {
                        a = b[E][T];
                        var S = t.SubMesh.CreateFromIndices(a.materialIndex + A, a.indexStart, a.indexEnd - a.indexStart + 1, l);
                        S.objectInstance = a.objectInstance, S.boundingBox = a.boundingBox, B = Math.max(a.materialIndex, B)
                    }
                    A += ++B
                }
            }
            return l
        }, i.prototype.toMesh = function(t, e, n, i) {
            var o = this.buildMeshGeometry(t, n, i);
            return o.material = e, o.position.copyFrom(this.position), o.rotation.copyFrom(this.rotation), o.scaling.copyFrom(this.scaling), o.computeWorldMatrix(!0), o
        }, i
    }();
    t.CSG = s
}(BABYLON || (BABYLON = {}));
var __extends = this.__extends || function(t, e) {
    function n() {
        this.constructor = t
    }
    for (var i in e)
        e.hasOwnProperty(i) && (t[i] = e[i]);
    n.prototype = e.prototype, t.prototype = new n
}, BABYLON;
!function(t) {
    var e = function(e) {
        function n(n, i, o, r) {
            var s = this;
            e.call(this, n, "oculusDistortionCorrection", ["LensCenter", "Scale", "ScaleIn", "HmdWarpParam"], null, r.PostProcessScaleFactor, i, t.Texture.BILINEAR_SAMPLINGMODE, null, null), this._isRightEye = o, this._distortionFactors = r.DistortionK, this._postProcessScaleFactor = r.PostProcessScaleFactor, this._lensCenterOffset = r.LensCenterOffset, this.onSizeChanged = function() {
                s.aspectRatio = .5 * s.width / s.height, s._scaleIn = new t.Vector2(2, 2 / s.aspectRatio), s._scaleFactor = new t.Vector2(.5 * (1 / s._postProcessScaleFactor), .5 * (1 / s._postProcessScaleFactor) * s.aspectRatio), s._lensCenter = new t.Vector2(s._isRightEye ? .5 - .5 * s._lensCenterOffset : .5 + .5 * s._lensCenterOffset, .5)
            }, this.onApply = function(t) {
                t.setFloat2("LensCenter", s._lensCenter.x, s._lensCenter.y), t.setFloat2("Scale", s._scaleFactor.x, s._scaleFactor.y), t.setFloat2("ScaleIn", s._scaleIn.x, s._scaleIn.y), t.setFloat4("HmdWarpParam", s._distortionFactors[0], s._distortionFactors[1], s._distortionFactors[2], s._distortionFactors[3])
            }
        }
        return __extends(n, e), n
    }(t.PostProcess);
    t.OculusDistortionCorrectionPostProcess = e
}(BABYLON || (BABYLON = {}));
var BABYLON;
!function(t) {
    !function(t) {
        t[t.X = 0] = "X", t[t.Y = 1] = "Y", t[t.Z = 2] = "Z"
    }(t.JoystickAxis || (t.JoystickAxis = {}));
    var e = (t.JoystickAxis, function() {
             function e(n) {
             var i = this;
             this._leftJoystick = n ? !0 : !1, this._joystickIndex = e._globalJoystickIndex, e._globalJoystickIndex++, this._axisTargetedByLeftAndRight = 0, this._axisTargetedByUpAndDown = 1, this.reverseLeftRight = !1, this.reverseUpDown = !1, this._touches = new t.VirtualJoystick.Collection, this.deltaPosition = t.Vector3.Zero(), this._joystickSensibility = 25, this._inversedSensibility = 1 / (this._joystickSensibility / 1e3), this._rotationSpeed = 25, this._inverseRotationSpeed = 1 / (this._rotationSpeed / 1e3), this._rotateOnAxisRelativeToMesh = !1, e.vjCanvas || (window.addEventListener("resize", function() {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       e.vjCanvasWidth = window.innerWidth, e.vjCanvasHeight = window.innerHeight, e.vjCanvas.width = e.vjCanvasWidth, e.vjCanvas.height = e.vjCanvasHeight, e.halfWidth = e.vjCanvasWidth / 2, e.halfHeight = e.vjCanvasHeight / 2
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       }, !1), e.vjCanvas = document.createElement("canvas"), e.vjCanvasWidth = window.innerWidth, e.vjCanvasHeight = window.innerHeight, e.vjCanvas.width = window.innerWidth, e.vjCanvas.height = window.innerHeight, e.vjCanvas.style.width = "100%", e.vjCanvas.style.height = "100%", e.vjCanvas.style.position = "absolute", e.vjCanvas.style.backgroundColor = "transparent", e.vjCanvas.style.top = "0px", e.vjCanvas.style.left = "0px", e.vjCanvas.style.zIndex = "5", e.vjCanvas.style.msTouchAction = "none", e.vjCanvasContext = e.vjCanvas.getContext("2d"), e.vjCanvasContext.strokeStyle = "#ffffff", e.vjCanvasContext.lineWidth = 2, document.body.appendChild(e.vjCanvas)), e.halfWidth = e.vjCanvas.width / 2, e.halfHeight = e.vjCanvas.height / 2, this.pressed = !1, this._joystickColor = "cyan", this._joystickPointerID = -1, this._joystickPointerPos = new t.Vector2(0, 0), this._joystickPointerStartPos = new t.Vector2(0, 0), this._deltaJoystickVector = new t.Vector2(0, 0), e.vjCanvas.addEventListener("pointerdown", function(t) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          i._onPointerDown(t)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          }, !1), e.vjCanvas.addEventListener("pointermove", function(t) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              i._onPointerMove(t)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              }, !1), e.vjCanvas.addEventListener("pointerup", function(t) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  i._onPointerUp(t)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  }, !1), e.vjCanvas.addEventListener("pointerout", function(t) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      i._onPointerUp(t)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      }, !1), e.vjCanvas.addEventListener("contextmenu", function(t) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          t.preventDefault()
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          }, !1), requestAnimationFrame(function() {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        i._drawVirtualJoystick()
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        })
             }
             return e.prototype.setJoystickSensibility = function(t) {
             this._joystickSensibility = t, this._inversedSensibility = 1 / (this._joystickSensibility / 1e3)
             }, e.prototype._onPointerDown = function(t) {
             var n;
             t.preventDefault(), n = this._leftJoystick === !0 ? t.clientX < e.halfWidth : t.clientX > e.halfWidth, n && this._joystickPointerID < 0 ? (this._joystickPointerID = t.pointerId, this._joystickPointerStartPos.x = t.clientX, this._joystickPointerStartPos.y = t.clientY, this._joystickPointerPos = this._joystickPointerStartPos.clone(), this._deltaJoystickVector.x = 0, this._deltaJoystickVector.y = 0, this.pressed = !0, this._touches.add(t.pointerId.toString(), t)) : e._globalJoystickIndex < 2 && this._action && (this._action(), this._touches.add(t.pointerId.toString(), t))
             }, e.prototype._onPointerMove = function(t) {
             if (this._joystickPointerID == t.pointerId) {
             this._joystickPointerPos.x = t.clientX, this._joystickPointerPos.y = t.clientY, this._deltaJoystickVector = this._joystickPointerPos.clone(), this._deltaJoystickVector = this._deltaJoystickVector.subtract(this._joystickPointerStartPos);
             var e = this.reverseLeftRight ? -1 : 1, n = e * this._deltaJoystickVector.x / this._inversedSensibility;
             switch (this._axisTargetedByLeftAndRight) {
             case 0:
             this.deltaPosition.x = Math.min(1, Math.max(-1, n));
             break;
             case 1:
             this.deltaPosition.y = Math.min(1, Math.max(-1, n));
             break;
             case 2:
             this.deltaPosition.z = Math.min(1, Math.max(-1, n))
             }
             var i = this.reverseUpDown ? 1 : -1, o = i * this._deltaJoystickVector.y / this._inversedSensibility;
             switch (this._axisTargetedByUpAndDown) {
             case 0:
             this.deltaPosition.x = Math.min(1, Math.max(-1, o));
             break;
             case 1:
             this.deltaPosition.y = Math.min(1, Math.max(-1, o));
             break;
             case 2:
             this.deltaPosition.z = Math.min(1, Math.max(-1, o))
             }
             } else
             this._touches.item(t.pointerId.toString()) && (this._touches.item(t.pointerId.toString()).x = t.clientX, this._touches.item(t.pointerId.toString()).y = t.clientY)
             }, e.prototype._onPointerUp = function(t) {
             this._clearCanvas(), this._joystickPointerID == t.pointerId && (this._joystickPointerID = -1, this.pressed = !1), this._deltaJoystickVector.x = 0, this._deltaJoystickVector.y = 0, this._touches.remove(t.pointerId.toString())
             }, e.prototype.setJoystickColor = function(t) {
             this._joystickColor = t
             }, e.prototype.setActionOnTouch = function(t) {
             this._action = t
             }, e.prototype.setAxisForLeftRight = function(t) {
             switch (t) {
             case 0:
             case 1:
             case 2:
             this._axisTargetedByLeftAndRight = t;
             break;
             default:
             this._axisTargetedByLeftAndRight = 0
             }
             }, e.prototype.setAxisForUpDown = function(t) {
             switch (t) {
             case 0:
             case 1:
             case 2:
             this._axisTargetedByUpAndDown = t;
             break;
             default:
             this._axisTargetedByUpAndDown = 1
             }
             }, e.prototype._clearCanvas = function() {
             this._leftJoystick ? e.vjCanvasContext.clearRect(0, 0, e.vjCanvasWidth / 2, e.vjCanvasHeight) : e.vjCanvasContext.clearRect(e.vjCanvasWidth / 2, 0, e.vjCanvasWidth, e.vjCanvasHeight)
             }, e.prototype._drawVirtualJoystick = function() {
             var t = this;
             this.pressed && (this._clearCanvas(), this._touches.forEach(function(n) {
                                                                         n.pointerId === t._joystickPointerID ? (e.vjCanvasContext.beginPath(), e.vjCanvasContext.strokeStyle = t._joystickColor, e.vjCanvasContext.lineWidth = 6, e.vjCanvasContext.arc(t._joystickPointerStartPos.x, t._joystickPointerStartPos.y, 40, 0, 2 * Math.PI, !0), e.vjCanvasContext.stroke(), e.vjCanvasContext.beginPath(), e.vjCanvasContext.strokeStyle = t._joystickColor, e.vjCanvasContext.lineWidth = 2, e.vjCanvasContext.arc(t._joystickPointerStartPos.x, t._joystickPointerStartPos.y, 60, 0, 2 * Math.PI, !0), e.vjCanvasContext.stroke(), e.vjCanvasContext.beginPath(), e.vjCanvasContext.strokeStyle = t._joystickColor, e.vjCanvasContext.arc(t._joystickPointerPos.x, t._joystickPointerPos.y, 40, 0, 2 * Math.PI, !0), e.vjCanvasContext.stroke()) : (e.vjCanvasContext.beginPath(), e.vjCanvasContext.fillStyle = "white", e.vjCanvasContext.beginPath(), e.vjCanvasContext.strokeStyle = "red", e.vjCanvasContext.lineWidth = 6, e.vjCanvasContext.arc(n.x, n.y, 40, 0, 2 * Math.PI, !0), e.vjCanvasContext.stroke())
                                                                         })), requestAnimationFrame(function() {
                                                                                                    t._drawVirtualJoystick()
                                                                                                    })
             }, e.prototype.releaseCanvas = function() {
             e.vjCanvas && (document.body.removeChild(e.vjCanvas), e.vjCanvas = null)
             }, e._globalJoystickIndex = 0, e
             }());
    t.VirtualJoystick = e
}(BABYLON || (BABYLON = {}));
var BABYLON;
!function(t) {
    !function(t) {
        var e = function() {
            function t() {
                this._count = 0, this._collection = new Array
            }
            return t.prototype.Count = function() {
                return this._count
            }, t.prototype.add = function(t, e) {
                return void 0 != this._collection[t] ? void 0 : (this._collection[t] = e, ++this._count)
            }, t.prototype.remove = function(t) {
                return void 0 == this._collection[t] ? void 0 : (delete this._collection[t], --this._count)
            }, t.prototype.item = function(t) {
                return this._collection[t]
            }, t.prototype.forEach = function(t) {
                var e;
                for (e in this._collection)
                    this._collection.hasOwnProperty(e) && t(this._collection[e])
                    }, t
        }();
        t.Collection = e
    }(t.VirtualJoystick || (t.VirtualJoystick = {}));
    t.VirtualJoystick
}(BABYLON || (BABYLON = {}));
var __extends = this.__extends || function(t, e) {
    function n() {
        this.constructor = t
    }
    for (var i in e)
        e.hasOwnProperty(i) && (t[i] = e[i]);
    n.prototype = e.prototype, t.prototype = new n
}, BABYLON;
!function(t) {
    var e = {HResolution: 1280,VResolution: 800,HScreenSize: .149759993,VScreenSize: .0935999975,VScreenCenter: .0467999987,EyeToScreenDistance: .0410000011,LensSeparationDistance: .063500002,InterpupillaryDistance: .064000003,DistortionK: [1, .219999999, .239999995, 0],ChromaAbCorrection: [.995999992, -.00400000019, 1.01400006, 0],PostProcessScaleFactor: 1.714605507808412,LensCenterOffset: .151976421}, n = function(n) {
        function i(i, o, r, s) {
            n.call(this, i, o, r), this._workMatrix = new t.Matrix, this._actualUp = new t.Vector3(0, 0, 0), this._aspectRatioAspectRatio = e.HResolution / (2 * e.VResolution), this._aspectRatioFov = 2 * Math.atan(e.PostProcessScaleFactor * e.VScreenSize / (2 * e.EyeToScreenDistance));
            var a = e.HScreenSize / 4 - e.LensSeparationDistance / 2, l = 4 * a / e.HScreenSize;
            this._hMatrix = t.Matrix.Translation(s ? l : -l, 0, 0), this.viewport = new t.Viewport(s ? 0 : .5, 0, .5, 1), this._preViewMatrix = t.Matrix.Translation(s ? .5 * e.InterpupillaryDistance : -.5 * e.InterpupillaryDistance, 0, 0);
            new t.OculusDistortionCorrectionPostProcess("Oculus Distortion", this, !s, e)
        }
        return __extends(i, n), i.prototype.getProjectionMatrix = function() {
            return t.Matrix.PerspectiveFovLHToRef(this._aspectRatioFov, this._aspectRatioAspectRatio, this.minZ, this.maxZ, this._workMatrix), this._workMatrix.multiplyToRef(this._hMatrix, this._projectionMatrix), this._projectionMatrix
        }, i.prototype._getViewMatrix = function() {
            return t.Matrix.RotationYawPitchRollToRef(this.rotation.y, this.rotation.x, this.rotation.z, this._cameraRotationMatrix), t.Vector3.TransformCoordinatesToRef(this._referencePoint, this._cameraRotationMatrix, this._transformedReferencePoint), t.Vector3.TransformNormalToRef(this.upVector, this._cameraRotationMatrix, this._actualUp), this.position.addToRef(this._transformedReferencePoint, this._currentTarget), t.Matrix.LookAtLHToRef(this.position, this._currentTarget, this._actualUp, this._workMatrix), this._workMatrix.multiplyToRef(this._preViewMatrix, this._viewMatrix), this._viewMatrix
        }, i
    }(t.FreeCamera), i = function(t) {
        function e(e, i, o) {
            t.call(this, e, i, o), this._leftCamera = new n(e + "_left", i.clone(), o, !0), this._rightCamera = new n(e + "_right", i.clone(), o, !1), this.subCameras.push(this._leftCamera), this.subCameras.push(this._rightCamera), this._deviceOrientationHandler = this._onOrientationEvent.bind(this)
        }
        return __extends(e, t), e.prototype._update = function() {
            this._leftCamera.position.copyFrom(this.position), this._rightCamera.position.copyFrom(this.position), this._updateCamera(this._leftCamera), this._updateCamera(this._rightCamera), t.prototype._update.call(this)
        }, e.prototype._updateCamera = function(t) {
            t.minZ = this.minZ, t.maxZ = this.maxZ, t.rotation.x = this.rotation.x, t.rotation.y = this.rotation.y, t.rotation.z = this.rotation.z
        }, e.prototype._onOrientationEvent = function(t) {
            var e = t.alpha / 180 * Math.PI, n = t.beta / 180 * Math.PI, i = t.gamma / 180 * Math.PI;
            return this._offsetOrientation ? (this.rotation.y += e - this._offsetOrientation.yaw, this.rotation.x += n - this._offsetOrientation.pitch, this.rotation.z += this._offsetOrientation.roll - i, this._offsetOrientation.yaw = e, this._offsetOrientation.pitch = n, this._offsetOrientation.roll = i, void 0) : void (this._offsetOrientation = {yaw: e,pitch: n,roll: i})
        }, e.prototype.attachControl = function(e, n) {
            t.prototype.attachControl.call(this, e, n), window.addEventListener("deviceorientation", this._deviceOrientationHandler)
        }, e.prototype.detachControl = function(e) {
            t.prototype.detachControl.call(this, e), window.removeEventListener("deviceorientation", this._deviceOrientationHandler)
        }, e
    }(t.FreeCamera);
    t.OculusCamera = i
}(BABYLON || (BABYLON = {}));
var __extends = this.__extends || function(t, e) {
    function n() {
        this.constructor = t
    }
    for (var i in e)
        e.hasOwnProperty(i) && (t[i] = e[i]);
    n.prototype = e.prototype, t.prototype = new n
}, BABYLON;
!function(t) {
    var e = function(e) {
        function n(n, i, o) {
            e.call(this, n, i, o), this._leftjoystick = new t.VirtualJoystick(!0), this._leftjoystick.setAxisForUpDown(2), this._leftjoystick.setAxisForLeftRight(0), this._leftjoystick.setJoystickSensibility(.15), this._rightjoystick = new t.VirtualJoystick(!1), this._rightjoystick.setAxisForUpDown(0), this._rightjoystick.setAxisForLeftRight(1), this._rightjoystick.reverseUpDown = !0, this._rightjoystick.setJoystickSensibility(.05), this._rightjoystick.setJoystickColor("yellow")
        }
        return __extends(n, e), n.prototype._checkInputs = function() {
            var e = t.Matrix.RotationYawPitchRoll(this.rotation.y, this.rotation.x, 0), n = t.Vector3.TransformCoordinates(this._leftjoystick.deltaPosition, e);
            this.cameraDirection = this.cameraDirection.add(n), this.cameraRotation = this.cameraRotation.add(this._rightjoystick.deltaPosition), this._leftjoystick.pressed || (this._leftjoystick.deltaPosition = this._leftjoystick.deltaPosition.scale(.9)), this._rightjoystick.pressed || (this._rightjoystick.deltaPosition = this._rightjoystick.deltaPosition.scale(.9))
        }, n.prototype.dispose = function() {
            this._leftjoystick.releaseCanvas()
        }, n
    }(t.FreeCamera);
    t.VirtualJoysticksCamera = e
}(BABYLON || (BABYLON = {}));
var __extends = this.__extends || function(t, e) {
    function n() {
        this.constructor = t
    }
    for (var i in e)
        e.hasOwnProperty(i) && (t[i] = e[i]);
    n.prototype = e.prototype, t.prototype = new n
}, BABYLON;
!function(t) {
    var e = function(e) {
        function n(n, i, o, r) {
            e.call(this, n, i), this._textures = new Array, this._floats = new Array, this._floatsArrays = {}, this._colors3 = new Array, this._colors4 = new Array, this._vectors2 = new Array, this._vectors3 = new Array, this._matrices = new Array, this._cachedWorldViewMatrix = new t.Matrix, this._shaderPath = o, r.needAlphaBlending = r.needAlphaBlending || !1, r.needAlphaTesting = r.needAlphaTesting || !1, r.attributes = r.attributes || ["position", "normal", "uv"], r.uniforms = r.uniforms || ["worldViewProjection"], r.samplers = r.samplers || [], this._options = r
        }
        return __extends(n, e), n.prototype.needAlphaBlending = function() {
            return this._options.needAlphaBlending
        }, n.prototype.needAlphaTesting = function() {
            return this._options.needAlphaTesting
        }, n.prototype._checkUniform = function(t) {
            -1 === this._options.uniforms.indexOf(t) && this._options.uniforms.push(t)
        }, n.prototype.setTexture = function(t, e) {
            return -1 === this._options.samplers.indexOf(t) && this._options.samplers.push(t), this._textures[t] = e, this
        }, n.prototype.setFloat = function(t, e) {
            return this._checkUniform(t), this._floats[t] = e, this
        }, n.prototype.setFloats = function(t, e) {
            return this._checkUniform(t), this._floatsArrays[t] = e, this
        }, n.prototype.setColor3 = function(t, e) {
            return this._checkUniform(t), this._colors3[t] = e, this
        }, n.prototype.setColor4 = function(t, e) {
            return this._checkUniform(t), this._colors4[t] = e, this
        }, n.prototype.setVector2 = function(t, e) {
            return this._checkUniform(t), this._vectors2[t] = e, this
        }, n.prototype.setVector3 = function(t, e) {
            return this._checkUniform(t), this._vectors3[t] = e, this
        }, n.prototype.setMatrix = function(t, e) {
            return this._checkUniform(t), this._matrices[t] = e, this
        }, n.prototype.isReady = function() {
            var t = this.getScene().getEngine();
            return this._effect = t.createEffect(this._shaderPath, this._options.attributes, this._options.uniforms, this._options.samplers, "", null, this.onCompiled, this.onError), this._effect.isReady() ? !0 : !1
        }, n.prototype.bind = function(t) {
            -1 !== this._options.uniforms.indexOf("world") && this._effect.setMatrix("world", t), -1 !== this._options.uniforms.indexOf("view") && this._effect.setMatrix("view", this.getScene().getViewMatrix()), -1 !== this._options.uniforms.indexOf("worldView") && (t.multiplyToRef(this.getScene().getViewMatrix(), this._cachedWorldViewMatrix), this._effect.setMatrix("worldView", this._cachedWorldViewMatrix)), -1 !== this._options.uniforms.indexOf("projection") && this._effect.setMatrix("projection", this.getScene().getProjectionMatrix()), -1 !== this._options.uniforms.indexOf("worldViewProjection") && this._effect.setMatrix("worldViewProjection", t.multiply(this.getScene().getTransformMatrix()));
            for (var e in this._textures)
                this._effect.setTexture(e, this._textures[e]);
            for (e in this._floats)
                this._effect.setFloat(e, this._floats[e]);
            for (e in this._floatsArrays)
                this._effect.setArray(e, this._floatsArrays[e]);
            for (e in this._colors3)
                this._effect.setColor3(e, this._colors3[e]);
            for (e in this._colors4) {
                var n = this._colors4[e];
                this._effect.setFloat4(e, n.r, n.g, n.b, n.a)
            }
            for (e in this._vectors2)
                this._effect.setVector2(e, this._vectors2[e]);
            for (e in this._vectors3)
                this._effect.setVector3(e, this._vectors3[e]);
            for (e in this._matrices)
                this._effect.setMatrix(e, this._matrices[e])
                }, n.prototype.dispose = function(t) {
                    for (var n in this._textures)
                        this._textures[n].dispose();
                    this._textures = [], e.prototype.dispose.call(this, t)
                }, n
    }(t.Material);
    t.ShaderMaterial = e
}(BABYLON || (BABYLON = {}));
var BABYLON;
!function(t) {
    var e = function() {
        function e() {
        }
        return e.prototype.set = function(e, n) {
            switch (n) {
                case t.VertexBuffer.PositionKind:
                    this.positions = e;
                    break;
                case t.VertexBuffer.NormalKind:
                    this.normals = e;
                    break;
                case t.VertexBuffer.UVKind:
                    this.uvs = e;
                    break;
                case t.VertexBuffer.UV2Kind:
                    this.uv2s = e;
                    break;
                case t.VertexBuffer.ColorKind:
                    this.colors = e;
                    break;
                case t.VertexBuffer.MatricesIndicesKind:
                    this.matricesIndices = e;
                    break;
                case t.VertexBuffer.MatricesWeightsKind:
                    this.matricesWeights = e
            }
        }, e.prototype.applyToMesh = function(t, e) {
            this._applyTo(t, e)
        }, e.prototype.applyToGeometry = function(t, e) {
            this._applyTo(t, e)
        }, e.prototype.updateMesh = function(t) {
            this._update(t)
        }, e.prototype.updateGeometry = function(t) {
            this._update(t)
        }, e.prototype._applyTo = function(e, n) {
            this.positions && e.setVerticesData(t.VertexBuffer.PositionKind, this.positions, n), this.normals && e.setVerticesData(t.VertexBuffer.NormalKind, this.normals, n), this.uvs && e.setVerticesData(t.VertexBuffer.UVKind, this.uvs, n), this.uv2s && e.setVerticesData(t.VertexBuffer.UV2Kind, this.uv2s, n), this.colors && e.setVerticesData(t.VertexBuffer.ColorKind, this.colors, n), this.matricesIndices && e.setVerticesData(t.VertexBuffer.MatricesIndicesKind, this.matricesIndices, n), this.matricesWeights && e.setVerticesData(t.VertexBuffer.MatricesWeightsKind, this.matricesWeights, n), this.indices && e.setIndices(this.indices)
        }, e.prototype._update = function(e, n, i) {
            this.positions && e.updateVerticesData(t.VertexBuffer.PositionKind, this.positions, n, i), this.normals && e.updateVerticesData(t.VertexBuffer.NormalKind, this.normals, n, i), this.uvs && e.updateVerticesData(t.VertexBuffer.UVKind, this.uvs, n, i), this.uv2s && e.updateVerticesData(t.VertexBuffer.UV2Kind, this.uv2s, n, i), this.colors && e.updateVerticesData(t.VertexBuffer.ColorKind, this.colors, n, i), this.matricesIndices && e.updateVerticesData(t.VertexBuffer.MatricesIndicesKind, this.matricesIndices, n, i), this.matricesWeights && e.updateVerticesData(t.VertexBuffer.MatricesWeightsKind, this.matricesWeights, n, i), this.indices && e.setIndices(this.indices)
        }, e.prototype.transform = function(e) {
            var n = t.Vector3.Zero();
            if (this.positions)
                for (var i = t.Vector3.Zero(), o = 0; o < this.positions.length; o += 3)
                    t.Vector3.FromArrayToRef(this.positions, o, i), t.Vector3.TransformCoordinatesToRef(i, e, n), this.positions[o] = n.x, this.positions[o + 1] = n.y, this.positions[o + 2] = n.z;
            if (this.normals) {
                var r = t.Vector3.Zero();
                for (o = 0; o < this.normals.length; o += 3)
                    t.Vector3.FromArrayToRef(this.normals, o, r), t.Vector3.TransformNormalToRef(r, e, n), this.normals[o] = n.x, this.normals[o + 1] = n.y, this.normals[o + 2] = n.z
                    }
        }, e.prototype.merge = function(t) {
            if (t.indices) {
                this.indices || (this.indices = []);
                for (var e = this.positions ? this.positions.length / 3 : 0, n = 0; n < t.indices.length; n++)
                    this.indices.push(t.indices[n] + e)
                    }
            if (t.positions)
                for (this.positions || (this.positions = []), n = 0; n < t.positions.length; n++)
                    this.positions.push(t.positions[n]);
            if (t.normals)
                for (this.normals || (this.normals = []), n = 0; n < t.normals.length; n++)
                    this.normals.push(t.normals[n]);
            if (t.uvs)
                for (this.uvs || (this.uvs = []), n = 0; n < t.uvs.length; n++)
                    this.uvs.push(t.uvs[n]);
            if (t.uv2s)
                for (this.uv2s || (this.uv2s = []), n = 0; n < t.uv2s.length; n++)
                    this.uv2s.push(t.uv2s[n]);
            if (t.matricesIndices)
                for (this.matricesIndices || (this.matricesIndices = []), n = 0; n < t.matricesIndices.length; n++)
                    this.matricesIndices.push(t.matricesIndices[n]);
            if (t.matricesWeights)
                for (this.matricesWeights || (this.matricesWeights = []), n = 0; n < t.matricesWeights.length; n++)
                    this.matricesWeights.push(t.matricesWeights[n]);
            if (t.colors)
                for (this.colors || (this.colors = []), n = 0; n < t.colors.length; n++)
                    this.colors.push(t.colors[n])
                    }, e.ExtractFromMesh = function(t) {
                        return e._ExtractFrom(t)
                    }, e.ExtractFromGeometry = function(t) {
                        return e._ExtractFrom(t)
                    }, e._ExtractFrom = function(e) {
                        var n = new t.VertexData;
                        return e.isVerticesDataPresent(t.VertexBuffer.PositionKind) && (n.positions = e.getVerticesData(t.VertexBuffer.PositionKind)), e.isVerticesDataPresent(t.VertexBuffer.NormalKind) && (n.normals = e.getVerticesData(t.VertexBuffer.NormalKind)), e.isVerticesDataPresent(t.VertexBuffer.UVKind) && (n.uvs = e.getVerticesData(t.VertexBuffer.UVKind)), e.isVerticesDataPresent(t.VertexBuffer.UV2Kind) && (n.uv2s = e.getVerticesData(t.VertexBuffer.UV2Kind)), e.isVerticesDataPresent(t.VertexBuffer.ColorKind) && (n.colors = e.getVerticesData(t.VertexBuffer.ColorKind)), e.isVerticesDataPresent(t.VertexBuffer.MatricesIndicesKind) && (n.matricesIndices = e.getVerticesData(t.VertexBuffer.MatricesIndicesKind)), e.isVerticesDataPresent(t.VertexBuffer.MatricesWeightsKind) && (n.matricesWeights = e.getVerticesData(t.VertexBuffer.MatricesWeightsKind)), n.indices = e.getIndices(), n
                    }, e.CreateBox = function(e) {
                        var n = [new t.Vector3(0, 0, 1), new t.Vector3(0, 0, -1), new t.Vector3(1, 0, 0), new t.Vector3(-1, 0, 0), new t.Vector3(0, 1, 0), new t.Vector3(0, -1, 0)], i = [], o = [], r = [], s = [];
                        e = e || 1;
                        for (var a = 0; a < n.length; a++) {
                            var l = n[a], h = new t.Vector3(l.y, l.z, l.x), c = t.Vector3.Cross(l, h), u = o.length / 3;
                            i.push(u), i.push(u + 1), i.push(u + 2), i.push(u), i.push(u + 2), i.push(u + 3);
                            var p = l.subtract(h).subtract(c).scale(e / 2);
                            o.push(p.x, p.y, p.z), r.push(l.x, l.y, l.z), s.push(1, 1), p = l.subtract(h).add(c).scale(e / 2), o.push(p.x, p.y, p.z), r.push(l.x, l.y, l.z), s.push(0, 1), p = l.add(h).add(c).scale(e / 2), o.push(p.x, p.y, p.z), r.push(l.x, l.y, l.z), s.push(0, 0), p = l.add(h).subtract(c).scale(e / 2), o.push(p.x, p.y, p.z), r.push(l.x, l.y, l.z), s.push(1, 0)
                        }
                        var d = new t.VertexData;
                        return d.indices = i, d.positions = o, d.normals = r, d.uvs = s, d
                    }, e.CreateSphere = function(e, n) {
                        e = e || 32, n = n || 1;
                        for (var i = n / 2, o = 2 + e, r = 2 * o, s = [], a = [], l = [], h = [], c = 0; o >= c; c++) {
                            for (var u = c / o, p = u * Math.PI, d = 0; r >= d; d++) {
                                var m = d / r, g = m * Math.PI * 2, f = t.Matrix.RotationZ(-p), y = t.Matrix.RotationY(g), _ = t.Vector3.TransformCoordinates(t.Vector3.Up(), f), v = t.Vector3.TransformCoordinates(_, y), b = v.scale(i), w = t.Vector3.Normalize(b);
                                a.push(b.x, b.y, b.z), l.push(w.x, w.y, w.z), h.push(m, 1 - u)
                            }
                            if (c > 0)
                                for (var x = a.length / 3, C = x - 2 * (r + 1); x > C + r + 2; C++)
                                    s.push(C), s.push(C + 1), s.push(C + r + 1), s.push(C + r + 1), s.push(C + 1), s.push(C + r + 2)
                                    }
                        var M = new t.VertexData;
                        return M.indices = s, M.positions = a, M.normals = l, M.uvs = h, M
                    }, e.CreateCylinder = function(e, n, i, o, r, s) {
                        "undefined" == typeof r && (r = 1);
                        var a = i / 2, l = n / 2, h = [], c = [], u = [], p = [];
                        e = e || 1, i = i || .5, n = n || 1, o = o || 16, r = r || 1, r = 1 > r ? 1 : r;
                        for (var d = function(e) {
                             var n = 2 * e * Math.PI / o, i = Math.cos(n), r = Math.sin(n);
                             return new t.Vector3(i, 0, r)
                             }, m = function(n) {
                             var i = n ? a : l;
                             if (0 != i) {
                             var r = c.length / 3, s = new t.Vector3(0, e / 2, 0), u = new t.Vector2(.5, .5);
                             for (n || (s.scaleInPlace(-1), u.x = -u.x), y = 0; o > y; y++) {
                             var m = d(y), g = m.scale(i).add(s), f = new t.Vector2(m.x * u.x + .5, m.z * u.y + .5);
                             c.push(g.x, g.y, g.z), p.push(f.x, f.y)
                             }
                             for (var y = 0; o - 2 > y; y++)
                             n ? (h.push(r), h.push(r + (y + 1) % o), h.push(r + (y + 2) % o)) : (h.push(r), h.push(r + (y + 2) % o), h.push(r + (y + 1) % o))
                             }
                             }, g = new t.Vector3(0, -1, 0).scale(e / 2), f = new t.Vector3(0, 1, 0).scale(e / r), y = o + 1, _ = 0; o >= _; _++)
                            for (var v, b = d(_), w = new t.Vector2(_ / o, 0), x = l, C = 0; r >= C; C++)
                                v = b.scale(x), v.addInPlace(g.add(f.scale(C))), w.y += 1 / r, x += (a - l) / r, c.push(v.x, v.y, v.z), p.push(w.x, w.y);
                        r += 1;
                        for (var C = 0; r - 1 > C; C++)
                            for (var _ = 0; o >= _; _++)
                                h.push(_ * r + C), h.push((_ * r + (C + r)) % (y * r)), h.push(_ * r + (C + 1)), h.push(_ * r + (C + 1)), h.push((_ * r + (C + r)) % (y * r)), h.push((_ * r + (C + r + 1)) % (y * r));
                        s && (m(!0), m(!1)), t.VertexData.ComputeNormals(c, h, u);
                        var M = new t.VertexData;
                        return M.indices = h, M.positions = c, M.normals = u, M.uvs = p, M
                    }, e.CreateTorus = function(e, n, i) {
                        var o = [], r = [], s = [], a = [];
                        e = e || 1, n = n || .5, i = i || 16;
                        for (var l = i + 1, h = 0; i >= h; h++)
                            for (var c = h / i, u = h * Math.PI * 2 / i - Math.PI / 2, p = t.Matrix.Translation(e / 2, 0, 0).multiply(t.Matrix.RotationY(u)), d = 0; i >= d; d++) {
                                var m = 1 - d / i, g = d * Math.PI * 2 / i + Math.PI, f = Math.cos(g), y = Math.sin(g), _ = new t.Vector3(f, y, 0), v = _.scale(n / 2), b = new t.Vector2(c, m);
                                v = t.Vector3.TransformCoordinates(v, p), _ = t.Vector3.TransformNormal(_, p), r.push(v.x, v.y, v.z), s.push(_.x, _.y, _.z), a.push(b.x, b.y);
                                var w = (h + 1) % l, x = (d + 1) % l;
                                o.push(h * l + d), o.push(h * l + x), o.push(w * l + d), o.push(h * l + x), o.push(w * l + x), o.push(w * l + d)
                            }
                        var C = new t.VertexData;
                        return C.indices = o, C.positions = r, C.normals = s, C.uvs = a, C
                    }, e.CreateLines = function(e) {
                        for (var n = [], i = [], o = 0; o < e.length; o++)
                            i.push(e[o].x, e[o].y, e[o].z), o > 0 && (n.push(o - 1), n.push(o));
                        var r = new t.VertexData;
                        return r.indices = n, r.positions = i, r
                    }, e.CreateGround = function(e, n, i) {
                        var o, r, s = [], a = [], l = [], h = [];
                        for (e = e || 1, n = n || 1, i = i || 1, o = 0; i >= o; o++)
                            for (r = 0; i >= r; r++) {
                                var c = new t.Vector3(r * e / i - e / 2, 0, (i - o) * n / i - n / 2), u = new t.Vector3(0, 1, 0);
                                a.push(c.x, c.y, c.z), l.push(u.x, u.y, u.z), h.push(r / i, 1 - o / i)
                            }
                        for (o = 0; i > o; o++)
                            for (r = 0; i > r; r++)
                                s.push(r + 1 + (o + 1) * (i + 1)), s.push(r + 1 + o * (i + 1)), s.push(r + o * (i + 1)), s.push(r + (o + 1) * (i + 1)), s.push(r + 1 + (o + 1) * (i + 1)), s.push(r + o * (i + 1));
                        var p = new t.VertexData;
                        return p.indices = s, p.positions = a, p.normals = l, p.uvs = h, p
                    }, e.CreateTiledGround = function(e, n, i, o, r, s) {
                        function a(e, n, i, o) {
                            var r = d.length / 3, a = s.w + 1;
                            for (l = 0; l < s.h; l++)
                                for (h = 0; h < s.w; h++) {
                                    var c = [r + h + l * a, r + (h + 1) + l * a, r + (h + 1) + (l + 1) * a, r + h + (l + 1) * a];
                                    p.push(c[1]), p.push(c[2]), p.push(c[3]), p.push(c[0]), p.push(c[1]), p.push(c[3])
                                }
                            var u = t.Vector3.Zero(), f = new t.Vector3(0, 1, 0);
                            for (l = 0; l <= s.h; l++)
                                for (u.z = l * (o - n) / s.h + n, h = 0; h <= s.w; h++)
                                    u.x = h * (i - e) / s.w + e, u.y = 0, d.push(u.x, u.y, u.z), m.push(f.x, f.y, f.z), g.push(h / s.w, l / s.h)
                                    }
                        "undefined" == typeof r && (r = {w: 1,h: 1}), "undefined" == typeof s && (s = {w: 1,h: 1});
                        var l, h, c, u, p = [], d = [], m = [], g = [];
                        r.h = r.w < 1 ? 1 : r.h, r.w = r.w < 1 ? 1 : r.w, s.w = s.w < 1 ? 1 : s.w, s.h = s.h < 1 ? 1 : s.h;
                        var f = {w: (i - e) / r.w,h: (o - n) / r.h};
                        for (c = 0; c < r.h; c++)
                            for (u = 0; u < r.w; u++)
                                a(e + u * f.w, n + c * f.h, e + (u + 1) * f.w, n + (c + 1) * f.h);
                        var y = new t.VertexData;
                        return y.indices = p, y.positions = d, y.normals = m, y.uvs = g, y
                    }, e.CreateGroundFromHeightMap = function(e, n, i, o, r, s, a, l) {
                        var h, c, u = [], p = [], d = [], m = [];
                        for (h = 0; i >= h; h++)
                            for (c = 0; i >= c; c++) {
                                var g = new t.Vector3(c * e / i - e / 2, 0, (i - h) * n / i - n / 2), f = (g.x + e / 2) / e * (a - 1) | 0, y = (1 - (g.z + n / 2) / n) * (l - 1) | 0, _ = 4 * (f + y * a), v = s[_] / 255, b = s[_ + 1] / 255, w = s[_ + 2] / 255, x = .3 * v + .59 * b + .11 * w;
                                g.y = o + (r - o) * x, p.push(g.x, g.y, g.z), d.push(0, 0, 0), m.push(c / i, 1 - h / i)
                            }
                        for (h = 0; i > h; h++)
                            for (c = 0; i > c; c++)
                                u.push(c + 1 + (h + 1) * (i + 1)), u.push(c + 1 + h * (i + 1)), u.push(c + h * (i + 1)), u.push(c + (h + 1) * (i + 1)), u.push(c + 1 + (h + 1) * (i + 1)), u.push(c + h * (i + 1));
                        t.VertexData.ComputeNormals(p, u, d);
                        var C = new t.VertexData;
                        return C.indices = u, C.positions = p, C.normals = d, C.uvs = m, C
                    }, e.CreatePlane = function(e) {
                        var n = [], i = [], o = [], r = [];
                        e = e || 1;
                        var s = e / 2;
                        i.push(-s, -s, 0), o.push(0, 0, -1), r.push(0, 0), i.push(s, -s, 0), o.push(0, 0, -1), r.push(1, 0), i.push(s, s, 0), o.push(0, 0, -1), r.push(1, 1), i.push(-s, s, 0), o.push(0, 0, -1), r.push(0, 1), n.push(0), n.push(1), n.push(2), n.push(0), n.push(2), n.push(3);
                        var a = new t.VertexData;
                        return a.indices = n, a.positions = i, a.normals = o, a.uvs = r, a
                    }, e.CreateTorusKnot = function(e, n, i, o, r, s) {
                        var a = [], l = [], h = [], c = [];
                        e = e || 2, n = n || .5, i = i || 32, o = o || 32, r = r || 2, s = s || 3;
                        for (var u = function(n) {
                             var i = Math.cos(n), o = Math.sin(n), a = s / r * n, l = Math.cos(a), h = e * (2 + l) * .5 * i, c = e * (2 + l) * o * .5, u = e * Math.sin(a) * .5;
                             return new t.Vector3(h, c, u)
                             }, p = 0; i >= p; p++) {
                            var d = p % i, m = d / i * 2 * r * Math.PI, g = u(m), f = u(m + .01), y = f.subtract(g), _ = f.add(g), v = t.Vector3.Cross(y, _);
                            _ = t.Vector3.Cross(v, y), v.normalize(), _.normalize();
                            for (var b = 0; o > b; b++) {
                                var w = b % o, x = w / o * 2 * Math.PI, C = -n * Math.cos(x), M = n * Math.sin(x);
                                l.push(g.x + C * _.x + M * v.x), l.push(g.y + C * _.y + M * v.y), l.push(g.z + C * _.z + M * v.z), c.push(p / i), c.push(b / o)
                            }
                        }
                        for (p = 0; i > p; p++)
                            for (b = 0; o > b; b++) {
                                var D = (b + 1) % o, B = p * o + b, A = (p + 1) * o + b, E = (p + 1) * o + D, T = p * o + D;
                                a.push(T), a.push(A), a.push(B), a.push(T), a.push(E), a.push(A)
                            }
                        t.VertexData.ComputeNormals(l, a, h);
                        var S = new t.VertexData;
                        return S.indices = a, S.positions = l, S.normals = h, S.uvs = c, S
                    }, e.ComputeNormals = function(e, n, i) {
                        var o, r = [], s = [];
                        for (o = 0; o < e.length; o += 3) {
                            var a = new t.Vector3(e[o], e[o + 1], e[o + 2]);
                            r.push(a), s.push([])
                        }
                        var l = [];
                        for (o = 0; o < n.length / 3; o++) {
                            var h = n[3 * o], c = n[3 * o + 1], u = n[3 * o + 2], p = r[h], d = r[c], m = r[u], g = p.subtract(d), f = m.subtract(d);
                            l[o] = t.Vector3.Normalize(t.Vector3.Cross(g, f)), s[h].push(o), s[c].push(o), s[u].push(o)
                        }
                        for (o = 0; o < r.length; o++) {
                            for (var y = s[o], _ = t.Vector3.Zero(), v = 0; v < y.length; v++)
                                _.addInPlace(l[y[v]]);
                            _ = t.Vector3.Normalize(_.scale(1 / y.length)), i[3 * o] = _.x, i[3 * o + 1] = _.y, i[3 * o + 2] = _.z
                        }
                    }, e
    }();
    t.VertexData = e
}(BABYLON || (BABYLON = {}));
var __extends = this.__extends || function(t, e) {
    function n() {
        this.constructor = t
    }
    for (var i in e)
        e.hasOwnProperty(i) && (t[i] = e[i]);
    n.prototype = e.prototype, t.prototype = new n
}, BABYLON;
!function(t) {
    var e = function(e, n) {
        e._leftCamera.isIntermediate = !0, e.subCameras.push(e._leftCamera), e.subCameras.push(e._rightCamera), e._leftTexture = new t.PassPostProcess(n + "_leftTexture", 1, e._leftCamera), e._anaglyphPostProcess = new t.AnaglyphPostProcess(n + "_anaglyph", 1, e._rightCamera), e._anaglyphPostProcess.onApply = function(t) {
            t.setTextureFromPostProcess("leftSampler", e._leftTexture)
        }, e._update()
    }, n = function(n) {
        function i(i, o, r, s, a, l, h) {
            n.call(this, i, o, r, s, a, h), this._eyeSpace = t.Tools.ToRadians(l), this._leftCamera = new t.ArcRotateCamera(i + "_left", o - this._eyeSpace, r, s, a, h), this._rightCamera = new t.ArcRotateCamera(i + "_right", o + this._eyeSpace, r, s, a, h), e(this, i)
        }
        return __extends(i, n), i.prototype._update = function() {
            this._updateCamera(this._leftCamera), this._updateCamera(this._rightCamera), this._leftCamera.alpha = this.alpha - this._eyeSpace, this._rightCamera.alpha = this.alpha + this._eyeSpace, n.prototype._update.call(this)
        }, i.prototype._updateCamera = function(t) {
            t.beta = this.beta, t.radius = this.radius, t.minZ = this.minZ, t.maxZ = this.maxZ, t.fov = this.fov, t.target = this.target
        }, i
    }(t.ArcRotateCamera);
    t.AnaglyphArcRotateCamera = n;
    var i = function(n) {
        function i(i, o, r, s) {
            n.call(this, i, o, s), this._eyeSpace = t.Tools.ToRadians(r), this._transformMatrix = new t.Matrix, this._leftCamera = new t.FreeCamera(i + "_left", o.clone(), s), this._rightCamera = new t.FreeCamera(i + "_right", o.clone(), s), e(this, i)
        }
        return __extends(i, n), i.prototype._getSubCameraPosition = function(e, n) {
            var i = this.getTarget();
            t.Matrix.Translation(-i.x, -i.y, -i.z).multiplyToRef(t.Matrix.RotationY(e), this._transformMatrix), this._transformMatrix = this._transformMatrix.multiply(t.Matrix.Translation(i.x, i.y, i.z)), t.Vector3.TransformCoordinatesToRef(this.position, this._transformMatrix, n)
        }, i.prototype._update = function() {
            this._getSubCameraPosition(-this._eyeSpace, this._leftCamera.position), this._getSubCameraPosition(this._eyeSpace, this._rightCamera.position), this._updateCamera(this._leftCamera), this._updateCamera(this._rightCamera), n.prototype._update.call(this)
        }, i.prototype._updateCamera = function(t) {
            t.minZ = this.minZ, t.maxZ = this.maxZ, t.fov = this.fov, t.viewport = this.viewport, t.setTarget(this.getTarget())
        }, i
    }(t.FreeCamera);
    t.AnaglyphFreeCamera = i
}(BABYLON || (BABYLON = {}));
var __extends = this.__extends || function(t, e) {
    function n() {
        this.constructor = t
    }
    for (var i in e)
        e.hasOwnProperty(i) && (t[i] = e[i]);
    n.prototype = e.prototype, t.prototype = new n
}, BABYLON;
!function(t) {
    var e = function(t) {
        function e(e, n, i, o, r, s) {
            t.call(this, e, "anaglyph", null, ["leftSampler"], n, i, o, r, s)
        }
        return __extends(e, t), e
    }(t.PostProcess);
    t.AnaglyphPostProcess = e
}(BABYLON || (BABYLON = {}));
var BABYLON;
!function(t) {
    var e = function() {
        function e() {
        }
        return e.EnableFor = function(t) {
            t._tags = t._tags || {}, t.hasTags = function() {
                return e.HasTags(t)
            }, t.addTags = function(n) {
                return e.AddTagsTo(t, n)
            }, t.removeTags = function(n) {
                return e.RemoveTagsFrom(t, n)
            }, t.matchesTagsQuery = function(n) {
                return e.MatchesQuery(t, n)
            }
        }, e.DisableFor = function(t) {
            delete t._tags, delete t.hasTags, delete t.addTags, delete t.removeTags, delete t.matchesTagsQuery
        }, e.HasTags = function(e) {
            return e._tags ? !t.Tools.IsEmpty(e._tags) : !1
        }, e.GetTags = function(t) {
            return t._tags ? t._tags : null
        }, e.AddTagsTo = function(t, n) {
            if (n) {
                var i = n.split(" ");
                for (var o in i)
                    e._AddTagTo(t, i[o])
                    }
        }, e._AddTagTo = function(t, n) {
            n = n.trim(), "" !== n && "true" !== n && "false" !== n && (n.match(/[\s]/) || n.match(/^([!]|([|]|[&]){2})/) || (e.EnableFor(t), t._tags[n] = !0))
        }, e.RemoveTagsFrom = function(t, n) {
            if (e.HasTags(t)) {
                var i = n.split(" ");
                for (var o in i)
                    e._RemoveTagFrom(t, i[o])
                    }
        }, e._RemoveTagFrom = function(t, e) {
            delete t._tags[e]
        }, e.MatchesQuery = function(n, i) {
            return void 0 === i ? !0 : "" === i ? e.HasTags(n) : t.Internals.AndOrNotEvaluator.Eval(i, function(t) {
                                                                                                    return e.HasTags(n) && n._tags[t]
                                                                                                    })
        }, e
    }();
    t.Tags = e
}(BABYLON || (BABYLON = {}));
var BABYLON;
!function(t) {
    !function(t) {
        var e = function() {
            function t() {
            }
            return t.Eval = function(e, n) {
                return e = e.match(/\([^\(\)]*\)/g) ? e.replace(/\([^\(\)]*\)/g, function(e) {
                                                                return e = e.slice(1, e.length - 1), t._HandleParenthesisContent(e, n)
                                                                }) : t._HandleParenthesisContent(e, n), "true" === e ? !0 : "false" === e ? !1 : t.Eval(e, n)
            }, t._HandleParenthesisContent = function(e, n) {
                n = n || function(t) {
                    return "true" === t ? !0 : !1
                };
                var i, o = e.split("||");
                for (var r in o) {
                    var s = t._SimplifyNegation(o[r].trim()), a = s.split("&&");
                    if (a.length > 1)
                        for (var l = 0; l < a.length; ++l) {
                            var h = t._SimplifyNegation(a[l].trim());
                            if (i = "true" !== h && "false" !== h ? "!" === h[0] ? !n(h.substring(1)) : n(h) : "true" === h ? !0 : !1, !i) {
                                s = "false";
                                break
                            }
                        }
                    if (i || "true" === s) {
                        i = !0;
                        break
                    }
                    i = "true" !== s && "false" !== s ? "!" === s[0] ? !n(s.substring(1)) : n(s) : "true" === s ? !0 : !1
                }
                return i ? "true" : "false"
            }, t._SimplifyNegation = function(t) {
                return t = t.replace(/^[\s!]+/, function(t) {
                                     return t = t.replace(/[\s]/g, function() {
                                                          return ""
                                                          }), t.length % 2 ? "!" : ""
                                     }), t = t.trim(), "!true" === t ? t = "false" : "!false" === t && (t = "true"), t
            }, t
        }();
        t.AndOrNotEvaluator = e
    }(t.Internals || (t.Internals = {}));
    t.Internals
}(BABYLON || (BABYLON = {}));
var BABYLON;
!function(t) {
    var e = function() {
        function e(e, n, i, o, r, s) {
            this._enabled = !0, this._refCount = 0, this._name = n, this._renderTexture = new t.RenderTargetTexture(n, i, e), this.setRenderList(o), this._renderTexture.onBeforeRender = r, this._renderTexture.onAfterRender = s, this._scene = e
        }
        return e.prototype._incRefCount = function() {
            return 0 === this._refCount && this._scene.customRenderTargets.push(this._renderTexture), ++this._refCount
        }, e.prototype._decRefCount = function() {
            return this._refCount--, this._refCount <= 0 && this._scene.customRenderTargets.splice(this._scene.customRenderTargets.indexOf(this._renderTexture), 1), this._refCount
        }, e.prototype._update = function() {
            this.setRenderList(this._renderList)
        }, e.prototype.setRenderList = function(t) {
            this._renderTexture.renderList = t
        }, e.prototype.getRenderTexture = function() {
            return this._renderTexture
        }, e
    }();
    t.PostProcessRenderPass = e
}(BABYLON || (BABYLON = {}));
var BABYLON;
!function(t) {
    var e = function() {
        function e(t, e, n, i, o, r) {
            this._engine = t, this._name = e, this._postProcessType = n, this._ratio = i || 1, this._samplingMode = o || null, this._singleInstance = r || !0, this._cameras = [], this._postProcesses = [], this._indicesForCamera = [], this._renderPasses = [], this._renderEffectAsPasses = [], this.parameters = function() {
            }
        }
        return e._GetInstance = function(t, n, i, o) {
            for (var r, s, a = [], l = e._GetParametersNames(n), h = 0; h < l.length; h++)
                switch (l[h]) {
                    case "name":
                        a[h] = n.toString();
                        break;
                    case "ratio":
                        a[h] = i;
                        break;
                    case "camera":
                        a[h] = null;
                        break;
                    case "samplingMode":
                        a[h] = o;
                        break;
                    case "engine":
                        a[h] = t;
                        break;
                    case "reusable":
                        a[h] = !0;
                        break;
                    default:
                        a[h] = null
                }
            return r = function() {
            }, r.prototype = n.prototype, s = new r, n.apply(s, a), s
        }, e._GetParametersNames = function(t) {
            var e = /((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm, n = t.toString().replace(e, ""), i = n.slice(n.indexOf("(") + 1, n.indexOf(")")).match(/([^\s,]+)/g);
            return null === i && (i = []), i
        }, e.prototype._update = function() {
            for (var t in this._renderPasses)
                this._renderPasses[t]._update()
                }, e.prototype.addPass = function(t) {
                    this._renderPasses[t._name] = t, this._linkParameters()
                }, e.prototype.removePass = function(t) {
                    delete this._renderPasses[t._name], this._linkParameters()
                }, e.prototype.addRenderEffectAsPass = function(t) {
                    this._renderEffectAsPasses[t._name] = t, this._linkParameters()
                }, e.prototype.getPass = function(t) {
                    for (var e in this._renderPasses)
                        if (e === t)
                            return this._renderPasses[t]
                            }, e.prototype.emptyPasses = function() {
                                this._renderPasses.length = 0, this._linkParameters()
                            }, e.prototype._attachCameras = function(n) {
                                for (var i, o = t.Tools.MakeArray(n || this._cameras), r = 0; r < o.length; r++) {
                                    var s = o[r], a = s.name;
                                    i = this._singleInstance ? 0 : a, this._postProcesses[i] = this._postProcesses[i] || e._GetInstance(this._engine, this._postProcessType, this._ratio, this._samplingMode);
                                    var l = s.attachPostProcess(this._postProcesses[i]);
                                    null === this._indicesForCamera[a] && (this._indicesForCamera[a] = []), this._indicesForCamera[a].push(l), -1 === this._cameras.indexOf(s) && (this._cameras[a] = s);
                                    for (var h in this._renderPasses)
                                        this._renderPasses[h]._incRefCount()
                                        }
                                this._linkParameters()
                            }, e.prototype._detachCameras = function(e) {
                                for (var n = t.Tools.MakeArray(e || this._cameras), i = 0; i < n.length; i++) {
                                    var o = n[i], r = o.name;
                                    o.detachPostProcess(this._postProcesses[this._singleInstance ? 0 : r], this._indicesForCamera[r]);
                                    var s = this._cameras.indexOf(r);
                                    this._indicesForCamera.splice(s, 1), this._cameras.splice(s, 1);
                                    for (var a in this._renderPasses)
                                        this._renderPasses[a]._decRefCount()
                                        }
                            }, e.prototype._enable = function(e) {
                                for (var n = t.Tools.MakeArray(e || this._cameras), i = 0; i < n.length; i++) {
                                    for (var o = n[i], r = o.name, s = 0; s < this._indicesForCamera[r].length; s++)
                                        void 0 === o._postProcesses[this._indicesForCamera[r][s]] && e[i].attachPostProcess(this._postProcesses[this._singleInstance ? 0 : r], this._indicesForCamera[r][s]);
                                    for (var a in this._renderPasses)
                                        this._renderPasses[a]._incRefCount()
                                        }
                            }, e.prototype._disable = function(e) {
                                for (var n = t.Tools.MakeArray(e || this._cameras), i = 0; i < n.length; i++) {
                                    var o = n[i], r = o.Name;
                                    o.detachPostProcess(this._postProcesses[this._singleInstance ? 0 : r], this._indicesForCamera[r]);
                                    for (var s in this._renderPasses)
                                        this._renderPasses[s]._decRefCount()
                                        }
                            }, e.prototype.getPostProcess = function(t) {
                                return this._singleInstance ? this._postProcesses[0] : this._postProcesses[t.name]
                            }, e.prototype._linkParameters = function() {
                                var t = this;
                                for (var e in this._postProcesses)
                                    this._postProcesses[e].onApply = function(e) {
                                        t.parameters(e), t._linkTextures(e)
                                    }
                                    }, e.prototype._linkTextures = function(t) {
                                        for (var e in this._renderPasses)
                                            t.setTexture(e, this._renderPasses[e].getRenderTexture());
                                        for (var n in this._renderEffectAsPasses)
                                            t.setTextureFromPostProcess(n + "Sampler", this._renderEffectAsPasses[n].getPostProcess())
                                            }, e
    }();
    t.PostProcessRenderEffect = e
}(BABYLON || (BABYLON = {}));

var BABYLON;
!function(t) {
    var e = function() {
        function e(t, e) {
            this._engine = t, this._name = e, this._renderEffects = [], this._renderEffectsForIsolatedPass = [], this._cameras = []
        }
        return e.prototype.addEffect = function(t) {
            this._renderEffects[t._name] = t
        }, e.prototype._enableEffect = function(e, n) {
            var i = this._renderEffects[e];
            i && i.enable(t.Tools.MakeArray(n || this._cameras))
        }, e.prototype._disableEffect = function(e, n) {
            var i = this._renderEffects[e];
            i && i.disable(t.Tools.MakeArray(n || this._cameras))
        }, e.prototype._attachCameras = function(e, n) {
            for (var i = t.Tools.MakeArray(e || this._cameras), o = [], r = 0; r < i.length; r++) {
                var s = i[r], a = s.name;
                -1 === this._cameras.indexOf(s) ? this._cameras[a] = s : n && o.push(r)
            }
            for (var r = 0; r < o.length; r++)
                e.splice(o[r], 1);
            for (var l in this._renderEffects)
                this._renderEffects[l]._attachCameras(i)
                }, e.prototype._detachCameras = function(e) {
                    var n = t.Tools.MakeArray(e || this._cameras);
                    for (var i in this._renderEffects)
                        this._renderEffects[i]._detachCameras(n);
                    for (var o = 0; o < n.length; o++)
                        this._cameras.splice(this._cameras.indexOf(n[o]), 1)
                        }, e.prototype._enableDisplayOnlyPass = function(n, i) {
                            var o = t.Tools.MakeArray(i || this._cameras), r = null;
                            for (var s in this._renderEffects)
                                if (r = this._renderEffects[s].getPass(n), null != r)
                                    break;
                            if (null !== r) {
                                for (var s in this._renderEffects)
                                    this._renderEffects[s]._disable(o);
                                r._name = e.PASS_SAMPLER_NAME;
                                for (var a = 0; a < o.length; a++) {
                                    var l = o[a], h = l.name;
                                    this._renderEffectsForIsolatedPass[h] = this._renderEffectsForIsolatedPass[h] || new t.PostProcessRenderEffect(this._engine, e.PASS_EFFECT_NAME, "BABYLON.DisplayPassPostProcess", 1, null, null), this._renderEffectsForIsolatedPass[h].emptyPasses(), this._renderEffectsForIsolatedPass[h].addPass(r), this._renderEffectsForIsolatedPass[h]._attachCameras(l)
                                }
                            }
                        }, e.prototype._disableDisplayOnlyPass = function(n) {
                            for (var i = t.Tools.MakeArray(n || this._cameras), o = 0; o < i.length; o++) {
                                var r = i[o], s = r.name;
                                this._renderEffectsForIsolatedPass[s] = this._renderEffectsForIsolatedPass[s] || new t.PostProcessRenderEffect(this._engine, e.PASS_EFFECT_NAME, "BABYLON.DisplayPassPostProcess", 1, null, null), this._renderEffectsForIsolatedPass[s]._disable(r)
                            }
                            for (var a in this._renderEffects)
                                this._renderEffects[a]._enable(i)
                                }, e.prototype._update = function() {
                                    for (var t in this._renderEffects)
                                        this._renderEffects[t]._update();
                                    for (var e = 0; e < this._cameras.length; e++) {
                                        var n = this._cameras[e].name;
                                        this._renderEffectsForIsolatedPass[n] && this._renderEffectsForIsolatedPass[n]._update()
                                    }
                                }, e.PASS_EFFECT_NAME = "passEffect", e.PASS_SAMPLER_NAME = "passSampler", e
    }();
    t.PostProcessRenderPipeline = e
}(BABYLON || (BABYLON = {}));
var BABYLON;
!function(t) {
    var e = function() {
        function t() {
            this._renderPipelines = []
        }
        return t.prototype.addPipeline = function(t) {
            this._renderPipelines[t._name] = t
        }, t.prototype.attachCamerasToRenderPipeline = function(t, e, n) {
            var i = this._renderPipelines[t];
            i && i.attachCameras(e, n)
        }, t.prototype.detachCamerasFromRenderPipeline = function(t, e) {
            var n = this._renderPipelines[t];
            n && n.detachCameras(e)
        }, t.prototype.enableEffectInPipeline = function(t, e, n) {
            var i = this._renderPipelines[t];
            i && i.enableEffect(e, n)
        }, t.prototype.disableEffectInPipeline = function(t, e, n) {
            var i = this._renderPipelines[t];
            i && i.disableEffect(e, n)
        }, t.prototype.enableDisplayOnlyPassInPipeline = function(t, e, n) {
            var i = this._renderPipelines[t];
            i && i.enableDisplayOnlyPass(e, n)
        }, t.prototype.disableDisplayOnlyPassInPipeline = function(t, e) {
            var n = this._renderPipelines[t];
            n && n.disableDisplayOnlyPass(e)
        }, t.prototype.update = function() {
            for (var t in this._renderPipelines)
                this._renderPipelines[t]._update()
                }, t
    }();
    t.PostProcessRenderPipelineManager = e
}(BABYLON || (BABYLON = {}));
var __extends = this.__extends || function(t, e) {
    function n() {
        this.constructor = t
    }
    for (var i in e)
        e.hasOwnProperty(i) && (t[i] = e[i]);
    n.prototype = e.prototype, t.prototype = new n
}, BABYLON;
!function(t) {
    var e = function(t) {
        function e(e, n, i, o, r, s) {
            t.call(this, e, "displayPass", ["passSampler"], ["passSampler"], n, i, o, r, s)
        }
        return __extends(e, t), e
    }(t.PostProcess);
    t.DisplayPassPostProcess = e
}(BABYLON || (BABYLON = {}));
var BABYLON;
!function(t) {
    var e = function() {
        function e(e) {
            this.frontColor = new t.Color3(1, 1, 1), this.backColor = new t.Color3(.1, .1, .1), this.showBackLines = !0, this.renderList = new t.SmartArray(32), this._scene = e, this._colorShader = new t.ShaderMaterial("colorShader", e, "color", {attributes: ["position"],uniforms: ["worldViewProjection", "color"]});
            var n = this._scene.getEngine(), i = t.VertexData.CreateBox(1);
            this._vb = new t.VertexBuffer(n, i.positions, t.VertexBuffer.PositionKind, !1), this._ib = n.createIndexBuffer([0, 1, 1, 2, 2, 3, 3, 0, 4, 5, 5, 6, 6, 7, 7, 4, 0, 7, 1, 6, 2, 5, 3, 4])
        }
        return e.prototype.reset = function() {
            this.renderList.reset()
        }, e.prototype.render = function() {
            if (0 != this.renderList.length && this._colorShader.isReady()) {
                var e = this._scene.getEngine();
                e.setDepthWrite(!1), this._colorShader._preBind();
                for (var n = 0; n < this.renderList.length; n++) {
                    var i = this.renderList.data[n], o = i.minimum, r = i.maximum, s = r.subtract(o), a = o.add(s.scale(.5)), l = t.Matrix.Scaling(s.x, s.y, s.z).multiply(t.Matrix.Translation(a.x, a.y, a.z)).multiply(i.getWorldMatrix());
                    e.bindBuffers(this._vb.getBuffer(), this._ib, [3], 12, this._colorShader.getEffect()), this.showBackLines && (e.setDepthFunctionToGreaterOrEqual(), this._colorShader.setColor3("color", this.backColor), this._colorShader.bind(l), e.draw(!1, 0, 24)), e.setDepthFunctionToLess(), this._colorShader.setColor3("color", this.frontColor), this._colorShader.bind(l), e.draw(!1, 0, 24)
                }
                this._colorShader.unbind(), e.setDepthFunctionToLessOrEqual(), e.setDepthWrite(!0)
            }
        }, e.prototype.dispose = function() {
            this._colorShader.dispose(), this._vb.dispose(), this._scene.getEngine()._releaseBuffer(this._ib)
        }, e
    }();
    t.BoundingBoxRenderer = e
}(BABYLON || (BABYLON = {}));
var __extends = this.__extends || function(t, e) {
    function n() {
        this.constructor = t
    }
    for (var i in e)
        e.hasOwnProperty(i) && (t[i] = e[i]);
    n.prototype = e.prototype, t.prototype = new n
}, BABYLON;
!function(t) {
    var e = function() {
        function t(t) {
            this._actionManager = t
        }
        return t.prototype.isValid = function() {
            return !0
        }, t.prototype._getProperty = function(t) {
            return this._actionManager._getProperty(t)
        }, t.prototype._getEffectiveTarget = function(t, e) {
            return this._actionManager._getEffectiveTarget(t, e)
        }, t
    }();
    t.Condition = e;
    var n = function(t) {
        function e(n, i, o, r, s) {
            "undefined" == typeof s && (s = e.IsEqual), t.call(this, n), this.propertyPath = o, this.value = r, this.operator = s, this._target = this._getEffectiveTarget(i, this.propertyPath), this._property = this._getProperty(this.propertyPath)
        }
        return __extends(e, t), Object.defineProperty(e, "IsEqual", {get: function() {
                                                      return e._IsEqual
                                                      },enumerable: !0,configurable: !0}), Object.defineProperty(e, "IsDifferent", {get: function() {
                                                                                                                 return e._IsDifferent
                                                                                                                 },enumerable: !0,configurable: !0}), Object.defineProperty(e, "IsGreater", {get: function() {
                                                                                                                                                                            return e._IsGreater
                                                                                                                                                                            },enumerable: !0,configurable: !0}), Object.defineProperty(e, "IsLesser", {get: function() {
                                                                                                                                                                                                                                       return e._IsLesser
                                                                                                                                                                                                                                       },enumerable: !0,configurable: !0}), e.prototype.isValid = function() {
            switch (this.operator) {
                case e.IsGreater:
                    return this._target[this._property] > this.value;
                case e.IsLesser:
                    return this._target[this._property] < this.value;
                case e.IsEqual:
                case e.IsDifferent:
                    var t;
                    return t = this.value.equals ? this.value.equals(this._target[this._property]) : this.value === this._target[this._property], this.operator === e.IsEqual ? t : !t
            }
            return !1
        }, e._IsEqual = 0, e._IsDifferent = 1, e._IsGreater = 2, e._IsLesser = 3, e
    }(e);
    t.ValueCondition = n;
    var i = function(t) {
        function e(e, n) {
            t.call(this, e), this.predicate = n
        }
        return __extends(e, t), e.prototype.isValid = function() {
            return this.predicate()
        }, e
    }(e);
    t.PredicateCondition = i;
    var o = function(t) {
        function e(e, n, i) {
            t.call(this, e), this.value = i, this._target = n
        }
        return __extends(e, t), e.prototype.isValid = function() {
            return this._target.state === this.value
        }, e
    }(e);
    t.StateCondition = o
}(BABYLON || (BABYLON = {}));
var BABYLON;
!function(t) {
    var e = function() {
        function t(t, e) {
            this.triggerOptions = t, t.parameter ? (this.trigger = t.trigger, this._triggerParameter = t.parameter) : this.trigger = t, this._nextActiveAction = this, this._condition = e
        }
        return t.prototype._prepare = function() {
        }, t.prototype.getTriggerParameter = function() {
            return this._triggerParameter
        }, t.prototype._executeCurrent = function(t) {
            if (this._condition) {
                var e = this._actionManager.getScene().getRenderId();
                if (this._condition._evaluationId === e) {
                    if (!this._condition._currentResult)
                        return
                        } else {
                            if (this._condition._evaluationId = e, !this._condition.isValid())
                                return void (this._condition._currentResult = !1);
                            this._condition._currentResult = !0
                        }
            }
            this._nextActiveAction.execute(t), this._nextActiveAction = this._nextActiveAction._child ? this._nextActiveAction._child : this
        }, t.prototype.execute = function() {
        }, t.prototype.then = function(t) {
            return this._child = t, t._actionManager = this._actionManager, t._prepare(), t
        }, t.prototype._getProperty = function(t) {
            return this._actionManager._getProperty(t)
        }, t.prototype._getEffectiveTarget = function(t, e) {
            return this._actionManager._getEffectiveTarget(t, e)
        }, t
    }();
    t.Action = e
}(BABYLON || (BABYLON = {}));
var BABYLON;
!function(t) {
    var e = function() {
        function t(t, e, n, i) {
            this.source = t, this.pointerX = e, this.pointerY = n, this.meshUnderPointer = i
        }
        return t.CreateNew = function(e) {
            var n = e.getScene();
            return new t(e, n.pointerX, n.pointerY, n.meshUnderPointer)
        }, t
    }();
    t.ActionEvent = e;
    var n = function() {
        function e(t) {
            this.actions = new Array, this._scene = t, t._actionManagers.push(this)
        }
        return Object.defineProperty(e, "NothingTrigger", {get: function() {
                                     return e._NothingTrigger
                                     },enumerable: !0,configurable: !0}), Object.defineProperty(e, "OnPickTrigger", {get: function() {
                                                                                                return e._OnPickTrigger
                                                                                                },enumerable: !0,configurable: !0}), Object.defineProperty(e, "OnLeftPickTrigger", {get: function() {
                                                                                                                                                           return e._OnLeftPickTrigger
                                                                                                                                                           },enumerable: !0,configurable: !0}), Object.defineProperty(e, "OnRightPickTrigger", {get: function() {
                                                                                                                                                                                                                      return e._OnRightPickTrigger
                                                                                                                                                                                                                      },enumerable: !0,configurable: !0}), Object.defineProperty(e, "OnCenterPickTrigger", {get: function() {
                                                                                                                                                                                                                                                                                 return e._OnCenterPickTrigger
                                                                                                                                                                                                                                                                                 },enumerable: !0,configurable: !0}), Object.defineProperty(e, "OnPointerOverTrigger", {get: function() {
                                                                                                                                                                                                                                                                                                                                            return e._OnPointerOverTrigger
                                                                                                                                                                                                                                                                                                                                            },enumerable: !0,configurable: !0}), Object.defineProperty(e, "OnPointerOutTrigger", {get: function() {
                                                                                                                                                                                                                                                                                                                                                                                                       return e._OnPointerOutTrigger
                                                                                                                                                                                                                                                                                                                                                                                                       },enumerable: !0,configurable: !0}), Object.defineProperty(e, "OnEveryFrameTrigger", {get: function() {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                  return e._OnEveryFrameTrigger
                                                                                                                                                                                                                                                                                                                                                                                                                                                                  },enumerable: !0,configurable: !0}), Object.defineProperty(e, "OnIntersectionEnterTrigger", {get: function() {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             return e._OnIntersectionEnterTrigger
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             },enumerable: !0,configurable: !0}), Object.defineProperty(e, "OnIntersectionExitTrigger", {get: function() {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        return e._OnIntersectionExitTrigger
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        },enumerable: !0,configurable: !0}), e.prototype.dispose = function() {
            var t = this._scene._actionManagers.indexOf(this);
            t > -1 && this._scene._actionManagers.splice(t, 1)
        }, e.prototype.getScene = function() {
            return this._scene
        }, e.prototype.hasSpecificTriggers = function(t) {
            for (var e = 0; e < this.actions.length; e++) {
                var n = this.actions[e];
                if (t.indexOf(n.trigger) > -1)
                    return !0
                    }
            return !1
        }, Object.defineProperty(e.prototype, "hasPointerTriggers", {get: function() {
                                 for (var t = 0; t < this.actions.length; t++) {
                                 var n = this.actions[t];
                                 if (n.trigger >= e._OnPickTrigger && n.trigger <= e._OnPointerOutTrigger)
                                 return !0
                                 }
                                 return !1
                                 },enumerable: !0,configurable: !0}), Object.defineProperty(e.prototype, "hasPickTriggers", {get: function() {
                                                                                            for (var t = 0; t < this.actions.length; t++) {
                                                                                            var n = this.actions[t];
                                                                                            if (n.trigger >= e._OnPickTrigger && n.trigger <= e._OnCenterPickTrigger)
                                                                                            return !0
                                                                                            }
                                                                                            return !1
                                                                                            },enumerable: !0,configurable: !0}), e.prototype.registerAction = function(n) {
            return n.trigger === e.OnEveryFrameTrigger && this.getScene().actionManager !== this ? (t.Tools.Warn("OnEveryFrameTrigger can only be used with scene.actionManager"), null) : (this.actions.push(n), n._actionManager = this, n._prepare(), n)
        }, e.prototype.processTrigger = function(t, e) {
            for (var n = 0; n < this.actions.length; n++) {
                var i = this.actions[n];
                i.trigger === t && i._executeCurrent(e)
            }
        }, e.prototype._getEffectiveTarget = function(t, e) {
            for (var n = e.split("."), i = 0; i < n.length - 1; i++)
                t = t[n[i]];
            return t
        }, e.prototype._getProperty = function(t) {
            var e = t.split(".");
            return e[e.length - 1]
        }, e._NothingTrigger = 0, e._OnPickTrigger = 1, e._OnLeftPickTrigger = 2, e._OnRightPickTrigger = 3, e._OnCenterPickTrigger = 4, e._OnPointerOverTrigger = 5, e._OnPointerOutTrigger = 6, e._OnEveryFrameTrigger = 7, e._OnIntersectionEnterTrigger = 8, e._OnIntersectionExitTrigger = 9, e
    }();
    t.ActionManager = n
}(BABYLON || (BABYLON = {}));
var __extends = this.__extends || function(t, e) {
    function n() {
        this.constructor = t
    }
    for (var i in e)
        e.hasOwnProperty(i) && (t[i] = e[i]);
    n.prototype = e.prototype, t.prototype = new n
}, BABYLON;
!function(t) {
    var e = function(e) {
        function n(t, n, i, o, r, s, a) {
            "undefined" == typeof r && (r = 1e3), e.call(this, t, s), this.propertyPath = i, this.value = o, this.duration = r, this.stopOtherAnimations = a, this._target = n
        }
        return __extends(n, e), n.prototype._prepare = function() {
            this._target = this._getEffectiveTarget(this._target, this.propertyPath), this._property = this._getProperty(this.propertyPath)
        }, n.prototype.execute = function() {
            var e, n = this._actionManager.getScene(), i = [{frame: 0,value: this._target[this._property]}, {frame: 100,value: this.value}];
            if ("number" == typeof this.value)
                e = t.Animation.ANIMATIONTYPE_FLOAT;
            else if (this.value instanceof t.Color3)
                e = t.Animation.ANIMATIONTYPE_COLOR3;
            else if (this.value instanceof t.Vector3)
                e = t.Animation.ANIMATIONTYPE_VECTOR3;
            else if (this.value instanceof t.Matrix)
                e = t.Animation.ANIMATIONTYPE_MATRIX;
            else {
                if (!(this.value instanceof t.Quaternion))
                    return void t.Tools.Warn("InterpolateValueAction: Unsupported type (" + typeof this.value + ")");
                e = t.Animation.ANIMATIONTYPE_QUATERNION
            }
            var o = new t.Animation("InterpolateValueAction", this._property, 100 * (1e3 / this.duration), e, t.Animation.ANIMATIONLOOPMODE_CONSTANT);
            o.setKeys(i), this.stopOtherAnimations && n.stopAnimation(this._target), n.beginDirectAnimation(this._target, [o], 0, 100)
        }, n
    }(t.Action);
    t.InterpolateValueAction = e
}(BABYLON || (BABYLON = {}));
var __extends = this.__extends || function(t, e) {
    function n() {
        this.constructor = t
    }
    for (var i in e)
        e.hasOwnProperty(i) && (t[i] = e[i]);
    n.prototype = e.prototype, t.prototype = new n
}, BABYLON;
!function(t) {
    var e = function(t) {
        function e(e, n, i, o) {
            t.call(this, e, o), this.propertyPath = i, this._target = n
        }
        return __extends(e, t), e.prototype._prepare = function() {
            this._target = this._getEffectiveTarget(this._target, this.propertyPath), this._property = this._getProperty(this.propertyPath)
        }, e.prototype.execute = function() {
            this._target[this._property] = !this._target[this._property]
        }, e
    }(t.Action);
    t.SwitchBooleanAction = e;
    var n = function(t) {
        function e(e, n, i, o) {
            t.call(this, e, o), this.value = i, this._target = n
        }
        return __extends(e, t), e.prototype.execute = function() {
            this._target.state = this.value
        }, e
    }(t.Action);
    t.SetStateAction = n;
    var i = function(t) {
        function e(e, n, i, o, r) {
            t.call(this, e, r), this.propertyPath = i, this.value = o, this._target = n
        }
        return __extends(e, t), e.prototype._prepare = function() {
            this._target = this._getEffectiveTarget(this._target, this.propertyPath), this._property = this._getProperty(this.propertyPath)
        }, e.prototype.execute = function() {
            this._target[this._property] = this.value
        }, e
    }(t.Action);
    t.SetValueAction = i;
    var o = function(e) {
        function n(t, n, i, o, r) {
            e.call(this, t, r), this.propertyPath = i, this.value = o, this._target = n
        }
        return __extends(n, e), n.prototype._prepare = function() {
            this._target = this._getEffectiveTarget(this._target, this.propertyPath), this._property = this._getProperty(this.propertyPath), "number" != typeof this._target[this._property] && t.Tools.Warn("Warning: IncrementValueAction can only be used with number values")
        }, n.prototype.execute = function() {
            this._target[this._property] += this.value
        }, n
    }(t.Action);
    t.IncrementValueAction = o;
    var r = function(t) {
        function e(e, n, i, o, r, s) {
            t.call(this, e, s), this.from = i, this.to = o, this.loop = r, this._target = n
        }
        return __extends(e, t), e.prototype._prepare = function() {
        }, e.prototype.execute = function() {
            var t = this._actionManager.getScene();
            t.beginAnimation(this._target, this.from, this.to, this.loop)
        }, e
    }(t.Action);
    t.PlayAnimationAction = r;
    var s = function(t) {
        function e(e, n, i) {
            t.call(this, e, i), this._target = n
        }
        return __extends(e, t), e.prototype._prepare = function() {
        }, e.prototype.execute = function() {
            var t = this._actionManager.getScene();
            t.stopAnimation(this._target)
        }, e
    }(t.Action);
    t.StopAnimationAction = s;
    var a = function(e) {
        function n(n, i) {
            "undefined" == typeof n && (n = t.ActionManager.NothingTrigger), e.call(this, n, i)
        }
        return __extends(n, e), n.prototype.execute = function() {
        }, n
    }(t.Action);
    t.DoNothingAction = a;
    var l = function(t) {
        function e(e, n, i) {
            t.call(this, e, i), this.children = n
        }
        return __extends(e, t), e.prototype._prepare = function() {
            for (var t = 0; t < this.children.length; t++)
                this.children[t]._actionManager = this._actionManager, this.children[t]._prepare()
                }, e.prototype.execute = function(t) {
                    for (var e = 0; e < this.children.length; e++)
                        this.children[e].execute(t)
                        }, e
    }(t.Action);
    t.CombineAction = l;
    var h = function(t) {
        function e(e, n, i) {
            t.call(this, e, i), this.func = n
        }
        return __extends(e, t), e.prototype.execute = function(t) {
            this.func(t)
        }, e
    }(t.Action);
    t.ExecuteCodeAction = h;
    var c = function(e) {
        function n(t, n, i, o) {
            e.call(this, t, o), this._target = n, this._parent = i
        }
        return __extends(n, e), n.prototype._prepare = function() {
        }, n.prototype.execute = function() {
            if (this._target.parent !== this._parent) {
                var e = this._parent.getWorldMatrix().clone();
                e.invert(), this._target.position = t.Vector3.TransformCoordinates(this._target.position, e), this._target.parent = this._parent
            }
        }, n
    }(t.Action);
    t.SetParentAction = c
}(BABYLON || (BABYLON = {}));
var __extends = this.__extends || function(t, e) {
    function n() {
        this.constructor = t
    }
    for (var i in e)
        e.hasOwnProperty(i) && (t[i] = e[i]);
    n.prototype = e.prototype, t.prototype = new n
}, BABYLON;
!function(t) {
    var e = function() {
        function e(e, n, i, o, r) {
            this.delayLoadState = t.Engine.DELAYLOADSTATE_NONE, this._totalVertices = 0, this._indices = [], this.id = e, this._engine = n.getEngine(), this._meshes = [], this._scene = n, i ? this.setAllVerticesData(i, o) : (this._totalVertices = 0, this._indices = []), r && this.applyToMesh(r)
        }
        return e.prototype.getScene = function() {
            return this._scene
        }, e.prototype.getEngine = function() {
            return this._engine
        }, e.prototype.isReady = function() {
            return this.delayLoadState === t.Engine.DELAYLOADSTATE_LOADED || this.delayLoadState === t.Engine.DELAYLOADSTATE_NONE
        }, e.prototype.setAllVerticesData = function(t, e) {
            t.applyToGeometry(this, e)
        }, e.prototype.setVerticesData = function(e, n, i) {
            if (this._vertexBuffers = this._vertexBuffers || {}, this._vertexBuffers[e] && this._vertexBuffers[e].dispose(), this._vertexBuffers[e] = new t.VertexBuffer(this._engine, n, e, i, 0 === this._meshes.length), e === t.VertexBuffer.PositionKind) {
                var o = this._vertexBuffers[e].getStrideSize();
                this._totalVertices = n.length / o;
                for (var r = t.Tools.ExtractMinAndMax(n, 0, this._totalVertices), s = this._meshes, a = s.length, l = 0; a > l; l++) {
                    var h = s[l];
                    h._resetPointsArrayCache(), h._boundingInfo = new t.BoundingInfo(r.minimum, r.maximum), h._createGlobalSubMesh(), h.computeWorldMatrix(!0)
                }
            }
        }, e.prototype.updateVerticesData = function(e, n, i) {
            var o = this.getVertexBuffer(e);
            if (o && (o.update(n), e === t.VertexBuffer.PositionKind)) {
                var r;
                if (i) {
                    var s = o.getStrideSize();
                    this._totalVertices = n.length / s, r = t.Tools.ExtractMinAndMax(n, 0, this._totalVertices)
                }
                for (var a = this._meshes, l = a.length, h = 0; l > h; h++) {
                    var c = a[h];
                    c._resetPointsArrayCache(), i && (c._boundingInfo = new t.BoundingInfo(r.minimum, r.maximum))
                }
            }
        }, e.prototype.getTotalVertices = function() {
            return this.isReady() ? this._totalVertices : 0
        }, e.prototype.getVerticesData = function(t) {
            var e = this.getVertexBuffer(t);
            return e ? e.getData() : null
        }, e.prototype.getVertexBuffer = function(t) {
            return this.isReady() ? this._vertexBuffers[t] : null
        }, e.prototype.getVertexBuffers = function() {
            return this.isReady() ? this._vertexBuffers : null
        }, e.prototype.isVerticesDataPresent = function(t) {
            return this._vertexBuffers ? void 0 !== this._vertexBuffers[t] : this._delayInfo ? -1 !== this._delayInfo.indexOf(t) : !1
        }, e.prototype.getVerticesDataKinds = function() {
            var t = [];
            if (!this._vertexBuffers && this._delayInfo)
                for (var e in this._delayInfo)
                    t.push(e);
            else
                for (e in this._vertexBuffers)
                    t.push(e);
            return t
        }, e.prototype.setIndices = function(t) {
            this._indexBuffer && this._engine._releaseBuffer(this._indexBuffer), this._indices = t, 0 !== this._meshes.length && this._indices && (this._indexBuffer = this._engine.createIndexBuffer(this._indices));
            for (var e = this._meshes, n = e.length, i = 0; n > i; i++)
                e[i]._createGlobalSubMesh()
                }, e.prototype.getTotalIndices = function() {
                    return this.isReady() ? this._indices.length : 0
                }, e.prototype.getIndices = function() {
                    return this.isReady() ? this._indices : null
                }, e.prototype.getIndexBuffer = function() {
                    return this.isReady() ? this._indexBuffer : null
                }, e.prototype.releaseForMesh = function(t, e) {
                    var n = this._meshes, i = n.indexOf(t);
                    if (-1 !== i) {
                        for (var o in this._vertexBuffers)
                            this._vertexBuffers[o].dispose();
                        this._indexBuffer && this._engine._releaseBuffer(this._indexBuffer) && (this._indexBuffer = null), n.splice(i, 1), t._geometry = null, 0 == n.length && e && this.dispose()
                    }
                }, e.prototype.applyToMesh = function(t) {
                    if (t._geometry !== this) {
                        var e = t._geometry;
                        e && e.releaseForMesh(t);
                        var n = this._meshes;
                        t._geometry = this, this._scene.pushGeometry(this), n.push(t), this.isReady() ? this._applyToMesh(t) : t._boundingInfo = this._boundingInfo
                    }
                }, e.prototype._applyToMesh = function(e) {
                    var n = this._meshes.length;
                    for (var i in this._vertexBuffers)
                        if (1 === n && this._vertexBuffers[i].create(), this._vertexBuffers[i]._buffer.references = n, i === t.VertexBuffer.PositionKind) {
                            e._resetPointsArrayCache();
                            var o = t.Tools.ExtractMinAndMax(this._vertexBuffers[i].getData(), 0, this._totalVertices);
                            e._boundingInfo = new t.BoundingInfo(o.minimum, o.maximum), e._createGlobalSubMesh()
                        }
                    1 === n && this._indices && (this._indexBuffer = this._engine.createIndexBuffer(this._indices)), this._indexBuffer && (this._indexBuffer.references = n)
                }, e.prototype.load = function(e, n) {
                    var i = this;
                    if (this.delayLoadState !== t.Engine.DELAYLOADSTATE_LOADING) {
                        if (this.isReady())
                            return void (n && n());
                        this.delayLoadState = t.Engine.DELAYLOADSTATE_LOADING, e._addPendingData(this), t.Tools.LoadFile(this.delayLoadingFile, function(o) {
                                                                                                                         i._delayLoadingFunction(JSON.parse(o), i), i.delayLoadState = t.Engine.DELAYLOADSTATE_LOADED, i._delayInfo = [], e._removePendingData(i);
                                                                                                                         for (var r = i._meshes, s = r.length, a = 0; s > a; a++)
                                                                                                                         i._applyToMesh(r[a]);
                                                                                                                         n && n()
                                                                                                                         }, function() {
                                                                                                                         }, e.database)
                    }
                }, e.prototype.dispose = function() {
                    for (var e = this._meshes, n = e.length, i = 0; n > i; i++)
                        this.releaseForMesh(e[i]);
                    this._meshes = [];
                    for (var o in this._vertexBuffers)
                        this._vertexBuffers[o].dispose();
                    this._vertexBuffers = [], this._totalVertices = 0, this._indexBuffer && this._engine._releaseBuffer(this._indexBuffer), this._indexBuffer = null, this._indices = [], this.delayLoadState = t.Engine.DELAYLOADSTATE_NONE, this.delayLoadingFile = null, this._delayLoadingFunction = null, this._delayInfo = [], this._boundingInfo = null;
                    var r = this._scene.getGeometries();
                    i = r.indexOf(this), i > -1 && r.splice(i, 1)
                }, e.prototype.copy = function(e) {
                    var n = new t.VertexData;
                    n.indices = [];
                    for (var i = this.getIndices(), o = 0; o < i.length; o++)
                        n.indices.push(i[o]);
                    var r = !1, s = !1;
                    for (var a in this._vertexBuffers)
                        n.set(this.getVerticesData(a), a), s || (r = this.getVertexBuffer(a).isUpdatable(), s = !r);
                    var l = new t.Geometry(e, this._scene, n, r, null);
                    l.delayLoadState = this.delayLoadState, l.delayLoadingFile = this.delayLoadingFile, l._delayLoadingFunction = this._delayLoadingFunction;
                    for (a in this._delayInfo)
                        l._delayInfo = l._delayInfo || [], l._delayInfo.push(a);
                    var h = t.Tools.ExtractMinAndMax(this.getVerticesData(t.VertexBuffer.PositionKind), 0, this.getTotalVertices());
                    return l._boundingInfo = new t.BoundingInfo(h.minimum, h.maximum), l
                }, e.ExtractFromMesh = function(t, e) {
                    var n = t._geometry;
                    return n ? n.copy(e) : null
                }, e.RandomId = function() {
                    return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, function(t) {
                                                                          var e = 16 * Math.random() | 0, n = "x" == t ? e : 3 & e | 8;
                                                                          return n.toString(16)
                                                                          })
                }, e
    }();
    t.Geometry = e, function(e) {
        !function(n) {
            var i = function(t) {
                function e(e, n, i, o, r) {
                    this._beingRegenerated = !0, this._canBeRegenerated = o, t.call(this, e, n, i, !1, r), this._beingRegenerated = !1
                }
                return __extends(e, t), e.prototype.canBeRegenerated = function() {
                    return this._canBeRegenerated
                }, e.prototype.regenerate = function() {
                    this._canBeRegenerated && (this._beingRegenerated = !0, this.setAllVerticesData(this._regenerateVertexData(), !1), this._beingRegenerated = !1)
                }, e.prototype.asNewGeometry = function(e) {
                    return t.prototype.copy.call(this, e)
                }, e.prototype.setAllVerticesData = function(e) {
                    this._beingRegenerated && t.prototype.setAllVerticesData.call(this, e, !1)
                }, e.prototype.setVerticesData = function(e, n) {
                    this._beingRegenerated && t.prototype.setVerticesData.call(this, e, n, !1)
                }, e.prototype._regenerateVertexData = function() {
                    throw new Error("Abstract method")
                }, e.prototype.copy = function() {
                    throw new Error("Must be overriden in sub-classes.")
                }, e
            }(e);
            n._Primitive = i;
            var o = function(e) {
                function n(t, n, i, o, r) {
                    this.size = i, e.call(this, t, n, this._regenerateVertexData(), o, r)
                }
                return __extends(n, e), n.prototype._regenerateVertexData = function() {
                    return t.VertexData.CreateBox(this.size)
                }, n.prototype.copy = function(t) {
                    return new n(t, this.getScene(), this.size, this.canBeRegenerated(), null)
                }, n
            }(i);
            n.Box = o;
            var r = function(e) {
                function n(t, n, i, o, r, s) {
                    this.segments = i, this.diameter = o, e.call(this, t, n, this._regenerateVertexData(), r, s)
                }
                return __extends(n, e), n.prototype._regenerateVertexData = function() {
                    return t.VertexData.CreateSphere(this.segments, this.diameter)
                }, n.prototype.copy = function(t) {
                    return new n(t, this.getScene(), this.segments, this.diameter, this.canBeRegenerated(), null)
                }, n
            }(i);
            n.Sphere = r;
            var s = function(e) {
                function n(t, n, i, o, r, s, a, l, h) {
                    "undefined" == typeof a && (a = 1), this.height = i, this.diameterTop = r, this.diameterBottom = o, this.tessellation = s, this.subdivisions = a, e.call(this, t, n, this._regenerateVertexData(), l, h)
                }
                return __extends(n, e), n.prototype._regenerateVertexData = function() {
                    return t.VertexData.CreateCylinder(this.height, this.diameterBottom, this.diameterTop, this.tessellation, this.subdivisions)
                }, n.prototype.copy = function(t) {
                    return new n(t, this.getScene(), this.height, this.diameterTop, this.diameterBottom, this.tessellation, this.subdivisions, this.canBeRegenerated(), null)
                }, n
            }(i);
            n.Cylinder = s;
            var a = function(e) {
                function n(t, n, i, o, r, s, a) {
                    this.diameter = i, this.thickness = o, this.tessellation = r, e.call(this, t, n, this._regenerateVertexData(), s, a)
                }
                return __extends(n, e), n.prototype._regenerateVertexData = function() {
                    return t.VertexData.CreateTorus(this.diameter, this.thickness, this.tessellation)
                }, n.prototype.copy = function(t) {
                    return new n(t, this.getScene(), this.diameter, this.thickness, this.tessellation, this.canBeRegenerated(), null)
                }, n
            }(i);
            n.Torus = a;
            var l = function(e) {
                function n(t, n, i, o, r, s, a) {
                    this.width = i, this.height = o, this.subdivisions = r, e.call(this, t, n, this._regenerateVertexData(), s, a)
                }
                return __extends(n, e), n.prototype._regenerateVertexData = function() {
                    return t.VertexData.CreateGround(this.width, this.height, this.subdivisions)
                }, n.prototype.copy = function(t) {
                    return new n(t, this.getScene(), this.width, this.height, this.subdivisions, this.canBeRegenerated(), null)
                }, n
            }(i);
            n.Ground = l;
            var h = function(e) {
                function n(t, n, i, o, r, s, a, l, h, c) {
                    this.xmin = i, this.zmin = o, this.xmax = r, this.zmax = s, this.subdivisions = a, this.precision = l, e.call(this, t, n, this._regenerateVertexData(), h, c)
                }
                return __extends(n, e), n.prototype._regenerateVertexData = function() {
                    return t.VertexData.CreateTiledGround(this.xmin, this.zmin, this.xmax, this.zmax, this.subdivisions, this.precision)
                }, n.prototype.copy = function(t) {
                    return new n(t, this.getScene(), this.xmin, this.zmin, this.xmax, this.zmax, this.subdivisions, this.precision, this.canBeRegenerated(), null)
                }, n
            }(i);
            n.TiledGround = h;
            var c = function(e) {
                function n(t, n, i, o, r) {
                    this.size = i, e.call(this, t, n, this._regenerateVertexData(), o, r)
                }
                return __extends(n, e), n.prototype._regenerateVertexData = function() {
                    return t.VertexData.CreatePlane(this.size)
                }, n.prototype.copy = function(t) {
                    return new n(t, this.getScene(), this.size, this.canBeRegenerated(), null)
                }, n
            }(i);
            n.Plane = c;
            var u = function(e) {
                function n(t, n, i, o, r, s, a, l, h, c) {
                    this.radius = i, this.tube = o, this.radialSegments = r, this.tubularSegments = s, this.p = a, this.q = l, e.call(this, t, n, this._regenerateVertexData(), h, c)
                }
                return __extends(n, e), n.prototype._regenerateVertexData = function() {
                    return t.VertexData.CreateTorusKnot(this.radius, this.tube, this.radialSegments, this.tubularSegments, this.p, this.q)
                }, n.prototype.copy = function(t) {
                    return new n(t, this.getScene(), this.radius, this.tube, this.radialSegments, this.tubularSegments, this.p, this.q, this.canBeRegenerated(), null)
                }, n
            }(i);
            n.TorusKnot = u
        }(e.Primitives || (e.Primitives = {}));
        e.Primitives
    }(t.Geometry || (t.Geometry = {}));
    var e = t.Geometry
}(BABYLON || (BABYLON = {}));
var __extends = this.__extends || function(t, e) {
    function n() {
        this.constructor = t
    }
    for (var i in e)
        e.hasOwnProperty(i) && (t[i] = e[i]);
    n.prototype = e.prototype, t.prototype = new n
}, BABYLON;
!function(t) {
    var e = function() {
        function e(t) {
            var e = this;
            this.babylonGamepads = [], this.oneGamepadConnected = !1, this.isMonitoring = !1, this.gamepadEventSupported = "GamepadEvent" in window, this.gamepadSupportAvailable = navigator.getGamepads || !!navigator.webkitGetGamepads || !!navigator.msGetGamepads || !!navigator.webkitGamepads, this.buttonADataURL = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAA9aSURBVHja7FtpbBzneX7m3otcihSpm9Z9UJalxPKhVLZlp6ktNzEaxE0CtAnQAgnSoPWPBi3syuiPwordFi5Qt2haFygCoylSV4Vby6os1I3kOLYrS65kXXQoypJJSaFEUTyXy925+rzfzC6HFFlL1kpAIe7i5czO7H7zPs97ft8MtTAMcSu/dNzirxkCZgiYIWCGgBkCZgi4hV/mDR5fSxAt+0ZiX0ucDxMSTJLK+f83BFSA6TFgK75OclshouKBFbA+xaV4k7Z+fD6sNRlmjYFXQMu4NiUVS/oHe5/ecnHo3MYxd7QthN9UcsdW6FqEPwgDOFbqpAajL2VlTrTULzj4Ow8+s4+nipSxWMoxIUkyrl/pGswFtIR7WzHgDCX77K7vfHNkbOA+AryjYZadb27OIJdzCNZBKmXw4kbk35qPsTEfJbeEkZESentHMdBfGtY142gu1bDvqV/925f4tQJlNCaj4hXX7RHXS0AFuJEAXvfHr/zmk67vPjir0V68aFEe8xtuQ6O1FHlrEXLmHBiaDUtzYBlpNYjrF+GFZfhhCcPeBQy53ehzT+H8QBe6uwfRf7l8xjKsvX/y5X98jl8fThDhJ4i46QQkrS5I6v7oX7/++77vPtLUlFnZtnIRlubvxRxnHbJmE79sxD/SqG0oZk8MFarRqufUkQAFrxcXSkfx0eB+nOggKX2jHYZhvf79r/z4L2IiipO84aYRkASfefnAX695p3P3c9mM/UufuaMVdzRvxVx7A0xaWdOMqVULJ6Z3TZv6KmHo0ztK6CkfxpHe3Th0pAuF0fLbn1u+9cmv3vW77bE3fGoSPi0BVfAvvPEHm9rPv//iooWz5m9Z/wCWZx+Go9UrN48QTD9IGMZ1cJIzTPisRQclPMrhME4W9mDfB2+i+2z/+TXz7/z2E7/85+9OIuGGE6BV3H77zm/d33nx6Ktr18zFg2t+DQude2n1tLJ8tcJ90vDhpG5Am7qTkJAQErywiLOld7G3/d9xvL0Hy1vWPbbtS3//00Q4hDeaAFXintrx1fu7+jp2r13bgofX/gaazbVkJQdLT9P6VqRFDSu2hIgXlBUBLgtCr3cce47/CMePX0Rr08qtzz7+8k8TpfKGtcKq1jPZre7oObyjdWkGd628l7AXwvMCeL7HjO6qrS8S1E5kTE9tfbiur665ccU9EB1EF9Ep0WXesEZIJb9j5/b/XUtzNrt29Rw0og2lchmBVqLo8LSAHlCixbTpddGm8Y7pjkttCCUP+JQy3FiatNuxdvUx9F4ayopO/OL9sQeEN4oA/eHn577oWPbGVes11PsrUBxjDafze1Te1VzouqnK2TgmLQljQqmrnAsT+iaPVb5b2co7EC+QhBgUeM1R1AcrsGp9Jy6+4W8U3fZ8r+e3EnOI2uaAX3l+zgNB4O9rW5/B8tY5WGo9BtOrJ4uMfUl+uj0B8HTmPXj8Pex86xVEnTDBBSE2r78fX9i09RPyZfT2A5ceIMSPwDOH8JH7Kk5+fAHtR0Zh6MZ9e7534Wc3wgO0sXLhD9OpFOa0egjGMhguD8BgTJooMfPbV1h/umz25ondcFP90IzY2iTgrfY9uH31aqSc9CeSEHkBEyITv28M8XMGc2/z0HGCpWCs8BS/9sWrDYOrJuCBZ+vu5sUfXbicia5kYGzUw4DWTwJKbApSjHuTBBjT2H68zg0MD4KlEwabZi0Y7wd85u/3O9/B6sVrPlEXeiF9nMmRxPt6Qf4y/HyIbh3HwkdF1zefGt5fUwK8wP2WAGwh02MFE/5ogYr3Qg/STL0W3d8aB1ppa+Pw0uI2Tz6/134Mg+UoIGZlZ2HMLaJYHkPICr6//RBamvPj/UA4dYKsegGrXqAXMaqNsDT6SreOY5Gu/FptCeBFN+caAphGiKFiGaOjA3AJHoGt6r7GgNbjqjo5yQkBUVHQ8PaJExjiaZ2yue12nO27gCNdHSptvf/xGdw11I2UZSmvCIJgQiJMhoEfeqpNDvUSRvUB5hMX9fUecg0aBi+Hm2uaAz633bmbm1VN8+h07LfKJdkOkQB2fL4BTlsj8No4YLG2putMSjwjp3QNvZdH8YsiExV501isFjU30lpF7D8dVfCA8sFHp7BuWYtaIwiCsCrCSDVhh9IX8k0CoHsoMQ84FrfFAE3zQAK0VaLzO9tK79XKAxSj+aYALt3XLfNipZD1v492YexrE/sP0zBgUIQIoYaflAXbz16CzyY6YKqYl8uheTarRioD7xAxCQHUpv18L1Yud+Iloujtk4zQo9WZcKURqjbHclzKvj0Gvcw8UA6oY2WqonSuGQGb5I+TJgEFEsB4daXzc0eopabcX13W0BXwgAnRZL4Q62s8ppnR/pFz/QjF+tRvxeIsY/cizGwRt83P4czACL8HdA1JUivCNGVogvdkNkgaGDNe4CvXFyJ8n+B5XGLJ1FmJXJ53AzjZKgGbatkKL5c/liNWIPO8uM/4VO2uKCQZjLmBqQAGJ4EmI8NMabDTOuyUobYXmPlCEpiqA1IkYdWSBpjpEDl6wsrF9aAjqHNOPXDyXAGprAknY5B0btOGGk/GlfE1taqofCNuuYNIJ+omOiZ1rpUHtEYWjkpWoP5EWV2sb5isA7aIQTHHxaIniNADui8PIs0Eb6SY/Z0UQc+j+mXYuoM7Vy/Age7zkBUyCZGLhRLSOYcWpfXFA1wPhqup8JNKq5UkKeoqSHxPLSoqnUQtw5ioc60IyE/VkOji8mYE2nZELNgCXLaOkGDFJBg4OzCMDEcxCfAzS1pQX5fHSNDLClLGwmwzls6vQ09hGFJYegdZ1hha2bqIBNelB5Qjog02TzpFNVEquYpMuTSYr/lcQPKPJHoRQ8W1GYO3lDgpO9pPWTEZEQGnuodg5Hyk66Lyd8fKOQQ6gqyWict7GeuWz8HQyWEFw+bB7ksF3Nk2V1nfpZTLQqSLslzXlDmHpsQ1osVoy/Solwf/GpdErpaAQUqjWxL2GWcWaSfAMIis7RBwiuCdtD1OgmNHBJCg7r4uZBnbdjaaq+3YewB+USYicY8juYPnMtloqdCjG3f39eO+3JKIAFadSiiZigBdgdcqItMxsmZbIbvUIKlzzQjoEgLGRjU2KTp8AjRCkzEnAG0mtQh8Ku0oAqok8JzP+Lw0MkB3jpKjKpapaL5WKZxafDdBqoC6O8LtyMAQhoZdzG7MwLU8FUYKPINcl+qimismRj26v2I71I3jDxfdpM41I6CTsmG4X0djKyc8RYu9t0Vl2QJbBJ5xFPiICJIg1hdhR3fs5HnWeldleZXABLA98b7Y5HtjkgwNEtbTN4iFC5oI3I1CTsAbsfVjAizJB3Qbx9HphRp6eqr3TDprSYA0FI/3ntOxbpUNM2OjpEcE6HYEWkhIKw+ICeBxi+T09F1WZU+iJq2n8fRDf4Ymu3XSrcOIgg8H9uOFn31fNUVC0oddZ7B5YxtDwlTgo66SEici2fokwCJjju0hw7J54WypQsB7tSRAza+H+nld30Y+m2b7SS+Qn9PKFl1egRciHIfWpxC8x+7tdA97+3zUcNyWX4Ci/THOoD2x/hmlQTox+3gDjWYeg/4gmF853xjBpUsjaGnJR24fu36FNzX5pmfY7EPStlSLIgb6gwk616QRYk8tS88/l/2PT/loyqbQkEmhPpNGNp1CmvtieQHvONGtL4sdy9Hjp5kkpTWmSzM7L529hErHs0cCpt2qW00BymDV3JXSU8HkAXKIjtNnedxS48m4Mr5cR9YlMrx+XTqNRmbP2ZkMOjvHKir/PNa5pouiitFjH44iZ6YwO5tFAy+eo6SdpOUJyhBQTJR+HT9HYLJaFve0PqQmTQLaVOCdmIRIWE+wrmWTzG8iAugF7qgWjSWkGbYa32EjJQTkGFv5dBZNJKCeHdb77UPXZP1rWhKLZ4Rqjv2Fz86lLMNlpusCY9BnqTNUIyTgrVhhs7rVq2KoW2TSxWlXLOCqWX4svmpzZdEjWvgQcdVWPnu+i4ClUS+HyLIFnsVf/9eBduw8eKYy2D1XMxO8Jg+IB9wl+3s/uAC3qKMpXY88m/ecnUHaSis3Na8Ab1UtaCh3j1y+sm8m9o0J+9Fv9MR4Zhw6DufTWasOebsOs+xZKHJOtvtQtertulrwV+0BtH5yWvyW7CxubsCTX9+KUQZ4ga7qmdGUFmrya8QWHwcxlReMF8Mw4QETrR8oy7tq2ivH5Tvya8n8aXZMGc4An/nRDpy52FfR8b5KCJCImt8YkYF/KDtnegfwz3sPodGajQajCTk9z/4mQ6iphMWv9AA9IeMWdyYdn+gBkVc5amwHWV6lHvVaI2YZzfinN95Ngv/htcT/p31CRNbdV8l8e++xD5HPNeHxhx5Bgf18kTN5T1kvjBfEjGjBJCai4gnjHqAnlvqS8e9NeujEjEul/NokDbai4V/2voafHD1S0evdWLeb8ojMNyly5fS//ffbcD0L33j4K4RX4rtMh/UUGLXmr6BWXN9MEFAhYfzmZ6hcXI+TpISRH8061Ui68gTWGUJP4aU9P8ZrB39S+Xkx1ummPSMkbebnJcxU1jm4D5eGhvB7j32HJcpUJHhxLIfxTZpxwGa8eKrHC51a9Tmp+N5P1RsQ01cJAwEflHw8/+pfYn/HgaQ+n7/a1vd6k+BUS2XvVD401TXhu488gQ0r71QUuLJsrWT8mSYtfkBMm0BAmFhNrgDX4oRqqeaJMw4c6TyIv/qPP0Xf8KUJ6sXuP1XluuEEyGsD5TXKgsqBNQvW4RtbnkDb4ttJQlGt/IQqLMJE7tWqOSBZCSrL6dFSqq3AnzhzDC/tewHt5w4nr3suvgN0+P8o3TeegFe3vYDHtj+xhLt/Q3kkeW5d693YuuHXsWHZPcixW4tCwo+trVU9QEs8G6HFqW5kdBiHTu3H64dfxpGuK8r665Tv7tz2D6e/tP23cT0E1OA5QR2iiIbs1i9u/9qTPPC12CtwlIofjZVvW/BZ3LVsC5bPW4u5DQuxaPay2NpRIuy61IkLA+dw8hdHceDUPpw49z9TXUysvWPXtl3bQ4yQtMJ1a18DAsbvRO/atvM5DXXPPbp9yzP8+GXBXTkngKYBdTWvE5RXdm87+HQEfLh2T57UIAdM95Js9+04LKSDbLzG31+Omxpx9xfxKR6AukkhMP0aKuUHsag5VEzE3fGSddsUVu6KFzIE+H/iJry0mX+bu8VfMwTMEDBDwAwBMwTMEHALv/5XgAEASpR5N6rB30UAAAAASUVORK5CYII=", this._callbackGamepadConnected = t, this.gamepadSupportAvailable ? (this.gamepadEventSupported ? (window.addEventListener("gamepadconnected", function(t) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             e._onGamepadConnected(t)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             }, !1), window.addEventListener("gamepaddisconnected", function(t) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             e._onGamepadDisconnected(t)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             }, !1)) : this._startMonitoringGamepads(), this.oneGamepadConnected || this._insertGamepadDOMInstructions()) : this._insertGamepadDOMNotSupported()
        }
        return e.prototype._insertGamepadDOMInstructions = function() {
            e.gamepadDOMInfo = document.createElement("div");
            var t = document.createElement("img");
            t.src = this.buttonADataURL;
            var n = document.createElement("span");
            n.innerHTML = "<strong>to activate gamepad</strong>", e.gamepadDOMInfo.appendChild(t), e.gamepadDOMInfo.appendChild(n), e.gamepadDOMInfo.style.position = "absolute", e.gamepadDOMInfo.style.width = "100%", e.gamepadDOMInfo.style.height = "48px", e.gamepadDOMInfo.style.bottom = "0px", e.gamepadDOMInfo.style.backgroundColor = "rgba(1, 1, 1, 0.15)", e.gamepadDOMInfo.style.textAlign = "center", e.gamepadDOMInfo.style.zIndex = "10", t.style.position = "relative", t.style.bottom = "8px", n.style.position = "relative", n.style.fontSize = "32px", n.style.bottom = "32px", n.style.color = "green", document.body.appendChild(e.gamepadDOMInfo)
        }, e.prototype._insertGamepadDOMNotSupported = function() {
            e.gamepadDOMInfo = document.createElement("div");
            var t = document.createElement("span");
            t.innerHTML = "<strong>gamepad not supported</strong>", e.gamepadDOMInfo.appendChild(t), e.gamepadDOMInfo.style.position = "absolute", e.gamepadDOMInfo.style.width = "100%", e.gamepadDOMInfo.style.height = "40px", e.gamepadDOMInfo.style.bottom = "0px", e.gamepadDOMInfo.style.backgroundColor = "rgba(1, 1, 1, 0.15)", e.gamepadDOMInfo.style.textAlign = "center", e.gamepadDOMInfo.style.zIndex = "10", t.style.position = "relative", t.style.fontSize = "32px", t.style.color = "red", document.body.appendChild(e.gamepadDOMInfo)
        }, e.prototype.dispose = function() {
            document.body.removeChild(e.gamepadDOMInfo)
        }, e.prototype._onGamepadConnected = function(t) {
            var e = this._addNewGamepad(t.gamepad);
            this._callbackGamepadConnected && this._callbackGamepadConnected(e), this._startMonitoringGamepads()
        }, e.prototype._addNewGamepad = function(n) {
            this.oneGamepadConnected || (this.oneGamepadConnected = !0, e.gamepadDOMInfo && (document.body.removeChild(e.gamepadDOMInfo), e.gamepadDOMInfo = null));
            var i;
            return i = -1 !== n.id.search("Xbox 360") || -1 !== n.id.search("xinput") ? new t.Xbox360Pad(n.id, n.index, n) : new t.GenericPad(n.id, n.index, n), this.babylonGamepads.push(i), i
        }, e.prototype._onGamepadDisconnected = function(t) {
            for (var e in this.babylonGamepads)
                if (this.babylonGamepads[e].index == t.gamepad.index) {
                    this.babylonGamepads.splice(e, 1);
                    break
                }
            0 == this.babylonGamepads.length && this._stopMonitoringGamepads()
        }, e.prototype._startMonitoringGamepads = function() {
            this.isMonitoring || (this.isMonitoring = !0, this._checkGamepadsStatus())
        }, e.prototype._stopMonitoringGamepads = function() {
            this.isMonitoring = !1
        }, e.prototype._checkGamepadsStatus = function() {
            var t = this;
            this._updateGamepadObjects();
            for (var e in this.babylonGamepads)
                this.babylonGamepads[e].update();
            this.isMonitoring && (window.requestAnimationFrame ? window.requestAnimationFrame(function() {
                                                                                              t._checkGamepadsStatus()
                                                                                              }) : window.mozRequestAnimationFrame ? window.mozRequestAnimationFrame(function() {
                                                                                                                                                                     t._checkGamepadsStatus()
                                                                                                                                                                     }) : window.webkitRequestAnimationFrame && window.webkitRequestAnimationFrame(function() {
                                                                                                                                                                                                                                                   t._checkGamepadsStatus()
                                                                                                                                                                                                                                                   }))
        }, e.prototype._updateGamepadObjects = function() {
            for (var t = navigator.getGamepads ? navigator.getGamepads() : navigator.webkitGetGamepads ? navigator.webkitGetGamepads() : [], e = 0; e < t.length; e++)
                if (t[e])
                    if (t[e].index in this.babylonGamepads)
                        this.babylonGamepads[e].browserGamepad = t[e];
                    else {
                        var n = this._addNewGamepad(t[e]);
                        this._callbackGamepadConnected && this._callbackGamepadConnected(n)
                    }
        }, e
    }();
    t.Gamepads = e;
    var n = function() {
        function t(t, e) {
            this.x = t, this.y = e
        }
        return t
    }();
    t.StickValues = n;
    var i = function() {
        function t(t, e, n) {
            this.id = t, this.index = e, this.browserGamepad = n, this.browserGamepad.axes.length >= 2 && (this._leftStick = {x: this.browserGamepad.axes[0],y: this.browserGamepad.axes[1]}), this.browserGamepad.axes.length >= 4 && (this._rightStick = {x: this.browserGamepad.axes[2],y: this.browserGamepad.axes[3]})
        }
        return t.prototype.onleftstickchanged = function(t) {
            this._onleftstickchanged = t
        }, t.prototype.onrightstickchanged = function(t) {
            this._onrightstickchanged = t
        }, Object.defineProperty(t.prototype, "leftStick", {get: function() {
                                 return this._leftStick
                                 },set: function(t) {
                                 !this._onleftstickchanged || this._leftStick.x === t.x && this._leftStick.y === t.y || this._onleftstickchanged(t), this._leftStick = t
                                 },enumerable: !0,configurable: !0}), Object.defineProperty(t.prototype, "rightStick", {get: function() {
                                                                                            return this._rightStick
                                                                                            },set: function(t) {
                                                                                            !this._onrightstickchanged || this._rightStick.x === t.x && this._rightStick.y === t.y || this._onrightstickchanged(t), this._rightStick = t
                                                                                            },enumerable: !0,configurable: !0}), t.prototype.update = function() {
            this._leftStick && (this.leftStick = {x: this.browserGamepad.axes[0],y: this.browserGamepad.axes[1]}), this._rightStick && (this.rightStick = {x: this.browserGamepad.axes[2],y: this.browserGamepad.axes[3]})
        }, t
    }();
    t.Gamepad = i;
    var o = function(t) {
        function e(e, n, i) {
            t.call(this, e, n, i), this.id = e, this.index = n, this.gamepad = i, this._buttons = new Array(i.buttons.length)
        }
        return __extends(e, t), e.prototype.onbuttondown = function(t) {
            this._onbuttondown = t
        }, e.prototype.onbuttonup = function(t) {
            this._onbuttonup = t
        }, e.prototype._setButtonValue = function(t, e, n) {
            return t !== e && (this._onbuttondown && 1 === t && this._onbuttondown(n), this._onbuttonup && 0 === t && this._onbuttonup(n)), t
        }, e.prototype.update = function() {
            t.prototype.update.call(this);
            for (var e = 0; e < this._buttons.length; e++)
                this._buttons[e] = this._setButtonValue(this.gamepad.buttons[e].value, this._buttons[e], e)
                }, e
    }(i);
    t.GenericPad = o, function(t) {
        t[t.A = 0] = "A", t[t.B = 1] = "B", t[t.X = 2] = "X", t[t.Y = 3] = "Y", t[t.Start = 4] = "Start", t[t.Back = 5] = "Back", t[t.LB = 6] = "LB", t[t.RB = 7] = "RB", t[t.LeftStick = 8] = "LeftStick", t[t.RightStick = 9] = "RightStick"
    }(t.Xbox360Button || (t.Xbox360Button = {}));
    t.Xbox360Button;
    !function(t) {
        t[t.Up = 0] = "Up", t[t.Down = 1] = "Down", t[t.Left = 2] = "Left", t[t.Right = 3] = "Right"
    }(t.Xbox360Dpad || (t.Xbox360Dpad = {}));
    var r = (t.Xbox360Dpad, function(t) {
             function e() {
             t.apply(this, arguments), this._leftTrigger = 0, this._rightTrigger = 0, this._buttonA = 0, this._buttonB = 0, this._buttonX = 0, this._buttonY = 0, this._buttonBack = 0, this._buttonStart = 0, this._buttonLB = 0, this._buttonRB = 0, this._buttonLeftStick = 0, this._buttonRightStick = 0, this._dPadUp = 0, this._dPadDown = 0, this._dPadLeft = 0, this._dPadRight = 0
             }
             return __extends(e, t), e.prototype.onlefttriggerchanged = function(t) {
             this._onlefttriggerchanged = t
             }, e.prototype.onrighttriggerchanged = function(t) {
             this._onrighttriggerchanged = t
             }, Object.defineProperty(e.prototype, "leftTrigger", {get: function() {
                                      return this._leftTrigger
                                      },set: function(t) {
                                      this._onlefttriggerchanged && this._leftTrigger !== t && this._onlefttriggerchanged(t), this._leftTrigger = t
                                      },enumerable: !0,configurable: !0}), Object.defineProperty(e.prototype, "rightTrigger", {get: function() {
                                                                                                 return this._rightTrigger
                                                                                                 },set: function(t) {
                                                                                                 this._onrighttriggerchanged && this._rightTrigger !== t && this._onrighttriggerchanged(t), this._rightTrigger = t
                                                                                                 },enumerable: !0,configurable: !0}), e.prototype.onbuttondown = function(t) {
             this._onbuttondown = t
             }, e.prototype.onbuttonup = function(t) {
             this._onbuttonup = t
             }, e.prototype.ondpaddown = function(t) {
             this._ondpaddown = t
             }, e.prototype.ondpadup = function(t) {
             this._ondpadup = t
             }, e.prototype._setButtonValue = function(t, e, n) {
             return t !== e && (this._onbuttondown && 1 === t && this._onbuttondown(n), this._onbuttonup && 0 === t && this._onbuttonup(n)), t
             }, e.prototype._setDPadValue = function(t, e, n) {
             return t !== e && (this._ondpaddown && 1 === t && this._ondpaddown(n), this._ondpadup && 0 === t && this._ondpadup(n)), t
             }, Object.defineProperty(e.prototype, "buttonA", {get: function() {
                                      return this._buttonA
                                      },set: function(t) {
                                      this._buttonA = this._setButtonValue(t, this._buttonA, 0)
                                      },enumerable: !0,configurable: !0}), Object.defineProperty(e.prototype, "buttonB", {get: function() {
                                                                                                 return this._buttonB
                                                                                                 },set: function(t) {
                                                                                                 this._buttonB = this._setButtonValue(t, this._buttonB, 1)
                                                                                                 },enumerable: !0,configurable: !0}), Object.defineProperty(e.prototype, "buttonX", {get: function() {
                                                                                                                                                            return this._buttonX
                                                                                                                                                            },set: function(t) {
                                                                                                                                                            this._buttonX = this._setButtonValue(t, this._buttonX, 2)
                                                                                                                                                            },enumerable: !0,configurable: !0}), Object.defineProperty(e.prototype, "buttonY", {get: function() {
                                                                                                                                                                                                                       return this._buttonY
                                                                                                                                                                                                                       },set: function(t) {
                                                                                                                                                                                                                       this._buttonY = this._setButtonValue(t, this._buttonY, 3)
                                                                                                                                                                                                                       },enumerable: !0,configurable: !0}), Object.defineProperty(e.prototype, "buttonStart", {get: function() {
                                                                                                                                                                                                                                                                                  return this._buttonStart
                                                                                                                                                                                                                                                                                  },set: function(t) {
                                                                                                                                                                                                                                                                                  this._buttonStart = this._setButtonValue(t, this._buttonStart, 4)
                                                                                                                                                                                                                                                                                  },enumerable: !0,configurable: !0}), Object.defineProperty(e.prototype, "buttonBack", {get: function() {
                                                                                                                                                                                                                                                                                                                                             return this._buttonBack
                                                                                                                                                                                                                                                                                                                                             },set: function(t) {
                                                                                                                                                                                                                                                                                                                                             this._buttonBack = this._setButtonValue(t, this._buttonBack, 5)
                                                                                                                                                                                                                                                                                                                                             },enumerable: !0,configurable: !0}), Object.defineProperty(e.prototype, "buttonLB", {get: function() {
                                                                                                                                                                                                                                                                                                                                                                                                        return this._buttonLB
                                                                                                                                                                                                                                                                                                                                                                                                        },set: function(t) {
                                                                                                                                                                                                                                                                                                                                                                                                        this._buttonLB = this._setButtonValue(t, this._buttonLB, 6)
                                                                                                                                                                                                                                                                                                                                                                                                        },enumerable: !0,configurable: !0}), Object.defineProperty(e.prototype, "buttonRB", {get: function() {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                   return this._buttonRB
                                                                                                                                                                                                                                                                                                                                                                                                                                                                   },set: function(t) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                   this._buttonRB = this._setButtonValue(t, this._buttonRB, 7)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                   },enumerable: !0,configurable: !0}), Object.defineProperty(e.prototype, "buttonLeftStick", {get: function() {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              return this._buttonLeftStick
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              },set: function(t) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              this._buttonLeftStick = this._setButtonValue(t, this._buttonLeftStick, 8)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              },enumerable: !0,configurable: !0}), Object.defineProperty(e.prototype, "buttonRightStick", {get: function() {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         return this._buttonRightStick
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         },set: function(t) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         this._buttonRightStick = this._setButtonValue(t, this._buttonRightStick, 9)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         },enumerable: !0,configurable: !0}), Object.defineProperty(e.prototype, "dPadUp", {get: function() {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    return this._dPadUp
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    },set: function(t) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    this._dPadUp = this._setDPadValue(t, this._dPadUp, 0)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    },enumerable: !0,configurable: !0}), Object.defineProperty(e.prototype, "dPadDown", {get: function() {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               return this._dPadDown
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               },set: function(t) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               this._dPadDown = this._setDPadValue(t, this._dPadDown, 1)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               },enumerable: !0,configurable: !0}), Object.defineProperty(e.prototype, "dPadLeft", {get: function() {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          return this._dPadLeft
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          },set: function(t) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          this._dPadLeft = this._setDPadValue(t, this._dPadLeft, 2)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          },enumerable: !0,configurable: !0}), Object.defineProperty(e.prototype, "dPadRight", {get: function() {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     return this._dPadRight
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     },set: function(t) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     this._dPadRight = this._setDPadValue(t, this._dPadRight, 3)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     },enumerable: !0,configurable: !0}), e.prototype.update = function() {
             t.prototype.update.call(this), this.buttonA = this.browserGamepad.buttons[0].value, this.buttonB = this.browserGamepad.buttons[1].value, this.buttonX = this.browserGamepad.buttons[2].value, this.buttonY = this.browserGamepad.buttons[3].value, this.buttonLB = this.browserGamepad.buttons[4].value, this.buttonRB = this.browserGamepad.buttons[5].value, this.leftTrigger = this.browserGamepad.buttons[6].value, this.rightTrigger = this.browserGamepad.buttons[7].value, this.buttonBack = this.browserGamepad.buttons[8].value, this.buttonStart = this.browserGamepad.buttons[9].value, this.buttonLeftStick = this.browserGamepad.buttons[10].value, this.buttonRightStick = this.browserGamepad.buttons[11].value, this.dPadUp = this.browserGamepad.buttons[12].value, this.dPadDown = this.browserGamepad.buttons[13].value, this.dPadLeft = this.browserGamepad.buttons[14].value, this.dPadRight = this.browserGamepad.buttons[15].value
             }, e
             }(i));
    t.Xbox360Pad = r
}(BABYLON || (BABYLON = {}));
var __extends = this.__extends || function(t, e) {
    function n() {
        this.constructor = t
    }
    for (var i in e)
        e.hasOwnProperty(i) && (t[i] = e[i]);
    n.prototype = e.prototype, t.prototype = new n
}, BABYLON;
!function(t) {
    var e = function(e) {
        function n(n, i, o) {
            var r = this;
            e.call(this, n, i, o), this.angularSensibility = 200, this.moveSensibility = 75, this._gamepads = new t.Gamepads(function(t) {
                                                                                                                             r._onNewGameConnected(t)
                                                                                                                             })
        }
        return __extends(n, e), n.prototype._onNewGameConnected = function(t) {
            0 === t.index && (this._gamepad = t)
        }, n.prototype._checkInputs = function() {
            if (this._gamepad) {
                var e = this._gamepad.leftStick, n = e.x / this.moveSensibility, i = e.y / this.moveSensibility;
                e.x = Math.abs(n) > .005 ? 0 + n : 0, e.y = Math.abs(i) > .005 ? 0 + i : 0;
                var o = this._gamepad.rightStick, r = o.x / this.angularSensibility, s = o.y / this.angularSensibility;
                o.x = Math.abs(r) > .001 ? 0 + r : 0, o.y = Math.abs(s) > .001 ? 0 + s : 0;
                var a = t.Matrix.RotationYawPitchRoll(this.rotation.y, this.rotation.x, 0), l = t.Vector3.TransformCoordinates(new t.Vector3(e.x, 0, -e.y), a);
                this.cameraDirection = this.cameraDirection.add(l), this.cameraRotation = this.cameraRotation.add(new t.Vector3(o.y, o.x, 0))
            }
        }, n.prototype.dispose = function() {
            this._gamepads.dispose()
        }, n
    }(t.FreeCamera);
    t.GamepadCamera = e
}(BABYLON || (BABYLON = {}));
var __extends = this.__extends || function(t, e) {
    function n() {
        this.constructor = t
    }
    for (var i in e)
        e.hasOwnProperty(i) && (t[i] = e[i]);
    n.prototype = e.prototype, t.prototype = new n
}, BABYLON;
!function(t) {
    var e = function(e) {
        function n(n, i, o) {
            "undefined" == typeof o && (o = !1), e.call(this, n, i), this.color = new t.Color3(1, 1, 1), this._indices = new Array, this._colorShader = new t.ShaderMaterial("colorShader", i, "color", {attributes: ["position"],uniforms: ["worldViewProjection", "color"]})
        }
        return __extends(n, e), Object.defineProperty(n.prototype, "material", {get: function() {
                                                      return this._colorShader
                                                      },enumerable: !0,configurable: !0}), Object.defineProperty(n.prototype, "isPickable", {get: function() {
                                                                                                                 return !1
                                                                                                                 },enumerable: !0,configurable: !0}), Object.defineProperty(n.prototype, "checkCollisions", {get: function() {
                                                                                                                                                                            return !1
                                                                                                                                                                            },enumerable: !0,configurable: !0}), n.prototype._bind = function() {
            var e = this.getScene().getEngine(), n = this._geometry.getIndexBuffer();
            e.bindBuffers(this._geometry.getVertexBuffer(t.VertexBuffer.PositionKind).getBuffer(), n, [3], 12, this._colorShader.getEffect()), this._colorShader.setColor3("color", this.color)
        }, n.prototype._draw = function(t) {
            if (this._geometry && this._geometry.getVertexBuffers() && this._geometry.getIndexBuffer()) {
                var e = this.getScene().getEngine();
                e.draw(!1, t.indexStart, t.indexCount)
            }
        }, n.prototype.intersects = function() {
            return null
        }, n.prototype.dispose = function(t) {
            this._colorShader.dispose(), e.prototype.dispose.call(this, t)
        }, n
    }(t.Mesh);
    t.LinesMesh = e
}(BABYLON || (BABYLON = {})), BABYLON.Vector2.prototype.distanceTo = function(t) {
    return Math.sqrt(this.distanceToSquared(t))
}, BABYLON.Vector2.prototype.distanceToSquared = function(t) {
    var e = t.x - this.x, n = t.y - this.y;
    return e * e + n * n
}, BABYLON.Vector2.FromArrayToRef = function(t, e, n) {
    e || (e = 0), n.x = t[e], n.y = t[e + 1]
}, BABYLON.Vector2.prototype.distToSegment = function(t, e) {
    var n = t.distanceToSquared(e);
    if (0 == n)
        return this.distanceTo(t);
    var i = this.subtract(t).dot(e.subtract(t)) / n, o = t.add(e.subtract(t).scale(i));
    return this.distanceTo(o)
}, BABYLON.Vector3.prototype.distanceTo = function(t) {
    return Math.sqrt(this.distanceToSquared(t))
}, BABYLON.Vector3.prototype.distanceToSquared = function(t) {
    var e = t.x - this.x, n = t.y - this.y, i = t.z - this.z;
    return e * e + n * n + i * i
}, BABYLON.Vector3.prototype.minimize = function(t) {
    return this.x = this.x < t.x ? this.x : t.x, this.y = this.y < t.y ? this.y : t.y, this.z = this.z < t.z ? this.z : t.z, this
}, BABYLON.Vector3.prototype.maximize = function(t) {
    return this.x = this.x > t.x ? this.x : t.x, this.y = this.y > t.y ? this.y : t.y, this.z = this.z > t.z ? this.z : t.z, this
}, BABYLON.Vector2.prototype.copyFrom = function(t) {
    return this.x = t.x, this.y = t.y, this
}, BABYLON.Vector2.prototype.copyFromFloats = function(t, e) {
    return this.x = t, this.y = e, this
}, BABYLON.Vector2.prototype.addInPlace = function(t) {
    return this.x += t.x, this.y += t.y, this
}, BABYLON.Vector2.prototype.subtractInPlace = function(t) {
    return this.x -= t.x, this.y -= t.y, this
}, BABYLON.Vector2.prototype.subtractToRef = function(t, e) {
    e.x = this.x - t.x, e.y = this.y - t.y
}, BABYLON.Vector2.prototype.lerp = function(t, e) {
    return this.x = this.x + (t.x - this.x) * e, this.y = this.y + (t.y - this.y) * e, this
}, BABYLON.Vector3.prototype.lerp = function(t, e) {
    return this.x = this.x + (t.x - this.x) * e, this.y = this.y + (t.y - this.y) * e, this.z = this.z + (t.z - this.z) * e, this
}, BABYLON.Vector2.prototype.projectOnVector = function() {
    var t = new BABYLON.Vector2;
    return function(e) {
        t.copyFrom(e).normalize();
        var n = this.dot(t);
        return this.copyFrom(t).scaleInPlace(n)
    }
}(), BABYLON.Vector3.prototype.projectOnVector = function() {
    var t = new BABYLON.Vector3;
    return function(e) {
        t.copyFrom(e).normalize();
        var n = this.dot(t);
        return this.copyFrom(t).scaleInPlace(n)
    }
}(), BABYLON.Vector2.prototype.projectOnSegment = function(t, e) {
    var n = e.x - t.x, i = e.y - t.y, o = n * n + i * i, r = ((this.x - t.x) * n + (this.y - t.y) * i) / o;
    return r = BABYLON.Math.clamp(r, 0, 1), new BABYLON.Vector2(t.x + r * n, t.y + r * i)
}, BABYLON.Color3.prototype.fromHex = function(t) {
    if (/^\#([0-9a-f]{6})$/i.test(t))
        var t = parseInt(/^\#([0-9a-f]{6})$/i.exec(t)[1], 16);
    return t = Math.floor(t), this.r = (t >> 16 & 255) / 255, this.g = (t >> 8 & 255) / 255, this.b = (255 & t) / 255, this
};
var roundTo = function(t) {
    return Math.round(1e5 * t) / 1e5
};
BABYLON.Vector2.prototype.isPointInPolygon = function(t) {
    var e, n, i, o, r = this.clone();
    r.x = roundTo(r.x), r.y = roundTo(r.y);
    for (var s = t.length, a = !1, l = 0; s > l; l++)
        e = roundTo(t[l].x), n = roundTo(t[l].y), i = roundTo(t[(l + 1) % s].x), o = roundTo(t[(l + 1) % s].y), o === n && o === r.y ? (e <= r.x && r.x < i || i <= r.x && r.x < e) && (a = !a) : (n <= r.y && r.y < o || o <= r.y && r.y < n) && r.x <= roundTo((i - e) * (r.y - n) / (o - n) + e) && (a = !a);
    return a
}, BABYLON.Ray.prototype.closestPointToPoint = function(t) {
    var e = t.subtract(this.origin), n = e.dot(this.direction);
    return e.copyFrom(this.direction).scale(n).add(this.origin)
}, BABYLON.Vector2.prototype.dot = function(t) {
    return BABYLON.Vector2.Dot(this, t)
}, BABYLON.Vector3.prototype.dot = function(t) {
    return BABYLON.Vector3.Dot(this, t)
}, BABYLON.Vector3.prototype.cross = function() {
    var t = new BABYLON.Vector3;
    return function(e) {
        return BABYLON.Vector3.CrossToRef(this, e, t), this.copyFrom(t), this
    }
}(), BABYLON.Vector3.prototype.toSpherical = function() {
    var t = this.length(), e = Math.acos(this.y / t), n = Math.atan2(this.z, this.x);
    return {r: t,alpha: n,beta: e}
}, BABYLON.Vector3.FromSphericalToRef = function(t, e, n, i) {
    i.x = t * Math.cos(e) * Math.sin(n), i.y = t * Math.cos(n), i.z = t * Math.sin(e) * Math.sin(n)
}, BABYLON.Vector3.FromSpherical = function(t, e, n) {
    var i = new BABYLON.Vector3;
    return BABYLON.Vector3.FromSphericalToRef(t, e, n, i), i
}, BABYLON.Vector2.prototype.determinant = function(t) {
    return this.x * t.y - this.y * t.x
}, BABYLON.Math = BABYLON.Math || {}, BABYLON.Math.clamp = function(t, e, n) {
    return e > t ? e : t > n ? n : t
}, BABYLON.Math.NormalizeAngle = function(t, e) {
    return t %= 2 * Math.PI, t += 2 * Math.PI, t %= 2 * Math.PI, e ? t : t = t > Math.PI ? t - 2 * Math.PI : t
}, BABYLON.Math.ClosestAngle = function(t, e) {
    var n = 2 * Math.PI;
    return t = (t % n + n) % n, rb = Math.floor(e / n), t += rb * n, Math.abs(e - t) > Math.PI && (t += e > t ? n : -n), t
}, BABYLON.Vector2.Precision = 1e-5, BABYLON.Vector2.IntersectIsOn = function() {
    var t, e, n, i, o, r, s, a, l;
    return function(h, c, u, p, d, m) {
        var d = d || BABYLON.Vector2.Precision, m = m || Math.PI / 20;
        if (i = c.x - h.x, o = c.y - h.y, r = p.x - u.x, s = p.y - u.y, n = i * s - o * r, Math.abs(n) < m)
            return void 0;
        n = 1 / n, t = ((h.y - u.y) * r - (h.x - u.x) * s) * n, e = ((h.y - u.y) * i - (h.x - u.x) * o) * n;
        var g = new BABYLON.Vector2(h.x + t * i, h.y + t * o);
        return a = d / Math.sqrt(i * i + o * o), l = d / Math.sqrt(r * r + s * s), {intersect: g,isOn: t >= -a && 1 + a >= t && e >= -l && 1 + l >= e}
    }
}(), BABYLON.Vector2.Intersect = function(t, e, n, i, o) {
    var r, s, a, l = o || BABYLON.Vector2.Precision, h = new BABYLON.Vector2, c = new BABYLON.Vector2;
    return h = e.subtract(t), c = i.subtract(n), r = h.y * t.x - h.x * t.y, s = c.y * n.x - c.x * n.y, a = h.determinant(c), detnorm = h.clone().normalize().determinant(c.clone().normalize()), Math.abs(detnorm) < l ? void 0 : new BABYLON.Vector2((h.x * s - c.x * r) / a, (h.y * s - c.y * r) / a)
}, BABYLON.Vector2.IntersectIsOnOLD = function(t, e, n, i, o, r) {
    var o = o || BABYLON.Vector2.Precision, r = r || Math.PI / 20, s = new BABYLON.Vector2, a = new BABYLON.Vector2;
    if (s = e.subtract(t), a = i.subtract(n), cprime = a.y * n.x - a.x * n.y, det = s.determinant(a), detnorm = s.clone().normalize().determinant(a.clone().normalize()), Math.abs(detnorm) < r)
        return void 0;
    var l = new BABYLON.Vector2((s.x * cprime - a.x * c) / det, (s.y * cprime - a.y * c) / det), h = Math.abs(e.x - t.x) >= BABYLON.Vector2.Precision ? (l.x - t.x) / (e.x - t.x) : (l.y - t.y) / (e.y - t.y), u = Math.abs(i.x - n.x) >= BABYLON.Vector2.Precision ? (l.x - n.x) / (i.x - n.x) : (l.y - n.y) / (i.y - n.y), p = o / s.length(), d = o / a.length();
    return {intersect: l,isOn: h >= -p && 1 + p >= h && u >= -d && 1 + d >= u}
}, BABYLON.Vector2.prototype.isOnSegment = function(t, e) {
    var n = .1, i = e.subtract(t), o = i.length();
    i.scaleInPlace(1 / o);
    var r = this.subtract(t), s = i.x * r.y - i.y * r.x, a = i.dot(r);
    return Math.abs(s) < n && a >= 0 && o >= a
}, BABYLON.Vector2.SegmentIntersection = function(t, e, n, i, o, r) {
    var r = r || Math.PI / 200, s = BABYLON.Vector2.IntersectIsOn(t, e, n, i, o, r);
    return s && s.isOn ? s.intersect : null
}, BABYLON.Vector2.GetAbsoluteSine = function(t, e, n, i) {
    var o = new BABYLON.Vector2, r = new BABYLON.Vector2;
    return t.subtractToRef(e, o), n.subtractToRef(i, r), o.normalize(), r.normalize(), Math.abs(o.determinant(r))
}, BABYLON.BoundingBox.ExpandFromPoint = function(t, e, n) {
    t.x < e.x ? e.x = t.x : t.x > n.x && (n.x = t.x), t.y < e.y ? e.y = t.y : t.y > n.y && (n.y = t.y), t.z < e.z ? e.z = t.z : t.z > n.z && (n.z = t.z)
}, BABYLON.BoundingBox.CreateFromPoints = function(t) {
    if (!(t.length > 0))
        return BABYLON.BoundingBox.Zero();
    for (var e = t[0], n = e.clone(), i = e.clone(), o = 1, r = t.length; r > o; o++)
        BABYLON.BoundingBox.ExpandFromPoint(t[o], n, i);
    return new BABYLON.BoundingBox(n, i)
}, BABYLON.BoundingBox.Zero = function() {
    return new BABYLON.BoundingBox(new BABYLON.Vector3(0, 0, 0), new BABYLON.Vector3(0, 0, 0))
}, BABYLON.BoundingBox.prototype.intersect = function(t) {
    return this.minimum.max(t.minimum), this.maximum.min(t.maximum), this
}, BABYLON.BoundingBox.prototype.union = function(t) {
    return this.minimum.min(t.minimum), this.maximum.max(t.maximum), this
}, BABYLON.Vector2.prototype.min = function(t) {
    return this.x = this.x < t.x ? this.x : t.x, this.y = this.y < t.y ? this.y : t.y, this
}, BABYLON.Vector2.prototype.max = function(t) {
    return this.x = this.x > t.x ? this.x : t.x, this.y = this.y > t.y ? this.y : t.y, this
}, BABYLON.Vector3.prototype.min = function(t) {
    return this.x = this.x < t.x ? this.x : t.x, this.y = this.y < t.y ? this.y : t.y, this.z = this.z < t.z ? this.z : t.z, this
}, BABYLON.Vector3.prototype.max = function(t) {
    return this.x = this.x > t.x ? this.x : t.x, this.y = this.y > t.y ? this.y : t.y, this.z = this.z > t.z ? this.z : t.z, this
}, BABYLON.Quaternion.RotationFromXtoX_ = function(t, e) {
    var n = BABYLON.Vector3.Cross(t, e).normalize();
    n.lengthSquared() < .001 && (n = BABYLON.Vector3.Cross(t, Math.abs(t.x) > .9 ? new BABYLON.Vector3(0, 0, 1) : new BABYLON.Vector3(1, 0, 0)).normalize());
    var i = Math.acos(Math.min(Math.max(BABYLON.Vector3.Dot(t, e), -1), 1));
    return BABYLON.Quaternion.RotationAxis(n, i)
}, BABYLON.Quaternion.RotationFromXtoX_2 = function(t, e, n, i) {
    var o = BABYLON.Vector3.Cross(t, n).normalize(), r = BABYLON.Vector3.Cross(e, i).normalize();
    o.lengthSquared() < .001 && (o = BABYLON.Vector3.Cross(t, Math.abs(t.x) > .9 ? new BABYLON.Vector3(0, 0, 1) : new BABYLON.Vector3(1, 0, 0)).normalize()), r.lengthSquared() < .001 && (r = BABYLON.Vector3.Cross(e, Math.abs(e.x) > .9 ? new BABYLON.Vector3(0, 0, 1) : new BABYLON.Vector3(1, 0, 0)).normalize());
    var s = BABYLON.Quaternion.RotationFromXtoX_(o, r), l = new BABYLON.Matrix;
    s.toRotationMatrix(l);
    var h = BABYLON.Vector3.TransformCoordinates(t, l);
    w = BABYLON.Vector3.Cross(h, e).normalize(), a = Math.acos(Math.min(Math.max(BABYLON.Vector3.Dot(h, e), -1), 1));
    var c = r;
    BABYLON.Vector3.Dot(w, c) < .9 && (c = c.scale(-1));
    var u = BABYLON.Quaternion.RotationAxis(c, a);
    return u.multiply(s)
}, BABYLON.Mesh.prototype.getMaterial = function(t) {
    for (var e = 0, n = this.subMeshes.length; n > e; e++)
        if (3 * t >= this.subMeshes[e].indexStart && 3 * t < this.subMeshes[e].indexStart + this.subMeshes[e].indexCount)
            return this.subMeshes[e].getMaterial();
    return null
}, BABYLON.Mesh.prototype.initMaterials = function(t) {
    for (var e in t)
        this.traverse(function(n) {
                      n.name === e && (n.material = t[e])
                      })
        }, BABYLON.Mesh.prototype.invertFaces = function() {
            for (var t, e = this.getIndices(), n = 0; n < e.length; n += 3)
                t = e[n], e[n] = e[n + 2], e[n + 2] = t;
            this.setIndices(e)
        }, BABYLON.Mesh.prototype.invertNormales = function() {
            for (var t = this.getVerticesData(BABYLON.VertexBuffer.NormalKind), e = 0; e < t.length; e++)
                t[e] *= -1;
            this.setVerticesData(BABYLON.VertexBuffer.NormalKind, t)
        }, BABYLON.Ray.prototype.intersectMeshes = function(t, e, n) {
            for (var i, o, r, s, a = +1 / 0, l = new BABYLON.Matrix, h = 0, c = t.length; c > h; h++)
                s = t[h].name && -1 != t[h].name.indexOf("_sprite_"), (t[h].isVisible || s) && (s && t[h].sprite.updateCollider(), t[h].getWorldMatrix().invertToRef(l), r = BABYLON.Ray.Transform(this, l), r.direction.normalize(), i = t[h].intersects(r, !1, e, n), i.hit && i.distance < a && (o = i, a = i.distance));
            return o
        }, BABYLON.Ray.prototype.distanceToPlane = function(t) {
            var e = t.normal.dot(this.direction);
            if (0 == e)
                return 0 == Math.abs(t.signedDistanceTo(this.origin)) ? 0 : null;
            var n = -(this.origin.dot(t.normal) + t.d) / e;
            return n >= 0 ? n : null
        }, BABYLON.Ray.prototype.intersectPlane = function(t) {
            var e = this.distanceToPlane(t);
            return null === e ? null : this.origin.add(this.direction.scale(e))
        }, BABYLON.Mesh.CreateBloc = function(t, e, n, i, o) {
            e = e || .01, n = n || .01, i = i || .01;
            var r = new BABYLON.Mesh.CreateBox(t, e, o);
            return r.bakeTransformIntoVertices(BABYLON.Matrix.Scaling(1, n / e, i / e)), r
        }, BABYLON.Mesh.CreatePlan = function(t, e, n, i) {
            (0 == n || 0 == e) && console.log("trying to create a bloc with 0 dimension, will probably fail");
            var o = new BABYLON.Mesh.CreatePlane(t, e, i);
            return o.scaling.y = n / e, o
        }, BABYLON.Mesh.Triangulate = function(t, e, n, o) {
            for (var r, s = t.slice(0), a = [], l = 0, o = o || 0, h = n && n.indices ? n.indices : [], c = n && n.positions ? n.positions : [], u = n && n.normals ? n.normals : [], p = t[t.length - 1], d = 1e-5, m = 0, g = t.length; g > m; m++)
                p.distanceTo(t[m]) > d && (r = new poly2tri.Point(t[m].x, t[m].y), r.index = l++, a.push(r)), p = t[m];
            if (!(a.length < 3)) {
                var f = new poly2tri.SweepContext(a);
                for (var y in e) {
                    var _ = e[y], v = [];
                    for (i in _)
                        r = new poly2tri.Point(_[i].x, _[i].y), r.index = l++, v.push(r), s.push(_[i]);
                    f.addHole(v)
                }
                for (var m = 0, g = s.length; g > m; m++)
                    c.push(s[m].x, o, -s[m].y);
                try {
                    f.triangulate()
                } catch (b) {
                    return Logger.warning("Erreur de triangulation : " + b.message), null
                }
                var w, x = f.getTriangles();
                x.forEach(function(t) {
                          w = t.getPoints();
                          for (var e = w.length - 1; e >= 0; e--)
                          h.push(w[e].index)
                          });
                var C = BABYLON.Tools.PlaneUVProjection(c, new BABYLON.Vector3(1, 0, 0), new BABYLON.Vector3(0, 0, 1), 512);
                return n && (n.uvs = C), BABYLON.VertexData.ComputeNormals(c, h, u), n || {positions: c,normals: u,indices: h,uvs: C}
            }
        }, BABYLON.Mesh.TriangulateNewMesh = function(t, e, n, i, o) {
            var r = new BABYLON.Mesh(t, i), s = BABYLON.Mesh.Triangulate(e, n, void 0, o);
            return s ? (r.setVerticesData(BABYLON.VertexBuffer.PositionKind, s.positions), r.setVerticesData(BABYLON.VertexBuffer.NormalKind, s.normals), r.setVerticesData(BABYLON.VertexBuffer.UVKind, s.uvs), r.setIndices(s.indices), r) : null
        }, BABYLON.Mesh.prototype.centerGeometry = function(t) {
            var t = t || "y", e = this.getBoundingBox(!0), n = e.center;
            if (this.isVerticesDataPresent(BABYLON.VertexBuffer.PositionKind))
                for (var i = this.getVerticesData(BABYLON.VertexBuffer.PositionKind), o = 0, r = i.length; r > o; o += 3)
                    i[o] -= n.x, i[o + 1] -= n.y + e.extends[t], i[o + 2] -= n.z;
            for (var s = this.getChildren(), o = 0, a = s.length; a > o; o++)
                s[o].position.subtractInPlace(n), s[o].position[t] += e.extends[t]
                }, BABYLON.Mesh.Extrude = function(t, e, n, i) {
                    var n = n || {}, o = i && i.indices ? i.indices : [], r = i && i.positions ? i.positions : [], s = i && i.normals ? i.normals : [], a = [], l = BABYLON.Mesh.Triangulate(t, e);
                    if (!l)
                        return null;
                    for (var h, c = l.positions.length / 3, u = {positions: l.positions.slice(0),normals: l.normals.slice(0),uvs: l.uvs.slice(0),indices: l.indices.slice(0)}, p = 0, d = u.indices.length; d > p; p += 3)
                        h = u.indices[p], u.indices[p] = u.indices[p + 2], u.indices[p + 2] = h;
                    for (var m = void 0 !== n.amount ? n.amount : 5, p = 1, d = l.positions.length; d > p; p += 3)
                        l.positions[p] += m;
                    for (var p = 0, d = u.positions.length; d > p; p++)
                        r.push(u.positions[p]), s.push(u.normals[p]);
                    for (var p = 0, d = l.positions.length; d > p; p++)
                        r.push(l.positions[p]), s.push(l.normals[p]);
                    for (var p = 0, d = u.uvs.length; d > p; p++)
                        a.push(u.uvs[p]);
                    for (var p = 0, d = l.uvs.length; d > p; p++)
                        a.push(l.uvs[p]);
                    for (var p = 0, d = u.indices.length; d > p; p++)
                        o.push(u.indices[p]);
                    for (var p = 0, d = l.indices.length; d > p; p++)
                        o.push(l.indices[p] + c);
                    var g = function(t, e) {
                        for (var n = t.length, i = r.length / 3, l = e ? BABYLON.Tools.Area(t) > 0 : BABYLON.Tools.Area(t) < 0, h = 0; h < t.length; h++)
                            r.push(t[h].x, 0, -t[h].y, t[h].x, m, -t[h].y);
                        for (var h = 0; n > h; h++)
                            a.push(0, 0), a.push(0, 0);
                        for (var c = new BABYLON.Vector2, h = 0; n > h; h++)
                            c.copyFrom(t[(h + 1) % n]).subtractInPlace(t[h]), c.normalize(), l && c.scaleInPlace(-1), s.push(-c.y, 0, -c.x, -c.y, 0, -c.x);
                        for (var h = 0; 2 * n > h; h += 2)
                            l ? (o.push(i + h, i + (h + 2) % (2 * n), i + h + 1), o.push(i + (h + 2) % (2 * n), i + (h + 3) % (2 * n), i + h + 1)) : (o.push(i + h + 1, i + (h + 2) % (2 * n), i + h), o.push(i + h + 1, i + (h + 3) % (2 * n), i + (h + 2) % (2 * n)))
                            };
                    if (g(t), e)
                        for (var p = 0, d = e.length; d > p; p++)
                            g(e[p], !0);
                    return i || {positions: r,normals: s,indices: o,uvs: a}
                }, BABYLON.Mesh.ExtrudeNewMesh = function(t, e, n, i, o) {
                    var r = new BABYLON.Mesh(t, o), s = BABYLON.Mesh.Extrude(e, n, i);
                    return s ? (r.setVerticesData(BABYLON.VertexBuffer.PositionKind, s.positions), r.setVerticesData(BABYLON.VertexBuffer.NormalKind, s.normals), r.setVerticesData(BABYLON.VertexBuffer.UVKind, s.uvs), r.setIndices(s.indices), r) : null
                }, BABYLON.Tools.Area = function(t) {
                    for (var e = t.length, n = 0, i = e - 1, o = 0; e > o; i = o++)
                        n += t[i].x * t[o].y - t[o].x * t[i].y;
                    return .5 * n
                }, BABYLON.Tools.PlaneUVProjection = function(t, e, n, i) {
                    var o;
                    e = e.clone().normalize(), n = n.clone().normalize();
                    var r = BABYLON.Vector3.Cross(e, n), s = [], a = [];
                    if (r.length() < BABYLON.Engine.epsilon)
                        return console.warn("Can't map UVs : basis vectors are linked"), null;
                    if (0 == t.length)
                        return null;
                    var l = BABYLON.Matrix.FromValues(e.x, n.x, r.x, 0, e.y, n.y, r.y, 0, e.z, n.z, r.z, 0, 0, 0, 0, 1);
                    l = BABYLON.Matrix.Transpose(l), l.invert();
                    for (var h = 0, c = t.length; c > h; h += 3)
                        o = new BABYLON.Vector3(t[h], t[h + 1], t[h + 2]), BABYLON.Vector3.TransformCoordinatesToRef(o, l, o), s.push(o.x), a.push(o.y);
                    for (var u = s[0], p = s[0], d = a[0], m = a[0], h = 0, c = s.length; c > h; h++)
                        s[h] < u && (u = s[h]), s[h] > p && (p = s[h]), a[h] < d && (d = a[h]), a[h] > m && (m = a[h]);
                    var g, f;
                    if (void 0 === i && (i = 512), 0 != i ? (g = (p - u) / i * 4, f = (m - d) / i * 4) : (g = 1, f = 1), p === u)
                        for (var h = 0, c = s.length; c > h; h++)
                            s[h] = 0;
                    else
                        for (var h = 0, c = s.length; c > h; h++)
                            s[h] = (s[h] - u) / (p - u) * g;
                    if (m === d)
                        for (var h = 0, c = a.length; c > h; h++)
                            a[h] = 0;
                    else
                        for (var h = 0, c = a.length; c > h; h++)
                            a[h] = (a[h] - d) / (m - d) * f;
                    for (var y = [], h = 0, c = s.length; c > h; h++)
                        y.push(s[h], a[h]);
                    return y
                }, BABYLON.Mesh.ComputeFlatNormal = function(t, e, n) {
                    var i, o = [];
                    for (i = 0; i < t.length; i += 3) {
                        var r = new BABYLON.Vector3(t[i], t[i + 1], t[i + 2]);
                        o.push(r)
                    }
                    var s;
                    for (i = 0; i < n.length / 3; i++) {
                        var a = n[3 * i], l = n[3 * i + 1], h = n[3 * i + 2], c = o[a], u = o[l], p = o[h], d = c.subtract(u), m = p.subtract(u);
                        s = BABYLON.Vector3.Normalize(BABYLON.Vector3.Cross(d, m)), e[3 * a] = s.x, e[3 * a + 1] = s.y, e[3 * a + 2] = s.z, e[3 * l] = s.x, e[3 * l + 1] = s.y, e[3 * l + 2] = s.z, e[3 * h] = s.x, e[3 * h + 1] = s.y, e[3 * h + 2] = s.z
                    }
                }, BABYLON.Mesh.prototype.traverse = function(t) {
                    t(this);
                    for (var e = this.getChildren(), n = 0; n < e.length; n++)
                        e[n].traverse(t)
                        }, BABYLON.Mesh.prototype.getChildByName = function(t, e) {
                            for (var n, i = this.getChildren(), o = 0; o < i.length; o++) {
                                if (i[o].name === t)
                                    return i[o];
                                if (!e && (n = i[o].getChildByName(t)))
                                    return n
                                    }
                            return null
                        }, BABYLON.Mesh.mergeMeshes = function(t, e, n, o) {
                            var r = [], s = [], a = [], l = [], h = [], c = [], u = [], p = [], d = [], m = [], g = new BABYLON.Mesh(t, n), f = !0, y = !0, _ = !0, v = !0, b = !0;
                            for (i = 0; i != e.length; i++)
                                e[i].isVerticesDataPresent([BABYLON.VertexBuffer.UVKind]) || (f = !1), e[i].isVerticesDataPresent([BABYLON.VertexBuffer.UV2Kind]) || (y = !1), e[i].isVerticesDataPresent([BABYLON.VertexBuffer.ColorKind]) || (_ = !1), e[i].isVerticesDataPresent([BABYLON.VertexBuffer.MatricesIndicesKind]) || (v = !1), e[i].isVerticesDataPresent([BABYLON.VertexBuffer.MatricesWeightsKind]) || (b = !1);
                            for (i = 0; i != e.length; i++) {
                                var w = 0, x = 0;
                                r[i] = e[i].getVerticesData(BABYLON.VertexBuffer.PositionKind), s[i] = e[i].getVerticesData(BABYLON.VertexBuffer.NormalKind), f && (a = a.concat(e[i].getVerticesData(BABYLON.VertexBuffer.UVKind))), y && (l = l.concat(e[i].getVerticesData(BABYLON.VertexBuffer.UV2Kind))), _ && (h = h.concat(e[i].getVerticesData(BABYLON.VertexBuffer.ColorKind))), v && (c = c.concat(e[i].getVerticesData(BABYLON.VertexBuffer.MatricesIndicesKind))), b && (u = u.concat(e[i].getVerticesData(BABYLON.VertexBuffer.MatricesWeightsKind)));
                                for (var C = d.length / 3, M = e[i].computeWorldMatrix(!0); w < r[i].length; ) {
                                    var D = new BABYLON.Vector3.TransformCoordinates(new BABYLON.Vector3(r[i][w], r[i][w + 1], r[i][w + 2]), M);
                                    d.push(D.x), d.push(D.y), d.push(D.z), w += 3
                                }
                                for (; x < s[i].length; ) {
                                    var D = new BABYLON.Vector3.TransformNormal(new BABYLON.Vector3(s[i][x], s[i][x + 1], s[i][x + 2]), M);
                                    m.push(D.x), m.push(D.y), m.push(D.z), x += 3
                                }
                                if (i > 0) {
                                    var B = e[i].getIndices();
                                    for (it = 0; it != B.length; it++)
                                        B[it] = B[it] + C;
                                    p = p.concat(B)
                                } else
                                    p = e[i].getIndices()
                                    }
                            if (g.setVerticesData(BABYLON.VertexBuffer.PositionKind, d, !1), g.setVerticesData(BABYLON.VertexBuffer.NormalKind, m, !1), a.length > 0 && g.setVerticesData(BABYLON.VertexBuffer.UVKind, a, !1), l.length > 0 && g.setVerticesData(BABYLON.VertexBuffer.UV2Kind, a, !1), h.length > 0 && g.setVerticesData(BABYLON.VertexBuffer.ColorKind, a, !1), c.length > 0 && g.setVerticesData(BABYLON.VertexBuffer.MatricesIndicesKind, a, !1), u.length > 0 && g.setVerticesData(BABYLON.VertexBuffer.MatricesWeightsKind, a, !1), g.setIndices(p), o) {
                                g.subMeshes = [];
                                var A, C = 0, E = 0;
                                for (i = 0; i != e.length; i++) {
                                    {
                                        g.subMeshes.length
                                    }
                                    i > 0 && (C += e[i - 1].getIndices().length), A = -1;
                                    for (subMesh in e[i].subMeshes) {
                                        var T = BABYLON.SubMesh.CreateFromIndices(e[i].subMeshes[subMesh].materialIndex + E, e[i].subMeshes[subMesh].indexStart + C, e[i].subMeshes[subMesh].indexCount, g);
                                        T.objectInstance = e[i].subMeshes[subMesh].objectInstance, T.boundingBox = e[i].subMeshes[subMesh].boundingBox, A = Math.max(e[i].subMeshes[subMesh].materialIndex, A)
                                    }
                                    E += ++A
                                }
                            }
                            for (i = 0; i != e.length; i++)
                                e[i].dispose(!0);
                            return g
                        }, BABYLON.Mesh.mergeMeshesRec = function(t, e, n, i) {
                            for (var o = [], r = [], s = 0; s < e.length; s++)
                                e[s].traverse(function(t) {
                                              t.computeWorldMatrix(!0), t.isVisible ? o.push(t) : r.push(t)
                                              });
                            var a = BABYLON.Mesh.mergeMeshes(t, o, n, i);
                            return r.forEach(function(t) {
                                             t.dispose(!0)
                                             }), a
                        }, BABYLON.Mesh.ComputeFaceNormal = function(t, e, n) {
                            for (var i = 0; i < n.length; i += 3) {
                                var o = new BABYLON.Vector3(t[3 * n[i]], t[3 * n[i] + 1], t[3 * n[i] + 2]), r = new BABYLON.Vector3(t[3 * n[i + 1]], t[3 * n[i + 1] + 1], t[3 * n[i + 1] + 2]), s = new BABYLON.Vector3(t[3 * n[i + 2]], t[3 * n[i + 2] + 1], t[3 * n[i + 2] + 2]), a = o.subtract(r), l = s.subtract(r);
                                a.cross(l), a.normalize(), e[3 * n[i]] = a.x, e[3 * n[i] + 1] = a.y, e[3 * n[i] + 2] = a.z, e[3 * n[i + 1]] = a.x, e[3 * n[i + 1] + 1] = a.y, e[3 * n[i + 1] + 2] = a.z, e[3 * n[i + 2]] = a.x, e[3 * n[i + 2] + 1] = a.y, e[3 * n[i + 2] + 2] = a.z
                            }
                        }, BABYLON.BoundingBox.CreateFromData = function(t) {
                            if (!(t.length > 0 && t.length % 3 == 0))
                                return BABYLON.BoundingBox.Zero();
                            for (var e = [], n = 0; n < t.length; n += 3)
                                e.push(new BABYLON.Vector3(t[n], t[n + 1], t[n + 2]));
                            return BABYLON.BoundingBox.CreateFromPoints(e)
                        }, BABYLON.Material.prototype.serialize = function() {
                            return {name: this.name}
                        }, BABYLON.Material.prototype.deserialize = function() {
                        }, BABYLON.StandardMaterial.prototype.serialize = function() {
                            var t = BABYLON.Material.prototype.serialize.call(this);
                            return t.class = {name: "BABYLON.StandardMaterial"}, ujs.serializeObject(this, t, ["diffuseTexture", "ambientTexture", "opacityTexture", "reflectionTexture", "emissiveTexture", "specularTexture", "bumpTexture", "ambientColor", "diffuseColor", "specularColor", "specularPower", "emissiveColor"]), t
                        }, BABYLON.MultiMaterial.prototype.serialize = function() {
                            var t = BABYLON.Material.prototype.serialize.call(this);
                            return t.class = {name: "BABYLON.MultiMaterial"}, ujs.serializeObject(this, t, ["subMaterials"]), t
                        }, BABYLON.StandardMaterial.prototype.deserialize = function(t) {
                            return BABYLON.Material.prototype.deserialize.call(this, t), ujs.deserializeObject(t, this, ["diffuseTexture", "ambientTexture", "opacityTexture", "reflectionTexture", "emissiveTexture", "specularTexture", "bumpTexture", "ambientColor", "diffuseColor", "specularColor", "specularPower", "emissiveColor"]), this
                        }, BABYLON.MultiMaterial.prototype.deserialize = function(t) {
                            return BABYLON.Material.prototype.deserialize.call(this, t), ujs.deserializeObject(t, this, ["subMaterials"]), this
                        }, BABYLON.StandardMaterial.Deserialize = function(t) {
                            if (!t)
                                return null;
                            var e = new BABYLON.StandardMaterial(t.name, hcsdesign.engine3D.scene);
                            return e.deserialize(t), e
                        }, BABYLON.MultiMaterial.Deserialize = function(t) {
                            if (!t)
                                return null;
                            var e = new BABYLON.MultiMaterial(t.name, hcsdesign.engine3D.scene);
                            return e.deserialize(t), e
                        }, BABYLON.Vector2.prototype.serialize = function() {
                            var t = {"class": {name: "BABYLON.Vector2"},x: this.x,y: this.y};
                            return t
                        }, BABYLON.Vector2.Deserialize = function(t) {
                            var e = new BABYLON.Vector2(t.x, t.y);
                            return e
                        }, BABYLON.Quaternion.Deserialize = function(t) {
                            var e = new BABYLON.Quaternion(t.x, t.y, t.z, t.w);
                            return e
                        }, BABYLON.Quaternion.prototype.serialize = function() {
                            var t = {"class": {name: "BABYLON.Quaternion"},x: this.x,y: this.y,z: this.z,w: this.w};
                            return t
                        }, BABYLON.Vector3.prototype.serialize = function() {
                            var t = {"class": {name: "BABYLON.Vector3"},x: this.x,y: this.y,z: this.z};
                            return t
                        }, BABYLON.Vector3.prototype.getPositionFromMatrix = function(t) {
                            return this.x = t.m[12], this.y = t.m[13], this.z = t.m[14], this
                        }, BABYLON.Vector3.prototype.getScaleFromMatrix = function(t) {
                            var e = this.set(t.m[0], t.m[1], t.m[2]).length(), n = this.set(t.m[4], t.m[5], t.m[6]).length(), i = this.set(t.m[8], t.m[9], t.m[10]).length();
                            return this.x = e, this.y = n, this.z = i, this
                        }, BABYLON.Vector3.Deserialize = function(t) {
                            var e = new BABYLON.Vector3(t.x, t.y, t.z);
                            return e
                        }, BABYLON.Color3.prototype.serialize = function() {
                            var t = {"class": {name: "BABYLON.Color3"},r: this.r,g: this.g,b: this.b};
                            return t
                        }, BABYLON.Color4.prototype.serialize = function() {
                            var t = {"class": {name: "BABYLON.Color4"},r: this.r,g: this.g,b: this.b,a: this.a};
                            return t
                        }, BABYLON.Color3.Deserialize = function(t) {
                            var e = new BABYLON.Color3(t.r, t.g, t.b);
                            return e
                        }, BABYLON.Color4.Deserialize = function(t) {
                            var e = new BABYLON.Color4(t.r, t.g, t.b, t.a);
                            return e
                        }, BABYLON.BaseTexture.prototype.serialize = function() {
                            this.url = GlobalHelper.stripDomainUrl(this.url, "hcsdesign.");
                            var t = {"class": {name: "BABYLON.BaseTexture"},uScale: this.uScale,vScale: this.vScale,url: this.url};
                            return t
                        }, BABYLON.BaseTexture.Deserialize = function(t) {
                            var e = new BABYLON.BaseTexture(t.url, hcsdesign.engine3D.scene);
                            return e.uScale = t.uScale || 1, e.vScale = t.vScale || 1, e
                        }, BABYLON.Texture.prototype.serialize = function() {
                            var t = BABYLON.BaseTexture.prototype.serialize.call(this);
                            return t.class.name = "BABYLON.Texture", t
                        }, BABYLON.Texture.Deserialize = function(t) {
                            t.url = GlobalHelper.stripDomainUrl(t.url, "hcsdesign.");
                            var e = new BABYLON.Texture(t.url, hcsdesign.engine3D.scene);
                            return e.uScale = t.uScale || 1, e.vScale = t.vScale || 1, e
                        }, BABYLON.CubeTexture.prototype.serialize = function() {
                            var t = BABYLON.BaseTexture.prototype.serialize.call(this);
                            return t.class.name = "BABYLON.CubeTexture", t
                        }, BABYLON.CubeTexture.Deserialize = function(t) {
                            var e = new BABYLON.CubeTexture(t.url, hcsdesign.engine3D.scene);
                            return e
                        }, BABYLON.Mesh.prototype._lastCollidedFaceIndex = -1, BABYLON.Mesh.prototype.getFloor = function() {
                            return this.parent ? -1 != this.parent.name.indexOf("FloorMesh") ? this.parent : this.parent.getFloor() : null
                        }, BABYLON.Node.prototype.getTopLevelObject = function(t) {
                            return this.parent ? -1 != this.parent.name.indexOf("FloorMesh") ? this : -1 != this.parent.name.indexOf("group") && t ? this : this.parent.getTopLevelObject(t) : this
                        }, BABYLON.Node.prototype.getParentByName = function(t) {
                            return this.name != t ? this.parent ? this.parent.getParentByName(t) : void 0 : this
                        }, BABYLON.Tools.ExtractMinAndMaxWithTransform = function(t, e, n, i) {
                            for (var o = new BABYLON.Vector3(Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE), r = new BABYLON.Vector3(-Number.MAX_VALUE, -Number.MAX_VALUE, -Number.MAX_VALUE), s = new BABYLON.Vector3, a = e; e + n > a; a++)
                                s.copyFromFloats(t[3 * a], t[3 * a + 1], t[3 * a + 2]), s = BABYLON.Vector3.TransformCoordinates(s, i), o = BABYLON.Vector3.Minimize(s, o), r = BABYLON.Vector3.Maximize(s, r);
                            return {minimum: o,maximum: r}
                        }, BABYLON.Mesh.prototype.getBoundingBox = function(t) {
                            if (!t && this.__boundingInfo)
                                return this.__boundingInfo.boundingBox;
                            var e = 1 / 0, n = 1 / 0, i = 1 / 0, o = -1 / 0, r = -1 / 0, s = -1 / 0;
                            this.computeWorldMatrix(!0);
                            var a = this.getWorldMatrix().clone();
                            a.invert();
                            var l = function(t) {
                                t.computeWorldMatrix(!0);
                                var h = t.getWorldMatrix().clone(), c = h.multiply(a);
                                if (t instanceof BABYLON.Mesh && t.isVisible) {
                                    var u = BABYLON.Tools.ExtractMinAndMaxWithTransform(t.getVerticesData(BABYLON.VertexBuffer.PositionKind), 0, t.getTotalVertices(), c, !0), p = u.minimum, d = u.maximum;
                                    e = Math.min(e, p.x), n = Math.min(n, p.y), i = Math.min(i, p.z), o = Math.max(o, d.x), r = Math.max(r, d.y), s = Math.max(s, d.z)
                                }
                                for (var m = t.getChildren(), g = 0, f = m.length; f > g; g++)
                                    l(m[g])
                                    };
                            l(this);
                            var h = new BABYLON.Vector3(e, n, i), c = new BABYLON.Vector3(o, r, s);
                            return this.__boundingInfo = new BABYLON.BoundingInfo(h, c), this.__boundingInfo.boundingBox
                        }, BABYLON.Mesh.prototype.getBoundingSphere = function(t) {
                            if (!this.__boundingInfo || t) {
                                var e = this.getBoundingBox();
                                this.__boundingInfo.boundingSphere = new BABYLON.BoundingSphere(e.maximum.clone(), e.minimum.clone())
                            }
                            return this.__boundingInfo.boundingSphere
                        }, BABYLON.Vector3.RotationFromMatrix = function(t) {
                            function e(t) {
                                return Math.min(Math.max(t, -1), 1)
                            }
                            var n = new BABYLON.Vector3, i = t.m, o = i[0], r = i[4], s = i[8], a = (i[1], i[5]), l = i[9], h = (i[2], i[6]), c = i[10];
                            return n.y = Math.asin(e(s)), Math.abs(s) < .99999 ? (n.x = Math.atan2(-l, c), n.z = Math.atan2(-r, o)) : (n.x = Math.atan2(h, a), n.z = 0), n
                        }, BABYLON.Mesh.prototype.changeFrame = function(t, e) {
                            if (t !== this.parent) {
                                var n = this.position.clone(), i = this.rotation.clone(), o = this.parent, r = o.getWorldMatrix().clone(), s = t.getWorldMatrix().clone();
                                s.invert();
                                var a = r.multiply(s);
                                return e ? (n.copyFrom(BABYLON.Vector3.TransformCoordinates(n, a)), i.addInPlace(BABYLON.Vector3.RotationFromMatrix(a))) : (this.parent = t, this.position.copyFrom(BABYLON.Vector3.TransformCoordinates(this.position, a)), this.rotation.addInPlace(BABYLON.Vector3.RotationFromMatrix(a))), {position: n,rotation: i}
                            }
                        }, BABYLON.Mesh.prototype.addInternalRotation = function(t) {
                            for (var e = this.getChildren(), n = 0, i = e.length; i > n; n++)
                                e[n].rotation.y += t
                                }, BABYLON.PickingInfo.prototype.getFlatNormal = function() {
                                    if (!this.pickedMesh)
                                        return null;
                                    var t = this.pickedMesh.getIndices(), e = this.pickedMesh.getVerticesData(BABYLON.VertexBuffer.PositionKind), n = BABYLON.Vector3.FromArray(e, 3 * t[3 * this.faceId]), i = BABYLON.Vector3.FromArray(e, 3 * t[3 * this.faceId + 1]), o = BABYLON.Vector3.FromArray(e, 3 * t[3 * this.faceId + 2]), r = n.subtract(i), s = n.subtract(o);
                                    return s.cross(r).normalize()
                                }, BABYLON.PickingInfo.getFlatNormal = function(t, e) {
                                    if (!t)
                                        return null;
                                    var n = t.getIndices(), i = t.getVerticesData(BABYLON.VertexBuffer.PositionKind), o = BABYLON.Vector3.FromArray(i, 3 * n[3 * e]), r = BABYLON.Vector3.FromArray(i, 3 * n[3 * e + 1]), s = BABYLON.Vector3.FromArray(i, 3 * n[3 * e + 2]), a = o.subtract(r), l = o.subtract(s);
                                    return l.cross(a).normalize()
                                }, BABYLON.PickingInfo.GetNormal = function(t, e, n) {
                                    var i = t.subtract(e), o = n.subtract(e);
                                    return commonNormal = BABYLON.Vector3.Normalize(BABYLON.Vector3.Cross(i, o))
                                }, BABYLON.Mesh.prototype.duplicate = function(t, e, n) {
                                    var i = new BABYLON.Mesh(t, this.getScene());
                                    if (this._geometry) {
                                        var o = this._geometry.copy(BABYLON.Geometry.RandomId());
                                        o.applyToMesh(i)
                                    }
                                    if (BABYLON.Tools.DeepCopy(this, i, ["name", "material", "skeleton"], []), i.material = this.material, e && (i.parent = e), !n)
                                        for (var r = 0; r < this.getScene().meshes.length; r++) {
                                            var s = this.getScene().meshes[r];
                                            s.parent == this && s.duplicate(s.name, i)
                                        }
                                    for (r = 0; r < this.getScene().particleSystems.length; r++) {
                                        var a = this.getScene().particleSystems[r];
                                        a.emitter == this && a.clone(a.name, i)
                                    }
                                    return i.computeWorldMatrix(!0), i
                                }, BABYLON && function() {
                                    BABYLON.Mesh.prototype.getChildren;
                                    BABYLON.Mesh.prototype.getChildren = function() {
                                        return this._children = this._children || []
                                    };
                                    var t = BABYLON.Mesh.prototype.dispose;
                                    BABYLON.Mesh.prototype.dispose = function() {
                                        return this.parent = null, t.apply(this, arguments)
                                    }, Object.defineProperty(BABYLON.Mesh.prototype, "parent", {get: function() {
                                                             return this._parent
                                                             },set: function(t) {
                                                             if (this._parent && this._parent._children)
                                                             for (var e = this.parent._children.length; e--; )
                                                             this.parent._children[e] == this && this.parent._children.splice(e, 1);
                                                             return this._parent = t, this._parent && (this._parent._children = this._parent._children || []).push(this), this._parent
                                                             },enumerable: !0,configurable: !0})
                                }();

var hcs = window.hcs || {};
hcs.Widget = hcs.Widget || {}, hcs.Widget.Rotator = function() {
    var t, e, n = null, i = null, o = null, r = new BABYLON.Plane(0, 1, 0, 0), s = !1, a = 0, l = function(n) {
        t = n, e = this, n.on("click", this.onClick), n.on("refresh", this.onRefreshObject), n.on("selectObject", this.onSelectObject), n.on("deselectObject", this.onDeselectObject), n.on("mousedown", this.onMouseDown), n.on("mouseup", this.onMouseUp), n.on("mousemove", this.onMouseMove), this.setupHistory()
    };
    return l.prototype.onRefreshObject = function(t) {
        n && n.dispose(), n = null, e.addSelectionBox(t.object)
    }, l.prototype.onSelectObject = function(t) {
        e.addSelectionBox(t.object)
    }, l.prototype.onDeselectObject = function() {
        n && n.dispose(), n = null
    }, l.prototype.isActive = function() {
        return s
    }, l.prototype.onClick = function() {
    }, l.prototype.onMouseMove = function() {
        if (s) {
            var e = hcsdesign.engine3D.projectMouseOnPlane(r), a = n.position, l = i.subtract(a), h = e.subtract(a), c = Math.atan2(l.x, l.z), u = Math.atan2(h.x, h.z), p = o + u - c, d = Math.PI / 2, m = Math.round(p / d), g = p - m * d;
            return Math.abs(g) < .3 && (p -= g), t.getSelectedObject().rotation.y = p, t.getSelectedObject().computeWorldMatrix(!0), t.getSelectedObject().getFloor().markAsDirty(), !1
        }
    }, l.prototype.onMouseDown = function(n) {
        if (!t.getLocker() || t.getLocker() === e) {
            var a = n.collided;
            if (a && "rotator" == a.pickedMesh.name) {
                ujs.notify("hcs.engine3d.dragcontrols.start");
                {
                    t.getSelectedObject().position
                }
                r.d = -a.pickedPoint.y, i = a.pickedPoint, o = t.getSelectedObject().rotation.y, s = !0, t.lock(e)
            }
        }
    }, l.prototype.onMouseUp = function() {
        t.getLocker() && t.getLocker() !== e || (t.getSelectedObject() && null !== o && null !== t.getSelectedObject().rotation.y && o !== t.getSelectedObject().rotation.y && ujs.notify("hcs.request.historyAction", {component: e,object: t.getSelectedObject(),params: {oldAngle: o,newAngle: t.getSelectedObject().rotation.y},action: a}), ujs.notify("hcs.engine3d.dragcontrols.end"), r.d = 0, i = null, o = null, t.unlock(e), s = !1)
    }, l.prototype.setupHistory = function() {
        this.historycmp = hcsdesign.getComponentByName("HistoryComponent"), this.historycmp && this.historycmp.registerAction(a, this.undoRotate, this.redoRotate, this)
    }, l.prototype.addHistory = function(t, e, n) {
        this.historycmp && this.historycmp.actionDone(t, e, n, this)
    }, l.prototype.undoRotate = function(t, n) {
        e.historyRotate(t, n.oldAngle)
    }, l.prototype.redoRotate = function(t, n) {
        e.historyRotate(t, n.newAngle)
    }, l.prototype.historyRotate = function(t, e) {
        t.rotation.y = e, ujs.notify("hcs.request.saveHistory")
    }, l.prototype.getRotationMesh = function(t, e) {
        var n = BABYLON.Mesh.CreateCylinder("rotator", 10, 2 * t + 10, 2 * t, 32, 1, !1, hcsdesign.engine3D.scene);
        return n.material = new BABYLON.StandardMaterial("rotator", hcsdesign.engine3D.scene), hcs.MaterialFactory.MakeBasicColor(n.material, e), n.material.backFaceCulling = !1, n
    }, l.prototype.addSelectionBox = function(t) {
        n && n.dispose();
        var e = t.getBoundingBox(!0), i = Math.sqrt((e.maximum.x - e.minimum.x) * (e.maximum.x - e.minimum.x) / 4 + (e.maximum.z - e.minimum.z) * (e.maximum.z - e.minimum.z) / 4);
        n = new BABYLON.Mesh("selector", hcsdesign.engine3D.scene), n.isVisible = !1;
        var o = new BABYLON.Color3;
        o.fromHex(-1 !== t.name.indexOf("group_") ? hcs.Assets.groupColor : hcs.Assets.mainUIColor);
        var r = this.getRotationMesh(i, o);
        r.position.y = e.minimum.y + 10, r.position.x = e.center.x, r.position.z = e.center.z, r.selectorOf = t, r.parent = n;
        var s = new BABYLON.Mesh.CreatePlan("rotator", 28, 14, hcsdesign.engine3D.scene);
        s.material = new BABYLON.StandardMaterial("buttons", hcsdesign.engine3D.scene), s.material.diffuseTexture = new BABYLON.Texture(hcs.Assets.toolbarTextures.rotateTexture, hcsdesign.engine3D.scene), s.material.diffuseTexture.hasAlpha = !0, s.material.backFaceCulling = !1, hcs.MaterialFactory.MakeBasicMaterial(s.material), s.material.emissiveColor.copyFromFloats(1, 1, 1), s.position.z = -i - 6, s.position.y = Math.PI, s.rotation.x = Math.PI / 4, s.selectorOf = t, s.parent = r, n.position = t.getAbsolutePosition(), n.rotation = t.rotation
    }, l
}();

var hcs = window.hcs || {};
hcs.Widget = hcs.Widget || {}, hcs.Widget.Info = function() {
    var t, e, n, i, o, r = null, s = !1, a = function() {
    }, l = function(i) {
        n = i, o = this, t = new BABYLON.SpriteManager("objectMgr", hcs.Assets.toolbarTextures.infoTexture, 2, 128, hcsdesign.engine3D.scene), e = new BABYLON.SpriteManager("groupMgr", hcs.Assets.toolbarTextures.infoTextureGroup, 2, 128, hcsdesign.engine3D.scene), i.on("click", this.onClick), i.on("special", this.onSpecial), i.on("selectObject", this.onSelectObject), i.on("deselectObject", this.onDeselectObject)
    };
    return l.prototype.setClickCallback = function(t) {
        a = t
    }, l.prototype.onClick = function(t) {
        t.collided && "_sprite_info" == t.collided.pickedMesh.name && (a(n.getSelectedObject()), ujs.notify("hcs.engine3D.info", {}))
    }, l.prototype.onSpecial = function() {
        a(n.getSelectedObject())
    }, l.prototype.onSelectObject = function() {
        o.addInfo()
    }, l.prototype.onDeselectObject = function() {
        o.removeInfo()
    }, l.prototype.addInfo = function() {
        r && this.removeInfo();
        var o = n.getSelectedObject().getBoundingBox(), s = new BABYLON.Vector3((o.minimum.x + o.maximum.x) / 2, o.maximum.y, (o.minimum.z + o.maximum.z) / 2);
        r = n.isGroup(n.getSelectedObject()) ? new BABYLON.Sprite("info", e) : new BABYLON.Sprite("info", t), r.size = 30, i = new BABYLON.Mesh("info", hcsdesign.engine3D.scene), i.isVisible = !1, i.position = n.getSelectedObject().getAbsolutePosition();
        var a = new BABYLON.Mesh("info", hcsdesign.engine3D.scene);
        return a.parent = i, a.isVisible = !1, a.position = s, a.position.y += 35, r.position = a.getAbsolutePosition(), toolbar
    }, l.prototype.removeInfo = function() {
        r && (r.dispose(), i.dispose()), i = null, r = null
    }, l.prototype.isActive = function() {
        return s
    }, l
}();

var hcs = window.hcs || {};
hcs.Widget = hcs.Widget || {}, hcs.Widget.Elevation = function() {
    var t, e, n, i = document.getElementById("modalWidgets"), o = !1, r = 38, s = 287, a = function(e) {
        i = document.getElementById("modalWidgets"), t = e, this.imagePath = "images/remote-controller/", this.domElement = this.buildHTML(), this.defaultDomStyle = "top: " + r + "px;right: " + s + "px;", this.domElement.setAttribute("style", this.defaultDomStyle), i.appendChild(this.domElement), this.slider = document.getElementById("edition-slider"), this.sliderContainer = document.getElementById("edition-slider-content"), this.globalSliderContainer = document.getElementById("edition-slider-bar"), this.globalSliderContainerHeight = this.globalSliderContainer.scrollHeight, this.sliderMin = 12, this.sliderMax = 114, this.sliderPos = this.sliderMin, this.sliderSelected = !1, n = this, this.buttonState = null, this.running = !0, this.updateSliderPos(0), this.hide(), e.on("selectObject", this.onSelectObject), e.on("deselectObject", this.onDeselectObject)
    };
    return a.prototype.buildHTML = function() {
        var t = document.createElement("div");
        t.setAttribute("id", "edition-controller");
        var e = document.createElement("ul");
        e.setAttribute("id", "edition-panel");
        var n = document.createElement("li");
        n.setAttribute("id", "edition-slider-bar"), n.setAttribute("title", _("距地面高度"));
        var i = document.createElement("div");
        i.setAttribute("id", "edition-slider-content");
        var o = document.createElement("img");
        return o.setAttribute("id", "edition-slider"), i.appendChild(o), n.appendChild(i), e.appendChild(n), t.appendChild(e), t
    }, a.prototype.updateDomPosition = function(t, e) {
        this.defaultDomStyle = "top: " + e + "px;right: " + t + "px;", this.domElement.setAttribute("style", this.defaultDomStyle)
    }, a.prototype.movePanel = function() {
        var t = hcsdesign.engine3D.canvas.height, e = Math.round(r + (t - r) / 2 - document.getElementById("edition-panel").offsetHeight / 2);
        n.updateDomPosition(s, e)
    }, a.prototype.show = function() {
        document.getElementById("edition-panel").style.display = "block"
    }, a.prototype.hide = function() {
        document.getElementById("edition-panel").style.display = "none"
    }, a.prototype.onSelectObject = function() {
        n.show(), n.movePanel(), n.updateSliderPos(), n.slider.addEventListener("pointerdown", n.onSliderMouseDown, !1), document.addEventListener("pointermove", n.onSliderMouseMove, !1), document.addEventListener("pointerup", n.onMouseUp, !1), document.addEventListener("pointercancel", n.onMouseUp, !1), o = !0
    }, a.prototype.onDeselectObject = function() {
        n.hide(), n.slider.removeEventListener("pointerdown", n.onSliderMouseDown), document.removeEventListener("pointermove", n.onSliderMouseMove), document.removeEventListener("pointerup", n.onMouseUp), document.removeEventListener("pointercancel", n.onMouseUp), o = !1
    }, a.prototype.init = function(t) {
        this.updateSliderPos(this.sliderValue(this.sceneToRelativeValue(t)))
    }, a.prototype.onSliderMouseDown = function(i) {
        i.preventDefault(), n.sliderSelected = !0, e = t.getSelectedObject().position.y
    }, a.prototype.onSliderMouseMove = function(t) {
        if (n.sliderSelected) {
            var e = (t.touches && t.touches.length ? t.touches[0].clientY : t.clientY) || 0, i = n.getValueFromMouse(e), o = n.sceneToRelativeValue(), r = n.sceneValue(i - o);
            n.setElevationVelocity(r), n.updateSliderPos(), t.preventDefault()
        }
    }, a.prototype.onMouseUp = function() {
        if (n.sliderSelected) {
            n.sliderSelected = !1;
            var i = t.getSelectedObject().position.clone(), o = i.clone();
            i.y = e;
            var r = t.getSelectedObject().rotation;
            ujs.notify("hcs.request.historyAction", {component: t,object: t.getSelectedObject(),params: {oldPosition: i,newPosition: o,oldRotation: r,newRotation: r},action: t.MOVEACTION})
        }
    }, a.prototype.setElevationVelocity = function(e) {
        t.moveObject(t.getSelectedObject(), new BABYLON.Vector3(0, e, 0))
    }, a.prototype.updateSliderPos = function(t) {
        this.sliderPos = void 0 !== t ? t : this.sliderValue(this.sceneToRelativeValue()), this.slider.style.top = this.sliderPos + "px"
    }, a.prototype.sceneToRelativeValue = function() {
        var e = 0, n = t.getSelectedObject().getFloor().structure.height, i = t.getSelectedObject().position.y;
        return i = ujs.Math.clamp(i, e, n), (i - e) / (n - e)
    }, a.prototype.sliderToRelativeValue = function(t) {
        var e = t || this.sliderPos;
        return e = ujs.Math.clamp(e, this.sliderMin, this.sliderMax), 1 - (e - this.sliderMin) / (this.sliderMax - this.sliderMin)
    }, a.prototype.sliderValue = function(t) {
        return t * (-this.sliderMax + this.sliderMin) + this.sliderMax - n.slider.offsetHeight / 2
    }, a.prototype.sceneValue = function(e) {
        return e * t.getSelectedObject().getFloor().structure.height
    }, a.prototype.isActive = function() {
        return o
    }, a.prototype.getValueFromMouse = function(t) {
        for (var e = n.slider, i = e.parentNode, o = 0, r = i; r != document && r != window; )
            o += r.offsetTop || 0, r = r.parentNode;
        return 1 - ujs.Math.clamp((t - o - this.sliderMin) / (this.sliderMax - this.sliderMin), 0, 1)
    }, a
}();

var hcs = window.hcs || {};
hcs.Widget = hcs.Widget || {}, hcs.Widget.Clone = function() {
    var t, e, n = !1, i = function(n) {
        t = n, this.icon = "fa fa-copy", this.button = this.buildHTML(), this.buttonSelected = !1, e = this, n.on("selectObject", this.onSelectObject), n.on("deselectObject", this.onDeselectObject)
    };
    return i.prototype.buildHTML = function() {
        var t = document.getElementById("edition-panel"), e = document.createElement("li");
        e.setAttribute("id", "edition-clone-button"), e.setAttribute("title", _("复制"));
        var n = document.createElement("span");
        n.setAttribute("id", "edition-clone-icon"), n.setAttribute("class", "menu-icon");
        var i = document.createElement("i");
        return i.setAttribute("id", "edition-clone-img"), i.setAttribute("class", this.icon), n.appendChild(i), e.appendChild(n), t.appendChild(e), e
    }, i.prototype.onSelectObject = function() {
        e.button.addEventListener("pointerdown", e.onButtonMouseDown, !1), document.addEventListener("pointerup", e.onMouseUp, !1), document.addEventListener("pointercancel", e.onMouseUp, !1), n = !0
    }, i.prototype.onDeselectObject = function() {
        e.button.removeEventListener("pointerdown", e.onButtonMouseDown), document.removeEventListener("pointerup", e.onMouseUp), document.removeEventListener("pointercancel", e.onMouseUp), n = !1
    }, i.prototype.onButtonMouseDown = function(t) {
        t.preventDefault(), e.buttonSelected || (e.buttonSelected = !0, ujs.notify("hcs.request.object.clone"))
    }, i.prototype.onMouseUp = function() {
        e.buttonSelected && (e.buttonSelected = !1)
    }, i.prototype.isActive = function() {
        return n
    }, i
}();

var hcs = window.hcs || {};
hcs.Widget = hcs.Widget || {}, hcs.Widget.Remove = function() {
    var t, e, n = !1, i = function(n) {
        t = n, this.icon = "fa fa-trash-o", this.button = this.buildHTML(), this.buttonSelected = !1, e = this, n.on("selectObject", this.onSelectObject), n.on("deselectObject", this.onDeselectObject)
    };
    return i.prototype.buildHTML = function() {
        var t = document.getElementById("edition-panel"), e = document.createElement("li");
        e.setAttribute("id", "edition-remove-button"), e.setAttribute("title", _("删除"));
        var n = document.createElement("span");
        n.setAttribute("id", "edition-remove-icon"), n.setAttribute("class", "menu-icon");
        var i = document.createElement("i");
        return i.setAttribute("id", "edition-remove-img"), i.setAttribute("class", this.icon), n.appendChild(i), e.appendChild(n), t.appendChild(e), e
    }, i.prototype.onSelectObject = function() {
        e.button.addEventListener("pointerdown", e.onButtonMouseDown, !1), document.addEventListener("pointerup", e.onMouseUp, !1), document.addEventListener("pointercancel", e.onMouseUp, !1), n = !0
    }, i.prototype.onDeselectObject = function() {
        e.button.removeEventListener("pointerdown", e.onButtonMouseDown), document.removeEventListener("pointerup", e.onMouseUp), document.removeEventListener("pointercancel", e.onMouseUp), n = !1
    }, i.prototype.onButtonMouseDown = function(t) {
        t.preventDefault(), e.buttonSelected || (e.buttonSelected = !0, ujs.notify("hcs.request.object.remove"))
    }, i.prototype.onMouseUp = function() {
        e.buttonSelected && (e.buttonSelected = !1)
    }, i.prototype.isActive = function() {
        return n
    }, i
}();
var hcs = window.hcs || {};
hcs.Widget = hcs.Widget || {}, hcs.Widget.Group = function() {
    var t, e, n = !1, i = function(n) {
        t = n, this.imageGroup = "fa fa-link", this.imageUngroup = "fa fa-chain-broken", this.img = null, this.button = this.buildHTML(), this.selectedObject = null, this.buttonSelected = !1, e = this, this.hide(), n.on("selectObject", this.onSelectObject), n.on("deselectObject", this.onDeselectObject)
    };
    return i.prototype.buildHTML = function() {
        var t = document.getElementById("edition-panel"), e = document.createElement("li");
        e.setAttribute("id", "edition-group-button"), e.setAttribute("title", _("Group/Ungroup"));
        var n = document.createElement("span");
        n.setAttribute("id", "edition-group-icon"), n.setAttribute("class", "menu-icon");
        var i = document.createElement("i");
        return i.setAttribute("id", "edition-group-img"), i.setAttribute("class", this.imageUngroup), n.appendChild(i), e.appendChild(n), t.appendChild(e), e
    }, i.prototype.updatePanelColor = function(e) {
        var n = document.getElementById("edition-panel");
        t.isGroup(e) ? (n.style.backgroundColor = "#a99384", n.style.borderColor = "#a99384") : (n.style.backgroundColor = "#897364", n.style.borderColor = "#897364")
    }, i.prototype.updateGroupImg = function() {
        this.img = t.isVirtualGroup(e.selectedObject) ? this.imageUngroup : this.imageGroup, document.getElementById("edition-group-img").setAttribute("class", this.img)
    }, i.prototype.show = function() {
        e.button.style.display = "block", e.updateGroupImg(), t.elevationWidget.movePanel()
    }, i.prototype.hide = function() {
        e.button.style.display = "none", t.elevationWidget.movePanel()
    }, i.prototype.onSelectObject = function(i) {
        return e.selectedObject = i.object, e.updatePanelColor(e.selectedObject), t.isGroup(e.selectedObject) ? (e.show(), e.button.addEventListener("pointerdown", e.onButtonMouseDown, !1), document.addEventListener("pointerup", e.onMouseUp, !1), document.addEventListener("pointercancel", e.onMouseUp, !1), void (n = !0)) : void e.hide()
    }, i.prototype.onDeselectObject = function() {
        e.selectedObject = null, e.button.removeEventListener("pointerdown", e.onButtonMouseDown), document.removeEventListener("pointerup", e.onMouseUp), document.removeEventListener("pointercancel", e.onMouseUp), n = !1
    }, i.prototype.onButtonMouseDown = function(n) {
        n.preventDefault(), e.buttonSelected || (e.buttonSelected = !0, t.isVirtualGroup(e.selectedObject) ? t.virtualToRealGroup() : t.deleteSelectedGroup(), e.updateGroupImg())
    }, i.prototype.onMouseUp = function() {
        e.buttonSelected && (e.buttonSelected = !1)
    }, i.prototype.isActive = function() {
        return n
    }, i
}();
var hcsdesign = hcsdesign || {}, API = function() {
    var t = {};
    t.CONTEXT_2D = hcsdesign.ENGINE_2D || 1, t.CONTEXT_3D = hcsdesign.ENGINE_3D || 2, t.MODE_2D_NORMAL = 1, t.MODE_2D_DRAG = 2, t.MODE_2D_DRAW = 4, t.MODE_2D_CONTEXTMENU = 8, t.MODE_2D_SUBSLOPE = 16, t.ORBITCAMERA = 0, t.FPSCAMERA = 1, t.e2D = {}, t.e3D = {}, t.material = {}, t.UI = {}, t.HTML = {}, t.Utils = {}, t.setContext = function(t) {
        hcsdesign.setSelectedEngine(t)
    }, t.getContext = function() {
        hcsdesign.getSelectedEngine()
    }, t.getMode = function(e) {
        var n = e || hcsdesign.getSelectedEngine();
        return n == t.CONTEXT_2D ? hcsdesign.engine2D.getMode(name) : void (n == t.CONTEXT_3D)
    }, t.getComponent = function(t) {
        var e = hcsdesign.getComponentByName(t);
        return e || Logger.warning("[WnpAPI] getComponent : The component " + t + " has not been found."), e
    }, t.setMode = function(e, n) {
        var i = n || hcsdesign.getSelectedEngine();
        i == t.CONTEXT_2D ? (hcsdesign.engine2D.setMode(e), hcsdesign.engine2D.requestStaticDraw()) : i == t.CONTEXT_3D && hcsdesign.engine2D.setMode(e)
    }, t.setCameraById = function(t) {
        var e = hcsdesign.getComponentByName("CameraComponent");
        e && e.getActiveCameraId() !== t && this.e3D.switchCamera()
    }, t.getCameraId = function() {
        return hcsdesign.getComponentByName("CameraComponent").getActiveCameraId()
    }, t.getData = function(t) {
        return hcsdesign.structure.customData[t]
    }, t.setData = function(t, e) {
        hcsdesign.structure.customData[t] = e
    }, t.getCurrentFloor = function() {
        return hcsdesign.getSelectedStructure()
    }, t.getFloor = function(t) {
        var e = hcsdesign.structure.members[t];
        return e || Logger.warning("[WnpAPI] getFloor : Requested floor id was not found"), e
    }, t.getWalls = function(t) {
        var e = t || hcsdesign.getSelectedStructure();
        return e.walls
    }, t.getSubSlopes = function(t) {
        var e = t || hcsdesign.getSelectedStructure();
        return e.subslopes
    }, t.getRooms = function(t, e) {
        var n = e || hcsdesign.getSelectedStructure(), i = t || !0;
        return i ? n.internalRooms : n.externalRooms
    }, t.getObjects = function(t) {
        var e = t || hcsdesign.getSelectedStructure();
        return e.objects
    }, t.registerAction = function(t, e, n, i) {
        hcsdesign.getComponentByName("HistoryComponent").registerAction(t, e, n, i)
    }, t.addHistory = function(t, e, n, i) {
        hcsdesign.getComponentByName("HistoryComponent").actionDone(t, e, n, i)
    }, t.material.TexturedMaterial = function(t, e) {
        return new hcs.TexturedMaterial(t, hcsdesign.engine3D.scene, e)
    }, t.material.WhiteMaterial = function(t, e) {
        return new hcs.WhiteMaterial(t, hcsdesign.engine3D.scene, e)
    }, t.material.LeatherMaterial = function(t, e) {
        return new hcs.LeatherMaterial(t, hcsdesign.engine3D.scene, e)
    }, t.material.MetalMaterial = function(t, e) {
        return new hcs.MetalMaterial(t, hcsdesign.engine3D.scene, e)
    }, t.material.WoodMaterial = function(t, e) {
        return new hcs.WoodMaterial(t, hcsdesign.engine3D.scene, e)
    }, t.material.MattMaterial = function(t, e) {
        return new hcs.MattMaterial(t, hcsdesign.engine3D.scene, e)
    }, t.material.GlassMaterial = function(t, e) {
        return new hcs.GlassMaterial(t, hcsdesign.engine3D.scene, e)
    }, t.material.PlasticMaterial = function(t, e) {
        return new hcs.PlasticMaterial(t, hcsdesign.engine3D.scene, e)
    }, t.material.TileMaterial = function(t, e) {
        return new hcs.TileMaterial(t, hcsdesign.engine3D.scene, e)
    }, t.UI.getWidgetContainer = function() {
        return document.getElementById("modalWidgets")
    }, t.HTML.addHTML = function(t, e, n, i) {
        HTMLHelper.insertHTML(t, e || document.body, n, i)
    }, t.HTML.addScript = function(t, e, n) {
        HTMLHelper.addScript(t, void 0, e, n)
    }, t.HTML.addCSS = function(t, e, n) {
        HTMLHelper.addStylesheet(t, void 0, e, n)
    }, t.Utils.ajax = function(t) {
        var e = t || {};
        e.params = t.data, ujs.ajax(e)
    };
    var e = {};
    return t.listen = function(t, n) {
        return e[t] || (e[t] = []), -1 != e[t].indexOf(n) ? void Logger.warning("[WnpAPI] Event Already listened : cannot listen twice with the same function") : (document.addEventListener(t, n, !1), void e[t].push(n))
    }, t.unListen = function(t, n) {
        if (!e[t])
            return void Logger.warning("[WnpAPI] No such event is listened");
        var i = e[t].indexOf(n);
        return -1 == i ? void Logger.warning("[WnpAPI] No such function listens to this event") : (document.removeEventListener(t, n, !1), void e[t].splice(i, 1))
    }, t.getListeners = function(t) {
        return e[t]
    }, t.getFloorAsPolygon = function(t) {
        var e = hcsdesign.getComponentByName("FloorComponent3D");
        if (t = 0, !(t >= e.structure.members.length)) {
            for (var n = e.structure.members[t], i = [], o = n.points.length; o--; ) {
                var r = new BABYLON.Vector2;
                r.copyFrom(n.points[o].position), i.push(r)
            }
            return i
        }
    }, t.e2D.getMousePos = function() {
        return hcsdesign.engine2D._pointerManager.getStatus().planPos.clone()
    }, t.e2D.requestStaticDraw = function() {
        hcsdesign.engine2D.requestStaticDraw()
    }, t.e2D.requestDynamicDraw = function() {
        hcsdesign.engine2D.requestDynamicDraw()
    }, t.e3D.getCanvas = function() {
        return hcsdesign.engine3D.canvas
    }, t.e3D.getScene = function() {
        return hcsdesign.engine3D.scene
    }, t.e3D.getCamera = function() {
        return hcsdesign.engine3D.scene.activeCamera
    }, t.e3D.switchCamera = function() {
        ujs.notify("hcs.request.cameraChanged", {activeCameraId: this.cameraActiveId,activeCamera: this.cameraActiveId ? "fpsCamera" : "orbitCamera"})
    }, t.e3D.getCameraFeatures = function() {
        return hcsdesign.engine3D.cameraFeatures
    }, t.e3D.getMeshes = function() {
        return hcsdesign.engine3D.scene.meshes
    }, t.e3D.getRoomMesh = function() {
        return hcsdesign.engine3D.searchComponent("RoomComponent3D").mesh
    }, t.e3D.setRoomFloorMaterial = function(t) {
        t instanceof hcs.StandardMaterial && hcsdesign.engine3D.searchComponent("RoomComponent3D").setSideMaterial(t)
    }, t.e3D.setRoomCeilingMaterial = function(t) {
        t instanceof hcs.StandardMaterial && hcsdesign.engine3D.searchComponent("RoomComponent3D").setCeilingMaterial(t)
    }, t.e3D.getTopLevelMeshes = function() {
        for (var t = hcsdesign.engine3D.scene, e = [], n = null, i = 0, o = t.meshes.length; o > i; i++)
            n = t.meshes[i].getTopLevelObject(), n.parent && -1 === e.indexOf(n) && e.push(n);
        return e
    }, t.e3D.getObjects = function() {
        for (var t, e = hcsdesign.engine3D.scene, n = [], i = 0, o = e.meshes.length; o > i; i++)
            t = e.meshes[i], -1 !== t.name.indexOf("Object_") && n.push(t);
        return n
    }, t.e3D.getSunlight = function() {
        return hcsdesign.engine3D.scene.lights.dir
    }, t.e3D.getSkySphere = function() {
        return hcsdesign.engine3D.scene.getMeshByName("skysphere")
    }, t.e3D.getGround = function() {
        return hcsdesign.engine3D.scene.getMeshByName("ground")
    }, t.e3D.projectOnPlane = function(t, e, n) {
        return hcsdesign.engine3D.projectMouseOnPlane(t, e, n)
    }, t.e3D.castShadows = function(t) {
        hcsdesign.engine3D.castShadows(t)
    }, t.e3D.uncastShadows = function(t) {
        hcsdesign.engine3D.uncastShadows(t)
    }, t.e3D.getSelectedObject = function() {
        return hcsdesign.getComponentByName("EditionComponent3D").getSelectedObject()
    }, t.e3D.intersect = function(t, e, n) {
        var i = n || hcsdesign.engine3D.scene.meshes;
        return hcsdesign.engine3D.collideWithMeshes(t, e, i)
    }, t.e3D.addSelectedEvent = function(t) {
        hcsdesign.getComponentByName("EditionComponent3D").on("selectObject", t)
    }, t.e3D.addDeselectedEvent = function(t) {
        hcsdesign.getComponentByName("EditionComponent3D").on("deselectObject", t)
    }, t
}(), API = API || {};
API.Menu = function() {
    var t = {};
    return t.MENU_TOP = "hcs.menu.top", t.MENU_TOP_2 = "hcs.menu.top.sub", t.MENU_MAIN = "hcs.menu.main", t.add = function(t, e, n) {
        var i = n || ".";
        ujs.notify(t + ".add", {item: e,menuPath: i})
    }, t
}();
var ujs = function() {
    var t = {};
    return t.triggerEvent = function(e, n) {
        if (n instanceof Array)
            for (var i = 0, o = n.length; o > i; i++)
                t.triggerEvent(e, n[i]);
        else
            e[n] && "function" == typeof e[n] && e[n](e)
            }, t.notify = function(t, e) {
                var n = document.createEvent("HTMLEvents");
                if (n.initEvent(t, !0, !1), "object" == typeof e)
                    for (var i in e)
                        n[i] = e[i];
                try {
                    document.dispatchEvent(n)
                } catch (o) {
                    Logger.warning("[ujs.notify]", o)
                }
            }, t.getURLParameter = function(t) {
                for (var e = document.location.href.split("?"), n = e[1], i = n.split("&"), o = 0, r = i.length, s = null; r > o && null == s; ) {
                    var a = i[o].split("=");
                    a[0] == t && (s = a[1]), o++
                }
                return s
            }, t.addOnAttribute = function(t, e, n) {
                var i = "style" == t ? ";" : " ", o = e.getAttribute(t), r = !1, s = [];
                if (null != o && "" != o) {
                    s = o.split(i);
                    for (var a = s.length, l = 0; a > l && !r; )
                        s[l] == n && (r = !0), l++
                        }
                r || s.push(n), e.setAttribute(t, s.join(" "))
            }, t.removeOnAttribute = function(t, e, n) {
                if ("object" == typeof e) {
                    var i = "style" == t ? ";" : " ", o = e.getAttribute(t);
                    if (null != o && "" != o) {
                        for (var r = o.split(i), s = (r.length, []), a = 0, l = r.length; l > a; a++)
                            r[a] != n && s.push(r[a]);
                        e.setAttribute(t, s.join(i))
                    }
                }
            }, t.addClass = function(e, n) {
                if (n instanceof Array)
                    for (var i = 0, o = n.length; o > i; i++)
                        t.addOnAttribute("class", e, n[i]);
                else
                    t.addOnAttribute("class", e, n)
                    }, t.removeClass = function(e, n) {
                        if (n instanceof Array)
                            for (var i = 0, o = n.length; o > i; i++)
                                t.removeOnAttribute("class", e, n[i]);
                        else
                            t.removeOnAttribute("class", e, n)
                            }, t.replaceClass = function(e, n, i) {
                                if (e instanceof Array)
                                    for (var o = 0, r = e.length; r > o; o++)
                                        t.removeClass(e[o], n), t.addClass(e[o], i);
                                else
                                    t.removeClass(e, n), t.addClass(e, i)
                                    }, t.removeClasses = function(t) {
                                        t.setAttribute("class", "")
                                    }, t.addStyle = function(e, n) {
                                        if (n instanceof Array)
                                            for (var i = 0, o = n.length; o > i; i++)
                                                t.addOnAttribute("style", e, n[i]);
                                        else
                                            t.addOnAttribute("style", e, n)
                                            }, t.removeStyle = function(e, n) {
                                                if (n instanceof Array)
                                                    for (var i = 0, o = n.length; o > i; i++)
                                                        t.removeOnAttribute("style", e, n[i]);
                                                t.removeOnAttribute("style", e, n)
                                            }, t.hasClass = function(t, e) {
                                                var n = t.getAttribute("class"), i = !1;
                                                if (null != n)
                                                    for (var o = n.split(" "), r = 0, s = o.length; s > r && !i; )
                                                        o[r] == e && (i = !0), r++;
                                                return i
                                            }, t.mergeObjects = function(e, n, i, o) {
                                                var i = i === !0 ? !0 : !1, r = "array" == o ? [] : {};
                                                for (var s in e)
                                                    e.hasOwnProperty(s) && (r[s] = e[s]);
                                                for (var s in n)
                                                    n.hasOwnProperty(s) && "undefined" != typeof n[s] && (r[s] = n[s] instanceof Array && i ? t.mergeObjects(r[s], n[s], i, "array") : n[s] instanceof Object && i ? t.mergeObjects(r[s], n[s]) : n[s]);
                                                return r
                                            }, t.getProperty = function(t, e) {
                                                var n, i, o = e.split(".");
                                                for (n = 0; n < o.length; n++) {
                                                    if (i = t[o[n]], n == o.length - 1)
                                                        return t[o[n]];
                                                    void 0 === i && (i = t[o[n]] = {}), t = i
                                                }
                                                return !1
                                            }, t.setProperty = function(t, e, n) {
                                                var i, o, r = e.split(".");
                                                for (i = 0; i < r.length; i++)
                                                    o = t[r[i]], void 0 !== n && i == r.length - 1 ? o = t[r[i]] = n : void 0 === o && (o = t[r[i]] = {}), t = o;
                                                return t
                                            }, t.ajax = function(t) {
                                                var e, n = t.url, i = t.method || "GET", o = t.params || "", r = t.success || null, s = t.onerror || null, a = "undefined" != typeof t.async ? t.async : !0, l = "undefined" != typeof t.withCredentials ? t.withCredentials : !1;
                                                if (e = "undefined" != typeof window ? window.XMLHttpRequest ? new XMLHttpRequest : new ActiveXObject("Microsoft.XMLHTTP") : new XMLHttpRequest, t.mimeType && e.overrideMimeType(t.mimeType), "POST" == i)
                                                    e.open("POST", n, a), l && (e.withCredentials = !0), e.setRequestHeader("Content-type", "application/x-www-form-urlencoded"), e.onreadystatechange = function() {
                                                        4 == e.readyState && 200 == e.status ? null != r && r(e.responseText) : 4 == e.readyState && 200 != e.status && null != s && s()
                                                    }, e.send(o);
                                                else {
                                                    var h = "" != o ? n + "?" + o : n;
                                                    e.open("GET", h, a), l && (e.withCredentials = !0), e.onreadystatechange = function() {
                                                        4 == e.readyState && 200 == e.status ? null != r && r(e.responseText) : 4 == e.readyState && 200 != e.status && null != s && s()
                                                    }, e.send(null)
                                                }
                                            }, t.post = function(e, n) {
                                                var n = n || {};
                                                return n.method = "POST", n.url = e, t.ajax(n)
                                            }, t.loadCSS = function(t, e) {
                                                var n = document.createElement("link");
                                                if (n.setAttribute("rel", "stylesheet"), n.setAttribute("type", "text/css"), n.setAttribute("href", t), "object" == typeof e)
                                                    for (var i in e)
                                                        n.setAttribute(i, e[i]);
                                                document.getElementsByTagName("head")[0].appendChild(n)
                                            }, t.loadJavaScript = function(t, e) {
                                                var n = document.createElement("script");
                                                if (n.setAttribute("src", t), "object" == typeof e)
                                                    for (var i in e)
                                                        n.setAttribute(i, e[i]);
                                                document.getElementsByTagName("body")[0].appendChild(n)
                                            }, t.inArray = function(t, e) {
                                                return e.indexOf(t) > -1
                                            }, t.cloneArray = function(e, n) {
                                                for (var i = [], n = n || !1, o = 0, r = e.length; r > o; o++)
                                                    i[o] = n ? object[o] instanceof Array ? t.cloneArray(e[o]) : e[o] instanceof Object ? t.cloneObject(e[o]) : e[o] : e[o];
                                                return i
                                            }, t.cloneObject = function(e) {
                                                var n = {};
                                                for (var i in e)
                                                    e.hasOwnProperty(i) && (n[i] = e[i] instanceof Array ? t.cloneArray(e[i]) : e[i] instanceof Object ? t.cloneObject(e[i]) : e[i]);
                                                return n
                                            }, t.insertSorted = function(t, e, n) {
                                                var i = 0;
                                                if (0 == n.length)
                                                    n.push(t);
                                                else {
                                                    for (; i < n.length && e(t, n[i]) > 0; )
                                                        i++;
                                                    n.splice(i, 0, t)
                                                }
                                                return n
                                            }, t.getByClass = function(t) {
                                                return document.getElementsByClassName(t)
                                            }, t.getByTag = function(t) {
                                                return document.getElementsByTagName(t)
                                            }, t.getById = function(t) {
                                                return document.getElementById(t)
                                            }, t.isDef = function(t) {
                                                return "undefined" != typeof t
                                            }, t.removeSpaces = function(t) {
                                                var e = new RegExp("[ ]+", "g");
                                                return t.replace(e, "")
                                            }, t.stringToFunction = function(t) {
                                                for (var e = t.split("."), n = window || this, i = 0, o = e.length; o > i; i++)
                                                    {//if(e[i]=="wnp")e[i]="hcs";
//                                                        console.log(t);
//                                                        console.log(n[e[i]]);
                                                        n = n[e[i]];
													//console.log(n);
													//console.log(e[i]);
													}
                                                if ("function" != typeof n)
                                                    throw new Error("function not found");
                                                return n
                                            }, t.deserializeObject = function(e, n, i, o) {
                                                var r, s = null;
                                                if (e && e.class && e.class.name && !n) {
                                                    var a = t.stringToFunction(e.class.name);
                                                    s = a.Deserialize(e)
                                                } else if (e instanceof Array) {
                                                    if (0 == e.length)
                                                        return s;
                                                    s = n || [];
                                                    for (var l = 0; l < e.length; l++)
                                                        r = t.deserializeObject(e[l]), null !== r && s.push(r)
                                                        } else if (e instanceof Object) {
                                                            s = n || {};
                                                            for (var h in e)
                                                                (!i || i && -1 != i.indexOf(h)) && (!o || o && -1 == o.indexOf(h)) && (r = t.deserializeObject(e[h]), null !== r && (s[h] = r))
                                                                } else
                                                                    void 0 !== s && (s = e);
                                                return s
                                            }, t.serializeObject = function(e, n, i, o) {
                                                var r, s;
                                                if (e && e.serialize && !n)
                                                    r = e.serialize();
                                                else if (e instanceof Array) {
                                                    r = [];
                                                    for (var a = 0; a < e.length; a++)
                                                        r.push(t.serializeObject(e[a]));
                                                    if (0 == r.length)
                                                        return null
                                                        } else if (e instanceof Object) {
                                                            if (!(e instanceof Function)) {
                                                                r = n || {};
                                                                for (var l in e)
                                                                    e.hasOwnProperty(l) && (!i || i && -1 != i.indexOf(l)) && (!o || o && -1 == o.indexOf(l)) && (s = t.serializeObject(e[l]), void 0 !== s && null !== s && (r[l] = s))
                                                                    }
                                                        } else
                                                            r = e;
                                                return r
                                            }, t
}(), ujs = window.ujs || {};
ujs.Math = ujs.Math || {}, function() {
    ujs.Math.getRandomInt = function(t, e) {
        return Math.floor(Math.random() * (e - t + 1)) + t
    }, ujs.Math.clamp = function(t, e, n) {
        return e > t ? e : t > n ? n : t
    }, ujs.Math.lerp = function(t, e, n) {
        return n = 0 > n ? 0 : n, n = n > 1 ? 1 : n, t + (e - t) * n
    }, ujs.Math.sign = function(t) {
        return 0 > t ? -1 : 1
    }
}();
var PolygonMerger = function() {
    var t = 1e5, e = function(t, e) {
        var n;
        n = t, t = e, e = n
    }, n = function(e) {
        return Math.round(e * t) / t
    }, i = function(t) {
        this.position = new BABYLON.Vector2, this.position.copyFromFloats(n(t.x), n(t.y)), this.parents = []
    };
    i.prototype.replaceParent = function(t, e) {
        var n = this.parents.indexOf(t);
        -1 != n && (this.parents[n] = e)
    }, i.prototype.clone = function() {
        var t = new i(this.position);
        return t.parents = this.parents.slice(0), t
    }, i.prototype.removeParent = function(t) {
        var e = this.parents.indexOf(t);
        -1 != e && this.parents.splice(e, 1)
    };
    var o = function() {
        this.points = [], this.intersections = [], this.parent = null, this.parentWallSide = null
    };
    o.prototype.length = function() {
        return this.points[1].position.distanceTo(this.points[0].position)
    }, o.prototype.clone = function() {
        for (var t = new o, e = 0, n = this.points.length; n > e; e++)
            t.points.push(this.points[e].clone());
        return t.parent = this.parent, t.parentWallSide = this.parentWallSide, t
    };
    var r = function() {
        this.edges = []
    };
    r.prototype.fromWall = function(t) {
        var e = t.getPolygon();
        if (!(e.length < 1)) {
            for (var n, r, s = null, a = null, l = 0, h = e.length; h > l; l++)
                n = new i(e[l]), r = new o, r.parent = t, r.points.push(n), n.parents.push(r), a && (n.parents.push(a), a.points.push(n)), a = r, s = n, this.edges.push(r);
            this.edges[0].points[0].parents.push(r), r.points.push(this.edges[0].points[0]);
            for (var l = 0, h = this.edges.length; h > l; l++)
                this.edges[l].parentWallSide = this.getEdgeNormal(l).normalize();
            return this
        }
    };
    var s, a, l;
    o.prototype.debug = function() {
        s.save(), s.strokeStyle = "#FF0000", s.lineWidth = 3, s.translate(a.x, a.y), s.scale(l, l), s.beginPath(), s.moveTo(this.points[0].position.x, this.points[0].position.y), s.lineTo(this.points[1].position.x, this.points[1].position.y), s.stroke(), s.restore()
    }, r.prototype.debug = function(t, e, n) {
        t.save(), t.strokeStyle = "#FF0000", t.lineWidth = 6, t.translate(e.x, e.y), t.scale(n, n);
        for (var i = 0, o = this.edges.length; o > i; i++)
            t.beginPath(), t.moveTo(this.edges[i].points[0].position.x, this.edges[i].points[0].position.y), t.lineTo(this.edges[i].points[1].position.x, this.edges[i].points[1].position.y), t.stroke();
        t.restore()
    }, r.prototype.computeIntersections = function(t) {
        for (var e = [], n = 0, o = this.edges.length; o > n; n++)
            for (var r = 0, s = t.edges.length; s > r; r++) {
                var a = BABYLON.Vector2.SegmentIntersection(this.edges[n].points[0].position, this.edges[n].points[1].position, t.edges[r].points[0].position, t.edges[r].points[1].position, 0, Math.PI / 2e3);
                if (a) {
                    var l = new i(a);
                    l.parents.push(this.edges[n], t.edges[r]), this.edges[n].intersections.push(l), t.edges[r].intersections.push(l), e.push(l)
                }
            }
        this.mergeIntersections(e)
    }, r.prototype.smashEdge = function(t, e) {
        for (var n = new i(BABYLON.Vector2.Lerp(e.position, t.position, .5)), o = this.edges.length - 1; o >= 0; o--)
            for (var r = 0; 2 > r; r++)
                (this.edges[o].points[r] == t || this.edges[o].points[r] == e) && (this.edges[o].points[r] = n)
                }, r.prototype.splitAtIntersections = function(t) {
                    var e, n, i = 1e-5, r = [], s = null, a = function(t, n, i) {
                        return e = new o, e.parent = i.parent, e.parentWallSide = i.parentWallSide, e.points[0] = t, e.points[1] = n, t.replaceParent(i, e), n.replaceParent(i, e), e
                    }, l = function(t, e) {
                        t.intersections.sort(function(t, n) {
                                             return t.position.distanceTo(e) - n.position.distanceTo(e)
                                             })
                    }, h = (new BABYLON.Vector2, function(e, n) {
                            return this.edges[e].parentWallSide.dot(t.edges[n].parentWallSide) >= 0
                            }.bind(this)), c = new BABYLON.Vector2, u = function(e, o, r) {
                        return c.copyFrom(e.position).lerp(o.position, .5), n = t.edgeIndexVeryClose(c, i), -1 != n ? !h(r, n) : t.isPointIn(c)
                    }, p = function(t, e, n) {
                        return t.position.distanceTo(e.position) < i ? !0 : !u(t, e, n)
                    };
                    if (!(this.edges.length < 1)) {
                        for (var d = 0, m = this.edges.length; m > d; d++) {
                            s = this.edges[d].points[0], l(this.edges[d], s.position);
                            for (var g = 0, f = this.edges[d].intersections.length; f > g; g++)
                                p(this.edges[d].intersections[g], s, d) ? r.push(a(s, this.edges[d].intersections[g], this.edges[d])) : PolygonMerger.addDeletedEdge(a(s.clone(), this.edges[d].intersections[g].clone(), this.edges[d])), s = this.edges[d].intersections[g];
                            p(this.edges[d].points[1], s, d) ? r.push(a(s, this.edges[d].points[1], this.edges[d])) : PolygonMerger.addDeletedEdge(a(s.clone(), this.edges[d].points[1].clone(), this.edges[d]))
                        }
                        return r
                    }
                }, r.prototype.getInstancesOfPoint = function(t) {
                    for (var e = [], n = 0, i = this.edges.length; i > n; n++)
                        for (var o = 0; 2 > o; o++)
                            this.edges[n].points[o] === t && e.push({edgeIndex: n,pointIndex: o});
                    return e
                };
    var h = function(t, e) {
        var n = this.edges[t.edgeIndex], i = n.points[(t.pointIndex + 1) % 2];
        return i.position.subtract(e.position)
    };
    r.prototype.updateParents = function() {
        for (var t = this.edges.length - 1; t >= 0; t--)
            for (var e = 0; 2 > e; e++)
                if (this.edges[t].points[e].parents.length < 2)
                    this.edges[t].points[e].parents.push(this.edges[t]);
                else if (-1 == this.edges[t].points[e].parents.indexOf(this.edges[t])) {
                    var n = this.getInstancesOfPoint(this.edges[t].points[e]);
                    if (3 === n.length) {
                        for (var o, r, s, a, l = .01, c = +1 / 0, u = +1 / 0, p = 0; 3 > p; p++) {
                            a = this.edges[n[p].edgeIndex].length(), u > a && (u = a, s = n[p].edgeIndex);
                            for (var d = p + 1; 3 > d; d++)
                                o = Math.abs(a - this.edges[n[d].edgeIndex].length()), c > o && (r = n[p].edgeIndex, c = o)
                                }
                        l > c ? this.edges.splice(r, 1) : this.edges.splice(s, 1);
                        continue
                    }
                    if (4 !== n.length)
                        continue;
                    var m = this.edges[t].points[e];
                    m.parents.length = 0;
                    var g, f = new i(this.edges[t].points[e].position.clone()), y = n[0];
                    n.splice(0, 1);
                    for (var p = 0; 3 > p; p++)
                        if (this.edges[n[p].edgeIndex].parent === this.edges[y.edgeIndex].parent) {
                            g = n[p], n.splice(p, 1);
                            break
                        }
                    if (!g) {
                        Logger.warning("Erreur, instance jumelle du point multiple non trouvée");
                        continue
                    }
                    for (var _ = h.call(this, y, m), v = h.call(this, g, m), b = BABYLON.Math.NormalizeAngle(Math.atan2(v.y, v.x) - Math.atan2(_.y, _.x), !0), w = [], p = 0; 2 > p; p++)
                        w.push(h.call(this, n[p], m)), w[p].angle = BABYLON.Math.NormalizeAngle(Math.atan2(w[p].y, w[p].x) - Math.atan2(_.y, _.x), !0);
                    {
                        var x, C;
                        Math.PI / 40
                    }
                    x = w[0].angle > b ? w[0].angle > w[1].angle ? n[0] : n[1] : w[0].angle < w[1].angle ? n[0] : n[1], n.splice(n.indexOf(x), 1), C = n[0], f.parents.push(this.edges[y.edgeIndex], this.edges[x.edgeIndex]), this.edges[y.edgeIndex].points[this.edges[y.pointIndex]] = f, this.edges[x.edgeIndex].points[this.edges[x.pointIndex]] = f, f.parents.push(this.edges[C.edgeIndex], this.edges[g.edgeIndex])
                }
    }, r.prototype.mergeIntersections = function(t) {
        for (var e = 1e-5, n = 0, i = t.length; i > n; n++)
            for (var o = t.length - 1; o > n; o--)
                t[n].position.distanceTo(t[o].position) < e && (t[o].parents[0].intersections.splice(t[o].parents[0].intersections.indexOf(t[o]), 1), t[o].parents[1].intersections.splice(t[o].parents[1].intersections.indexOf(t[o]), 1), t.splice(o, 1))
                }, r.prototype.deleteSmallEdges = function() {
                    var t = 1e-5;
                    if (!(this.edges.length <= 3)) {
                        for (var e = 0, n = this.edges.length; n > e; e++)
                            this.edges[e].length() < t && (this.smashEdge(this.edges[e].points[0], this.edges[e].points[1], this.edges[e]), this.edges.splice(e, 1), e--, n--);
                        this.updateParents()
                    }
                }, r.prototype.normalizePolygon = function() {
                    for (var t, e = 1e-5, n = this.edges, r = 0, s = n.length; s > r; r++)
                        for (var a = r + 1; s > a; a++)
                            if (t = BABYLON.Vector2.SegmentIntersection(n[r].points[0].position, n[r].points[1].position, n[a].points[0].position, n[a].points[1].position, -e)) {
                                var l = new i(t), h = new i(t), c = new o;
                                c.parent = n[r].parent, c.parentWallSide = n[r].parentWallSide, c.points.push(n[r].points[0], l), n[r].points[0] = l, l.parents.push(c, n[r]);
                                var u = new o;
                                u.parent = n[a].parent, u.parentWallSide = n[a].parentWallSide, u.points.push(n[a].points[0], h), n[a].points[0] = h, h.parents.push(u, n[a]), n.push(c, u)
                            }
                }, r.prototype.distanceTo = function(t) {
                    for (var e, n = new BABYLON.Vector2, i = +1 / 0, o = 0, r = this.edges.length; r > o; o++)
                        n.copy(t), n = n.projectOnSegment(this.edges[o].points[0].position, this.edges[o].points[1].position), e = n.distanceTo(t), i = Math.min(i, e);
                    return i
                }, r.prototype.edgeIndexVeryClose = function(t, e) {
                    for (var n, i = new BABYLON.Vector2, o = 0, r = this.edges.length; r > o; o++)
                        if (i.copyFrom(t), i = i.projectOnSegment(this.edges[o].points[0].position, this.edges[o].points[1].position), n = i.distanceTo(t), e > n)
                            return o;
                    return -1
                }, r.prototype.isPointIn = function(t) {
                    var i, o, r, s, t = t.clone();
                    t.x = n(t.x), t.y = n(t.y);
                    for (var a = [], l = !1, h = 0, c = this.edges.length; c > h; h++)
                        i = this.edges[h].points[0].position.x, o = this.edges[h].points[0].position.y, r = this.edges[h].points[1].position.x, s = this.edges[h].points[1].position.y, (this.edges[h].points[0].alreadyVisited || this.edges[h].points[1].alreadyVisited) && (e(i, r), e(o, s)), this.edges[h].points[0].alreadyVisited = !0, this.edges[h].points[1].alreadyVisited = !0, a.push(this.edges[h].points[0], this.edges[h].points[1]), s === o && s === t.y ? (i <= t.x && t.x < r || r <= t.x && t.x < i) && (l = !l) : (o <= t.y && t.y < s || s <= t.y && t.y < o) && t.x <= n((r - i) * (t.y - o) / (s - o) + i) && (l = !l);
                    for (var h = 0, c = a.length; c > h; h++)
                        a[h].alreadyVisited = !1;
                    return l
                }, r.prototype.getEdgeNormal = function(t) {
                    var i, o, r, s, a = [], l = BABYLON.Vector2.Lerp(this.edges[t].points[0].position, this.edges[t].points[1].position, .5), h = "x", c = "y";
                    l.y === this.edges[t].points[0].position.y && (h = "y", c = "x");
                    for (var u = !1, p = 0, d = this.edges.length; d > p; p++)
                        t !== p && (i = this.edges[p].points[0].position[h], o = this.edges[p].points[0].position[c], r = this.edges[p].points[1].position[h], s = this.edges[p].points[1].position[c], (this.edges[p].points[0].alreadyVisited || this.edges[p].points[1].alreadyVisited) && (e(i, r), e(o, s)), this.edges[p].points[0].alreadyVisited = !0, this.edges[p].points[1].alreadyVisited = !0, a.push(this.edges[p].points[0], this.edges[p].points[1]), s === o && s === l[c] ? (i <= l[h] && l[h] < r || r <= l[h] && l[h] < i) && (u = !u) : (o <= l[c] && l[c] < s || s <= l[c] && l[c] < o) && l[h] <= n((r - i) * (l[c] - o) / (s - o) + i) && (u = !u));
                    for (var p = 0, d = a.length; d > p; p++)
                        a[p].alreadyVisited = !1;
                    var m = this.edges[t].points[1].position.subtract(this.edges[t].points[0].position);
                    return m.copyFromFloats(-m.y, m.x).normalize(), (!u && m[h] <= 0 || u && m[h] > 0) && m.scaleInPlace(-1), m
                }, r.prototype.mergeVertices = function() {
                    for (var t = [], e = 1e-5, n = 0, i = this.edges.length; i > n; n++)
                        -1 === t.indexOf(this.edges[n].points[0]) && t.push(this.edges[n].points[0]), -1 === t.indexOf(this.edges[n].points[1]) && t.push(this.edges[n].points[1]);
                    for (var n = 0, i = t.length; i > n; n++)
                        for (var o = n + 1; i > o; o++)
                            if (t[n].position.distanceTo(t[o].position) < e) {
                                for (var r = t[n].parents, s = t[o].parents, a = -1, l = -1, h = 0; 2 > h; h++)
                                    -1 === this.edges.indexOf(r[h]) && (a = (h + 1) % 2), -1 === this.edges.indexOf(s[h]) && (l = (h + 1) % 2);
                                -1 != a && -1 != l && (s[l].points.splice(s[l].points.indexOf(t[o]), 1), s[l].points.push(t[n]), t[n].parents[0] = r[a], t[n].parents[1] = s[l])
                            }
                }, r.prototype.processCycles = function() {
                    for (var t, e = 200, n = [], i = function(t, e) {
                         var n = (e.points.indexOf(t) + 1) % 2, i = e.points[n], o = (i.parents.indexOf(e) + 1) % 2;
                         return {edge: i.parents[o],point: i}
                         }, r = function(t) {
                         var n, r = [], s = t, a = t.points[0], l = a, h = 0;
                         a.parents.length = 0, a.parentWallSide = [];
                         do {
                         if (null == s || !(s instanceof o))
                         return null;
                         r.push(a), a.parents.push(s.parent), a.parentWallSide.push(s.parentWallSide), s.visited = !0, n = i(a, s), a = n.point, a.parents.length = 0, a.parentWallSide = [], a.parents.push(s.parent), a.parentWallSide.push(s.parentWallSide), s = n.edge
                         } while (++h < 3 || a !== l && e > h);
                         return a.parents.push(t.parent), a.parentWallSide.push(t.parentWallSide), h == e ? null : r
                         }, s = 0, a = this.edges.length; a > s; s++)
                        this.edges[s].visited || (t = r(this.edges[s]), t && n.push(t));
                    return n
                }, r.prototype.toShape = function() {
                    return void console.warn("NOT COMPATIBLE WITH BABYLON.JS")
                };
    var c, u, p = [], d = function() {
    };
    return d.addDeletedEdge = function(t) {
        p.push(t)
    }, d.merge = function(t, e, n, i, o) {
        var h = [];
        p.length = 0;
        for (var d = 0, m = t.length; m > d; d++)
            h.push((new r).fromWall(t[d]));
        if (h.length < 1)
            return null;
        for (var g, f, y = h[0], d = 1, m = h.length; m > d; d++)
            h[d].normalizePolygon(), y.computeIntersections(h[d]), g = h[d].splitAtIntersections(y), f = y.splitAtIntersections(h[d]), y.edges = g.concat(f), y.deleteSmallEdges();
        return y.mergeVertices(), n && (s = n, a = i, l = o), c = y, e ? y.edges : u = y.processCycles()
    }, d.reconstitutePolygon = function(t, e) {
        var n = [], i = [], s = [], a = new r;
        e || (e = this.getCachedPolygon());
        for (var l, h, c = function() {
             if (!(a.edges.length < 2))
             for (var e, n, r, l, h = 0, c = i.length; c > h; h++)
             if (2 !== i[h].parents.length) {
             e = +1 / 0, r = null;
             for (var u = h + 1; c > u; u++)
             1 === i[u].parents.length && (n = i[u].position.distanceTo(i[h].position), e > n && (e = n, r = i[u]));
             null !== r ? (l = new o, l.parent = t, l.points.push(i[h], r), i[h].parents.push(l), r.parents.push(l), s.push(l)) : Logger.warning("Warning : could not connect every point in reconstitutePolygon")
             }
             }, u = 0, p = e.edges.length; p > u; u++)
            if (e.edges[u].parent === t) {
                l = e.edges[u].clone();
                for (var d = 0; 2 > d; d++)
                    h = n.indexOf(e.edges[u].points[d]), -1 === h ? (n.push(e.edges[u].points[d]), i.push(l.points[d]), l.points[d].parents.length = 0) : l.points[d] = i[h], l.points[d].parents.push(l);
                a.edges.push(l)
            }
        return c(), a.edges = a.edges.concat(s), a.edges.length > 2 ? a : null
    }, d.simplifyCycles = function(t) {
        for (var e = 0, n = t.length; n > e; e++)
            this.simplifyCycle(t[e])
            }, d.simplifyCycle = function(t) {
                for (var e = function(t, e) {
                     return t.parents[0] == e.parents[0] || t.parents[0] == e.parents[1] ? t.parents[0] : t.parents[1]
                     }, n = function(t, e, n) {
                     var i, o = Math.PI / 80, r = 10, s = e.subtract(t), a = n.subtract(e);
                     return s.length() < r || a.length() < r ? !1 : (i = Math.abs(s.determinant(a)), o > i)
                     }, i = 0, o = t.length; o > i; i++)
                    n(t[i].position, t[(i + 1) % o].position, t[(i + 2) % o].position) && e(t[i], t[(i + 1) % o]).height === e(t[(i + 1) % o], t[(i + 2) % o]).height && (console.log("colinear ! "), t.splice((i + 1) % o, 1), i--, o--);
                return t
            }, d.getCachedCycles = function() {
                return u
            }, d.getCachedPolygon = function() {
                return c
            }, d.getCachedDeletedEdges = function() {
                return p
            }, d
}();
!function(t) {
    if ("object" == typeof exports)
        module.exports = t();
    else if ("function" == typeof define && define.amd)
        define(t);
    else {
        var e;
        "undefined" != typeof window ? e = window : "undefined" != typeof global ? e = global : "undefined" != typeof self && (e = self), e.poly2tri = t()
    }
}(function() {
  return function t(e, n, i) {
  function o(s, a) {
  if (!n[s]) {
  if (!e[s]) {
  var l = "function" == typeof require && require;
  if (!a && l)
  return l(s, !0);
  if (r)
  return r(s, !0);
  throw new Error("Cannot find module '" + s + "'")
  }
  var h = n[s] = {exports: {}};
  e[s][0].call(h.exports, function(t) {
               var n = e[s][1][t];
               return o(n ? n : t)
               }, h, h.exports, t, e, n, i)
  }
  return n[s].exports
  }
  for (var r = "function" == typeof require && require, s = 0; s < i.length; s++)
  o(i[s]);
  return o
  }({1: [function(t, e) {
         e.exports = {version: "1.3.3"}
         }, {}],2: [function(t, e) {
                    "use strict";
                    var n = function(t, e) {
                    this.point = t, this.triangle = e || null, this.next = null, this.prev = null, this.value = t.x
                    }, i = function(t, e) {
                    this.head_ = t, this.tail_ = e, this.search_node_ = t
                    };
                    i.prototype.head = function() {
                    return this.head_
                    }, i.prototype.setHead = function(t) {
                    this.head_ = t
                    }, i.prototype.tail = function() {
                    return this.tail_
                    }, i.prototype.setTail = function(t) {
                    this.tail_ = t
                    }, i.prototype.search = function() {
                    return this.search_node_
                    }, i.prototype.setSearch = function(t) {
                    this.search_node_ = t
                    }, i.prototype.findSearchNode = function() {
                    return this.search_node_
                    }, i.prototype.locateNode = function(t) {
                    var e = this.search_node_;
                    if (t < e.value) {
                    for (; e = e.prev; )
                    if (t >= e.value)
                    return this.search_node_ = e, e
                    } else
                    for (; e = e.next; )
                    if (t < e.value)
                    return this.search_node_ = e.prev, e.prev;
                    return null
                    }, i.prototype.locatePoint = function(t) {
                    var e = t.x, n = this.findSearchNode(e), i = n.point.x;
                    if (e === i) {
                    if (t !== n.point)
                    if (t === n.prev.point)
                    n = n.prev;
                    else {
                    if (t !== n.next.point)
                    throw new Error("poly2tri Invalid AdvancingFront.locatePoint() call");
                    n = n.next
                    }
                    } else if (i > e)
                    for (; (n = n.prev) && t !== n.point; )
                    ;
                    else
                    for (; (n = n.next) && t !== n.point; )
                    ;
                    return n && (this.search_node_ = n), n
                    }, e.exports = i, e.exports.Node = n
                    }, {}],3: [function(t, e) {
                               "use strict";
                               var n = t("./xy"), i = function(t, e) {
                               this.x = +t || 0, this.y = +e || 0, this._p2t_edge_list = null
                               };
                               i.prototype.toString = function() {
                               return n.toStringBase(this)
                               }, i.prototype.clone = function() {
                               return new i(this.x, this.y)
                               }, i.prototype.set_zero = function() {
                               return this.x = 0, this.y = 0, this
                               }, i.prototype.set = function(t, e) {
                               return this.x = +t || 0, this.y = +e || 0, this
                               }, i.prototype.negate = function() {
                               return this.x = -this.x, this.y = -this.y, this
                               }, i.prototype.add = function(t) {
                               return this.x += t.x, this.y += t.y, this
                               }, i.prototype.sub = function(t) {
                               return this.x -= t.x, this.y -= t.y, this
                               }, i.prototype.mul = function(t) {
                               return this.x *= t, this.y *= t, this
                               }, i.prototype.length = function() {
                               return Math.sqrt(this.x * this.x + this.y * this.y)
                               }, i.prototype.normalize = function() {
                               var t = this.length();
                               return this.x /= t, this.y /= t, t
                               }, i.prototype.equals = function(t) {
                               return this.x === t.x && this.y === t.y
                               }, i.negate = function(t) {
                               return new i(-t.x, -t.y)
                               }, i.add = function(t, e) {
                               return new i(t.x + e.x, t.y + e.y)
                               }, i.sub = function(t, e) {
                               return new i(t.x - e.x, t.y - e.y)
                               }, i.mul = function(t, e) {
                               return new i(t * e.x, t * e.y)
                               }, i.cross = function(t, e) {
                               return "number" == typeof t ? "number" == typeof e ? t * e : new i(-t * e.y, t * e.x) : "number" == typeof e ? new i(e * t.y, -e * t.x) : t.x * e.y - t.y * e.x
                               }, i.toString = n.toString, i.compare = n.compare, i.cmp = n.compare, i.equals = n.equals, i.dot = function(t, e) {
                               return t.x * e.x + t.y * e.y
                               }, e.exports = i
                               }, {"./xy": 10}],4: [function(t, e) {
                                                    "use strict";
                                                    var n = t("./xy"), i = function(t, e) {
                                                    this.name = "PointError", this.points = e = e || [], this.message = t || "Invalid Points!";
                                                    for (var i = 0; i < e.length; i++)
                                                    this.message += " " + n.toString(e[i])
                                                    };
                                                    i.prototype = new Error, i.prototype.constructor = i, e.exports = i
                                                    }, {"./xy": 10}],5: [function(t, e, n) {
                                                                         (function(e) {
                                                                          "use strict";
                                                                          var i = e.poly2tri;
                                                                          n.noConflict = function() {
                                                                          return e.poly2tri = i, n
                                                                          }, n.VERSION = t("../dist/version.json").version, n.PointError = t("./pointerror"), n.Point = t("./point"), n.Triangle = t("./triangle"), n.SweepContext = t("./sweepcontext");
                                                                          var o = t("./sweep");
                                                                          n.triangulate = o.triangulate, n.sweep = {Triangulate: o.triangulate}
                                                                          }).call(this, "undefined" != typeof self ? self : "undefined" != typeof window ? window : {})
                                                                         }, {"../dist/version.json": 1,"./point": 3,"./pointerror": 4,"./sweep": 6,"./sweepcontext": 7,"./triangle": 8}],6: [function(t, e, n) {
                                                                                                                                                                                             "use strict";
                                                                                                                                                                                             function i(t) {
                                                                                                                                                                                             t.initTriangulation(), t.createAdvancingFront(), o(t), r(t)
                                                                                                                                                                                             }
                                                                                                                                                                                             function o(t) {
                                                                                                                                                                                             var e, n = t.pointCount();
                                                                                                                                                                                             for (e = 1; n > e; ++e)
                                                                                                                                                                                             for (var i = t.getPoint(e), o = s(t, i), r = i._p2t_edge_list, l = 0; r && l < r.length; ++l)
                                                                                                                                                                                             a(t, r[l], o)
                                                                                                                                                                                             }
                                                                                                                                                                                             function r(t) {
                                                                                                                                                                                             for (var e = t.front().head().next.triangle, n = t.front().head().next.point; !e.getConstrainedEdgeCW(n); )
                                                                                                                                                                                             e = e.neighborCCW(n);
                                                                                                                                                                                             t.meshClean(e)
                                                                                                                                                                                             }
                                                                                                                                                                                             function s(t, e) {
                                                                                                                                                                                             var n = t.locateNode(e), i = c(t, e, n);
                                                                                                                                                                                             return e.x <= n.point.x + Y && u(t, n), p(t, i), i
                                                                                                                                                                                             }
                                                                                                                                                                                             function a(t, e, n) {
                                                                                                                                                                                             t.edge_event.constrained_edge = e, t.edge_event.right = e.p.x > e.q.x, h(n.triangle, e.p, e.q) || (w(t, e, n), l(t, e.p, e.q, n.triangle, e.q))
                                                                                                                                                                                             }
                                                                                                                                                                                             function l(t, e, n, i, o) {
                                                                                                                                                                                             if (!h(i, e, n)) {
                                                                                                                                                                                             var r = i.pointCCW(o), s = j(n, r, e);
                                                                                                                                                                                             if (s === z.COLLINEAR)
                                                                                                                                                                                             throw new I("poly2tri EdgeEvent: Collinear not supported!", [n, r, e]);
                                                                                                                                                                                             var a = i.pointCW(o), c = j(n, a, e);
                                                                                                                                                                                             if (c === z.COLLINEAR)
                                                                                                                                                                                             throw new I("poly2tri EdgeEvent: Collinear not supported!", [n, a, e]);
                                                                                                                                                                                             s === c ? (i = s === z.CW ? i.neighborCCW(o) : i.neighborCW(o), l(t, e, n, i, o)) : S(t, e, n, i, o)
                                                                                                                                                                                             }
                                                                                                                                                                                             }
                                                                                                                                                                                             function h(t, e, n) {
                                                                                                                                                                                             var i = t.edgeIndex(e, n);
                                                                                                                                                                                             if (-1 !== i) {
                                                                                                                                                                                             t.markConstrainedEdgeByIndex(i);
                                                                                                                                                                                             var o = t.getNeighbor(i);
                                                                                                                                                                                             return o && o.markConstrainedEdgeByPoints(e, n), !0
                                                                                                                                                                                             }
                                                                                                                                                                                             return !1
                                                                                                                                                                                             }
                                                                                                                                                                                             function c(t, e, n) {
                                                                                                                                                                                             var i = new N(e, n.point, n.next.point);
                                                                                                                                                                                             i.markNeighbor(n.triangle), t.addToMap(i);
                                                                                                                                                                                             var o = new R(e);
                                                                                                                                                                                             return o.next = n.next, o.prev = n, n.next.prev = o, n.next = o, g(t, i) || t.mapTriangleToNodes(i), o
                                                                                                                                                                                             }
                                                                                                                                                                                             function u(t, e) {
                                                                                                                                                                                             var n = new N(e.prev.point, e.point, e.next.point);
                                                                                                                                                                                             n.markNeighbor(e.prev.triangle), n.markNeighbor(e.triangle), t.addToMap(n), e.prev.next = e.next, e.next.prev = e.prev, g(t, n) || t.mapTriangleToNodes(n)
                                                                                                                                                                                             }
                                                                                                                                                                                             function p(t, e) {
                                                                                                                                                                                             for (var n, i = e.next; i.next && (n = m(i), !(n > F || -F > n)); )
                                                                                                                                                                                             u(t, i), i = i.next;
                                                                                                                                                                                             for (i = e.prev; i.prev && (n = m(i), !(n > F || -F > n)); )
                                                                                                                                                                                             u(t, i), i = i.prev;
                                                                                                                                                                                             e.next && e.next.next && (n = d(e), V > n && _(t, e))
                                                                                                                                                                                             }
                                                                                                                                                                                             function d(t) {
                                                                                                                                                                                             var e = t.point.x - t.next.next.point.x, n = t.point.y - t.next.next.point.y;
                                                                                                                                                                                             return Math.atan2(n, e)
                                                                                                                                                                                             }
                                                                                                                                                                                             function m(t) {
                                                                                                                                                                                             var e = t.next.point.x - t.point.x, n = t.next.point.y - t.point.y, i = t.prev.point.x - t.point.x, o = t.prev.point.y - t.point.y;
                                                                                                                                                                                             return Math.atan2(e * o - n * i, e * i + n * o)
                                                                                                                                                                                             }
                                                                                                                                                                                             function g(t, e) {
                                                                                                                                                                                             for (var n = 0; 3 > n; ++n)
                                                                                                                                                                                             if (!e.delaunay_edge[n]) {
                                                                                                                                                                                             var i = e.getNeighbor(n);
                                                                                                                                                                                             if (i) {
                                                                                                                                                                                             var o = e.getPoint(n), r = i.oppositePoint(e, o), s = i.index(r);
                                                                                                                                                                                             if (i.constrained_edge[s] || i.delaunay_edge[s]) {
                                                                                                                                                                                             e.constrained_edge[n] = i.constrained_edge[s];
                                                                                                                                                                                             continue
                                                                                                                                                                                             }
                                                                                                                                                                                             var a = f(o, e.pointCCW(o), e.pointCW(o), r);
                                                                                                                                                                                             if (a) {
                                                                                                                                                                                             e.delaunay_edge[n] = !0, i.delaunay_edge[s] = !0, y(e, o, i, r);
                                                                                                                                                                                             var l = !g(t, e);
                                                                                                                                                                                             return l && t.mapTriangleToNodes(e), l = !g(t, i), l && t.mapTriangleToNodes(i), e.delaunay_edge[n] = !1, i.delaunay_edge[s] = !1, !0
                                                                                                                                                                                             }
                                                                                                                                                                                             }
                                                                                                                                                                                             }
                                                                                                                                                                                             return !1
                                                                                                                                                                                             }
                                                                                                                                                                                             function f(t, e, n, i) {
                                                                                                                                                                                             var o = t.x - i.x, r = t.y - i.y, s = e.x - i.x, a = e.y - i.y, l = o * a, h = s * r, c = l - h;
                                                                                                                                                                                             if (0 >= c)
                                                                                                                                                                                             return !1;
                                                                                                                                                                                             var u = n.x - i.x, p = n.y - i.y, d = u * r, m = o * p, g = d - m;
                                                                                                                                                                                             if (0 >= g)
                                                                                                                                                                                             return !1;
                                                                                                                                                                                             var f = s * p, y = u * a, _ = o * o + r * r, v = s * s + a * a, b = u * u + p * p, w = _ * (f - y) + v * g + b * c;
                                                                                                                                                                                             return w > 0
                                                                                                                                                                                             }
                                                                                                                                                                                             function y(t, e, n, i) {
                                                                                                                                                                                             var o, r, s, a;
                                                                                                                                                                                             o = t.neighborCCW(e), r = t.neighborCW(e), s = n.neighborCCW(i), a = n.neighborCW(i);
                                                                                                                                                                                             var l, h, c, u;
                                                                                                                                                                                             l = t.getConstrainedEdgeCCW(e), h = t.getConstrainedEdgeCW(e), c = n.getConstrainedEdgeCCW(i), u = n.getConstrainedEdgeCW(i);
                                                                                                                                                                                             var p, d, m, g;
                                                                                                                                                                                             p = t.getDelaunayEdgeCCW(e), d = t.getDelaunayEdgeCW(e), m = n.getDelaunayEdgeCCW(i), g = n.getDelaunayEdgeCW(i), t.legalize(e, i), n.legalize(i, e), n.setDelaunayEdgeCCW(e, p), t.setDelaunayEdgeCW(e, d), t.setDelaunayEdgeCCW(i, m), n.setDelaunayEdgeCW(i, g), n.setConstrainedEdgeCCW(e, l), t.setConstrainedEdgeCW(e, h), t.setConstrainedEdgeCCW(i, c), n.setConstrainedEdgeCW(i, u), t.clearNeigbors(), n.clearNeigbors(), o && n.markNeighbor(o), r && t.markNeighbor(r), s && t.markNeighbor(s), a && n.markNeighbor(a), t.markNeighbor(n)
                                                                                                                                                                                             }
                                                                                                                                                                                             function _(t, e) {
                                                                                                                                                                                             for (t.basin.left_node = j(e.point, e.next.point, e.next.next.point) === z.CCW ? e.next.next : e.next, t.basin.bottom_node = t.basin.left_node; t.basin.bottom_node.next && t.basin.bottom_node.point.y >= t.basin.bottom_node.next.point.y; )
                                                                                                                                                                                             t.basin.bottom_node = t.basin.bottom_node.next;
                                                                                                                                                                                             if (t.basin.bottom_node !== t.basin.left_node) {
                                                                                                                                                                                             for (t.basin.right_node = t.basin.bottom_node; t.basin.right_node.next && t.basin.right_node.point.y < t.basin.right_node.next.point.y; )
                                                                                                                                                                                             t.basin.right_node = t.basin.right_node.next;
                                                                                                                                                                                             t.basin.right_node !== t.basin.bottom_node && (t.basin.width = t.basin.right_node.point.x - t.basin.left_node.point.x, t.basin.left_highest = t.basin.left_node.point.y > t.basin.right_node.point.y, v(t, t.basin.bottom_node))
                                                                                                                                                                                             }
                                                                                                                                                                                             }
                                                                                                                                                                                             function v(t, e) {
                                                                                                                                                                                             if (!b(t, e)) {
                                                                                                                                                                                             u(t, e);
                                                                                                                                                                                             var n;
                                                                                                                                                                                             if (e.prev !== t.basin.left_node || e.next !== t.basin.right_node) {
                                                                                                                                                                                             if (e.prev === t.basin.left_node) {
                                                                                                                                                                                             if (n = j(e.point, e.next.point, e.next.next.point), n === z.CW)
                                                                                                                                                                                             return;
                                                                                                                                                                                             e = e.next
                                                                                                                                                                                             } else if (e.next === t.basin.right_node) {
                                                                                                                                                                                             if (n = j(e.point, e.prev.point, e.prev.prev.point), n === z.CCW)
                                                                                                                                                                                             return;
                                                                                                                                                                                             e = e.prev
                                                                                                                                                                                             } else
                                                                                                                                                                                             e = e.prev.point.y < e.next.point.y ? e.prev : e.next;
                                                                                                                                                                                             v(t, e)
                                                                                                                                                                                             }
                                                                                                                                                                                             }
                                                                                                                                                                                             }
                                                                                                                                                                                             function b(t, e) {
                                                                                                                                                                                             var n;
                                                                                                                                                                                             return n = t.basin.left_highest ? t.basin.left_node.point.y - e.point.y : t.basin.right_node.point.y - e.point.y, t.basin.width > n ? !0 : !1
                                                                                                                                                                                             }
                                                                                                                                                                                             function w(t, e, n) {
                                                                                                                                                                                             t.edge_event.right ? x(t, e, n) : B(t, e, n)
                                                                                                                                                                                             }
                                                                                                                                                                                             function x(t, e, n) {
                                                                                                                                                                                             for (; n.next.point.x < e.p.x; )
                                                                                                                                                                                             j(e.q, n.next.point, e.p) === z.CCW ? C(t, e, n) : n = n.next
                                                                                                                                                                                             }
                                                                                                                                                                                             function C(t, e, n) {
                                                                                                                                                                                             n.point.x < e.p.x && (j(n.point, n.next.point, n.next.next.point) === z.CCW ? M(t, e, n) : (D(t, e, n), C(t, e, n)))
                                                                                                                                                                                             }
                                                                                                                                                                                             function M(t, e, n) {
                                                                                                                                                                                             u(t, n.next), n.next.point !== e.p && j(e.q, n.next.point, e.p) === z.CCW && j(n.point, n.next.point, n.next.next.point) === z.CCW && M(t, e, n)
                                                                                                                                                                                             }
                                                                                                                                                                                             function D(t, e, n) {
                                                                                                                                                                                             j(n.next.point, n.next.next.point, n.next.next.next.point) === z.CCW ? M(t, e, n.next) : j(e.q, n.next.next.point, e.p) === z.CCW && D(t, e, n.next)
                                                                                                                                                                                             }
                                                                                                                                                                                             function B(t, e, n) {
                                                                                                                                                                                             for (; n.prev.point.x > e.p.x; )
                                                                                                                                                                                             j(e.q, n.prev.point, e.p) === z.CW ? A(t, e, n) : n = n.prev
                                                                                                                                                                                             }
                                                                                                                                                                                             function A(t, e, n) {
                                                                                                                                                                                             n.point.x > e.p.x && (j(n.point, n.prev.point, n.prev.prev.point) === z.CW ? T(t, e, n) : (E(t, e, n), A(t, e, n)))
                                                                                                                                                                                             }
                                                                                                                                                                                             function E(t, e, n) {
                                                                                                                                                                                             j(n.prev.point, n.prev.prev.point, n.prev.prev.prev.point) === z.CW ? T(t, e, n.prev) : j(e.q, n.prev.prev.point, e.p) === z.CW && E(t, e, n.prev)
                                                                                                                                                                                             }
                                                                                                                                                                                             function T(t, e, n) {
                                                                                                                                                                                             u(t, n.prev), n.prev.point !== e.p && j(e.q, n.prev.point, e.p) === z.CW && j(n.point, n.prev.point, n.prev.prev.point) === z.CW && T(t, e, n)
                                                                                                                                                                                             }
                                                                                                                                                                                             function S(t, e, n, i, o) {
                                                                                                                                                                                             var r = i.neighborAcross(o);
                                                                                                                                                                                             if (!r)
                                                                                                                                                                                             throw new Error("poly2tri [BUG:FIXME] FLIP failed due to missing triangle!");
                                                                                                                                                                                             var s = r.oppositePoint(i, o);
                                                                                                                                                                                             if (i.getConstrainedEdgeAcross(o)) {
                                                                                                                                                                                             var a = i.index(o);
                                                                                                                                                                                             throw new I("poly2tri Intersecting Constraints", [o, s, i.getPoint((a + 1) % 3), i.getPoint((a + 2) % 3)])
                                                                                                                                                                                             }
                                                                                                                                                                                             if (W(o, i.pointCCW(o), i.pointCW(o), s))
                                                                                                                                                                                             if (y(i, o, r, s), t.mapTriangleToNodes(i), t.mapTriangleToNodes(r), o === n && s === e)
                                                                                                                                                                                             n === t.edge_event.constrained_edge.q && e === t.edge_event.constrained_edge.p && (i.markConstrainedEdgeByPoints(e, n), r.markConstrainedEdgeByPoints(e, n), g(t, i), g(t, r));
                                                                                                                                                                                             else {
                                                                                                                                                                                             var h = j(n, s, e);
                                                                                                                                                                                             i = L(t, h, i, r, o, s), S(t, e, n, i, o)
                                                                                                                                                                                             }
                                                                                                                                                                                             else {
                                                                                                                                                                                             var c = O(e, n, r, s);
                                                                                                                                                                                             P(t, e, n, i, r, c), l(t, e, n, i, o)
                                                                                                                                                                                             }
                                                                                                                                                                                             }
                                                                                                                                                                                             function L(t, e, n, i, o, r) {
                                                                                                                                                                                             var s;
                                                                                                                                                                                             return e === z.CCW ? (s = i.edgeIndex(o, r), i.delaunay_edge[s] = !0, g(t, i), i.clearDelunayEdges(), n) : (s = n.edgeIndex(o, r), n.delaunay_edge[s] = !0, g(t, n), n.clearDelunayEdges(), i)
                                                                                                                                                                                             }
                                                                                                                                                                                             function O(t, e, n, i) {
                                                                                                                                                                                             var o = j(e, i, t);
                                                                                                                                                                                             if (o === z.CW)
                                                                                                                                                                                             return n.pointCCW(i);
                                                                                                                                                                                             if (o === z.CCW)
                                                                                                                                                                                             return n.pointCW(i);
                                                                                                                                                                                             throw new I("poly2tri [Unsupported] nextFlipPoint: opposing point on constrained edge!", [e, i, t])
                                                                                                                                                                                             }
                                                                                                                                                                                             function P(t, e, n, i, o, r) {
                                                                                                                                                                                             var s = o.neighborAcross(r);
                                                                                                                                                                                             if (!s)
                                                                                                                                                                                             throw new Error("poly2tri [BUG:FIXME] FLIP failed due to missing triangle");
                                                                                                                                                                                             var a = s.oppositePoint(o, r);
                                                                                                                                                                                             if (W(n, i.pointCCW(n), i.pointCW(n), a))
                                                                                                                                                                                             S(t, n, a, s, a);
                                                                                                                                                                                             else {
                                                                                                                                                                                             var l = O(e, n, s, a);
                                                                                                                                                                                             P(t, e, n, i, s, l)
                                                                                                                                                                                             }
                                                                                                                                                                                             }
                                                                                                                                                                                             var I = t("./pointerror"), N = t("./triangle"), R = t("./advancingfront").Node, k = t("./utils"), V = 3 * Math.PI / 4, F = Math.PI / 2, Y = k.EPSILON, z = k.Orientation, j = k.orient2d, W = k.inScanArea;
                                                                                                                                                                                             n.triangulate = i
                                                                                                                                                                                             }, {"./advancingfront": 2,"./pointerror": 4,"./triangle": 8,"./utils": 9}],7: [function(t, e) {
                                                                                                                                                                                                                                                                            "use strict";
                                                                                                                                                                                                                                                                            var n = t("./pointerror"), i = t("./point"), o = t("./triangle"), r = t("./sweep"), s = t("./advancingfront"), a = s.Node, l = .3, h = function(t, e) {
                                                                                                                                                                                                                                                                            if (this.p = t, this.q = e, t.y > e.y)
                                                                                                                                                                                                                                                                            this.q = t, this.p = e;
                                                                                                                                                                                                                                                                            else if (t.y === e.y)
                                                                                                                                                                                                                                                                            if (t.x > e.x)
                                                                                                                                                                                                                                                                            this.q = t, this.p = e;
                                                                                                                                                                                                                                                                            else if (t.x === e.x)
                                                                                                                                                                                                                                                                            throw new n("poly2tri Invalid Edge constructor: repeated points!", [t]);
                                                                                                                                                                                                                                                                            this.q._p2t_edge_list || (this.q._p2t_edge_list = []), this.q._p2t_edge_list.push(this)
                                                                                                                                                                                                                                                                            }, c = function() {
                                                                                                                                                                                                                                                                            this.left_node = null, this.bottom_node = null, this.right_node = null, this.width = 0, this.left_highest = !1
                                                                                                                                                                                                                                                                            };
                                                                                                                                                                                                                                                                            c.prototype.clear = function() {
                                                                                                                                                                                                                                                                            this.left_node = null, this.bottom_node = null, this.right_node = null, this.width = 0, this.left_highest = !1
                                                                                                                                                                                                                                                                            };
                                                                                                                                                                                                                                                                            var u = function() {
                                                                                                                                                                                                                                                                            this.constrained_edge = null, this.right = !1
                                                                                                                                                                                                                                                                            }, p = function(t, e) {
                                                                                                                                                                                                                                                                            e = e || {}, this.triangles_ = [], this.map_ = [], this.points_ = e.cloneArrays ? t.slice(0) : t, this.edge_list = [], this.pmin_ = this.pmax_ = null, this.front_ = null, this.head_ = null, this.tail_ = null, this.af_head_ = null, this.af_middle_ = null, this.af_tail_ = null, this.basin = new c, this.edge_event = new u, this.initEdges(this.points_)
                                                                                                                                                                                                                                                                            };
                                                                                                                                                                                                                                                                            p.prototype.addHole = function(t) {
                                                                                                                                                                                                                                                                            this.initEdges(t);
                                                                                                                                                                                                                                                                            var e, n = t.length;
                                                                                                                                                                                                                                                                            for (e = 0; n > e; e++)
                                                                                                                                                                                                                                                                            this.points_.push(t[e]);
                                                                                                                                                                                                                                                                            return this
                                                                                                                                                                                                                                                                            }, p.prototype.AddHole = p.prototype.addHole, p.prototype.addPoint = function(t) {
                                                                                                                                                                                                                                                                            return this.points_.push(t), this
                                                                                                                                                                                                                                                                            }, p.prototype.AddPoint = p.prototype.addPoint, p.prototype.addPoints = function(t) {
                                                                                                                                                                                                                                                                            return this.points_ = this.points_.concat(t), this
                                                                                                                                                                                                                                                                            }, p.prototype.triangulate = function() {
                                                                                                                                                                                                                                                                            return r.triangulate(this), this
                                                                                                                                                                                                                                                                            }, p.prototype.getBoundingBox = function() {
                                                                                                                                                                                                                                                                            return {min: this.pmin_,max: this.pmax_}
                                                                                                                                                                                                                                                                            }, p.prototype.getTriangles = function() {
                                                                                                                                                                                                                                                                            return this.triangles_
                                                                                                                                                                                                                                                                            }, p.prototype.GetTriangles = p.prototype.getTriangles, p.prototype.front = function() {
                                                                                                                                                                                                                                                                            return this.front_
                                                                                                                                                                                                                                                                            }, p.prototype.pointCount = function() {
                                                                                                                                                                                                                                                                            return this.points_.length
                                                                                                                                                                                                                                                                            }, p.prototype.head = function() {
                                                                                                                                                                                                                                                                            return this.head_
                                                                                                                                                                                                                                                                            }, p.prototype.setHead = function(t) {
                                                                                                                                                                                                                                                                            this.head_ = t
                                                                                                                                                                                                                                                                            }, p.prototype.tail = function() {
                                                                                                                                                                                                                                                                            return this.tail_
                                                                                                                                                                                                                                                                            }, p.prototype.setTail = function(t) {
                                                                                                                                                                                                                                                                            this.tail_ = t
                                                                                                                                                                                                                                                                            }, p.prototype.getMap = function() {
                                                                                                                                                                                                                                                                            return this.map_
                                                                                                                                                                                                                                                                            }, p.prototype.initTriangulation = function() {
                                                                                                                                                                                                                                                                            var t, e = this.points_[0].x, n = this.points_[0].x, o = this.points_[0].y, r = this.points_[0].y, s = this.points_.length;
                                                                                                                                                                                                                                                                            for (t = 1; s > t; t++) {
                                                                                                                                                                                                                                                                            var a = this.points_[t];
                                                                                                                                                                                                                                                                            a.x > e && (e = a.x), a.x < n && (n = a.x), a.y > o && (o = a.y), a.y < r && (r = a.y)
                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                            this.pmin_ = new i(n, r), this.pmax_ = new i(e, o);
                                                                                                                                                                                                                                                                            var h = l * (e - n), c = l * (o - r);
                                                                                                                                                                                                                                                                            this.head_ = new i(e + h, r - c), this.tail_ = new i(n - h, r - c), this.points_.sort(i.compare)
                                                                                                                                                                                                                                                                            }, p.prototype.initEdges = function(t) {
                                                                                                                                                                                                                                                                            var e, n = t.length;
                                                                                                                                                                                                                                                                            for (e = 0; n > e; ++e)
                                                                                                                                                                                                                                                                            this.edge_list.push(new h(t[e], t[(e + 1) % n]))
                                                                                                                                                                                                                                                                            }, p.prototype.getPoint = function(t) {
                                                                                                                                                                                                                                                                            return this.points_[t]
                                                                                                                                                                                                                                                                            }, p.prototype.addToMap = function(t) {
                                                                                                                                                                                                                                                                            this.map_.push(t)
                                                                                                                                                                                                                                                                            }, p.prototype.locateNode = function(t) {
                                                                                                                                                                                                                                                                            return this.front_.locateNode(t.x)
                                                                                                                                                                                                                                                                            }, p.prototype.createAdvancingFront = function() {
                                                                                                                                                                                                                                                                            var t, e, n, i = new o(this.points_[0], this.tail_, this.head_);
                                                                                                                                                                                                                                                                            this.map_.push(i), t = new a(i.getPoint(1), i), e = new a(i.getPoint(0), i), n = new a(i.getPoint(2)), this.front_ = new s(t, n), t.next = e, e.next = n, e.prev = t, n.prev = e
                                                                                                                                                                                                                                                                            }, p.prototype.removeNode = function() {
                                                                                                                                                                                                                                                                            }, p.prototype.mapTriangleToNodes = function(t) {
                                                                                                                                                                                                                                                                            for (var e = 0; 3 > e; ++e)
                                                                                                                                                                                                                                                                            if (!t.getNeighbor(e)) {
                                                                                                                                                                                                                                                                            var n = this.front_.locatePoint(t.pointCW(t.getPoint(e)));
                                                                                                                                                                                                                                                                            n && (n.triangle = t)
                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                            }, p.prototype.removeFromMap = function(t) {
                                                                                                                                                                                                                                                                            var e, n = this.map_, i = n.length;
                                                                                                                                                                                                                                                                            for (e = 0; i > e; e++)
                                                                                                                                                                                                                                                                            if (n[e] === t) {
                                                                                                                                                                                                                                                                            n.splice(e, 1);
                                                                                                                                                                                                                                                                            break
                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                            }, p.prototype.meshClean = function(t) {
                                                                                                                                                                                                                                                                            for (var e, n, i = [t]; e = i.pop(); )
                                                                                                                                                                                                                                                                            if (!e.isInterior())
                                                                                                                                                                                                                                                                            for (e.setInterior(!0), this.triangles_.push(e), n = 0; 3 > n; n++)
                                                                                                                                                                                                                                                                            e.constrained_edge[n] || i.push(e.getNeighbor(n))
                                                                                                                                                                                                                                                                            }, e.exports = p
                                                                                                                                                                                                                                                                            }, {"./advancingfront": 2,"./point": 3,"./pointerror": 4,"./sweep": 6,"./triangle": 8}],8: [function(t, e) {
                                                                                                                                                                                                                                                                                                                                                                        "use strict";
                                                                                                                                                                                                                                                                                                                                                                        var n = t("./xy"), i = function(t, e, n) {
                                                                                                                                                                                                                                                                                                                                                                        this.points_ = [t, e, n], this.neighbors_ = [null, null, null], this.interior_ = !1, this.constrained_edge = [!1, !1, !1], this.delaunay_edge = [!1, !1, !1]
                                                                                                                                                                                                                                                                                                                                                                        }, o = n.toString;
                                                                                                                                                                                                                                                                                                                                                                        i.prototype.toString = function() {
                                                                                                                                                                                                                                                                                                                                                                        return "[" + o(this.points_[0]) + o(this.points_[1]) + o(this.points_[2]) + "]"
                                                                                                                                                                                                                                                                                                                                                                        }, i.prototype.getPoint = function(t) {
                                                                                                                                                                                                                                                                                                                                                                        return this.points_[t]
                                                                                                                                                                                                                                                                                                                                                                        }, i.prototype.GetPoint = i.prototype.getPoint, i.prototype.getPoints = function() {
                                                                                                                                                                                                                                                                                                                                                                        return this.points_
                                                                                                                                                                                                                                                                                                                                                                        }, i.prototype.getNeighbor = function(t) {
                                                                                                                                                                                                                                                                                                                                                                        return this.neighbors_[t]
                                                                                                                                                                                                                                                                                                                                                                        }, i.prototype.containsPoint = function(t) {
                                                                                                                                                                                                                                                                                                                                                                        var e = this.points_;
                                                                                                                                                                                                                                                                                                                                                                        return t === e[0] || t === e[1] || t === e[2]
                                                                                                                                                                                                                                                                                                                                                                        }, i.prototype.containsEdge = function(t) {
                                                                                                                                                                                                                                                                                                                                                                        return this.containsPoint(t.p) && this.containsPoint(t.q)
                                                                                                                                                                                                                                                                                                                                                                        }, i.prototype.containsPoints = function(t, e) {
                                                                                                                                                                                                                                                                                                                                                                        return this.containsPoint(t) && this.containsPoint(e)
                                                                                                                                                                                                                                                                                                                                                                        }, i.prototype.isInterior = function() {
                                                                                                                                                                                                                                                                                                                                                                        return this.interior_
                                                                                                                                                                                                                                                                                                                                                                        }, i.prototype.setInterior = function(t) {
                                                                                                                                                                                                                                                                                                                                                                        return this.interior_ = t, this
                                                                                                                                                                                                                                                                                                                                                                        }, i.prototype.markNeighborPointers = function(t, e, n) {
                                                                                                                                                                                                                                                                                                                                                                        var i = this.points_;
                                                                                                                                                                                                                                                                                                                                                                        if (t === i[2] && e === i[1] || t === i[1] && e === i[2])
                                                                                                                                                                                                                                                                                                                                                                        this.neighbors_[0] = n;
                                                                                                                                                                                                                                                                                                                                                                        else if (t === i[0] && e === i[2] || t === i[2] && e === i[0])
                                                                                                                                                                                                                                                                                                                                                                        this.neighbors_[1] = n;
                                                                                                                                                                                                                                                                                                                                                                        else {
                                                                                                                                                                                                                                                                                                                                                                        if (!(t === i[0] && e === i[1] || t === i[1] && e === i[0]))
                                                                                                                                                                                                                                                                                                                                                                        throw new Error("poly2tri Invalid Triangle.markNeighborPointers() call");
                                                                                                                                                                                                                                                                                                                                                                        this.neighbors_[2] = n
                                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                                        }, i.prototype.markNeighbor = function(t) {
                                                                                                                                                                                                                                                                                                                                                                        var e = this.points_;
                                                                                                                                                                                                                                                                                                                                                                        t.containsPoints(e[1], e[2]) ? (this.neighbors_[0] = t, t.markNeighborPointers(e[1], e[2], this)) : t.containsPoints(e[0], e[2]) ? (this.neighbors_[1] = t, t.markNeighborPointers(e[0], e[2], this)) : t.containsPoints(e[0], e[1]) && (this.neighbors_[2] = t, t.markNeighborPointers(e[0], e[1], this))
                                                                                                                                                                                                                                                                                                                                                                        }, i.prototype.clearNeigbors = function() {
                                                                                                                                                                                                                                                                                                                                                                        this.neighbors_[0] = null, this.neighbors_[1] = null, this.neighbors_[2] = null
                                                                                                                                                                                                                                                                                                                                                                        }, i.prototype.clearDelunayEdges = function() {
                                                                                                                                                                                                                                                                                                                                                                        this.delaunay_edge[0] = !1, this.delaunay_edge[1] = !1, this.delaunay_edge[2] = !1
                                                                                                                                                                                                                                                                                                                                                                        }, i.prototype.pointCW = function(t) {
                                                                                                                                                                                                                                                                                                                                                                        var e = this.points_;
                                                                                                                                                                                                                                                                                                                                                                        return t === e[0] ? e[2] : t === e[1] ? e[0] : t === e[2] ? e[1] : null
                                                                                                                                                                                                                                                                                                                                                                        }, i.prototype.pointCCW = function(t) {
                                                                                                                                                                                                                                                                                                                                                                        var e = this.points_;
                                                                                                                                                                                                                                                                                                                                                                        return t === e[0] ? e[1] : t === e[1] ? e[2] : t === e[2] ? e[0] : null
                                                                                                                                                                                                                                                                                                                                                                        }, i.prototype.neighborCW = function(t) {
                                                                                                                                                                                                                                                                                                                                                                        return t === this.points_[0] ? this.neighbors_[1] : t === this.points_[1] ? this.neighbors_[2] : this.neighbors_[0]
                                                                                                                                                                                                                                                                                                                                                                        }, i.prototype.neighborCCW = function(t) {
                                                                                                                                                                                                                                                                                                                                                                        return t === this.points_[0] ? this.neighbors_[2] : t === this.points_[1] ? this.neighbors_[0] : this.neighbors_[1]
                                                                                                                                                                                                                                                                                                                                                                        }, i.prototype.getConstrainedEdgeCW = function(t) {
                                                                                                                                                                                                                                                                                                                                                                        return t === this.points_[0] ? this.constrained_edge[1] : t === this.points_[1] ? this.constrained_edge[2] : this.constrained_edge[0]
                                                                                                                                                                                                                                                                                                                                                                        }, i.prototype.getConstrainedEdgeCCW = function(t) {
                                                                                                                                                                                                                                                                                                                                                                        return t === this.points_[0] ? this.constrained_edge[2] : t === this.points_[1] ? this.constrained_edge[0] : this.constrained_edge[1]
                                                                                                                                                                                                                                                                                                                                                                        }, i.prototype.getConstrainedEdgeAcross = function(t) {
                                                                                                                                                                                                                                                                                                                                                                        return t === this.points_[0] ? this.constrained_edge[0] : t === this.points_[1] ? this.constrained_edge[1] : this.constrained_edge[2]
                                                                                                                                                                                                                                                                                                                                                                        }, i.prototype.setConstrainedEdgeCW = function(t, e) {
                                                                                                                                                                                                                                                                                                                                                                        t === this.points_[0] ? this.constrained_edge[1] = e : t === this.points_[1] ? this.constrained_edge[2] = e : this.constrained_edge[0] = e
                                                                                                                                                                                                                                                                                                                                                                        }, i.prototype.setConstrainedEdgeCCW = function(t, e) {
                                                                                                                                                                                                                                                                                                                                                                        t === this.points_[0] ? this.constrained_edge[2] = e : t === this.points_[1] ? this.constrained_edge[0] = e : this.constrained_edge[1] = e
                                                                                                                                                                                                                                                                                                                                                                        }, i.prototype.getDelaunayEdgeCW = function(t) {
                                                                                                                                                                                                                                                                                                                                                                        return t === this.points_[0] ? this.delaunay_edge[1] : t === this.points_[1] ? this.delaunay_edge[2] : this.delaunay_edge[0]
                                                                                                                                                                                                                                                                                                                                                                        }, i.prototype.getDelaunayEdgeCCW = function(t) {
                                                                                                                                                                                                                                                                                                                                                                        return t === this.points_[0] ? this.delaunay_edge[2] : t === this.points_[1] ? this.delaunay_edge[0] : this.delaunay_edge[1]
                                                                                                                                                                                                                                                                                                                                                                        }, i.prototype.setDelaunayEdgeCW = function(t, e) {
                                                                                                                                                                                                                                                                                                                                                                        t === this.points_[0] ? this.delaunay_edge[1] = e : t === this.points_[1] ? this.delaunay_edge[2] = e : this.delaunay_edge[0] = e
                                                                                                                                                                                                                                                                                                                                                                        }, i.prototype.setDelaunayEdgeCCW = function(t, e) {
                                                                                                                                                                                                                                                                                                                                                                        t === this.points_[0] ? this.delaunay_edge[2] = e : t === this.points_[1] ? this.delaunay_edge[0] = e : this.delaunay_edge[1] = e
                                                                                                                                                                                                                                                                                                                                                                        }, i.prototype.neighborAcross = function(t) {
                                                                                                                                                                                                                                                                                                                                                                        return t === this.points_[0] ? this.neighbors_[0] : t === this.points_[1] ? this.neighbors_[1] : this.neighbors_[2]
                                                                                                                                                                                                                                                                                                                                                                        }, i.prototype.oppositePoint = function(t, e) {
                                                                                                                                                                                                                                                                                                                                                                        var n = t.pointCW(e);
                                                                                                                                                                                                                                                                                                                                                                        return this.pointCW(n)
                                                                                                                                                                                                                                                                                                                                                                        }, i.prototype.legalize = function(t, e) {
                                                                                                                                                                                                                                                                                                                                                                        var n = this.points_;
                                                                                                                                                                                                                                                                                                                                                                        if (t === n[0])
                                                                                                                                                                                                                                                                                                                                                                        n[1] = n[0], n[0] = n[2], n[2] = e;
                                                                                                                                                                                                                                                                                                                                                                        else if (t === n[1])
                                                                                                                                                                                                                                                                                                                                                                        n[2] = n[1], n[1] = n[0], n[0] = e;
                                                                                                                                                                                                                                                                                                                                                                        else {
                                                                                                                                                                                                                                                                                                                                                                        if (t !== n[2])
                                                                                                                                                                                                                                                                                                                                                                        throw new Error("poly2tri Invalid Triangle.legalize() call");
                                                                                                                                                                                                                                                                                                                                                                        n[0] = n[2], n[2] = n[1], n[1] = e
                                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                                        }, i.prototype.index = function(t) {
                                                                                                                                                                                                                                                                                                                                                                        var e = this.points_;
                                                                                                                                                                                                                                                                                                                                                                        if (t === e[0])
                                                                                                                                                                                                                                                                                                                                                                        return 0;
                                                                                                                                                                                                                                                                                                                                                                        if (t === e[1])
                                                                                                                                                                                                                                                                                                                                                                        return 1;
                                                                                                                                                                                                                                                                                                                                                                        if (t === e[2])
                                                                                                                                                                                                                                                                                                                                                                        return 2;
                                                                                                                                                                                                                                                                                                                                                                        throw new Error("poly2tri Invalid Triangle.index() call")
                                                                                                                                                                                                                                                                                                                                                                        }, i.prototype.edgeIndex = function(t, e) {
                                                                                                                                                                                                                                                                                                                                                                        var n = this.points_;
                                                                                                                                                                                                                                                                                                                                                                        if (t === n[0]) {
                                                                                                                                                                                                                                                                                                                                                                        if (e === n[1])
                                                                                                                                                                                                                                                                                                                                                                        return 2;
                                                                                                                                                                                                                                                                                                                                                                        if (e === n[2])
                                                                                                                                                                                                                                                                                                                                                                        return 1
                                                                                                                                                                                                                                                                                                                                                                        } else if (t === n[1]) {
                                                                                                                                                                                                                                                                                                                                                                        if (e === n[2])
                                                                                                                                                                                                                                                                                                                                                                        return 0;
                                                                                                                                                                                                                                                                                                                                                                        if (e === n[0])
                                                                                                                                                                                                                                                                                                                                                                        return 2
                                                                                                                                                                                                                                                                                                                                                                        } else if (t === n[2]) {
                                                                                                                                                                                                                                                                                                                                                                        if (e === n[0])
                                                                                                                                                                                                                                                                                                                                                                        return 1;
                                                                                                                                                                                                                                                                                                                                                                        if (e === n[1])
                                                                                                                                                                                                                                                                                                                                                                        return 0
                                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                                        return -1
                                                                                                                                                                                                                                                                                                                                                                        }, i.prototype.markConstrainedEdgeByIndex = function(t) {
                                                                                                                                                                                                                                                                                                                                                                        this.constrained_edge[t] = !0
                                                                                                                                                                                                                                                                                                                                                                        }, i.prototype.markConstrainedEdgeByEdge = function(t) {
                                                                                                                                                                                                                                                                                                                                                                        this.markConstrainedEdgeByPoints(t.p, t.q)
                                                                                                                                                                                                                                                                                                                                                                        }, i.prototype.markConstrainedEdgeByPoints = function(t, e) {
                                                                                                                                                                                                                                                                                                                                                                        var n = this.points_;
                                                                                                                                                                                                                                                                                                                                                                        e === n[0] && t === n[1] || e === n[1] && t === n[0] ? this.constrained_edge[2] = !0 : e === n[0] && t === n[2] || e === n[2] && t === n[0] ? this.constrained_edge[1] = !0 : (e === n[1] && t === n[2] || e === n[2] && t === n[1]) && (this.constrained_edge[0] = !0)
                                                                                                                                                                                                                                                                                                                                                                        }, e.exports = i
                                                                                                                                                                                                                                                                                                                                                                        }, {"./xy": 10}],9: [function(t, e) {
                                                                                                                                                                                                                                                                                                                                                                                             "use strict";
                                                                                                                                                                                                                                                                                                                                                                                             function n(t, e, n) {
                                                                                                                                                                                                                                                                                                                                                                                             var i = (t.x - n.x) * (e.y - n.y), s = (t.y - n.y) * (e.x - n.x), a = i - s;
                                                                                                                                                                                                                                                                                                                                                                                             return a > -o && o > a ? r.COLLINEAR : a > 0 ? r.CCW : r.CW
                                                                                                                                                                                                                                                                                                                                                                                             }
                                                                                                                                                                                                                                                                                                                                                                                             function i(t, e, n, i) {
                                                                                                                                                                                                                                                                                                                                                                                             var r = (t.x - e.x) * (i.y - e.y) - (i.x - e.x) * (t.y - e.y);
                                                                                                                                                                                                                                                                                                                                                                                             if (r >= -o)
                                                                                                                                                                                                                                                                                                                                                                                             return !1;
                                                                                                                                                                                                                                                                                                                                                                                             var s = (t.x - n.x) * (i.y - n.y) - (i.x - n.x) * (t.y - n.y);
                                                                                                                                                                                                                                                                                                                                                                                             return o >= s ? !1 : !0
                                                                                                                                                                                                                                                                                                                                                                                             }
                                                                                                                                                                                                                                                                                                                                                                                             var o = 1e-12, r = {CW: 1,CCW: -1,COLLINEAR: 0};
                                                                                                                                                                                                                                                                                                                                                                                             e.exports = {EPSILON: o,Orientation: r,orient2d: n,inScanArea: i}
                                                                                                                                                                                                                                                                                                                                                                                             }, {}],10: [function(t, e) {
                                                                                                                                                                                                                                                                                                                                                                                                         "use strict";
                                                                                                                                                                                                                                                                                                                                                                                                         function n(t) {
                                                                                                                                                                                                                                                                                                                                                                                                         return "(" + t.x + ";" + t.y + ")"
                                                                                                                                                                                                                                                                                                                                                                                                         }
                                                                                                                                                                                                                                                                                                                                                                                                         function i(t) {
                                                                                                                                                                                                                                                                                                                                                                                                         var e = t.toString();
                                                                                                                                                                                                                                                                                                                                                                                                         return "[object Object]" === e ? n(t) : e
                                                                                                                                                                                                                                                                                                                                                                                                         }
                                                                                                                                                                                                                                                                                                                                                                                                         function o(t, e) {
                                                                                                                                                                                                                                                                                                                                                                                                         return t.y === e.y ? t.x - e.x : t.y - e.y
                                                                                                                                                                                                                                                                                                                                                                                                         }
                                                                                                                                                                                                                                                                                                                                                                                                         function r(t, e) {
                                                                                                                                                                                                                                                                                                                                                                                                         return t.x === e.x && t.y === e.y
                                                                                                                                                                                                                                                                                                                                                                                                         }
                                                                                                                                                                                                                                                                                                                                                                                                         e.exports = {toString: i,toStringBase: n,compare: o,equals: r}
                                                                                                                                                                                                                                                                                                                                                                                                         }, {}]}, {}, [5])(5)
  }), function(t) {
    "use strict";
    var e, n = t.Uint8Array, i = t.HTMLCanvasElement, o = /\s*;\s*base64\s*(?:;|$)/i, r = function(t) {
        for (var i, o, r, s = t.length, a = new n(s / 4 * 3 | 0), l = 0, h = 0, c = [0, 0], u = 0, p = 0; s--; )
            o = t.charCodeAt(l++), i = e[o - 43], 255 !== i && i !== r && (c[1] = c[0], c[0] = o, p = p << 6 | i, u++, 4 === u && (a[h++] = p >>> 16, 61 !== c[1] && (a[h++] = p >>> 8), 61 !== c[0] && (a[h++] = p), u = 0));
        return a.buffer
    };
    n && (e = new n([62, -1, -1, -1, 63, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, -1, -1, -1, 0, -1, -1, -1, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, -1, -1, -1, -1, -1, -1, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51])), i && !i.prototype.toBlob && (i.prototype.toBlob = function(t, e) {
                                                                                                                                                                                                                                                                                                                                                                          if (e || (e = "image/png"), this.mozGetAsFile)
                                                                                                                                                                                                                                                                                                                                                                          return void t(this.mozGetAsFile("canvas", e));
                                                                                                                                                                                                                                                                                                                                                                          var i, s = Array.prototype.slice.call(arguments, 1), a = this.toDataURL.apply(this, s), l = a.indexOf(","), h = a.substring(l + 1), c = o.test(a.substring(0, l));
                                                                                                                                                                                                                                                                                                                                                                          Blob.fake ? (i = new Blob, i.encoding = c ? "base64" : "URI", i.data = h, i.size = h.length) : n && (i = c ? new Blob([r(h)], {type: e}) : new Blob([decodeURIComponent(h)], {type: e})), t(i)
                                                                                                                                                                                                                                                                                                                                                                          })
}(self);
var saveAs = saveAs || navigator.msSaveOrOpenBlob && navigator.msSaveOrOpenBlob.bind(navigator) || function(t) {
    "use strict";
    var e = t.document, n = function() {
        return t.URL || t.webkitURL || t
    }, i = t.URL || t.webkitURL || t, o = e.createElementNS("http://www.w3.org/1999/xhtml", "a"), r = !t.externalHost && "download" in o, s = function(n) {
        var i = e.createEvent("MouseEvents");
        i.initMouseEvent("click", !0, !1, t, 0, 0, 0, 0, 0, !1, !1, !1, !1, 0, null), n.dispatchEvent(i)
    }, a = t.webkitRequestFileSystem, l = t.requestFileSystem || a || t.mozRequestFileSystem, h = function(e) {
        (t.setImmediate || t.setTimeout)(function() {
                                         throw e
                                         }, 0)
    }, c = "application/octet-stream", u = 0, p = [], d = function() {
        for (var t = p.length; t--; ) {
            var e = p[t];
            "string" == typeof e ? i.revokeObjectURL(e) : e.remove()
        }
        p.length = 0
    }, m = function(t, e, n) {
        e = [].concat(e);
        for (var i = e.length; i--; ) {
            var o = t["on" + e[i]];
            if ("function" == typeof o)
                try {
                    o.call(t, n || t)
                } catch (r) {
                    h(r)
                }
        }
    }, g = function(e, i) {
        var h, d, g, f = this, y = e.type, _ = !1, v = function() {
            var t = n().createObjectURL(e);
            return p.push(t), t
        }, b = function() {
            m(f, "writestart progress write writeend".split(" "))
        }, w = function() {
            (_ || !h) && (h = v(e)), d ? d.location.href = h : window.open(h, "_blank"), f.readyState = f.DONE, b()
        }, x = function(t) {
            return function() {
                return f.readyState !== f.DONE ? t.apply(this, arguments) : void 0
            }
        }, C = {create: !0,exclusive: !1};
        return f.readyState = f.INIT, i || (i = "download"), r ? (h = v(e), o.href = h, o.download = i, s(o), f.readyState = f.DONE, void b()) : (t.chrome && y && y !== c && (g = e.slice || e.webkitSlice, e = g.call(e, 0, e.size, c), _ = !0), a && "download" !== i && (i += ".download"), (y === c || a) && (d = t), l ? (u += e.size, void l(t.TEMPORARY, u, x(function(t) {
                                                                                                                                                                                                                                                                                                                                                                      t.root.getDirectory("saved", C, x(function(t) {
                                                                                                                                                                                                                                                                                                                                                                                                        var n = function() {
                                                                                                                                                                                                                                                                                                                                                                                                        t.getFile(i, C, x(function(t) {
                                                                                                                                                                                                                                                                                                                                                                                                                          t.createWriter(x(function(n) {
                                                                                                                                                                                                                                                                                                                                                                                                                                           n.onwriteend = function(e) {
                                                                                                                                                                                                                                                                                                                                                                                                                                           d.location.href = t.toURL(), p.push(t), f.readyState = f.DONE, m(f, "writeend", e)
                                                                                                                                                                                                                                                                                                                                                                                                                                           }, n.onerror = function() {
                                                                                                                                                                                                                                                                                                                                                                                                                                           var t = n.error;
                                                                                                                                                                                                                                                                                                                                                                                                                                           t.code !== t.ABORT_ERR && w()
                                                                                                                                                                                                                                                                                                                                                                                                                                           }, "writestart progress write abort".split(" ").forEach(function(t) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   n["on" + t] = f["on" + t]
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   }), n.write(e), f.abort = function() {
                                                                                                                                                                                                                                                                                                                                                                                                                                           n.abort(), f.readyState = f.DONE
                                                                                                                                                                                                                                                                                                                                                                                                                                           }, f.readyState = f.WRITING
                                                                                                                                                                                                                                                                                                                                                                                                                                           }), w)
                                                                                                                                                                                                                                                                                                                                                                                                                          }), w)
                                                                                                                                                                                                                                                                                                                                                                                                        };
                                                                                                                                                                                                                                                                                                                                                                                                        t.getFile(i, {create: !1}, x(function(t) {
                                                                                                                                                                                                                                                                                                                                                                                                                                     t.remove(), n()
                                                                                                                                                                                                                                                                                                                                                                                                                                     }), x(function(t) {
                                                                                                                                                                                                                                                                                                                                                                                                                                           t.code === t.NOT_FOUND_ERR ? n() : w()
                                                                                                                                                                                                                                                                                                                                                                                                                                           }))
                                                                                                                                                                                                                                                                                                                                                                                                        }), w)
                                                                                                                                                                                                                                                                                                                                                                      }), w)) : void w())
    }, f = g.prototype, y = function(t, e) {
        return new g(t, e)
    };
    return f.abort = function() {
        var t = this;
        t.readyState = t.DONE, m(t, "abort")
    }, f.readyState = f.INIT = 0, f.WRITING = 1, f.DONE = 2, f.error = f.onwritestart = f.onprogress = f.onwrite = f.onabort = f.onerror = f.onwriteend = null, t.addEventListener("unload", d, !1), y
}(self);
var Stats = function() {
    var t = Date.now(), e = t, n = 0, i = 1 / 0, o = 0, r = 0, s = 1 / 0, a = 0, l = 0, h = 0, c = document.createElement("div");
    c.id = "stats", c.addEventListener("mousedown", function(t) {
                                       t.preventDefault(), _(++h % 2)
                                       }, !1), c.style.cssText = "width:80px;opacity:0.9;cursor:pointer";
    var u = document.createElement("div");
    u.id = "fps", u.style.cssText = "padding:0 0 3px 3px;text-align:left;background-color:#002", c.appendChild(u);
    var p = document.createElement("div");
    p.id = "fpsText", p.style.cssText = "color:#0ff;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px", p.innerHTML = "FPS", u.appendChild(p);
    var d = document.createElement("div");
    for (d.id = "fpsGraph", d.style.cssText = "position:relative;width:74px;height:30px;background-color:#0ff", u.appendChild(d); 74 > d.children.length; ) {
        var m = document.createElement("span");
        m.style.cssText = "width:1px;height:30px;float:left;background-color:#113", d.appendChild(m)
    }
    var g = document.createElement("div");
    g.id = "ms", g.style.cssText = "padding:0 0 3px 3px;text-align:left;background-color:#020;display:none", c.appendChild(g);
    var f = document.createElement("div");
    f.id = "msText", f.style.cssText = "color:#897364;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px", f.innerHTML = "MS", g.appendChild(f);
    var y = document.createElement("div");
    for (y.id = "msGraph", y.style.cssText = "position:relative;width:74px;height:30px;background-color:#897364", g.appendChild(y); 74 > y.children.length; )
        m = document.createElement("span"), m.style.cssText = "width:1px;height:30px;float:left;background-color:#131", y.appendChild(m);
    var _ = function(t) {
        switch (h = t) {
            case 0:
                u.style.display = "block", g.style.display = "none";
                break;
            case 1:
                u.style.display = "none", g.style.display = "block"
        }
    };
    return {REVISION: 11,domElement: c,setMode: _,getFps: function() {
        return r
    },begin: function() {
        t = Date.now()
    },end: function() {
        var h = Date.now();
        n = h - t, i = Math.min(i, n), o = Math.max(o, n), f.textContent = n + " MS (" + i + "-" + o + ")";
        var c = Math.min(30, 30 - 30 * (n / 200));
        return y.appendChild(y.firstChild).style.height = c + "px", l++, h > e + 1e3 && (r = Math.round(1e3 * l / (h - e)), s = Math.min(s, r), a = Math.max(a, r), p.textContent = r + " FPS (" + s + "-" + a + ")", c = Math.min(30, 30 - 30 * (r / 100)), d.appendChild(d.firstChild).style.height = c + "px", e = h, l = 0), h
    },update: function() {
        t = this.end()
    }}
};
"undefined" == typeof document || "classList" in document.createElement("a") || !function(t) {
    if ("HTMLElement" in t || "Element" in t) {
        var e = "classList", n = "prototype", i = (t.HTMLElement || t.Element)[n], o = Object, r = String[n].trim || function() {
            return this.replace(/^\s+|\s+$/g, "")
        }, s = Array[n].indexOf || function(t) {
            for (var e = 0, n = this.length; n > e; e++)
                if (e in this && this[e] === t)
                    return e;
            return -1
        }, a = function(t, e) {
            this.name = t, this.code = DOMException[t], this.message = e
        }, l = function(t, e) {
            if ("" === e)
                throw new a("SYNTAX_ERR", "An invalid or illegal string was specified");
            if (/\s/.test(e))
                throw new a("INVALID_CHARACTER_ERR", "String contains an invalid character");
            return s.call(t, e)
        }, h = function(t) {
            for (var e = r.call(t.className), n = e ? e.split(/\s+/) : [], i = 0, o = n.length; o > i; i++)
                this.push(n[i]);
            this._updateClassName = function() {
                t.className = this.toString()
            }
        }, c = h[n] = [], u = function() {
            return new h(this)
        };
        if (a[n] = Error[n], c.item = function(t) {
            return this[t] || null
            }, c.contains = function(t) {
            return t += "", -1 !== l(this, t)
            }, c.add = function() {
            var t, e = arguments, n = 0, i = e.length, o = !1;
            do
            t = e[n] + "", -1 === l(this, t) && (this.push(t), o = !0);
            while (++n < i);
            o && this._updateClassName()
            }, c.remove = function() {
            var t, e = arguments, n = 0, i = e.length, o = !1;
            do {
            t = e[n] + "";
            var r = l(this, t);
            -1 !== r && (this.splice(r, 1), o = !0)
            } while (++n < i);
            o && this._updateClassName()
            }, c.toggle = function(t, e) {
            t += "";
            var n = this.contains(t), i = n ? e !== !0 && "remove" : e !== !1 && "add";
            return i && this[i](t), !n
            }, c.toString = function() {
            return this.join(" ")
            }, o.defineProperty) {
            var p = {get: u,enumerable: !0,configurable: !0};
            try {
                o.defineProperty(i, e, p)
            } catch (d) {
                -2146823252 === d.number && (p.enumerable = !1, o.defineProperty(i, e, p))
            }
        } else
            o[n].__defineGetter__ && i.__defineGetter__(e, u)
            }
}(self), function() {
    function t() {
        e(), new MutationObserver(function(t) {
                                  t.forEach(function(t) {
                                            t.addedNodes && Array.forEach(t.addedNodes, function(t) {
                                                                          t instanceof Element && (t.childElementCount ? Array.forEach(t.querySelectorAll("input[type=range]"), n) : t.mozMatchesSelector("input[type=range]") && n(t))
                                                                          })
                                            })
                                  }).observe(document, {childList: !0,subtree: !0})
    }
    function e() {
        Array.forEach(document.querySelectorAll("input[type=range]"), n)
    }
    function n(t) {
        "range" != t.type && i(t)
    }
    function i(t) {
        function e(t) {
            if (C = !0, setTimeout(function() {
                                   C = !1
                                   }, 0), !t.button && S) {
                var e = parseFloat(getComputedStyle(this).width), o = (e - h.width) / S;
                if (o) {
                    var r = t.clientX - this.getBoundingClientRect().left - h.width / 2 - (L - A) * o;
                    Math.abs(r) > h.radius && (x = !0, this.value -= -r / o), D = L, B = t.clientX, this.addEventListener("mousemove", n, !0), this.addEventListener("mouseup", i, !0)
                }
            }
        }
        function n(e) {
            var n = parseFloat(getComputedStyle(this).width), i = (n - h.width) / S;
            if (i) {
                D += (e.clientX - B) / i, B = e.clientX, x = !0;
                var o = this.value;
                this.value = D, o != D && t.dispatchEvent(m)
            }
        }
        function i() {
            this.removeEventListener("mousemove", n, !0), this.removeEventListener("mouseup", i, !0), t.dispatchEvent(d), t.dispatchEvent(m)
        }
        function r(t) {
            t.keyCode > 36 && t.keyCode < 41 && (s.call(this), x = !0, this.value = L + (38 == t.keyCode || 39 == t.keyCode ? T : -T))
        }
        function s() {
            C || (this.style.boxShadow = l ? "inset 0 0 20px rgba(137,115,100,.1), 0 0 1px rgba(137,115,100,.4)" : "0 0 0 2px #DDD")
        }
        function g() {
            this.style.boxShadow = ""
        }
        function f(t) {
            return !isNaN(t) && +t == parseFloat(t)
        }
        function y() {
            A = f(t.min) ? +t.min : 0, E = f(t.max) ? +t.max : 100, A > E && (E = A > 100 ? A : 100), T = f(t.step) && t.step > 0 ? +t.step : 1, S = E - A, v(!0)
        }
        function _() {
            b || w || (L = t.getAttribute("value")), f(L) || (L = (A + E) / 2), L = Math.round((L - A) / T) * T + A, A > L ? L = A : L > E && (L = A + ~~(S / T) * T)
        }
        function v(e) {
            _();
            var n = x;
            if (x = !1, n && L != M && t.dispatchEvent(d), e || L != M) {
                M = L;
                var i = S ? (L - A) / S * 100 : 0, r = "-moz-element(#__sliderthumb__) " + i + "% no-repeat, ";
                o(t, {background: r + c})
            }
        }
        var b, w, x, C, M, D, B, A, E, T, S, L = t.value;
        a || (a = document.body.appendChild(document.createElement("hr")), o(a, {"-moz-appearance": l ? "scale-horizontal" : "scalethumb-horizontal",display: "block",visibility: "visible",opacity: 1,position: "fixed",top: "-999999px"}), document.mozSetImageElement("__sliderthumb__", a));
        var O = function() {
            return "" + L
        }, P = function I(e) {
            L = "" + e, b = !0, v(), delete t.value, t.value = L, t.__defineGetter__("value", O), t.__defineSetter__("value", I)
        };
        t.__defineGetter__("value", O), t.__defineSetter__("value", P), Object.defineProperty(t, "type", {get: function() {
                                                                                              return "range"
                                                                                              }}), ["min", "max", "step"].forEach(function(e) {
                                                                                                                                  t.hasAttribute(e) && (w = !0), Object.defineProperty(t, e, {get: function() {
                                                                                                                                                                                       return this.hasAttribute(e) ? this.getAttribute(e) : ""
                                                                                                                                                                                       },set: function(t) {
                                                                                                                                                                                       null === t ? this.removeAttribute(e) : this.setAttribute(e, t)
                                                                                                                                                                                       }})
                                                                                                                                  }), t.readOnly = !0, o(t, u), y(), new MutationObserver(function(e) {
                                                                                                                                                                                          e.forEach(function(e) {
                                                                                                                                                                                                    "value" != e.attributeName ? (y(), w = !0) : b || (L = t.getAttribute("value"), v())
                                                                                                                                                                                                    })
                                                                                                                                                                                          }).observe(t, p), t.addEventListener("mousedown", e, !0), t.addEventListener("keydown", r, !0), t.addEventListener("focus", s, !0), t.addEventListener("blur", g, !0)
    }
    function o(t, e) {
        for (var n in e)
            t.style.setProperty(n, e[n], "important")
            }
    var r = document.createElement("input");
    try {
        if (r.type = "range", "range" == r.type)
            return
            } catch (s) {
                return
            }
    if (r.style.background = "linear-gradient(red, red)", r.style.backgroundImage && "MozAppearance" in r.style) {
        var a, l = "MacIntel" == navigator.platform, h = {radius: l ? 9 : 6,width: l ? 22 : 12,height: l ? 16 : 20}, c = "linear-gradient(transparent " + (l ? "6px, #999 6px, #999 7px, #ccc 8px, #bbb 9px, #bbb 10px, transparent 10px" : "9px, #999 9px, #bbb 10px, #fff 11px, transparent 11px") + ", transparent)", u = {"min-width": h.width + "px","min-height": h.height + "px","max-height": h.height + "px",padding: "0 0 " + (l ? "2px" : "1px"),border: 0,"border-radius": 0,cursor: "default","text-indent": "-999999px"}, p = {attributes: !0,attributeFilter: ["min", "max", "step", "value"]}, d = document.createEvent("HTMLEvents");
        d.initEvent("input", !0, !1);
        var m = document.createEvent("HTMLEvents");
        m.initEvent("change", !0, !1), "loading" == document.readyState ? document.addEventListener("DOMContentLoaded", t, !0) : t(), addEventListener("pageshow", e, !0)
    }
}();
var I18njs = function(t, e, n) {
    this._baseURL = t || "/l10n/", this._locale = e || "C", this._strings = n || {}, window._ = this.translate.bind(this)
};
I18njs.prototype.getLocale = function() {
    return this._locale
}, I18njs.prototype.setLocale = function(t, e) {
    this._locale = t || "C", this._loadLocale(e)
}, I18njs.prototype.translate = function(t, e) {
    if (e) {
        var n = "C" == this._locale ? "en_EN" : this._locale;
        if (e[n] && e[n][t])
            return e[n][t]
            }
    return this._strings[t] || t
}, I18njs.prototype._loadLocale = function(t) {
    var t = t || 1;
    if (this._strings = {}, "C" != this._locale) {
        var e = window.XMLHttpRequest ? new XMLHttpRequest : new ActiveXObject("Microsoft.XMLHTTP");
        e.open("GET", this._baseURL + this._locale + ".json?version=" + t, !1), e.onreadystatechange = function() {
            4 == e.readyState && (this._strings = JSON.parse(e.responseText))
        }.bind(this), e.send(null)
    }
};
var BrowserDetector = function() {
    var t = null, e = [{string: navigator.userAgent,subString: "Chrome",identity: "Chrome"}, {string: navigator.vendor,subString: "Apple",identity: "Safari",versionSearch: "Version"}, {string: navigator.userAgent,subString: "Firefox",identity: "Firefox"}, {string: navigator.userAgent,subString: "Netscape",identity: "Netscape"}, {string: navigator.userAgent,subString: "MSIE",identity: "Explorer",versionSearch: "MSIE"}, {string: navigator.userAgent,subString: "Gecko",identity: "Mozilla",versionSearch: "rv"}, {string: navigator.userAgent,subString: "Mozilla",identity: "Netscape",versionSearch: "Mozilla"}], n = [{string: navigator.platform,subString: "Win",identity: "Windows"}, {string: navigator.platform,subString: "Mac",identity: "Mac"}, {string: navigator.userAgent,subString: "iPhone",identity: "iOS"}, {string: navigator.userAgent,subString: "iPod",identity: "iOS"}, {string: navigator.userAgent,subString: "iPad",identity: "iOS"}, {string: navigator.platform,subString: "Linux",identity: "Linux"}, {string: navigator.plateform,subString: "Android",identity: "Android"}], i = function() {
        this.browser = this._searchString(e) || "An unknown browser", this.version = this._searchVersion(navigator.userAgent) || this._searchVersion(navigator.appVersion) || "an unknown version", this.OS = this._searchString(n) || "an unknown OS", t = this
    };
    return i.getInstance = function() {
        return null === t && (t = new BrowserDetector), t
    }, i.prototype.isMobile = function() {
        var t = !1;
        return function(e) {
            (/(android|bb\d+|meego).+mobile|android|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|iphone|ipod|ipad|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(e) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0, 4))) && (t = !0)
        }(navigator.userAgent || navigator.vendor || window.opera), t
    }, i.prototype._searchString = function(t) {
        for (var e = 0; e < t.length; e++) {
            var n = t[e].string, i = t[e].prop;
            if (this.version_searchString = t[e].versionSearch || t[e].identity, n) {
                if (-1 != n.indexOf(t[e].subString))
                    return t[e].identity
                    } else if (i)
                        return t[e].identity
                        }
    }, i.prototype._searchVersion = function(t) {
        var e = t.indexOf(this.version_searchString);
        if (-1 != e)
            return parseFloat(t.substring(e + this.version_searchString.length + 1))
            }, i
}(), BrowserDetect = new BrowserDetector, photonui = function(t, e) {
    !function(t) {
        "undefined" != typeof module && module.exports ? module.exports = t() : "function" == typeof define && "object" == typeof define.amd ? define(t) : this.Class = t()
    }(function(t) {
      function e(t) {
      return !h || /\B\$super\b/.test(t.toString())
      }
      function n(e, n, i) {
      i === t ? delete e[n] : e[n] = i
      }
      function i(e, n) {
      return Object.prototype.hasOwnProperty.call(e, n) ? e[n] : t
      }
      function o(t) {
      l = !0;
      var e = new t;
      return l = !1, e
      }
      var r = "1.4", s = this, a = s.Class, l = !1, h = function() {
      $super()
      }.toString().indexOf("$super") > 0, c = function() {
      };
      return c.$noConflict = function() {
      try {
      n(s, "Class", a)
      } catch (t) {
      s.Class = a
      }
      return c
      }, c.$classyVersion = r, c.$extend = function(r) {
      var a = this.prototype, h = o(this);
      if (r.__include__)
      for (var u = 0, p = r.__include__.length; u != p; ++u) {
      var d = r.__include__[u];
      for (var m in d) {
      var g = i(d, m);
      g !== t && (h[m] = d[m])
      }
      }
      if (r.__classvars__ = r.__classvars__ || {}, h.__classvars__)
      for (var f in h.__classvars__)
      if (!r.__classvars__[f]) {
      var g = i(h.__classvars__, f);
      r.__classvars__[f] = g
      }
      for (var m in r) {
      var g = i(r, m);
      "__include__" !== m && g !== t && (h[m] = "function" == typeof g && e(g) ? function(t, e) {
                                         return function() {
                                         var o = i(this, "$super");
                                         this.$super = a[e];
                                         try {
                                         return t.apply(this, arguments)
                                         }finally {
                                         n(this, "$super", o)
                                         }
                                         }
                                         }(g, m) : g)
      }
      var y = function() {
      if (!l) {
      var t = s === this ? o(arguments.callee) : this;
      return t.__init__ && t.__init__.apply(t, arguments), t.$class = y, t
      }
      };
      for (var f in r.__classvars__) {
      var g = i(r.__classvars__, f);
      g !== t && (y[f] = g)
      }
      return y.prototype = h, y.constructor = y, y.$extend = c.$extend, y.$withData = c.$withData, y
      }, c.$withData = function(e) {
      var n = o(this);
      for (var r in e) {
      var s = i(e, r);
      s !== t && (n[r] = s)
      }
      return n
      }, c
      });
    var n = n || {};
    n.e_parent = null, n.domInsert = function(t, e) {
        var e = e || n.e_parent || document.getElementsByTagName("body")[0];
        e.appendChild(t.html)
    }, t._ == e && (t._ = function(t, e) {
                    var n = t;
                    if (e)
                    for (var i in e)
                    n = n.replace(new RegExp("{" + i + "}", "g"), e[i]);
                    return n
                    });
    var n = n || {};
    n.Helpers = function() {
    }, n.Helpers.escapeHtml = function(t) {
        return t.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;")
    }, n.Helpers.uuid4 = function() {
        return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, function(t) {
                                                              var e = 16 * Math.random() | 0, n = "x" == t ? e : 3 & e | 8;
                                                              return n.toString(16)
                                                              })
    }, n.Helpers.cleanNode = function(t) {
        for (; t.hasChildNodes(); )
            t.removeChild(t.lastChild)
            }, n.Helpers.getAbsolutePosition = function(t) {
                if (!t instanceof Element)
                    return {x: 0,y: 0};
                try {
                    var e = getComputedStyle(t)
                } catch (n) {
                    return {x: 0,y: 0}
                }
                if (!e)
                    return {x: 0,y: 0};
                for (var i = -parseInt(e.borderLeftWidth), o = -parseInt(e.borderTopWidth); t.offsetParent; )
                    e = getComputedStyle(t), i += t.offsetLeft || 0, i += parseInt(e.borderLeftWidth), o += t.offsetTop || 0, o += parseInt(e.borderTopWidth), t = t.offsetParent;
                return {x: i,y: o}
            };
    var n = n || {};
    n.Base = Class.$extend({__init__: function(t) {
                           this.__events = {}, this._registerWEvents(["destroy"]);
                           for (var i in this)
                           if (0 == i.indexOf("get")) {
                           var o = i.slice(3, 4).toLowerCase() + i.slice(4, i.length);
                           Object.defineProperty(this, o, {get: this[i],enumerable: !0,configurable: !0})
                           } else if (0 == i.indexOf("set")) {
                           var o = i.slice(3, 4).toLowerCase() + i.slice(4, i.length);
                           Object.defineProperty(this, o, {set: this[i],enumerable: !0,configurable: !0})
                           } else if (0 == i.indexOf("is")) {
                           var o = i.slice(2, 3).toLowerCase() + i.slice(3, i.length);
                           Object.defineProperty(this, o, {get: this[i],enumerable: !0,configurable: !0})
                           }
                           var t = t || {};
                           for (param in t)
                           this[param] !== e && (this[param] = t[param]);
                           var r = null, s = 0, a = "";
                           if (t.callbacks)
                           for (var l in t.callbacks)
                           if (r = t.callbacks[l], "function" == typeof r)
                           this.registerCallback(n.Helpers.uuid4(), l, r);
                           else if (r instanceof Array)
                           for (s = 0; s < r.length; s++)
                           this.registerCallback(n.Helpers.uuid4(), l, r[s]);
                           else
                           for (a in r)
                           this.registerCallback(a, l, r[a])
                           },__events: null,__callbacks: null,destroy: function() {
                           this._callCallbacks("destroy");
                           for (var t in this.__events)
                           this._unbindEvent(t)
                           },registerCallback: function(t, e, n, i) {
                           return this.__callbacks[e] ? void (this.__callbacks[e][t] = {callback: n,thisArg: i || null}) : void console.error("This widget have no '" + e + "' event.")
                           },removeCallback: function(t) {
                           for (var e in this.__callbacks)
                           this.__callbacks[e][t] && delete this.__callbacks[e][t]
                           },_updateProperties: function(t) {
                           for (var e = 0; e < t.length; e++)
                           this[t[e]] = this[t[e]]
                           },_bindEvent: function(t, e, n, i) {
                           this.__events[t] = {evName: n,element: e,callback: i}, this.__events[t].element.addEventListener(this.__events[t].evName, this.__events[t].callback, !1)
                           },_unbindEvent: function(t) {
                           this.__events[t].element.removeEventListener(this.__events[t].evName, this.__events[t].callback, !1), delete this.__events[t]
                           },_registerWEvents: function(t) {
                           null == this.__callbacks && (this.__callbacks = {});
                           for (var e in t)
                           this.__callbacks[t[e]] = {}
                           },_callCallbacks: function(t, e) {
                           var e = e || [];
                           for (var n in this.__callbacks[t])
                           this.__callbacks[t][n].callback.apply(this.__callbacks[t][n].thisArg || this, [this].concat(e))
                           }});
    var n = n || {}, i = {};
    n.getWidget = function(t) {
        return i[t] !== e ? i[t] : null
    }, n.Widget = n.Base.$extend({__init__: function(t) {
                                 this.__html = {}, this._layoutOptions = {}, this._buildHtml(), this._registerWEvents(["show", "hide"]), this.$super(t), this._updateProperties(["visible"]), this.name || (this.name = "widget-" + n.Helpers.uuid4()), t && t.className && this.addClass(t.className), this.html && this._bindEvent("pop-contextmenu", this.html, "contextmenu", this.__onContextMenu.bind(this)), this._bindEvent("locale-changed", document, "stonejs-locale-changed", this.__onLocaleChanged.bind(this)), i[this.name] = this
                                 },_name: null,getName: function() {
                                 return this._name
                                 },setName: function(t) {
                                 delete i[this.name], this._name = t, i[t] = this, this.html && (this.html.id = this.name)
                                 },_visible: !0,isVisible: function() {
                                 return this._visible
                                 },setVisible: function(t) {
                                 this._visible = t, this.html && (this.visible ? (this.html.style.display = "", this._callCallbacks("show")) : (this.html.style.display = "none", this._callCallbacks("hide")))
                                 },_tooltip: null,getTooltip: function() {
                                 return this._tooltip
                                 },setTooltip: function(t) {
                                 this._tooltip = t, t ? this.html.title = t : delete this.html.removeAttribute("title")
                                 },_contextMenuName: null,getContextMenuName: function() {
                                 return this._contextMenuName
                                 },setContextMenuName: function(t) {
                                 this._contextMenuName = t
                                 },getContextMenu: function() {
                                 return n.getWidget(this.contextMenuName)
                                 },setContextMenu: function(t) {
                                 this.contextMenuName = t instanceof n.PopupWindow ? t.name : null
                                 },_layoutOptions: {},getLayoutOptions: function() {
                                 return this._layoutOptions
                                 },setLayoutOptions: function(t) {
                                 for (option in t)
                                 this._layoutOptions[option] = t[option]
                                 },getHtml: function() {
                                 return console.warn("getHtml() method not implemented for this widget."), null
                                 },getAbsolutePosition: function() {
                                 return this.html ? n.Helpers.getAbsolutePosition(this.html) : {x: 0,y: 0}
                                 },getOffsetWidth: function() {
                                 return this.html ? this.html.offsetWidth : 0
                                 },getOffsetHeight: function() {
                                 return this.html ? this.html.offsetHeight : 0
                                 },__html: {},show: function() {
                                 this.visible = !0
                                 },hide: function() {
                                 this.visible = !1
                                 },destroy: function() {
                                 this.$super(), delete i[this.name], this.html && this.html.parentNode && this.html.parentNode.removeChild(this.html)
                                 },addClass: function(t) {
                                 if (this.html) {
                                 var e = this.html.className.split(" ");
                                 e.indexOf(t) < 0 && e.push(t), this.html.className = e.join(" ")
                                 }
                                 },removeClass: function(t) {
                                 if (this.html) {
                                 var e = this.html.className.split(" "), n = e.indexOf(t);
                                 n >= 0 && e.splice(n, 1), this.html.className = e.join(" ")
                                 }
                                 },_buildHtml: function() {
                                 console.warn("_buildHtml() method not implemented for this widget.")
                                 },__onContextMenu: function(t) {
                                 t.stopPropagation(), t.preventDefault(), this.contextMenuName && this.contextMenu.popupXY(t.pageX, t.pageY)
                                 },__onLocaleChanged: function() {
                                 if (t.Stone)
                                 for (var e in this)
                                 this[e] instanceof Stone.LazyString && (this[e] = this[e])
                                 }});
    var n = n || {};
    n.Canvas = n.Widget.$extend({__init__: function(t) {
                                this.$super(t), this._updateProperties(["width", "height"]), this.getContext = this.__html.canvas.getContext.bind(this.__html.canvas), this.__html.canvas.supportsContext && (this.supportsContext = this.__html.canvas.supportsContext.bind(this.__html.canvas)), this.__html.canvas.setContext && (this.setContext = this.__html.canvas.setContext.bind(this.__html.canvas)), this.__html.canvas.transferControlToProxy && (this.transferControlToProxy = this.__html.canvas.transferControlToProxy.bind(this.__html.canvas)), this.toDataURL = this.__html.canvas.toDataURL.bind(this.__html.canvas), this.__html.canvas.toDataURLHD && (this.toDataURLHD = this.__html.canvas.toDataURLHD.bind(this.__html.canvas)), this.__html.canvas.toBlob && (this.toBlob = this.__html.canvas.toBlob.bind(this.__html.canvas)), this.__html.canvas.toBlobHD && (this.toBlobHD = this.__html.canvas.toBlobHD.bind(this.__html.canvas))
                                },getWidth: function() {
                                return this.__html.canvas.width
                                },setWidth: function(t) {
                                this.__html.canvas.width = t || 300
                                },getHeight: function() {
                                return this.__html.canvas.height
                                },setHeight: function(t) {
                                this.__html.canvas.height = t || 150
                                },getCanvas: function() {
                                return this.__html.canvas
                                },getHtml: function() {
                                return this.__html.outer
                                },getInteractiveNode: function() {
                                return this.__html.canvas
                                },_buildHtml: function() {
                                this.__html.outer = document.createElement("div"), this.__html.outer.className = "photonui-widget photonui-canvas", this.__html.canvas = document.createElement("canvas"), this.__html.outer.appendChild(this.__html.canvas)
                                },__onLocaleChanged: function() {
                                }});
    var n = n || {};
    n.CheckBox = n.Widget.$extend({__init__: function(t) {
                                  this._registerWEvents(["value-changed", "click"]), this.$super(t), this.inputId = this.name + "-input", this._bindEvent("value-changed", this.__html.checkbox, "change", this.__onChange.bind(this)), this._bindEvent("span-click", this.__html.span, "click", this.__onSpanClick.bind(this)), this._bindEvent("checkbox-click", this.__html.checkbox, "click", this.__onCheckboxClick.bind(this)), this._bindEvent("span-keypress", this.__html.span, "keypress", this.__onSpanKeypress.bind(this)), this.__html.checkbox.name = this.name, this.__html.checkbox.id = this.inputId
                                  },getValue: function() {
                                  return this.__html.checkbox.checked
                                  },setValue: function(t) {
                                  this.__html.checkbox.checked = t
                                  },getHtml: function() {
                                  return this.__html.outer
                                  },_buildHtml: function() {
                                  this.__html.outer = document.createElement("div"), this.__html.outer.className = "photonui-widget photonui-checkbox", this.__html.checkbox = document.createElement("input"), this.__html.checkbox.type = "checkbox", this.__html.outer.appendChild(this.__html.checkbox), this.__html.span = document.createElement("span"), this.__html.span.tabIndex = "0", this.__html.outer.appendChild(this.__html.span)
                                  },__onChange: function() {
                                  this._callCallbacks("value-changed", [this.value]), "none" == t.getComputedStyle(this.__html.checkbox).display && this.__html.span.focus()
                                  },__onSpanClick: function(t) {
                                  this.value = !this.value, this._callCallbacks("value-changed", [this.value]), this._callCallbacks("click", [t])
                                  },__onCheckboxClick: function(t) {
                                  this._callCallbacks("click", [t])
                                  },__onSpanKeypress: function(t) {
                                  (32 == t.charCode || 13 == t.keyCode) && (this.value = !this.value, this._callCallbacks("value-changed", [this.value]))
                                  }});
    var n = n || {};
    n.Container = n.Widget.$extend({_childName: null,getChildName: function() {
                                   return this._childName
                                   },setChildName: function(t) {
                                   this.childName && this.containerNode && this.child && this.child.html && this.containerNode.removeChild(this.child.html), this._childName = t, this.childName && this.containerNode && this.child && this.child.html && this.containerNode.appendChild(this.child.html)
                                   },getChild: function() {
                                   return n.getWidget(this.childName)
                                   },setChild: function(t) {
                                   return !t instanceof n.Widget ? void (this.childName = null) : void (this.childName = t.name)
                                   },getContainerNode: function() {
                                   return console.warn("getContainerNode() method not implemented for this widget."), null
                                   },destroy: function() {
                                   this.childName && this.child.destroy(), this.$super()
                                   }});
    var n = n || {};
    n.Label = n.Widget.$extend({__init__: function(t) {
                               var t = t || {};
                               t.layoutOptions = t.layoutOptions || {}, t.layoutOptions.verticalExpansion === e && (t.layoutOptions.verticalExpansion = !1), this.$super(t), this._updateProperties(["text", "textAlign", "forInputName"])
                               },_text: "Label",getText: function() {
                               return this._text
                               },setText: function(t) {
                               this._text = t, n.Helpers.cleanNode(this.__html.label), this.__html.label.appendChild(document.createTextNode(t))
                               },_textAlign: "left",getTextAlign: function() {
                               return this._textAlign
                               },setTextAlign: function(t) {
                               if ("left" != t && "center" != t && "right" != t)
                               throw "Text alignement sould be 'left', 'center' or 'right'.";
                               this._textAlign = t, this.__html.label.style.textAlign = t
                               },_forInputName: null,getForInputName: function() {
                               return this._forInputName
                               },setForInputName: function(t) {
                               this._forInputName = t, this._forInputName && this.__html.label.setAttribute("for", n.Helpers.escapeHtml(this.forInput.inputId || this.forInput.name))
                               },getForInput: function() {
                               return n.getWidget(this.forInputName)
                               },setForInput: function(t) {
                               this.forInputName = t.name
                               },getHtml: function() {
                               return this.__html.label
                               },_buildHtml: function() {
                               this.__html.label = document.createElement("label"), this.__html.label.className = "photonui-widget photonui-label"
                               }});
    var n = n || {};
    n.Field = n.Widget.$extend({__init__: function(t) {
                               this._registerWEvents(["value-changed", "keydown", "keyup", "keypress", "selection-changed"]), this.$super(t), this._updateProperties(["value", "placeholder"]), this.__html.field.name = this.name
                               },getValue: function() {
                               return this.__html.field.value
                               },setValue: function(t) {
                               this.__html.field.value = t
                               },_placeholder: "",getPlaceholder: function() {
                               return this._placeholder
                               },setPlaceholder: function(t) {
                               this._placeholder = t, this.__html.field.placeholder = t
                               },getHtml: function() {
                               return this.__html.field
                               },_bindFieldEvents: function() {
                               this._bindEvent("value-changed", this.__html.field, "change", function() {
                                               this._callCallbacks("value-changed", [this.getValue()])
                                               }.bind(this)), this._bindEvent("keydown", this.__html.field, "keydown", function(t) {
                                                                              this._callCallbacks("keydown", [t])
                                                                              }.bind(this)), this._bindEvent("keyup", this.__html.field, "keyup", function(t) {
                                                                                                             this._callCallbacks("keyup", [t])
                                                                                                             }.bind(this)), this._bindEvent("keypress", this.__html.field, "keypress", function(t) {
                                                                                                                                            this._callCallbacks("keypress", [t])
                                                                                                                                            }.bind(this)), this._bindEvent("selection-changed", this.__html.field, "select", function(t) {
                                                                                                                                                                           this._callCallbacks("selection-changed", [this.__html.field.selectionStart, this.__html.field.selectionEnd, ("" + this.getValue()).substring(this.__html.field.selectionStart, this.__html.field.selectionEnd), t])
                                                                                                                                                                           }.bind(this))
                               },__onContextMenu: function(t) {
                               t.stopPropagation()
                               }});
    var n = n || {};
    n.BaseIcon = n.Widget.$extend({__onLocaleChanged: function() {
                                  }}), t.Stone = function() {
        function t(t, n) {
            this.toString = e.bind(this, t, n)
        }
        function e(t, e) {
            var n = t;
            if (l && a[l] && a[l][t] && (n = a[l][t]), e)
                for (var i in e)
                    n = n.replace(new RegExp("{" + i + "}", "g"), e[i]);
            return n
        }
        function n(e, n) {
            return new t(e, n)
        }
        function i(t) {
            for (var e in t)
                a[e] = t[e]
                }
        function o() {
            return l
        }
        function r(t) {
            l = t;
            var e = null;
            try {
                e = new Event("stonejs-locale-changed")
            } catch (n) {
                e = document.createEvent("Event"), e.initEvent("stonejs-locale-changed", !0, !1)
            }
            document.dispatchEvent(e)
        }
        function s() {
            var t = navigator.language || navigator.userLanguage || navigator.systemLanguage || navigator.browserLanguage || null;
            return t && (t = t.toLowerCase()), t && t.length > 3 && (t = t.split(";")[0], t = t.split(",")[0], t = t.split("-")[0], t = t.split("_")[0], t.length > 3 && (t = null)), t || "en"
        }
        var a = {}, l = null;
        return {LazyString: t,gettext: e,lazyGettext: n,addCatalogs: i,getLocale: o,setLocale: r,guessUserLanguage: s}
    }(t);
    var n = n || {};
    n.Translation = n.Base.$extend({__init__: function(e) {
                                   this._registerWEvents(["locale-changed"]), this.$super(e), this._bindEvent("locale-changed", document, "stonejs-locale-changed", this.__onStonejsLocaleChanged.bind(this)), t._ = this.lazyGettext
                                   },getLocale: Stone.getLocale,setLocale: Stone.setLocale,addCatalogs: Stone.addCatalogs,guessUserLanguage: Stone.guessUserLanguage,gettext: Stone.gettext,lazyGettext: Stone.lazyGettext,__onStonejsLocaleChanged: function() {
                                   this._callCallbacks("locale-changed", [this.locale])
                                   }}), function(t, e) {
        function n() {
            function t() {
                var n;
                return n = e("amd"), n.fork = t, n
            }
            return t()
        }
        function i() {
            function t() {
                var n;
                return n = e("CommonJS"), n.fork = t, n
            }
            module.exports = t()
        }
        function o() {
            function n() {
                function i() {
                    var e, n;
                    for (n = Array.prototype.slice.apply(arguments), e = 0; e < r.length; e += 1)
                        "undefined" == typeof s[r[e]] ? delete t[r[e]] : t[r[e]] = s[r[e]];
                    for (s = {}, e = 0; e < n.length; e += 1) {
                        if ("string" != typeof n[e])
                            throw new Error("Cannot replace namespaces. All new namespaces must be strings.");
                        s[n[e]] = t[n[e]], t[n[e]] = o
                    }
                    return r = n
                }
                var o, r = [], s = {};
                return o = e("global"), o.fork = n, o.noConflict = i, o
            }
            var i;
            i = n(), i.noConflict("KeyboardJS", "k")
        }
        [].indexOf || (Array.prototype.indexOf = function(t, e, n) {
                       for (n = this.length, e = (n + ~~e) % n; n > e && (!(e in this) || this[e] !== t); e++)
                       ;
                       return e ^ n ? e : -1
                       }), "function" == typeof define && define.amd ? define(n) : "undefined" != typeof module ? i() : o()
    }(this, function() {
      function e() {
      t.addEventListener ? (document.addEventListener("keydown", o, !1), document.addEventListener("keyup", r, !1), t.addEventListener("blur", i, !1), t.addEventListener("webkitfullscreenchange", i, !1), t.addEventListener("mozfullscreenchange", i, !1)) : t.attachEvent && (document.attachEvent("onkeydown", o), document.attachEvent("onkeyup", r), t.attachEvent("onblur", i))
      }
      function n() {
      i(), t.removeEventListener ? (document.removeEventListener("keydown", o, !1), document.removeEventListener("keyup", r, !1), t.removeEventListener("blur", i, !1), t.removeEventListener("webkitfullscreenchange", i, !1), t.removeEventListener("mozfullscreenchange", i, !1)) : t.detachEvent && (document.detachEvent("onkeydown", o), document.detachEvent("onkeyup", r), t.detachEvent("onblur", i))
      }
      function i(t) {
      I = [], u(), f(t)
      }
      function o(t) {
      var e, n, i;
      if (e = s(t.keyCode), !(e.length < 1)) {
      for (t.isRepeat = !1, i = 0; i < e.length; i += 1)
      n = e[i], -1 != x().indexOf(n) && (t.isRepeat = !0), C(n);
      c(), g(t)
      }
      }
      function r(t) {
      var e, n;
      if (e = s(t.keyCode), !(e.length < 1)) {
      for (n = 0; n < e.length; n += 1)
      M(e[n]);
      u(), f(t)
      }
      }
      function s(t) {
      return E[t] || []
      }
      function a(t) {
      var e;
      for (e in E)
      if (E.hasOwnProperty(e) && E[e].indexOf(t) > -1)
      return e;
      return !1
      }
      function l(t, e) {
      if ("string" != typeof t && ("object" != typeof t || "function" != typeof t.push))
      throw new Error("Cannot create macro. The combo must be a string or array.");
      if ("object" != typeof e || "function" != typeof e.push)
      throw new Error("Cannot create macro. The injectedKeys must be an array.");
      T.push([t, e])
      }
      function h(t) {
      var e;
      if ("string" != typeof t && ("object" != typeof t || "function" != typeof t.push))
      throw new Error("Cannot remove macro. The combo must be a string or array.");
      for (mI = 0; mI < T.length; mI += 1)
      if (e = T[mI], y(t, e[0])) {
      M(e[1]), T.splice(mI, 1);
      break
      }
      }
      function c() {
      var t, e, n;
      for (t = 0; t < T.length; t += 1)
      if (e = b(T[t][0]), -1 === k.indexOf(T[t]) && _(e))
      for (k.push(T[t]), n = 0; n < T[t][1].length; n += 1)
      C(T[t][1][n])
      }
      function u() {
      var t, e, n;
      for (t = 0; t < k.length; t += 1)
      if (e = b(k[t][0]), _(e) === !1) {
      for (n = 0; n < k[t][1].length; n += 1)
      M(k[t][1][n]);
      k.splice(t, 1), t -= 1
      }
      }
      function p(t, e, n) {
      function i() {
      var t;
      for (t = 0; t < h.length; t += 1)
      N.splice(N.indexOf(h[t]), 1)
      }
      function o(t) {
      function e() {
      var e, i;
      for (e = 0; e < n.length; e += 1)
      if ("function" == typeof n[e])
      if ("keyup" === t)
      for (i = 0; i < h.length; i += 1)
      h[i].keyUpCallback.splice(h[i].keyUpCallback.indexOf(n[e]), 1);
      else
      for (i = 0; i < h.length; i += 1)
      h[i].keyDownCallback.splice(h[i].keyDownCallback.indexOf(n[e]), 1)
      }
      var n, i, o, r = {};
      if ("string" != typeof t)
      throw new Error("Cannot bind callback. The event name must be a string.");
      if ("keyup" !== t && "keydown" !== t)
      throw new Error('Cannot bind callback. The event name must be a "keyup" or "keydown".');
      for (n = Array.prototype.slice.apply(arguments, [1]), i = 0; i < n.length; i += 1)
      if ("function" == typeof n[i])
      if ("keyup" === t)
      for (o = 0; o < h.length; o += 1)
      h[o].keyUpCallback.push(n[i]);
      else if ("keydown" === t)
      for (o = 0; o < h.length; o += 1)
      h[o].keyDownCallback.push(n[i]);
      return r.clear = e, r
      }
      var r, s, a, l = {}, h = [];
      for ("string" == typeof t && (t = b(t)), s = 0; s < t.length; s += 1) {
      if (r = {}, a = w([t[s]]), "string" != typeof a)
      throw new Error("Failed to bind key combo. The key combo must be string.");
      r.keyCombo = a, r.keyDownCallback = [], r.keyUpCallback = [], e && r.keyDownCallback.push(e), n && r.keyUpCallback.push(n), N.push(r), h.push(r)
      }
      return l.clear = i, l.on = o, l
      }
      function d(t) {
      var e, n;
      for (e = 0; e < N.length; e += 1)
      n = N[e], y(t, n.keyCombo) && (N.splice(e, 1), e -= 1)
      }
      function m(t) {
      var e, n, i;
      if (t) {
      for (e = 0; e < N.length; e += 1)
      for (i = N[e], n = 0; n < i.keyCombo.length; n += 1)
      if (i.keyCombo[n].indexOf(t) > -1) {
      N.splice(e, 1), e -= 1;
      break
      }
      } else
      N = []
      }
      function g(t) {
      var e, n, i, o, r, s, a, l, h, c, u, p = [];
      for (r = [].concat(I), e = 0; e < N.length; e += 1)
      u = v(N[e].keyCombo).length, p[u] || (p[u] = []), p[u].push(N[e]);
      for (n = p.length - 1; n >= 0; n -= 1)
      if (p[n])
      for (e = 0; e < p[n].length; e += 1) {
      for (i = p[n][e], o = v(i.keyCombo), h = !0, l = 0; l < o.length; l += 1)
      if (-1 === r.indexOf(o[l])) {
      h = !1;
      break
      }
      if (h && _(i.keyCombo)) {
      for (R.push(i), l = 0; l < o.length; l += 1)
      c = r.indexOf(o[l]), c > -1 && (r.splice(c, 1), l -= 1);
      for (s = 0; s < i.keyDownCallback.length; s += 1)
      i.keyDownCallback[s](t, x(), i.keyCombo) === !1 && (a = !0);
      a === !0 && (t.preventDefault(), t.stopPropagation())
      }
      }
      }
      function f(t) {
      var e, n, i, o;
      for (e = 0; e < R.length; e += 1)
      if (i = R[e], _(i.keyCombo) === !1) {
      for (n = 0; n < i.keyUpCallback.length; n += 1)
      i.keyUpCallback[n](t, x(), i.keyCombo) === !1 && (o = !0);
      o === !0 && (t.preventDefault(), t.stopPropagation()), R.splice(e, 1), e -= 1
      }
      }
      function y(t, e) {
      var n, i, o;
      if (t = b(t), e = b(e), t.length !== e.length)
      return !1;
      for (n = 0; n < t.length; n += 1) {
      if (t[n].length !== e[n].length)
      return !1;
      for (i = 0; i < t[n].length; i += 1) {
      if (t[n][i].length !== e[n][i].length)
      return !1;
      for (o = 0; o < t[n][i].length; o += 1)
      if (-1 === e[n][i].indexOf(t[n][i][o]))
      return !1
      }
      }
      return !0
      }
      function _(t) {
      var e, n, i, o, r, s, a = 0;
      for (t = b(t), e = 0; e < t.length; e += 1) {
      for (s = !0, a = 0, n = 0; n < t[e].length; n += 1) {
      for (i = [].concat(t[e][n]), o = a; o < I.length; o += 1)
      r = i.indexOf(I[o]), r > -1 && (i.splice(r, 1), a = o);
      if (0 !== i.length) {
      s = !1;
      break
      }
      }
      if (s)
      return !0
      }
      return !1
      }
      function v(t) {
      var e, n, i = [];
      for (t = b(t), e = 0; e < t.length; e += 1)
      for (n = 0; n < t[e].length; n += 1)
      i = i.concat(t[e][n]);
      return i
      }
      function b(t) {
      var e = t, n = 0, i = 0, o = !1, r = !1, s = [], a = [], l = [], h = "";
      if ("object" == typeof t && "function" == typeof t.push)
      return t;
      if ("string" != typeof t)
      throw new Error('Cannot parse "keyCombo" because its type is "' + typeof t + '". It must be a "string".');
      for (; " " === e.charAt(n); )
      n += 1;
      for (; ; ) {
      if (" " === e.charAt(n)) {
      for (; " " === e.charAt(n); )
      n += 1;
      o = !0
      } else if ("," === e.charAt(n)) {
      if (i || r)
      throw new Error("Failed to parse key combo. Unexpected , at character index " + n + ".");
      r = !0, n += 1
      } else if ("+" === e.charAt(n)) {
      if (h.length && (l.push(h), h = ""), i || r)
      throw new Error("Failed to parse key combo. Unexpected + at character index " + n + ".");
      i = !0, n += 1
      } else if (">" === e.charAt(n)) {
      if (h.length && (l.push(h), h = ""), l.length && (a.push(l), l = []), i || r)
      throw new Error("Failed to parse key combo. Unexpected > at character index " + n + ".");
      i = !0, n += 1
      } else if (n < e.length - 1 && "!" === e.charAt(n) && (">" === e.charAt(n + 1) || "," === e.charAt(n + 1) || "+" === e.charAt(n + 1)))
      h += e.charAt(n + 1), i = !1, o = !1, r = !1, n += 2;
      else {
      if (!(n < e.length && "+" !== e.charAt(n) && ">" !== e.charAt(n) && "," !== e.charAt(n) && " " !== e.charAt(n))) {
      n += 1;
      continue
      }
      for ((i === !1 && o === !0 || r === !0) && (h.length && (l.push(h), h = ""), l.length && (a.push(l), l = []), a.length && (s.push(a), a = [])), i = !1, o = !1, r = !1; n < e.length && "+" !== e.charAt(n) && ">" !== e.charAt(n) && "," !== e.charAt(n) && " " !== e.charAt(n); )
      h += e.charAt(n), n += 1
      }
      if (n >= e.length) {
      h.length && (l.push(h), h = ""), l.length && (a.push(l), l = []), a.length && (s.push(a), a = []);
      break
      }
      }
      return s
      }
      function w(t) {
      var e, n, i = [];
      if ("string" == typeof t)
      return t;
      if ("object" != typeof t || "function" != typeof t.push)
      throw new Error("Cannot stringify key combo.");
      for (e = 0; e < t.length; e += 1) {
      for (i[e] = [], n = 0; n < t[e].length; n += 1)
      i[e][n] = t[e][n].join(" + ");
      i[e] = i[e].join(" > ")
      }
      return i.join(" ")
      }
      function x() {
      return [].concat(I)
      }
      function C(t) {
      if (t.match(/\s/))
      throw new Error("Cannot add key name " + t + " to active keys because it contains whitespace.");
      I.indexOf(t) > -1 || I.push(t)
      }
      function M(t) {
      var e = a(t);
      "91" === e || "92" === e ? I = [] : I.splice(I.indexOf(t), 1)
      }
      function D(t, e) {
      if ("string" != typeof t)
      throw new Error("Cannot register new locale. The locale name must be a string.");
      if ("object" != typeof e)
      throw new Error("Cannot register " + t + " locale. The locale map must be an object.");
      if ("object" != typeof e.map)
      throw new Error("Cannot register " + t + " locale. The locale map is invalid.");
      e.macros || (e.macros = []), P[t] = e
      }
      function B(t) {
      if (t) {
      if ("string" != typeof t)
      throw new Error("Cannot set locale. The locale name must be a string.");
      if (!P[t])
      throw new Error("Cannot set locale to " + t + " because it does not exist. If you would like to submit a " + t + " locale map for KeyboardJS please submit it at https://github.com/RobertWHurst/KeyboardJS/issues.");
      E = P[t].map, T = P[t].macros, A = t
      }
      return A
      }
      var A, E, T, S, L, O = {}, P = {}, I = [], N = [], R = [], k = [];
      for (L = {map: {3: ["cancel"],8: ["backspace"],9: ["tab"],12: ["clear"],13: ["enter"],16: ["shift"],17: ["ctrl"],18: ["alt", "menu"],19: ["pause", "break"],20: ["capslock"],27: ["escape", "esc"],32: ["space", "spacebar"],33: ["pageup"],34: ["pagedown"],35: ["end"],36: ["home"],37: ["left"],38: ["up"],39: ["right"],40: ["down"],41: ["select"],42: ["printscreen"],43: ["execute"],44: ["snapshot"],45: ["insert", "ins"],46: ["delete", "del"],47: ["help"],91: ["command", "windows", "win", "super", "leftcommand", "leftwindows", "leftwin", "leftsuper"],92: ["command", "windows", "win", "super", "rightcommand", "rightwindows", "rightwin", "rightsuper"],145: ["scrolllock", "scroll"],186: ["semicolon", ";"],187: ["equal", "equalsign", "="],188: ["comma", ","],189: ["dash", "-"],190: ["period", "."],191: ["slash", "forwardslash", "/"],192: ["graveaccent", "`"],219: ["openbracket", "["],220: ["backslash", "\\"],221: ["closebracket", "]"],222: ["apostrophe", "'"],48: ["zero", "0"],49: ["one", "1"],50: ["two", "2"],51: ["three", "3"],52: ["four", "4"],53: ["five", "5"],54: ["six", "6"],55: ["seven", "7"],56: ["eight", "8"],57: ["nine", "9"],96: ["numzero", "num0"],97: ["numone", "num1"],98: ["numtwo", "num2"],99: ["numthree", "num3"],100: ["numfour", "num4"],101: ["numfive", "num5"],102: ["numsix", "num6"],103: ["numseven", "num7"],104: ["numeight", "num8"],105: ["numnine", "num9"],106: ["nummultiply", "num*"],107: ["numadd", "num+"],108: ["numenter"],109: ["numsubtract", "num-"],110: ["numdecimal", "num."],111: ["numdevide", "num/"],144: ["numlock", "num"],112: ["f1"],113: ["f2"],114: ["f3"],115: ["f4"],116: ["f5"],117: ["f6"],118: ["f7"],119: ["f8"],120: ["f9"],121: ["f10"],122: ["f11"],123: ["f12"]},macros: [["shift + `", ["tilde", "~"]], ["shift + 1", ["exclamation", "exclamationpoint", "!"]], ["shift + 2", ["at", "@"]], ["shift + 3", ["number", "#"]], ["shift + 4", ["dollar", "dollars", "dollarsign", "$"]], ["shift + 5", ["percent", "%"]], ["shift + 6", ["caret", "^"]], ["shift + 7", ["ampersand", "and", "&"]], ["shift + 8", ["asterisk", "*"]], ["shift + 9", ["openparen", "("]], ["shift + 0", ["closeparen", ")"]], ["shift + -", ["underscore", "_"]], ["shift + =", ["plus", "+"]], ["shift + (", ["opencurlybrace", "opencurlybracket", "{"]], ["shift + )", ["closecurlybrace", "closecurlybracket", "}"]], ["shift + \\", ["verticalbar", "|"]], ["shift + ;", ["colon", ":"]], ["shift + '", ["quotationmark", '"']], ["shift + !,", ["openanglebracket", "<"]], ["shift + .", ["closeanglebracket", ">"]], ["shift + /", ["questionmark", "?"]]]}, S = 65; 90 >= S; S += 1)
      L.map[S] = String.fromCharCode(S + 32), L.macros.push(["shift + " + String.fromCharCode(S + 32) + ", capslock + " + String.fromCharCode(S + 32), [String.fromCharCode(S)]]);
      return D("us", L), B("us"), e(), O.enable = e, O.disable = n, O.activeKeys = x, O.on = p, O.clear = d, O.clear.key = m, O.locale = B, O.locale.register = D, O.macro = l, O.macro.remove = h, O.key = {}, O.key.name = s, O.key.code = a, O.combo = {}, O.combo.active = _, O.combo.parse = b, O.combo.stringify = w, O
      });
    var n = n || {};
    n.AccelManager = n.Base.$extend({__init__: function() {
                                    this.__kbd = {}, this.$super()
                                    },__kbd: null,addAccel: function(t, n, i, o) {
                                    var n = n.toLowerCase().replace(/ *\+ */, " + ").replace(/ *, */, ", ").replace(/ *> */, " > ");
                                    this.removeAccel(t), this.__kbd[t] = {keys: n,safe: o === e ? !0 : o,callback: i,binding: KeyboardJS.on(n, this.__onAccell.bind(this))}
                                    },removeAccel: function(t) {
                                    this.__kbd[t] && (this.__kbd[t].binding.clear(), delete this.__kbd[t])
                                    },destroy: function() {
                                    for (var t in this.__kbd)
                                    this.removeAccel(t);
                                    this.$super()
                                    },__onAccell: function(t, e, n) {
                                    for (var i in this.__kbd)
                                    this.__kbd[i].keys == n && (this.__kbd[i].safe && (document.activeElement instanceof HTMLInputElement || document.activeElement instanceof HTMLSelectElement || document.activeElement instanceof HTMLTextAreaElement) || (this.__kbd[i].callback(), t.stopPropagation(), t.preventDefault()))
                                    }});
    var n = n || {};
    n.Separator = n.Widget.$extend({__init__: function(t) {
                                   this.$super(t), this._updateProperties(["orientation"])
                                   },_orientation: "horizontal",getOrientation: function() {
                                   return this._orientation
                                   },setOrientation: function(t) {
                                   if ("vertical" != t && "horizontal" != t)
                                   throw 'Error: The orientation should be "vertical" or "horizontal".';
                                   this._orientation = t, this.removeClass("photonui-separator-vertical"), this.removeClass("photonui-separator-horizontal"), this.addClass("photonui-separator-" + this.orientation)
                                   },getHtml: function() {
                                   return this.__html.outer
                                   },_buildHtml: function() {
                                   this.__html.outer = document.createElement("div"), this.__html.outer.className = "photonui-widget photonui-separator", this.__html.hr = document.createElement("hr"), this.__html.outer.appendChild(this.__html.hr)
                                   },__onLocaleChanged: function() {
                                   }});
    var n = n || {};
    n.Color = n.Base.$extend({__init__: function(t) {
                             this._registerWEvents(["value-changed"]), "object" != typeof t || Array.isArray(t) ? (this.$super(), "string" == typeof t ? this.hexString = t : Array.isArray(t) ? this.setRGBA(t) : arguments.length >= 3 && this.setRGBA.apply(this, arguments)) : this.$super(t)
                             },getHexString: function() {
                             var t = this.red.toString(16).toUpperCase();
                             1 == t.length && (t = "0" + t);
                             var e = this.green.toString(16).toUpperCase();
                             1 == e.length && (e = "0" + e);
                             var n = this.blue.toString(16).toUpperCase();
                             return 1 == n.length && (n = "0" + n), "#" + t + e + n
                             },setHexString: function(t) {
                             var t = t.replace(" ", "");
                             if (t.match(/^#[0-9a-f]{6}$/i))
                             this._red = parseInt(t[1] + t[2], 16), this._green = parseInt(t[3] + t[4], 16), this._blue = parseInt(t[5] + t[6], 16), this._updateHSB();
                             else if (t.match(/^#[0-9a-f]{3}$/i))
                             this._red = parseInt(t[1] + t[1], 16), this._green = parseInt(t[2] + t[2], 16), this._blue = parseInt(t[3] + t[3], 16), this._updateHSB();
                             else {
                             var n = {white: [255, 255, 255],silver: [192, 192, 192],gray: [128, 128, 128],black: [0, 0, 0],red: [255, 0, 0],maroon: [128, 0, 0],yellow: [255, 255, 0],olive: [128, 128, 0],lime: [0, 255, 0],green: [0, 128, 0],aqua: [0, 255, 255],teal: [0, 128, 128],blue: [0, 0, 255],navy: [0, 0, 128],fuchsia: [255, 0, 255],purple: [128, 0, 128]};
                             n[t] != e && this.setRGB(n[t])
                             }
                             },getRgbString: function() {
                             return "rgb(" + this._red + ", " + this._green + ", " + this._blue + ")"
                             },getRgbaString: function() {
                             return "rgba(" + this._red + ", " + this._green + ", " + this._blue + ", " + this._alpha / 255 + ")"
                             },_red: 255,getRed: function() {
                             return this._red
                             },setRed: function(t) {
                             this._red = Math.max(0, Math.min(255, 0 | t)), this._updateHSB()
                             },_green: 0,getGreen: function() {
                             return this._green
                             },setGreen: function(t) {
                             this._green = Math.max(0, Math.min(255, 0 | t)), this._updateHSB()
                             },_blue: 0,getBlue: function() {
                             return this._blue
                             },setBlue: function(t) {
                             this._blue = Math.max(0, Math.min(255, 0 | t)), this._updateHSB()
                             },_alpha: 255,getAlpha: function() {
                             return this._alpha
                             },setAlpha: function(t) {
                             this._alpha = Math.max(0, Math.min(255, 0 | t)), this._callCallbacks("value-changed")
                             },_hue: 0,getHue: function() {
                             return this._hue
                             },setHue: function(t) {
                             this._hue = Math.max(0, Math.min(360, 0 | t)), this._updateRGB()
                             },_saturation: 100,getSaturation: function() {
                             return this._saturation
                             },setSaturation: function(t) {
                             this._saturation = Math.max(0, Math.min(100, 0 | t)), this._updateRGB()
                             },_brightness: 100,getBrightness: function() {
                             return this._brightness
                             },setBrightness: function(t) {
                             this._brightness = Math.max(0, Math.min(100, 0 | t)), this._updateRGB()
                             },setRGB: function() {
                             this.setRGBA.apply(this, arguments)
                             },setRGBA: function() {
                             var t = arguments;
                             1 == arguments.length && Array.isArray(arguments[0]) && (t = arguments[0]), t.length < 3 || (this._red = Math.max(0, Math.min(255, 0 | t[0])), this._green = Math.max(0, Math.min(255, 0 | t[1])), this._blue = Math.max(0, Math.min(255, 0 | t[2])), t[3] != e && (this._alpha = Math.max(0, Math.min(255, 0 | t[3]))), this._updateHSB())
                             },getRGB: function() {
                             return [this._red, this._green, this._blue]
                             },getRGBA: function() {
                             return [this._red, this._green, this._blue, this._alpha]
                             },setHSB: function() {
                             var t = arguments;
                             1 == arguments.length && Array.isArray(arguments[0]) && (t = arguments[0]), 3 == t.length && (this._hue = Math.max(0, Math.min(360, 0 | t[0])), this._saturation = Math.max(0, Math.min(100, 0 | t[1])), this._brightness = Math.max(0, Math.min(100, 0 | t[2])), this._updateRGB())
                             },toString: function() {
                             return this.hexString
                             },_updateHSB: function() {
                             var t = this._red / 255, e = this._green / 255, n = this._blue / 255, i = Math.min(t, e, n), o = Math.max(t, e, n);
                             o == i ? this._hue = 0 : o == t ? this._hue = Math.round((60 * (e - n) / (o - i) + 360) % 360) : o == e ? this._hue = Math.round(60 * (n - t) / (o - i) + 120) : o == n && (this._hue = Math.round(60 * (t - e) / (o - i) + 240)), this._saturation = 0 == o ? 0 : Math.round(100 * (1 - i / o)), this._brightness = Math.round(100 * o), this._callCallbacks("value-changed")
                             },_updateRGB: function() {
                             var t = this.hue % 360, e = this.saturation / 100, n = this.brightness / 100, i = (t / 60 | 0) % 6, o = t / 60 - i, r = n * (1 - e), s = n * (1 - o * e), a = n * (1 - (1 - o) * e);
                             switch (i) {
                             case 0:
                             this._red = 255 * n | 0, this._green = 255 * a | 0, this._blue = 255 * r | 0;
                             break;
                             case 1:
                             this._red = 255 * s | 0, this._green = 255 * n | 0, this._blue = 255 * r | 0;
                             break;
                             case 2:
                             this._red = 255 * r | 0, this._green = 255 * n | 0, this._blue = 255 * a | 0;
                             break;
                             case 3:
                             this._red = 255 * r | 0, this._green = 255 * s | 0, this._blue = 255 * n | 0;
                             break;
                             case 4:
                             this._red = 255 * a | 0, this._green = 255 * r | 0, this._blue = 255 * n | 0;
                             break;
                             case 5:
                             this._red = 255 * n | 0, this._green = 255 * r | 0, this._blue = 255 * s | 0
                             }
                             this._callCallbacks("value-changed")
                             }});
    var n = n || {};
    n.Text = n.Widget.$extend({_lastSet: "text",_raw: "",getText: function() {
                              return this.__html.outer.textContent
                              },setText: function(t) {
                              this._lastSet = "text", this._raw = t, n.Helpers.cleanNode(this.__html.outer), this.__html.outer.appendChild(document.createTextNode(t))
                              },getRawHtml: function() {
                              return this.__html.outer.innerHTML
                              },setRawHtml: function(t) {
                              this._lastSet = "rawHtml", this._raw = t, this.__html.outer.innerHTML = t
                              },getHtml: function() {
                              return this.__html.outer
                              },_buildHtml: function() {
                              this.__html.outer = document.createElement("div"), this.__html.outer.className = "photonui-widget photonui-text"
                              },__onLocaleChanged: function() {
                              t.Stone && (this.$super(), this._raw instanceof Stone.LazyString && (this[this._lastSet] = this._raw))
                              }});
    var n = n || {};
    n.FileManager = n.Base.$extend({__init__: function(t) {
                                   this.__fileField = document.createElement("input"), this.__fileField.type = "file", this.__fileField.addEventListener("change", this.__onFileSelected.bind(this), !1), this.__fileField.style.position = "fixed", this.__fileField.style.top = 0, this.__fileField.style.left = 0, this.__fileField.style.opacity = 0, this.__fileField.style.display = "none", document.getElementsByTagName("body")[0].appendChild(this.__fileField), this._acceptedMimes = [], this._acceptedExts = [], this._registerWEvents(["file-open"]), this.$super(t)
                                   },_acceptedMimes: [],getAcceptedMimes: function() {
                                   return this._acceptedMimes
                                   },setAcceptedMimes: function(t) {
                                   this._acceptedMimes = t, this._updateAccepted()
                                   },_acceptedExts: [],getAcceptedExts: function() {
                                   return this._acceptedExts
                                   },setAcceptedExts: function(t) {
                                   this._acceptedExts = t, this._updateAccepted()
                                   },_dropZone: null,getDropZone: function() {
                                   return this._dropZone
                                   },setDropZone: function(t) {
                                   this._dropZone && (this._unbindEvent("document-dragover"), this._unbindEvent("document-drop"), this._unbindEvent("element-dragover"), this._unbindEvent("element-drop")), this._dropZone = t, t && (this._bindEvent("document-dragover", document, "dragover", function(t) {
                                                                                                                                                                                                                                                       t.preventDefault()
                                                                                                                                                                                                                                                       }), this._bindEvent("document-drop", document, "drop", function(t) {
                                                                                                                                                                                                                                                                           t.preventDefault()
                                                                                                                                                                                                                                                                           }), this._bindEvent("element-dragover", document, "dragover", function() {
                                                                                                                                                                                                                                                                                               }), this._bindEvent("element-drop", document, "drop", this.__onFileDropped.bind(this)))
                                   },_multiselect: !1,getMultiselect: function() {
                                   return this._multiselect
                                   },setMultiselect: function(t) {
                                   this._multiselect = t, t ? this.__fileField.multiple = "true" : delete this.__fileField.multiple
                                   },__fileField: null,open: function() {
                                   this.__fileField.style.display = "inline-block", this.__fileField.focus(), this.__fileField.click(), this.__fileField.style.display = "none"
                                   },destroy: function() {
                                   document.getElementsByTagName("body")[0].removeChild(this.__fileField), this.$super()
                                   },_updateAccepted: function() {
                                   for (var t = [], e = 0; e < this.acceptedExts.length; e++)
                                   t.push("." + this.acceptedExts[e].toLocaleLowerCase());
                                   t = t.concat(this.acceptedMimes), this.__fileField.accept = t.join(",")
                                   },_openFile: function(t, e, n) {
                                   for (var i = !1, o = 0; o < this.acceptedMimes.length; o++)
                                   if (t.type == this.acceptedMimes[o]) {
                                   i = !0;
                                   break
                                   }
                                   if (!i)
                                   for (var r = t.name.split(".").splice(-1), s = 0; s < this.acceptedExts.length; s++)
                                   if (r == this.acceptedExts[s]) {
                                   i = !0;
                                   break
                                   }
                                   i && this._callCallbacks("file-open", [t, e, n])
                                   },__onFileDropped: function(t) {
                                   for (var e in t.dataTransfer.files) {
                                   var n = t.dataTransfer.files[e];
                                   n instanceof File && this._openFile(n, t.pageX, t.pageY)
                                   }
                                   },__onFileSelected: function() {
                                   for (var t in this.__fileField.files) {
                                   var e = this.__fileField.files[t];
                                   e instanceof File && this._openFile(e)
                                   }
                                   },__onLocaleChanged: function() {
                                   }});
    var n = n || {};
    n.ProgressBar = n.Widget.$extend({__init__: function(t) {
                                     this.$super(t), this._updateProperties(["orientation", "value", "pulsate"])
                                     },getHtml: function() {
                                     return this.__html.outer
                                     },_value: 0,getValue: function() {
                                     return this._value
                                     },setValue: function(t) {
                                     this._value = Math.min(Math.max(t, 0), 1), "horizontal" == this.orientation ? this.__html.bar.style.width = Math.floor(100 * this.value) + "%" : this.__html.bar.style.height = Math.floor(100 * this.value) + "%", this.__html.textContent.innerHTML = Math.floor(100 * this.value) + " %"
                                     },_orientation: "horizontal",getOrientation: function() {
                                     return this._orientation
                                     },setOrientation: function(t) {
                                     if ("vertical" != t && "horizontal" != t)
                                     throw 'Error: The orientation should be "vertical" or "horizontal".';
                                     this._orientation = t, this.removeClass("photonui-progressbar-vertical"), this.removeClass("photonui-progressbar-horizontal"), this.addClass("photonui-progressbar-" + this.orientation)
                                     },_pulsate: !1,isPulsate: function() {
                                     return this._pulsate
                                     },setPulsate: function(t) {
                                     this._pulsate = t, t ? (this.addClass("photonui-progressbar-pulsate"), "horizontal" == this.orientation ? this.__html.bar.style.width = "" : this.__html.bar.style.height = "") : (this.removeClass("photonui-progressbar-pulsate"), this.value = this.value)
                                     },_textVisible: !0,isTextVisible: function() {
                                     return this._textVisible
                                     },setTextVisible: function(t) {
                                     this._textVisible = t, this.__html.text.style.display = this.textVisible ? "" : "none"
                                     },_buildHtml: function() {
                                     this.__html.outer = document.createElement("div"), this.__html.outer.className = "photonui-widget photonui-progressbar", this.__html.text = document.createElement("div"), this.__html.text.className = "photonui-progressbar-text", this.__html.outer.appendChild(this.__html.text), this.__html.textContent = document.createElement("span"), this.__html.text.appendChild(this.__html.textContent), this.__html.bar = document.createElement("div"), this.__html.bar.className = "photonui-progressbar-bar", this.__html.outer.appendChild(this.__html.bar)
                                     },__onLocaleChanged: function() {
                                     }});
    var n = n || {};
    n.MouseManager = n.Base.$extend({__init__: function(t) {
                                    this._registerWEvents(["mouse-event", "mouse-down", "mouse-up", "click", "double-click", "drag-start", "dragging", "drag-end", "mouse-move", "scroll-up", "scroll-down"]), this.$super(), this.element = t
                                    },_element: null,getElement: function() {
                                    return this._element || document
                                    },setElement: function(t) {
                                    this._element = t instanceof n.Widget ? t.interactiveNode || t.html : t instanceof HTMLElement ? t : null, this._updateEvents()
                                    },_threshold: 5,getThreshold: function() {
                                    return this._threshold
                                    },setThreshold: function(t) {
                                    this._threshold = t
                                    },getPageX: function() {
                                    return this.__event.pageX || 0
                                    },getPageY: function() {
                                    return this.__event.pageY || 0
                                    },getX: function() {
                                    var t = n.Helpers.getAbsolutePosition(this.element).x;
                                    return this.pageX - t
                                    },getY: function() {
                                    var t = n.Helpers.getAbsolutePosition(this.element).y;
                                    return this.pageY - t
                                    },getDeltaX: function() {
                                    return this.pageX - (this.__prevState.pageX !== e ? this.__prevState.pageX : this.pageX)
                                    },getDeltaY: function() {
                                    return this.pageY - (this.__prevState.pageY !== e ? this.__prevState.pageY : this.pageY)
                                    },_action: "",getAction: function() {
                                    return this._action
                                    },_btnLeft: !1,getBtnLeft: function() {
                                    return this._btnLeft
                                    },_btnMiddle: !1,getBtnMiddle: function() {
                                    return this._btnMiddle
                                    },_btnRight: !1,getBtnRight: function() {
                                    return this._btnRight
                                    },_button: null,getButton: function() {
                                    return this._button
                                    },__prevState: {},__mouseDownEvent: {},__event: {},_updateEvents: function() {
                                    for (var t in this.__events)
                                    this._unbindEvent(t);
                                    this.element && (this._bindEvent("mouse-down", this.element, "mousedown", this.__onMouseDown.bind(this)), this._bindEvent("mouse-up", this.element, "mouseup", this.__onMouseUp.bind(this)), this._bindEvent("double-click", this.element, "dblclick", this.__onDoubleClick.bind(this)), this._bindEvent("mouse-move", this.element, "mousemove", this.__onMouseMove.bind(this)), this._bindEvent("mousewheel", this.element, "mousewheel", this.__onMouseWheel.bind(this)), this._bindEvent("mousewheel-firefox", this.element, "DOMMouseScroll", this.__onMouseWheel.bind(this)), this._bindEvent("document-mouse-up", document, "mouseup", this.__onDocumentMouseUp.bind(this)), this._bindEvent("document-mouse-move", document, "mousemove", this.__onDocumentMouseMove.bind(this)))
                                    },_dump: function() {
                                    return {event: this.__event,action: this.action,pageX: this.pageX,pageY: this.pageY,x: this.x,y: this.y,deltaX: this.deltaX,deltaY: this.deltaY,btnLeft: this.btnLeft,btnMiddle: this.btnMiddle,btnRight: this.btnRight,button: this.button}
                                    },_stateMachine: function(t, e) {
                                    this.__prevState = this._dump(), this._action = t, this.__event = e, this._button = null, 0 === e.button && (this._button = "left"), 1 === e.button && (this._button = "middle"), 2 === e.button && (this._button = "right"), "mouse-down" == t ? (this.__mouseDownEvent = e, 0 === e.button && (this._btnLeft = !0), 1 === e.button && (this._btnMiddle = !0), 2 === e.button && (this._btnRight = !0), this._callCallbacks("mouse-event", [this._dump()]), this._callCallbacks(this.action, [this._dump()])) : "mouse-up" == t ? (0 === e.button && (this._btnLeft = !1), 1 === e.button && (this._btnMiddle = !1), 2 === e.button && (this._btnRight = !1), this._callCallbacks("mouse-event", [this._dump()]), this._callCallbacks(this.action, [this._dump()])) : "drag-end" == t && (0 === e.button && (this._btnLeft = !1), 1 === e.button && (this._btnMiddle = !1), 2 === e.button && (this._btnRight = !1)), "mouse-up" == t && Math.abs(this.pageX - this.__mouseDownEvent.pageX) <= this._threshold && Math.abs(this.pageY - this.__mouseDownEvent.pageY) <= this._threshold && (this._action = "click", this._callCallbacks("mouse-event", [this._dump()]), this._callCallbacks("click", [this._dump()])), "double-click" == t && "click" == this.__prevState.action && (this._action = "double-click", this._callCallbacks("mouse-event", [this._dump()]), this._callCallbacks(this.action, [this._dump()])), "mouse-move" == t && (this._callCallbacks("mouse-event", [this._dump()]), this._callCallbacks(this.action, [this._dump()])), "mouse-move" == t && "drag-start" != this.__prevState.action && "dragging" != this.__prevState.action && (this.btnLeft || this.btnMiddle || this.btnRight) ? (Math.abs(this.pageX - this.__mouseDownEvent.pageX) > this._threshold || Math.abs(this.pageY - this.__mouseDownEvent.pageY) > this._threshold) && (this._action = "drag-start", this.__event = this.__mouseDownEvent, this._callCallbacks("mouse-event", [this._dump()]), this._callCallbacks(this.action, [this._dump()]), this._action = "dragging", this.__prevState.event = this.__mouseDownEvent, this.__event = e, this._callCallbacks("mouse-event", [this._dump()]), this._callCallbacks(this.action, [this._dump()])) : "dragging" == t || "mouse-move" == t && ("drag-start" == this.__prevState.action || "dragging" == this.__prevState.action) && (this.btnLeft || this.btnMiddle || this.btnRight) ? (this._action = "dragging", this._callCallbacks("mouse-event", [this._dump()]), this._callCallbacks(this.action, [this._dump()])) : "drag-end" != t && ("mouse-up" != t || "dragging" != this.__prevState.action && "drag-start" != this.__prevState.action || this.btnLeft || this.btnMiddle || this.btnRight) || (this._action = "drag-end", this._callCallbacks("mouse-event", [this._dump()]), this._callCallbacks(this.action, [this._dump()])), ("scroll-up" == t || "scroll-down" == t) && (this._callCallbacks("mouse-event", [this._dump()]), this._callCallbacks(this.action, [this._dump()]))
                                    },__onMouseDown: function(t) {
                                    this._stateMachine("mouse-down", t)
                                    },__onMouseUp: function(t) {
                                    this._stateMachine("mouse-up", t)
                                    },__onDoubleClick: function(t) {
                                    this._stateMachine("double-click", t)
                                    },__onMouseMove: function(t) {
                                    this._stateMachine("mouse-move", t)
                                    },__onDocumentMouseUp: function(t) {
                                    ("dragging" == this.action || "drag-start" == this.action) && this._stateMachine("drag-end", t)
                                    },__onDocumentMouseMove: function(t) {
                                    ("dragging" == this.action || "drag-start" == this.action) && this._stateMachine("dragging", t)
                                    },__onMouseWheel: function(t) {
                                    var n = null;
                                    t.wheelDeltaY != e && (n = t.wheelDeltaY), t.wheelDelta != e && (n = t.wheelDelta), t.axis != e && t.detail != e && 2 == t.axis && (n = -t.detail), null != n && (n >= 0 ? this._stateMachine("scroll-up", t) : this._stateMachine("scroll-down", t))
                                    }});
    var n = n || {};
    n.palette = [["#000000", "#424242", "#676767", "#989898", "#C5C5C5", "#FFFFFF"], ["#E52131", "#ED7130", "#F0902C", "#F0B922", "#EDE118", "#7DA638"], ["#EA4852", "#F08D52", "#F3A752", "#F9D246", "#F0EC51", "#A7CF41"], ["#F19096", "#F5BC93", "#F9CB94", "#F9E48A", "#F2F08E", "#C6DE84"], ["#F8D1D6", "#F9E2D2", "#F9E8D3", "#FDF8D2", "#F9F9CF", "#E7F1CD"], ["#1E9E85", "#2A7DB5", "#2751A1", "#6C3E98", "#A33E97", "#DF3795"], ["#2FB8A3", "#40A1D7", "#4072B5", "#8963AB", "#B462A7", "#E262A5"], ["#88CEC3", "#8CC9E9", "#87A8D3", "#D2A0C9", "#D2A0C9", "#EDA0C6"], ["#CEEAE7", "#CDE9F8", "#CFDEEF", "#EED9E9", "#EED9E9", "#F8D7E7"]], n.ColorPalette = n.Widget.$extend({__init__: function(t) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        this._color = new n.Color(n.palette[0][0]), this._registerWEvents(["value-changed"]), this.$super(t), this._updateProperties(["palette", "value"])
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        },getValue: function() {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        return this.color.hexString
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        },setValue: function(t) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        this.color.hexString = t
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        },_color: null,getColor: function() {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        return this._color
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        },setColor: function(t) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        t instanceof n.Color && (this._color = t)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        },_palette: null,getPalette: function() {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        return this._palette || n.palette
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        },setPalette: function(t) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        if (this._palette = t, !t)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        var t = n.palette;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        this.__html.palette.removeChild(this.__html.tbody), n.Helpers.cleanNode(this.__html.tbody);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        var e, i, o, r;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        for (r = 0; r < t.length; r++) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        var e = document.createElement("tr");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        for (o = 0; o < t[r].length; o++) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        var i = document.createElement("td");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        i.style.backgroundColor = t[r][o], i.onclick = this.__onColorClicked.bind(this, t[r][o]), e.appendChild(i)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        this.__html.tbody.appendChild(e)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        this.__html.palette.appendChild(this.__html.tbody)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        },getHtml: function() {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        return this.__html.palette
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        },_buildHtml: function() {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        this.__html.palette = document.createElement("table"), this.__html.palette.className = "photonui-widget photonui-colorpalette", this.__html.tbody = document.createElement("tbody"), this.__html.palette.appendChild(this.__html.tbody)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        },__onColorClicked: function(t) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        this.value = t, this._callCallbacks("value-changed", [this.color])
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }});
    var n = n || {};
    n.FAIcon = n.BaseIcon.$extend({__init__: function(t, e) {
                                  var n = {};
                                  if (t && "string" == typeof t) {
                                  if (n.iconName = t, e && "object" == typeof e)
                                  for (var i in e)
                                  n[i] = e[i]
                                  } else
                                  t && (n = t);
                                  this.$super(n), this._updateProperties(["iconName", "size", "color"])
                                  },_iconName: "",getIconName: function() {
                                  return this._iconName
                                  },setIconName: function(t) {
                                  this._iconName = t || "", this.__html.icon.className = "fa " + this.iconName + " " + this.size
                                  },_size: "",getSize: function() {
                                  return this._size
                                  },setSize: function(t) {
                                  this._size = t || "", this.__html.icon.className = "fa " + this.iconName + " " + this.size
                                  },_color: "inherit",getColor: function() {
                                  return this._color
                                  },setColor: function(t) {
                                  this._color = t || "inherit", this.__html.icon.style.color = this.color
                                  },getHtml: function() {
                                  return this.__html.outer
                                  },_buildHtml: function() {
                                  this.__html.outer = document.createElement("span"), this.__html.outer.className = "photonui-widget photonui-icon photonui-faicon", this.__html.icon = document.createElement("i"), this.__html.outer.appendChild(this.__html.icon)
                                  }});
    var n = n || {};
    n.Layout = n.Container.$extend({__init__: function(t) {
                                   this._childrenNames = [], this.$super(t)
                                   },_childrenNames: [],getChildrenNames: function() {
                                   return this._childrenNames
                                   },setChildrenNames: function(t) {
                                   this._childrenNames = t, this._updateLayout()
                                   },getChildren: function() {
                                   for (var t = [], e = 0; e < this._childrenNames.length; e++)
                                   t.push(n.getWidget(this._childrenNames[e]));
                                   return t
                                   },setChildren: function(t) {
                                   for (var e = [], i = 0; i < t.length; i++)
                                   t[i] instanceof n.Widget && e.push(t[i].name);
                                   this.childrenNames = e
                                   },getChildName: function() {
                                   return console.warn("Warning: You cannot use getChild() on layout widgets, please use getChildren() instead."), null
                                   },setChildName: function(t) {
                                   this.childrenNames = [t]
                                   },getChild: function() {
                                   return console.warn("Warning: You cannot use getChild() on layout widgets, please use getChildren() instead."), null
                                   },setChild: function(t) {
                                   this.children = [t]
                                   },addChild: function(t, e) {
                                   e && (t.layoutOptions = e), this._childrenNames.push(t.name), this._updateLayout()
                                   },removeChild: function(t) {
                                   var e = this._childrenNames.indexOf(t.name);
                                   e >= 0 && this._childrenNames.splice(e, 1), this._updateLayout()
                                   },destroy: function() {
                                   for (var t = this.children, e = 0; e < t.length; e++)
                                   t[e].destroy();
                                   this.$super()
                                   },_updateLayout: function() {
                                   throw "Error: you should define the _updateLayout() method when you extend a layout widget."
                                   },__onLocaleChanged: function() {
                                   }});
    var n = n || {};
    n.TextField = n.Field.$extend({__init__: function(t) {
                                  this.$super(t), this._bindFieldEvents()
                                  },getType: function() {
                                  return this.__html.field.type
                                  },setType: function(t) {
                                  if ("text" != t && "password" != t && "email" != t && "search" != t && "tel" != t && "url" != t)
                                  throw 'Error: The type should be "text", "password", "email", "search", "tel" or "url".';
                                  this.__html.field.type = t
                                  },_buildHtml: function() {
                                  this.__html.field = document.createElement("input"), this.__html.field.className = "photonui-widget photonui-field photonui-field-text", this.__html.field.type = "text"
                                  }});
    var n = n || {};
    n.NumericField = n.Field.$extend({__init__: function(t) {
                                     this.$super(t), this._updateProperties(["value"]), this._bindFieldEvents(), this._unbindEvent("value-changed"), this._bindEvent("keypress", this.__html.field, "keypress", this.__onKeypress.bind(this)), this._bindEvent("keyup", this.__html.field, "keyup", this.__onKeyup.bind(this)), this._bindEvent("keydown", this.__html.field, "keydown", this.__onKeydown.bind(this)), this._bindEvent("change", this.__html.field, "change", this.__onChange.bind(this)), this._bindEvent("mousewheel", this.__html.field, "mousewheel", this.__onMouseWheel.bind(this)), this._bindEvent("mousewheel-firefox", this.__html.field, "DOMMouseScroll", this.__onMouseWheel.bind(this))
                                     },_min: null,getMin: function() {
                                     return this._min
                                     },setMin: function(t) {
                                     this._min = t
                                     },_max: null,getMax: function() {
                                     return this._max
                                     },setMax: function(t) {
                                     this._max = t
                                     },_step: 1,getStep: function() {
                                     return this._step
                                     },setStep: function(t) {
                                     this._step = Math.abs(t)
                                     },_decimalDigits: null,getDecimalDigits: function() {
                                     return this._decimalDigits
                                     },setDecimalDigits: function(t) {
                                     this._decimalDigits = t
                                     },_decimalSymbol: ".",getDecimalSymbol: function() {
                                     return this._decimalSymbol
                                     },setDecimalSymbol: function(t) {
                                     this._decimalSymbol = t
                                     },_value: 0,getValue: function() {
                                     return parseFloat(this._value)
                                     },setValue: function(t) {
                                     this._updateValue(t), this._updateFieldValue()
                                     },_updateValue: function(t) {
                                     t = ("" + t).replace(",", "."), t = t.replace(/ /g, ""), t = parseFloat(t), isNaN(t) && (t = 0), null != this.min && (t = Math.max(this.min, t)), null != this.max && (t = Math.min(this.max, t)), null != this.decimalDigits && (t = t.toFixed(this.decimalDigits)), this._value = t
                                     },_updateFieldValue: function() {
                                     this.__html.field.value = ("" + this._value).replace(".", this.decimalSymbol)
                                     },_validateInput: function(t) {
                                     var t = "" + t;
                                     return t = t.replace(/ /g, ""), /^-?[0-9]*(\.|,)?[0-9]*$/.test(t) && (0 != this.decimalDigits || /^-?[0-9]*$/.test(t)) ? null !== this.min && this.min >= 0 && "-" == t[0] ? !1 : !0 : !1
                                     },_buildHtml: function() {
                                     this.__html.field = document.createElement("input"), this.__html.field.className = "photonui-widget photonui-field photonui-field-numeric", this.__html.field.type = "text"
                                     },__onKeypress: function(t) {
                                     if (!t.ctrlKey)
                                     if (13 == t.keyCode)
                                     this._updateFieldValue(), this._callCallbacks("value-changed", [this.value]);
                                     else {
                                     var e = this.__html.field, n = e.value.slice(0, e.selectionStart) + String.fromCharCode(t.charCode) + e.value.slice(e.selectionEnd);
                                     this._validateInput(n) || t.preventDefault()
                                     }
                                     },__onKeyup: function() {
                                     var t = this.__html.field.value.replace(/[^0-9.,-]*/g, "");
                                     t != this.__html.field.value && (this.__html.field.value = t), this._updateValue(this.__html.field.value)
                                     },__onChange: function() {
                                     this._updateFieldValue(), this._callCallbacks("value-changed", [this.value])
                                     },__onMouseWheel: function(t) {
                                     if (document.activeElement == this.__html.field) {
                                     var n = null;
                                     t.wheelDeltaY != e && (n = t.wheelDeltaY), t.wheelDelta != e && (n = t.wheelDelta), t.axis != e && t.detail != e && 2 == t.axis && (n = -t.detail), null != n && (n >= 0 ? this.value += this.step : this.value -= this.step, t.preventDefault()), this._callCallbacks("value-changed", [this.value])
                                     }
                                     },__onKeydown: function(t) {
                                     38 == t.keyCode ? (this.setValue(this.getValue() + this.step), t.preventDefault(), this._callCallbacks("value-changed", [this.value])) : 40 == t.keyCode && (this.setValue(this.getValue() - this.step), t.preventDefault(), this._callCallbacks("value-changed", [this.value]))
                                     }});
    var n = n || {};
    n.Viewport = n.Container.$extend({__init__: function(t) {
                                     this.$super(t), this._updateProperties(["padding", "verticalScrollbar", "horizontalScrollbar"])
                                     },_padding: 0,getPadding: function() {
                                     return this._padding
                                     },setPadding: function(t) {
                                     this._padding = t, this.containerNode.style.padding = t + "px"
                                     },_verticalScrollbar: null,getVerticalScrollbar: function() {
                                     return this._verticalScrollbar
                                     },setVerticalScrollbar: function(t) {
                                     this._verticalScrollbar = t, this.__html.viewport.style.overflowY = t === !0 ? "scroll" : t === !1 ? "hidden" : "auto"
                                     },_horizontalScrollbar: null,getHorizontalScrollbar: function() {
                                     return this._horizontalScrollbar
                                     },setHorizontalScrollbar: function(t) {
                                     this._horizontalScrollbar = t, this.__html.viewport.style.overflowX = t === !0 ? "scroll" : t === !1 ? "hidden" : "auto"
                                     },getHtml: function() {
                                     return this.__html.viewport
                                     },getContainerNode: function() {
                                     return this.html
                                     },_buildHtml: function() {
                                     this.__html.viewport = document.createElement("div"), this.__html.viewport.className = "photonui-widget photonui-viewport photonui-container"
                                     },__onLocaleChanged: function() {
                                     }});
    var n = n || {};
    n.Switch = n.CheckBox.$extend({__init__: function(t) {
                                  this.$super(t), this.removeClass("photonui-checkbox"), this.addClass("photonui-switch")
                                  }});
    var n = n || {};
    n.BaseWindow = n.Container.$extend({__init__: function(t) {
                                       this._registerWEvents(["position-changed"]), this.$super(t);
                                       var t = t || {};
                                       t.visible === e && (this.visible = !1), n.domInsert(this), this._updateProperties(["position", "width", "height", "minWidth", "minHeight", "maxWidth", "maxHeight", "padding"])
                                       },getPosition: function() {
                                       return this.visible && this.html.parentNode ? this.absolutePosition : {x: this._x,y: this._y}
                                       },setPosition: function(t, n) {
                                       "object" == typeof t && n == e ? (this.html.style.left = t.x + "px", this.html.style.top = t.y + "px", this._x = t.x, this._y = t.y) : ("number" == typeof t && (this.html.style.left = t + "px", this._x = t), "number" == typeof n && (this.html.style.top = n + "px", this._y = n)), this._callCallbacks("position-changed", [this.x, this.y])
                                       },_x: 0,getX: function() {
                                       return this.position.x
                                       },setX: function(t) {
                                       this.setPosition(t, null)
                                       },_y: 0,getY: function() {
                                       return this.position.y
                                       },setY: function(t) {
                                       this.setPosition(null, t)
                                       },_width: null,getWidth: function() {
                                       return this.visible && this.html.parenNode ? this.containerNode.offsetWidth : this._width || 0
                                       },setWidth: function(t) {
                                       this._width = t || null, this.containerNode.style.width = this._width ? t + "px" : "auto"
                                       },_height: null,getHeight: function() {
                                       return this.visible && this.html.parenNode ? this.containerNode.offsetHeight : this._height || 0
                                       },setHeight: function(t) {
                                       this._height = t || null, this.containerNode.style.height = this._height ? t + "px" : "auto"
                                       },_minWidth: null,getMinWidth: function() {
                                       return this._minWidth
                                       },setMinWidth: function(t) {
                                       this._minWidth = t || null, this.containerNode.style.minWidth = this._minWidth ? t + "px" : "0"
                                       },_minHeight: null,getMinHeight: function() {
                                       return this._minHeight
                                       },setMinHeight: function(t) {
                                       this._minHeight = t || null, this.containerNode.style.minHeight = this._minHeight ? t + "px" : "0"
                                       },_maxWidth: null,getMaxWidth: function() {
                                       return this._maxWidth
                                       },setMaxWidth: function(t) {
                                       this._maxWidth = t || null, this.containerNode.style.maxWidth = this._maxWidth ? t + "px" : "auto"
                                       },_maxHeight: null,getMaxHeight: function() {
                                       return this._maxHeight
                                       },setMaxHeight: function(t) {
                                       this._maxHeight = t || null, this.containerNode.style.maxHeight = this._maxHeight ? t + "px" : "auto"
                                       },_padding: 0,getPadding: function() {
                                       return this._padding
                                       },setPadding: function(t) {
                                       this._padding = t, this.containerNode.style.padding = t + "px"
                                       },getHtml: function() {
                                       return this.__html.window
                                       },getContainerNode: function() {
                                       return this.html
                                       },center: function() {
                                       var t = n.e_parent || document.getElementsByTagName("body")[0];
                                       t && this.setPosition(Math.round((t.offsetWidth - this.offsetWidth) / 2), Math.round((t.offsetHeight - this.offsetHeight) / 2))
                                       },_buildHtml: function() {
                                       this.__html.window = document.createElement("div"), this.__html.window.className = "photonui-widget photonui-basewindow"
                                       }});
    var n = n || {}, o = {};
    n.getSpriteSheet = function(t) {
        return o[t] !== e ? o[t] : null
    }, n.SpriteSheet = n.Base.$extend({__init__: function(t) {
                                      this._icons = {}, this.$super(t), this._updateProperties(["name"])
                                      },_name: "default",getName: function() {
                                      return this._name
                                      },setName: function(t) {
                                      o[this.name] == this && delete o[this.name], this._name = t, o[this.name] = this
                                      },_imageUrl: null,getImageUrl: function() {
                                      return this._imageUrl
                                      },setImageUrl: function(t) {
                                      if (!t)
                                      return void (this._imageUrl = null);
                                      if (this._imageUrl != t) {
                                      this._imageUrl = t;
                                      var e = new Image;
                                      e.src = t
                                      }
                                      },_size: 16,getSize: function() {
                                      return this._size
                                      },setSize: function(t) {
                                      this._size = t
                                      },_icons: {},getIcons: function() {
                                      return this._icons
                                      },setIcons: function(t) {
                                      for (icon in t)
                                      this._icons[icon] = t[icon]
                                      },getIconPosition: function(t) {
                                      return {x: this.icons[t][0],y: this.icons[t][1]}
                                      },getIconCss: function(t) {
                                      return "width: " + this.size + "px; height: " + this.size + "px; background: url(" + this.imageUrl + ") -" + this.getIconPosition(t).x + "px -" + this.getIconPosition(t).y + "px;"
                                      },addIcon: function(t, e, n) {
                                      this.icons = {iconName: [e, n]}
                                      },removeIcon: function(t) {
                                      delete this._icons[t]
                                      }}), n.SpriteIcon = n.BaseIcon.$extend({__init__: function(t, e) {
                                                                             var n = {};
                                                                             if (t && "string" == typeof t) {
                                                                             if (n.icon = t, e && "object" == typeof e)
                                                                             for (var i in e)
                                                                             n[i] = e[i]
                                                                             } else
                                                                             t && (n = t);
                                                                             this.$super(n)
                                                                             },_spriteSheetName: "",getSpriteSheetName: function() {
                                                                             return this._spriteSheetName
                                                                             },setSpriteSheetName: function(t) {
                                                                             this._spriteSheetName = t || "", this._update()
                                                                             },_iconName: "",getIconName: function() {
                                                                             return this._iconName
                                                                             },setIconName: function(t) {
                                                                             this._iconName = t || "", this._update()
                                                                             },getIcon: function() {
                                                                             return this.spriteSheetName + "/" + this.iconName
                                                                             },setIcon: function(t) {
                                                                             var e = t.split("/");
                                                                             this.spriteSheetName = e[0], this.iconName = e[1]
                                                                             },getHtml: function() {
                                                                             return this.__html.outer
                                                                             },_update: function() {
                                                                             var t = "";
                                                                             this.spriteSheetName && this.iconName && (t = n.getSpriteSheet(this.spriteSheetName).getIconCss(this.iconName)), this.__html.icon.setAttribute("style", t)
                                                                             },_buildHtml: function() {
                                                                             this.__html.outer = document.createElement("span"), this.__html.outer.className = "photonui-widget photonui-icon photonui-spriteicon", this.__html.icon = document.createElement("span"), this.__html.outer.appendChild(this.__html.icon)
                                                                             }});
    var n = n || {};
    n.TextAreaField = n.Field.$extend({__init__: function(t) {
                                      this.$super(t), this._bindFieldEvents()
                                      },getCols: function() {
                                      return parseInt(this.__html.field.cols)
                                      },setCols: function(t) {
                                      this.__html.field.cols = t
                                      },getRows: function() {
                                      return parseInt(this.__html.field.rows)
                                      },setRows: function(t) {
                                      this.__html.field.rows = t
                                      },_buildHtml: function() {
                                      this.__html.field = document.createElement("textarea"), this.__html.field.className = "photonui-widget photonui-field photonui-field-textarea", this.__html.field.cols = 20, this.__html.field.rows = 3
                                      }});
    var n = n || {}, r = [];
    n.Window = n.BaseWindow.$extend({__init__: function(t) {
                                    this._registerWEvents(["close-button-clicked"]), this.$super(t), this._bindEvent("move.dragstart", this.__html.windowTitle, "mousedown", this.__moveDragStart.bind(this)), this._bindEvent("closeButton.click", this.__html.windowTitleCloseButton, "click", this.__closeButtonClicked.bind(this)), this._bindEvent("totop", this.__html.window, "mousedown", this.moveToFront.bind(this)), this._bindEvent("closeButton.mousedown", this.__html.windowTitleCloseButton, "mousedown", function(t) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                t.stopPropagation()
                                                                                                                                                                                                                                                                                                                                                                                                                                                }), this._updateProperties(["title", "closeButtonVisible"]), this.moveToFront()
                                    },_title: "Window",getTitle: function() {
                                    return this._title
                                    },setTitle: function(t) {
                                    this._title = t, n.Helpers.cleanNode(this.__html.windowTitleText), this.__html.windowTitleText.appendChild(document.createTextNode(t))
                                    },_movable: !0,isMovable: function() {
                                    return this._movable
                                    },setMovable: function(t) {
                                    this._movable = t
                                    },_closeButtonVisible: !0,getCloseButtonVisible: function() {
                                    return this._closeButtonVisible
                                    },setCloseButtonVisible: function(t) {
                                    this._closeButtonVisible = t, t ? (this.addClass("photonui-window-have-button"), this.__html.windowTitleCloseButton.style.display = "block") : (this.removeClass("photonui-window-have-button"), this.__html.windowTitleCloseButton.style.display = "none")
                                    },_modal: !1,isModal: function() {
                                    return this._modal
                                    },setModal: function(t) {
                                    if (this._modal = t, t) {
                                    this.__html.modalBox = document.createElement("div"), this.__html.modalBox.className = "photonui-window-modalbox";
                                    var e = n.e_parent || document.getElementsByTagName("body")[0];
                                    e.appendChild(this.__html.modalBox), this.visible = this.visible
                                    } else
                                    this.__html.modalBox && (this.__html.modalBox.parentNode.removeChild(this.__html.modalBox), delete this.__html.modalBox)
                                    },getContainerNode: function() {
                                    return this.__html.windowContent
                                    },setVisible: function(t) {
                                    this.$super(t), this.visible ? (this.moveToFront(), this.modal && (this.__html.modalBox.style.display = "block")) : (this.moveToBack(), this.modal && (this.__html.modalBox.style.display = "none"))
                                    },moveToFront: function() {
                                    var t = r.indexOf(this);
                                    t >= 0 && r.splice(t, 1), r.unshift(this), this._updateWindowList()
                                    },moveToBack: function() {
                                    var t = r.indexOf(this);
                                    t >= 0 && r.splice(t, 1), r.push(this), this._updateWindowList()
                                    },destroy: function() {
                                    this.modal = !1;
                                    var t = r.indexOf(this);
                                    t >= 0 && r.splice(t, 1), this.$super()
                                    },_buildHtml: function() {
                                    if (t.Stone) {
                                    t.Stone.lazyGettext
                                    }
                                    this.$super(), this.__html.window.className += " photonui-window", this.__html.windowTitle = document.createElement("div"), this.__html.windowTitle.className = "photonui-window-title", this.__html.window.appendChild(this.__html.windowTitle), this.__html.windowTitleCloseButton = document.createElement("button"), this.__html.windowTitleCloseButton.className = "photonui-window-title-close-button", this.__html.windowTitleCloseButton.title = t.Stone ? t.Stone.lazyGettext("Close") : "Close", this.__html.windowTitle.appendChild(this.__html.windowTitleCloseButton), this.__html.windowTitleText = document.createElement("span"), this.__html.windowTitleText.className = "photonui-window-title-text", this.__html.windowTitle.appendChild(this.__html.windowTitleText), this.__html.windowContent = document.createElement("div"), this.__html.windowContent.className = "photonui-container photonui-window-content photonui-container-expand-child", this.__html.window.appendChild(this.__html.windowContent)
                                    },_updateWindowList: function() {
                                    for (var t = r.length - 1, e = 0; t >= 0; t--, e++)
                                    0 == t ? (r[t].html.style.zIndex = 2001, r[t].addClass("photonui-active")) : (r[t].html.style.zIndex = 1e3 + e, r[t].removeClass("photonui-active")), r[t].modal && (r[t].html.style.zIndex = 3001)
                                    },__moveDragStart: function(t) {
                                    if (this.movable && !(t.button > 0)) {
                                    var n = t.offsetX != e ? t.offsetX : t.layerX, i = t.offsetY != e ? t.offsetY : t.layerY;
                                    this.__html.windowTitle.style.cursor = "move", this._bindEvent("move.dragging", document, "mousemove", this.__moveDragging.bind(this, n, i)), this._bindEvent("move.dragend", document, "mouseup", this.__moveDragEnd.bind(this))
                                    }
                                    },__moveDragging: function(t, e, n) {
                                    var i = document.getElementsByTagName("body")[0], o = Math.min(Math.max(n.pageX - t, 40 - this.offsetWidth), i.offsetWidth - 40), r = Math.max(n.pageY - e, 0);
                                    i.offsetHeight > 0 && (r = Math.min(r, i.offsetHeight - this.__html.windowTitle.offsetHeight)), this.setPosition(o, r)
                                    },__moveDragEnd: function() {
                                    this.__html.windowTitle.style.cursor = "default", this._unbindEvent("move.dragging"), this._unbindEvent("move.dragend")
                                    },__closeButtonClicked: function() {
                                    this._callCallbacks("close-button-clicked")
                                    },__onLocaleChanged: function() {
                                    this.$super(), this.__html.windowTitleCloseButton.title = t.Stone ? t.Stone.lazyGettext("Close") : "Close"
                                    }});
    var n = n || {};
    n.GridLayout = n.Layout.$extend({__init__: function(t) {
                                    this.$super(t), this._updateProperties(["verticalSpacing"])
                                    },_verticalSpacing: 5,getVerticalSpacing: function() {
                                    return this._verticalSpacing
                                    },setVerticalSpacing: function(t) {
                                    this._verticalSpacing = t, this.__html.grid.style.borderSpacing = this.verticalSpacing + "px " + this.horizontalSpacing + "px"
                                    },_horizontalSpacing: 5,getHorizontalSpacing: function() {
                                    return this._horizontalSpacing
                                    },setHorizontalSpacing: function(t) {
                                    this._horizontalSpacing = t, this.__html.grid.style.borderSpacing = this.verticalSpacing + "px " + this.horizontalSpacing + "px"
                                    },getHtml: function() {
                                    return this.__html.outerbox
                                    },_buildHtml: function() {
                                    this.__html.outerbox = document.createElement("div"), this.__html.outerbox.className = "photonui-widget photonui-gridlayout", this.__html.grid = document.createElement("table"), this.__html.outerbox.appendChild(this.__html.grid), this.__html.gridBody = document.createElement("tbody"), this.__html.grid.appendChild(this.__html.gridBody)
                                    },_updateLayout: function() {
                                    for (var t = 1 / 0, i = 1 / 0, o = 0, r = 0, s = this.children, a = 0; a < s.length; a++)
                                    s[a].layoutOptions.gridX = s[a].layoutOptions.gridX != e ? s[a].layoutOptions.gridX : 0, s[a].layoutOptions.gridY = s[a].layoutOptions.gridY != e ? s[a].layoutOptions.gridY : 0, s[a].layoutOptions.gridWidth = Math.max(s[a].layoutOptions.gridWidth, 1) || 1, s[a].layoutOptions.gridHeight = Math.max(s[a].layoutOptions.gridHeight, 1) || 1, t = Math.min(t, s[a].layoutOptions.gridX), i = Math.min(i, s[a].layoutOptions.gridY), o = Math.max(o, s[a].layoutOptions.gridX + s[a].layoutOptions.gridWidth), r = Math.max(r, s[a].layoutOptions.gridY + s[a].layoutOptions.gridHeight);
                                    o -= t, r -= i, n.Helpers.cleanNode(this.__html.gridBody);
                                    for (var l = [], h = 0; r > h; h++) {
                                    for (var c = [], u = 0; o > u; u++)
                                    c.push(!1);
                                    l.push(c)
                                    }
                                    for (var h = 0; r > h; h++) {
                                    var p = document.createElement("tr");
                                    this.__html.gridBody.appendChild(p);
                                    for (var u = 0; o > u; u++)
                                    if (!l[h][u]) {
                                    var d = !1, m = document.createElement("td");
                                    m.className = "photonui-container photonui-gridlayout-cell", p.appendChild(m);
                                    for (var a = 0; a < s.length; a++)
                                    if (s[a].layoutOptions.gridX - t == u && s[a].layoutOptions.gridY - i == h) {
                                    d = !0;
                                    var g = s[a].layoutOptions.gridWidth, f = s[a].layoutOptions.gridHeight;
                                    if (m.colSpan = g, m.rowSpan = f, m.appendChild(s[a].html), (s[a].layoutOptions.horizontalExpansion == e || s[a].layoutOptions.horizontalExpansion) && (m.className += " photonui-container-expand-child-horizontal"), (s[a].layoutOptions.verticalExpansion == e || s[a].layoutOptions.verticalExpansion) && (m.className += " photonui-container-expand-child-vertical"), s[a].layoutOptions.width != e && (m.style.height = s[a].layoutOptions.width + "px"), s[a].layoutOptions.height != e && (m.style.height = s[a].layoutOptions.height + "px"), s[a].layoutOptions.minWidth != e && (m.style.minWidth = s[a].layoutOptions.minWidth + "px"), s[a].layoutOptions.minHeight != e && (m.style.minHeight = s[a].layoutOptions.minHeight + "px"), s[a].layoutOptions.maxWidth != e && (m.style.maxWidth = s[a].layoutOptions.maxWidth + "px"), s[a].layoutOptions.maxHeight != e && (m.style.maxHeight = s[a].layoutOptions.maxHeight + "px"), s[a].layoutOptions.horizontalAlign != e && (m.style.textAlign = s[a].layoutOptions.horizontalAlign), g > 1 || f > 1)
                                    for (var y = h; h + f > y; y++)
                                    for (var _ = u; u + g > _; _++)
                                    l[y][_] = !0;
                                    break
                                    }
                                    d || (m.innerHTML = "&nbsp;")
                                    }
                                    }
                                    }});
    var n = n || {};
    n.Slider = n.NumericField.$extend({__init__: function(t) {
                                      this.$super(t), this.inputId = this.name + "-field", this.__html.field.id = this.inputId, this._updateProperties(["fieldVisible"]), this._bindEvent("slider-mousedown", this.__html.slider, "mousedown", this.__onSliderMouseDown.bind(this)), this._bindEvent("slider-keydown", this.__html.slider, "keydown", this.__onSliderKeyDown.bind(this)), this._bindEvent("slider-mousewheel", this.__html.slider, "mousewheel", this.__onSliderMouseWheel.bind(this)), this._bindEvent("slider-mousewheel-firefox", this.__html.slider, "DOMMouseScroll", this.__onSliderMouseWheel.bind(this)), this._bindEvent("field-contextmenu", this.__html.field, "contextmenu", this.__onFieldContextMenu.bind(this))
                                      },_min: 0,_max: 100,_decimalDigits: 0,_fieldVisible: !0,isFieldVisible: function() {
                                      return this._fieldVisible
                                      },setFieldVisible: function(t) {
                                      this._fieldVisible = t, t ? (this.__html.field.style.display = "", this.removeClass("photonui-slider-nofield")) : (this.__html.field.style.display = "none", this.addClass("photonui-slider-nofield"))
                                      },getHtml: function() {
                                      return setTimeout(function() {
                                                        this.value = this.value
                                                        }.bind(this), .01), this.__html.outer
                                      },setValue: function(t) {
                                      this.$super(t);
                                      var e = t - this.min, n = this.max - this.min, i = Math.min(Math.max(e / n, 0), 1), o = this.__html.slider.offsetWidth - this.__html.grip.offsetWidth - 4;
                                      this.__html.grip.style.left = Math.floor(i * o) + 2 + "px"
                                      },_buildHtml: function() {
                                      this.$super(), this.__html.outer = document.createElement("div"), this.__html.outer.className = "photonui-widget photonui-slider", this.__html.slider = document.createElement("div"), this.__html.slider.className = "photonui-slider-slider", this.__html.slider.tabIndex = 0, this.__html.outer.appendChild(this.__html.slider), this.__html.grip = document.createElement("div"), this.__html.grip.className = "photonui-slider-grip", this.__html.slider.appendChild(this.__html.grip), this.__html.outer.appendChild(this.__html.field)
                                      },_updateFromMouseEvent: function(t) {
                                      var e = n.Helpers.getAbsolutePosition(this.__html.slider).x, i = this.__html.grip.offsetWidth, o = Math.round(t.pageX - e - i / 2), r = this.__html.slider.offsetWidth - i - 3, s = (this.max - this.min) * o / r + this.min;
                                      this.value = Math.round(s / this.step) * this.step, this._callCallbacks("value-changed", [this.value])
                                      },__onSliderMouseDown: function(t) {
                                      this._updateFromMouseEvent(t), this._bindEvent("slider-mousemove", document, "mousemove", this.__onSliderMouseMove.bind(this)), this._bindEvent("slider-mouseup", document, "mouseup", this.__onSliderMouseUp.bind(this))
                                      },__onSliderMouseMove: function(t) {
                                      this._updateFromMouseEvent(t)
                                      },__onSliderMouseUp: function(t) {
                                      this._unbindEvent("slider-mousemove"), this._unbindEvent("slider-mouseup"), this._updateFromMouseEvent(t)
                                      },__onSliderKeyDown: function(t) {
                                      38 == t.keyCode || 39 == t.keyCode ? (this.value += this.step, this._callCallbacks("value-changed", [this.value])) : (40 == t.keyCode || 37 == t.keyCode) && (this.value -= this.step, this._callCallbacks("value-changed", [this.value]))
                                      },__onSliderMouseWheel: function(t) {
                                      var n = null;
                                      t.wheelDeltaY != e && (n = t.wheelDeltaY), t.wheelDelta != e && (n = t.wheelDelta), t.axis != e && t.detail != e && 2 == t.axis && (n = -t.detail), null != n && (n >= 0 ? this.value += this.step : this.value -= this.step, t.preventDefault(), t.stopPropagation()), this._callCallbacks("value-changed", [this.value])
                                      },__onContextMenu: function(t) {
                                      t.stopPropagation(), t.preventDefault(), this.contextMenuName && this.contextMenu.popupXY(t.pageX, t.pageY)
                                      },__onFieldContextMenu: function(t) {
                                      t.stopPropagation()
                                      }});
    var n = n || {};
    n.Button = n.Widget.$extend({__init__: function(t) {
                                this._registerWEvents(["click"]), this.$super(t), this._bindEvent("click", this.__html.button, "click", this.__onButtonClicked.bind(this)), this._updateProperties(["text", "leftIconName", "rightIconName"]), this._update()
                                },_text: "Button",getText: function() {
                                return this._text
                                },setText: function(t) {
                                this._text = t, n.Helpers.cleanNode(this.__html.text), this.__html.text.appendChild(document.createTextNode(t))
                                },_textVisible: !0,isTextVisible: function() {
                                return this._textVisible
                                },setTextVisible: function(t) {
                                this._textVisible = t, this._update()
                                },_leftIconName: null,getLeftIconName: function() {
                                return this._leftIconName
                                },setLeftIconName: function(t) {
                                this._leftIconName = t, n.Helpers.cleanNode(this.__html.leftIcon), this._leftIconName && (this.__html.leftIcon.appendChild(this.leftIcon.html), this.leftIconVisible = !0)
                                },getLeftIcon: function() {
                                return n.getWidget(this._leftIconName)
                                },setLeftIcon: function(t) {
                                return t instanceof n.BaseIcon ? void (this.leftIconName = t.name) : void (this.leftIconName = null)
                                },_leftIconVisible: !0,isLeftIconVisible: function() {
                                return this._leftIconVisible
                                },setLeftIconVisible: function(t) {
                                this._leftIconVisible = t, this._update()
                                },_rightIconName: null,getRightIconName: function() {
                                return this._rightIconName
                                },setRightIconName: function(t) {
                                this._rightIconName = t, n.Helpers.cleanNode(this.__html.rightIcon), this._rightIconName && (this.__html.rightIcon.appendChild(this.rightIcon.html), this.rightIconVisible = !0)
                                },getRightIcon: function() {
                                return n.getWidget(this._rightIconName)
                                },setRightIcon: function(t) {
                                return t instanceof n.BaseIcon ? void (this.rightIconName = t.name) : void (this.rightIconName = null)
                                },_rightIconVisible: !0,isRightIconVisible: function() {
                                return this._rightIconVisible
                                },setRightIconVisible: function(t) {
                                this._rightIconVisible = t, this._update()
                                },_appearance: "normal",getAppearance: function() {
                                return this._appearance
                                },setAppearance: function(t) {
                                this._appearance = t, "flat" == t ? this.addClass("photonui-button-appearance-flat") : this.removeClass("photonui-button-appearance-flat")
                                },getHtml: function() {
                                return this.__html.button
                                },_update: function() {
                                this.__html.leftIcon.parentNode == this.__html.button && this.__html.button.removeChild(this.__html.leftIcon), this.__html.text.parentNode == this.__html.button && this.__html.button.removeChild(this.__html.text), this.__html.rightIcon.parentNode == this.__html.button && this.__html.button.removeChild(this.__html.rightIcon), this.leftIconName && this.leftIconVisible && this.__html.button.appendChild(this.__html.leftIcon), this.text && this.textVisible && this.__html.button.appendChild(this.__html.text), this.rightIconName && this.rightIconVisible && this.__html.button.appendChild(this.__html.rightIcon)
                                },_buildHtml: function() {
                                this.__html.button = document.createElement("button"), this.__html.button.className = "photonui-widget photonui-button", this.__html.leftIcon = document.createElement("span"), this.__html.leftIcon.className = "photonui-button-icon", this.__html.button.appendChild(this.__html.leftIcon), this.__html.text = document.createElement("span"), this.__html.text.className = "photonui-button-text", this.__html.button.appendChild(this.__html.text), this.__html.rightIcon = document.createElement("span"), this.__html.rightIcon.className = "photonui-button-icon", this.__html.button.appendChild(this.__html.rightIcon)
                                },__onButtonClicked: function(t) {
                                this._callCallbacks("click", [t])
                                }});
    var s = {_text: n.Button.prototype._text,getText: n.Button.prototype.getText,setText: n.Button.prototype.setText,_textVisible: n.Button.prototype._textVisible,isTextVisible: n.Button.prototype.isTextVisible,setTextVisible: n.Button.prototype.setTextVisible,_leftIconName: n.Button.prototype._leftIconName,getLeftIconName: n.Button.prototype.getLeftIconName,setLeftIconName: n.Button.prototype.setLeftIconName,getLeftIcon: n.Button.prototype.getLeftIcon,setLeftIcon: n.Button.prototype.setLeftIcon,_leftIconVisible: n.Button.prototype._leftIconVisible,isLeftIconVisible: n.Button.prototype.isLeftIconVisible,setLeftIconVisible: n.Button.prototype.setLeftIconVisible,_rightIconName: n.Button.prototype._rightIconName,getRightIconName: n.Button.prototype.getRightIconName,setRightIconName: n.Button.prototype.setRightIconName,getRightIcon: n.Button.prototype.getRightIcon,setRightIcon: n.Button.prototype.setRightIcon,_rightIconVisible: n.Button.prototype._rightIconVisible,isRightIconVisible: n.Button.prototype.isRightIconVisible,setRightIconVisible: n.Button.prototype.setRightIconVisible,_appearance: n.Button.prototype._appearance,getAppearance: n.Button.prototype.getAppearance,setAppearance: n.Button.prototype.setAppearance,_update: n.Button.prototype._update,_buildButtonHtml: n.Button.prototype._buildHtml,__onButtonClicked: n.Button.prototype.__onButtonClicked}, n = n || {};
    n.FluidLayout = n.Layout.$extend({_verticalSpacing: 0,getVerticalSpacing: function() {
                                     return this._verticalSpacing
                                     },setVerticalSpacing: function(t) {
                                     this._verticalSpacing = t, this._updateLayout()
                                     },_horizontalSpacing: 2,getHorizontalSpacing: function() {
                                     return this._horizontalSpacing
                                     },setHorizontalSpacing: function(t) {
                                     this._horizontalSpacing = t, this._updateLayout()
                                     },getHtml: function() {
                                     return this.__html.outerbox
                                     },_buildHtml: function() {
                                     this.__html.outerbox = document.createElement("div"), this.__html.outerbox.className = "photonui-widget photonui-fluidlayout"
                                     },_updateLayout: function() {
                                     for (var t = this.children, e = document.createDocumentFragment(), i = null, o = 0; o < t.length; o++)
                                     i = document.createElement("div"), i.className = "photonui-container", i.style.padding = "0 " + this.horizontalSpacing + "px " + this.verticalSpacing + "px 0", i.appendChild(t[o].html), e.appendChild(i);
                                     n.Helpers.cleanNode(this.__html.outerbox), this.__html.outerbox.appendChild(e)
                                     }});
    var n = n || {};
    n.PopupWindow = n.BaseWindow.$extend({__init__: function(t) {
                                         this.$super(t), this._bindEvent("document-mousedown-close", document, "mousedown", this.hide.bind(this)), this._bindEvent("popup-click-close", this.html, "click", this.hide.bind(this)), this._bindEvent("mousedown-preventclose", this.html, "mousedown", function(t) {
                                                                                                                                                                                                                                                   t.stopPropagation()
                                                                                                                                                                                                                                                   }.bind(this))
                                         },getContainerNode: function() {
                                         return this.__html.inner
                                         },popupXY: function(t, e) {
                                         this.setPosition(-1337, -1337), this.show();
                                         var n = document.getElementsByTagName("body")[0].offsetWidth, i = document.getElementsByTagName("body")[0].offsetHeight, o = this.offsetWidth, r = this.offsetHeight;
                                         t + o > n && (t = n - o), e + r > i && (e -= r), 0 > t && (t = 0), 0 > e && (e = 0), this.setPosition(t, e)
                                         },popupWidget: function(t) {
                                         this.setPosition(-1337, -1337), this.show();
                                         var e = document.getElementsByTagName("body")[0], n = 0, i = 0, o = t.absolutePosition, r = t.offsetHeight, s = t.offsetWidth, a = this.offsetWidth, l = this.offsetHeight;
                                         n = o.x + a < e.offsetWidth ? o.x : o.x + s < e.offsetWidth ? o.x + s - a : e.offsetWidth - a, o.y + r + l < e.offsetHeight ? i = o.y + r + 1 : o.y - l >= 0 && (i = o.y - l - 1), 0 > n && (n = 0), 0 > i && (i = 0), this.setPosition(n, i)
                                         },_buildHtml: function() {
                                         this.$super(), this.__html.window.className += " photonui-popupwindow", this.__html.inner = document.createElement("div"), this.__html.window.appendChild(this.__html.inner)
                                         }});
    var n = n || {}, r = [];
    n.Dialog = n.Window.$extend({__init__: function(t) {
                                this._buttonsNames = [], this.$super(t)
                                },_buttonsNames: [],getButtonsNames: function() {
                                return this._buttonsNames
                                },setButtonsNames: function(t) {
                                this._buttonsNames = t, this._updateButtons()
                                },getButtons: function() {
                                for (var t = [], e = 0; e < this._buttonsNames.length; e++)
                                t.push(n.getWidget(this._buttonsNames[e]));
                                return t
                                },setButtons: function(t) {
                                for (var e = [], i = 0; i < t.length; i++)
                                t[i] instanceof n.Widget && e.push(t[i].name);
                                this.buttonsNames = e
                                },addButton: function(t) {
                                this._childrenNames.push(t.name), this._updateButtons()
                                },removeButton: function(t) {
                                var e = this._buttonsNames.indexOf(t.name);
                                e >= 0 && this._buttonsNames.splice(t.name, 1), this._updateButtons()
                                },_updateButtons: function() {
                                n.Helpers.cleanNode(this.__html.buttons);
                                for (var t = this.buttons, e = t.length - 1; e >= 0; e--)
                                this.__html.buttons.appendChild(t[e].html)
                                },_buildHtml: function() {
                                this.$super(), this.addClass("photonui-dialog"), this.__html.buttons = document.createElement("div"), this.__html.buttons.className = "photonui-dialog-buttons", this.__html.window.appendChild(this.__html.buttons)
                                }});
    var n = n || {};
    n.ColorPicker = n.Widget.$extend({__init__: function(t) {
                                     this._registerWEvents(["value-changed"]), this._color = new n.Color, this.__buffH = document.createElement("canvas"), this.__buffH.width = 200, this.__buffH.height = 200, this.__buffSB = document.createElement("canvas"), this.__buffSB.width = 100, this.__buffSB.height = 100, this.__buffSBmask = document.createElement("canvas"), this.__buffSBmask.width = 100, this.__buffSBmask.height = 100, this.$super(t), this._updateH(), this._updateSB(), this._updateSBmask(), this._updateCanvas(), this._updateProperties(["color"]), this.__mouseManager = new n.MouseManager(this.__html.canvas), this.__mouseManager.registerCallback("click", "mouse-move", this.__onMouseMove.bind(this)), this.__mouseManager.registerCallback("mouse-down", "mouse-down", this.__onMouseDown.bind(this)), this.__mouseManager.registerCallback("drag-start", "drag-start", this.__onDragStart.bind(this)), this._bindEvent("value-changed", this.__html.preview, "change", this.__onValueChanged.bind(this))
                                     },getValue: function() {
                                     return this.color.hexString
                                     },setValue: function(t) {
                                     this.color.hexString = t, this._updateSB(), this._updateCanvas()
                                     },_color: null,getColor: function() {
                                     return this._color
                                     },setColor: function(t) {
                                     t instanceof n.Color && (this._color && this._color.removeCallback("photonui.colorpicker.value-changed::" + this.name), this._color = t, this._color.registerCallback("photonui.colorpicker.value-changed::" + this.name, "value-changed", function() {
                                                                                                                                                                                                           this._updateSB(), this._updateCanvas()
                                                                                                                                                                                                           }.bind(this)), this._updateSB(), this._updateCanvas())
                                     },getHtml: function() {
                                     return this.__html.outer
                                     },__buffH: null,__buffSB: null,__mouseManager: null,__disableSBUpdate: !1,destroy: function() {
                                     this.__mouseManager.destroy(), this._color.removeCallback("photonui.colorpicker.value-changed::" + this.name), this.$super()
                                     },_buildHtml: function() {
                                     this.__html.outer = document.createElement("div"), this.__html.outer.className = "photonui-widget photonui-colorpicker", this.__html.canvas = document.createElement("canvas"), this.__html.canvas.width = 200, this.__html.canvas.height = 200, this.__html.outer.appendChild(this.__html.canvas), this.__html.previewOuter = document.createElement("span"), this.__html.previewOuter.className = "photonui-colorpicker-previewouter", this.__html.outer.appendChild(this.__html.previewOuter), this.__html.preview = document.createElement("input"), this.__html.preview.type = "text", this.__html.preview.autocomplete = "off", this.__html.preview.spellcheck = !1, this.__html.preview.className = "photonui-colorpicker-preview", this.__html.previewOuter.appendChild(this.__html.preview)
                                     },_updateH: function() {
                                     var t = this.__buffH, e = t.getContext("2d"), i = new n.Color;
                                     e.clearRect(0, 0, t.width, t.height);
                                     for (var o = 0; 360 > o; o++)
                                     i.hue = 360 - o, e.beginPath(), e.fillStyle = i.hexString, e.arc(100, 100, 90, Math.PI * o / 180, Math.PI * ((o + 2) % 360) / 180, !1), e.lineTo(100, 100), e.fill();
                                     e.beginPath(), e.fillStyle = "#000", e.arc(100, 100, 73, 2 * Math.PI, !1), e.globalCompositeOperation = "destination-out", e.fill()
                                     },_updateSBmask: function() {
                                     var t = this.__buffSBmask, e = t.getContext("2d"), n = e.getImageData(0, 0, t.width, t.height), i = 0, o = 0, r = 0, s = 0;
                                     for (r = 0; 100 > r; r++)
                                     for (s = 0; 100 > s; s++)
                                     i = 400 * r + 4 * s, o = (.5 * (1 - s / 100) + .5) * (1 - r / 100) * 255 << 0, n.data[i + 0] = o, n.data[i + 1] = o, n.data[i + 2] = o, n.data[i + 3] = 255 * (1 - s / 100 * (1 - r / 100)) << 0;
                                     e.putImageData(n, 0, 0)
                                     },_updateSB: function() {
                                     if (!this.__disableSBUpdate) {
                                     var t = this.__buffSB, e = t.getContext("2d"), i = new n.Color({hue: this.color.hue,saturation: 100,brightness: 100});
                                     e.save(), e.clearRect(0, 0, t.width, t.height), e.fillStyle = i.hexString, e.rect(0, 0, t.width, t.height), e.fill(), e.drawImage(this.__buffSBmask, 0, 0), e.restore()
                                     }
                                     },_updateCanvas: function() {
                                     var t = this.__html.canvas, e = t.getContext("2d");
                                     e.save(), e.clearRect(0, 0, t.width, t.height), e.drawImage(this.__buffH, 0, 0), e.drawImage(this.__buffSB, 50, 50), e.strokeStyle = "#fff", e.shadowColor = "rgba(0, 0, 0, .7)", e.shadowBlur = 3, e.lineWidth = 2, e.beginPath(), e.arc(this.color.saturation + 50, 100 - this.color.brightness + 50, 6, 2 * Math.PI, !1), e.stroke(), e.translate(100, 100), e.rotate(-this.color.hue * Math.PI / 180), e.beginPath(), e.arc(81, 0, 6, 2 * Math.PI, !1), e.stroke(), e.restore(), this.__html.preview.style.backgroundColor = this.color.rgbaString, this.__html.preview.value = this.color.hexString
                                     },_pointerOnSquare: function(t) {
                                     return t.x >= 50 && t.x <= 150 && t.y >= 50 && t.y <= 150
                                     },_pointerOnCircle: function(t) {
                                     var e = Math.abs(100 - t.x), n = Math.abs(100 - t.y), i = Math.sqrt(e * e + n * n);
                                     return i >= 74 && 90 >= i
                                     },_pointerAngle: function(t) {
                                     var e = Math.abs(100 - t.x), n = Math.abs(100 - t.y), i = 180 * Math.atan(n / e) / Math.PI;
                                     return t.x < 100 && t.y < 100 ? i = 180 - i : t.x < 100 && t.y >= 100 ? i += 180 : t.x >= 100 && t.y > 100 && (i = 360 - i), 0 | i
                                     },__onMouseMove: function(t, e) {
                                     this.__html.canvas.style.cursor = this._pointerOnSquare(e) || this._pointerOnCircle(e) ? "crosshair" : "default"
                                     },__onMouseDown: function(t, e) {
                                     this._pointerOnSquare(e) ? (this.__disableSBUpdate = !0, this.color.saturation = e.x - 50, this.color.brightness = 150 - e.y, this.__disableSBUpdate = !1, this._callCallbacks("value-changed", this.color)) : this._pointerOnCircle(e) && (this.color.hue = this._pointerAngle(e), this._callCallbacks("value-changed", this.color))
                                     },__onDragStart: function(t, e) {
                                     this._pointerOnSquare(e) ? (this.__disableSBUpdate = !0, this.__mouseManager.registerCallback("dragging", "dragging", this.__onDraggingSquare.bind(this)), this.__mouseManager.registerCallback("drag-end", "drag-end", this.__onDragEnd.bind(this))) : this._pointerOnCircle(e) && (this.__mouseManager.registerCallback("dragging", "dragging", this.__onDraggingCircle.bind(this)), this.__mouseManager.registerCallback("drag-end", "drag-end", this.__onDragEnd.bind(this)))
                                     },__onDraggingSquare: function(t, e) {
                                     this.color.saturation = e.x - 50, this.color.brightness = 150 - e.y, this._callCallbacks("value-changed", this.color)
                                     },__onDraggingCircle: function(t, e) {
                                     this.color.hue = this._pointerAngle(e), this._callCallbacks("value-changed", this.color)
                                     },__onDragEnd: function() {
                                     this.__mouseManager.removeCallback("dragging"), this.__mouseManager.removeCallback("drag-end"), this.__disableSBUpdate = !1
                                     },__onValueChanged: function() {
                                     this.color.hexString = this.__html.preview.value, this.__html.preview.value = this.color.hexString, this._callCallbacks("value-changed", this.color)
                                     }});
    var n = n || {};
    n.BoxLayout = n.GridLayout.$extend({__init__: function(t) {
                                       this.$super(t), this._updateProperties(["orientation"])
                                       },_orientation: "vertical",getOrientation: function() {
                                       return this._orientation
                                       },setOrientation: function(t) {
                                       if ("vertical" != t && "horizontal" != t)
                                       throw 'Error: The orientation should be "vertical" or "horizontal".';
                                       this._orientation = t, this.removeClass("photonui-layout-orientation-vertical"), this.removeClass("photonui-layout-orientation-horizontal"), this.addClass("photonui-layout-orientation-" + this.orientation), this._updateLayout()
                                       },_buildHtml: function() {
                                       this.$super(), this.__html.outerbox.className = "photonui-widget photonui-boxlayout"
                                       },_updateLayout: function() {
                                       n.Helpers.cleanNode(this.__html.gridBody);
                                       var t = null;
                                       "horizontal" == this.getOrientation() && (t = document.createElement("tr"), this.__html.gridBody.appendChild(t));
                                       for (var i = this.children, o = 0; o < i.length; o++) {
                                       "vertical" == this.getOrientation() && (t = document.createElement("tr"), this.__html.gridBody.appendChild(t));
                                       var r = document.createElement("td");
                                       r.className = "photonui-container photonui-boxlayout-cell", t.appendChild(r), (i[o].layoutOptions.horizontalExpansion == e || i[o].layoutOptions.horizontalExpansion) && (r.className += " photonui-container-expand-child-horizontal"), (i[o].layoutOptions.verticalExpansion == e || i[o].layoutOptions.verticalExpansion) && (r.className += " photonui-container-expand-child-vertical"), i[o].layoutOptions.width != e && (r.style.height = i[o].layoutOptions.width + "px"), i[o].layoutOptions.height != e && (r.style.height = i[o].layoutOptions.height + "px"), i[o].layoutOptions.minWidth != e && (r.style.minWidth = this.childrenWidgets[o].layoutOptions.minWidth + "px"), i[o].layoutOptions.minHeight != e && (r.style.minHeight = this.childrenWidgets[o].layoutOptions.minHeight + "px"), i[o].layoutOptions.maxWidth != e && (r.style.maxWidth = this.childrenWidgets[o].layoutOptions.maxWidth + "px"), i[o].layoutOptions.maxHeight != e && (r.style.maxHeight = this.childrenWidgets[o].layoutOptions.maxHeight + "px"), i[o].layoutOptions.horizontalAlign != e && (r.style.textAlign = this.childrenWidgets[o].layoutOptions.horizontalAlign, console.log("hhhh")), r.appendChild(i[o].html)
                                       }
                                       }});
    var n = n || {};
    n.Menu = n.Layout.$extend({__init__: function(t) {
                              this.$super(t), this._updateProperties(["iconVisible"])
                              },_iconVisible: !0,isIconVisible: function() {
                              return this._iconVisible
                              },setIconVisible: function(t) {
                              this._iconVisible = t, t ? this.removeClass("photonui-menu-noicon") : this.addClass("photonui-menu-noicon")
                              },getHtml: function() {
                              return this.__html.outer
                              },_buildHtml: function() {
                              this.__html.outer = document.createElement("div"), this.__html.outer.className = "photonui-widget photonui-menu photonui-menu-style-default"
                              },_updateLayout: function() {
                              n.Helpers.cleanNode(this.__html.outer);
                              for (var t = this.children, e = 0; e < t.length; e++)
                              this.__html.outer.appendChild(t[e].html)
                              }});
    var n = n || {};
    n.MenuItem = n.Container.$extend({__init__: function(t) {
                                     this._registerWEvents(["click"]), this.$super(t), this._updateProperties(["text", "icon", "active"]), this._bindEvent("click", this.__html.outer, "click", function(t) {
                                                                                                                                                           this._callCallbacks("click", [t])
                                                                                                                                                           }.bind(this))
                                     },_value: "",getValue: function() {
                                     return this._value
                                     },setValue: function(t) {
                                     this._value = t
                                     },_text: "Menu Item",getText: function() {
                                     return this._text
                                     },setText: function(t) {
                                     this._text = t, n.Helpers.cleanNode(this.__html.text), this.__html.text.appendChild(document.createTextNode(t))
                                     },_iconName: null,getIconName: function() {
                                     return this._iconName
                                     },setIconName: function(t) {
                                     this._iconName = t, n.Helpers.cleanNode(this.__html.icon), this._iconName && this.__html.icon.appendChild(this.icon.html)
                                     },getIcon: function() {
                                     return n.getWidget(this._iconName)
                                     },setIcon: function(t) {
                                     return t instanceof n.BaseIcon ? void (this.iconName = t.name) : void (this.iconName = null)
                                     },_active: !1,getActive: function() {
                                     return this._active
                                     },setActive: function(t) {
                                     this._active = t, t ? this.addClass("photonui-menuitem-active") : this.removeClass("photonui-menuitem-active")
                                     },getHtml: function() {
                                     return this.__html.outer
                                     },getContainerNode: function() {
                                     return this.__html.widget
                                     },_buildHtml: function() {
                                     this.__html.outer = document.createElement("div"), this.__html.outer.className = "photonui-widget photonui-menuitem", this.__html.icon = document.createElement("span"), this.__html.icon.className = "photonui-menuitem-icon", this.__html.outer.appendChild(this.__html.icon), this.__html.text = document.createElement("span"), this.__html.text.className = "photonui-menuitem-text", this.__html.outer.appendChild(this.__html.text), this.__html.widget = document.createElement("span"), this.__html.widget.className = "photonui-menuitem-widget", this.__html.outer.appendChild(this.__html.widget)
                                     }});
    var n = n || {};
    n.SubMenuItem = n.MenuItem.$extend({__init__: function(t) {
                                       this.$super(t), this.addClass("photonui-submenuitem"), this.registerCallback("toggle-folding", "click", this.__onItemClicked, this), this._updateProperties(["menuName"])
                                       },_menuName: null,getMenuName: function() {
                                       return this._menuName
                                       },setMenuName: function(t) {
                                       this.menuName && (this.menu.removeCallback("fold"), this.menu.removeCallback("unfold")), this._menuName = t, this.menuName && (this.menu.registerCallback("fold", "hide", this.__onToggleFold, this), this.menu.registerCallback("unfold", "show", this.__onToggleFold, this), this.active = this.menu.visible)
                                       },getMenu: function() {
                                       return n.getWidget(this.menuName)
                                       },setMenu: function(t) {
                                       this.menuName = t instanceof n.Menu ? t.name : null
                                       },__onToggleFold: function(t) {
                                       this.active = t.visible
                                       },__onItemClicked: function() {
                                       this.menu.visible = !this.menu.visible
                                       }});
    var n = n || {};
    n.ToggleButton = n.CheckBox.$extend({__init__: function(t) {
                                        this._registerWEvents(["click"]), this.$super(t), this.__buttonInit(), this.removeClass("photonui-checkbox"), this.addClass("photonui-togglebutton")
                                        },__buttonInit: function() {
                                        this._bindEvent("click", this.__html.button, "click", this.__onButtonClicked.bind(this)), this._updateProperties(["text", "leftIconName", "rightIconName"]), this._update()
                                        },__include__: [s],_buildHtml: function() {
                                        this.$super(), this._buildButtonHtml(), this.__html.outer.appendChild(this.__html.button), this.__html.outer.removeChild(this.__html.span), this.__html.span = this.__html.button
                                        }});
    var n = n || {};
    n.PopupMenu = n.PopupWindow.$extend({__init__: function(t) {
                                        this._childrenNames = [], this.$super(t)
                                        },__include__: [{getChildrenNames: n.Menu.prototype.getChildrenNames,setChildrenNames: n.Menu.prototype.setChildrenNames,getChildren: n.Menu.prototype.getChildren,setChildren: n.Menu.prototype.setChildren,getChildName: n.Menu.prototype.getChildName,setChildName: n.Menu.prototype.setChildName,getChild: n.Menu.prototype.getChild,setChild: n.Menu.prototype.setChild,isIconVisible: n.Menu.prototype.isIconVisible,setIconVisible: n.Menu.prototype.setIconVisible,addChild: n.Menu.prototype.addChild,removeChild: n.Menu.prototype.removeChild,destroy: n.Menu.prototype.destroy,_updateLayout: n.Menu.prototype._updateLayout}],_buildHtml: function() {
                                        this.$super(), n.Menu.prototype._buildHtml.call(this), this.__html.inner.appendChild(this.__html.outer), this.__html.window.className += " photonui-popupmenu", this.__html.outer.className = "photonui-widget photonui-menu photonui-menu-style-popupmenu"
                                        },__onLocaleChanged: function() {
                                        }});
    var n = n || {};
    n.Select = n.Widget.$extend({__init__: function(t) {
                                this.__popupMenu = new n.PopupMenu({maxHeight: 300,className: "photonui-select-popup"}), this.__popupMenu.iconVisible = !1, this._registerWEvents(["value-changed"]), this.$super(t), this._updateProperties(["value"]), this._bindEvent("popup", this.html, "click", this.__onClick.bind(this)), this.setValue(t.value || this.value, !0)
                                },_value: "",getValue: function() {
                                return this._value
                                },setValue: function(t, e) {
                                if (this.value != t || e) {
                                for (var i = this.__popupMenu.children, o = 0; o < i.length; o++)
                                if (i[o] instanceof n.MenuItem && i[o].value == t)
                                return this._value = t, n.Helpers.cleanNode(this.__html.select), void this.__html.select.appendChild(i[o].html.cloneNode(!0));
                                this._value = "";
                                var r = new n.MenuItem({text: this.placeholder,className: "photonui-select-placeholder"});
                                n.Helpers.cleanNode(this.__html.select), this.__html.select.appendChild(r.html)
                                }
                                },_placeholder: t.Stone ? t.Stone.lazyGettext("Select...") : "Select...",getPlaceholder: function() {
                                return this._placeholder
                                },setPlaceholder: function(t) {
                                this._placeholder = t
                                },getChildren: function() {
                                return this.__popupMenu.getChildren()
                                },setChildren: function(t) {
                                this.__popupMenu.setChildren(t), this._updateItemsBinding()
                                },getChildrenNames: function() {
                                return this.__popupMenu.getChildrenNames()
                                },setChildrenNames: function(t) {
                                this.__popupMenu.setChildrenNames(t), this._updateItemsBinding()
                                },getPopupWidth: function() {
                                return this.__popupMenu.getWidth()
                                },setPopupWidth: function(t) {
                                this.__popupMenu.setWidth(t)
                                },getPopupHeight: function() {
                                return this.__popupMenu.getHeight()
                                },setPopupHeight: function(t) {
                                this.__popupMenu.setHeight(t)
                                },getPopupMaxWidth: function() {
                                return this.__popupMenu.getMaxWidth()
                                },setPopupMaxWidth: function(t) {
                                this.__popupMenu.setMaxWidth(t)
                                },getPopupMinWidth: function() {
                                return this.__popupMenu.getMinWidth()
                                },setPopupMinWidth: function(t) {
                                this.__popupMenu.setMinWidth(t)
                                },getPopupMaxHeight: function() {
                                return this.__popupMenu.getMaxHeight()
                                },setPopupMaxHeight: function(t) {
                                this.__popupMenu.setMaxHeight(t)
                                },getPopupMinHeight: function() {
                                return this.__popupMenu.getMinHeight()
                                },setPopupMinHeight: function(t) {
                                this.__popupMenu.setMinHeight(t)
                                },getPopupOffsetWidth: function() {
                                return this.__popupMenu.getOffsetWidth()
                                },getPopupOffsetHeight: function() {
                                return this.__popupMenu.getOffsetHeight()
                                },getPopupPadding: function() {
                                return this.__popupMenu.getPadding()
                                },setPopupPadding: function(t) {
                                this.__popupMenu.setPadding(t)
                                },isIconVisible: function() {
                                return this.__popupMenu.isIconVisible()
                                },setIconVisible: function(t) {
                                this.__popupMenu.setIconVisible(t)
                                },getHtml: function() {
                                return this.__html.select
                                },__popupMenu: null,addChild: function(t, e) {
                                this.__popupMenu.addChild(t, e), this._updateItemsBinding()
                                },destroy: function() {
                                this.__popupMenu.destroy(), this.$super()
                                },_buildHtml: function() {
                                this.__html.select = document.createElement("div"), this.__html.select.className = "photonui-widget photonui-select", this.__html.select.tabIndex = "0"
                                },_updateItemsBinding: function() {
                                for (var t = this.__popupMenu.children, e = 0; e < t.length; e++)
                                t[e] instanceof n.MenuItem && t[e].registerCallback(this.name + "-click", "click", this.__onItemClicked, this)
                                },__onClick: function() {
                                this.__popupMenu.popupWidget(this)
                                },__onItemClicked: function(t) {
                                this.value = t.value, this._callCallbacks("value-changed", [this.value])
                                }});
    var n = n || {};
    n.FontSelect = n.Select.$extend({__init__: function(t) {
                                    this._fonts = [], this.$super(t), 0 == this.fonts.length && (this.fonts = ["sans-serif", "serif", "monospace"])
                                    },_fonts: null,getFonts: function() {
                                    return this._fonts
                                    },setFonts: function(t) {
                                    this._fonts = [];
                                    for (var e = 0; e < t.length; e++)
                                    this.addFont(t[e])
                                    },_value: "sans-serif",_placeholder: t.Stone ? t.Stone.lazyGettext("Select a font...") : "Select a font...",addFont: function(t) {
                                    var e = new n.MenuItem({value: t,text: t});
                                    e.html.style.fontFamily = t, this.addChild(e), this._fonts.push(t)
                                    }});
    var n = n || {};
    n.ColorPickerDialog = n.Dialog.$extend({__init__: function(t) {
                                           this.__widgets = {}, this._color = new n.Color;
                                           var t = t || {};
                                           t.title == e && (t.title = _("Select a color...")), this._registerWEvents(["value-changed"]), this.$super(t), this._buildUi(), this._updateProperties(["color"])
                                           },_color: null,getColor: function() {
                                           return this._color
                                           },setColor: function(t) {
                                           t instanceof n.Color && (this._color && this._color.removeCallback("photonui.colorpickerdialog.value-changed::" + this.name), this._color = t, this._color.registerCallback("photonui.colorpickerdialog.value-changed::" + this.name, "value-changed", this.__onColorChanged, this)), this.__onColorChanged()
                                           },setVisible: function(t) {
                                           this.$super(t), this._color && t && this.__widgets.labelRed && this._updateUi()
                                           },destroy: function() {
                                           this._color.removeCallback("photonui.colorpickerdialog.value-changed::" + this.name), this.$super()
                                           },_buildUi: function() {
                                           this.__widgets.hbox = new n.BoxLayout({orientation: "horizontal"}), this.child = this.__widgets.hbox, this.__widgets.colorPicker = new n.ColorPicker, this.__widgets.hbox.addChild(this.__widgets.colorPicker), this.__widgets.colorPalette = new n.ColorPalette, this.__widgets.hbox.addChild(this.__widgets.colorPalette), this.__widgets.separator = new n.Separator({orientation: "vertical"}), this.__widgets.hbox.addChild(this.__widgets.separator), this.__widgets.grid = new n.GridLayout, this.__widgets.hbox.addChild(this.__widgets.grid), this.__widgets.fieldRed = new n.Slider({min: 0,max: 255,decimalDigits: 0}), this.__widgets.labelRed = new n.Label({text: _("Red:"),forInput: this.__widgets.fieldRed}), this.__widgets.grid.addChild(this.__widgets.labelRed, {gridX: 0,gridY: 0,verticalExpansion: !1}), this.__widgets.grid.addChild(this.__widgets.fieldRed, {gridX: 1,gridY: 0,verticalExpansion: !1}), this.__widgets.fieldGreen = new n.Slider({min: 0,max: 255,decimalDigits: 0}), this.__widgets.labelGreen = new n.Label({text: _("Green:"),forInput: this.__widgets.fieldGreen}), this.__widgets.grid.addChild(this.__widgets.labelGreen, {gridX: 0,gridY: 1,verticalExpansion: !1}), this.__widgets.grid.addChild(this.__widgets.fieldGreen, {gridX: 1,gridY: 1,verticalExpansion: !1}), this.__widgets.fieldBlue = new n.Slider({min: 0,max: 255,decimalDigits: 0}), this.__widgets.labelBlue = new n.Label({text: _("Blue:"),forInput: this.__widgets.fieldBlue}), this.__widgets.grid.addChild(this.__widgets.labelBlue, {gridX: 0,gridY: 2,verticalExpansion: !1}), this.__widgets.grid.addChild(this.__widgets.fieldBlue, {gridX: 1,gridY: 2,verticalExpansion: !1}), this.__widgets.separator2 = new n.Separator, this.__widgets.grid.addChild(this.__widgets.separator2, {gridX: 0,gridY: 3,verticalExpansion: !1,gridWidth: 2}), this.__widgets.fieldHue = new n.Slider({min: 0,max: 360,decimalDigits: 0}), this.__widgets.labelHue = new n.Label({text: _("Hue:"),forInput: this.__widgets.fieldHue}), this.__widgets.grid.addChild(this.__widgets.labelHue, {gridX: 0,gridY: 4,verticalExpansion: !1}), this.__widgets.grid.addChild(this.__widgets.fieldHue, {gridX: 1,gridY: 4,verticalExpansion: !1}), this.__widgets.fieldSaturation = new n.Slider({min: 0,max: 100,decimalDigits: 0}), this.__widgets.labelSaturation = new n.Label({text: _("Saturation:"),forInput: this.__widgets.fieldSaturation}), this.__widgets.grid.addChild(this.__widgets.labelSaturation, {gridX: 0,gridY: 5,verticalExpansion: !1}), this.__widgets.grid.addChild(this.__widgets.fieldSaturation, {gridX: 1,gridY: 5,verticalExpansion: !1}), this.__widgets.fieldBrightness = new n.Slider({min: 0,max: 100,decimalDigits: 0}), this.__widgets.labelBrightness = new n.Label({text: _("Brightness:"),forInput: this.__widgets.fieldBrightness}), this.__widgets.grid.addChild(this.__widgets.labelBrightness, {gridX: 0,gridY: 6,verticalExpansion: !1}), this.__widgets.grid.addChild(this.__widgets.fieldBrightness, {gridX: 1,gridY: 6,verticalExpansion: !1}), this.__widgets.buttonOk = new n.Button({text: _("Ok")}), n.FAIcon && (this.__widgets.buttonOk.leftIcon = new n.FAIcon("fa-check")), this.__widgets.buttonCancel = new n.Button({text: _("Cancel")}), this.buttons = [this.__widgets.buttonOk, this.__widgets.buttonCancel], n.FAIcon && (this.__widgets.buttonCancel.leftIcon = new n.FAIcon("fa-times")), this.__widgets.colorPalette.color = this.__widgets.colorPicker.color, this.__widgets.colorPicker.color.registerCallback("colorpickerdialog.colorPicker.value-changed", "value-changed", this._updateUi, this), this.__widgets.fieldRed.registerCallback("colorpickerdialog.fieldRed.value-changed", "value-changed", function(t, e) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 this.__widgets.colorPicker.color.red = e
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 }, this), this.__widgets.fieldGreen.registerCallback("colorpickerdialog.fieldGreen.value-changed", "value-changed", function(t, e) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      this.__widgets.colorPicker.color.green = e
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      }, this), this.__widgets.fieldBlue.registerCallback("colorpickerdialog.fieldBlue.value-changed", "value-changed", function(t, e) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          this.__widgets.colorPicker.color.blue = e
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          }, this), this.__widgets.fieldHue.registerCallback("colorpickerdialog.fieldHue.value-changed", "value-changed", function(t, e) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             this.__widgets.colorPicker.color.hue = e
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             }, this), this.__widgets.fieldSaturation.registerCallback("colorpickerdialog.fieldSaturation.value-changed", "value-changed", function(t, e) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       this.__widgets.colorPicker.color.saturation = e
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       }, this), this.__widgets.fieldBrightness.registerCallback("colorpickerdialog.fieldBrightness.value-changed", "value-changed", function(t, e) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 this.__widgets.colorPicker.color.brightness = e
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 }, this), this.__widgets.buttonOk.registerCallback("colorpickerdialog.buttonOk.click", "click", this.__onValidate, this), this.__widgets.buttonCancel.registerCallback("colorpickerdialog.buttonCancel.click", "click", this.__onCancel, this), this.registerCallback("colorpickerdialog.close", "close-button-clicked", this.__onCancel, this)
                                           },_updateUi: function(t) {
                                           var t = t || this.color;
                                           this.__widgets.fieldRed.value = t.red, this.__widgets.fieldGreen.value = t.green, this.__widgets.fieldBlue.value = t.blue, this.__widgets.fieldHue.value = t.hue, this.__widgets.fieldSaturation.value = t.saturation, this.__widgets.fieldBrightness.value = t.brightness
                                           },__onCancel: function() {
                                           this.__widgets.colorPicker.color.setHSB(this._color.hue, this._color.saturation, this._color.brightness), this.hide()
                                           },__onValidate: function() {
                                           this._color.setHSB(this.__widgets.colorPicker.color.hue, this.__widgets.colorPicker.color.saturation, this.__widgets.colorPicker.color.brightness), this.hide(), this._callCallbacks("value-changed", [this.color])
                                           },__onColorChanged: function() {
                                           this.__widgets.colorPicker.color.setHSB(this._color.hue, this._color.saturation, this._color.brightness)
                                           }});
    var n = n || {};
    return n.ColorButton = n.Button.$extend({__init__: function(t) {
                                            this.__widgets = {}, this._color = new n.Color, this._registerWEvents(["value-changed"]), this.$super(t), this._buildUi(), this._updateProperties(["color"])
                                            },getValue: function() {
                                            return this.color.hexString
                                            },setValue: function(t) {
                                            this.color.hexString = t
                                            },_color: null,getColor: function() {
                                            return this._color
                                            },setColor: function(t) {
                                            t instanceof n.Color && (this._color && this._color.removeCallback("photonui.colorbutton.value-changed::" + this.name), this._color = t, this._color.registerCallback("photonui.colorbutton.value-changed::" + this.name, "value-changed", this.__onColorChanged, this)), this.__onColorChanged(), t instanceof n.Color && (this._color = t)
                                            },_dialogOnly: !1,isDialogOnly: function() {
                                            return this._dialogOnly
                                            },setDialogOnly: function(t) {
                                            this._dialogOnly = !!t
                                            },destroy: function() {
                                            this._color.removeCallback("photonui.colorbutton.value-changed::" + this.name), this.$super()
                                            },_update: function() {
                                            },_buildHtml: function() {
                                            this.$super(), this.__html.button = document.createElement("button"), this.__html.button.className = "photonui-widget photonui-button", this.__html.button.className += " photonui-colorbutton", this.__html.color = document.createElement("span"), this.__html.button.appendChild(this.__html.color)
                                            },_buildUi: function() {
                                            this.__widgets.popup = new n.PopupWindow, this.__widgets.vbox = new n.BoxLayout({verticalSpacing: 0,horizontalSpacing: 0}), this.__widgets.popup.child = this.__widgets.vbox, this.__widgets.palette = new n.ColorPalette, this.__widgets.vbox.addChild(this.__widgets.palette), this.__widgets.custom = new n.Button({text: _("Custom color..."),appearance: "flat"}), this.__widgets.custom.addClass("photonui-colorbutton-custombutton"), this.__widgets.vbox.addChild(this.__widgets.custom), this.__widgets.colorPickerDialog = new n.ColorPickerDialog, this.__widgets.palette.registerCallback("value-changed", "value-changed", this.__onValueChanged, this), this.__widgets.colorPickerDialog.registerCallback("value-changed", "value-changed", this.__onValueChanged, this), this.__widgets.custom.registerCallback("click", "click", this.__onCustomButtonClicked, this), this.__widgets.palette.color = this.color, this.__widgets.colorPickerDialog.color = this.color
                                            },__onButtonClicked: function(t) {
                                            this._callCallbacks("click", [t]), this.dialogOnly ? (this.__widgets.colorPickerDialog.show(), this.__widgets.colorPickerDialog.center()) : this.__widgets.popup.popupWidget(this)
                                            },__onValueChanged: function() {
                                            this._callCallbacks("value-changed", [this.color])
                                            },__onColorChanged: function() {
                                            this.__html.color.style.backgroundColor = this.color.hexString
                                            },__onCustomButtonClicked: function() {
                                            this.__widgets.colorPickerDialog.show(), this.__widgets.colorPickerDialog.center()
                                            }}), n
}(window);
var GeometryHelper = new function() {
    this.createHandle = function(t, e, n, i, o) {
        {
            var r, i = i || {};
            i.hinge || 1
        }
        if (1 == t) {
            var s = e, a = n, l = BABYLON.Mesh.CreateBloc("handle", a, a, 4, o);
            l.position.y = s / 2 - (i.offset >= 0 ? i.offset : 2);
            var h = BABYLON.Mesh.CreateBloc("handle", a, s, a, o);
            h.position.z = 2;
            var c = BABYLON.Mesh.CreateBloc("handle", a, a, 4, o);
            c.position.y = -s / 2 + (i.offset >= 0 ? i.offset : 2), r = BABYLON.Mesh.mergeMeshesRec("handle", [l, h, c], o), r.position.z = 0, r.rotation.z = Math.PI / 2
        } else if (2 == t)
            r = BABYLON.Mesh.CreateBloc("handle", e, n, 3, o);
        else if (3 == t)
            r = BABYLON.Mesh.CreateBloc("handle", e, 1, n, o), r.rotation.x = Math.PI / 8;
        else if (4 == t)
            r = BABYLON.Mesh.CreateCylinder("handle", e, n, 3, 6, 1, !0, o), r.rotation.x = Math.PI / 2;
        else if (5 == t)
            r = this.createCurvedBarGeometry("handle", e, n, 1, 5, 10, o);
        else if (6 == t)
            i.offset = n / 2, r = this.createHandle(1, e, n, i, o);
        else if (7 == t) {
            i.offset = n / 2, r = this.createHandle(1, e, n, i, o);
            var u = BABYLON.Mesh.CreateBloc("handle_deco", n, e + 3, .3, o), p = BABYLON.Mesh.CreateBloc("handle_deco", n, e + 3, .3, o);
            u.position.x += n / 2, p.position.x -= n / 2, u.position.z = 2, u.rotation.y = -Math.PI / 10, p.rotation.y = Math.PI / 10, p.position.z = 2, u.parent = p.parent = r
        } else if (8 == t) {
            var s = e, a = n, l = BABYLON.Mesh.CreateBloc("handle", a, a, 4, o);
            l.position.y = s / 2 - (i.offset >= 0 ? i.offset : 2);
            var h = BABYLON.Mesh.CreateCylinder("handle", s, 2 * a, 2 * a, 10, 1, !0, o);
            h.position.z = 2;
            var c = BABYLON.Mesh.CreateCylinder("handle", a, a, 4, 6, 1, !0, o);
            c.position.y = -s / 2 + (i.offset >= 0 ? i.offset : 2);
            var c = BABYLON.Mesh.CreateBloc("handle", a, a, 4, o);
            c.position.y = -s / 2 + (i.offset >= 0 ? i.offset : 2), r = BABYLON.Mesh.mergeMeshesRec("handle", [l, h, c], o), r.position.z = 0, r.rotation.z = Math.PI / 2
        } else
            r = BABYLON.Mesh.CreateBloc("handle", 3, 3, 3, o);
        return r
    }, this.createPoignee = function(t, e, n, i, o) {
        var i = i || {}, r = (i.hinge || 1, null);
        if (1 == t) {
            var s = e - 10, a = 1, l = BABYLON.Mesh.CreateBloc("handle", a, a, 4, o);
            l.position.y = s / 2 - 2;
            var h = BABYLON.Mesh.CreateBloc("handle", a, s, a, o);
            h.position.z = 3;
            var c = BABYLON.Mesh.CreateBloc("handle", a, a, 4, o);
            c.position.y = -s / 2 + 2, r = BABYLON.Mesh.mergeMeshesRec("handle", [l, h, c], o), r.position.z = 0, r.rotation.z = Math.PI / 2
        } else
            2 == t ? r = BABYLON.Mesh.CreateBloc("handle", 3, 3, 3, o) : 3 == t ? r = BABYLON.Mesh.CreateBloc("handle", e - 10, 1, 5, o) : 4 == t ? (r = BABYLON.Mesh.CreateCylinder("handle", 3, 3, 3, 8, 1, !0, o), r.rotation.x = Math.PI / 2) : 5 == t ? (r = this.createPoignee(1, 25, null, null, o), r.position.y += n / 2 - 10) : 6 == t && (r = this.createPoignee(1, 25, null, null, o), r.position.y += n / 2 - 10);
        return r
    }, this.createTiroir = function(t, e, n, i, o, r, s) {
        var r = r || {};
        r.stretched_texture = r.stretched_texture || 0;
        var a = 3, l = r.rounded && (+r.configuration[3] || +r.configuration[0]) ? r.radius : a, h = [], c = BABYLON.Mesh.CreateBloc("back", t - a, n / 2, a, s);
        c.position.z = -e / 2, c.position.y = -n / 4 + l, h.push(c);
        var u = BABYLON.Mesh.CreateBloc("left", a, n / 2, e, s);
        u.position.x = -t / 2 + a, u.position.y = -n / 4 + l, h.push(u);
        var p = BABYLON.Mesh.CreateBloc("right", a, n / 2, e, s);
        if (p.position.x = t / 2 - a, p.position.y = -n / 4 + l, h.push(p), r.rounded) {
            var d = this.createRoundedPane(t, n, i, r.radius, null, r.configuration, s);
            d.name = "front", d.position.z = i / 2
        } else {
            var d = BABYLON.Mesh.CreateBloc("front", t, n, i, s);
            0 !== r.stretched_texture && this.setStretchUV(d)
        }
        d.position.z += e / 2, h.push(d);
        var m = BABYLON.Mesh.CreateBloc("bottom", t - 2 * a, a, e, s);
        m.position.y -= n / 2 - l, h.push(m);
        var g = BABYLON.Mesh.mergeMeshesRec("tiroir", h, s);
        if (-1 !== +r.handle_position) {
            var o = o.toString(), f = r.handle_position.split(",")[0] || 0, y = r.handle_position.split(",")[1] || 0, _ = r.handle_position.split(",")[2] || 0;
            _ = _ / 180 * Math.PI;
            var o = o.toString() || o, v = o.split(",")[0] || 0, b = o.split(",")[1] || t - 10, w = o.split(",")[2] || 1;
            b = this.calcMeasure(b, t, n), w = this.calcMeasure(w, t, n), f = this.calcMeasure(f, t, n), y = this.calcMeasure(y, t, n);
            var x = this.createHandle(v, b, w, {hinge: 1}, s);
            x.position.x = f, x.position.y = y, x.position.z += e / 2 + i / 2, x.rotation.z += _, x.parent = g
        } else {
            var x = this.createPoignee(o, t, n, {hinge: -1}, s);
            x && (x.position.z += e / 2 + i / 2, x.position.y = n / 2 - 5, 3 == o && (x.rotation.x = Math.PI / 8), 5 == o && (x.rotation.z = Math.PI / 2), x.parent = g)
        }
        return 0 == r.stretched_texture && GeometryHelper.giftWraper(g), g
    }, this.calcMeasure = function(measure, w, h) {
        var reg = new RegExp("[^wh0-9?:<>()\\-\\+*/]");
        return reg.test(measure) === !1 ? eval(measure) : measure
    }, this.setStretchUV = function(t) {
        var e = [];
        e.push(1, 0), e.push(0, 0), e.push(0, 1), e.push(1, 1), e.push(1, 1), e.push(0, 1), e.push(0, 0), e.push(1, 0), e.push(1, 0), e.push(0, 0), e.push(0, 0), e.push(1, 0), e.push(1, 0), e.push(0, 0), e.push(0, 0), e.push(1, 0), e.push(1, 0), e.push(0, 0), e.push(0, 0), e.push(1, 0), e.push(1, 0), e.push(0, 0), e.push(0, 0), e.push(1, 0), t.setVerticesData(BABYLON.VertexBuffer.UVKind, e)
    }, this.createSimplePorte = function(t, e, n, i, o, r, s) {
        var n = n || 3, a = new BABYLON.Mesh("door", s);
        a.isVisible = !1;
        var r = r || {};
        if (r.stretched_texture = r.stretched_texture || 0, r.handle_position = r.handle_position || -1, r.rounded) {
            var l = this.createRoundedPane(t, e, n, r.radius, null, r.configuration, s);
            l.name = "casement", l.position.z = n / 2
        } else {
            var l = BABYLON.Mesh.CreateBloc("casement", t, e, n, s);
            0 !== r.stretched_texture && this.setStretchUV(l)
        }
        if (l.parent = a, 1 == i || -1 == i)
            a.setPivotMatrix(BABYLON.Matrix.Translation(i * t / 2, 0, n / 2)), a.position.x = -i * t / 2;
        else {
            var h = -2 * -i + 5;
            a.setPivotMatrix(BABYLON.Matrix.Translation(0, h * e / 2, n / 2)), a.position.y = -h * e / 2
        }
        if (a.hinge = i, -1 !== +r.handle_position) {
            var c = r.handle_position.split(",")[0] || 0, u = r.handle_position.split(",")[1] || 0, p = r.handle_position.split(",")[2] || 0;
            p = p / 180 * Math.PI;
            var o = o.toString() || o, d = o.split(",")[0] || 0, m = o.split(",")[1] || t - 10, g = o.split(",")[2] || 1;
            m = this.calcMeasure(m, t, e), g = this.calcMeasure(g, t, e), c = this.calcMeasure(c, t, e), u = this.calcMeasure(u, t, e), c = -1 == i ? -c : c;
            var f = this.createHandle(d, m, g, {hinge: i}, s);
            f.position.x = c, f.position.y = u, f.position.z += n / 2, f.rotation.z += p, f.parent = a
        } else if (1 != i && -1 != i || 6 == o) {
            if (6 != o) {
                var h = -2 * -i + 5, f = this.createPoignee(o, t, t, {hinge: i}, s);
                f && (f.position.y = h * e / 3, f.position.z += n / 2, 3 == o && (f.rotation.x = h * Math.PI / 8), f.parent = a)
            } else if (6 == o) {
                var f = this.createPoignee(o, t, t, {hinge: i}, s);
                f.position.y = e / 3, f && (f.position.z += n / 2, f.parent = a)
            }
        } else {
            var f = this.createPoignee(o, e, e, {hinge: i}, s);
            f && (f.rotation.z += Math.PI / 2, f.position.x = i * t / 3, f.position.z += n / 2, 3 == o && (f.rotation.y = -i * Math.PI / 8), 4 == o && (f.rotation.z = 0), f.parent = a)
        }
        return 0 == r.stretched_texture && this.giftWraper(l, 128), a
    }, this.createCurvedBarGeometry = function(t, e, n, i, o, r, s) {
        var a = [], l = l || !1, h = [], c = [], u = [], r = r || 10, o = o, p = -i / 2, d = +i / 2, m = new BABYLON.Vector3(-e / 2, 0, p), g = new BABYLON.Vector3(e / 2, 0, p), f = new BABYLON.Vector3(0, 0, p + o);
        a.push(m.x, m.y, m.z), GeometryHelper.generateArc(a, r, m, f, g), a.push(g.x, g.y, g.z);
        var y = new BABYLON.Vector3(-e / 2, n, p), _ = new BABYLON.Vector3(e / 2, n, p), v = new BABYLON.Vector3(0, n, p + o);
        a.push(y.x, y.y, y.z), GeometryHelper.generateArc(a, r, y, v, _), a.push(_.x, _.y, _.z);
        var y = new BABYLON.Vector3(-e / 2, n, d), _ = new BABYLON.Vector3(e / 2, n, d), v = new BABYLON.Vector3(0, n, d + o);
        a.push(y.x, y.y, y.z), GeometryHelper.generateArc(a, r, y, v, _), a.push(_.x, _.y, _.z);
        var m = new BABYLON.Vector3(-e / 2, 0, d), g = new BABYLON.Vector3(e / 2, 0, d), f = new BABYLON.Vector3(0, 0, d + o);
        a.push(m.x, m.y, m.z), GeometryHelper.generateArc(a, r, m, f, g), a.push(g.x, g.y, g.z);
        for (var b = r + 1, w = 0, x = 4, C = 0; x - 1 > C; C++) {
            w = C * b;
            for (var M = 0; b - 1 > M; M++)
                h.push(w + M, w + M + 1, w + b + M + 1), h.push(w + b + M + 1, w + b + M, w + M)
                }
        var D = new BABYLON.Mesh(t, s);
        return BABYLON.VertexData.ComputeNormals(a, h, c), u = BABYLON.Tools.PlaneUVProjection(a, new BABYLON.Vector3(1, 0, 0), new BABYLON.Vector3(0, 1, 0), 0), D.setVerticesData(BABYLON.VertexBuffer.PositionKind, a, l), D.setVerticesData(BABYLON.VertexBuffer.NormalKind, c, l), D.setVerticesData(BABYLON.VertexBuffer.UVKind, u, l), D.setIndices(h), D
    }, this.createDoublePorte = function(t, e, n, i, o, r) {
        var s = new BABYLON.Mesh("dblPorte", r);
        s.isVisible = !1;
        var n = n || 3, o = o || {};
        if (o.rounded) {
            var a = ujs.cloneObject(o), l = ujs.cloneObject(o);
            a.configuration[3] = 0, a.configuration[2] = 0, l.configuration[1] = 0, l.configuration[0] = 0;
            var h = this.createSimplePorte(t / 2, e, n, 1, i, a, r), c = this.createSimplePorte(t / 2, e, n, -1, i, l, r)
        } else
            var h = this.createSimplePorte(t / 2, e, n, 1, i, o, r), c = this.createSimplePorte(t / 2, e, n, -1, i, o, r);
        return h.position.x += -t / 4 - .1, h.hinge = 1, c.position.x += t / 4 + .1, c.hinge = -1, h.setPivotMatrix(BABYLON.Matrix.Translation(t / 4 + .1, 0, n / 2)), c.setPivotMatrix(BABYLON.Matrix.Translation(-t / 4 - .1, 0, n / 2)), h.parent = s, c.parent = s, s
    }, this.createRoundedCadreStrate = function(t, e, n, i, o, r, s) {
        var s = s || [1, 1, 1, 1], a = 1 == s[3] ? o : 1, l = 1 == s[2] ? o : 1, h = 1 == s[1] ? o : 1, c = 1 == s[0] ? o : 1, u = new BABYLON.Vector3(e / 2 - a, -n / 2, i), p = new BABYLON.Vector3(e / 2, -n / 2 + a, i), d = new BABYLON.Vector3(e / 2, n / 2 - l, i), m = new BABYLON.Vector3(e / 2 - l, n / 2, i), g = new BABYLON.Vector3(-e / 2 + h, n / 2, i), f = new BABYLON.Vector3(-e / 2, n / 2 - h, i), y = new BABYLON.Vector3(-e / 2, -n / 2 + c, i), _ = new BABYLON.Vector3(-e / 2 + c, -n / 2, i), v = new BABYLON.Vector3(e / 2, -n / 2, i), b = new BABYLON.Vector3(e / 2, n / 2, i), w = new BABYLON.Vector3(-e / 2, n / 2, i), x = new BABYLON.Vector3(-e / 2, -n / 2, i);
        return t.push(_.x, _.y, _.z), this.generateArc(t, r, _, x, y), t.push(y.x, y.y, y.z), t.push(f.x, f.y, f.z), this.generateArc(t, r, f, w, g), t.push(g.x, g.y, g.z), t.push(m.x, m.y, m.z), this.generateArc(t, r, m, b, d), t.push(d.x, d.y, d.z), t.push(p.x, p.y, p.z), this.generateArc(t, r, p, v, u), t.push(u.x, u.y, u.z), t
    }, this.triangulateStrate = function(t, e) {
        for (var n = [], i = t + 1; t + e - 1 > i; i++)
            n.push(i + 1, i, t);
        return n
    }, this.generateStrateFacesForGeometry = function(t, e, n, i, o, r, s, a) {
        for (var l = l || !1, h = [], c = [], u = [], s = s || [], i = i || !1, o = o || !1, p = e.length / (3 * n), d = 0, m = new BABYLON.Mesh(t, r), g = 0, f = e.slice(0, 3 * (n - 1)), y = this.triangulateStrate(0, n), _ = 0, v = 3; v < f.length; v += 3)
            _ += new BABYLON.Vector3(f[v], f[v + 1], f[v + 2]).distanceTo(new BABYLON.Vector3(f[v - 3], f[v - 2], f[v - 1]));
        _ += new BABYLON.Vector3(f[v - 3], f[v - 2], f[v - 1]).distanceTo(new BABYLON.Vector3(f[0], f[1], f[2]));
        {
            var b = BABYLON.BoundingBox.CreateFromData(e);
            b.maximum.z - b.minimum.z
        }
        if (i)
            for (var v = 0; v < y.length; v += 3)
                h.push(y[v], y[v + 1], y[v + 2]);
        for (var w, x, C, M, D, B, A = 0, E = [], T = !1, S = 0; p - 1 > S; S++) {
            d = S * n, g = h.length, A = 0, T = !1;
            for (var L = 0; L < s.length; L++)
                s[L] === S && (T = !0);
            for (var v = 0; n - 1 > v; v++) {
                w = d + v, x = d + 1 + v, C = d + n + v + 1, M = d + n + v + 1, D = d + n + v, B = d + v, h.push(w, x, C), h.push(M, D, B), T && E.push(w, x, C, M, D, B);
                var O = new BABYLON.Vector3(e[w], e[w + 1], e[w + 2]).distanceTo(new BABYLON.Vector3(e[x], e[x + 1], e[x + 2]));
                A += O
            }
            h.push(d + v, d, d + n), h.push(d + n, d + n + v, d + v), T && (E.push(d + v, d, d + n), E.push(d + n, d + n + v, d + v))
        }
        if (o)
            for (var P = e.length / 3 - n, I = (e.slice(3 * P, e.length), this.triangulateStrate(P, n)), v = 0; v < I.length; v += 3)
                a ? h.push(I[v + 2], I[v + 1], I[v]) : h.push(I[v], I[v + 1], I[v + 2]);
        return BABYLON.VertexData.ComputeNormals(e, h, c), i && BABYLON.Mesh.ComputeFaceNormal(e, c, y), o && !a && BABYLON.Mesh.ComputeFaceNormal(e, c, I), BABYLON.Mesh.ComputeFaceNormal(e, c, E), u = BABYLON.Tools.PlaneUVProjection(e, new BABYLON.Vector3(1, 0, 0), new BABYLON.Vector3(0, 0, 1)), m.setVerticesData(BABYLON.VertexBuffer.PositionKind, e, l), m.setVerticesData(BABYLON.VertexBuffer.NormalKind, c, l), m.setVerticesData(BABYLON.VertexBuffer.UVKind, u, l), m.setIndices(h), m
    }, this.createRoundedPane = function(t, e, n, i, o, r, s) {
        var a = [], o = o || 6, i = i || 20, r = r || [1, 1, 1, 1];
        this.createRoundedCadreStrate(a, t, e, -n, i, o, r), this.createRoundedCadreStrate(a, t, e, -n, i, o, r), this.createRoundedCadreStrate(a, t, e, 0, i, o, r), this.createRoundedCadreStrate(a, t, e, 0, i, o, r);
        var l = 8 + 4 * (o - 1);
        return this.generateStrateFacesForGeometry("pane", a, l, !0, !0, s, void 0, !0)
    }, this.createRoundedCadre = function(t, e, n, i, o, r, s) {
        var a = [], l = r.nbseg || 6, h = r.radius || 20, o = o || [1, 1, 1, 1];
        this.createRoundedCadreStrate(a, t, e, -i / 2, h, l, o), this.createRoundedCadreStrate(a, t, e, i / 2, h, l, o), this.createRoundedCadreStrate(a, t, e, i / 2, h, l, o), this.createRoundedCadreStrate(a, t - 2 * n, e - 2 * n, i / 2, h, l, o), this.createRoundedCadreStrate(a, t - 2 * n, e - 2 * n, i / 2, h, l, o), this.createRoundedCadreStrate(a, t - 2 * n, e - 2 * n, -i / 2, h, l, o);
        var c = 4 * (l + 1), u = this.generateStrateFacesForGeometry("cadre", a, c, !1, !1, s, [2]);
        return this.giftWraper(u, 128, !0), u
    }, this.giftWraper = function(t, e, n) {
        if (e = e || 128, t && t.getTotalVertices()) {
            for (var i, o, r, s, a = t.getIndices(), l = t.getVerticesData(BABYLON.VertexBuffer.PositionKind), h = t.getVerticesData(BABYLON.VertexBuffer.NormalKind), c = !1, u = new Array(l.length / 3), p = t.scaling.asArray(), d = new BABYLON.Vector3, m = new BABYLON.Vector3, g = new BABYLON.Vector3, f = new Array(l.length / 3 * 2), s = f.length; s--; )
                f[s] = 0;
            for (var y = 0; y < a.length; y += 3)
                if (BABYLON.Vector3.FromArrayToRef(l, 3 * a[y], d), BABYLON.Vector3.FromArrayToRef(l, 3 * a[y + 1], m), BABYLON.Vector3.FromArrayToRef(l, 3 * a[y + 2], g), m.subtractInPlace(d), g.subtractInPlace(d), m.multiplyInPlace(t.scaling), g.multiplyInPlace(t.scaling), BABYLON.Vector3.CrossToRef(m, g, d), d.multiplyInPlace(d), !(d.x < 1e-4 && d.y < 1e-4 && d.z < 1e-4))
                    for (d.x > d.y && d.x > d.z ? (i = 2, o = 1, r = 0) : d.y > d.x && d.y > d.z ? (i = 0, o = 2, r = 1) : (i = 0, o = 1, r = 2), s = 0; 3 > s; s++) {
                        if ("undefined" != typeof u[a[y + s]]) {
                            if (!n || u[a[y + s]] == r)
                                continue;
                            c = !0, l.push(l[3 * a[y + s]], l[3 * a[y + s] + 1], l[3 * a[y + s] + 2]), h.push(h[3 * a[y + s]], h[3 * a[y + s] + 1], h[3 * a[y + s] + 2]), a[y + s] = l.length / 3 - 1
                        }
                        u[a[y + s]] = r, f[2 * a[y + s]] = l[3 * a[y + s] + i] * p[i] / e, f[2 * a[y + s] + 1] = l[3 * a[y + s] + o] * p[o] / e
                    }
            return t.setVerticesData(BABYLON.VertexBuffer.UVKind, f), c && (t.setVerticesData(BABYLON.VertexBuffer.NormalKind, h), t.setVerticesData(BABYLON.VertexBuffer.PositionKind, l), t.setIndices(a)), t
        }
    }, this.createCadre = function(t, e, n, i, o, r, s) {
        var r = r || {}, o = o || [1, 1, 1, 1];
        if (r.rounded && r.radius > 0)
            return this.createRoundedCadre(t, e, n, i, o, r, s);
        var a = new BABYLON.Mesh("cadre", s);
        if (a.isVisible = !1, 0 == n) {
            var l = BABYLON.Mesh.CreateBloc("cadreHaut", t, .1, i, s), h = BABYLON.Mesh.CreateBloc("cadreGauche", .1, e, i, s);
            n = .1
        } else if (0 == i)
            var l = BABYLON.Mesh.CreatePlane("cadreHaut", t, n, s), h = BABYLON.Mesh.CreatePlane("cadreGauche", n, e - 2 * n, s);
        else
            var l = BABYLON.Mesh.CreateBloc("CadreHaut", t, n, i, s), h = BABYLON.Mesh.CreateBloc("CadreGauche", n, e - 2 * n, i, s);
        if (l.parent = a, h.parent = a, 1 == o[2]) {
            var c = h.duplicate("cadreDroit", a, !0);
            c.position.x = -t / 2 + n / 2, c.parent = a
        }
        if (1 == o[3]) {
            var u = l.duplicate("cadreBas", a, !0);
            u.position.y = -e / 2 + n / 2, u.parent = a
        }
        return 1 == o[0] ? l.position.y = e / 2 - n / 2 : l.dispose(), 1 == o[1] ? h.position.x = t / 2 - n / 2 : h.dispose(), a = BABYLON.Mesh.mergeMeshesRec("cadre", [a], s), this.giftWraper(a, 128), a
    }, this.generateArc = function(t, e, n, i, o) {
        for (var r = 1; e > r; r++) {
            var s = n.add(i.subtract(n).scale(r / e)), a = i.add(o.subtract(i).scale(r / e)), l = s.add(a.subtract(s).scale(r / e));
            t.push(l.x, l.y, l.z)
        }
    }, this.generateArcPoints = function(t, e, n, i, o) {
        for (var r = 1; e > r; r++) {
            var s = n.add(i.subtract(n).scale(r / e)), a = i.add(o.subtract(i).scale(r / e)), l = s.add(a.subtract(s).scale(r / e));
            t.push(l)
        }
    }, this.generateVasqueStrate = function(t, e, n, i, o, r, s, a, l) {
        var s = s || 3, a = a || r, l = l || r;
        t.push(-n / 2 + a, o, i / 2), t.push(n / 2 - a, o, i / 2), this.generateArc(t, s, new BABYLON.Vector3(n / 2 - a, o, i / 2), new BABYLON.Vector3(n / 2, o, i / 2), new BABYLON.Vector3(n / 2, o, i / 2 - l)), t.push(n / 2, o, i / 2 - l), t.push(n / 2, o, -i / 2 + l), this.generateArc(t, s, new BABYLON.Vector3(n / 2, o, -i / 2 + l), new BABYLON.Vector3(n / 2, o, -i / 2), new BABYLON.Vector3(n / 2 - a, o, -i / 2)), t.push(n / 2 - a, o, -i / 2), t.push(-n / 2 + a, o, -i / 2), this.generateArc(t, s, new BABYLON.Vector3(-n / 2 + a, o, -i / 2), new BABYLON.Vector3(-n / 2, o, -i / 2), new BABYLON.Vector3(-n / 2, o, -i / 2 + l)), t.push(-n / 2, o, -i / 2 + l), t.push(-n / 2, o, +i / 2 - l), this.generateArc(t, s, new BABYLON.Vector3(-n / 2, o, +i / 2 - l), new BABYLON.Vector3(-n / 2, o, i / 2), new BABYLON.Vector3(-n / 2 + a, o, i / 2))
    }, this.createVasqueGeometry = function(t, e, n) {
        for (var i = [], e = e || {}, o = e.height || 35, r = e.bottomL || 140, s = e.topL || 160, a = e.bottomW || 40, l = e.topW || 50, h = e.radius || 5, c = e.nbseg || 10, u = e.thickness || 10, p = e.thicknessL || u, d = e.thicknessW || u, m = 0, g = 0; o >= g; g++)
            f = r + (Math.asin(2 * g / o - 1) + Math.PI / 2) * (s - r) / Math.PI, y = a + (Math.asin(2 * g / o - 1) + Math.PI / 2) * (l - a) / Math.PI, (.3 * o > g || g > .9 * o) && this.generateVasqueStrate(i, ++m, f, y, g, h, c);
        this.generateVasqueStrate(i, ++m, s + 1, l + 1, g, h, c);
        var f = s + p, y = l + d, h = .1;
        return this.generateVasqueStrate(i, ++m, f, y, g, h, c, void 0, void 0, !0), this.generateVasqueStrate(i, ++m, f, y, g - 1, h, c, void 0, void 0, !0), GeometryHelper.generateStrateFacesForGeometry(t, i, 8 + 4 * (c - 1), !0, !1, n, [m - 3])
    }, this.createHeadLight = function(t, e, n, i, o, r, s, a, l) {
        var h = h || !1, c = [], u = [], p = [];
        e = e || 50, n = Math.max(3, Math.floor(n) || 8), i = Math.max(2, Math.floor(i) || 6), o = void 0 !== o ? o : 0, r = void 0 !== r ? r : 2 * Math.PI, s = void 0 !== s ? s : 0, a = void 0 !== a ? a : Math.PI;
        var d, m, g = [], f = [];
        for (m = 0; i >= m; m++) {
            var y = [], _ = [];
            for (d = 0; n >= d; d++) {
                var v = d / n, b = m / i, w = -e * Math.cos(o + v * r) * Math.sin(s + b * a), x = e * Math.cos(s + b * a), C = e * Math.sin(o + v * r) * Math.sin(s + b * a);
                c.push(w, x, C), y.push(c.length / 3 - 1), _.push(new BABYLON.Vector2(v, 1 - b))
            }
            g.push(y), f.push(_)
        }
        for (m = 0; i > m; m++)
            for (d = 0; n > d; d++) {
                var M = g[m][d + 1], D = g[m][d], B = g[m + 1][d], A = g[m + 1][d + 1], E = (new BABYLON.Vector3(c[M], c[M + 1], c[M + 2]).normalize(), new BABYLON.Vector3(c[D], c[D + 1], c[D + 2]).normalize(), new BABYLON.Vector3(c[B], c[B + 1], c[B + 2]).normalize(), new BABYLON.Vector3(c[A], c[A + 1], c[A + 2]).normalize(), f[m][d + 1].clone()), T = f[m][d].clone(), S = f[m + 1][d].clone(), L = f[m + 1][d + 1].clone();
                u.push(A, D, M), p.push(E.x, E.y, T.x, T.y, L.x, L.y), u.push(A, B, D), p.push(T.x, T.y, S.x, S.y, L.x, L.y)
            }
        var O = [], P = new BABYLON.Mesh(t, l);
        return BABYLON.VertexData.ComputeNormals(c, u, O), P.setVerticesData(BABYLON.VertexBuffer.PositionKind, c, h), P.setVerticesData(BABYLON.VertexBuffer.NormalKind, O, h), P.setVerticesData(BABYLON.VertexBuffer.UVKind, p, h), P.setIndices(u), P
    }, this.createPillow = function(t, e, n, i, o, r, s, a, l, h, c, u) {
        c || (c = 0), u || (u = 0);
        var p = i.clone(), d = new BABYLON.Vector3(p.x, p.y, p.z - s / 2), m = new BABYLON.Vector3(p.x, p.y, p.z + s / 2), g = new BABYLON.Vector3(p.x, p.y + r / 2 - l, p.z), f = new BABYLON.Vector3(p.x, p.y - r / 2 + l, p.z), y = new BABYLON.Vector3(p.x - o / 2 + a, p.y, p.z), _ = (new BABYLON.Vector3(d.x - o / 2, d.y + r / 2, d.z), new BABYLON.Vector3(p.x - o / 2, p.y + r / 2, p.z)), v = (new BABYLON.Vector3(m.x - o / 2, m.y + r / 2, m.z), new BABYLON.Vector3(d.x - o / 2, d.y - r / 2, d.z), new BABYLON.Vector3(p.x - o / 2, p.y - r / 2, p.z)), b = (new BABYLON.Vector3(m.x - o / 2, m.y - r / 2, m.z), new BABYLON.Vector3(p.x + o / 2 - a, p.y, p.z)), w = (new BABYLON.Vector3(d.x + o / 2, d.y + r / 2, d.z), new BABYLON.Vector3(p.x + o / 2, p.y + r / 2, p.z)), x = (new BABYLON.Vector3(m.x + o / 2, m.y + r / 2, m.z), new BABYLON.Vector3(d.x + o / 2, d.y - r / 2, d.z), new BABYLON.Vector3(p.x + o / 2, p.y - r / 2, p.z)), C = (new BABYLON.Vector3(m.x + o / 2, m.y - r / 2, m.z), C || !1), M = [], D = [], B = [], A = [], E = [], T = [_.x, _.y, _.z];
        this.generateArc(T, n, _, g, w);
        for (var S = 0; n > S; S++)
            M.push(m.x, m.y, m.z), M.push(m.x - c + 2 * S * c / n, m.y + u, m.z), this.generateArc(M, e, new BABYLON.Vector3(m.x - c + 2 * S * c / n, m.y + u, m.z), new BABYLON.Vector3(T[3 * S], T[3 * S + 1], T[3 * S + 2] + s / 2), new BABYLON.Vector3(T[3 * S], T[3 * S + 1], T[3 * S + 2])), M.push(T[3 * S], T[3 * S + 1], T[3 * S + 2]), this.generateArc(M, e, new BABYLON.Vector3(T[3 * S], T[3 * S + 1], T[3 * S + 2]), new BABYLON.Vector3(T[3 * S], T[3 * S + 1], T[3 * S + 2] - s / 2), new BABYLON.Vector3(d.x - c + 2 * S * c / n, d.y + u, d.z)), M.push(d.x - c + 2 * S * c / n, d.y + u, d.z), M.push(d.x, d.y, d.z);
        T = [w.x, w.y, w.z], this.generateArc(T, n, w, b, x);
        for (var S = 0; n > S; S++)
            M.push(m.x, m.y, m.z), M.push(m.x + c, m.y + u - 2 * S * u / n, m.z), this.generateArc(M, e, new BABYLON.Vector3(m.x + c, m.y + u - 2 * S * u / n, m.z), new BABYLON.Vector3(T[3 * S], T[3 * S + 1], T[3 * S + 2] + s / 2), new BABYLON.Vector3(T[3 * S], T[3 * S + 1], T[3 * S + 2])), M.push(T[3 * S], T[3 * S + 1], T[3 * S + 2]), this.generateArc(M, e, new BABYLON.Vector3(T[3 * S], T[3 * S + 1], T[3 * S + 2]), new BABYLON.Vector3(T[3 * S], T[3 * S + 1], T[3 * S + 2] - s / 2), new BABYLON.Vector3(d.x + c, d.y + u - 2 * S * u / n, d.z)), M.push(d.x + c, d.y + u - 2 * S * u / n, d.z), M.push(d.x, d.y, d.z);
        T = [x.x, x.y, x.z], this.generateArc(T, n, x, f, v);
        for (var S = 0; n > S; S++)
            M.push(m.x, m.y, m.z), M.push(m.x + c - 2 * S * c / n, m.y - u, m.z), this.generateArc(M, e, new BABYLON.Vector3(m.x + c - 2 * S * c / n, m.y - u, m.z), new BABYLON.Vector3(T[3 * S], T[3 * S + 1], T[3 * S + 2] + s / 2), new BABYLON.Vector3(T[3 * S], T[3 * S + 1], T[3 * S + 2])), M.push(T[3 * S], T[3 * S + 1], T[3 * S + 2]), this.generateArc(M, e, new BABYLON.Vector3(T[3 * S], T[3 * S + 1], T[3 * S + 2]), new BABYLON.Vector3(T[3 * S], T[3 * S + 1], T[3 * S + 2] - s / 2), new BABYLON.Vector3(d.x + c - 2 * S * c / n, d.y - u, d.z)), M.push(d.x + c - 2 * S * c / n, d.y - u, d.z), M.push(d.x, d.y, d.z);
        T = [v.x, v.y, v.z], this.generateArc(T, n, v, y, _);
        for (var S = 0; n > S; S++)
            M.push(m.x, m.y, m.z), M.push(m.x - c, m.y - u + 2 * S * u / n, m.z), this.generateArc(M, e, new BABYLON.Vector3(m.x - c, m.y - u + 2 * S * u / n, m.z), new BABYLON.Vector3(T[3 * S], T[3 * S + 1], T[3 * S + 2] + s / 2), new BABYLON.Vector3(T[3 * S], T[3 * S + 1], T[3 * S + 2])), M.push(T[3 * S], T[3 * S + 1], T[3 * S + 2]), this.generateArc(M, e, new BABYLON.Vector3(T[3 * S], T[3 * S + 1], T[3 * S + 2]), new BABYLON.Vector3(T[3 * S], T[3 * S + 1], T[3 * S + 2] - s / 2), new BABYLON.Vector3(d.x - c, d.y - u + 2 * S * u / n, d.z)), M.push(d.x - c, d.y - u + 2 * S * u / n, d.z), M.push(d.x, d.y, d.z);
        for (var L = 4 * n, O = 2 * e + 3, S = 0; L - 1 > S; S++)
            for (var P = 0; O - 2 > P; P++)
                D.push((S + 1) * O + P, S * O + P + 1, (S + 1) * O + P + 1), D.push(S * O + P + 1, S * O + P + 2, (S + 1) * O + P + 1), 0 == P && B.push((S + 1) * O + P, S * O + P + 1, (S + 1) * O + P + 1), P == O - 3 && B.push(S * O + P + 1, S * O + P + 2, (S + 1) * O + P + 1);
        for (var P = 0; O - 2 > P; P++)
            D.push((L - 1) * O + P + 1, P + 1, (L - 1) * O + P), D.push((L - 1) * O + P + 1, P + 2, P + 1);
        var I = new BABYLON.Mesh(t, h);
        return BABYLON.VertexData.ComputeNormals(M, D, A), (c || u) && BABYLON.Mesh.ComputeFlatNormal(M, A, B), E = BABYLON.Tools.PlaneUVProjection(M, new BABYLON.Vector3(1, 0, 0), new BABYLON.Vector3(0, 1, 0)), I.setVerticesData(BABYLON.VertexBuffer.PositionKind, M, C), I.setVerticesData(BABYLON.VertexBuffer.NormalKind, A, C), I.setVerticesData(BABYLON.VertexBuffer.UVKind, E, C), I.setIndices(D), I
    }, this.createRoundedAngle = function(t, e, n, i, o, r, s) {
        var a = [], n = n || 1, e = e || 10;
        return this.generateVasqueStrate(a, 0, i, r, o / 2, n, e), this.generateVasqueStrate(a, 0, i, r, o / 2, n, e), this.generateVasqueStrate(a, 0, i, r, -o / 2, n, e), this.generateVasqueStrate(a, 1, i, r, -o / 2, n, e), GeometryHelper.generateStrateFacesForGeometry(t, a, 8 + 4 * (e - 1), !0, !0, s, void 0, !0)
    }, this.createRoundedBloc = function(t, e, n, i, o, r, s, a) {
        var l = [], i = i || .1, e = e || 10, h = 0, c = i / n, u = o, p = s, d = r / 2 + i;
        this.generateVasqueStrate(l, ++h, u, p, d, .1, e);
        for (var m = c; i >= m; m += c) {
            var g = i * Math.sin(m / i * Math.PI / 2);
            this.generateVasqueStrate(l, ++h, u + 2 * g, p + 2 * g, d - i * (1 - Math.cos(m / i * Math.PI / 2)), g, e)
        }
        for (var m = i; m > 0; m -= c) {
            var g = i * Math.sin(m / i * Math.PI / 2);
            this.generateVasqueStrate(l, ++h, u + 2 * g, p + 2 * g, -d + i * (1 - Math.cos(m / i * Math.PI / 2)), g, e)
        }
        this.generateVasqueStrate(l, ++h, u, p, -d, .1, e);
        var l = GeometryHelper.generateStrateFacesForGeometry(t, l, 8 + 4 * (e - 1), !0, !0, a, void 0, !0);
        return this.giftWraper(l, 128, !0), l
    }, this.generateEllispeStrate = function(t, e, n, i, o, r) {
        var s = 2 * Math.PI / e;
        if (r) {
            for (var a = 0; a < Math.PI; a += s) {
                var l = n * Math.cos(a), h = n * Math.sin(a) + i - n;
                t.push(l, o, h)
            }
            for (var a = Math.PI; a < 2 * Math.PI; a += s) {
                var l = n * Math.cos(a), h = n * Math.sin(a) - i + n;
                t.push(l, o, h)
            }
        } else
            for (var a = 0; a < 2 * Math.PI; a += s) {
                var l = n * Math.cos(a), h = i * Math.sin(a);
                t.push(l, o, h)
            }
    }, this.createEllispeTable = function(t, e, n, i, o, r, s) {
        var a = [], e = e || 10;
        return this.generateEllispeStrate(a, e, n, i, -o / 2, s), this.generateEllispeStrate(a, e, n, i, -o / 2, s), this.generateEllispeStrate(a, e, n, i, o / 2, s), this.generateEllispeStrate(a, e, n, i, o / 2, s), GeometryHelper.generateStrateFacesForGeometry(t, a, e + 1, !0, !0, r, void 0, !0)
    }
};
var GlobalHelper = function() {
    function t() {
        if (hcsdesign && hcsdesign.engine3D)
            return hcsdesign.engine3D.engine._gl;
        var t = document.createElement("canvas");
        return t.getContext("webgl") || t.getContext("experimental-webgl")
    }
    var e = {}, n = null, i = !!navigator.userAgent.match(/Android/i), o = i && !!navigator.userAgent.match(/GT-/i), r = !!navigator.userAgent.match(/iPhone|iPad|iPod/i), s = !!navigator.userAgent.match(/trident.*(Windows Phone|NOKIA)/i), a = !!navigator.userAgent.match(/trident.*(arm|tablet|Windows Phone|NOKIA)/i), l = i || r || a, h = /fr/i.test(navigator.language || navigator.languages || navigator.userLanguage || navigator.systemLanguage || "en");
    return e.getCapabilities = function() {
        if (null === n) {
            n = {maxTextureSize: 512,maxCubemapTextureSize: 512,extensions: {}};
            var e = ["EXT_texture_filter_anistrotropic", "OES_element_index_uint", "OES_standard_derivatives", "OES_texture_float", "OES_texture_float_linear", "OES_texture_half_float", "OES_texture_half_float_linear", "OES_vertex_array_object", "WEBGL_compressed_texture_s3tc", "WEBGL_lose_context", "WEBGL_debug_renderer_info"], i = t();
            if (i) {
                for (var o = 0, r = e.length; r > o; o++) {
                    for (var s = e[o].split("_"), a = s[1], l = 2, h = s.length; h > l; l++)
                        a += s[l].replace(s[l][0], s[l][0].toUpperCase());
                    n.extensions[a] = i.getExtension(e[o]) ? !0 : !1
                }
                n.maxTextureSize = i.getParameter(i.MAX_TEXTURE_SIZE), n.maxCubemapTextureSize = i.getParameter(i.MAX_CUBE_MAP_TEXTURE_SIZE)
            }
        }
        return n
    }, e.getWrappedMouseEventNames = function() {
        return "ontouchstart" in window ? {down: "touchstart",move: "touchmove",up: "touchend",cancel: "touchcancel"} : {down: "pointerdown",move: "pointermove",up: "pointerup",cancel: "pointercancel",out: "pointerout"}
    }, e.hasWebGL = function() {
        return t() ? !0 : !1
    }, e.hasCanvas2D = function() {
        return window.HTMLCanvasElement
    }, e.hasAzertyKeyboard = function() {
        return h
    }, e.isMobileDevice = function() {
        return l
    }, e.isAndroidDevice = function() {
        return i
    }, e.isAppleDevice = function() {
        return r
    }, e.isSamsungDevice = function() {
        return o
    }, e.isWindowsDevice = function() {
        return a
    }, e.isWindowsPhoneDevice = function() {
        return s
    }, e.isIE = function() {
        var t = navigator.userAgent.toLowerCase();
        return -1 != t.indexOf("msie") ? parseInt(t.split("msie")[1]) : -1
    }, e.isIE9 = function() {
        return "Explorer" === BrowserDetect.browser && 9 === BrowserDetect.version
    }, e.isIE10 = function() {
        return "Explorer" === BrowserDetect.browser && 10 === BrowserDetect.version
    }, e.createScreenshot3D = function(t, e, n) {
        var i = document.createElement("canvas"), e = e || {width: window.innerWidth,height: window.innerHeight}, o = new BABYLON.RenderTargetTexture("screenShot", e, t.scenes[0]);
        o.renderList = t.scenes[0].meshes, o.onAfterRender = function() {
            for (var o = 4 * e.width, r = e.height / 2, s = t.readPixels(0, 0, e.width, e.height), a = 0; r > a; a++)
                for (var l = 0; o > l; l++) {
                    var h = l + a * o, c = e.height - a - 1, u = l + c * o, p = s[h];
                    s[h] = s[u], s[u] = p
                }
            i.width = e.width, i.height = e.height;
            var d = i.getContext("2d"), m = d.createImageData(i.width, i.height);
            m.data.set(s), d.putImageData(m, 0, 0), n(i)
        }, o.render(), o.dispose()
    }, e.__forceMobileDevice = function(t) {
        l = t
    }, e.stripDomainUrl = function(t, e) {
        if (t && -1 !== t.indexOf("http://") && -1 !== t.indexOf(e)) {
            var n = t.replace("http://", "").split("/");
            t = t.replace("http://" + n[0], "/"), t = t.split("///").join("//"), t = t.split("//").join("/")
        }
        return t
    }, e
}();
var HTMLHelper = function() {
    var t = {};
    return t.insertHTML = function(t, e, n, i) {
        var o = e, n = "function" == typeof n ? n : function() {
        }, i = "function" == typeof i ? i : function() {
        };
        "string" == typeof e && (o = document.getElementById(e)), ujs.ajax({method: "GET",url: t + "?t=" + Math.round(100 * Math.random()),success: function(t) {
                                                                           o.innerHTML = t, n()
                                                                           },onerror: i})
    }, t.addScript = function(t, e, n, i) {
        var n = "function" == typeof n ? n : function() {
        }, i = "function" == typeof i ? i : function() {
        }, o = document.createElement("script");
        if (o.addEventListener("load", n, !1), o.addEventListener("error", i, !1), o.setAttribute("src", t), e)
            for (var r in e)
                o.setAttribute(r, e[r]);
        var s = document.getElementById("scripts");
        s.appendChild(o)
    }, t.addStylesheet = function(t, e, n, i) {
        var n = "function" == typeof n ? n : function() {
        }, i = "function" == typeof i ? i : function() {
        }, o = document.createElement("link");
        if (o.addEventListener("load", n, !1), o.addEventListener("error", i, !1), o.setAttribute("rel", "stylesheet"), o.setAttribute("href", t), e)
            for (var r in e)
                o.setAttribute(r, e[r]);
        var s = document.getElementsByTagName("head")[0];
        s.appendChild(o)
    }, t.hide3DMenus = function(t) {
        var t = t || "none", e = document.getElementById("decorate3D"), n = document.getElementById("furnishing3D");
        e && (e.style.display = t), n && (n.style.display = t)
    }, t.simulateKey = function(t, e, n) {
        var i = "string" == typeof e ? "key" + e : "keydown", n = n || {}, o = {keyCode: t};
        for (var r in n)
            o[r] = n[r];
        ujs.notify(i, o)
    }, t.simulateClick = function(t, e, n, i, o, r) {
        var s = document.createEvent("MouseEvent");
        s.initEvent(i || "mousedown"), s.clientX = s.layerX = s.pageX = s.screenX = s.x = 0 | +e, s.clientX = s.layerY = s.pageY = s.screenY = s.y = 0 | +n, s.button = 0 | +o, s.detail = s.wheelDeltaY = s.wheelDelta = 0 | +r, t.dispatchEvent(s)
    }, t
}();
var hcs = window.hcs || {};
hcs.Symbols2D = function() {
    var t = function() {
        this.COLOR_ACTIVE_STROKE = "#897364", this.COLOR_ACTIVE_STROKE_DARKER = "#A99384", this.COLOR_ACTIVE_FILL = "rgba(137, 115, 100, 0.2)", this.COLOR_ACTIVE_LARGEZONE_FILL = "rgba(137, 137, 137, 0.5)", this.COLOR_INACTIVE_STROKE = "#777777", this.COLOR_INACTIVE_FILL = "rgba(137, 115, 100, 0.1)", this.COLOR_BACKGROUND = "#FAFAFA", this.COLOR_ANNOTATION = "#888"
    };
    return t.prototype.drawPoint = function(t, e) {
        t.save(), t.fillStyle = this.COLOR_ACTIVE_STROKE, t.beginPath(), t.arc(e.x, e.y, 6, 0, 2 * Math.PI, !1), t.fill(), t.restore()
    }, t.prototype.drawPointHover = function(t, e, n) {
        var n = n || 1;
        t.save(), this.drawPoint(t, e), t.strokeStyle = this.COLOR_ACTIVE_STROKE, t.lineWidth = 4, t.beginPath();
        var i = 12 * n;
        10 > i && (i = 10), t.arc(e.x, e.y, i, 0, 2 * Math.PI, !1), t.stroke(), t.restore()
    }, t.prototype.drawAngle = function(t, e, n, i, o, r, s) {
        t.save(), t.fillStyle = this.COLOR_ACTIVE_LARGEZONE_FILL, t.strokeStyle = this.COLOR_ACTIVE_STROKE, t.beginPath(), t.moveTo(e.x, e.y), t.arc(e.x, e.y, i, o, r, s), t.lineTo(e.x, e.y), t.fill(), t.stroke(), t.font = "normal 8pt sans-serif", t.textBaseline = "middle", t.textAlign = "center";
        var a = {x: e.x + i * Math.cos((r + o) / 2),y: e.y + i * Math.sin((r + o) / 2)}, l = Math.round(180 * Math.abs(r - o) / Math.PI) + " °";
        t.fillStyle = this.COLOR_BACKGROUND, t.beginPath(), t.arc(a.x, a.y, t.measureText(l).width / 2 + 2, 0, 2 * Math.PI), t.fill(), t.stroke(), t.fillStyle = this.COLOR_ANNOTATION, t.fillText(l, a.x, a.y), t.restore()
    }, t.prototype.drawSegment = function(t, e, n) {
        e.x = Math.round(e.x) + .5, e.y = Math.round(e.y) + .5, n.x = Math.round(n.x) + .5, n.y = Math.round(n.y) + .5, t.save(), t.strokeStyle = this.COLOR_ACTIVE_STROKE, t.fillStyle = this.COLOR_ACTIVE_STROKE, t.lineWidth = 5, this.drawPoint(t, e), this.drawPoint(t, n), t.beginPath(), t.moveTo(e.x, e.y), t.lineTo(n.x, n.y), t.stroke(), t.restore()
    }, t.prototype.drawArc = function(t, e, n, i) {
        e.x = Math.round(e.x) + .5, e.y = Math.round(e.y) + .5, i.x = Math.round(i.x) + .5, i.y = Math.round(i.y) + .5, n.x = Math.round(n.x) + .5, n.y = Math.round(n.y) + .5, t.save(), t.strokeStyle = this.COLOR_ACTIVE_STROKE, t.fillStyle = this.COLOR_ACTIVE_STROKE, t.lineWidth = 5, this.drawPoint(t, e), this.drawPoint(t, i), t.beginPath(), t.moveTo(e.x, e.y), t.quadraticCurveTo(n.x, n.y, i.x, i.y), t.stroke(), t.restore()
    }, t.prototype.drawGrip = function(t, e, n, i) {
        var i = i || 0;
        e.x = Math.round(e.x), e.y = Math.round(e.y), t.save(), t.strokeStyle = this.COLOR_ACTIVE_STROKE, t.fillStyle = this.COLOR_BACKGROUND, t.lineWidth = 2, t.translate(e.x, e.y), t.beginPath(), t.arc(0, 0, 9, 0, 2 * Math.PI, !1), t.fill(), t.stroke(), this.drawArrows(t, {x: 0,y: 0}, n, 12, i), t.restore()
    }, t.prototype.drawCheckGrip = function(t, e, n, i) {
        var i = i || 0;
        e.x = Math.round(e.x), e.y = Math.round(e.y), t.save(), t.translate(e.x, e.y), t.strokeStyle = this.COLOR_BACKGROUND, t.fillStyle = this.COLOR_INACTIVE_STROKE, t.lineWidth = 2, t.beginPath(), t.arc(0, 0, 11, 0, 2 * Math.PI, !1), t.fill(), t.stroke(), t.save(), t.fillStyle = this.COLOR_BACKGROUND, t.rotate(Math.PI / 4), t.fillRect(-5, 2, 5, 4), t.rotate(Math.PI / 2), t.fillRect(-7, -3, 13, 4), t.restore(), this.drawArrows(t, {x: 0,y: 0}, n, 12, i), t.restore()
    }, t.prototype.drawCancelGrip = function(t, e, n, i) {
        var i = i || 0;
        e.x = Math.round(e.x), e.y = Math.round(e.y), t.save(), t.translate(e.x, e.y), t.strokeStyle = this.COLOR_BACKGROUND, t.fillStyle = this.COLOR_INACTIVE_STROKE, t.lineWidth = 2, t.beginPath(), t.arc(0, 0, 11, 0, 2 * Math.PI, !1), t.fill(), t.stroke(), t.save(), t.fillStyle = this.COLOR_BACKGROUND, t.rotate(Math.PI / 4), t.fillRect(-7, -2, 14, 4), t.rotate(Math.PI / 2), t.fillRect(-7, -2, 14, 4), t.restore(), this.drawArrows(t, {x: 0,y: 0}, n, 12, i), t.restore()
    }, t.prototype.drawGripSegment = function(t, e, n, i, o, r) {
        var r = r || 0;
        e.x = Math.round(e.x) + .5, e.y = Math.round(e.y) + .5, n.x = Math.round(n.x) + .5, n.y = Math.round(n.y) + .5, t.save(), t.strokeStyle = this.COLOR_ACTIVE_STROKE, t.fillStyle = this.COLOR_ACTIVE_STROKE, t.lineWidth = 5, t.beginPath(), t.moveTo(e.x, e.y), t.lineTo(n.x, n.y), t.stroke(), this.drawGrip(t, e, i, r), this.drawGrip(t, n, o, r), t.restore()
    }, t.prototype.drawArrows = function(t, e, n, o, r, s, a) {
        var a = a || {}, l = a.size || 6, r = r || 0;
        for (t.save(), t.translate(e.x, e.y), t.rotate(r), t.fillStyle = this.COLOR_ACTIVE_STROKE, t.strokeStyle = this.COLOR_BACKGROUND, t.lineWidth = 2, i = 0; 4 > i; i++)
            n[i] && (t.beginPath(), t.moveTo(0, -o - l), t.lineTo(-l, -o), t.lineTo(l, -o), t.closePath(), s && t.stroke(), t.fill()), t.rotate(Math.PI / 2);
        t.restore()
    }, t.prototype.drawMeasure = function(t, e, n, i, o) {
        t.save(), t.strokeStyle = o || this.COLOR_ANNOTATION, t.fillStyle = o || this.COLOR_ANNOTATION, t.lineWidth = 1, t.font = "normal 8pt sans-serif", t.textBaseline = "middle", t.textAlign = "center";
        var r = n.x > e.x ? n.x - e.x : e.x - n.x, s = n.y > e.y ? n.y - e.y : e.y - n.y, a = Math.sqrt(Math.pow(r, 2) + Math.pow(s, 2)), l = Math.atan2(n.y - e.y, n.x - e.x), h = i ? t.measureText(i).width + 10 : 0;
        h > a - 2 || (t.translate(Math.round((e.x + n.x) / 2), Math.round((e.y + n.y) / 2)), t.rotate(l), t.beginPath(), (a - h) / 2 > 5 && (t.moveTo(-Math.round(a / 2), .5), t.lineTo(-Math.round(h / 2) + 1, .5), t.moveTo(Math.round(a / 2), .5), t.lineTo(Math.round(h / 2) - 1, .5)), t.save(), t.translate(-Math.round(a / 2), 0), t.moveTo(.5, .5), t.lineTo(5, 5), t.moveTo(.5, .5), t.lineTo(5, -4), t.stroke(), t.restore(), t.save(), t.translate(Math.round(a / 2), 0), t.moveTo(-.5, .5), t.lineTo(-5, 5), t.moveTo(-.5, .5), t.lineTo(-5, -4), t.restore(), t.stroke(), i && ((l >= Math.PI / 2 || l < -Math.PI / 2) && t.rotate(Math.PI), t.fillText(i, 0, -.5)), t.restore())
    }, t.prototype.drawCursorCheck = function(t, e) {
        var n = e.x + 20, i = e.y + 20;
        t.save(), t.translate(n, i), t.fillStyle = "rgba(0,0,0,.2)", t.rotate(Math.PI / 4), t.fillRect(-6, 2, 7, 6), t.rotate(Math.PI / 2), t.fillRect(-7, -5, 15, 6), t.restore(), t.save(), t.translate(n, i), t.fillStyle = this.COLOR_ACTIVE_STROKE_DARKER, t.fillStyle = "#000", t.rotate(Math.PI / 4), t.fillRect(-7, 1, 7, 6), t.rotate(Math.PI / 2), t.fillRect(-8, -4, 15, 6), t.restore(), t.save(), t.translate(n, i), t.fillStyle = this.COLOR_BACKGROUND, t.rotate(Math.PI / 4), t.fillRect(-6, 2, 6, 4), t.rotate(Math.PI / 2), t.fillRect(-7, -3, 13, 4), t.restore()
    }, t.prototype._drawAllSymbols = function(t) {
        this.drawPoint(t, {x: 100,y: 100}), this.drawPointHover(t, {x: 150,y: 100}), this.drawPointHover(t, {x: 200,y: 100}, 1.5), this.drawSegment(t, {x: 250,y: 90}, {x: 300,y: 110}), this.drawGrip(t, {x: 350,y: 100}, [!0, !0, !0, !0]), this.drawGrip(t, {x: 400,y: 100}, [!1, !0, !1, !0], Math.PI / 4), this.drawCheckGrip(t, {x: 450,y: 100}, [!0, !0, !0, !0]), this.drawCancelGrip(t, {x: 500,y: 100}, [!1, !0, !1, !0], 3 * Math.PI / 4), this.drawGripSegment(t, {x: 550,y: 90}, {x: 600,y: 110}, [!1, !1, !1, !0], [!1, !0, !1, !1], .4), this.drawMeasure(t, {x: 650,y: 80}, {x: 750,y: 80}, "measure"), this.drawMeasure(t, {x: 650,y: 100}, {x: 715,y: 100}, "measure"), this.drawMeasure(t, {x: 650,y: 120}, {x: 706,y: 120}, "measure"), this.drawCursorCheck(t, {x: 100,y: 150})
    }, t
}();
var hcs = window.hcs || {};
hcs.uuid = function() {
    function t() {
        return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, function(t) {
                                                              var e = 16 * Math.random() | 0, n = "x" == t ? e : 3 & e | 8;
                                                              return n.toString(16)
                                                              })
    }
    return {uuid4: t}
}();
var hcs = window.hcs || {};
hcs.Dummy = {Engine3D: function(t) {
    var e = function() {
        return null
    };
    this.dummy = !0, this._components = [], this.removeComponent = e, this.searchComponent = e, this.initialize = e, this.update = e, this.draw = e, this.resize = e, this.setEnabled = e, this.canvas = document.createElement("canvas"), this.castShadows = e, this.uncastShadows = e;
    var n = this;
    this.engine = {_caps: {},_gl: null,_renderingCanvas: n.canvas,getRenderingCanvas: function() {
        return n.canvas
    },createRenderTargetTexture: function() {
    },getLoadedTexturesCache: function() {
        return []
    },createVertexBuffer: e,createIndexBuffer: e,createTexture: e,createCubeTexture: e,createDynamicVertexBuffer: e,createEffect: e,scenes: []}, this.addComponent = function() {
        return {}
    }, this.scene = {materials: [],textures: [],meshes: [],cameras: [],spriteManagers: [],getMeshByName: e,getRenderId: function() {
        return 0
    },getEngine: function() {
        return n.engine
    }}, this.scenes = [this.scene], this.getContainer = function() {
        return t
    }
}};
var hcs = window.hcs || {};
hcs.Assets = {
    globalPath: "",
    metalTextures: {
    diffuse: "textures/metal/metal_DIFFUSE.png",
        normal: "textures/metal/metal_NORMAL.png",
        specular: "textures/metal/metal_SPECULAR.png"
    },
    woodTextures: {
        diffuse: "textures/bois/bois_DIFFUSE.png",
        normal: "textures/bois/bois_NORMAL.png",
        specular: "textures/bois/bois_SPECULAR.png"
    },
    plasticTextures: {
        diffuse: "textures/plastique/plastique_DIFFUSE.png",
        normal: "textures/plastique/plastique_NORMAL.png",
        specular: "textures/plastique/plastique_SPECULAR.png"
    },
    whiteTexture: "textures/misc/white.jpg",
    blackTexture: "textures/misc/black.jpg",
    transparentTexture: "textures/misc/transparent.png",
    shadowTexture: "textures/shadow/shadow.png",
    roomTextures: {
        diffuse: "textures/parquet/parquet_DIFFUSE.png",
        normal: "textures/parquet/parquet_NORMAL.png",
        specular: "textures/parquet/parquet_SPEC.png"
    },
    firePlaceFire: "textures/fireplace/fireplace_tex.png",
    firePlaceBrick: {
        diffuse: "textures/fireplace/fire_place_brick.png",
        normal: "textures/fireplace/fire_place_brick_normals.png",
        specular: "textures/fireplace/fire_place_brick_spec.png"
    },
    firePlaceBrick2: {
        diffuse: "textures/textureset/brick/brick05.jpg",
        normal: "textures/textureset/brick/brick05_NORM.jpg",
        specular: "textures/textureset/brick/brick05_SPEC.jpg"
    },
    firePlacePlate: {
        diffuse: "textures/fireplace/fireplace_plate_tex.png",
        normal: "textures/fireplace/fireplace_plate_tex_normals.png",
        specular: "textures/fireplace/fireplace_plate_tex_spec.png"
    },
    induction: {
        map: "textures/misc/induction.jpg"
    },
    dishwasher: {
        map: "textures/misc/lavevaisselle.jpg"
    },
    hood: {
        map: "textures/misc/hotte.png"
    },
    oven: {
        map: "textures/misc/oven.png"
    },
    microwave: {
        map: "textures/misc/microwave.png"
    },
    firePlaceWood: {
        diffuse: "textures/fireplace/fireplace_wood.png",
        normal: "textures/fireplace/fireplace_wood_normals.png",
        specular: "textures/fireplace/fireplace_wood_spec.png"
    },
    envMapTexture: "textures/environment/SwedishRoyalCastle/src",
    flatEnvMapTexture: "textures/environment/flatInterior/flat",
    skyEnvMapTexture: "textures/environment/sky.jpg",
    toolbarTextures: {
        infoTexture: "textures/toolbar/info.png",
        infoTextureGroup: "textures/toolbar/infoGroup.png",
        rotateTexture: "textures/toolbar/rotate.png",
        arrowTexture: "textures/toolbar/arrow.png"
    },
    mattTexture: "textures/misc/CNPflat_tex.png",
    darkWoodTextures: {
        diffuse: "textures/wood/dark-wood1.png",
        normal: "textures/wood/dark-wood1_NORM.png",
        specular: "textures/wood/dark-wood1_SPEC.png"
    },
    bedSheetsTextures: {
        diffuse: "textures/bed/sheets.png",
        normal: "textures/bed/sheets_NORM.png",
        specular: "textures/bed/sheets_SPEC.png"
    },
    cromwellTextures: {
        diffuse: "models/babylon/chair/cromwell/cromwell_diff.png",
        normal: "models/babylon/chair/cromwell/cromwell_normals.png",
        specular: "models/babylon/chair/cromwell/cromwell_specular.png"
    },
    cushionTexture: "textures/bed/cushion-test3.png",
    vasqueDAE: "models/babylon/bathroom/components/vasque_s",
    doucheDAE: "models/babylon/bathroom/shower1/shower1.babylon",
    robinetDAE: "models/babylon/robinet/robinet.babylon",
    spotLampDAE: "models/babylon/lamps/lamp2/spot.babylon",
    robinet3DAE: "models/babylon/robinet/robinet3.babylon",
    robinet4DAE: "models/babylon/robinet/robinet4.babylon",
    robinet5DAE: "models/babylon/robinet/tap.babylon",
    boconceptfeetDAE: "models/babylon/table/boconcept/bocpart.babylon",
    ovaletableDAE: "models/babylon/table/ovale/ovale.babylon",
    cromwellleftsideDAE: "models/babylon/chair/cromwell/cromwell_leftside.babylon",
    cromwelrightsideDAE: "models/babylon/chair/cromwell/cromwell_rightside.babylon",
    cromwellcenterDAE: "models/babylon/chair/cromwell/cromwell_center.babylon",
    DaePath: "models/babylon/",
    retrieveImageScriptPath: "php/retrieveImage.php",
    retrieveObjectScriptPath: "php/retrieveObject.php",
    remote: {
        man: "images/remote-controller/green_man.png",
        cam: "images/remote-controller/green_cam.png",
        bg: "images/remote-controller/bg.png"
    },
    mainUIColor: "#897364",
    complementaryUIColor: "#897364",
    groupColor: "#897364"
};
var hcs = window.hcs || {};
hcs.AnimationHandler = function() {
    var t = function() {
    };
    t.LINEAR = 0, t.SMOOTH = 1;
    var e = -1, n = -1, i = [], o = 0, r = function(e, n, i, r) {
        this.running = !1, this.startTime = null, this.lastTime = null, this.endTime = null, this.duration = n || -1, this.speeds = null, this.target = e || null, this.properties = i || null, this.interpolationMethod = void 0 !== r && null !== r ? r : t.LINEAR, this.id = o++, this.computeSpeeds()
    };
    return r.prototype.computeSpeeds = function() {
        if (this.properties) {
            this.speeds = {};
            for (var t in this.properties)
                this.speeds[t] = (this.properties[t].end - this.properties[t].start) / this.duration
                }
    }, r.prototype.start = function() {
        this.running = !0, this.startTime = (new Date).getTime()
    }, r.prototype.stop = function() {
        this.running = !1, this.endTime = (new Date).getTime(), this.startTime = null
    }, t.Create = function(t, e, n, o) {
        var s = new r(t, e, n, o);
        return i.push(s), s
    }, t.GetAnimations = function() {
        return i
    }, t.GetAnimation = function(t) {
        for (var e = 0, n = i.length; n > e; e++)
            if (i[e].id === t)
                return i[e];
        return Logger.warning("No animation found with this id"), null
    }, t.Dispose = function(t) {
        for (var e = 0, n = i.length; n > e; e++)
            if (i[e].id === t)
                return void i.splice(e, 1)
                }, t.ClearAll = function() {
                    i.length = 0
                }, t.Process = function() {
                    e = (new Date).getTime();
                    for (var n = 0, o = i.length; o > n; n++)
                        t.ProcessAnimation(i[n])
                        }, t.ProcessAnimation = function(t) {
                            if (t.running) {
                                n = e - (t.lastTime || t.startTime), t.lastTime = e;
                                for (var i in t.properties)
                                    t.properties[i].callback ? t.properties[i].callback((e - t.startTime) * t.speeds[i] + t.properties[i].start) : t.target[i] += n * t.speeds[i];
                                e - t.startTime >= t.duration && t.stop()
                            }
                        }, t
}();

var hcs = window.hcs || {};
hcs.Constants = {
    VERSION: "1.2.0.0",
    BACK_URL: "",
    WNP_URL: "",
    MIGRATION_PATH: "migration/plan?json=",
    ENGINE_2D: 1,
    ENGINE_3D: 2,
    MODE_STANDALONE: 0,
    MODE_CUSTOMER: 1,
    LANG: "en",
    LOCAL_STORAGE_STRUCTURE_KEY: "wanadev.planner.structure",
    LC_REM_LOGIN_KEY: "wanadev.planner.remember",
    LC_REM_CRYPT_KEY: "wanadev",
    LC_LANG_KEY: "wanadev.planner.lang",
    LC_MAC_GL_CHECK: "wanadev.planner.macosx.check",
    PRODUCTS_PATH: "data/products/",
    TEMPLATE_PATH: "js/Core/UI/Templates/",
    PROGRAMMABLE_PATH: "js/Components/CoreComponents/Object/Programmable",
    GRAPHICS_FAST: 0,
    GRAPHICS_GOOD: 1,
    GRAPHICS_QUALITY: 2,
    MAGNETISM: {
        NONE: 0,
        WALL: 1,
        OBJECT: 2,
        VERTICAL: 4
    },
    PRODUCTS_FILE: "data/products.json",
    PRODUCTS_PREVIEWS: "models/previews/"
}, hcs.Constants.MAGNETISM.DEFAULT = hcs.Constants.MAGNETISM.WALL | hcs.Constants.MAGNETISM.OBJECT | hcs.Constants.MAGNETISM.VERTICAL;
var hcs = window.hcs || {};
hcs.CameraFeatures = function() {
    var t = null, e = function() {
        this.camera = void 0, this.wallTransparency = !1, document.addEventListener("hcs.engine3D.camera.move", this.onCameraMove.bind(this), !1), document.addEventListener("hcs.engine3D.camera.zoom", this.onCameraZoom.bind(this), !1), document.addEventListener("hcs.engine3d.subslopeOverturesReady", this.onWallsReady.bind(this), !1), document.addEventListener("hcs.contextChanged", this.onContextChanged.bind(this), !1), document.addEventListener("hcs.engine3d.globaleFloorReady", this.onGlobaleFloorReady.bind(this), !1)
    };
    e.prototype.setCamera = function(t) {
        this.camera = t
    }, e.prototype.onCameraMove = function() {
        this.wallTransparency && this.dynamicWallTransparency()
    }, e.prototype.onCameraZoom = function() {
        this.wallTransparency && this.dynamicWallTransparency()
    }, e.prototype.onWallsReady = function() {
        hcsdesign.getSelectedEngine() === hcsdesign.ENGINE_3D && this.wallTransparency && this.dynamicWallTransparency()
    }, e.prototype.stopTransparency = function() {
        t = t || hcsdesign.getComponentByName("WallComponent3D");
        for (var e, i = hcsdesign.getSelectedStructure(), o = t.get3DWallFrom2D(i), r = 0, s = o.material.subMaterials.length; s > r; r++)
            if (e = o.material.subMaterials[r], e.opacitySwitched) {
                if (o.objectInstances[r] && ("OvertureStructure" == o.objectInstances[r].name || "SubSlopeOvertureStructure" == o.objectInstances[r].name) && o.objectInstances[r].programmableInstance)
                    for (var a in o.objectInstances[r].programmableInstance.materials)
                        o.objectInstances[r].programmableInstance.materials.hasOwnProperty(a) && n(o.objectInstances[r].programmableInstance.materials[a]);
                n(e)
            }
        this.wallTransparency = !1
    }, e.prototype.startTransparency = function() {
        this.dynamicWallTransparency(), this.wallTransparency = !0
    }, e.prototype.buildPlaneFromBB = function(t) {
        var e = t.center, n = -t.angle, i = new BABYLON.Vector3(Math.sin(n), 0, -Math.cos(n));
        return BABYLON.Plane.FromPositionAndNormal(e, i)
    }, e.prototype.fillByZIndex = function(t) {
        {
            var e, n, i, o = {}, r = this.camera.target.clone(), s = new BABYLON.Ray(this.camera.position, r.subtract(this.camera.position).normalize());
            new BABYLON.Vector3
        }
        o[0] = !0, o[1] = !0;
        for (var a in t.subMeshes)
            e = t.boundingBoxes[a], e ? (n = this.buildPlaneFromBB(e), i = s.distanceToPlane(n), null !== i && i <= r.distanceTo(this.camera.position) && (o[a] = !0)) : "top" == t.material.subMaterials[a].name ? o[a] = !0 : t.objectInstances[a] && "SubSlopeOvertureStructure" == t.objectInstances[a].name && (o[a] = !0);
        return o
    };
    var n = function(t, e) {
        var n = void 0 !== t.alternativeOpacity ? t.alternativeOpacity : e;
        t.alternativeOpacity = t.alpha, t.alpha = n, t.opacitySwitched = !t.opacitySwitched, t.transparent = 1 != t.alpha
    };
    e.prototype.dynamicWallTransparency = function() {
        t = t || hcsdesign.getComponentByName("WallComponent3D");
        var e = hcsdesign.getSelectedStructure(), i = t.get3DWallFrom2D(e);
        if (i)
            for (var o, r = this.fillByZIndex(i), s = 0, a = i.subMeshes.length; a > s; s++)
                if (o = i.material.subMaterials[i.subMeshes[s].materialIndex], o.opacitySwitched && !r[i.subMeshes[s].materialIndex] || !o.opacitySwitched && r[i.subMeshes[s].materialIndex])
                    if (1 == s)
                        n(o, 0);
                    else {
                        if (i.objectInstances[s] && ("OvertureStructure" == i.objectInstances[s].name || "SubSlopeOvertureStructure" == i.objectInstances[s].name) && i.objectInstances[s].programmableInstance)
                            for (var l in i.objectInstances[s].programmableInstance.materials)
                                i.objectInstances[s].programmableInstance.materials.hasOwnProperty(l) && n(i.objectInstances[s].programmableInstance.materials[l], .2);
                        n(o, .2)
                    }
    }, e.prototype.makeWallsOpaque = function(e) {
        if (this.wallTransparency) {
            t = t || hcsdesign.getComponentByName("WallComponent3D");
            var i, e = e || hcsdesign.getSelectedStructure(), o = t.get3DWallFrom2D(e);
            if (!o)
                return;
            for (var r = 0, s = o.subMeshes.length; s > r; r++)
                if (i = o.material.subMaterials[o.subMeshes[r].materialIndex], i.opacitySwitched) {
                    if (o.objectInstances[r] && ("OvertureStructure" == o.objectInstances[r].name || "SubSlopeOvertureStructure" == o.objectInstances[r].name) && o.objectInstances[r].programmableInstance)
                        for (var a in o.objectInstances[r].programmableInstance.materials)
                            o.objectInstances[r].programmableInstance.materials.hasOwnProperty(a) && n(o.objectInstances[r].programmableInstance.materials[a]);
                    n(i)
                }
        }
    }, e.prototype.onContextChanged = function(t) {
        "3D" !== t.context && this.makeWallsOpaque()
    }, e.prototype.onGlobaleFloorReady = function(t) {
        for (var e = 0; e < hcsdesign.structure.getLength(); e++) {
            var n = hcsdesign.structure.getElement(e);
            e !== t.maxFloorId && this.makeWallsOpaque(n)
        }
    }, e.prototype.getBestFocusRadius = function(t, e, n) {
        var i = t.getBoundingSphere(), o = (i.center.clone().add(t.position), n.getEngine().getAspectRatio(e)), r = Math.max(1, 1 / o) * i.radius, s = r / Math.sin(e.fov / 2);
        return s
    }, e.prototype.computeCameraStateLooking = function(t, e, n) {
        n = n || new BABYLON.Viewport(0, 0, 1, 1);
        var i = t.getScene();
        e = e || i.activeCamera;
        var o = t.getBoundingSphere(), r = new BABYLON.Vector3(0, .3, 1.2);
        t.structure && "undefined" != typeof t.structure.preferredYAngle && (r.x = Math.sin(t.structure.preferredYAngle), r.z = Math.cos(t.structure.preferredYAngle)), r.normalize();
        var s = o.center.clone(), a = t.getWorldMatrix().clone();
        s.x += a.m[12], s.y += a.m[13], s.z += a.m[14], a.m[12] = a.m[13] = a.m[14] = 0;
        var l = BABYLON.Vector3.TransformCoordinates(r, a);
        l.y < 0 && (l.y = 0, l.normalize());
        var h = l.toSpherical(), c = i.getEngine().getAspectRatio(e), u = 1 / n.height * o.radius, p = 1 / n.width / c * o.radius, d = Math.max(p, u) / Math.sin(e.fov / 2), m = new BABYLON.Vector3(0, 1, 0), g = BABYLON.Vector3.Cross(m, r);
        (null == g || g.lengthSquared() < 1e-5) && (r = new BABYLON.Vector3(0, 1, .001), g = BABYLON.Vector3.Cross(m, r)), g.normalize(), BABYLON.Vector3.CrossToRef(g, r, m);
        var f = BABYLON.Matrix.FromArray([g.x, g.y, g.z, 0, m.x, m.y, m.z, 0, r.x, r.y, r.z, 0, 0, 0, 0, 1]);
        f.invert(), f = f.multiply(a), u = d * Math.sin(e.fov / 2), p = u * c;
        var y = new BABYLON.Vector3(p * n.x, 0, 0), _ = new BABYLON.Vector3(0, u * n.y, 0);
        return BABYLON.Vector3.TransformCoordinatesToRef(y, f, y), BABYLON.Vector3.TransformCoordinatesToRef(_, f, _), s.addInPlace(y), s.addInPlace(_), {target: s,alpha: h.alpha,beta: h.beta,radius: d}
    };
    var i = function(t, e) {
        this.animations = t, this.target = e, this.target._animationCancelor && this.target._animationCancelor.cancel(), this.target._animationCancelor = this
    };
    i.prototype.cancel = function() {
        this.target._animationCancelor == this && (this.target.getScene().stopAnimation(this.target), this._onAnimationEnd())
    }, i.prototype._onAnimationEnd = function() {
        if (this.target._animationCancelor == this && (this.target._animationCancelor = null, this._moreCleanUp && this._moreCleanUp(), this._callBack && this._callBack(), this.animations)) {
            for (var t = this.animations.length; t--; )
                for (var e = this.target.animations.length; e--; )
                    this.animations[t] == this.target.animations[e] && this.target.animations.splice(e, 1);
            this.animations = null
        }
    };
    var o = function(t, e, n, i, o, r) {
        r = r || {x: null,y: null};
        var s = 1 - t;
        return r.x = 3 * t * s * s * e + 3 * t * t * s * i + t * t * t, r.y = 3 * t * s * s * n + 3 * t * t * s * o + t * t * t, r
    }, r = function(t, e, n, i, r) {
        for (var s, a = 0, l = 1, h = {x: null,y: null}; l - a > .001; )
            o(s = (a + l) / 2, e, n, i, r, h).x > t ? l = s : a = s;
        return (a + l) / 2
    }, s = function(t, e, n, i, s) {
        return o(r(t, e, n, i, s), e, n, i, s).y
    }, a = {linear: function(t) {
        return t
    },ease: function(t) {
        return s(t, .5, 0, .5, 1)
    },easeOut: function(t) {
        return s(t, .64, .47, .34, 1)
    }};
    return e.prototype.computeAnimation = function(t, e, n, o) {
        o = o || {};
        var r = Math.max(.01, o.duration || 0), s = o.callback, l = ("undefined" == typeof o.cleanAfterAnimation ? !0 : o.cleanAfterAnimation, o.name || "animation"), h = o.isACamera, c = "function" == typeof o.smooth ? o.smooth : a[o.smooth || "linear"], u = [];
        for (var p in e) {
            for (var d, m, g = new BABYLON.Animation(l + "_" + p, p, 60, e[p] instanceof BABYLON.Vector3 ? BABYLON.Animation.ANIMATIONTYPE_VECTOR3 : BABYLON.Animation.ANIMATIONTYPE_FLOAT, BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT), f = [], y = (c == a.linear ? 2 : Math.max(2, r / 40)) >> 0, _ = y; _--; ) {
                d = _ / (y - 1);
                var v = 0 === d ? 0 : 1 === d ? 1 : c(d);
                switch (g.dataType) {
                    case BABYLON.Animation.ANIMATIONTYPE_VECTOR3:
                        m = g.vector3InterpolateFunction(e[p], n[p], v);
                        break;
                    case BABYLON.Animation.ANIMATIONTYPE_FLOAT:
                        m = g.floatInterpolateFunction(e[p], n[p], v)
                }
                f.unshift({frame: 100 * d,value: m})
            }
            g.setKeys(f), u.push(g)
        }
        if (.1 > r)
            return new i(u, t);
        t.animations = t.animations.concat(u);
        var b = new i(u, t);
        b._callBack = s;
        var w = 100 / 60 / (r / 1e3);
        if (t.getScene().beginAnimation(t, 0, 100, !1, w, b._onAnimationEnd.bind(b)), h) {
            var x = function() {
                ujs.notify("hcs.engine3D.camera.move")
            }, C = t.getScene();
            C.registerBeforeRender(x), b._moreCleanUp = function() {
                C.unregisterBeforeRender(x), x = null
            }
        }
        return b
    }, e
}();
var hcs = window.hcs || {};
hcs.DragControls = function(t, e, n, i) {
    function o(e) {
        if (m.enabled) {
            e.preventDefault();
            var n = t.createPickingRay(e.clientX, e.clientY);
            if (m.enabled && a) {
                var i, o = n.distanceToPlane(f);
                _xyz.length > 1 ? (i = n.direction.scale(o), i.addInPlace(n.origin), i.subtractInPlace(l)) : (i = n.direction.scale(a.distance), i.addInPlace(n.origin), i.subtractInPlace(l));
                var r = a.pickedMesh.parent ? a.pickedMesh.parent.getWorldMatrix().clone() : BABYLON.Matrix.Identity();
                r.invert(), i = BABYLON.Vector3.TransformCoordinates(i, r), h.copyFrom(a.pickedMesh.position), w && (a.pickedMesh.position.x = i.x), x && (a.pickedMesh.position.y = i.y), C && (a.pickedMesh.position.z = i.z), a.pickedMesh.computeWorldMatrix(!0);
                var s = a.pickedMesh.getFloor();
                return s && s.markAsDirty(), ujs.notify("hcs.engine3d.dragcontrols.start", {selected: a}), M("drag", a), void (u === !1 ? u = 0 : 0 === u && (u = !0))
            }
            ujs.notify("hcs.engine3d.dragcontrols.move"), u = !1
        }
    }
    function r(i) {
        if (m.enabled) {
            if (i.preventDefault(), 0 === i.button) {
                var o = t.createPickingRay(i.clientX, i.clientY), r = o.intersectMeshes(t.meshes, !0, !0);
                if (r && -1 == n.indexOf(r.pickedMesh.getTopLevelObject(d)) && (r = null), r && r.hit) {
                    if (g && -1 === r.pickedMesh.name.indexOf("_girl"))
                        return;
                    console.warn("TODO : moveObject() de l'edition component pour avoir le magnetisme en event"), a = r, a.pickedMesh = a.pickedMesh.getTopLevelObject(d), f = new BABYLON.Plane(0, 1, 0, -a.pickedPoint.y);
                    var s = a.pickedMesh.parent ? a.pickedMesh.parent.getWorldMatrix().clone() : BABYLON.Matrix.Identity(), h = s.clone();
                    return h.invert(), l.copyFrom(BABYLON.Vector3.TransformCoordinates(a.pickedPoint, h)).subtractInPlace(a.pickedMesh.position), l.copyFrom(BABYLON.Vector3.TransformNormal(l, s)), e.style.cursor = "move", M("dragstart", a), void M("mousedown", a)
                }
            }
            M("mousedown", {hit: !1})
        }
    }
    function s(t) {
        if (m.enabled) {
            t.preventDefault();
            var n = !1;
            ujs.notify("hcs.engine3d.dragcontrols.end", {selected: a}), a && 1 == u ? (u = !1, n = !0, M("dragend", a), a = null) : a && (a = null), e.style.cursor = "auto", M("mouseup", {dragged: n})
        }
    }
    var a, n = n || [], l = new BABYLON.Vector3, h = new BABYLON.Vector3, c = (new BABYLON.Vector2, new BABYLON.Vector2), u = !1, p = 1;
    this.GROUPS = 0, this.OBJECTS = 1;
    var d = this.GROUPS, m = this, i = i || {}, g = !1, c = (i.offsets || {x: 0,y: 0}, {width: i.width || e.width,height: i.height || e.height}), f = new BABYLON.Plane(0, 1, 0, 0), y = !1, _ = function() {
        y || (e.addEventListener("pointermove", o, !1), e.addEventListener("pointerdown", r, !1), e.addEventListener("pointerup", s, !1), y = !0)
    }, v = function() {
        y && (e.removeEventListener("pointermove", o), e.removeEventListener("pointerdown", r), e.removeEventListener("pointerup", s), y = !1)
    };
    this.enabled = !0;
    var b = {};
    _(), this.setHardwareScaling = function(t) {
        p = t
    }, this.setDomElement = function(t) {
        v(), e = t, _()
    }, this.setDraggingMode = function(t) {
        d = t
    }, this.startEventsListening = function() {
        _()
    }, this.stopEventListening = function() {
        v()
    }, this.on = function(t, e) {
        return b[t] || (b[t] = []), b[t].push(e), m
    }, this.off = function(t, e) {
        var n = b[t];
        return n ? (n.indexOf(e) > -1 && n.splice(e, 1), m) : m
    }, this.lock = function() {
        g = !0
    }, this.unlock = function() {
        g = !1
    };
    var w, x, C, M = function(t, e, n) {
        var i = b[t];
        if (i && !n)
            for (var o = 0; o < i.length; o++)
                i[o](e)
                };
    w = x = C = !0, this.constrains = function(t) {
        return void 0 === t && (t = "xyz"), _xyz = t, w = x = C = !1, t.indexOf("x") > -1 && (w = !0), t.indexOf("y") > -1 && (x = !0), t.indexOf("z") > -1 && (C = !0), this
    }, this.addDraggable = function(t) {
        t.traverse(function(t) {
                   n.push(t)
                   })
    }, this.addUnremovableDraggable = function(t) {
        t.traverse(function(t) {
                   t._unremovableDraggable = !0, n.push(t)
                   })
    }, this.removeDraggable = function(t) {
        var e = -1;
        t.traverse(function(t) {
                   t._unremovableDraggable || (e = n.indexOf(t), n.splice(e, 1))
                   })
    }, this.resetDraggable = function() {
        var t = this;
        n.forEach(function(e) {
                  t.removeDraggable(e)
                  })
    }, this.onDocumentResize = function() {
        c = {width: window.innerWidth,height: window.innerHeight}
    }, this.setScreenSize = function(t, e) {
        c = {width: t,height: e}
    }, this.setSelectedObject = function(t) {
        a.pickedMesh = t, l.copyFrom(a.pickedPoint).subtractInPlace(a.pickedMesh.position)
    }, this.reset = function() {
        a = !1
    }, this.refreshReferentPlane = function() {
        var t = 0;
        a && (t = -a.pickedPoint.y), f = new BABYLON.Plane(0, 1, 0, t)
    }
};
var hcs = window.hcs || {};
hcs.Box3 = function() {
    var t = function() {
        this.min = null, this.max = null, this.angle = 0, this.customData = {}
    };
    return t.prototype.center = function() {
        return BABYLON.Vector3.Lerp(this.min, this.max, .5)
    }, t.prototype.serialize = function() {
        var t = ujs.serializeObject(this, !0);
        return t.class = {name: "hcs.Box3"}, t
    }, t.prototype.deserialize = function(t) {
        return this.min = new BABYLON.Vector3(t.min.x, t.min.y, t.min.z), this.max = new BABYLON.Vector3(t.max.x, t.max.y, t.max.z), this.angle = t.angle, this.customData = ujs.deserializeObject(t.customData), this
    }, t.Deserialize = function(e) {
        if (!e)
            return null;
        var n = new t;
        return ujs.deserializeObject(e, this), n
    }, t
}();
var MaterialInfo = function() {
    var t = function(t) {
        this.boundingBox = null, this.normal = null, this.center = null, this.material = t || null, this.customData = null
    };
    return t.prototype.serialize = function() {
        var t = {};
        return t.class = {name: "MaterialInfo"}, ujs.serializeObject(this, t), t
    }, t.prototype.deserialize = function(t) {
        return ujs.deserializeObject(t, this), this
    }, t.Deserialize = function(e) {
        var n = new t;
        return n.deserialize(e)
    }, t.MakeFromPane = function(e, n) {
        var i = new t(n);
        return i.normal = e.normal(), i.center = e.center(), i
    }, t.prototype.matchBestBoundingBox = function(t) {
        if (!this.boundingBox)
            return null;
        for (var e, n = +1 / 0, i = null, o = 0, r = t.length; r > o; o++)
            e = this.boundingBox.match(t[o]), n > e && (n = e, i = o);
        return i
    }, t
}();
var hcs = window.hcs || {};
hcs.UI = hcs.UI || {}, hcs.UI.FormBuilder = function() {
    function t(t) {
        t.target.parentNode.children[1].value = this.value
    }
    function e(t) {
        var e = (t.target.parentNode.children[0], +this.min), n = +this.max;
        +this.value > n ? this.value = n : +this.value < e && (this.value = e), t.target.parentNode.children[0].value = this.value
    }
    var n = 0, i = function(t) {
        this.itemsContainer = "string" == typeof t ? document.getElementById(t) : t
    };
    return i.prototype.updateProperties = function(t) {
        this.itemsContainer.innerHTML = "";
        for (var e in t) {
            var n = null;
            switch (t[e].type) {
                case "button":
                    n = this.createButtonItem(t[e].label, t[e].value, t[e].eventParams, t[e].id);
                    break;
                case "buttons":
                    n = this.createButtonsItem(t[e].items, t[e].id);
                    break;
                case "checkbox":
                    n = this.createCheckboxItem(t[e].label, t[e].eventParams, t[e].value, t[e].unit, t[e].id);
                    break;
                case "html":
                    n = this.createHTMLItem(t[e].html);
                    break;
                case "number":
                    n = this.createSliderItem(t[e].label, t[e].eventParams, t[e].value, "number", t[e].unit, t[e].id);
                    break;
                case "radio":
                    n = this.createRadioItem(t[e].label, t[e].eventParams, t[e].groupName, t[e].isSelected, t[e].id);
                    break;
                case "separator":
                    n = this.createSeparatorItem(t[e].label);
                    break;
                case "select":
                    n = this.createSelectItem(t[e].label, t[e].eventParams, t[e].namesValues, t[e].selectedKey);
                    break;
                case "slider":
                    n = this.createSliderItem(t[e].label, t[e].eventParams, t[e].value, "range", t[e].unit, t[e].id);
                    break;
                case "spacer":
                    n = this.createSpacerItem();
                    break;
                case "text":
                case "password":
                    n = this.createInputTextItem(t[e].label, t[e].eventParams, t[e].value, t[e].unit, t[e].type, t[e].id)
            }
            if (null !== n) {
                if (t[e]["class"])
                    for (var i = t[e]["class"].split(" "), o = 0; o < i.length; o++)
                        n.classList.add(i[o]);
                n.setAttribute("id", t[e].id || "item-" + e), this.itemsContainer.appendChild(n)
            }
        }
    }, i.prototype.onItemAction = function() {
        var t = JSON.parse(this.getAttribute("event-params")), e = this.getAttribute("rel");
        this instanceof HTMLInputElement ? t.value = "checkbox" == this.type ? this.checked ? !0 : !1 : "int" == t.cast ? parseInt(this.value, 10) : "float" == t.cast ? parseFloat(this.value) : "bool" == t.cast || "boolean" == t.cast ? this.value ? !0 : !1 : this.value : this instanceof HTMLSelectElement && (t.value = "int" === t.cast ? +this.value : "float" === t.cast ? +this.value : this.value), ujs.notify(e, t)
    }, i.prototype.createSelectItem = function(t, e, i, o) {
        var r = document.createElement("li");
        r.setAttribute("class", "param-item");
        var s = document.createElement("label");
        s.innerHTML = " " + t, r.appendChild(s);
        var a = document.createElement("span");
        a.setAttribute("class", "field");
        var l = document.createElement("select");
        l.setAttribute("event-params", JSON.stringify(e)), l.setAttribute("rel", e.eventName);
        for (var h = null, c = 0, u = i.length; u > c; c++)
            h = document.createElement("option"), h.setAttribute("value", i[c].value), h.innerHTML = i[c].text, l.appendChild(h), i[c].value === o && h.setAttribute("selected", "selected");
        return l.addEventListener("change", this.onItemAction, !1), a.appendChild(l), r.appendChild(a), n++, r
    }, i.prototype.createSliderItem = function(n, i, o, r, s) {
        var r = r || "range";
        o.step = o.step || 1;
        var a = document.createElement("li");
        a.setAttribute("class", "param-item");
        var l = document.createElement("label");
        l.innerHTML = n;
        var h = document.createElement("span");
        h.setAttribute("class", "field");
        var c = document.createElement("input");
        c.setAttribute("type", r), c.setAttribute("min", o.min), c.setAttribute("max", o.max), c.setAttribute("value", o.value), c.setAttribute("step", o.step), c.setAttribute("event-params", JSON.stringify(i)), c.setAttribute("rel", i.eventName);
        var u = "";
        if ("range" == r && (u += " input-range"), s && (u += " unit"), "" != u && c.setAttribute("class", u), "range" == r && c.addEventListener("input", this.onItemAction, !1), c.addEventListener("change", this.onItemAction, !1), c.addEventListener("keydown", function(t) {
                                                                                                                                                                                                                                                           t.stopPropagation()
                                                                                                                                                                                                                                                           }, !1), h.appendChild(c), "range" == r) {
            var p = document.createElement("input");
            p.setAttribute("type", "number"), s && p.setAttribute("class", "unit"), p.setAttribute("min", o.min), p.setAttribute("max", o.max), p.setAttribute("value", o.value), p.setAttribute("step", o.step), p.setAttribute("event-params", JSON.stringify(i)), p.setAttribute("rel", i.eventName), p.addEventListener("change", this.onItemAction, !1), p.addEventListener("blur", e, !1), h.appendChild(p), c.addEventListener("input", t, !1), c.addEventListener("change", t, !1), p.addEventListener("keydown", function(t) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               t.stopPropagation()
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               }, !1)
        }
        var d = document.createElement("span");
        return s && (d.innerHTML = s, d.setAttribute("class", "unit")), h.appendChild(d), a.appendChild(l), a.appendChild(h), a
    }, i.prototype.createInputTextItem = function(t, e, i, o, r, s) {
        var a = document.createElement("li");
        a.setAttribute("class", "param-item");
        var l = document.createElement("label");
        l.setAttribute("for", s || "formBuilderCB_" + n), l.innerHTML = t, a.appendChild(l);
        var h = document.createElement("span");
        h.setAttribute("class", "field");
        var c = document.createElement("input");
        c.setAttribute("id", l.getAttribute("for"));
        var u = "string" == typeof r ? r : "text";
        c.setAttribute("type", u), c.setAttribute("value", i), "function" == typeof e ? c.addEventListener("change", e, !1) : e && (c.setAttribute("event-params", JSON.stringify(e)), c.setAttribute("rel", e.eventName), c.addEventListener("change", this.onItemAction, !1)), c.addEventListener("keydown", function(t) {
                                                                                                                                                                                                                                                                                                    t.stopPropagation()
                                                                                                                                                                                                                                                                                                    }, !1), h.appendChild(c);
        var p = document.createElement("span");
        return o && (p.innerHTML = o, p.setAttribute("class", "unit")), h.appendChild(p), a.appendChild(h), n++, a
    }, i.prototype.createCheckboxItem = function(t, e, i, o, r) {
        var s = document.createElement("li");
        s.setAttribute("class", "param-item");
        var a = document.createElement("label");
        a.setAttribute("for", r || "formBuilderCB_" + n), a.innerHTML = " " + t, s.appendChild(a);
        var l = document.createElement("span");
        l.setAttribute("class", "field");
        var h = document.createElement("input");
        h.setAttribute("type", "checkbox"), h.setAttribute("id", a.getAttribute("for")), h.setAttribute("class", "cb-switch"), i && h.setAttribute("checked", "checked"), "function" == typeof e ? h.addEventListener("click", e, !1) : e && (h.setAttribute("event-params", JSON.stringify(e)), h.setAttribute("rel", e.eventName), h.addEventListener("click", this.onItemAction, !1)), l.appendChild(h);
        var c = document.createElement("span");
        return o && (c.innerHTML = o, c.setAttribute("class", "unit")), l.appendChild(c), s.appendChild(l), n++, s
    }, i.prototype.createButtonItem = function(t, e, i, o, r) {
        var s = document.createElement("li");
        s.setAttribute("class", "param-item");
        var a = document.createElement("label");
        a.setAttribute("for", r || "formBuilderBT_" + n), a.innerHTML = t, s.appendChild(a);
        var l = document.createElement("span");
        l.setAttribute("class", "field");
        var h = document.createElement("button");
        h.innerHTML = e, h.setAttribute("id", a.getAttribute("for")), h.setAttribute("event-params", JSON.stringify(i)), h.setAttribute("rel", i.eventName), "function" == typeof i ? h.addEventListener("click", i, !1) : i && h.addEventListener("click", this.onItemAction, !1), l.appendChild(h);
        var c = document.createElement("span");
        return o && (c.innerHTML = o, c.setAttribute("class", "unit")), l.appendChild(c), s.appendChild(l), n++, s
    }, i.prototype.createButtonsItem = function(t) {
        var e = document.createElement("li");
        e.setAttribute("class", "param-item");
        var n = t.length, i = document.createElement("label");
        i.innerHTML = " " + labelParams, e.appendChild(i);
        var o = document.createElement("span");
        o.setAttribute("class", "field");
        var r = document.createElement("div");
        r.setAttribute("class", "stacked_" + n), o.appendChild(r);
        for (var s = 0, a = n; a > s; s++) {
            var l = document.createElement("button");
            l.innerHTML = t[s].value, l.setAttribute("event-params", JSON.stringify(t[s].eventParams)), l.setAttribute("rel", t[s].eventParams.eventName), l.addEventListener("click", this.onItemAction, !1), r.appendChild(l)
        }
        var h = document.createElement("span");
        return unit && (h.innerHTML = unit, h.setAttribute("class", "unit")), o.appendChild(h), e.appendChild(o), e
    }, i.prototype.createSpacerItem = function() {
        var t = this.createHTMLItem("");
        return t.children[0].setAttribute("class", "spacer"), t
    }, i.prototype.createHTMLItem = function(t) {
        var e = document.createElement("li");
        e.setAttribute("class", "param-item");
        var n = document.createElement("div");
        return n.innerHTML = t, e.appendChild(n), e
    }, i.prototype.createSeparatorItem = function(t) {
        var e = document.createElement("li");
        e.setAttribute("class", "separator");
        var n = document.createElement("label");
        n.innerHTML = "undefined" != typeof t ? t : "", e.appendChild(n);
        var i = document.createElement("span");
        i.setAttribute("class", "field"), e.appendChild(i);
        var o = document.createElement("hr");
        return i.appendChild(o), e
    }, i.prototype.createRadioItem = function(t, e, i, o, r) {
        var s = document.createElement("li");
        s.setAttribute("class", "param-item");
        var a = document.createElement("label");
        a.setAttribute("for", r || "formBuilderRD_" + n), a.innerHTML = t, s.appendChild(a);
        var l = document.createElement("span");
        l.setAttribute("class", "field");
        var h = document.createElement("input");
        return h.setAttribute("id", a.getAttribute("for")), h.setAttribute("name", i), h.setAttribute("type", "radio"), o && h.setAttribute("checked", "checked"), "function" == typeof e ? h.addEventListener("click", e, !1) : e && (h.addEventListener("click", this.onItemAction, !1), h.setAttribute("rel", e.eventName), h.setAttribute("event-params", JSON.stringify(e))), l.appendChild(h), s.appendChild(l), n++, s
    }, i
}();

var hcs = window.hcs || {};
hcs.UI = hcs.UI || {}, hcs.UI.Frame = function() {
    function t(t) {
        if (t.touches && t.touches.length) {
            t.preventDefault();
            var e = t.touches[0];
            t.x = e.x || e.screenX || e.pageX || e.clientx, t.y = e.y || e.screenY || e.pageY || e.clientY
        }
        return t
    }
    function e(t) {
        var e = t.target.getAttribute("rel");
        "" != e && ujs.notify(e)
    }
    function n(t, e, n) {
        var i = document.createElement(t);
        return n && i.setAttribute("id", n), e && i.setAttribute("class", e), i
    }
    var i = function(t, e, n) {
        this.activeTab = 0, this.eventStarted = !1, this.config = t || {}, this.content = e || {}, this.parentNode = n || document.getElementById("modalWidgets") || document.body, this.domElement = null, this.mouseState = {x: 0,y: 0,prevX: 0,prevY: 0,deltaX: 0,deltaY: 0,click: !1}, this.windowPosition = {x: 0,y: 0}, this.menuDOM = document.getElementById("mainMenu"), this.windowSize = {width: this.config.width || 640,height: this.config.height || 480,maxWidth: this.config.maxWidth || 1980,maxHeight: this.config.maxHeight || 1080,minWidth: this.config.minWidth || 320,minHeight: this.config.minHeight || 240}, this.formBuilder = new hcs.UI.FormBuilder, this.initialized = !1
    };
    return i.prototype.initialize = function() {
        this.initialized || (this.buildHTML(), this.adapteSize(), this.initializeEvents(), this.parentNode.appendChild(this.domElement), this.initialized = !0)
    }, i.prototype.resetSize = function(t) {
        this.windowSize = {width: t.width || 640,height: t.height || 480}, t.autoSize ? (this.domElement.style.removeProperty("width"), this.domElement.style.removeProperty("height")) : (this.domElement.style.width = this.windowSize.width + "px", this.domElement.style.height = this.windowSize.height + "px")
    }, i.prototype.adapteSize = function() {
        this.windowSize.width = Math.min(this.windowSize.width, this.windowSize.maxWidth), this.windowSize.height = Math.min(this.windowSize.height, this.windowSize.maxHeight), this.windowSize.width = Math.max(this.windowSize.width, this.windowSize.minWidth), this.windowSize.height = Math.max(this.windowSize.height, this.windowSize.minHeight), this.config.autoSize || (this.domElement.style.width = this.windowSize.width + "px", this.domElement.style.height = this.windowSize.height + "px")
    }, i.prototype.buildHeaderTitle = function(t) {
        if (this.headerTitle.innerHTML = "", this.config.headerIcon) {
            var e = n("img", "window-title-icon");
            e.setAttribute("src", this.config.headerIcon), this.headerTitle.appendChild(e)
        }
        var i = n("span", "window-title-text");
        i.innerHTML = t || "Title", this.headerTitle.appendChild(i)
    }, i.prototype.buildHTML = function() {
        var t = this.config.layout || "horizontal";
        this.domElement = n("div", "window"), this.header = n("header", "window-title"), this.closeWindow = n("span", "window-close"), this.config.showCloseButton === !1 && (this.closeWindow.style.display = "none"), this.header.appendChild(this.closeWindow), this.headerTitle = n("h1"), this.buildHeaderTitle(this.content.title), this.header.appendChild(this.headerTitle), this.domElement.appendChild(this.header), this.mainContent = n("div", "window-content"), this.domElement.appendChild(this.mainContent), this.tabsContainer = n("div", "tabbed " + t), this.tabs = n("ul", "tabbed-tabs"), this.tabsContainer.appendChild(this.tabs), this.tabContent = n("div", "tabbed-tabcontent"), this.tabsContainer.appendChild(this.tabContent), this.mainContent.appendChild(this.tabsContainer), this.actionBar = n("div", "window-action-bar"), this.domElement.appendChild(this.actionBar)
    }, i.prototype.setTitle = function(t) {
        this.headerTitle.innerHTML = t
    }, i.prototype.setContent = function(t, e) {
        var e = "number" == typeof e ? e : 0;
        e = e >= this.tabs.children.length ? this.tabs.children.length - 1 : e, t instanceof HTMLElement ? (this.tabContent.children[e].innerHTML = "", this.tabContent.children[e].appendChild(t)) : this.tabContent.children[e].innerHTML = t
    }, i.prototype.addTab = function(t, e, i, o) {
        var r = n("li");
        r.addEventListener("click", this.onTabClick.bind(this), !1), r.setAttribute("rel", "tab-" + this.tabs.children.length);
        var s = n("span", "tab-text");
        if (s.innerHTML = t, r.appendChild(s), e) {
            var a = n("span", "tab-icon"), e = n("img", "tab-icon");
            e.setAttribute("src", e), a.appendChild(e), r.appendChild(a)
        }
        this.tabs.appendChild(r);
        var l = n("section", "tab-content-" + (this.tabs.children.length - 1));
        i instanceof HTMLElement ? l.appendChild(i) : l.innerHTML = i, this.tabContent.appendChild(l)
    }, i.prototype.setLayout = function(t) {
        this.domElement.classList.remove("horizontal", "vertical"), this.domElement.classList.add(t)
    }, i.prototype.clear = function(t) {
        var t = t || {tabs: !0,content: !0,actionBar: !0};
        t.tabs && (this.tabs.innerHTML = ""), t.content && (this.tabContent.innerHTML = ""), t.actionBar && (this.actionBar.innerHTML = "")
    }, i.prototype.addForm = function(t, e, i) {
        if (!this.tabContent.children.length || this.tabContent.children.length <= t) {
            var i = i || "Tab " + this.tabContent.children.length;
            this.addTab(i, void 0, void 0, !0), t = this.tabs.children.length - 1
        }
        var o = this.tabContent.children[t];
        o.innerHTML = "";
        var r = n("ul");
        o.appendChild(r), this.formBuilder.itemsContainer = r, this.formBuilder.updateProperties(e)
    }, i.prototype.setActionBar = function(t) {
        if (this.actionBar.children.length)
            for (var i = this.actionBar.children.length - 1; i > 0; i--)
                this.actionBar.children[i].removeEventListener("click", e), this.actionBar.removeChild(this.actionBar.children[i]);
        if ("string" == typeof element)
            this.actionBar.innerHTML = t;
        else
            for (var i = 0, o = t.length; o > i; i++) {
                var r = n("button");
                r.innerHTML = t[i].label, "function" != typeof t[i].action ? (r.setAttribute("rel", t[i].action), r.addEventListener("click", e, !1)) : (r.setAttribute("rel", ""), r.addEventListener("click", t[i].action, !1)), t[i].title && r.setAttribute("title", t[i].title), t[i]["class"] && r.setAttribute("class", t[i]["class"]), this.actionBar.appendChild(r)
            }
        this.domElement.classList.add("window-with-button")
    }, i.prototype.showContent = function(t) {
        this.tabs.children[this.activeTab] && (this.tabs.children[this.activeTab].classList.remove("active"), this.tabContent.children[this.activeTab].classList.remove("active")), this.activeTab = t, this.activeTab = this.tabs.children[this.activeTab] ? this.activeTab : 0, this.tabs.children[this.activeTab].classList.add("active"), this.tabContent.children[this.activeTab].classList.add("active")
    }, i.prototype.show = function(t, e) {
        this.initialize(), this.domElement.style.display = "block", this.tabs.children.length < 2 ? this.tabsContainer.classList.add("notab") : this.tabsContainer.classList.remove("notab"), this.showContent(this.activeTab), "undefined" != typeof t && "undefined" != typeof e ? (t + this.domElement.offsetWidth > window.innerWidth && (t = window.innerWidth - this.domElement.offsetWidth - 5, 0 > t && (t = 0)), e + this.domElement.offsetHeight > window.innerHeight && (e = window.innerHeight - this.domElement.offsetHeight - 5, 0 > e && (e = 0)), this.setPosition(t, e)) : this.centerWindow()
    }, i.prototype.close = function() {
        ujs.notify("hcs.ui.frame.close"), this.domElement.style.display = "none"
    }, i.prototype.centerWindow = function() {
        this.windowPosition.x = (window.innerWidth - this.menuDOM.offsetWidth) / 2 - this.windowSize.width / 2, this.windowPosition.y = window.innerHeight / 2 - this.windowSize.height / 2, this.domElement.style.position = "absolute", this.config.autoSize || (this.domElement.style.width = this.windowSize.width + "px", this.domElement.style.height = this.windowSize.height + "px"), this.domElement.style.top = this.windowPosition.y + "px", this.domElement.style.left = this.windowPosition.x + "px"
    }, i.prototype.setPosition = function(t, e) {
        this.windowPosition.x = t, this.windowPosition.y = e, this.domElement.style.top = this.windowPosition.y + "px", this.domElement.style.left = this.windowPosition.x + "px"
    }, i.prototype.resetMouseState = function() {
        this.mouseState.click = !1, this.mouseState.prevX = 0, this.mouseState.prevY = 0, this.mouseState.x = 0, this.mouseState.y = 0, this.mouseState.deltaX = 0, this.mouseState.deltaY = 0
    }, i.prototype.onHeaderMouseDown = function(e) {
        t(e), this.mouseState.click = !0, this.mouseState.x = e.x || e.screenX, this.mouseState.y = e.y || e.screenY
    }, i.prototype.onHeaderMouseUp = function() {
        this.resetMouseState()
    }, i.prototype.onHeaderMouseMove = function(e) {
        this.mouseState.click && (t(e), this.mouseState.prevX = this.mouseState.x, this.mouseState.prevY = this.mouseState.y, this.mouseState.x = e.x || e.screenX || this.mouseState.prevX, this.mouseState.y = e.y || e.screenY || this.mouseState.prevY, this.mouseState.deltaX = this.mouseState.x - this.mouseState.prevX, this.mouseState.deltaY = this.mouseState.y - this.mouseState.prevY, this.windowPosition.x += this.mouseState.deltaX, this.windowPosition.y += this.mouseState.deltaY, this.domElement.style.top = this.windowPosition.y + "px", this.domElement.style.left = this.windowPosition.x + "px")
    }, i.prototype.initializeEvents = function() {
        this.eventStated || (this.closeWindow.addEventListener("click", this.close.bind(this), !1), this.closeWindow.addEventListener("touchstart", this.close.bind(this), !1), this.header.addEventListener("mousedown", this.onHeaderMouseDown.bind(this), !1), document.body.addEventListener("mouseup", this.onHeaderMouseUp.bind(this), !1), document.body.addEventListener("mousemove", this.onHeaderMouseMove.bind(this), !1), this.header.addEventListener("touchstart", this.onHeaderMouseDown.bind(this), !1), document.body.addEventListener("touchmove", this.onHeaderMouseMove.bind(this), !1), document.body.addEventListener("touchend", this.onHeaderMouseUp.bind(this), !1), document.body.addEventListener("touchcancel", this.onHeaderMouseUp.bind(this), !1), document.addEventListener("hcs.request.closePopup", this.close.bind(this), !1), this.eventStated = !0)
    }, i.prototype.onTabClick = function(t) {
        var e = t.target.parentNode;
        t.target.classList.contains("counter") ? e = t.target.parentNode.parentNode : "LI" == t.target.nodeName && (e = t.target);
        var n = e.getAttribute("rel").split("-")[1];
        n != this.activeTab && this.showContent(n)
    }, i.prototype.getDivNode = function(t) {
        var e = t;
        return "DIV" != e.nodeName && (e = this.getDivNode(t.parentNode)), e
    }, i
}();

var hcs = window.hcs || {};
hcs.UI = hcs.UI || {}, hcs.UI.ProductList = function() {
    function t(e) {
        var n = {};
        for (var i in e)
            n[i] = e[i] instanceof Object ? t(e[i]) : e[i];
        return n
    }
    var e = null, n = [], i = [], o = !1, r = function(t, n) {
        hcs.UI.Frame.call(this, {layout: "vertical",headerIcon: "images/productIconTitle.png"}, {title: _("物品列表")}), this.windowSize.maxWidth = window.innerWidth, this.windowSize.maxHeight = window.innerHeight, this.windowSize.width = (window.innerWidth - this.menuDOM.offsetWidth) / 1.5, this.windowSize.height = window.innerHeight / 1.5, _randomGET = n, this.core = t, null == e && (e = this, e.initProductList(function() {
                                                                                                                                                                                                                                                                                                                                                                                                                                      o = !0
                                                                                                                                                                                                                                                                                                                                                                                                                                      }), e.initialize())
    };
    return r.prototype = new hcs.UI.Frame, r.prototype.initialize = function() {
        hcs.UI.Frame.prototype.initialize.call(this), this.domElement.setAttribute("id", "productList")
    }, r.prototype.initProductList = function(t) {
        var t = t || function() {
        };
        /*ujs.ajax({method: "GET",url: [hcs.Constants.PRODUCTS_FILE].join(""),success: function(i) {
                 n = JSON.parse(i), t.call(e)
                 }})*/
		xmlHttp = new XMLHttpRequest();
		xmlHttp.open("GET", hcs.Constants.PRODUCTS_FILE, false);
		xmlHttp.send(null);
		n = JSON.parse(xmlHttp.responseText), t.call(e)
    }, r.prototype.addProduct = function(t, e) {
        var n = document.createElement("div");
        n.setAttribute("class", "product-item"), n.setAttribute("rel", t.id);
        var i = "models/previews/productsPlaceholder.png";
        t.preview && (i = hcs.Constants.PRODUCTS_PREVIEWS + t.preview);
        var o = document.createElement("span");
        o.setAttribute("class", "selected"), o.innerHTML = _("添加"), n.appendChild(o);
        var r = document.createElement("span");
        r.setAttribute("class", "product-item-image");
        var s = document.createElement("img");
        s.setAttribute("src", i), r.addEventListener("click", this.onMenuItemButtonClick, !1), r.appendChild(s), n.appendChild(r);
        var a = document.createElement("span");
        a.setAttribute("class", "product-item-description"), a.setAttribute("rel", [t.action, "_", t.id].join(""));
        var l = t.translations ? _(t.title, t.translations) : _(t.title);
        a.innerHTML = l, n.appendChild(a), e.appendChild(n)
    }, r.prototype.loadProducts = function(t, r, s) {
        if (o === !0) {
            r.innerHTML = "";
            for (var a in n)
                if (n[a].id == t) {
                    i = n[a].items;
                    for (var l = 0; l < i.length; l++)
                        e.addProduct(i[l], r);
                    e.getTabsForFilters(s)
                }
        } else
            e.initProductList(function() {
                              o = !0, e.loadProducts(t, r, s), e.show()
                              })
            }, r.prototype.getTabsForFilter = function(t) {
                var n = t.split(":")[1] ? t.split(":")[1] : null, t = t.split(":")[0], o = {};
                n && (o[n] = document.createElement("div"));
                for (var r in i) {
                    var s = i[r], a = s.params ? JSON.parse(s.params.params) || {} : {}, l = ujs.getProperty(a, t);
                    l && -1 == Object.keys(o).indexOf(l.toString()) && (o[l] = document.createElement("div")), l ? e.addProduct(s, o[l]) : e.addProduct(s, o[n])
                }
                for (var h in o)
                    e.addTab(_(t) + " " + h, null, o[h], !0)
                    }, r.prototype.getTabsForFilters = function(t) {
                        if (t)
                            for (var e = t.split(","), n = 0; n < e.length; n++)
                                this.getTabsForFilter(e[n])
                                }, r.prototype.reinitContent = function(t) {
                                    e.tabs.innerHTML = "", e.tabContent.innerHTML = "";
                                    var n = document.createElement("div");
                                    n.innerHTML = _("正在加载 ..."), e.addTab("", null, "", !0), e.addTab(_("全部"), null, n, !0), e.loadProducts(t.id, n, t.filter), e.showContent(1)
                                }, r.show = function(t, n, i) {
                                    var i = i || {};
                                    null === e && (e = new hcs.UI.ProductList(t, n)), e.reinitContent(i), e.buildHeaderTitle(e.content.title + " > " + i.name), e.show()
                                }, r.close = function() {
                                    null !== e && e.close()
                                }, r.prototype.close = function() {
                                    ujs.notify("hcs.ui.frame.close"), this.domElement.style.display = "none", ujs.notify("hcs.menu.main.deselect")
                                }, r.prototype.onMenuItemButtonClick = function(n) {
                                    var o = e.getDivNode(n.target), r = o.getAttribute("rel"), s = i[0], a = o.children[0];
                                    a.classList.add("show");
                                    for (var l = setInterval(function() {
                                                             a.classList.remove("show"), clearInterval(l)
                                                             }, 1500), h = 0; h < i.length; h++)
                                        r == i[h].id && (s = t(i[h]));
                                    var c = s.action, u = s.type, p = s.params, d = r;
                                    "" != c && "string" == typeof u && ujs.notify(c, {objectId: d,objectType: u,objectParams: p}, !0)
                                }, r
}();

var hcs = window.hcs || {};
hcs.UI = hcs.UI || {}, hcs.UI.ContextMenu = function() {
    var t = null, e = !1, n = null, i = {x: !1,y: !1}, o = function(e) {
        var e = e || {};
        e.autoSize = e.autoSize === !1 ? !1 : !0, hcs.UI.Frame.call(this, e), null == t && (t = this)
    };
    return o.prototype = new hcs.UI.Frame, o.prototype.initialize = function() {
        hcs.UI.Frame.prototype.initialize.call(this), this.domElement.id = "contextMenu"
    }, o.prototype.show = function(t, n, i, o) {
        hcs.UI.Frame.prototype.show.call(this, t, n), this.menuName = i, e = !0, ujs.notify("hcs.widget.contextMenu.opened"), ujs.notify("hcs.widget.contextMenu." + this.menuName + ".opened", o)
    }, o.prototype.close = function() {
        e && (hcs.UI.Frame.prototype.close.call(this), e = !1, null !== n && (clearInterval(n), n = null), i = {x: this.windowPosition.x,y: this.windowPosition.y}, ujs.notify("hcs.widget.contextMenu.closed"), ujs.notify("hcs.widget.contextMenu." + this.menuName + ".closed"))
    }, o.isOpen = function() {
        return e
    }, o.show = function(o, r, s, a, l) {
        var o = o || {};
        o.width = o.width || 250, o.height = o.height || !1, o.x = o.x || i.x || window.innerWidth / 2 - o.width / 2, o.y = o.y || i.y || window.innerHeight / 2 - o.height / 2, o.title = o.title || "参数", o.layout = o.layout || "horizontal", o.autoSize = o.autoSize === !1 ? !1 : !0;
        var h = o.menuName || o.title.replace(/ /g, "_");
        null == t && (t = new hcs.UI.ContextMenu(o, {title: o.title}), t.initialize()), o.id && t.domElement.setAttribute("id", o.id);
        var c = function() {
            t.clear(), t.setTitle(o.title);
            for (var e = 0, n = r.length; n > e; e++)
                t.addForm(e, r[e].content, r[e].title);
            s && t.setActionBar(s), o.showIndex > -1 && t.showContent(o.showIndex), t.setLayout(o.layout || "horizontal"), t.resetSize(o), t.show(o.x, o.y, h, l)
        };
        "number" == typeof a ? n = setTimeout(function() {
                                              c(), clearTimeout(n), n = null
                                              }, a) : c(), e = !0
    }, o.close = function() {
        null !== t && (i = {x: t.windowPosition.x,y: t.windowPosition.y}, t.close(), e = !1)
    }, o.setPosition = function(e, n) {
        null !== t && t.setPosition(e, n)
    }, o.getPosition = function() {
        return null === t ? null : {x: t.windowPosition.x,y: t.windowPosition.y}
    }, o.update = function(e) {
        if (null === t)
            return null;
        for (var n = e.length; n--; )
            for (var i = e[n].content.length; i--; ) {
                var o = e[n].content[i];
                if (o)
                    switch (o.type) {
                        case "number":
                        case "text":
                        case "checkbox":
                        case "slider":
                            var r = t.domElement.querySelectorAll("li#" + o.id + ".param-item");
                            if (!r || 1 != r.length)
                                continue;
                            r = r[0];
                            for (var s = r.querySelectorAll("input"), a = "object" == typeof o.value ? o.value.value : o.value, l = s.length; l--; )
                                s[l].value = a
                                }
            }
    }, o
}();

var hcs = window.hcs || {};
hcs.UI = hcs.UI || {}, hcs.UI.AboutWindow = function() {
    var t = function() {
        var t = {minWidth: 500};
        t.autoSize = t.autoSize === !1 ? !1 : !0, hcs.UI.Frame.call(this, t), this.initialize(), this.domElement.setAttribute("id", "aboutWindow"), this.setTitle(_("About Wanaplan")), this.close();
        var e = '<div style="width: 432px; text-align: center;"><img src="./images/hcsdesign-logo.png" alt="Wanaplan" /></div>';
        e += '<div style="text-align: center; font-size: 16pt; font-weight: bold; margin-top: 15px; color: #333;">Wanaplan ' + hcsdesign.version + "</div>", e += '<div style="text-align: center; margin-top: 30px; color: #555;">Copyright © 2012-2014 Wanadev, all rights reserved.</div>', e += '<div style="text-align: center; margin-top: 10px;"><a href="http://www.wanadev.fr/" target="_blank">www.wanadev.fr</a> / <a href="http://www.hcsdesign.com/" target="_blank">www.hcsdesign.com</a></div>', this.addTab(_("About"), null, e, !0), e = '<div class="scrollable-content" style="width: 410px; max-height: 300px; min-height: 100px; font-size: 9pt;"><ul>', e += '<li><strong>"seamless" textures:</strong><dl><dt>Author:</dt><dd>~hhh316 Giles</dd><dt>License:</dt><dd>cc-by 3.0</dd><dt>Downloaded from:</dt><dd><a href="http://seamless-pixels.blogspot.fr/"> http://seamless-pixels.blogspot.fr/</a></dd></dl></li>', e += '<li><strong>Babylonjs engine:</strong><dl><dt>Authors:</dt><dd>David Catuhe & David Rousset</dd><dt>Licence:</dt><dd>Apache License 2.0</dd><dt>Homepage:</dt><dd><a href="http://www.babylonjs.com">http://www.babylonjs.com</a></dd></dl></li>', e += "</ul></div>", this.addTab(_("Credits"), null, e, !0), this.setActionBar([{label: _("Close"),action: function() {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    this.close()
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }.bind(this)}]), document.addEventListener("hcs.ui.showAboutWindow", function() {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               this.show(), ujs.notify("hcs.menu.top.deselect")
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               }.bind(this), !1)
    };
    return t.prototype = new hcs.UI.Frame, t
}();

var hcs = window.hcs || {};
hcs.UI = hcs.UI || {}, hcs.UI.BackgroundPopup = function() {
    function t(t, e, n) {
        var i = document.createElement(t);
        return n && i.setAttribute("id", n), e && i.setAttribute("class", e), i
    }
    function e(t) {
        if (!t.hasOwnProperty("offsetX")) {
            var e = curtop = 0;
            if (t.currentTarget) {
                var n = t.currentTarget;
                do
                    e += n.offsetLeft, curtop += n.offsetTop;
                while (n = n.offsetParent)
                    }
            t.offsetX = t.clientX - e, t.offsetY = t.clientY - curtop
        }
        return t
    }
    var n, i = null, o = 100, r = !0, s = 560, a = 320, l = 1, h = new BABYLON.Vector2(0, 0), c = new BABYLON.Vector2(0, 0), u = !1, p = 1, d = [new BABYLON.Vector2(10, 10), new BABYLON.Vector2(100, 10)], m = function(t) {
        var t = t || {};
        t.autoSize = t.autoSize === !1 ? !1 : !0, t.width = 600, t.height = 540, hcs.UI.Frame.call(this, t)
    };
    return m.prototype = new hcs.UI.Frame, m.prototype.buildHTML = function() {
        this.config.layout || "horizontal";
        this.domElement = t("div", "window", "backgroundPopup"), this.header = t("header", "window-title"), this.closeWindow = t("span", "window-close"), this.config.showCloseButton === !1 && (this.closeWindow.style.display = "none"), this.header.appendChild(this.closeWindow), this.headerTitle = t("h1");
        var e = t("span", "window-title-text");
        e.innerHTML = this.content.title || _("Choose and set background"), this.headerTitle.appendChild(e), this.header.appendChild(this.headerTitle), this.domElement.appendChild(this.header), this.mainContent = t("div", "window-content window-content-background"), this.domElement.appendChild(this.mainContent), i.setPosition((window.innerWidth - this.windowSize.width) / 2, (window.innerHeight - this.windowSize.height) / 2), this.domElement.style.width = this.windowSize.width + "px", this.domElement.style.height = this.windowSize.height + "px";
        var n = hcsdesign.structure.params.gridBackground || {};
        o = n.scale || o, n.translation && BABYLON.Vector2.FromArrayToRef(n.translation, 0, h), n.points && (BABYLON.Vector2.FromArrayToRef(n.points[0], 0, d[0]), BABYLON.Vector2.FromArrayToRef(n.points[1], 0, d[1])), (!d[1] || BABYLON.Vector2.Distance(d[0], d[1]) < 90) && (d[1] = d[0].add(new BABYLON.Vector2(100, 0))), this.mainCanvas = t("canvas", "window-canvas"), this.mainCanvas.style.background = "white", this.mainCanvas.width = s, this.mainCanvas.style.width = s + "px", this.mainCanvas.height = a, this.mainCanvas.style.height = a + "px", this.mainCtx = this.mainCanvas.getContext("2d");
        var r = function(t, e) {
            i.onMouseEvent(t, e)
        };
        this.pointerManager = new hcs.PointerManager(void 0, r, this.mainCanvas)
    }, m.prototype.onMouseEvent = function(t, e) {
        e.actions == e.ACTION_DRAGSTART ? i.onCanvasMouseDown(t) : e.actions == e.ACTION_DRAGGING ? i.onCanvasDrag(t, e) : e.actions == e.ACTION_SCROLLDOWN ? (l -= .04, l = .6 > l ? .6 : l) : e.actions == e.ACTION_SCROLLUP && (l += .04, l = l > 6 ? 6 : l), i.updateCtx()
    }, m.prototype.onCanvasDrag = function(t, e) {
        if (1 === u || 0 === u) {
            var n = e.posDelta.scaleInPlace(1 / l), o = d[u].add(n);
            BABYLON.Vector2.Distance(o, d[0 == u ? 1 : 0]) > 10 && (d[u] = o)
        } else
            2 === u ? (d[0].addInPlace(e.posDelta.clone().scaleInPlace(1 / l)), d[1].addInPlace(e.posDelta.clone().scaleInPlace(1 / l))) : h.addInPlace(e.posDelta);
        i.updateCtx(), i.updateGrid()
    }, m.prototype.onCanvasMouseDown = function(t) {
        e(t), c.x = t.offsetX, c.y = t.offsetY, c.subtractInPlace(h), c.scaleInPlace(1 / l), u = BABYLON.Vector2.Distance(c, d[0]) < 10 ? 0 : BABYLON.Vector2.Distance(c, d[1]) < 10 ? 1 : BABYLON.Vector2.Distance(c, d[1].clone().lerp(d[0], .5)) < 10 ? 2 : 3
    }, m.prototype.updateGrid = function() {
        var t = +o, e = 1 / p * BABYLON.Vector2.Distance(d[0], d[1]), i = t / e;
        ujs.notify("hcs.engine2d.backgroundChange", {scale: i,measure: t,visibility: r,img: n,translation: h,points: d})
    }, m.prototype.updateCtx = function() {
        var t = i.mainCtx;
        t.clearRect(0, 0, s, a), t.save(), p = Math.min(s / n.realWidth, a / n.realHeight), t.scale(p * l, p * l), t.translate(h.x / (p * l), h.y / (p * l)), t.drawImage(n, 0, 0);
        Math.round(BABYLON.Vector2.Distance(d[0], d[1]));
        t.restore(), t.save(), t.scale(l, l), t.translate(h.x / l, h.y / l), hcsdesign.engine2D.symbols2D.drawMeasure(t, d[0], d[1], o + "cm", "#6E910F"), t.restore()
    }, m.close = function() {
        i && i.close()
    }, m.show = function() {
        if (null == i) {
            i = new hcs.UI.BackgroundPopup({}, {title: _("Choose Background")}), i.initialize();
            var e = t("input", "", "file");
            e.setAttribute("type", "file");
            var r = t("input", "", "scale");
            r.setAttribute("style", "width:100px"), cb = t("input"), cb.setAttribute("type", "checkbox"), cb.setAttribute("checked", "checked"), cb.addEventListener("click", i.handleVisibility, !1), r.addEventListener("change", i.handleScale, !1), r.setAttribute("value", o), e.addEventListener("change", i.handleFileSelect, !1);
            var l = t("div", "warning");
            l.innerHTML = _("Note: your jpg/png won't be saved, and won't be reloaded after use");
            var h = t("div");
            h.innerHTML = "<strong>" + _("Step") + " 1</strong>: " + _("Select your file (jpg, png)") + "  ", h.appendChild(e);
            var c = t("div");
            c.innerHTML = "<strong>" + _("Step") + " 2</strong>: " + _("Drag the arrow and enter the corresponding measure (in cm)") + " ", c.appendChild(r);
            var u = t("div");
            u.innerHTML = "<strong>" + _("Step") + " 3</strong>: " + _("Enable / Disable background"), u.appendChild(cb), i.mainContent.appendChild(l), i.mainContent.appendChild(h), i.mainContent.appendChild(c), n = new Image, n.src = "data:image/gif;base64,R0lGODlhAQABAIAAAP7//wAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==", n.realWidth = s, n.realHeight = a, i.mainContent.appendChild(i.mainCanvas), i.mainContent.appendChild(u)
        }
        i.show()
    }, m.prototype.updateImgSize = function() {
        var t = new Image;
        t.src = n.src, t.setAttribute("style", "position:absolute;top:-1000000000px"), i.mainContent.appendChild(t), t.onload = function() {
            n.realWidth = t.width, n.realHeight = t.height, i.updateCtx(), i.updateGrid(), t.parentNode.removeChild(t), delete t
        }
    }, m.prototype.handleVisibility = function(t) {
        r = t.target.checked ? !0 : !1, i.updateGrid()
    }, m.prototype.handleScale = function(t) {
        o = t.target.value, i.updateGrid(), i.updateCtx()
    }, m.prototype.handleFileSelect = function(t) {
        var e = t.target.files, o = e[0], r = new FileReader;
        r.readAsDataURL(o), r.onloadend = function() {
            n.src = r.result, i.updateImgSize(), i.updateCtx()
        }
    }, m.prototype.show = function() {
        this.initialize(), this.domElement.style.display = "block"
    }, m.prototype.close = function() {
        ujs.notify("hcs.ui.frame.close"), this.domElement.style.display = "none", ujs.notify("hcs.menu.main.deselect")
    }, m
}();

var hcs = window.hcs || {};
hcs.UI = hcs.UI || {}, hcs.UI.ColorPopup = function() {
    function t(t, e, n) {
        var i = document.createElement(t);
        return n && i.setAttribute("id", n), e && i.setAttribute("class", e), i
    }
    var e = null, n = {}, i = 0, o = function() {
    }, r = function(t) {
        var t = t || {};
        t.autoSize = t.autoSize === !1 ? !1 : !0, t.width = 215, t.height = 200, hcs.UI.Frame.call(this, t)
    };
    return r.prototype = new hcs.UI.Frame, r.prototype.addColorItems = function(e) {
        for (var n, o, r = 0; r < e.length; r++)
            n = e[r].params.color, o = t("div", "luxens"), r == i && o.classList.add("selected"), o.setAttribute("rel", r), o.style.backgroundColor = "rgb(" + Math.round(255 * n.r) + "," + Math.round(255 * n.g) + "," + Math.round(255 * n.b) + ")", this.mainContent.appendChild(o), o.addEventListener("click", this.onItemClick, !1)
            }, r.prototype.onItemClick = function(t) {
                e.close(), i = t.target.getAttribute("rel"), o && o.call(this, i, n[i].params.color), ujs.notify("hcs.core.colorSelected", {id: i,color: n[i].params.color})
            }, r.prototype.buildHTML = function() {
                this.config.layout || "horizontal";
                this.domElement = t("div", "window", "colorPopup"), this.header = t("header", "window-title"), this.closeWindow = t("span", "window-close"), this.config.showCloseButton === !1 && (this.closeWindow.style.display = "none"), this.header.appendChild(this.closeWindow), this.headerTitle = t("h1");
                var i = t("span", "window-title-text");
                i.innerHTML = this.content.title || _("Colors"), this.headerTitle.appendChild(i), this.header.appendChild(this.headerTitle), this.domElement.appendChild(this.header), this.mainContent = t("div", "window-content"), n = LuxensComponent3D.getLuxens(), this.addColorItems(n), this.domElement.appendChild(this.mainContent), e.setPosition(window.innerWidth - this.windowSize.width - 260, 0), this.domElement.style.width = this.windowSize.width + "px", this.domElement.style.height = window.innerHeight + "px"
            }, r.show = function(t, r) {
                null == e && (e = new hcs.UI.ColorPopup({}, {title: _("colors")}), e.initialize()), i = r || i, e.mainContent.innerHTML = "", e.addColorItems(n), o = t || function() {
                }, e.show()
            }, r.prototype.show = function() {
                this.initialize(), this.domElement.style.display = "block"
            }, r
}();

var hcs = window.hcs || {};
hcs.UI = hcs.UI || {}, hcs.UI.HelpBubble = function() {
    var t = function() {
        this._isVisible = !1, this._e_bubble = document.getElementById("helpbubble"), this._e_image = document.getElementById("helpbubble-image"), this._e_content = document.getElementById("helpbubble-content"), this._image = "", this._content = "", document.getElementById("helpbubble-close").onclick = this.hide.bind(this)
    };
    return t.prototype.newBubble = function(t, e, n) {
        t && (this._image = t), e && (this._content = e), n && this.show()
    }, t.prototype.show = function() {
        this._isVisible ? (this.hide(), window.setTimeout(this.show.bind(this), 600)) : (this._isVisible = !0, this._e_image.src = this._image, this._e_content.innerHTML = this._content, this._e_bubble.setAttribute("class", "visible"))
    }, t.prototype.hide = function() {
        this._isVisible = !1, this._e_bubble.setAttribute("class", "")
    }, t
}();
var hcs = window.hcs || {};
hcs.UI = hcs.UI || {}, hcs.UI.HelpBubbleManager = function() {
    var t = function(t) {
        this.helpBubble = new hcs.UI.HelpBubble, this._enabled = "boolean" == typeof t ? t : !0, this._bubbles = {"hcs.2d.wall-basics": {image: "hcs.2d.wall-basics.gif",content: "<strong>" + _("Walls") + "</strong><ul><li>" + _("Move a wall with a drag &amp; drop.") + "</li><li>" + _("Cut a wall with a double-click.") + "</li></ul>",disp: !1},"hcs.2d.menu": {image: _("hcs.2d.menu-C.gif"),content: "",disp: !1},"hcs.2d.subslope": {image: "hcs.2d.subslope.gif",content: "<strong>" + _("Create Subslopes") + "</strong><ul><li>" + _("Pull the grips to create subslopes.") + "</li><li>" + _("Right-click on a grip to configure the subslope.") + "</li></ul>",disp: !1},"hcs.2d.draw-wall": {image: "hcs.2d.draw-wall.gif",content: "<strong>" + _("Draw Walls") + "</strong><ul><li>" + _("Click to add a point.") + "</li><li>" + _("Click again on your last point to terminate the wall.") + "</li></ul>",disp: !1},"hcs.2d.dup-overture": {image: "hcs.2d.dup-overture.gif",content: "<strong>" + _("Opening Duplication") + "</strong>" + _("Double-click on an opening to duplicate it."),disp: !1},"hcs.2d.draw-staires": {image: "hcs.2d.draw-staires.gif",content: "<strong>" + _("Draw Staireway") + "</strong><ul><li>" + _("Click to add a step.") + "</li><li>" + _("Double-click to terminate the stairway.") + "</li></ul>",disp: !1},"hcs.2d.properties": {image: "hcs.2d.properties.gif",content: "<strong>" + _("Items Settings") + "</strong><ul><li>" + _("You can configure any item of your plan (doors, windows, walls, etc.) by clicking on it.") + "</li><li>" + _("The setting window also allow you to remove any item from your plan.") + "</li></ul>",disp: !1},"hcs.2d.subslopeOverture-menu": {image: "hcs.2d.dormer.png",content: "<strong>" + _("Items Settings") + "</strong><ul><li>" + _("You can configure some parameters of your dormer (height, width, height of roof, etc.) by clicking on it.") + "</li><li>" + _("1: height, 2: height of roof, 3: length of the hole, 4: width") + "</li></ul>",disp: !1},"hcs.3d.paint": {image: "hcs.3d.paint.gif",content: "<strong>" + _("Decorate") + "</strong><ul><li>" + _("Click on a wall to paint it.") + "</li><li>" + _("You can paint objects too.") + "</li></ul>",disp: !1}}, this._load()
    };
    return t.prototype.setActive = function(t) {
        this._enabled = t
    }, t.prototype.display = function(t, e) {
//         !this._enabled || !e && this._bubbles[t].disp || (this._bubbles[t].disp = !0, this.helpBubble.newBubble("http://v2.hcsdesign.fr/images/help/" + this._bubbles[t].image, this._bubbles[t].content, !0), this._save())
    }, t.prototype.alreadyDisplayed = function(t) {
        return this._bubbles[t].disp
    }, t.prototype._save = function() {
        var t = [];
        for (var e in this._bubbles)
            this._bubbles[e].disp && t.push(e);
        hcsLocalStorage["wanadev.planner.helpbubble"] = JSON.stringify(t)
    }, t.prototype._load = function() {
        if (hcsLocalStorage["wanadev.planner.helpbubble"]) {
            var t = JSON.parse(hcsLocalStorage["wanadev.planner.helpbubble"]);
            for (var e in t)
                this._bubbles[t[e]] && (this._bubbles[t[e]].disp = !0)
                }
    }, t
}();
var hcs = window.hcs || {};
hcs.UI = hcs.UI || {}, hcs.UI.RemoteController = function() {
    var t, e = document.getElementById("modalWidgets"), n = function(n, i) {
        function o() {
            if (++l > t.repeat) {
                if (l = 0, null != t.buttonState) {
                    var e = t.buttonState, n = e.target.getAttribute("class");
                    null == n && (n = e.target.parentNode.getAttribute("class"));
                    var i = n.split(" ")[1];
                    switch (i) {
                        case "up":
                            t.setDirection(i);
                            break;
                        case "down":
                            t.setDirection(i);
                            break;
                        case "left":
                            t.setDirection(i);
                            break;
                        case "right":
                            t.setDirection(i);
                            break;
                        case "zoomup":
                            t.addZoom(-1);
                            break;
                        case "zoomdown":
                            t.addZoom(1)
                    }
                }
                requestAnimationFrame(o)
            }
        }
        e = document.getElementById("modalWidgets");
        var n = n || {}, i = i || {};
        this.addedToDomElement = i.domElement || e, this.imagePath = i.imagePath || "../images/remote-controller/", this.domElement = this.buildHTML(), this.defaultDomStyle = "top: " + (i.y || 10) + "px;left: " + (i.x || 10) + "px;", this.domElement.setAttribute("style", this.defaultDomStyle), this.addedToDomElement.appendChild(this.domElement), this.buttons = document.getElementsByClassName("remote-button"), this.slider = document.getElementById("remote-slider"), this.sliderContainer = document.getElementById("remote-slider-content"), this.globalSliderContainer = document.getElementById("remote-slider-bar"), this.globalSliderContainerHeight = this.globalSliderContainer.scrollHeight, this.buttonHeight = this.buttons;
        var r = 35;
        this.zoom = {min: 21,max: 129,reference: r,value: r,lastValue: r,setValue: function(t) {
            this.lastValue = this.value, t > this.min && t < this.max && (this.value = t)
        },setRelativeValue: function(t) {
            this.lastValue = this.value, t >= 0 && 1 >= t && (this.value = t * (this.max - this.min) + this.min)
        },addValue: function(t) {
            this.setValue(this.value + t)
        },getValue: function() {
            return this.value
        },getRelativeValue: function() {
            return (this.value - this.min) / (this.max - this.min)
        },getRelativeDeltaValue: function() {
            return (this.value - this.lastValue) / (this.max - this.min)
        },getDelta: function() {
            return this.value - this.lastValue
        }}, this.callbacks = {zoom: n.zoomChanged || null,direction: n.directionChanged || null,camera: n.cameraChanged || null}, t = this;
        for (var s = 0, a = this.buttons.length; a > s; s++)
            this.buttons[s].addEventListener("mousedown", function(e) {
                                             t.onButtonMouseDown(e, t)
                                             }, !1), this.buttons[s].addEventListener("mouseup", function(e) {
                                                                                      t.onButtonMouseUp(e, t)
                                                                                      }, !1), this.buttons[s].addEventListener("click", function(e) {
                                                                                                                               t.onButtonClick(e, t)
                                                                                                                               }, !1);
        this.slider.addEventListener("mousedown", function(e) {
                                     t.onSliderMouseDown(e, t)
                                     }, !1), document.body.addEventListener("mousemove", function(e) {
                                                                            t.onSliderMouseMove(e, t)
                                                                            }, !1), document.body.addEventListener("mouseup", function(e) {
                                                                                                                   t.onMouseUp(e, t)
                                                                                                                   }, !1), document.addEventListener("hcs.keyboardManager.keyDown", t.onKeyDown, !0), this.sliderSelected = !1, this.updateSliderPos(), this.mouse = {y: 0,lastY: 0,getDelta: function() {
            return this.y - this.lastY
        }}, o(), this.buttonState = null, this.running = !0, this.repeat = 3;
        var l = 0;
        o()
    };
    return n.prototype.buildHTML = function() {
        var t = document.createElement("div");
        t.setAttribute("id", "remote-controller");
        var e = document.createElement("div");
        e.setAttribute("id", "remote-buttons");
        for (var n = ["up", "down", "left", "right"], i = 0; 4 > i; i++) {
            var o = document.createElement("a");
            o.setAttribute("href", "javascript:void(0);"), o.setAttribute("class", "remote-button " + n[i]);
            var r = document.createElement("img");
            r.setAttribute("src", this.imagePath + n[i] + ".png"), o.appendChild(r), e.appendChild(o)
        }
        t.appendChild(e);
        var s = document.createElement("a");
        s.setAttribute("href", "javascript:void(0);"), s.setAttribute("class", "remote-button camera");
        var a = document.createElement("img");
        a.setAttribute("src", this.imagePath + "camera.png"), s.appendChild(a), t.appendChild(s);
        var l = document.createElement("div");
        l.setAttribute("id", "remote-slider-bar");
        var h = document.createElement("a");
        h.setAttribute("href", "javascript:void(0);"), h.setAttribute("class", "remote-button zoomup");
        var c = document.createElement("img");
        c.setAttribute("src", this.imagePath + "zoom-up.png"), h.appendChild(c), l.appendChild(h);
        var u = document.createElement("div");
        u.setAttribute("id", "remote-slider-content");
        var p = document.createElement("img");
        p.setAttribute("id", "remote-slider"), p.setAttribute("src", this.imagePath + "zoom-cursor.png"), u.appendChild(p), l.appendChild(u);
        var d = document.createElement("a");
        d.setAttribute("href", "javascript:void(0);"), d.setAttribute("class", "remote-button zoomdown");
        var m = document.createElement("img");
        return m.setAttribute("src", this.imagePath + "zoom-down.png"), d.appendChild(m), l.appendChild(d), t.appendChild(l), t
    }, n.prototype.onKeyDown = function(e) {
        var n = e.keyCode;
        switch (n) {
            case 37:
                t.setDirection("left");
                break;
            case 38:
                t.setDirection("up");
                break;
            case 39:
                t.setDirection("right");
                break;
            case 40:
                t.setDirection("down")
        }
    }, n.prototype.updateDomPosition = function(t, e) {
        this.defaultDomStyle = "top: " + e + "px;left: " + t + "px;", this.domElement.setAttribute("style", this.defaultDomStyle)
    }, n.prototype.kill = function(t) {
        for (var t = "undefined" != typeof t ? t : !0, e = this, n = 0, i = this.buttons.length; i > n; n++)
            this.buttons[n].removeEventListener("mousedown", function(t) {
                                                e.onButtonMouseDown(t, e)
                                                }), this.buttons[n].removeEventListener("mouseup", function(t) {
                                                                                        e.onButtonMouseUp(t, e)
                                                                                        }), this.buttons[n].removeEventListener("click", function(t) {
                                                                                                                                e.onButtonClick(t, e)
                                                                                                                                });
        this.slider.removeEventListener("mousedown", function(t) {
                                        e.onSliderMouseDown(t, e)
                                        }), document.body.removeEventListener("mousemove", function(t) {
                                                                              e.onSliderMouseMove(t, e)
                                                                              }), document.body.removeEventListener("mouseup", function(t) {
                                                                                                                    e.onMouseUp(t, e)
                                                                                                                    }), this.running = !1, t && null !== this.domElement.parentNode && this.addedToDomElement.removeChild(this.domElement)
    }, n.prototype.onButtonMouseDown = function(t, e) {
        e.buttonState = t
    }, n.prototype.onButtonMouseUp = function(t, e) {
        e.buttonState = null
    }, n.prototype.onButtonClick = function(t, e) {
        var n = t.target.getAttribute("class");
        null == n && (n = t.target.parentNode.getAttribute("class"));
        var i = n.split(" ")[1];
        switch (i) {
            case "camera":
                e.changeCamera();
                break;
            case "up":
                e.setDirection(i);
                break;
            case "down":
                e.setDirection(i);
                break;
            case "left":
                e.setDirection(i);
                break;
            case "right":
                e.setDirection(i);
                break;
            case "zoomup":
                e.addZoom(-1);
                break;
            case "zoomdown":
                e.addZoom(1)
        }
    }, n.prototype.show = function() {
        this.domElement.setAttribute("style", this.defaultDomStyle)
    }, n.prototype.hide = function() {
        this.domElement.setAttribute("style", "display:none;")
    }, n.prototype.onSliderMouseDown = function(t, e) {
        t.preventDefault(), e.sliderSelected = !0
    }, n.prototype.onSliderMouseMove = function(t, e) {
        e.mouse.lastY = e.mouse.y, e.mouse.y = void 0 !== t.y ? t.y : t.clientY, e.sliderSelected && this.addZoom(e.mouse.getDelta())
    }, n.prototype.onMouseUp = function(t, e) {
        e.sliderSelected = !1
    }, n.prototype.reset = function() {
        this.zoom.value = this.zoom.reference, this.updateSliderPos()
    }, n.prototype.addZoom = function(t) {
        this.zoom.addValue(t), this.updateSliderPos(), null != this.callbacks.zoom && this.callbacks.zoom(this.zoom.getRelativeDeltaValue())
    }, n.prototype.setDirection = function(t) {
        null != this.callbacks.direction && this.callbacks.direction(t)
    }, n.prototype.changeCamera = function() {
        null != this.callbacks.camera && this.callbacks.camera()
    }, n.prototype.updateZoom = function(t) {
        this.zoom.setRelativeValue(t), this.updateSliderPos()
    }, n.prototype.updateSliderPos = function() {
        this.slider.style.top = this.zoom.getValue() + "px"
    }, n
}();
var hcs = window.hcs || {};
hcs.UI = hcs.UI || {}, hcs.UI.MessageBox = function() {
    var t = document.getElementById("modalWidgets"), e = !1, n = null, i = function(e) {
        var e = e || {}, i = this;
        t = document.getElementById("modalWidgets"), e.buttonAText = e.buttonAText || _("Ok"), e.buttonBText = e.buttonBText || _("Cancel"), e.buttonCText = e.buttonCText || _("Cancel"), e.inputType = e.inputType || "text", e.inputValue = e.inputValue || "", e.inputPlaceHolder = e.inputPlaceHolder || "", e.textAreaValue = e.textAreaValue || "", e.textAreaPlaceHolder = e.textAreaPlaceHolder || "", this.showButtonA = "undefined" != typeof e.buttonA ? e.buttonA : !1, this.showButtonB = "undefined" != typeof e.buttonB ? e.buttonB : !1, this.showButtonC = "undefined" != typeof e.buttonC ? e.buttonC : !1, this.showInput = "undefined" != typeof e.input ? e.input : !1, this.showTextArea = "undefined" != typeof e.textArea ? e.textArea : !1, this.closeCallback = e.onClose || function() {
        }, this.button1Callback = e.onClickA || function() {
        }, this.button2Callback = e.onClickB || function() {
        }, this.button3Callback = e.onClickC || function() {
        }, this.destroyAfterClose = "undefined" != typeof e.destroyAfterClose ? e.destroyAfterClose : !1, this.overlay = "undefined" != typeof e.overlay ? e.overlay : !1, this.opacity = e.opacity || 0, this.messageBox = document.createElement("div"), this.messageBox.setAttribute("id", "messageBox"), this.messageBox.setAttribute("class", "window"), this.header = document.createElement("header"), this.header.setAttribute("class", "window-title"), this.closeHeader = document.createElement("span"), this.closeHeader.setAttribute("class", "window-close"), this.closeHeader.addEventListener("click", function() {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              hcs.UI.MessageBox.close(), i.closeCallback.call(i)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              }, !1), this.header.appendChild(this.closeHeader), this.headerContent = document.createElement("h1"), this.header.appendChild(this.headerContent), this.content = document.createElement("p"), this.content.setAttribute("class", "mb-content window-content"), this.input = document.createElement("input"), this.input.setAttribute("class", "mb-input"), this.input.setAttribute("type", e.inputText), this.input.setAttribute("value", e.inputValue), this.input.setAttribute("placeholder", e.inputPlaceHolder), this.input.addEventListener("click", this.onInputClick, !1), this.showInput || this.input.setAttribute("style", "display:none;"), this.textArea = document.createElement("textarea"), this.textArea.setAttribute("class", "mb-textarea"), this.textArea.setAttribute("placeholder", e.textAreaPlaceHolder), this.textArea.style.display = "block", this.textArea.style.margin = "5px auto", this.textArea.style.width = "90%", this.textArea.style.height = "60px", this.textArea.innerHTML = e.textAreaValue, this.showTextArea || (this.textArea.style.display = "none"), this.buttonA = document.createElement("button"), this.buttonA.setAttribute("id", "mb-button-a"), this.buttonA.addEventListener("click", function(t) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               i.onClick(t, i)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               }, !1), this.buttonA.innerHTML = e.buttonAText, this.showButtonA || this.buttonA.setAttribute("style", "display:none;"), this.buttonB = document.createElement("button"), this.buttonB.setAttribute("id", "mb-button-b"), this.buttonB.addEventListener("click", function(t) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       i.onClick(t, i)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       }, !1), this.buttonB.innerHTML = e.buttonBText, this.showButtonB || this.buttonB.setAttribute("style", "display:none;"), this.buttonC = document.createElement("button"), this.buttonC.setAttribute("id", "mb-button-c"), this.buttonC.addEventListener("click", function(t) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               i.onClick(t, i)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               }, !1), this.buttonC.innerHTML = e.buttonCText, this.showButtonC || this.buttonC.setAttribute("style", "display:none;"), this.buttonsContainer = document.createElement("div"), this.buttonsContainer.setAttribute("class", "window-action-bar"), this.buttonsContainer.appendChild(this.buttonA), this.buttonsContainer.appendChild(this.buttonB), this.buttonsContainer.appendChild(this.buttonC), this.messageBox.appendChild(this.header), this.messageBox.appendChild(this.content), this.messageBox.appendChild(this.input), this.messageBox.appendChild(this.textArea), this.messageBox.appendChild(this.buttonsContainer), t.appendChild(this.messageBox), this.autoHideInterval = null, n = this;
        var i = this;
        document.addEventListener("hcs.request.closePopup", function() {
                                  n = n == this ? null : n, i.destroy()
                                  }, !1)
    };
    return i.prototype.destroy = function() {
        var n = this;
        this.buttonA.removeEventListener("click", function(t) {
                                         n.onClick(t, n)
                                         }), this.buttonB.removeEventListener("click", function(t) {
                                                                              n.onClick(t, n)
                                                                              }), this.buttonC.removeEventListener("click", function(t) {
                                                                                                                   n.onClick(t, n)
                                                                                                                   }), this.headerContent.innerHTML = "", this.content.innerHTML = "", this.messageBox.setAttribute("style", "display:none;"), e && ujs.notify("hcs.ui.messagebox.closed"), e = !1, null !== this.messageBox.parentNode && t.removeChild(this.messageBox)
    }, i.prototype.onClick = function(t, e) {
        if (e.messageBox.setAttribute("style", "display:none;"), "undefined" != typeof t.clearInterval && t.clearInterval && clearInterval(e.autoHideInterval), null != e.closeCallback && (params = {textInput: e.input.value}, e.closeCallback(params)), "undefined" != typeof t.target) {
            t.textInput = e.input.value, t.textAreaInput = e.textArea.value;
            var n = t.target.id;
            "mb-button-a" == n && null != e.button1Callback && e.button1Callback(t), "mb-button-b" == n && null != e.button2Callback && e.button2Callback(t), "mb-button-c" == n && null != e.button3Callback && e.button3Callback(t)
        }
        e.destroyAfterClose && e.destroy()
    }, i.prototype.onInputClick = function() {
        this.value = ""
    }, i.prototype.open = function(t) {
        var t = t || {}, n = "undefined" != typeof t.force ? t.force : !1;
        if (!e || n) {
            e = !0;
            var i = t.autoHide || !1, o = t.hideTime || 1500, r = t.width || 250, s = t.height || !1, a = t.x || window.innerWidth / 2 - r / 2, l = t.y || window.innerHeight / 2 - s / 2, h = t.title || "", c = t.message || "";
            this.headerContent.innerHTML = h, c instanceof HTMLElement ? (this.content.innerHTML = "", this.content.appendChild(c)) : this.content.innerHTML = c, this.showInput && (s += 30), (this.showButtonA || this.showButtonB) && (s += 30);
            var u = "display:block;width:" + r + "px;top:" + l + "px;left:" + a + "px;";
            if (s && (u += "width:" + r + "px;"), this.messageBox.setAttribute("style", u), !this.showInput && "string" == typeof c && GlobalHelper.isMobileDevice()) {
                this.content.classList.add(/<form|<ul|<table/.test(c) ? "message-incFontSize" : "message-center");
                var p = this.content.getBoundingClientRect();
                this.content.style.top = Math.floor(window.innerHeight / 2 - p.height / 2) + "px"
            }
            var d = this;
            i && (this.autoHideInterval = setInterval(function() {
                                                      d.onClick({clearInterval: !0}, d)
                                                      }, o)), ujs.notify("hcs.ui.messagebox.opened")
        }
    }, i.prototype.close = function() {
        var t = "";
        this.defaultStyles && this.defaultStyles.box && (t = this.defaultStyles.box), this.messageBox.setAttribute("style", t + "display:none"), e = !1, ujs.notify("hcs.ui.messagebox.closed")
    }, i.close = function() {
        null != n && (n.close(), n.destroy(), n = null)
    }, i.show = function(t) {
        var t = t || {}, n = "undefined" == typeof t.force ? !1 : t.force;
        if (!e || n) {
            var t = t || {};
            t.autoHide = t.autoHide || !1, t.hideTime = t.hideTime || 2500, t.width = t.width || null, t.height = t.height || null, t.x = t.x || null, t.y = t.y || null, t.title = t.title || "", t.message = t.message || "", t.inputValue = t.inputValue || "", t.openCallback = t.openCallback || function() {
            };
            var i = {destroyAfterClose: !0,onClose: t.onClose || null,onClickA: t.onClickA || null,onClickB: t.onClickB || null,onClickC: t.onClickC || null,buttonA: "undefined" != typeof t.buttonA ? t.buttonA : !1,buttonAText: t.buttonAText || null,buttonB: "undefined" != typeof t.buttonB ? t.buttonB : !1,buttonBText: t.buttonBText || null,buttonC: "undefined" != typeof t.buttonC ? t.buttonC : !1,buttonCText: t.buttonCText || null,input: "undefined" != typeof t.input ? t.input : !1,inputValue: t.inputValue,inputPlaceHolder: t.inputPlaceHolder,textArea: "undefined" != typeof t.textArea ? t.textArea : !1,textAreaValue: t.textAreaValue,textAreaPlaceHolder: t.textAreaPlaceHolder,opacity: t.opacity || 0,overlay: t.overlay || !1}, o = new hcs.UI.MessageBox(i);
            o.open(t), t.openCallback()
        }
    }, i
}();

var hcs = window.hcs || {};
hcs.UI = hcs.UI || {}, hcs.UI.Menu = function() {
    function t(t) {
        var e = [];
        return e.push("background-color:rgb("), e.push(Math.floor(255 * t.r)), e.push(", "), e.push(Math.floor(255 * t.g)), e.push(", "), e.push(Math.floor(255 * t.b)), e.push(")"), e.join("")
    }
    var e = 0, n = function(t, e, n) {
        this.json = t || [], this.domElement = document.getElementById(e), this.params = n || {}, this.selected = this.params.selected || !1, this.inception = this.params.inception === !1 ? !1 : !0, this.oneClick = this.params.oneClick === !0 ? !0 : !1, this.initialize()
    };
    return n.prototype.initialize = function() {
        this.updateHtml()
    }, n.prototype.getWidth = function() {
        return this.domElement.offsetWidth || 0
    }, n.prototype.updateHtml = function(t) {
        if (t && t.id) {
            var e = this.domElement.querySelector("#" + t.id), n = this.buildItem(t, e.nodeName);
            e.parentNode.replaceChild(n, e)
        } else {
            this.domElement.innerHTML = "";
            for (var n, i = 0; i < this.json.length; i++)
                n = this.buildItem(this.json[i], "li"), this.domElement.appendChild(n)
                }
    }, n.prototype.buildItem = function(n, i) {
        var o = document.createElement(i);
        if (n.id = "undefined" != typeof n.id ? n.id : "item" + e++, o.id = n.id, n.noTitle = !1, 1 == n.texture) {
            var r = document.createElement("span");
            r.setAttribute("class", "menu-icon");
            var s = n.translations ? _(n.title, n.translations) : _(n.title);
            if (n.params.url) {
                n.noTitle = !0;
                var a = document.createElement("img"), l = n.icon || n.params.url;
                a.setAttribute("src", l), a.setAttribute("title", s), r.appendChild(a), o.appendChild(r)
            } else
                n.params.color && (n.noTitle = !0, r.setAttribute("style", t(n.params.color)), r.setAttribute("title", s), o.appendChild(r));
            if (n.colorable) {
                var h = document.createElement("div");
                h.setAttribute("class", "colorChooser");
                var c = t(n.params.addColor && n.params.addColor.color ? n.params.addColor.color : {r: 137 / 255,g: 115 / 255,b: 100 / 255});
                h.setAttribute("style", c), r.appendChild(h), r.classList.add("colorable"), h.item = n, h.addEventListener("click", this.onColorChooserClick.bind(this), !1)
            }
        } else if (n.icon) {
            var r = document.createElement("span");
            r.setAttribute("class", "menu-icon"), r.innerHTML = -1 == n.icon.indexOf(".") ? "<i class='" + n.icon + "'></i>" : "<img src='" + n.icon + "' />", o.appendChild(r)
        }
        if (n.title && n.noTitle === !1) {
            var s = n.translations ? _(n.title, n.translations) : _(n.title), u = document.createElement("span");
            u.setAttribute("class", "menu-title"), u.innerHTML = s, o.appendChild(u)
        }
        if (o.classList.add("menu-item"), n.context && o.classList.add("label-" + n.context), n == this.selected && o.classList.add("selected"), n.addClass)
            for (var p = n.addClass.split(" "), d = 0; d < p.length; d++)
                o.classList.add(p[d]);
        if (n.items && n.items.length > 0 && this.inception) {
            var m, g = document.createElement("ul");
            g.classList.add(n.layout), o.classList.add("menu-subitem"), n == this.selected && o.classList.add("opened");
            for (var f = 0; f < n.items.length; f++)
                n.items[f] == this.selected && o.classList.add("opened"), m = this.buildItem(n.items[f], "li"), g.appendChild(m);
            o.appendChild(g)
        }
        return o.addEventListener("click", function(t) {
                                  "UL" != t.target.tagName && (this.selected == n || o.classList.contains("opened") ? (this.deselect(), this.deselectElement(o)) : (ujs.notify("hcs.menu.click", this.buildEventItem(n)), (this.oneClick === !1 || n.selectionnable === !0) && (this.selected = n, this.selectElement(o)), n.action && ujs.notify(n.action, this.buildEventItem(n))), t.stopPropagation())
                                  }.bind(this), !1), o
    }, n.prototype.selectElement = function(t) {
        for (var e = this.domElement.querySelectorAll(".selected"), n = 0; n < e.length; n++)
            e[n].classList.remove("selected");
        t.classList.add("selected"), t.classList.contains("menu-subitem") && t.classList.add("opened")
    }, n.prototype.deselectElement = function(t) {
        t.classList.remove("selected"), t.classList.contains("menu-subitem") && t.classList.remove("opened")
    }, n.prototype.onColorChooserClick = function(t) {
        var e = t.target, n = e.item, i = function(t, i) {
            e.style.backgroundColor = "rgb(" + Math.round(255 * i.r) + "," + Math.round(255 * i.g) + "," + Math.round(255 * i.b) + ")";
            var o = n.params;
            o.addColor = {color: i}, n.colorId = t, this.selected = n, n.action && ujs.notify(n.action, this.buildEventItem(n))
        };
        hcs.UI.ColorPopup.show(i.bind(this), n.colorId), t.stopPropagation()
    }, n.prototype.buildEventItem = function(t) {
        var e = {};
        for (var n in t)
            e[n] = t[n];
        for (var n in t.params)
            e[n] = t.params[n];
        return delete e.items, e
    }, n.prototype.deselect = function(t, e) {
        var t = t || !1, e = e || !1;
        if (!this.selected || !e || this.selected.id === e) {
            if (this.selected.cancelAction) {
                var n = this.buildEventItem(this.selected);
                n.from = "deselect", ujs.notify(this.selected.cancelAction, n)
            }
            this.getDomItemById(this.selected.id) && this.deselectElement(this.getDomItemById(this.selected.id)), this.selected = t ? !1 : this.getParent(this.selected)
        }
    }, n.prototype.getParent = function(t) {
        for (var e = 0; e < this.json.length; e++)
            for (var n in this.json[e].items)
                if (this.json[e].items[n] == t)
                    return this.json[e];
        return !1
    }, n.prototype.deleteMenuItem = function(t) {
        var e = function(e, n) {
            return e.id == t ? n : !1
        }, n = this.traverse(this.json, void 0, e);
        if (n) {
            for (var i = this.json; n.length > 1; )
                i = i[n.shift()].items;
            i.splice(n[0], 1)
        }
    }, n.prototype.replaceMenuItem = function(t, e, n) {
        var i = this, n = n || !1, e = e || {}, o = function(o, r) {
            if (o.id == t) {
                var s = e;
                n === !0 && (s = ujs.mergeObjects(o, e, !0)), o == this.selected && (this.selected = s);
                var a = r.join(".items.");
                ujs.setProperty(i.json, a, s);
                for (var l in s)
                    e[l] = s[l];
                return !0
            }
            return !1
        };
        this.traverse(this.json, o)
    }, n.prototype.addMenuItem = function(t, e) {
        if (e.items || (e.items = []), "." !== t) {
            t = this.cleanPath(t);
            var n = ujs.getProperty(this.json, t);
            if (n !== !1 && "undefined" != typeof n) {
                if (e instanceof Array)
                    for (var i = 0; i < e.length; i++)
                        n.push(e[i]);
                else
                    n.push(e);
                this.sortJson(n)
            } else
                ujs.setProperty(this.json, t, e)
                } else
                    this.json.push(e), this.sortJson(this.json);
        this.updateHtml()
    }, n.prototype.getDomItemById = function(t) {
        if (t) {
            t = t.id || t;
            for (var e = this.domElement.getElementsByClassName("menu-item"), n = e.length; n--; )
                if (e[n].id == t)
                    return e[n]
                    }
    }, n.prototype.searchItem = function(t) {
        var e = function(e) {
            return e.id == t ? e : !1
        }, n = this.traverse(this.json, void 0, e);
        return n ? n : !1
    }, n.prototype.sortJson = function(t) {
        t && t.length > 0 && t.sort(function(t, e) {
                                    return t.index - e.index
                                    })
    }, n.prototype.traverse = function(t, e, n, i) {
        for (var e = e || function() {
             }, n = n || function() {
             return !1
             }, i = i || [], o = 0; o < t.length; o++) {
            if (e(t[o], i.concat(o)), n(t[o], i) !== !1)
                return i.push(o), n(t[o], i);
            if (t[o].items && t[o].items.length > 0) {
                var r = ujs.cloneArray(i);
                r.push(o);
                var s = this.traverse(t[o].items, e, n, r);
                if (s)
                    return s
                    }
        }
    }, n.prototype.getIdFromIdentifier = function(t) {
        var e = function(e, n) {
            return e.id == t ? n[n.length - 1] : !1
        }, n = this.traverse(this.json, void 0, e);
        return n ? n : 0
    }, n.prototype.cleanPath = function(t) {
        for (var t = t || "", e = t.split("."), n = 0; n < e.length; n++)
            isNaN(+e[n]) && (e[n] = this.getIdFromIdentifier(e[n]));
        return t = e.join(".items.") + ".items"
    }, n
}();

var hcs = window.hcs || {};
hcs.UI = hcs.UI || {}, hcs.UI.LanguageSelector = function() {
    var t = null, e = "en", n = "", i = [{id: "en",label: "English (English)"}, {id: "es",label: "Spain (España)"}, {id: "fr",label: "French (Français)"}, {id: "pl",label: "Polish (Poland)"}, {id: "jp",label: "Japanese (Japan)"}], o = function() {
        hcs.UI.Frame.call(this, {maxWidth: 200,maxHeight: 220}, {title: _("Available languages")}), this.init = !1
    };
    return o.prototype = new hcs.UI.Frame, o.prototype.initialize = function() {
        if (hcs.UI.Frame.prototype.initialize.call(this), !this.init) {
            var t = [{title: _("Ok"),action: this.close.bind(this),label: _("Ok")}];
            this.setActionBar(t), this.init = !0, this.domElement.setAttribute("id", "languageSelector"), this.domElement.classList.add("language-selector");
            for (var n = document.getElementsByClassName("drawableSurface"), o = 0, r = n.length; r > o; o++)
                n[o].addEventListener("click", this.close, !1);
            var s = document.createElement("ul");
            s.setAttribute("class", "layout-list");
            var a = [];
            for (var o in i)
                a.push({label: i[o].label,groupName: "languages",isSelected: i[o].id == e ? !0 : !1,id: "lang_" + i[o].id,type: "radio",eventParams: this.onSelected});
            this.addForm(0, a, "Languages"), this.setLayout("vertical")
        }
    }, o.prototype.onSelected = function() {
        n = this.id.split("_")[1]
    }, o.show = function() {
        null == t && (t = new hcs.UI.LanguageSelector, t.initialize()), t._selectedLang = "", t.show()
    }, o.setLocal = function(t) {
        e = "C" == t ? "en" : t
    }, o.prototype.close = function() {
        t.domElement.style.display = "none", "" !== n && (hcsLocalStorage.setItem(hcs.Constants.LC_LANG_KEY, n), window.location.reload())
    }, o
}();
var hcs = window.hcs || {};
hcs.UI = hcs.UI || {}, hcs.UI.IFrame = function() {
    function t() {
        e.close(!0)
    }
    var e = null, n = function(t, n, i, o) {
        this.domElement = document.createElement("div"), this.domElement.setAttribute("id", "hcs-iframe"), this.domElement.style.width = window.innerWidth + "px", this.domElement.style.height = window.innerHeight + "px", this.iframeContainer = document.createElement("div"), this.iframeContainer.setAttribute("class", "hcs-iframe-container"), this.iframe = document.createElement("iframe"), this.iframe.setAttribute("seamless", "seamless"), this.iframe.setAttribute("sandbox", "allow-same-origin allow-scripts allow-top-navigation allow-popups  allow-forms"), this.parentNode = t, this.added = !1, this.closeOnClick = i && "undefined" != typeof i.closeOnClick ? i.closeOnClick : !1, this.closeCallback = o || function() {
        };
        for (var r in n)
            this.iframe[r] = n[r];
        this.closeButton = document.createElement("a"), this.closeButton.setAttribute("href", "#"), this.closeButton.setAttribute("class", "close-button");
        var s = document.createElement("img");
        s.setAttribute("src", "images/close-icon.png"), this.closeButton.appendChild(s);
        var i = i || {};
        i.showClose && this.iframeContainer.appendChild(this.closeButton), this.iframeContainer.appendChild(this.iframe), this.domElement.appendChild(this.iframeContainer), e = this, this.resize(n.width, n.height)
    };
    return n.prototype.open = function() {
        this.added || (this.iframeContainer.style.left = +(+window.innerWidth / 2) - +parseInt(this.iframeContainer.style.width) / 2 + "px", this.iframeContainer.style.top = +(+window.innerHeight / 2) - +parseInt(this.iframeContainer.style.height) / 2 + "px", this.parentNode.appendChild(this.domElement), this.closeButton.addEventListener("click", t, !0), this.closeOnClick && this.parentNode.addEventListener("click", t, !1), this.added = !0)
    }, n.prototype.close = function(n) {
        this.added && (this.parentNode.removeChild(e.domElement), this.closeButton.removeEventListener("click", t), this.closeOnClick && this.parentNode.removeEventListener("click", t), this.added = !1, this.closeCallback()), "boolean" == typeof n && delete this
    }, n.show = function(t, n, i) {
        hcs.UI.IFrame.close(), e = new hcs.UI.IFrame(t, n, i), e.open()
    }, n.close = function(t) {
        e && (e.close(t), e = null)
    }, n.prototype.resize = function(t, n) {
        var t = t, n = n;
        t && (t > hcsdesign.getWidth() - 40 && (t = hcsdesign.getWidth() - 40), e.iframeContainer.style.width = t + "px", e.iframe.setAttribute("width", t), e.iframeContainer.style.left = Math.round(+(+window.innerWidth / 2) - +parseInt(e.iframeContainer.style.width) / 2) + "px"), n && (n > hcsdesign.getHeight() - 40 && (n = hcsdesign.getHeight() - 40), e.iframeContainer.style.height = n + "px", e.iframe.setAttribute("height", n), e.iframeContainer.style.top = Math.round(+(+window.innerHeight / 2) - +parseInt(e.iframeContainer.style.height) / 2) + "px")
    }, n.resize = n.prototype.resize, n
}();
var hcs = window.hcs || {};
hcs.Input = hcs.Input || {}, hcs.Input.OrbitCamera = function () {
    var t = (BABYLON.Tools.GetPointerPrefix(), function (e, n, i, o, r, s) {
        BABYLON.Camera.call(this, e, BABYLON.Vector3.Zero(), s), this.alpha = n, this.beta = i, this.radius = o, this.target = r, this.enabled = !0, this.cameraTranslationenabled = !0, this._keys = [], this.keysUp = [38], this.keysDown = [40], this.keysLeft = [37], this.keysRight = [39], this._viewMatrix = new BABYLON.Matrix, t.prototype._initCache.call(this), this.getViewMatrix()
    });
    t.prototype = Object.create(BABYLON.Camera.prototype);
    var e = BABYLON.Camera;
    t.prototype.inertialAlphaOffset = 0, t.prototype.inertialBetaOffset = 0, t.prototype.inertialRadiusOffset = 0, t.prototype.lowerAlphaLimit = null, t.prototype.upperAlphaLimit = null, t.prototype.lowerBetaLimit = null, t.prototype.upperBetaLimit = null, t.prototype.lowerRadiusLimit = 40, t.prototype.upperRadiusLimit = 6e3, t.prototype.radiusSpeedFactor = .2, t.prototype.moveSpeedFactor = .5, t.prototype.angularSensibility = 1e3;
    var n = function (t) {
        return t.offsetX ? t.offsetX : t.layerX ? t.layerX : t.clientX
    }, i = function (t) {
        return t.offsetY ? t.offsetY : t.layerY ? t.layerY : t.clientY
    };
    return t.prototype._getTargetPosition = function () {
        return this.target.position || this.target
    }, t.prototype._initCache = function () {
        e.prototype._initCache.call(this), this._cache.target = new BABYLON.Vector3(Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE), this._cache.alpha = void 0, this._cache.beta = void 0, this._cache.radius = void 0
    }, t.prototype._updateCache = function (t) {
        t || e.prototype._updateCache.call(this), this._cache.target.copyFrom(this._getTargetPosition()), this._cache.alpha = this.alpha, this._cache.beta = this.beta, this._cache.radius = this.radius
    }, t.prototype._isSynchronizedViewMatrix = function () {
        return e.prototype._isSynchronizedViewMatrix.call(this) ? this._cache.target.equals(this._getTargetPosition()) && this._cache.alpha === this.alpha && this._cache.beta === this.beta && this._cache.radius === this.radius : !1
    }, t.prototype.attachControl = function (t, e, n) {
        1 === hcsdesign.engine3D.pointerManager.mode ? this.attachControlForMobile(t, e, n) : this.attachControlForDesktop(t, e, n)
    }, t.prototype.attachControlForMobile = function (t) {
        var e, n = this._scene.getEngine(), i = .005, o = !0, r = [{ x: 0, y: 0 }, { x: 0, y: 0}], s = 0, a = 0, l = this;
        this.angularSensibility = 1, this._attachedCanvas = t, window.ejecta && (this._attachedCanvas = document), document.addEventListener("hcs.engine3d.dragcontrols.start", function () {
            o = !1
        }, !1), document.addEventListener("hcs.engine3d.dragcontrols.end", function () {
            o = !0
        }, !1);
        var h = function (t) {
            r[0].x = t.touches[0].clientX || t.touches[0].pageX, r[0].y = t.touches[0].clientY || t.touches[0].pageY, 2 === t.touches.length && (r[1].x = t.touches[1].clientX || t.touches[1].pageX, r[1].y = t.touches[1].clientY || t.touches[1].pageY)
        }, c = function (t, e) {
            var n = t.x - e.x, i = t.y - e.y;
            return Math.sqrt(n * n + i * i)
        }, u = function (t) {
            o && (t.preventDefault(), h(t), n.isPointerLock = !0, t.touches.length && (e = { x: t.touches[0].clientX * i, y: t.touches[0].clientY * i }))
        }, p = function (t) {
            if (o && (t.preventDefault(), h(t), t.touches.length)) {
                if (!e)
                    return;
                var n = t.touches[0].clientX * i, u = t.touches[0].clientY * i, p = n - e.x, d = u - e.y;
                if (t.touches.length > 2) {
                    var m = hcsdesign.engine3D.projectMouseOnGround(0 | +(e.x / i), 0 | +(e.y / i)), g = hcsdesign.engine3D.projectMouseOnGround(0 | +(n / i), 0 | +(u / i));
                    null !== m && null !== g && (g.subtractInPlace(m), l._getTargetPosition().addInPlace(g.scaleInPlace(-1)), l._getTargetPosition().x = ujs.Math.clamp(l._getTargetPosition().x, hcsdesign.configuration.boundingSize.min.x, hcsdesign.configuration.boundingSize.max.x), l._getTargetPosition().z = ujs.Math.clamp(l._getTargetPosition().z, hcsdesign.configuration.boundingSize.min.z, hcsdesign.configuration.boundingSize.max.z))
                } else if (2 == t.touches.length) {
                    a = s, s = c(r[0], r[1]);
                    var f = +(s - a) > 0 ? 2.5 : -2.5;
                    f *= hcsdesign.loopTimer.getDeltaTime(), l.inertialRadiusOffset += f
                } else
                    l.inertialAlphaOffset -= p / l.angularSensibility, l.inertialBetaOffset -= d / l.angularSensibility;
                e = { x: n, y: u }
            }
        }, d = function (t) {
            o && (t.preventDefault(), n.isPointerLock = !1, e = null)
        };
        this._attachedCanvas.addEventListener("touchstart", u, !1), this._attachedCanvas.addEventListener("touchmove", p, !1), this._attachedCanvas.addEventListener("touchend", d, !1), this._attachedCanvas.addEventListener("touchcancel", d, !1)
    }, t.prototype.attachControlForDesktop = function (t, e) {
        var o, r, s = this, a = !1;
        if (!this._attachedCanvas) {
            this._attachedCanvas = t;
            var l = this._scene.getEngine();
            void 0 === this._onPointerDown && (this._onPointerDown = function (t) {
                return s.enabled ? void (r || (r = t.pointerId, o = { x: n(t), y: i(t) }, e || t.preventDefault())) : void (o = null)
            }, this._onPointerUp = function (t) {
                o = null, r = null, e || t.preventDefault()
            }, this._onPointerMove = function (t) {
                if (o && !a && r === t.pointerId) {
                    var l = n(t) - o.x, h = i(t) - o.y;
                    if (s.enabled) {
                        var c = t.button;
                        if (!t.button && t.buttons ? (c = t.buttons, c = 1 === t.buttons ? 0 : c) : -1 === c && (c = 1 === t.buttons ? 0 : t.buttons), 0 === c)
                            s.inertialAlphaOffset -= l / s.angularSensibility, s.inertialBetaOffset -= h / s.angularSensibility;
                        else if (2 === c) {
                            if (!s.cameraTranslationenabled)
                                return;
                            var u = hcsdesign.engine3D.projectMouseOnGround(o.x, o.y), p = hcsdesign.engine3D.projectMouseOnGround(n(t), i(t));
                            if (null !== u && null !== p) {
                                p.subtractInPlace(u);
                                var d = p.length();
                                d > 125 && p.scaleInPlace(125 / d), s._getTargetPosition().addInPlace(p.scaleInPlace(-1)), s._getTargetPosition().x = ujs.Math.clamp(s._getTargetPosition().x, hcsdesign.configuration.boundingSize.min.x, hcsdesign.configuration.boundingSize.max.x), s._getTargetPosition().z = ujs.Math.clamp(s._getTargetPosition().z, hcsdesign.configuration.boundingSize.min.z, hcsdesign.configuration.boundingSize.max.z)
                            }
                        }
                        ujs.notify("hcs.engine3D.camera.move"), o = { x: n(t), y: i(t) }, e || t.preventDefault()
                    }
                }
            }, this._onMouseMove = function (t) {
                if (s.enabled && l.isPointerLock) {
                    var n = t.movementX || t.mozMovementX || t.webkitMovementX || t.msMovementX || 0, i = t.movementY || t.mozMovementY || t.webkitMovementY || t.msMovementY || 0;
                    s.inertialAlphaOffset -= n / s.angularSensibility, s.inertialBetaOffset -= i / s.angularSensibility, e || t.preventDefault()
                }
            }, this._wheel = function (t) {
                if (s.enabled) {
                    var n = 0;
                    t.wheelDelta ? n = t.wheelDelta / (120 * s.radiusSpeedFactor) : t.detail && (n = -t.detail / (3 * s.radiusSpeedFactor)), n && (s.inertialRadiusOffset += n), t.preventDefault && (e || t.preventDefault())
                }
            }, this._onKeyDown = function (t) {
                if (s.enabled && (-1 !== s.keysUp.indexOf(t.keyCode) || -1 !== s.keysDown.indexOf(t.keyCode) || -1 !== s.keysLeft.indexOf(t.keyCode) || -1 !== s.keysRight.indexOf(t.keyCode))) {
                    var n = s._keys.indexOf(t.keyCode);
-1 === n && s._keys.push(t.keyCode), t.preventDefault && (e || t.preventDefault())
                }
            }, this._onKeyUp = function (t) {
                if (s.enabled && (-1 !== s.keysUp.indexOf(t.keyCode) || -1 !== s.keysDown.indexOf(t.keyCode) || -1 !== s.keysLeft.indexOf(t.keyCode) || -1 !== s.keysRight.indexOf(t.keyCode))) {
                    var n = s._keys.indexOf(t.keyCode);
                    n >= 0 && s._keys.splice(n, 1), t.preventDefault && (e || t.preventDefault())
                }
            }, this._onLostFocus = function () {
                s.enabled && (s._keys = [], r = null)
            }, this._onGestureStart = function (e) {
                s.enabled && void 0 !== window.MSGesture && (s._MSGestureHandler || (s._MSGestureHandler = new MSGesture, s._MSGestureHandler.target = t), s._MSGestureHandler.addPointer(e.pointerId))
            }, this._onGesture = function (t) {
                s.enabled && (1 !== t.scale ? (s.inertialRadiusOffset += 65 * t.scale * (t.expansion > 0 ? 1 : -1), a = !0) : a = !1, t.preventDefault && (e || (t.stopPropagation(), t.preventDefault())))
            }, this._reset = function () {
                s._keys = [], s.inertialAlphaOffset = 0, s.inertialBetaOffset = 0, o = null, r = null
            });
            var h = window.PointerEvent ? "pointer" : "mouse";
            t.addEventListener(h + "down", this._onPointerDown, !1), t.addEventListener(h + "up", this._onPointerUp, !1), t.addEventListener(h + "out", this._onPointerUp, !1), t.addEventListener(h + "move", this._onPointerMove, !1), t.addEventListener("mousemove", this._onMouseMove, !1), t.addEventListener("MSPointerDown", this._onGestureStart, !1), t.addEventListener("MSGestureChange", this._onGesture, !1), window.addEventListener("keydown", this._onKeyDown, !1), window.addEventListener("keyup", this._onKeyUp, !1), t.addEventListener("mousewheel", this._wheel, !1), window.addEventListener("DOMMouseScroll", this._wheel, !1), window.addEventListener("blur", this._onLostFocus, !1)
        }
    }, t.prototype.detachControl = function (t) {
        if (this._attachedCanvas == t) {
            var e = window.PointerEvent ? "pointer" : "mouse";
            t.removeEventListener(e + "down", this._onPointerDown, !1), t.removeEventListener(e + "up", this._onPointerUp, !1), t.removeEventListener(e + "out", this._onPointerUp, !1), t.removeEventListener(e + "move", this._onPointerMove, !1), t.removeEventListener("mousemove", this._onMouseMove, !1), t.removeEventListener("MSPointerDown", this._onGestureStart, !1), t.removeEventListener("MSGestureChange", this._onGesture, !1), window.removeEventListener("keydown", this._onKeyDown), window.removeEventListener("keyup", this._onKeyUp), t.removeEventListener("mousewheel", this._wheel), window.removeEventListener("DOMMouseScroll", this._wheel, !1), window.removeEventListener("blur", this._onLostFocus), this._MSGestureHandler = null, this._attachedCanvas = null, this._reset && this._reset()
        }
    }, t.prototype._update = function () {
        for (var t = 0; t < this._keys.length; t++) {
            var e = this._keys[t];
            ujs.notify("hcs.engine3D.camera.move"), -1 !== this.keysLeft.indexOf(e) ? this.inertialAlphaOffset -= .01 : -1 !== this.keysUp.indexOf(e) ? this.inertialBetaOffset -= .01 : -1 !== this.keysRight.indexOf(e) ? this.inertialAlphaOffset += .01 : -1 !== this.keysDown.indexOf(e) && (this.inertialBetaOffset += .01)
        }
        (0 != this.inertialAlphaOffset || 0 != this.inertialBetaOffset || 0 != this.inertialRadiusOffset) && (this.alpha += this.inertialAlphaOffset, this.beta += this.inertialBetaOffset, this.radius -= this.inertialRadiusOffset, this.inertialAlphaOffset *= this.inertia, this.inertialBetaOffset *= this.inertia, this.inertialRadiusOffset *= this.inertia, Math.abs(this.inertialAlphaOffset) < BABYLON.Engine.epsilon && (this.inertialAlphaOffset = 0), Math.abs(this.inertialBetaOffset) < BABYLON.Engine.epsilon && (this.inertialBetaOffset = 0), Math.abs(this.inertialRadiusOffset) < BABYLON.Engine.epsilon && (this.inertialRadiusOffset = 0)), this.lowerAlphaLimit && this.alpha < this.lowerAlphaLimit && (this.alpha = this.lowerAlphaLimit), this.upperAlphaLimit && this.alpha > this.upperAlphaLimit && (this.alpha = this.upperAlphaLimit), this.lowerBetaLimit && this.beta < this.lowerBetaLimit && (this.beta = this.lowerBetaLimit), this.upperBetaLimit && this.beta > this.upperBetaLimit && (this.beta = this.upperBetaLimit), this.lowerRadiusLimit && this.radius < this.lowerRadiusLimit && (this.radius = this.lowerRadiusLimit), this.upperRadiusLimit && this.radius > this.upperRadiusLimit && (this.radius = this.upperRadiusLimit), this._constraintToUpScene()
    }, t.prototype.setPosition = function (t) {
        var e = t.subtract(this._getTargetPosition());
        this.radius = e.length(), this.alpha = Math.atan(e.z / e.x), this.beta = Math.acos(e.y / this.radius)
    }, t.prototype._getViewMatrix = function () {
        this.beta > Math.PI && (this.beta = Math.PI), this.beta <= 0 && (this.beta = .01);
        var t = Math.cos(this.alpha), e = Math.sin(this.alpha), n = Math.cos(this.beta), i = Math.sin(this.beta), o = this._getTargetPosition();
        return o.addToRef(new BABYLON.Vector3(this.radius * t * i, this.radius * n, this.radius * e * i), this.position), BABYLON.Matrix.LookAtLHToRef(this.position, o, this.upVector, this._viewMatrix), this._viewMatrix
    }, t.prototype._constraintToUpScene = function () {
        var t = 3, e = -(this.target.y - t) / this.radius;
        if (!(Math.abs(e) > 1)) {
            var n = Math.abs(Math.acos(e));
            this.beta = BABYLON.Math.NormalizeAngle(this.beta), this.beta = Math.min(this.beta, n), this.beta = Math.max(this.beta, -n)
        }
    }, t
} ();

var hcs = window.hcs || {};
hcs.Input = hcs.Input || {}, hcs.Input.FirstPersonCamera = function () {
    var t = !1, e = function (t, n, i) {
        BABYLON.Camera.call(this, t, n, i), this.cameraDirection = new BABYLON.Vector3(0, 0, 0), this.cameraRotation = new BABYLON.Vector2(0, 0), this.rotation = new BABYLON.Vector3(0, 0, 0), this.ellipsoid = new BABYLON.Vector3(.5, 1, .5), this._keys = [], this.keysUp = [38, 87], this.keysDown = [40, 83], this.keysLeft = [37, 81], this.keysRight = [39, 69], this.keysStrafeLeft = [65], this.keysStrafeRight = [68], GlobalHelper.hasAzertyKeyboard && (this.keysUp[1] = 90, this.keysLeft[1] = 65, this.keysStrafeLeft[0] = 81), this._collider = new BABYLON.Collider, this._needMoveForGravity = !0, this._currentTarget = BABYLON.Vector3.Zero(), this._viewMatrix = BABYLON.Matrix.Zero(), this._camMatrix = BABYLON.Matrix.Zero(), this._cameraTransformMatrix = BABYLON.Matrix.Zero(), this._cameraRotationMatrix = BABYLON.Matrix.Zero(), this._referencePoint = BABYLON.Vector3.Zero(), this._transformedReferencePoint = BABYLON.Vector3.Zero(), this._oldPosition = BABYLON.Vector3.Zero(), this._diffPosition = BABYLON.Vector3.Zero(), this._newPosition = BABYLON.Vector3.Zero(), this._lookAtTemp = BABYLON.Matrix.Zero(), this._tempMatrix = BABYLON.Matrix.Zero(), e.prototype._initCache.call(this)
    };
    e.prototype = Object.create(BABYLON.Camera.prototype);
    var n = BABYLON.Camera;
    return e.prototype.speed = 2, e.prototype.checkCollisions = !1, e.prototype.applyGravity = !1, e.prototype.noRotationConstraint = !1, e.prototype.angularSensibility = 2e3, e.prototype.lockedTarget = null, e.prototype.onCollide = null, e.prototype._getLockedTargetPosition = function () {
        return this.lockedTarget ? this.lockedTarget.position || this.lockedTarget : null
    }, e.prototype._onMessageBoxOpened = function () {
        t = !0
    }, e.prototype._onMessageBoxClosed = function () {
        t = !1
    }, e.prototype._initCache = function () {
        n.prototype._initCache.call(this), this._cache.lockedTarget = new BABYLON.Vector3(Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE), this._cache.rotation = new BABYLON.Vector3(Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE)
    }, e.prototype._updateCache = function (t) {
        t || n.prototype._updateCache.call(this);
        var e = this._getLockedTargetPosition();
        e ? this._cache.lockedTarget ? this._cache.lockedTarget.copyFrom(e) : this._cache.lockedTarget = e.clone() : this._cache.lockedTarget = null, this._cache.rotation.copyFrom(this.rotation)
    }, e.prototype._isSynchronizedViewMatrix = function () {
        if (!BABYLON.Camera.prototype._isSynchronizedViewMatrix.call(this))
            return !1;
        var t = this._getLockedTargetPosition();
        return (this._cache.lockedTarget ? this._cache.lockedTarget.equals(t) : !t) && this._cache.rotation.equals(this.rotation)
    }, e.prototype._computeLocalCameraSpeed = function () {
        return this.speed * (BABYLON.Tools.GetDeltaTime() / (10 * BABYLON.Tools.GetFps()))
    }, e.prototype.setTarget = function (t) {
        this.upVector.normalize(), BABYLON.Matrix.LookAtLHToRef(this.position, t, this.upVector, this._camMatrix), this._camMatrix.invert(), this.rotation.x = Math.atan(this._camMatrix.m[6] / this._camMatrix.m[10]);
        var e = t.subtract(this.position);
        this.rotation.y = e.x >= 0 ? -Math.atan(e.z / e.x) + Math.PI / 2 : -Math.atan(e.z / e.x) - Math.PI / 2, this.rotation.z = -Math.acos(BABYLON.Vector3.Dot(new BABYLON.Vector3(0, 1, 0), this.upVector)), isNaN(this.rotation.x) && (this.rotation.x = 0), isNaN(this.rotation.y) && (this.rotation.y = 0), isNaN(this.rotation.z) && (this.rotation.z = 0)
    }, e.prototype.lockUnrelatedActions = function () {
        var t = hcsdesign.getComponentByName("EditionComponent3D");
        return t && (ujs.notify("hcs.request.configurator.cancel"), t.lock(this, 14), t.deselectObject()), !0
    }, e.prototype.unlockUnrelatedActions = function () {
        var t = hcsdesign.getComponentByName("EditionComponent3D");
        return t && t.unlock(this, 14), !0
    }, e.prototype.attachControl = function (e, n) {
        var i, o = this, r = this._scene.getEngine();
        if (!this._attachedCanvas) {
            document.addEventListener("hcs.ui.messagebox.opened", this._onMessageBoxOpened, !1), document.addEventListener("hcs.ui.messagebox.closed", this._onMessageBoxClosed, !1), this.lockUnrelatedActions(), this._attachedCanvas = e, void 0 === this._onMouseDown && (this.onMouseDown = function (t) {
                i = t.touches && 1 == t.touches.length ? { x: t.touches[0].pageX, y: t.touches[0].pageY} : { x: t.clientX, y: t.clientY }, n || t.preventDefault()
            }, this.onMouseUp = function (t) {
                i = null, n || t.preventDefault()
            }, this.onMouseOut = function (t) {
                i = null, o._keys = [], n || t.preventDefault()
            }, this.onMouseMove = function (t) {
                if (i || r.isPointerLock) {
                    var e, s;
                    t.touches && 1 == t.touches.length ? (e = t.touches[0].pageX - i.x, s = t.touches[0].pageY - i.y, i = { x: t.touches[0].pageX, y: t.touches[0].pageY }) : r.isPointerLock ? (e = t.movementX || t.mozMovementX || t.webkitMovementX || t.msMovementX || 0, s = t.movementY || t.mozMovementY || t.webkitMovementY || t.msMovementY || 0) : (e = t.clientX - i.x, s = t.clientY - i.y, i = { x: t.clientX, y: t.clientY }), t.touches || (e *= -1, s *= -1), o.rotation.y -= e / o.angularSensibility, o.rotation.x - s / o.angularSensibility < Math.PI / 2 && o.rotation.x - s / o.angularSensibility > -Math.PI / 2 && (o.rotation.x -= s / o.angularSensibility), n || t.preventDefault()
                }
            }, this.onWheel = function (t) {
                var e = 0;
                t.wheelDelta ? e = t.wheelDelta / (120 * o.radiusSpeedFactor) : t.detail && (e = -t.detail / (3 * o.radiusSpeedFactor)), o.height + e < o.heightMax && o.height + e > o.heightMin && (o.height += e, o.position.y = o.height), t.preventDefault && (n || t.preventDefault())
            }, this.onKeyDown = function (e) {
                if (!t && (-1 !== o.keysUp.indexOf(e.keyCode) || -1 !== o.keysDown.indexOf(e.keyCode) || -1 !== o.keysLeft.indexOf(e.keyCode) || -1 !== o.keysRight.indexOf(e.keyCode) || -1 !== o.keysStrafeLeft.indexOf(e.keyCode) || -1 !== o.keysStrafeRight.indexOf(e.keyCode))) {
                    var i = o._keys.indexOf(e.keyCode);
-1 === i && o._keys.push(e.keyCode), n || e.preventDefault()
                }
            }, this.onKeyUp = function (e) {
                if (!t && (-1 !== o.keysUp.indexOf(e.keyCode) || -1 !== o.keysDown.indexOf(e.keyCode) || -1 !== o.keysLeft.indexOf(e.keyCode) || -1 !== o.keysRight.indexOf(e.keyCode) || -1 !== o.keysStrafeLeft.indexOf(e.keyCode) || -1 !== o.keysStrafeRight.indexOf(e.keyCode))) {
                    var i = o._keys.indexOf(e.keyCode);
                    i >= 0 && o._keys.splice(i, 1), n || e.preventDefault()
                }
            }, this.onLostFocus = function () {
                o._keys = []
            }, this.reset = function () {
                o._keys = [], i = null, o.cameraDirection = new BABYLON.Vector3(0, 0, 0), o.cameraRotation = new BABYLON.Vector2(0, 0)
            });
            var s = window.PointerEvent ? "pointer" : "mouse";
            e.addEventListener(s + "down", this.onMouseDown, !1), e.addEventListener(s + "up", this.onMouseUp, !1), e.addEventListener(s + "out", this.onMouseOut, !1), e.addEventListener(s + "move", this.onMouseMove, !1), e.addEventListener("mousewheel", this.onWheel, !1), window.addEventListener("keydown", this.onKeyDown, !1), window.addEventListener("keyup", this.onKeyUp, !1), window.addEventListener("blur", this.onLostFocus, !1), document.addEventListener("touchend", this.onMouseUp, !1), document.addEventListener("touchcancel", this.onMouseUp, !1), document.addEventListener("touchmove", this.onMouseMove, !1), document.addEventListener("touchstart", this.onMouseDown, !1)
        }
    }, e.prototype.detachControl = function (t) {
        if (this._attachedCanvas == t) {
            this.unlockUnrelatedActions();
            var e = window.PointerEvent ? "pointer" : "mouse";
            t.removeEventListener(e + "down", this.onMouseDown), t.removeEventListener(e + "up", this.onMouseUp), t.removeEventListener(e + "out", this.onMouseOut), t.removeEventListener(e + "move", this.onMouseMove), t.removeEventListener("mousewheel", this.onWheel), window.removeEventListener("keydown", this.onKeyDown), window.removeEventListener("keyup", this.onKeyUp), window.removeEventListener("blur", this.onLostFocus), document.removeEventListener("touchend", this.onMouseUp), document.removeEventListener("touchcancel", this.onMouseUp), document.removeEventListener("touchmove", this.onMouseMove), document.removeEventListener("touchstart", this.onMouseDown), document.removeEventListener("hcs.ui.messagebox.opened", this._onMessageBoxOpened), document.removeEventListener("hcs.ui.messagebox.closed", this._onMessageBoxClosed), this._attachedCanvas = null, this._reset && this._reset()
        }
    }, e.prototype._collideWithWorld = function (t) {
        this.position.subtractFromFloatsToRef(0, this.ellipsoid.y, 0, this._oldPosition), this._collider.radius = this.ellipsoid, this._scene._getNewPosition(this._oldPosition, t, this._collider, 3, this._newPosition), this._newPosition.subtractToRef(this._oldPosition, this._diffPosition), this._diffPosition.length() > BABYLON.Engine.collisionsEpsilon && (this.position.addInPlace(this._diffPosition), this.onCollide && this.onCollide(this._collider.collidedMesh))
    }, e.prototype._checkInputs = function () {
        this._localDirection || (this._localDirection = BABYLON.Vector3.Zero(), this._transformedDirection = BABYLON.Vector3.Zero()), this._localRotation || (this._localRotation = BABYLON.Vector3.Zero(), this._transformedRotation = BABYLON.Vector3.Zero());
        for (var t = 0; t < this._keys.length; t++) {
            var e = this._keys[t], n = this._computeLocalCameraSpeed(), i = BABYLON.Tools.GetFps() / 60;
-1 !== this.keysLeft.indexOf(e) ? this._localRotation.copyFromFloats(0, -n / 3 * i, 0) : -1 !== this.keysUp.indexOf(e) ? this._localDirection.copyFromFloats(0, 0, 100 * n * i) : -1 !== this.keysRight.indexOf(e) ? this._localRotation.copyFromFloats(0, n / 3 * i, 0) : -1 !== this.keysDown.indexOf(e) ? this._localDirection.copyFromFloats(0, 0, 100 * -n * i) : -1 !== this.keysStrafeLeft.indexOf(e) ? this._localDirection.copyFromFloats(100 * -n * i, 0, 0) : -1 !== this.keysStrafeRight.indexOf(e) && this._localDirection.copyFromFloats(100 * n * i, 0, 0), this.getViewMatrix().invertToRef(this._cameraTransformMatrix), -1 !== this.keysUp.indexOf(e) || -1 !== this.keysDown.indexOf(e) || -1 !== this.keysStrafeLeft.indexOf(e) || -1 !== this.keysStrafeRight.indexOf(e) ? (BABYLON.Vector3.TransformNormalToRef(this._localDirection, this._cameraTransformMatrix, this._transformedDirection), this.position.addInPlace(this._transformedDirection)) : (BABYLON.Vector3.TransformNormalToRef(this._localRotation, this._cameraTransformMatrix, this._transformedRotation), this.rotation.y += this._transformedRotation.y), this.position.y = this.height
        }
    }, e.prototype.moveLocal = function (t) {
        BABYLON.Vector3.TransformNormalToRef(t, this._cameraTransformMatrix, this._transformedDirection), this.position.addInPlace(this._transformedDirection)
    }, e.prototype.rotateLocal = function (t) {
        this._transformedRotation = BABYLON.Vector3.Zero(), BABYLON.Vector3.TransformNormalToRef(t, this._cameraTransformMatrix, this._transformedRotation), this.rotation.x += this._transformedRotation.x, this.rotation.x = ujs.Math.clamp(this.rotation.x, -Math.PI / 2, Math.PI / 2), this.rotation.y += this._transformedRotation.y
    }, e.prototype._update = function () {
        this._checkInputs();
        var t = this._needMoveForGravity || Math.abs(this.cameraDirection.x) > 0 || Math.abs(this.cameraDirection.y) > 0 || Math.abs(this.cameraDirection.z) > 0, e = Math.abs(this.cameraRotation.x) > 0 || Math.abs(this.cameraRotation.y) > 0;
        if (t)
            if (this.checkCollisions && this._scene.collisionsEnabled) {
                if (this._collideWithWorld(this.cameraDirection), this.applyGravity) {
                    var n = this.position;
                    this._collideWithWorld(this._scene.gravity), this._needMoveForGravity = 0 != BABYLON.Vector3.DistanceSquared(n, this.position)
                }
            } else
                this.position.addInPlace(this.cameraDirection);
        if (e && (this.rotation.x += this.cameraRotation.x, this.rotation.y += this.cameraRotation.y, !this.noRotationConstraint)) {
            var i = Math.PI / 2 * .95;
            this.rotation.x > i && (this.rotation.x = i), this.rotation.x < -i && (this.rotation.x = -i)
        }
        t && (Math.abs(this.cameraDirection.x) < BABYLON.Engine.epsilon && (this.cameraDirection.x = 0), Math.abs(this.cameraDirection.y) < BABYLON.Engine.epsilon && (this.cameraDirection.y = 0), Math.abs(this.cameraDirection.z) < BABYLON.Engine.epsilon && (this.cameraDirection.z = 0), this.cameraDirection.scaleInPlace(this.inertia)), e && (Math.abs(this.cameraRotation.x) < BABYLON.Engine.epsilon && (this.cameraRotation.x = 0), Math.abs(this.cameraRotation.y) < BABYLON.Engine.epsilon && (this.cameraRotation.y = 0), this.cameraRotation.scaleInPlace(this.inertia))
    }, e.prototype._getViewMatrix = function () {
        return BABYLON.Vector3.FromFloatsToRef(0, 0, 1, this._referencePoint), this.lockedTarget ? this._currentTarget.copyFrom(this._getLockedTargetPosition()) : (0 != this.upVector.x || 1 != this.upVector.y || 0 != this.upVector.z ? (BABYLON.Matrix.LookAtLHToRef(BABYLON.Vector3.Zero(), this._referencePoint, this.upVector, this._lookAtTemp), BABYLON.Matrix.RotationYawPitchRollToRef(this.rotation.y, this.rotation.x, this.rotation.z, this._cameraRotationMatrix), this._lookAtTemp.multiplyToRef(this._cameraRotationMatrix, this._tempMatrix), this._lookAtTemp.invert(), this._tempMatrix.multiplyToRef(this._lookAtTemp, this._cameraRotationMatrix)) : BABYLON.Matrix.RotationYawPitchRollToRef(this.rotation.y, this.rotation.x, this.rotation.z, this._cameraRotationMatrix), BABYLON.Vector3.TransformCoordinatesToRef(this._referencePoint, this._cameraRotationMatrix, this._transformedReferencePoint), this.position.addToRef(this._transformedReferencePoint, this._currentTarget)), BABYLON.Matrix.LookAtLHToRef(this.position, this._currentTarget, this.upVector, this._viewMatrix), this._viewMatrix
    }, e
} ();

var hcs = window.hcs || {};
hcs.Input = hcs.Input || {}, hcs.Input.TouchManager = function (t) {
    var e = [{ x: 0, y: 0 }, { x: 0, y: 0}], n = [{ x: 0, y: 0 }, { x: 0, y: 0}], i = { x: 0, y: 0, reset: function () {
        this.x = 0, this.y = 0
    }, update: function () {
        this.x = e[0].x - n[0].x, this.y = e[0].y - n[0].y
    } 
    }, o = { timer: 0, duration: 200 }, r = { sx: 0, sy: 0, timer: null, duration: 900, deadZone: 5 }, s = !1, a = 2, l = !1, h = 0, c = 0, u = 0, p = !1, d = {}, m = null, g = -1;
    this.on = function (t, e) {
        d[t] = e
    }, this.off = function (t) {
        delete d[t]
    }, this.setDeadZone = function (t) {
        a = t
    };
    var f = function (t, n) {
        var i = document.createEvent("HTMLEvents");
        i.initEvent(t, !0, !1), i.pageX = e[0].x, i.pageY = e[0].y, i.clientX = e[0].x, i.clientY = e[0].y, i.detail = -h, i.distance = c, i.wheelDeltaY = m ? h : +(c - u) > 0 ? 2.5 : -2.5, i.button = 0;
        for (var o in n)
            i[o] = n[o];
        return i
    }, y = function (t, e) {
        d[t] && d[t](f(t, e))
    }, _ = function (t, e) {
        var n = t.x - e.x, i = t.y - e.y;
        return Math.sqrt(n * n + i * i)
    }, v = function (t, i, o) {
        o || (n[i].x = e[i].x, n[i].y = e[i].y), window.PointerEvent && t instanceof window.PointerEvent || window.MSPointerEvent && t instanceof MSPointerEvent ? (e[i].x = t.clientX || t.pageX, e[i].y = t.clientY || t.pageY) : t.touches && (e[i].x = t.touches[i].clientX || t.touches[i].pageX, e[i].y = t.touches[i].clientY || t.touches[i].pageY), o && (n[i].x = e[i].x, n[i].y = e[i].y)
    }, b = function (t, e) {
        v(t, 0, e), t.touches && t.touches.length > 1 && v(t, 1, e)
    }, w = function (t) {
        if (t.preventDefault(), !("pointerdown" === t.type && g > -1)) {
            g = t.pointerId, s = !0, l = !1, b(t, !0);
            var n = 0;
            t.touches && t.touches.length > 1 && (n = 1), y("touchDown", { button: n }), t.touches && 1 === t.touches.length || g ? (y("tap"), o.timer ? (clearTimeout(o.timer), o.timer = null, y("dblTap")) : o.timer = setTimeout(function () {
                clearTimeout(o.timer), o.timer = null
            }, o.duration), r.timer && clearTimeout(r.timer), r.sx = e[0].x, r.sy = e[0].y, r.timer = setTimeout(function () {
                clearTimeout(r.timer), r.timer = null;
                var t = e[0].x - r.sx, n = e[0].y - r.sy;
                Math.abs(t) < r.deadZone && Math.abs(n) < r.deadZone && y("longPress")
            }, r.duration)) : t.touches && t.touches.length > 1 && y("touchUp")
        }
    }, x = function (t) {
        if (!(p || "pointerdown" === t.type && t.pointerId !== g) && (t.preventDefault(), b(t), i.update(), l || (l = Math.abs(i.x) > a || Math.abs(i.y) > a)))
            if (t.touches && 2 == t.touches.length) {
                y("touchUp");
                var o = e[0].x - n[0].x, r = e[1].y - n[1].y;
                u = c, c = _(e[0], e[1]), h = Math.abs(o) > Math.abs(r) ? o : r, y("swipe"), y("rotate")
            } else
                s && y("touchMove")
    }, C = function (t) {
        h = 0, c = 0, u = 0, s = !1, l = !1, t.pointerId && g === t.pointerId && (g = -1), r.timer && (clearTimeout(r.timer), r.timer = null), y("touchUp")
    }, M = function (e) {
        void 0 !== window.MSGesture && (m || (m = new MSGesture, m.target = t), m.addPointer(e.pointerId))
    }, D = function (t) {
        1 !== t.scale ? (h = 50 * t.scale * (t.expansion > 0 ? 1 : -1), p = !0, y("touchUp"), y("swipe"), y("rotate"), t.stopPropagation(), t.preventDefault()) : p = !1
    }, B = GlobalHelper.getWrappedMouseEventNames();
    this.start = function () {
        t.addEventListener(B.down, w, !1), t.addEventListener(B.move, x, !1), t.addEventListener(B.up, C, !1), t.addEventListener(B.cancel, C, !1), B.out && t.addEventListener(B.out, C, !1), t.addEventListener("MSPointerDown", M, !1), t.addEventListener("MSGestureChange", D, !1)
    }, this.stop = function () {
        t.removeEventListener(B.down, w), t.removeEventListener(B.move, x), t.removeEventListener(B.up, C), t.removeEventListener(B.cancel, C), B.out && t.removeEventListener(B.out, C), t.removeEventListener("MSPointerDown", M), t.removeEventListener("MSGestureChange", D)
    }
};

var hcs = window.hcs || {};
hcs.PointerManager = function () {
    var t = function (t, e, n, i) {
        var i = i || {};
        this.BUTTON_LEFT = 1, this.BUTTON_MIDDLE = 2, this.BUTTON_RIGHT = 4, this.ACTION_CLICK = 1, this.ACTION_DBLCLICK = 2, this.ACTION_DRAGSTART = 4, this.ACTION_DRAGGING = 8, this.ACTION_DRAGEND = 16, this.ACTION_SCROLLUP = 32, this.ACTION_SCROLLDOWN = 64, this.MODIFIER_ALT = 1, this.MODIFIER_CTRL = 2, this.MODIFIER_SHIFT = 4, this.pos = new BABYLON.Vector2, this.posDelta = new BABYLON.Vector2, this.buttons = 0, this.actions = 0, this.modifiers = 0, this._core = t || hcsdesign, this._callback = e || null, this._domElement = n || document.body, this._offsets = i.offsets || new BABYLON.Vector2, this._width = i.width || this._domElement.clientWidth, this._height = i.height || this._domElement.clientHeight, this._lastState = this.getStatus(), this._initialised = !1, this.touchManager = new hcs.Input.TouchManager(this._domElement), this.setDomElement(this._domElement), this.mode = 0
    };
    return t.prototype.setDomElement = function (t) {
        this._domElement = t, this.onMouseDown = this.onMouseDown.bind(this), this.onMouseMove = this.onMouseMove.bind(this), this.onMouseUp = this.onMouseUp.bind(this), this.onMouseDoubleClick = this.onMouseDoubleClick.bind(this), this.onMouseWheel = this.onMouseWheel.bind(this), this.addTouchSupport(), this.addMouseSupport()
    }, t.prototype.addMouseSupport = function () {
        window.PointerEvent ? (this._domElement.addEventListener("pointerdown", this.onMouseDown, !1), this._domElement.addEventListener("pointermove", this.onMouseMove, !1), this._domElement.addEventListener("pointerup", this.onMouseUp, !1), document.addEventListener("pointerup", this.onMouseUp, !1)) : (this._domElement.addEventListener("mousedown", this.onMouseDown, !1), this._domElement.addEventListener("mousemove", this.onMouseMove, !1), this._domElement.addEventListener("mouseup", this.onMouseUp, !1), document.addEventListener("mouseup", this.onMouseUp, !1)), this._domElement.addEventListener("dblclick", this.onMouseDoubleClick, !1), this._domElement.addEventListener("mousewheel", this.onMouseWheel, !1), this._domElement.addEventListener("DOMMouseScroll", this.onMouseWheel, !1)
    }, t.prototype.removeMouseSupport = function () {
        window.PointerEvent ? (this._domElement.removeEventListener("pointerdown", this.onMouseDown), this._domElement.removeEventListener("pointermove", this.onMouseMove), this._domElement.removeEventListener("pointerup", this.onMouseUp), document.removeEventListener("pointerup", this.onMouseUp)) : (this._domElement.removeEventListener("mousedown", this.onMouseDown), this._domElement.removeEventListener("mousemove", this.onMouseMove), this._domElement.removeEventListener("mouseup", this.onMouseUp), document.removeEventListener("mouseup", this.onMouseUp)), this._domElement.removeEventListener("dblclick", this.onMouseDoubleClick), this._domElement.removeEventListener("mousewheel", this.onMouseWheel), this._domElement.removeEventListener("DOMMouseScroll", this.onMouseWheel), this.mode = 1
    }, t.prototype.addTouchSupport = function () {
        this.touchManager.start(), this.touchManager.on("tap", this.onMouseDown), this.touchManager.on("touchMove", this.onMouseMove), this.touchManager.on("touchUp", this.onMouseUp), this.touchManager.on("longPress", this.onMouseDoubleClick), this.touchManager.on("swipe", this.onMouseWheel)
    }, t.prototype.removeTouchSupport = function () {
        this.touchManager.stop(), this.touchManager.off("tap", this.onMouseDown), this.touchManager.off("touchMove", this.onMouseMove), this.touchManager.off("touchUp", this.onMouseUp), this.touchManager.off("longPress", this.onMouseDoubleClick), this.touchManager.off("swipe", this.onMouseWheel), this.mode = 2
    }, t.prototype.getStatus = function () {
        var t = {};
        return t.BUTTON_LEFT = this.BUTTON_LEFT, t.BUTTON_MIDDLE = this.BUTTON_MIDDLE, t.BUTTON_RIGHT = this.BUTTON_RIGHT, t.ACTION_CLICK = this.ACTION_CLICK, t.ACTION_DBLCLICK = this.ACTION_DBLCLICK, t.ACTION_DRAGSTART = this.ACTION_DRAGSTART, t.ACTION_DRAGGING = this.ACTION_DRAGGING, t.ACTION_DRAGEND = this.ACTION_DRAGEND, t.ACTION_SCROLLUP = this.ACTION_SCROLLUP, t.ACTION_SCROLLDOWN = this.ACTION_SCROLLDOWN, t.MODIFIER_ALT = this.MODIFIER_ALT, t.MODIFIER_CTRL = this.MODIFIER_CTRL, t.MODIFIER_SHIFT = this.MODIFIER_SHIFT, t.pos = this.pos.clone(), t.posDelta = this.posDelta.clone(), t.buttons = this.buttons, t.prevButtons = this._lastState ? this._lastState.buttons : 0, t.actions = this.actions, t.modifiers = this.modifiers, t.planPos = this.pos.clone(), t.planPos.subtractInPlace(this._core.engine2D.getTranslation()), t.planPos.scaleInPlace(1 / this._core.engine2D.getZoom()), t.plan3DPos = new BABYLON.Vector2(this.pos.x / this._core.getWidth() * 2 - 1, 2 * -(this.pos.y / this._core.getHeight()) + 1), t
    }, t.prototype.reset = function () {
        this.buttons = 0, this.actions = 0, this.posDelta = new BABYLON.Vector2(0, 0)
    }, t.prototype.resize = function (t, e) {
        this._width = t || this._domElement.clientWidth || this._domElement.innerWidth, this._height = e || this._domElement.clientHeight || this._domElement.innerHeight
    }, t.prototype._getX = function (t) {
        var e = 0;
        return t.pageX ? e = t.pageX : t.clientX && (e = t.clientX + (document.documentElement.scrollLeft ? document.documentElement.scrollLeft : document.body.scrollLeft)), e
    }, t.prototype._getY = function (t) {
        var e = 0;
        return t.pageY ? e = t.pageY : t.clientY && (e = t.clientY + (document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop)), e
    }, t.prototype._getButton = function (t) {
        if (t.touches && t.touches.length > 0)
            return this.BUTTON_LEFT;
        switch (t.button) {
            case 0:
                return this.BUTTON_LEFT;
            case 1:
                return this.BUTTON_MIDDLE;
            case 2:
                return this.BUTTON_RIGHT
        }
        return 0
    }, t.prototype._updateMouseState = function (t, e) {
        var n = t;
        (GlobalHelper.isMobileDevice() || n.target && "canvas" == n.target.tagName.toLowerCase() || this.preventDefault) && n.preventDefault(), "undefined" != typeof t.touches && t.touches.length > 0 && (n = t.touches[0]);
        var e = e || 0, i = this._getX(n), o = this._getY(n);
        i + o > 0 && this.pos.copyFromFloats(i, o), this._initialised || (this._initialised = !0, this._lastState.pos.copyFrom(this.pos)), this.posDelta = this.pos.subtract(this._lastState.pos), "tap" == n.type && (this.posDelta = new BABYLON.Vector2(0, 0)), this.actions = 0, this.actions |= e, 0 == this.buttons && this._lastState.buttons > 0 && 0 == (this._lastState.actions & this.ACTION_DRAGGING) && 0 == (this._lastState.actions & this.ACTION_DBLCLICK) ? this.actions |= this.ACTION_CLICK : this.buttons > 0 && 0 == this._lastState.actions && (0 != this.posDelta.x || 0 != this.posDelta.y) ? (this.actions |= this.ACTION_DRAGSTART, this.pos.x = this._lastState.pos.x, this.pos.y = this._lastState.pos.y) : this.buttons > 0 && ((this._lastState.actions & this.ACTION_DRAGSTART) > 0 || (this._lastState.actions & this.ACTION_DRAGGING) > 0) ? this.actions |= this.ACTION_DRAGGING : 0 == this.buttons && ((this._lastState.actions & this.ACTION_DRAGSTART) > 0 || (this._lastState.actions & this.ACTION_DRAGGING) > 0) && (this.actions |= this.ACTION_DRAGEND), this.modifiers = 0, n.altKey && (this.modifiers |= this.MODIFIER_ALT), n.ctrlKey && (this.modifiers |= this.MODIFIER_CTRL), n.shiftKey && (this.modifiers |= this.MODIFIER_SHIFT), this._notifyCb(n), this._lastState = this.getStatus()
    }, t.prototype._notifyCb = function (t) {
        null != this._callback && (this._callback(t, this.getStatus()), ujs.notify("hcs.input.pointerchanged", { inputStatus: this.getStatus() }))
    }, t.prototype.onMouseDown = function (t) {
        this.buttons |= this._getButton(t), this._updateMouseState(t)
    }, t.prototype.onMouseMove = function (t) {
        this._updateMouseState(t), t.preventDefault()
    }, t.prototype.onMouseUp = function (t) {
        this.buttons &= !this._getButton(t), this._updateMouseState(t)
    }, t.prototype.onMouseDoubleClick = function (t) {
        this._updateMouseState(t, this.ACTION_DBLCLICK)
    }, t.prototype.onMouseWheel = function (t) {
        var e = 0;
        t.wheelDeltaY ? e = t.wheelDeltaY : t.wheelDelta ? e = t.wheelDelta : t.detail && (e = -t.detail), 0 != e && (e > 0 ? this._updateMouseState(t, this.ACTION_SCROLLUP) : this._updateMouseState(t, this.ACTION_SCROLLDOWN), t.preventDefault())
    }, t
} ();

var Keys = { up: 38, down: 40, left: 37, right: 39, space: 32, escape: 27, shift: 16, ctrl: 17, alt: 18, tab: 9, a: 65, z: 90, e: 69, q: 81, s: 83, d: 68, r: 82, cmd: 91 },hcs = window.hcs || {};
hcs.KeyboardManager = function () {
    function t(t) {
        for (var e = 0; 110 > e; e++)
            t[e] = !1
    }
    var e, n = [], i = function () {
        this.keys = [], this.preventDefault = !1, this.initialized = !1;
        for (var t = 0; 110 > t; t++)
            this.keys[t] = !1;
        n = [8], e = this
    };
    return i.prototype.initialize = function () {
        t(this.keys), this.startEventsListening()
    }, i.prototype.destroy = function () {
        t(this.keys), this.stopEventsListening()
    }, i.prototype.startEventsListening = function () {
        this.initialized || (document.addEventListener("keydown", this.onKeyStateChange, !1), document.addEventListener("keyup", this.onKeyStateChange, !1), window.addEventListener("focus", this.onFocus, !1), this.initialized = !0)
    }, i.prototype.stopEventsListening = function () {
        this.initialized && (document.removeEventListener("keydown", this.onKeyStateChange), document.removeEventListener("keyup", this.onKeyStateChange), window.removeEventListener("focus", this.onFocus, !1), this.initialized = !1)
    }, i.prototype.onFocus = function () {
        for (var t = 0; t < e.keys.length; t++)
            e.keys[t] = !1
    }, i.prototype.onKeyStateChange = function (t) {
        var i = "keydown" == t.type ? !0 : !1, o = "keydown" == t.type ? "hcs.keyboardManager.keyDown" : "hcs.keyboardManager.keyUp";
        if (ujs.notify(o, t), "INPUT" == document.activeElement.nodeName || "TEXTAREA" == document.activeElement.nodeName)
            ;
        else if (e.preventDefault === !0)
            t.preventDefault();
        else
            for (var r = 0, s = n.length; s > r; r++)
                t.keyCode == n[r] && t.preventDefault();
        e.keys[t.keyCode] = i
    }, i.prototype.isPressed = function (t) {
        if (t instanceof Array) {
            for (var e = !1, n = 0, i = this.keys.length; i > n && !e; )
                e = this.keys[t[n]], n++;
            return e
        }
        return this.keys[t]
    }, i.prototype.isReleased = function (t) {
        return !this.isPressed(t)
    }, i
} ();

var hcs = window.hcs || {};
hcs.MaterialFactory = function () {
    var t = function (t) {
        this.configuration = t
    };
    return t.prototype.mergeParams = function (t, e) {
        var t = t || {}, e = e || {}, n = t;
        for (var i in e)
            n[i] = e[i];
        return n
    }, t.RepeatTextureXY = function (t, e, n) {
        return t.uScale = e, t.vScale = n, t
    }, t.MakeBasicMaterial = function (t) {
        t.ambientColor.copyFromFloats(.6, .6, .6), t.diffuseColor.copyFromFloats(0, 0, 0), t.specularColor.copyFromFloats(0, 0, 0), t.emissiveColor.copyFromFloats(.05, .05, .05)
    }, t.MakeBasicColor = function (t, e) {
        t.ambientColor.copyFromFloats(0, 0, 0), t.specularColor.copyFromFloats(0, 0, 0), t.diffuseColor.copyFromFloats(0, 0, 0), t.emissiveColor.copyFrom(e)
    }, t.MakeDefaultMaterial = function (t) {
        t.ambientColor.copyFromFloats(.2, .2, .2), t.diffuseColor.copyFromFloats(0, 0, 0), t.specularColor.copyFromFloats(.7, .7, .7), t.specularPower = 10
    }, t.ImportWNPMaterial = function (e) {
        var n = e.materialType;
        if (e = e || {}, e.url && (e.diffuseTexture = e.url), e.maps)
            for (var i in e.maps)
                "normal" == i ? e.bumpTexture = e.url.replace(".jpg", e.maps[i] + ".jpg") : e[i + "Texture"] = e.url.replace(".jpg", e.maps[i] + ".jpg");
        n = -1 !== n.indexOf("hcs.") ? n : "hcs." + (n.charAt("0").toUpperCase() + n.slice(1)) + "Material";
        var o = ujs.getProperty(window, n);
        o ? o = new o(e.name || "ImportedMaterial", hcsdesign.engine3D.scene) : (o = new BABYLON.StandardMaterial(e.name || "ImportedMaterial", hcsdesign.engine3D.scene), this.MakeDefaultMaterial(o)), e.color && (o.diffuseColor.copyFrom(e.color), o.params.baseColor = e.color);
        for (var r in e)
            void 0 !== o[r] && null !== o[r] ? e[r] instanceof Array && o[r].fromArray ? o[r].fromArray(e[r]) : e[r] instanceof Object && o[r].copyFrom ? o[r].copyFrom(e[r]) : -1 !== r.indexOf("Texture") ? (o[r] = new BABYLON.Texture(e[r], hcsdesign.engine3D.scene), o[r].vScale = e.vScale || e.scale || 1, o[r].uScale = e.uScale || e.scale || 1, o[r].hasAlpha = e.hasAlpha || !1) : o[r] = e[r] : -1 !== r.indexOf("Texture") ? (o[r] = new BABYLON.Texture(e[r], hcsdesign.engine3D.scene), o[r].vScale = e.vScale || e.scale || 1, o[r].uScale = e.uScale || e.scale || 1) : o[r] = e[r];
        if ((-1 != n.indexOf("Glass") || -1 != n.indexOf("Transparent") || -1 != n.indexOf("Metal")) && e.addColor && e.addColor.color)
            o.setBaseColor(e.addColor.color);
        else if (e.addColor && e.addColor.color && o.diffuseTexture) {
            o.addColor = e.addColor, e.addColor.size = e.addColor.size || { width: 512, height: 512 };
            var s = new Image, a = e.addColor.color;
            s.crossOrigin = "Anonymous", s.src = o.diffuseTexture.url;
            var l = new BABYLON.DynamicTexture("canvas", e.addColor.size.width, hcsdesign.engine3D.scene, !0);
            l.url = o.diffuseTexture.url, o.diffuseTexture = l, o.diffuseColor = new BABYLON.Color3(a.r, a.g, a.b).scale(.2), s.onload = function () {
                var n = l.getContext();
                n.fillStyle = t.rgbToHex(a), n.clearRect(0, 0, e.addColor.size.width, e.addColor.size.height), n.drawImage(s, 0, 0, e.addColor.size.width, e.addColor.size.height), n.globalCompositeOperation = "soft-light", n.globalCompositeOperation = "color-burn", n.globalCompositeOperation = "multiply", n.fillRect(0, 0, e.addColor.size.width, e.addColor.size.height), l.wrapU = BABYLON.Texture.WRAP_ADDRESSMODE, l.wrapV = BABYLON.Texture.WRAP_ADDRESSMODE, l.vScale = e.vScale || e.scale || 1, l.uScale = e.uScale || e.scale || 1, l.update()
            }
        }
        return o
    }, t.rgbToHex = function (e, n) {
        var i, o, r, n = n || !1, e = e || { r: 1, g: 1, b: 1 };
        return n ? (i = e.r, o = e.g, r = e.b) : (i = Math.round(255 * e.r), o = Math.round(255 * e.g), r = Math.round(255 * e.b)), "#" + t.decToHex(i, 2) + t.decToHex(o, 2) + t.decToHex(r, 2)
    }, t.decToHex = function (t, e) {
        for (var e = e || 0, n = t.toString(16), i = n.length; e > i; i++)
            n = "0" + n;
        return n
    }, t
} ();

var hcs = window.hcs || {};
hcs.Structure = function () {
    function t(t) {
        var e = {};
        for (var n in t)
            e[n] = t[n].serialize();
        return e
    }
    function e(t, e) {
        e.length = 0;
        for (var n in t) {
            var i = new window[t[n].name];
            i.deserialize(t[n]), i.updateReferences(i), e.push(i)
        }
    }
    var n = function (t) {
        this.uuid = hcs.uuid.uuid4(), this.lastModified = (new Date).getTime(), this.name = "planStructure", this.members = [], this.currentStructureIndex = 0, this.version = t, this.lastMaterialsUsed = [], this.structureVersion = t, this.params = {}, this.customData = {}
    };
    return n.prototype.clear = function () {
        this.members.length = 0, this.currentStructureIndex = 0, this.uuid = hcs.uuid.uuid4(), this.lastModified = (new Date).getTime(), this.params = {}
    }, n.prototype.getVersion = function () {
        return this.version
    }, n.prototype.getLength = function () {
        return this.members.length
    }, n.prototype.addElement = function (t) {
        return -1 == this.members.indexOf(t) ? (t.id = this.members.push(t) - 1, !0) : !1
    }, n.prototype.addToCurrentStructure = function (t) {
        this.members[this.currentStructureIndex].add(t)
    }, n.prototype.getElement = function (t) {
        return t > -1 && t < this.members.length ? this.members[t] : null
    }, n.prototype.getElementByName = function (t) {
        for (var e = this.members.length, n = 0, i = null; e > n && null === i; )
            i = this.members[n].name == t ? this.members[n] : i, n++;
        return i
    }, n.prototype.removeElement = function (t) {
        var e = this.members.indexOf(t);
        return e > -1 ? (this.members.splice(e, 1), this.reindexMembers(), !0) : !1
    }, n.prototype.getCurrentStructure = function () {
        return this.members[this.currentStructureIndex]
    }, n.prototype.setCurrentStructureIndex = function (t) {
        t > -1 && t < this.members.length && (this.currentStructureIndex = t)
    }, n.prototype.serialize = function () {
        function e(t) {
            for (var n in t)
                "object" == typeof t[n] ? e(t[n]) : "number" == typeof t[n] && (t[n] = Math.round(1e3 * t[n]) / 1e3)
        }
        var n = this;
        n.lastModified = (new Date).getTime();
        var i = { uuid: n.uuid, lastModified: n.lastModified, version: n.getVersion(), structureVersion: n.structureVersion, name: n.name, current: n.currentStructureIndex, members: t(n.members), lastMaterialsUsed: n.lastMaterialsUsed, params: n.params, customData: ujs.serializeObject(n.customData) };
        return e(i), JSON.stringify(i)
    }, n.prototype.deserialize = function (t) {
        var n = JSON.parse(t);
        return this.currentStructureIndex = 0 | +n.current, this.name = n.name, this.version = n.version, this.structureVersion = n.structureVersion, this.uuid = n.uuid || hcs.uuid.uuid4(), this.lastModified = n.lastModified || 0, this.lastMaterialsUsed = n.lastMaterialsUsed || [], this.params = n.params || {}, this.customData = ujs.deserializeObject(n.customData) || {}, e(n.members, this.members), this.reindexMembers(), !0
    }, n.prototype.addMemberAtIndex = function (t, e) {
        this.members.splice(t, 0, e), this.reindexMembers()
    }, n.prototype.reindexMembers = function () {
        for (var t = 0; t < this.members.length; t++)
            this.members[t].id = t
    }, n.prototype.updateFloorElevations = function () {
        for (var t = 0, e = 0; e < this.members.length; e++) {
            var n = this.getElement(e);
            n instanceof FloorStructure && (n.elevation = t, t += n.height)
        }
    }, n
} ();

var hcs = window.hcs || {};
hcs.Configuration = function () {
    var t = null;
    LOCAL_STORAGE_CONFIGURATION_KEY = "hcs.configuration";
    var e = function () {
        this.boundingSize = { min: { x: -5e3, y: -5e3, z: -5e3 }, max: { x: 5e3, y: 5e3, z: 5e3 }, getSize: function () {
            return { x: this.max.x - this.min.x, y: this.max.y - this.min.y, z: this.max.z - this.min.z }
        } 
        }, this.hardwareScalingLevel = 1, this.hasMobileConfig = !1, this.maxTextureSize = 1024, this.useAntialiasing = !0, this.useEnvMap = !0, this.useMultiLights = !0, this.useMultiTexturing = !0, this.useShadow = !0, this.useStats = !1, this.useAreaProcessing = !0, this.useRealtimeMeasure = !0, this.loadConfiguration(), t = this
    };
    return e.prototype.loadConfiguration = function () {
        var t = hcsLocalStorage.getItem(LOCAL_STORAGE_CONFIGURATION_KEY);
        if (null != t) {
            var e = JSON.parse(t);
            this.useAntialiasing = e.useAntialiasing, this.useAreaProcessing = e.useAreaProcessing, this.useRealtimeMeasure = e.useRealtimeMeasure, this.useShadow = e.useShadow, this.useEnvMap = e.useEnvMap, this.useMultiTexturing = e.useMultiTexturing, this.maxTextureSize = e.maxTextureSize, this.useMultiLights = e.useMultiLights, this.useStats = e.useStats, this.hasMobileConfig = e.hasMobileConfig, this.hardwareScalingLevel = e.hardwareScalingLevel ? e.hardwareScalingLevel : 1
        }
        return t ? !0 : !1
    }, e.prototype.saveConfiguration = function () {
        var t = this.serialize();
        hcsLocalStorage.setItem(LOCAL_STORAGE_CONFIGURATION_KEY, t)
    }, e.prototype.serialize = function () {
        var t = { useAntialiasing: this.useAntialiasing, useAreaProcessing: this.useAreaProcessing, useRealtimeMeasure: this.useRealtimeMeasure, useShadow: this.useShadow, useEnvMap: this.useEnvMap, useMultiTexturing: this.useMultiTexturing, maxTextureSize: this.maxTextureSize, useMultiLights: this.useMultiLights, useStats: this.useStats, hasMobileConfig: this.hasMobileConfig, hardwareScalingLevel: this.hardwareScalingLevel };
        return JSON.stringify(t)
    }, e.prototype.setQuality = function (t) {
        t === hcs.Constants.GRAPHICS_FAST ? (this.useAntialiasing = !1, this.useShadow = !1, this.useEnvMap = !1, this.useMultiTexturing = !1, this.useMultiLights = !1, this.hardwareScalingLevel = 1.5) : t === hcs.Constants.GRAPHICS_GOOD ? (this.useAntialiasing = !0, this.useShadow = !1, this.useEnvMap = !1, this.useMultiTexturing = !0, this.useMultiLights = !0, this.hardwareScalingLevel = 1) : (this.useAntialiasing = !0, this.useShadow = !0, this.useEnvMap = !0, this.useMultiTexturing = !0, this.useMultiLights = !0, this.hardwareScalingLevel = 1), this.saveConfiguration()
    }, e
} ();

var hcs = window.hcs || {};
hcs.ComponentCollection = function () {
    var t = function (t) {
        Array.call(this), this._core = t, this._componentsToRemove = [], this._initialized = !1, this._size = 0
    };
    return t.prototype = Object.create(Array.prototype), t.prototype.addComponent = function (t) {
        var e = new t(this._core);
        return this.addInstancedComponent(e)
    }, t.prototype.addInstancedComponent = function (t) {
        return t.dirty || this.getComponentByName(t.name) ? null : (t.core || (t.core = this._core, t.structure = this._core.structure), this._initialized && !t.initialized && (t.initialize(), t.initialized = !0), this.push(t), this.sort(function (t, e) {
            return e.priority - t.priority
        }), this._size++, t)
    }, t.prototype.clear = function () {
        for (var t = 0; t < this._size; t++)
            this[t].destroy();
        this._size = 0, this.length = 0
    }, t.prototype.getComponent = function (t) {
        return "string" == typeof t ? this.getComponentByName(t) : this[t]
    }, t.prototype.removeComponent = function (t, e) {
        var e = "undefined" != typeof e ? e : !1, n = -1;
        if ("number" == typeof t)
            n = t;
        else if ("string" == typeof t) {
            var i = this.getComponentByName(t);
            i && (n = this.indexOf(i))
        } else
            n = this.indexOf(t);
        return 0 > n || n >= this._size ? null : e ? (this[n].destroy(), this._size--, this.splice(n, 1)) : (this._componentsToRemove.push(this[n].name), null)
    }, t.prototype.initialize = function () {
        if (!this._initialized) {
            this._initialized = !0, this.checkDirtyComponents();
            for (var t = 0; t < this._size; t++)
                this[t].initialize()
        }
    }, t.prototype.update = function (t) {
        for (var e = 0; e < this._size; e++)
            this[e].update(t)
    }, t.prototype.draw = function (t) {
        for (var e = 0; e < this._size; e++)
            this[e].draw(t)
    }, t.prototype.checkDirtyComponents = function () {
        if (this._componentsToRemove.length) {
            for (var t = 0, e = this._componentsToRemove.length; e > t; t++)
                this.removeComponent(this._componentsToRemove[t], !0);
            this._componentsToRemove.length = 0
        }
    }, t.prototype.getComponentByName = function (t) {
        for (var e = 0; e < this._size; e++)
            if (this[e].name == t)
                return this[e];
        return null
    }, t.prototype.size = function () {
        return this._size
    }, t
} ();
var hcs = window.hcs || {};
hcs.Core = function () {
	function t() {
		var t = n.mode == n.MODE_EDITOR ? r : 0;
		n.setSize(window.innerWidth - t, window.innerHeight)
	}
	function e(t, e) {
		return t.uuid || (t.uuid = hcs.uuid.uuid4()), t.lastModified || "hcsLocalStorage" == e ? t.lastModified || (t.lastModified = 0) : t.lastModified = (new Date).getTime(), t
	}
	var n = null, i = 640, o = 480, r = 260, s = 260, a = 1, l = null, h = null, c = {}, u = hcs.Constants.MODE_STANDALONE, p = null, d = null, m = null, g = null, f = false, y = null, v = false, b = null, w = "2D", x = null, C = function (e, _, v) {
			if (this.version = e, this.isFullyInitialized = false, window.hcsdesign = this, this.ENGINE_2D = 1, this.ENGINE_3D = 2, this.MODE_EDITOR = 1, this.MODE_VIEWER = 2, this.LOCAL_STORAGE_STRUCTURE_KEY = "wanadev.planner.structure", this.i18n = _, hcs.UI.LanguageSelector.setLocal(_.getLocale().split("_")[0]), l = document.getElementById("container2d"), h = document.getElementById("container3d"), a = this.ENGINE_2D, c = {
				structure: [], limit: 50, cursor: 0, getLatest: function () {
					return this.structure[this.cursor]
				}
			}, v.css && HTMLHelper.addStylesheet(v.css), this.allow3D = "undefined" != typeof v.allow3D ? v.allow3D : true, this.api = v || {}, d = this.api.saveUrl || null, m = this.api.newUrl || null, g = this.api.planUrl || null, y = this.api.screenshotUrl || null, f = this.api.publisher || false, _origin = this.api.origin || false, this.mode = "true" === this.api.isViewer ? this.MODE_VIEWER : this.MODE_EDITOR, this.api.params = this.api.params ? JSON.parse(this.api.params) : {}, this.api.components && (this.api.components = JSON.parse(this.api.components)), this.api.id > 0) {
				p = this.api.id, u = hcs.Constants.MODE_CUSTOMER, b = this.api.params, w = this.api.screenshotMode || "2D", x = this.api.title || null;
				var C = b.env || "";
				hcs.Constants.PRODUCTS_CATEGORY_FILE = [hcs.Constants.hcs_URL, "data/", p, "/categories" + C + ".json"].join(""), 
			hcs.Constants.TEXTURES_FILE = [hcs.Constants.hcs_URL, "data/", p, "/textures" + C + ".json"].join(""), 
			hcs.Constants.PRODUCTS_FILE = [hcs.Constants.hcs_URL, "data/", p, "/products" + C + ".json"].join(""), 
			hcs.Constants.PRODUCTS_PREVIEWS = [hcs.Constants.hcs_URL, "data/previews/"].join("")
			}
			i = window.innerWidth, o = window.innerHeight, this.needPageRefresh = false, this.loopTimer = new hcs.LoopTimer, this.structure = new hcs.Structure(e), this.keyboardManager = new hcs.KeyboardManager, this.configuration = new hcs.Configuration, this.engine2D = new hcs.Engine2D(l, this), this.engine3D = null, this.engine3D = GlobalHelper.hasWebGL() ? new hcs.Engine3D(h) : new hcs.Dummy.Engine3D(h), this.aboutWindow = null;
			var M = this;
			n = this, window.addEventListener("resize", t, false);
			var D = false;
			if (document.addEventListener("keydown", function (t) {
				M.getSelectedEngine() === M.ENGINE_2D && ((t.ctrlKey || D) && 90 == t.keyCode ? n.backFromHistory() : (t.ctrlKey || n.pomme) && 89 == t.keyCode && n.nextFromHistory(), D = 91 == t.keyCode ? true : D)
			}, false), document.addEventListener("keyup", function () {
				D = false
			}, false), document.addEventListener("contextmenu", function (t) {
				t.preventDefault()
			}, false), window.addEventListener("message", function (t) {
				var e = JSON.parse(t.data);
				switch (e.action) {
					case "close-frame":
						hcs.UI.IFrame.close();
						break;
					case "resize-frame":
						hcs.UI.IFrame.resize(e.width, e.height);
						break;
					case "take-screenshot":
						this.takeScreenshot({})
				}
			}.bind(this)), GlobalHelper.isIE() < 11) {
				var B = document.getElementById("screenshot-flash");
				B && (B.style.display = "none")
			}
			this.setMenuWidth = function (t) {
				r = "number" == typeof t ? t : s
			}, this.getMenuWidth = function () {
				return r
			}
		};
	return C.prototype.initialize = function (t) {
		// function() {this.engie2D.bestZoom()}.bind(this) this��?Ӧ?|��??ʵ???����y��?����?��??�롧?
		this.mode == this.MODE_VIEWER ? this.initializeViewer(t) : this.initializeEditor(t), setTimeout(function () {
			this.engine2D.bestZoom()
		}.bind(this), 50), this.engine2D.bestZoom(), window.setTimeout(function () {
			this.hideSplashScreen()
		}.bind(this), 7e3), this.keyboardManager.startEventsListening(), GlobalHelper.hasWebGL() || HTMLHelper.hide3DMenus(), ujs.notify("hcs.core.initialized")
	}, C.prototype.initializeViewer = function (t) {
		var t = t || function () {
		}, e = this, n = document.getElementById("toggleEngine");
		this.changeToggleEngineLabel = function (t) {
			n.children[0].innerHTML = t
		}, GlobalHelper.hasWebGL() ? (n.setAttribute("title", _("Switch the view to 2D or 3D")), n.addEventListener("click", function () {
			e.switchEngine(), e.changeToggleEngineLabel("2D" == n.children[0].innerHTML ? "3D" : "2D")
		}, false)) : n.style.display = "none", this.changeToggleEngineLabel(+this.api.startOn2D ? "3D" : "2D"), this._createDefaultStructure(), this.menu = {
			addMenuItem: function () {
			}
		}, this.helpBubbleManager = {
			alreadyDisplayed: function () {
			}, display: function () {
			}
		}, this.engine2D.isViewer = true, this.engine3D.isViewer = true, this.engine2D.initialize(), this.engine3D.initialize(), g ? this._getStructureFromUrl(g, function (e) {
			this._loadStructure(e), this.engine2D.bestZoom(), this.hideSplashScreen(), t.call(this), ujs.notify("hcs.structure.locale.loaded")
		}.bind(this)) : this._localStructureExists() ? this._loadStructure(this._getLocaleStorageStructure(), function (e) {
			t(e), ujs.notify("hcs.structure.locale.loaded")
		}) : t(this)
	}, C.prototype.initializeEditor = function () {
		var t = this;
		this.helpBubbleManager = new hcs.UI.HelpBubbleManager(!GlobalHelper.isMobileDevice()), document.addEventListener("hcs.request.takeScreenshot", this.takeScreenshot, false), document.addEventListener("hcs.request.saveStructrure", this.saveStructure.bind(this), false), document.addEventListener("hcs.request.loadStructure", this.loadStructure.bind(this), false), this.engine2D.getContainer().addEventListener("touchend", this.saveHistory.bind(this), false), this.engine2D.getContainer().addEventListener("touchcancel", this.saveHistory.bind(this), false), this.engine3D.getContainer().addEventListener("touchend", this.saveHistory.bind(this), false), this.engine3D.getContainer().addEventListener("touchcancel", this.saveHistory.bind(this), false);
		var e = window.PointerEvent ? "pointerup" : "mouseup";
		if (e = window.MSPointerEvent ? "MSPointerUp" : e, this.engine2D.getContainer().addEventListener(e, this.saveHistory.bind(this), false), this.engine3D.getContainer().addEventListener(e, this.saveHistory.bind(this), false), document.addEventListener("hcs.request.saveHistory", this.saveHistory.bind(this), false), document.addEventListener("hcs.request.switchEngine", this.switchEngine.bind(this), false), document.addEventListener("hcs.request.changeEngine", function (e) {
			ujs.notify("hcs.request.closePopup"), "undefined" != typeof e.engine && setTimeout(function () {
				t.setSelectedEngine(e.engine)
			}, 10)
		}, false), document.addEventListener("hcs.request.changeLang", function () {
			ujs.notify("hcs.menu.top.deselect"), hcs.UI.LanguageSelector.show()
		}, false), this._createDefaultStructure(), this.engine2D.initialize(), this.engine3D.initialize(), v = true, ":new" == g) {
			var n = false;
			if (this._localStructureExists()) {
				var i = this._getLocaleStorageStructure(), o = hcsLocalStorage.getItem("wanadev.planner.stack");
				o != i.uuid && confirm(_("An unsaved plan exists, would you like to load it ?")) && (this._loadStructure(i), n = true)
			}
			n === false && (this._clearLocaleStructure(), this._createDefaultStructure(), ujs.notify("hcs.core.structure.loaded")), this.engine2D.bestZoom(), this.hideSplashScreen()
		} else
			g ? this._getStructureFromUrl(g, function (t) {
				if (!t)
					return this._localStructureExists() && this._loadStructure(this._getLocaleStorageStructure()), this.engine2D.bestZoom(), void this.hideSplashScreen();
				var e = this._getLocaleStorageStructure();
				this._loadStructure(e ? e.uuid == t.uuid ? e.lastModified >= t.lastModified ? e : t : t : t), this.structure.setCurrentStructureIndex(0), this.engine2D.bestZoom(), this.hideSplashScreen()
			}.bind(this)) : (this._localStructureExists() && this._loadStructure(this._getLocaleStorageStructure()), this.structure.setCurrentStructureIndex(0), this.engine2D.bestZoom(), this.hideSplashScreen());
		window.addEventListener("focus", function () {
			this.saveLocalStructure(false, true)
		}.bind(this), false), this.aboutWindow = new hcs.UI.AboutWindow, this.setSize(window.innerWidth - 260, window.innerHeight)
	}, C.prototype.update = function () {
		this.loopTimer.update(), this.keyboardManager.isPressed(82) && (this.keyboardManager.isPressed(17) || this.keyboardManager.isPressed(91) || this.keyboardManager.isPressed(224)) && (this.needPageRefresh || (this.needPageRefresh = true, location.href = location.href, this.needPageRefresh = false)), this.engine2D.isEnabled() && this.keyboardManager.isPressed(Keys.escape) && (this.engine2D.setMode(this.engine2D.MODE_NORMAL), ujs.notify("hcs.menu.main.deselect"), this.engine2D.requestStaticDraw(), this.keyboardManager.keys[Keys.escape] = false), this.engine2D.isEnabled() ? this.engine2D.update(this.loopTimer.getDeltaTime()) : this.engine3D.update(this.loopTimer.getDeltaTime())
	}, C.prototype.draw = function () {
		this.engine2D.isEnabled() ? this.engine2D.draw(this.loopTimer.getDeltaTime()) : this.engine3D.draw(this.loopTimer.getDeltaTime())
	}, C.prototype.compareVersion = function (t, e) {
		for (var n = t.split("."), i = e.split("."), o = 0, r = n.length, s = null; null === s && r > o; )
			void 0 !== n[o] && void 0 !== i[o] && (+n[o] < +i[o] ? s = -1 : +n[o] > +i[o] && (s = 1)), o++;
		return null !== s ? s : 0
	}, C.prototype.setSize = function (t, e) {
		i = t, o = e || t, n.engine2D.resize(), n.engine3D.resize()
	}, C.prototype.getWidth = function () {
		return i
	}, C.prototype.getHeight = function () {
		return o
	}, C.prototype.getContainer2D = function () {
		return l
	}, C.prototype.getContainer3D = function () {
		return h
	}, C.prototype.getSelectedEngine = function () {
		return a
	}, C.prototype.getPlanName = function () {
		return this.structure.uuid
	}, C.prototype.getPlanURL = function () {
		return g
	}, C.prototype.setSelectedEngine = function (t) {
		if (!this.allow3D && "2D" !== t && t !== this.ENGINE_2D) {
			var e = document.getElementById("toggleEngine");
			return void (e && e.parentNode.removeChild(e))
		}
		var n = t == this.ENGINE_3D || "3D" == t, i = this.engine2D.isEnabled() ? "2D" : "3D", o = n ? "3D" : "2D";
		this.engine2D.setEnabled(!n), this.engine3D.setEnabled(n), a = "3D" == t || t == this.ENGINE_3D ? this.ENGINE_3D : this.ENGINE_2D, ujs.notify("hcs.contextChanged", { context: o, previousContext: i }), this.helpBubbleManager && this.helpBubbleManager.helpBubble && this.helpBubbleManager.helpBubble.hide()
	}, C.prototype.getSelectedStructure = function () {
		return this.structure.getCurrentStructure()
	}, C.prototype.getHistory = function () {
		return c
	}, C.prototype.takeScreenshot = function (t, e, i) {
		var o, r = "undefined" != typeof t.selectedEngine ? t.selectedEngine : a, s = "undefined" != typeof t.sendBlob ? t.sendBlob : false, e = e || function () {
			}, i = i || function () {
			};
		if (o = r == n.ENGINE_2D ? l.children[0] : h.children[0], u == hcs.Constants.MODE_STANDALONE || null === y) {
			if (e(), s)
				return o.toDataURL("image/png");
			r === n.ENGINE_2D ? o.toBlob(function (t) {
				saveAs(t, "plan.png")
			}) : GlobalHelper.createScreenshot3D(n.engine3D.engine, void 0, function (t) {
				t.toBlob(function (t) {
					saveAs(t, "plan.png")
				})
			})
		} else {
			var c = [];
			if (b) {
				var p = b;
				"object" == typeof p && (p = JSON.stringify(p)), c.push("params=" + p + "&")
			}
			var d = function (t) {
				ujs.ajax({
					method: "POST", withCredentials: true, url: y, params: t.join(""), error: i, success: function (t) {
						var o = JSON.parse(t), r = _("An error occured. Please try later.");
						if ("ok" === o.status)
							r = _("Your screenshot has been saved."), n.structure.planId = true, hcs.UI.MessageBox.show({ title: _("Screenshot"), message: r, buttonAText: _("Close"), buttonA: true, autoHide: true, force: true }), o.params && (b = o.params), hcs.UI.MessageBox.show(s), e();
						else {
							if (o.connectionUrl)
								n._loginIframe(o.connectionUrl, o.frameWidth || Math.round(window.innerWidth / 2), o.frameHeight || Math.round(window.innerHeight / 2));
							else {
								var s = {
									title: _("Screenshot"), message: o.message || _("Error occured during save."), buttonA: true, buttonAText: _("Ok"), onClickA: function () {
										hcs.UI.MessageBox.close()
									}
								};
								hcs.UI.MessageBox.show(s)
							}
							i()
						}
					}
				})
			};
			r === n.ENGINE_2D ? (c.push("screenshot=" + o.toDataURL("image/png")), d(c)) : GlobalHelper.createScreenshot3D(n.engine3D.engine, void 0, function (t) {
				c.push("screenshot=" + t.toDataURL("image/png")), d(c)
			})
		}
		if (!GlobalHelper.isIE10()) {
			var m = document.getElementById("screenshot-flash");
			m.style.opacity = 1;
			var g = setTimeout(function () {
				clearTimeout(g), m.style.opacity = 0
			}, 200)
		}
	}, C.prototype.switchEngine = function () {
		this.setSelectedEngine(a == this.ENGINE_2D ? this.ENGINE_3D : this.ENGINE_2D)
	}, C.prototype.getComponentByName = function (t, e) {
		var e = void 0 != typeof e ? e : 3;
		if (e == this.ENGINE_2D)
			return this.engine2D.searchComponent(t);
		if (e == this.ENGINE_3D)
			return this.engine3D.searchComponent(t);
		var n = this.engine2D.searchComponent(t);
		return n || (n = this.engine3D.searchComponent(t)), n
	}, C.prototype.addStrutureElement = function (t) {
		this.structure.addElement(t)
	}, C.prototype.updateDeserialisation = function (t) {
		this.engine2D.requestStaticDraw(), this.unlock(t), this.getComponentByName("RoomComponent2D", this.ENGINE_2D).needsUpdate = true, this.engine2D.requestStaticDraw(), this.engine2D.requestCompute(), this.engine2D.update(), this.engine2D.draw()
	}, C.prototype.checkLocalPlan = function () {
		var t = hcsLocalStorage.getItem(this.LOCAL_STORAGE_STRUCTURE_KEY);
		null != t && this.loadLocalStructure(false)
	}, C.prototype.saveLocalStructure = function (t, e) {
		if (this.mode == this.MODE_VIEWER)
			return null;
        var t = "undefined" != typeof t ? t : false, 
            //��ǰ�ṹ
            currentStructure = n.structure.serialize(),
            //���ش洢�ṹ 
            localStructure = hcsLocalStorage.getItem(n.LOCAL_STORAGE_STRUCTURE_KEY);
		return localStructure !== currentStructure || e ? (n.removeLocalStructure(false), hcsLocalStorage.setItem(n.LOCAL_STORAGE_STRUCTURE_KEY, currentStructure), t && hcs.UI.MessageBox.show({ title: _("��������"), message: _("���������Ѿ������ɹ�."), buttonAText: _("�ر�"), button: true }), currentStructure) : null
	}, C.prototype.loadLocalStructure = function (t) {
		var t = "undefined" != typeof t ? t : false, e = hcsLocalStorage.getItem(this.LOCAL_STORAGE_STRUCTURE_KEY), n = this;
		if (null != e) {
			var i = n.lock();
			return n.structure.deserialize(e) ? (n.structure.setCurrentStructureIndex(0), n.updateDeserialisation(i)) : (this.removeLocalStructure(false), t && hcs.UI.MessageBox.show({ title: _("Load a Plan"), message: _("Unable to load your plan: its version is too old."), buttonAText: _("Close"), buttonA: true })), t && hcs.UI.MessageBox.show({ title: _("Load a Plan"), message: _("Your plan has been loaded."), buttonAText: _("Close"), buttonA: true }), ujs.notify("hcs.structure.locale.loaded"), true
		}
		return t && hcs.UI.MessageBox.show({ title: _("Load a Plan"), message: _("You have no saved plan."), buttonAText: _("Close"), buttonA: true }), false
	}, C.prototype.removeLocalStructure = function (t) {
		var t = "undefined" != typeof t ? t : false, e = hcsLocalStorage.getItem(this.LOCAL_STORAGE_STRUCTURE_KEY);
		return null != e ? (hcsLocalStorage.removeItem(this.LOCAL_STORAGE_STRUCTURE_KEY), t && hcs.UI.MessageBox.show({ title: _("Remove a Plan"), message: _("Your plan has been removed."), buttonAText: _("Close"), button: true }), true) : false
	}, C.prototype.getPreviewImage = function (t, e) {
		var i = null, o = null, r = n.engine2D.getZoom(), s = n.engine2D.getTranslation();
		n.setSize(t, e), this.getSelectedEngine() == this.ENGINE_2D ? (n.engine2D.bestZoom(), n.engine2D.draw(), o = n.engine2D.canvas) : (o = n.getContainer3D().getElementsByTagName("canvas")[0], n.engine3D.draw()), i = o.toDataURL("image/png");
		var a = n.mode == n.MODE_EDITOR ? 260 : 0;
		return n.setSize(window.innerWidth - a, window.innerHeight), this.getSelectedEngine() == this.ENGINE_2D && (n.engine2D.setZoom(r), n.engine2D.setTranslation(s)), i
	}, C.prototype.saveStackToLocal = function () {
		hcsLocalStorage.setItem("wanadev.planner.stack", n.structure.uuid)
	}, C.prototype.saveStructure = function () {
	}, C.prototype.loadStructure = function (t, e) {
		var e = e || function () {
		}, i = function (t) {
				n.removeLocalStructure();
				var i = n.lock();
				n.structure.deserialize(t) && n.updateDeserialisation(i), n.saveLocalStructure(false), e(1)
			}, o = function (t) {
				ujs.ajax({
					url: hcs.Constants.BACK_URL + hcs.Constants.MIGRATION_PATH + t, withCredentials: true, success: function (t) {
						t ? i(t) : e(-1)
					}
				})
			};
		g ? (ujs.ajax({
			url: g, withCredentials: true, success: function (t) {
				if (t) {
					var n = JSON.parse(t);
					1 == hcsdesign.compareVersion(hcs.Constants.VERSION, n.version) ? i(t) : (console.log("migration"), o(g))
				} else
					e(-1)
			}
		}), g = null) : e(-2)
	}, C.prototype.saveHistory = function () {
		{
			var t = this.saveLocalStructure(false), e = this.getHistory().structure.length;
			this.getHistory().getLatest()
		}
		null != t && (this.getHistory().cursor < e - 1 && this.getHistory().structure.splice(this.getHistory().cursor + 1, e - this.getHistory().cursor), e > this.getHistory().maxSize && this.getHistory().structure.splice(0, 1), this.getHistory().cursor = this.getHistory().structure.push(t) - 1)
	}, C.prototype.backFromHistory = function () {
		this.getHistory().cursor <= 0 ? this.getHistory().cursor = 0 : this.getHistory().cursor--;
		var t = this.getHistory().structure[this.getHistory().cursor];
		if (null != t) {
			var e = this.lock();
			this.structure.deserialize(t) && this.updateDeserialisation(e)
		}
		this.engine2D.requestCompute(), this.engine2D.requestStaticDraw(), this.engine2D.update()
	}, C.prototype.lock = function () {
		var t = { engine2D: n.engine2D.isEnabled(), engine3D: n.engine3D.enabled };
		return this.engine2D._enabled = false, this.engine3D.enabled = false, t
	}, C.prototype.unlock = function (t) {
		this.engine2D._enabled = t.engine2D, this.engine3D.enabled = t.engine3D
	}, C.prototype.nextFromHistory = function () {
		this.getHistory().cursor < this.getHistory().structure.length && this.getHistory().cursor++;
		var t = this.getHistory().structure[this.getHistory().cursor];
		null != t && this.structure.deserialize(t), this.engine2D.requestCompute()
	}, C.prototype.hideSplashScreen = function (t) {
		var t = t || 800;
		document.getElementById("splash-bar-inner").style.webkitAnimationDuration = "1s", document.getElementById("splash-bar-inner").style.animationDuration = "1s";
		window.setTimeout(function () {
			document.getElementById("splashscreen").style.display = "none", n.isFullyInitialized = true
		}, t)
	}, C.prototype._localStructureExists = function () {
		return void 0 != hcsLocalStorage.getItem(this.LOCAL_STORAGE_STRUCTURE_KEY) ? true : false
	}, C.prototype._getLocaleStorageStructure = function () {
		return this._localStructureExists() ? e(JSON.parse(hcsLocalStorage.getItem(this.LOCAL_STORAGE_STRUCTURE_KEY)), "hcsLocalStorage") : null
	}, C.prototype.isPublisher = function () {
		return f
	}, C.prototype.getOrigin = function () {
		return _origin
	}, C.prototype._getStructureFromUrl = function (t, n) {
		var i = function (i) {
			if (i) {
				var r = JSON.parse(i);
				1 == hcsdesign.compareVersion(hcs.Constants.VERSION, r.version) ? o(t, n) : n(e(r))
			} else
				n(null)
		}, o = function (t, e) {
				var n = hcs.Constants.BACK_URL + hcs.Constants.MIGRATION_PATH + t;
				ujs.ajax({
					url: n, success: i, onerror: function () {
						r(n, e)
					}
				})
			}, r = function (t) {
				var e = "/php/retrieveJson.php?json=" + t;
				ujs.ajax({ url: e, withCredentials: true, success: i })
			};
		ujs.ajax({
			url: t, withCredentials: true, success: i, onerror: function () {
				r(t, n)
			}
		})
	}, C.prototype.coherenceControl = function (t) {
		for (var e in t.members)
			this.engine2D.coherenceControl(t.members[e])
	}, C.prototype._loadStructure = function (t, e) {
		this.structure.deserialize("string" == typeof t ? t : JSON.stringify(t)), ujs.notify("hcs.core.structure.loaded");
		var e = e || function () {
		};
		e.call(this), this.engine2D.requestCompute()
	}, C.prototype._clearLocaleStructure = function () {
		var t = hcsLocalStorage.getItem(this.LOCAL_STORAGE_STRUCTURE_KEY);
		null != t && hcsLocalStorage.removeItem(this.LOCAL_STORAGE_STRUCTURE_KEY), this.structure.clear()
	}, C.prototype._createDefaultStructure = function () {
		this.addStrutureElement(new FloorStructure);
		for (var t = this.structure.getCurrentStructure(), e = [new PolygonWall, new PolygonWall, new PolygonWall, new PolygonWall], n = [new BABYLON.Vector2(-515, 0), new BABYLON.Vector2(0, 415), new BABYLON.Vector2(515, 0), new BABYLON.Vector2(0, -415)], i = 0; i < e.length; i++) {
			var o = (i + 1) % e.length;
			e[i].setPoints(e[o].getPoints(0), 1)
		}
		for (var i = 0; i < e.length; i++)
			e[i].translate(n[i]), t.insertElement("walls", e[i]), t.insertElement("points", e[i].getPoints(1))
	}, C.prototype._loginIframe = function (t, e, n) {
		var e = e || window.innerWidth / 2, n = n || window.innerHeight / 2;
		hcs.UI.IFrame.show(document.body, { width: e, height: n, src: t }, { showClose: true })
	}, C
}();

var hcs = window.hcs || {};
hcs.Engine2D = function() {
    var t = function(t, e, n) {
        this.MODE_NORMAL = 1, this.MODE_DRAG = 2, this.MODE_DRAW = 4, this.MODE_CONTEXTMENU = 8, this.MODE_SUBSLOPE = 16, this._container = t, this.isViewer = "undefined" != typeof n ? n : !1, this.getContainer = function() {
            return this._container
        }, this.canvas = document.createElement("canvas"), this.canvas.id = "canvas2d", this._container.appendChild(this.canvas), this.dynamicCanvas = document.createElement("canvas"), this.dynamicCanvas.id = "dynamiccanvas2d", this._container.appendChild(this.dynamicCanvas), this.symbols2D = new hcs.Symbols2D, this._core = e, this._components = new hcs.ComponentCollection(hcsdesign), this._initialized = !1, this._enabled = !1, this._zoom = 1, this._translation = new BABYLON.Vector2, this._cursorIconCb = null, this._pointerManager = null, this._mode = this.MODE_NORMAL, this._lastMode = this.MODE_NORMAL, this._enableAutoScroll = !1, this._eventsCb = {
            click: [],
            "double-click": [],
            hover: [],
            leave: [],
            "mouse-move": [],
            "drag-start": [],
            dragging: [],
            "drag-end": [],
            "zoom-in": [],
            "zoom-out": [],
            "key-pressed": [],
            "key-released": [],
            "static-draw": [],
            "dynamic-draw": [],
            "draw-end": [],
            "subslope-end": [],
            "enter-draw-zone": [],
            "leave-draw-zone": []
        }, this._lastTargeted = null, this._isHover = !1, this._needStaticDraw = !0, this._needDynamicDraw = !0, this._menuIsVisible = !0, this._contextMenuCallback = null, this._contextMenuRmCallback = null, this._contextMenuTarget = null, document.addEventListener("hcs.engine2D.contextMenu.propertyChanged", this.onContextMenuPropertyChanged.bind(this), !1), document.addEventListener("hcs.engine2D.contextMenu.close", this.onContextMenuClose.bind(this), !1), document.addEventListener("hcs.ui.frame.close", this.onContextMenuClose.bind(this), !1), document.addEventListener("hcs.engine2D.contextMenu.remove", this.onContextMenuRemove.bind(this), !1), document.addEventListener("hcs.engine2D.contextMenu.debug", this.onContextMenuDebug.bind(this), !1)
    };
    return t.prototype.isEnabled = function() {
        return this._enabled
    }, t.prototype.setEnabled = function(t) {
        this._enabled = t;
        var e = "none";
        t && (e = "block"), this.setMode(this.MODE_NORMAL), this._container.setAttribute("style", "display:" + e), this.requestStaticDraw(), ujs.notify("hcs.core.hideLoader")
    }, t.prototype.getZoom = function() {
        return this._zoom
    }, t.prototype.setZoom = function(t) {
        this._zoom = t, this._zoom = this._zoom < .1 ? .1 : this._zoom, this._zoom = this._zoom > 5 ? 5 : this._zoom, this.requestStaticDraw(), ujs.notify("hcs.request.zoomUpdated")
    }, t.prototype.getTranslation = function() {
        return this._translation.clone()
    }, t.prototype.setTranslation = function(t) {
        if (t instanceof BABYLON.Vector2) {
            var e = this._core.configuration.boundingSize,
                n = 100,
                i = this._core.getWidth() / 2 + (this.getZoom() * Math.abs(e.min.x) - this._core.getWidth() / 2) + n,
                o = this._core.getHeight() / 2 + (this.getZoom() * Math.abs(e.min.y) - this._core.getHeight() / 2) + n,
                r = this._core.getWidth() / 2 - (this.getZoom() * Math.abs(e.max.x) - this._core.getWidth() / 2) - n,
                s = this._core.getHeight() / 2 - (this.getZoom() * Math.abs(e.max.y) - this._core.getHeight() / 2) - n;
            t.x >= i && t.x <= r ? t.x = (i + r) / 2 : t.x > i ? t.x = i : t.x < r && (t.x = r), t.y >= o && t.y <= s ? t.y = (o + s) / 2 : t.y > o ? t.y = o : t.y < s && (t.y = s), this._translation.copyFrom(t), this._translation.x = Math.round(this._translation.x), this._translation.y = Math.round(this._translation.y), this.requestStaticDraw()
        }
    }, t.prototype.toRealCoord = function(t, e, n) {
        var i = t.scale(n || this.getZoom());
        return i.addInPlace(e || this.getTranslation()), i
    }, t.prototype.getMode = function() {
        return this._mode == this.MODE_DRAG || this._mode == this.MODE_CONTEXTMENU ? this._mode | this._lastMode : this._mode
    }, t.prototype.setMode = function(t) {
        if (t != this._mode) {
            var e = {
                mode: this._mode,
                lastMode: this._lastMode,
                newMode: t
            };
            this._lastMode = this._mode, this._mode = t, this._stateMachine(e)
        }
    }, t.prototype.setEnableAutoScroll = function(t) {
        this._enableAutoScroll = t
    }, t.prototype.getTarget = function(t) {
        if (!this.isViewer) {
            for (var t = t || this._pointerManager.getStatus(), e = 0; e < this._components.size(); e++) {
                var n = this._components[e].getTargeted(t.planPos);
                if (null != n)
                    return n
            }
            return null
        }
    }, t.prototype.getMouseState = function() {
        return this._pointerManager.getStatus()
    }, t.prototype.setCursorIcon = function(t) {
        this._cursorIconCb = t, this.requestDynamicDraw()
    }, t.prototype.initialize = function() {
        this._pointerManager = new hcs.PointerManager(this._core, this.onMouseEvent.bind(this), this.dynamicCanvas), this.dynamicCanvas.addEventListener("mouseout", function(t) {
            this._callInOutDrawZoneCb("leave-draw-zone", t)
        }.bind(this), !1), this.dynamicCanvas.addEventListener("mousein", function(t) {
            this._callInOutDrawZoneCb("enter-draw-zone", t)
        }.bind(this), !1), this.setTranslation(new BABYLON.Vector2((this._core.getWidth() - 260) / 2, this._core.getHeight() / 2)), this.resize(), this.initializeComponents(), this._initialized = !0, document.addEventListener("hcs.engine2D.requestCompute", function() {
            this.requestCompute()
        }.bind(this), !1), window.setTimeout(function() {
            /*this._core.helpBubbleManager.display("hcs.2d.wall-basics")*/
        }.bind(this), 2e3)
    }, t.prototype.bestZoom = function(t, e) {
        var n = this.getBestZoomAttributes(t, e);
        this.setZoom(n.zoom), this.setTranslation(n.translation), this.requestCompute()
    }, t.prototype.getBestZoomAttributes = function(t, e) {
        var n = t || this._core.getWidth(),
            i = e || this._core.getHeight(),
            o = this._core.getSelectedStructure().walls,
            r = {
                min: {
                    x: 1 / 0,
                    y: 1 / 0
                },
                max: {
                    x: -1 / 0,
                    y: -1 / 0
                }
            };
        for (var s in o) {
            var a = o[s].getBoundingBox();
            a.min.x < r.min.x && (r.min.x = a.min.x), a.min.y < r.min.y && (r.min.y = a.min.y), a.max.x > r.max.x && (r.max.x = a.max.x), a.max.y > r.max.y && (r.max.y = a.max.y)
        }
        var l = r.max.x - r.min.x + 100,
            h = r.max.y - r.min.y + 100,
            c = 1;
        (l > n || h > i) && (c = Math.min(i / h, n / l));
        var u = new BABYLON.Vector2(n / 2, i / 2);
        return u.x -= (r.max.x + r.min.x) / 2 * c, u.y -= (r.max.y + r.min.y) / 2 * c, {
            zoom: c,
            translation: u
        }
    }, t.prototype.reinitialize = function() {
        this.setMode(this.MODE_NORMAL), this.setTranslation(new BABYLON.Vector2((this._core.getWidth() - this._core.getMenuWidth()) / 2, this._core.getHeight() / 2)), this.resize(), this.requestCompute(), this.bestZoom()
    }, t.prototype.initializeComponents = function() {
        this._components.initialize()
    }, t.prototype.resize = function(t, e) {
        this.canvas.width = t || this._core.getWidth(), this.canvas.height = e || this._core.getHeight(), this.dynamicCanvas.width = t || this._core.getWidth(), this.dynamicCanvas.height = e || this._core.getHeight(), this._pointerManager && this._pointerManager.resize(), this.requestStaticDraw()
    }, t.prototype.update = function(t) {
        this._components.checkDirtyComponents();
        var t = t === !0 ? !0 : !1;
        if (t)
            for (var e = 0; e < this._components.size(); e++)
                for (var n = 0; n < hcsdesign.structure.members.length; n++) {
                    var i = hcsdesign.structure.members[n];
                    this._components[e].update(i), i.tidy()
                } else
            this._components.update(), hcsdesign.getSelectedStructure().tidy();
        this._autoScroll()
    }, t.prototype.draw = function() {
        this.update(), hcs.AnimationHandler.Process(), this._needStaticDraw && (this._needStaticDraw = !1, this._callStaticDrawCb()), this._needDynamicDraw && (this._needDynamicDraw = !1, this._callDynamicDrawCb())
    }, t.prototype.registerEventCb = function(t, e, n, i, o, r, s) {
        var s = s || null;
        this.unregisterEventCb(t), this._eventsCb[n].push({
            id: t,
            priority: e,
            mode: i,
            objType: o,
            callback: r,
            data: s
        }), this._eventsCb[n].sort("static-draw" != n && "dynamic-draw" != n ? function(t, e) {
            return e.priority - t.priority
        } : function(t, e) {
            return t.priority - e.priority
        })
    }, t.prototype.unregisterEventCb = function(t) {
        for (var e in this._eventsCb)
            if (this._eventsCb.hasOwnProperty(e))
                for (var n in this._eventsCb[e])
                    this._eventsCb[e][n].id == t && delete this._eventsCb[e][n]
    }, t.prototype.addComponent = function(t) {
        return this._components.addComponent(t)
    }, t.prototype.addInstancedComponent = function(t) {
        return this._components.addInstancedComponent(t)
    }, t.prototype.getComponent = function() {
        return this._components.getComponent(name)
    }, t.prototype.searchComponent = function(t) {
        return this._components.getComponent(t)
    }, t.prototype.removeComponent = function(t, e) {
        return this._components.removeComponent(t, e)
    }, t.prototype.removeComponentByName = function(t) {
        return this._components.removeComponent(t)
    }, t.prototype.clearComponents = function() {
        this._components.clear()
    }, t.prototype.requestStaticDraw = function() {
        this._needStaticDraw = !0, this.requestDynamicDraw()
    }, t.prototype.requestDynamicDraw = function() {
        this._needDynamicDraw = !0
    }, t.prototype.requestCompute = function() {
        for (var t = 0; t < this._components.size(); t++)
            this._components[t].compute();
        this.requestStaticDraw()
    }, t.prototype.setCursor = function(t) {
        var t = t || "default";
        this.dynamicCanvas.style.cursor = t
    }, t.prototype.displayContextMenu = function(t, e, n, i) {
        var o = this._pointerManager.getStatus(),
            r = [];
        this._contextMenuCallback = n, this._contextMenuRmCallback = i, this._contextMenuTarget = e;
        for (var s in t) {
            var a = t[s];
            a.eventParams = {
                cast: a.cast || a.type,
                property: a.name,
                eventName: "hcs.engine2D.contextMenu.propertyChanged"
            }, r.push(a)
        }
        var l = [{
                title: "Tab 1",
                content: r
            }],
            h = [];
        window.WNP_DEBUG && h.push({
            label: "Debug",
            action: "hcs.engine2D.contextMenu.debug"
        }), null != i && h.push({
            label: _("删除"),
            action: "hcs.engine2D.contextMenu.remove",
            "class": "remove"
        }), h.push({
            label: _("确定"),
            action: "hcs.engine2D.contextMenu.close"
        }), this._callMouseEventCb("leave", e, {}, o), this.requestStaticDraw(), this.setMode(this.MODE_CONTEXTMENU);
        var c = (o.prevButtons & o.BUTTON_LEFT) > 0 ? 200 : 0,
            u = this._enabled ? o.pos.x + 2 : this._core.getWidth() / 2,
            p = this._enabled ? o.pos.y + 2 : 100;
        hcs.UI.ContextMenu.show({
            title: _("设置"),
            x: u,
            y: p
        }, l, h, c)
    }, t.prototype._stateMachine = function(t) {
        var e = this._mode,
            n = this._lastMode,
            i = this._mode,
            o = null,
            r = null,
            s = {},
            a = this._lastTargeted,
            l = this._lastTargeted;
        void 0 !== t.mode && (e = t.mode), void 0 !== t.lastMode && (n = t.lastMode), void 0 !== t.newMode && (i = t.newMode), o = void 0 !== t.mstate ? t.mstate : this._pointerManager.getStatus(), void 0 !== t.evName && (r = t.evName), void 0 !== t.ev && (s = t.ev), void 0 !== t.target && (a = t.target), void 0 !== t.lastTarget && (l = t.lastTarget);
        var h = !1;
        e != i && (h = !0);
        var c = !1;
        if (null != r && (c = !0), h)
            if ((e & this.MODE_DRAW) > 0 && 0 == (i & this.MODE_DRAG) ? this._callDrawEndCb() : (n & this.MODE_DRAW) > 0 && (e & this.MODE_DRAG) > 0 && 0 == (i & (this.MODE_DRAW | this.MODE_DRAG)) && this._callDrawEndCb(), (e & this.MODE_SUBSLOPE) > 0 && 0 == (i & this.MODE_DRAG) ? this._callSubslopeEndCb() : (n & this.MODE_SUBSLOPE) > 0 && (e & this.MODE_DRAG) > 0 && 0 == (i & (this.MODE_SUBSLOPE | this.MODE_DRAG | this.MODE_CONTEXTMENU)) && this._callSubslopeEndCb(), (e & this.MODE_CONTEXTMENU) > 0 && 0 == (i & this.MODE_CONTEXTMENU) ? (hcs.UI.ContextMenu.close(), this.requestCompute(), this._core.keyboardManager.preventDefault = !0) : (i & this.MODE_CONTEXTMENU) > 0 && (this._core.keyboardManager.preventDefault = !1), (e & this.MODE_DRAG) > 0 && 0 == (i & this.MODE_DRAG))
                (o.actions & o.ACTION_DRAGGING) > 0 && (this._pointerManager.reset(), this._callMouseEventCb("drag-end", a, s, o, this.MODE_DRAG)), this._eventsCb.dragging.length = 0, this._eventsCb["drag-end"].length = 0;
            else if ((e & this.MODE_DRAW) > 0 && 0 == (i & (this.MODE_DRAG | this.MODE_DRAW)))
            for (var u in this._eventsCb)
                if (this._eventsCb.hasOwnProperty(u))
                    for (var p in this._eventsCb[u])
                        this._eventsCb[u][p].mode == this.MODE_DRAW && delete this._eventsCb[u][p];
        if (h)
            switch (i) {
                case this.MODE_DRAG:
                    this.setCursor(e == this.MODE_DRAW ? "crosshair" : "move");
                    break;
                case this.MODE_DRAW:
                    this.setCursor("crosshair");
                    break;
                default:
                    this.setCursor("default")
            }
        if (c && 0 == (e & this.MODE_CONTEXTMENU))
            switch (r) {
                case "drag-start":
                    this._callMouseEventCb("drag-start", a, s, o, e), i = this.MODE_DRAG, this.setMode(i);
                    break;
                case "drag-end":
                    this._callMouseEventCb("drag-end", a, s, o, e), this._mode == this.MODE_DRAG ? (i = n, this.setMode(i)) : i = this._mode, l = a, a = this.getTarget(o);
                    break;
                case "double-click":
                    this._callMouseEventCb("double-click", a, s, o, e), l = a, a = this.getTarget(o);
                    break;
                case "mouse-move":
                    (this.getMode() & this.MODE_DRAG) > 0 && (t.evName = "drag-end", this._stateMachine(t)), this._callMouseEventCb("mouse-move", a, s, o, e);
                    break;
                default:
                    this._callMouseEventCb(r, a, s, o, e)
            }
            (e & (this.MODE_NORMAL | this.MODE_CONTEXTMENU)) > 0 && this.setEnableAutoScroll(!1), c && (e & this.MODE_CONTEXTMENU) > 0 && ("click" == r || "double-click" == r ? (i = n, this.setMode(i)) : "drag-start" == r && (i = n, this.setMode(i), t.evName = "drag-start", t.target = this.getTarget(o), this._stateMachine(t))), a != l && 0 == (e & this.MODE_CONTEXTMENU) ? (null != l && this._callMouseEventCb("leave", l, s, o, e), null != a && this._callMouseEventCb("hover", a, s, o, i)) : e != i && 0 == (e & this.MODE_CONTEXTMENU) ? null != a && (this._callMouseEventCb("leave", a, s, o, e), this._callMouseEventCb("hover", a, s, o, i)) : e != i && 0 == (i & this.MODE_CONTEXTMENU) && null != a && (this._callMouseEventCb("leave", a, s, o, e), this._callMouseEventCb("hover", a, s, o, i)), e != i && 0 == (e & (this.MODE_DRAG | this.MODE_CONTEXTMENU)) && (i & this.MODE_SUBSLOPE) > 1 &&/*? *this._core.helpBubbleManager.display("hcs.2d.subslope") :*/ e != i && 0 == (e & (this.MODE_DRAG | this.MODE_CONTEXTMENU)) && (i & this.MODE_DRAW) > 1 || e != i && 0 == (e & (this.MODE_DRAG | this.MODE_CONTEXTMENU)) && 0 == (i & (this.MODE_DRAG | this.MODE_CONTEXTMENU)) /*&& this._core.helpBubbleManager.helpBubble.hide()*/
    }, t.prototype._callMouseEventCb = function(t, e, n, i, o) {
        if (void 0 != t) {
            var e = e;
            void 0 == e && (e = null);
            var n = n;
            void 0 == n && (n = {});
            var i = i;
            void 0 == i && (i = this._pointerManager.getStatus());
            var o = o;
            void 0 == o && (o = this.getMode());
            for (var r in this._eventsCb[t])
                if ((null == this._eventsCb[t][r].mode || (o & this._eventsCb[t][r].mode) > 0) && (null == this._eventsCb[t][r].objType || e instanceof this._eventsCb[t][r].objType)) {
                    var s = this._eventsCb[t][r].callback(n, e, i, this._eventsCb[t][r].data);
                    if (s === !1)
                        break
                }
        }
    }, t.prototype._callStaticDrawCb = function() {
        var t = this.canvas.getContext("2d");
        t.clearRect(0, 0, this._core.getWidth(), this._core.getHeight());
        for (var e in this._eventsCb["static-draw"])
            this._eventsCb["static-draw"][e] && (null == this._eventsCb["static-draw"][e].mode || (this._eventsCb["static-draw"][e].mode & this.getMode()) > 0) && (t.save(), this._eventsCb["static-draw"][e].callback(t, this.getTranslation(), this.getZoom(), this._eventsCb["static-draw"][e].data), t.restore())
    }, t.prototype._callInOutDrawZoneCb = function(t, e) {
        for (var n in this._eventsCb[t])
            this._eventsCb[t][n] && (null == this._eventsCb[t][n].mode || (this._eventsCb[t][n].mode & this.getMode()) > 0) && this._eventsCb[t][n].callback(e, this._eventsCb[t][n].data)
    }, t.prototype._callDynamicDrawCb = function() {
        var t = this.dynamicCanvas.getContext("2d");
        t.clearRect(0, 0, this._core.getWidth(), this._core.getHeight());
        for (var e in this._eventsCb["dynamic-draw"])
            this._eventsCb["dynamic-draw"][e] && (null == this._eventsCb["dynamic-draw"][e].mode || (this._eventsCb["dynamic-draw"][e].mode & this.getMode()) > 0) && (t.save(), this._eventsCb["dynamic-draw"][e].callback(t, this.getTranslation(), this.getZoom(), this._eventsCb["dynamic-draw"][e].data), t.restore());
        this._cursorIconCb && (this._cursorIconCb(t, this.getMouseState().pos), this._cursorIconCb = null)
    }, t.prototype._callDrawEndCb = function() {
        for (var t in this._eventsCb["draw-end"])
            this._eventsCb["draw-end"][t] && this._eventsCb["draw-end"][t].callback(this._eventsCb["draw-end"][t].data)
    }, t.prototype._callSubslopeEndCb = function() {
        for (var t in this._eventsCb["subslope-end"])
            this._eventsCb["subslope-end"][t] && this._eventsCb["subslope-end"][t].callback(this._eventsCb["subslope-end"][t].data)
    }, t.prototype._autoScroll = function() {
        if (this._enableAutoScroll || (this.getMode() & this.MODE_DRAG) > 1 && this.getTarget()) {
            var t = 3,
                e = 35,
                n = !1,
                i = this.getMouseState(),
                o = this.getTranslation();
            if (Math.abs(i.planPos.x) >= this._core.configuration.boundingSize.max.x || Math.abs(i.planPos.y) >= this._core.configuration.boundingSize.max.y)
                return;
            if (i.pos.y < e ? (o.y += t, i.posDelta.y = -t, n = !0) : i.pos.y > this._core.getHeight() - e && (o.y -= t, i.posDelta.y = t, n = !0), i.pos.x < e ? (o.x += t, i.posDelta.x = -t, n = !0) : i.pos.x > this._core.getWidth() - e && (o.x -= t, i.posDelta.x = t, n = !0), n) {
                this.setTranslation(o);
                var r = "mouse-move";
                (this.getMode() & this.MODE_DRAG) > 0 && (r = "dragging"), this._stateMachine({
                    evName: r,
                    ev: {},
                    mstate: i
                })
            }
        }
    }, t.prototype.onMouseEvent = function(t, e) {
        if (this._enabled) {
            var n = this.getTarget(e),
                i = null;
            e.actions > 0 ? (e.actions & e.ACTION_CLICK) > 0 ? i = "click" : (e.actions & e.ACTION_DBLCLICK) > 0 ? i = "double-click" : (e.actions & e.ACTION_DRAGSTART) > 0 && this._mode != this.MODE_DRAG ? i = "drag-start" : (e.actions & e.ACTION_DRAGGING) > 0 ? i = "dragging" : (e.actions & e.ACTION_DRAGEND) > 0 ? i = "drag-end" : (e.actions & e.ACTION_SCROLLUP) > 0 ? i = "zoom-in" : (e.actions & e.ACTION_SCROLLDOWN) > 0 && (i = "zoom-out") : (0 != e.posDelta.x || 0 != e.posDelta.y) && (i = "mouse-move"), null != i && (Math.abs(e.planPos.x) > this._core.configuration.boundingSize.max.x || Math.abs(e.planPos.y) > this._core.configuration.boundingSize.max.y || (this._stateMachine({
                mstate: e,
                evName: i,
                ev: t,
                target: n
            }), this._lastTargeted = n))
        }
    }, t.prototype.onContextMenuPropertyChanged = function(t) {
        this._contextMenuCallback(this._contextMenuTarget, t.property, t.value)
    }, t.prototype.onContextMenuClose = function() {
        this._callMouseEventCb("leave", this._contextMenuTarget), (this.getMode() & this.MODE_CONTEXTMENU) > 0 && this.setMode(this._lastMode)
    }, t.prototype.onContextMenuRemove = function() {
        this._contextMenuRmCallback(this._contextMenuTarget), this.setMode(this._lastMode)
    }, t.prototype.onContextMenuDebug = function() {
        console.debug(this._contextMenuTarget)
    }, t
}();
/*
 * Author：虞思源
 * 
 * 提供3D引擎接口
 * 参数container为html元素，会创建canvas
 * initialize后draw
 *
 */
var hcs = window.hcs || {};
hcs.Engine3D = function() {
    var Engine3D,
	engine = function(container, structure, viewer) {
		this._initialized = !1, 
		this._components = new hcs.ComponentCollection(hcsdesign), 
		this.hardwareScaling = 1, 
		this.contextLostCount = 0, 
		this.MAX_CONTEXT_LOST = 5, 
		this.MODE_NORMAL = 1, 
		this.MODE_DRAG = 2, 
		this.MODE_PAINT = 4, 
		this.MODE_CONTEXTMENU = 8, 
		this.mode = this.MODE_NORMAL, 
		this.container = container, 
		this.canvas = document.createElement("canvas"), 
		//创建canvas
		container.appendChild(this.canvas), 
		this.canvas.width = hcsdesign.getWidth(), 
		this.canvas.height = hcsdesign.getHeight();
		//设置长宽高
        var o = hcsdesign.configuration && hcsdesign.configuration.useAntialiasing === !1 ? !1 : !0;
        this.engine = new BABYLON.Engine(this.canvas, o), 
		this.scene = new BABYLON.Scene(this.engine), 
		this.scene.ambientColor = new BABYLON.Color3(1, 1, 1), 
		this.scene.clearColor.copyFromFloats(.96, .96, .96), 
		this.shadowGenerator = null, 
		this.worldPlane = new BABYLON.Plane(0, 1, 0, 0), 
		//调用babylon
		this.enabled = !1, this.viewInitialized = !1, 
		this.isViewer = "undefined" != typeof viewer ? viewer : !1, 
		this.canvas.addEventListener("webglcontextlost", this.onContextLost.bind(this), !1), 
		this.canvas.addEventListener("webglcontextrestored", this.onContextRestored.bind(this), !1), 
		this.canDraw = !0, 
		Engine3D = this,
		structure || (this.structure = hcsdesign.structure, 
		this.materialFactory = new hcs.MaterialFactory(hcsdesign.configuration), 
		//新建材质工厂
		this.cameraFeatures = new hcs.CameraFeatures, 
		//新建摄像头
		this.pointerManager = new hcs.PointerManager(hcsdesign, this.onMouseEvent.bind(this), this.canvas), 
		//新建鼠标管理
		this.pointerManager.touchManager.setDeadZone(1), 
		this.keyboardManager = hcsdesign.keyboardManager, 
		this.stats = new Stats, 
		this.stats.domElement.style.position = "absolute", 
		this.stats.domElement.style.bottom = "28px", 
		this.stats.domElement.style.left = "0px", 
		this.stats.domElement.style.zIndex = "99999", 
		this.stats.domElement.style.display = "none", 
		hcsdesign.configuration.useStats && (this.stats.active = !0), 
		document.body.appendChild(this.stats.domElement), 
		document.addEventListener("hcs.engine3D.stats.activeChanged", function(container) {
            Engine3D.stats.active = container.value, Engine3D.stats.domElement.style.display = container.value ? "block" : "none", hcsdesign.configuration.useStats = container.value ? !0 : !1, hcsdesign.configuration.saveConfiguration()
        }, !1), 
		document.addEventListener("hcs.engine3D.refreshGL", function() {
            var t = location.hash.replace("#", ""),
                container = atob(t),
                structure = btoa(container.replace("&planUrl=:new", "&planUrl"));
            location.hash = structure, window.location.reload(!0)
        }, !1), 
		document.addEventListener("hcs.engine3D.showProducts", function(t) {
            var container = t.translations ? _(t.categoryName, t.translations) : _(t.categoryName);
            hcs.UI.ProductList.show(hcsdesign, hcsdesign.version, {
                id: t.categoryId,
                filter: t.categoryFilter,
                name: container
            })
        }, !1), 
		this.isViewer || (document.addEventListener("hcs.engine3D.click", Engine3D.onClick, !1),
		document.addEventListener("hcs.engine3D.double-click", Engine3D.onDoubleClick, !1),
		document.addEventListener("pointerdown", Engine3D.onMouseDown, !1)),
		document.addEventListener("hcs.engine3d.wallsReady", this.onWallsReady, !1)), 
		//绑定事件
		this.getContainer = function() {
            return this.container
        }
    };
    return engine.prototype.collideWithMeshes = function(engine, scene, mesh) {
        var o = Engine3D.scene.createPickingRay(engine, scene),
            r = o.intersectMeshes(mesh, !0, !0);
        return r
    }, //碰撞检测
	engine.prototype.castShadows = function(model) {
        var engine = this.shadowGenerator ? this.shadowGenerator.getShadowMap() : null;
        if (engine) {
            engine.renderList.push(model);
            var tmp = model.onDispose;
            model.onDispose = tmp ? function() {
                tmp(), hcsdesign.engine3D.unCastShadows(model)
            } : function() {
                hcsdesign.engine3D.unCastShadows(model)
            }
        }
    }, //设置光影效果
	engine.prototype.unCastShadows = function(model) {
        this.shadowGenerator.getShadowMap().renderList.splice(this.shadowGenerator.getShadowMap().renderList.indexOf(model), 1)
    }, 
	engine.prototype.reinitializeEngine = function() {
        if (!GlobalHelper.isMobileDevice() || "Firefox" !== BrowserDetect.browser)
            if (this.contextLostCount < this.MAX_CONTEXT_LOST)
                this.contextLostCount++;
            else {
                var t = hcsdesign.engine2D.searchComponent("PedagoComponent"),
                    engine = GlobalHelper.isMobileDevice() ? "mobile" : "no-webgl";
                t ? t.redirectToPage(engine) : window.location.href = ["js/Components/PedagoComponent/pedago/pages/", engine, ".php"].join("")
            }
    }, 
	engine.prototype.setEnabled = function(t) {
        this.enabled = t;
        var engine = this.enabled ? "block" : "none";
        this.container.setAttribute("style", "display:" + engine), this.isViewer || (this.stats.domElement.style.display = this.stats.active && this.enabled ? "block" : "none")
    }, 
	engine.prototype.setInitialView = function() {
        if (!this.viewInitialized) {
            var t, engine = this.scene.getMeshByName("WallMesh_0");
            t = engine ? this.cameraFeatures.getBestFocusRadius(engine, hcsdesign.engine3D.camera, hcsdesign.engine3D.scene) : 500, hcsdesign.engine3D.camera.radius = t, hcsdesign.engine3D.camera.alpha = -120 / 180 * Math.PI, hcsdesign.engine3D.camera.beta = 60 / 180 * Math.PI, this.viewInitialized = !0
        }
    }, 
	engine.prototype.requestCompute = function() {
        for (var t = 0; t < this._components.size(); t++)
            this._components[t].compute()
    },//2D转3D
	engine.prototype.addComponent = function(t) {
        return this._components.addComponent(t)
    }, 
	engine.prototype.addInstancedComponent = function(t) {
        return this._components.addInstancedComponent(t)
    }, 
	engine.prototype.getComponent = function(t) {
        return this._components.getComponent(t)
    }, 
	engine.prototype.searchComponent = function(t) {
        return this._components.getComponent(t)
    },
	engine.prototype.removeComponent = function(t, engine) {
        this._components.removeComponent(t, engine)
    }, 
	engine.prototype.removeComponentByName = function(t) {
        return this._components.removeComponent(t, !0)
    }, 
	engine.prototype.clearComponents = function() {
        this._components.clear()
    }, 
	//组件的增删改查
	engine.prototype.collideWithScene = function(engine, n) {
        var i = Engine3D.scene.createPickingRay(engine, n),
            o = i.intersectMeshes(Engine3D.scene.meshes, !0, !0);
        return o
    }, 
	engine.prototype.projectMouseOnGround = function(engine, n) {
        var i, o;
        if (void 0 === engine) {
            var r = this.pointerManager.getStatus();
            i = r.pos.x, o = r.pos.y
        } else
            i = engine, o = n;
        var s = Engine3D.scene.createPickingRay(i, o);
        return s.intersectPlane(this.worldPlane)
    }, 
	engine.prototype.projectMouseOnPlane = function(engine, n, i) {
        var o = this.pointerManager.getStatus(),
            n = void 0 !== n ? n : o.pos.x,
            i = void 0 !== i ? i : o.pos.y,
            r = Engine3D.scene.createPickingRay(n, i);
        return r.intersectPlane(engine)
    }, 
	engine.prototype.onClick = function(engine) {
        engine.collided = Engine3D.collideWithScene(engine.mstate.pos.x, engine.mstate.pos.y), ujs.notify("hcs.engine3D.click.collided", engine)
    }, 
	engine.prototype.onDoubleClick = function(engine) {
        engine.collided = Engine3D.collideWithScene(engine.mstate.pos.x, engine.mstate.pos.y), ujs.notify("hcs.engine3D.dblclick.collided", engine)
    }, 
	engine.prototype.onMouseEvent = function(t, engine) {
        var n = !1;
        1 != this.hardwareScaling && (engine.pos.scaleInPlace(this.hardwareScaling), engine.posDelta.scaleInPlace(this.hardwareScaling), engine.planPos.scaleInPlace(this.hardwareScaling), engine.plan3DPos.scaleInPlace(this.hardwareScaling)), engine.actions > 0 ? (engine.actions & engine.ACTION_CLICK) > 0 ? n = "click" : (engine.actions & engine.ACTION_DBLCLICK) > 0 ? n = "double-click" : (engine.actions & engine.ACTION_DRAGSTART) > 0 && this._mode != this.MODE_DRAG ? n = "drag-start" : (engine.actions & engine.ACTION_DRAGGING) > 0 ? n = "dragging" : (engine.actions & engine.ACTION_DRAGEND) > 0 ? n = "drag-end" : (engine.actions & engine.ACTION_SCROLLUP) > 0 ? n = "zoom-in" : (engine.actions & engine.ACTION_SCROLLDOWN) > 0 && (n = "zoom-out") : (0 != engine.posDelta.x || 0 != engine.posDelta.y) && (n = "mouse-move"), n && (t.mstate = engine, ujs.notify("hcs.engine3D." + n, t))
    },
	engine.prototype.resize = function() {
        this.canvas.width = hcsdesign.getWidth() * this.hardwareScaling, this.canvas.height = hcsdesign.getHeight() * this.hardwareScaling, this.engine.setViewport(this.camera.viewport, hcsdesign.getWidth(), hcsdesign.getHeight())
    }, 
	engine.prototype.onContextLost = function(t) {
        t.preventDefault(), hcsdesign.setSelectedEngine(hcsdesign.ENGINE_2D)
    }, 
	engine.prototype.onContextRestored = function(t) {
        t.preventDefault(), this.reinitializeEngine()
    }, 
	engine.prototype.onWallsReady = function() {
        Engine3D.setInitialView()
    }, 
	//相关事件的响应
	engine.prototype.initialize = function() {
        hcsdesign.configuration.useMultiTexturing || (BABYLON.StandardMaterial.SpecularTextureEnabled = !1, BABYLON.StandardMaterial.BumpTextureEnabled = !1, BABYLON.StandardMaterial.ReflectionTextureEnabled = !1), this._components.initialize(), this._initialized = !0
    }, 
	engine.prototype.update = function(t) {
        this._components.checkDirtyComponents(), this._components.checkDirtyComponents();
        for (var engine = 0; engine < this._components.size(); engine++)
            this._components[engine].enabled && this._components[engine].update(t);
        this.stats.active && this.stats.update(), this.keyboardManager.isPressed("27") && (this.mode = this.MODE_NORMAL)
    }, 
	engine.prototype.draw = function() {
        this.canDraw && (this.engine.beginFrame(), this.scene.render(), this.engine.endFrame())
    }, 
	//绘制函数，要在主循环调用
	engine
}();
var __extends = this.__extends || function (t, e) {
    function n() {
        this.constructor = t
    }
    for (var i in e)
        e.hasOwnProperty(i) && (t[i] = e[i]);
    n.prototype = e.prototype, t.prototype = new n
},
    hcs;
!function (t) {
    var e = function (t) {
        function e(e, n) {
            var i = this;
            t.call(this, e, n), this.category = -1, this.addColor = null, this.isDefault = !0, this._cachedDefines = null, this._renderTargets = new BABYLON.SmartArray(16), this._worldViewProjectionMatrix = BABYLON.Matrix.Zero(), this._lightMatrix = BABYLON.Matrix.Zero(), this._globalAmbientColor = new BABYLON.Color3(0, 0, 0), this._baseColor = new BABYLON.Color3, this._scaledDiffuse = new BABYLON.Color3, this._scaledSpecular = new BABYLON.Color3, this._scene = n, this._shaderName = "", this._uniforms = ["world", "viewProjection", "vEyePosition"], this._uniformsLocations = {}, this._samplers = [], this._attribs = [BABYLON.VertexBuffer.PositionKind], this._customDefines = null, this._hasColors = null, this._hasNormals = null, this._hasUvs = null, this._hasDiffuse = null, this._hasBump = null, this._hasEnv = null, this._hasLights = null, this.build(), this.getRenderTargetTextures = function () {
                return i._renderTargets.reset(), i.reflectionTexture && i.reflectionTexture.isRenderTarget && i._renderTargets.push(i.reflectionTexture), i._renderTargets
            }
        }
        __extends(e, t);
        var n = -1;
        return e.prototype.needAlphaBlending = function () {
            return this.alpha < 1
        }, e.prototype.needAlphaTesting = function () {
            return !1
        }, e.prototype.setCustomDefines = function (t) {
            this._customDefines = t
        }, e.prototype.build = function () { }, e.prototype.normal = function () {
            this._attribs.push(BABYLON.VertexBuffer.NormalKind), this._hasNormals = !0
        }, e.prototype.uv = function () {
            this._attribs.push(BABYLON.VertexBuffer.UVKind), this._hasUvs = !0
        }, e.prototype.diffuse = function () {
            this._uniforms.push("vDiffuseInfos", "diffuseMatrix"), this._samplers.push("diffuseSampler"), this._hasDiffuse = !0
        }, e.prototype.bump = function () {
            this._uniforms.push("vBumpInfos", "bumpMatrix"), this._samplers.push("bumpSampler"), this._hasBump = !0
        }, e.prototype.color = function () {
            this._uniforms.push("vDiffuseColor"), this._hasColor = !0
        }, e.prototype.setAlpha = function () {
            this._uniforms.push("vAlpha")
        }, e.prototype.env = function () {
            this._uniforms.push("vReflectionInfos", "reflectionMatrix"), this._samplers.push("reflectionCubeSampler"), this._hasEnv = !0
        }, e.prototype.light = function () {
            this._uniforms.push("vLightsType", "vLightData0", "vLightDiffuse0", "vLightSpecular0", "vLightDirection0", "vLightGround0", "lightMatrix0", "vLightData1", "vLightDiffuse1", "vLightSpecular1", "vLightDirection1", "vLightGround1", "lightMatrix1", "vLightData2", "vLightDiffuse2", "vLightSpecular2", "vLightDirection2", "vLightGround2", "lightMatrix2", "vLightData3", "vLightDiffuse3", "vLightSpecular3", "vLightDirection3", "vLightGround3", "lightMatrix3", "darkness0", "darkness1", "darkness2", "darkness3"), this._samplers.push("shadowSampler0", "shadowSampler1", "shadowSampler2", "shadowSampler3"), this._hasLights = !0
        }, e.prototype._isReady = function (t, e, n, i) {
            return this._hasDiffuse && !this.diffuseReadyChunk(t, e) ? !1 : this._hasBump && !this.bumpReadyChunk(t, e) ? !1 : this._hasEnv && !this.envReadyChunk(t, e) ? !1 : (this._hasLights && this.lightReadyChunk(i, t, e), this._hasUvs && this.uvReadyChunk(i, t), !0)
        }, e.prototype.isReady = function (t) {
            if (this._wasPreviouslyReady)
                return !0;
            GlobalHelper.isWindowsPhoneDevice() && (this._shaderName = "legacydefault");
            var e, n = this._scene.getEngine(),
                i = new Array;
            if (e = this._customDefines ? this._customDefines.slice() : [], !this._isReady(e, i, n, t))
                return !1;
            var o = e.join("\n");
            return this._cachedDefines != o && (this._cachedDefines = o, this._effect = this._scene.getEngine().createEffect(this._shaderName, this._attribs, this._uniforms, this._samplers, o, i, this.onCompiled, this.onError)), this._effect.isReady() ? (this._renderId = this._scene.getRenderId(), this._wasPreviouslyReady = !0, this._uniformsLocations.vEyePosition = this._effect.getUniform("vEyePosition"), this._uniformsLocations.viewProjection = this._effect.getUniform("viewProjection"), this._uniformsLocations.lightMatrix = [], this._uniformsLocations.darkness = [], this._uniformsLocations.lightMatrix[0] = this._effect.getUniform("lightMatrix0"), this._uniformsLocations.darkness[0] = this._effect.getUniform("darkness0"), this._uniformsLocations.lightMatrix[1] = this._effect.getUniform("lightMatrix1"), this._uniformsLocations.darkness[1] = this._effect.getUniform("darkness1"), this._uniformsLocations.lightMatrix[2] = this._effect.getUniform("lightMatrix2"), this._uniformsLocations.darkness[2] = this._effect.getUniform("darkness2"), this._uniformsLocations.lightMatrix[3] = this._effect.getUniform("lightMatrix3"), this._uniformsLocations.darkness[3] = this._effect.getUniform("darkness3"), !0) : !1
        }, e.prototype.diffuseReadyChunk = function (t) {
            if (this._scene.texturesEnabled && this.diffuseTexture && BABYLON.StandardMaterial.DiffuseTextureEnabled) {
                if (!this.diffuseTexture.isReady())
                    return !1;
                t.push("#define DIFFUSE")
            }
            return !0
        }, e.prototype.bumpReadyChunk = function (t, e) {
            if (this._scene.getEngine().getCaps().standardDerivatives && this.bumpTexture && BABYLON.StandardMaterial.BumpTextureEnabled) {
                if (!this.bumpTexture.isReady())
                    return !1;
                t.push("#define BUMP"), e.push(t[t.length - 1])
            }
            return !0
        }, e.prototype.envReadyChunk = function (t) {
            if (this.reflectionTexture && BABYLON.StandardMaterial.ReflectionTextureEnabled) {
                if (!this.reflectionTexture.isReady())
                    return !1;
                t.push("#define REFLECTION")
            }
            return !0
        }, e.prototype.uvReadyChunk = function (t, e) {
            t && t.isVerticesDataPresent(BABYLON.VertexBuffer.UVKind) && e.push("#define UV1")
        }, e.prototype.lightReadyChunk = function (t, e, n) {
            var i = !1,
                o = 0;
            if (this._scene.lightsEnabled)
                for (var r = 0; r < this._scene.lights.length; r++) {
                    var s = this._scene.lights[r];
                    if (s.isEnabled() && (!t || -1 === s.excludedMeshes.indexOf(t))) {
                        e.push("#define LIGHT" + o), o > 0 && n.push(e[e.length - 1]);
                        var a;
                        a = s instanceof BABYLON.SpotLight ? "#define SPOTLIGHT" + o : s instanceof BABYLON.HemisphericLight ? "#define HEMILIGHT" + o : "#define POINTDIRLIGHT" + o, e.push(a), o > 0 && n.push(e[e.length - 1]);
                        var l = s.getShadowGenerator();
                        if (t && t.receiveShadows && l && (e.push("#define SHADOW" + o), o > 0 && n.push(e[e.length - 1]), i || (e.push("#define SHADOWS"), i = !0), l.useVarianceShadowMap && (e.push("#define SHADOWVSM" + o), o > 0 && n.push(e[e.length - 1])), l.usePoissonSampling && (e.push("#define SHADOWPCF" + o), o > 0 && n.push(e[e.length - 1]))), o++, 4 == o)
                            break
                    }
                }
        }, e.prototype.setBaseColor = function () { }, e.prototype._batchedBind = function () { }, e.prototype._mandatoryBind = function () { }, e.prototype.bind = function (t, e) {
            this._effect.setMatrix("world", t), this._mandatoryBind(t, e)
        }, e.prototype.unbind = function () {
            this.reflectionTexture && this.reflectionTexture.isRenderTarget && this._effect.setTexture("reflection2DSampler", null)
        }, e.prototype._preBind = function () {
            t.prototype._preBind.call(this);
            var e = -1 != this.category && n === this.category;
            n = this.category, e || this._batchedBind()
        }, e.prototype.bindView = function () {
            this._effect._engine.setFloat3(this._uniformsLocations.vEyePosition, this._scene.activeCamera.position.x, this._scene.activeCamera.position.y, this._scene.activeCamera.position.z), this._effect._engine.setMatrix(this._uniformsLocations.viewProjection, this._scene.getTransformMatrix())
        }, e.prototype.bindColor = function () {
            this._effect.setColor4("vDiffuseColor", this.diffuseColor, this.alpha)
        }, e.prototype.bindAlpha = function () {
            this._effect.setFloat("vAlpha", this.alpha)
        }, e.prototype.bindDiffuse = function () {
            this.diffuseTexture && BABYLON.StandardMaterial.DiffuseTextureEnabled && (this._effect.setTexture("diffuseSampler", this.diffuseTexture), this._effect.setFloat2("vDiffuseInfos", this.diffuseTexture.coordinatesIndex, this.diffuseTexture.level), this._effect.setMatrix("diffuseMatrix", this.diffuseTexture.getTextureMatrix()))
        }, e.prototype.bindBump = function () {
            this.bumpTexture && this._scene.getEngine().getCaps().standardDerivatives && BABYLON.StandardMaterial.BumpTextureEnabled && (this._effect.setTexture("bumpSampler", this.bumpTexture), this._effect.setFloat2("vBumpInfos", this.bumpTexture.coordinatesIndex, this.bumpTexture.level), this._effect.setMatrix("bumpMatrix", this.bumpTexture.getTextureMatrix()))
        }, e.prototype.bindEnv = function () {
            this.reflectionTexture && BABYLON.StandardMaterial.ReflectionTextureEnabled && (this._effect.setTexture("reflectionCubeSampler", this.reflectionTexture), this._effect.setMatrix("reflectionMatrix", this.reflectionTexture.getReflectionTextureMatrix()), this._effect.setFloat3("vReflectionInfos", this.reflectionTexture.coordinatesMode, this.reflectionTexture.level, this.reflectionTexture.isCube ? 1 : 0))
        }, e.prototype.bindLights = function () {
            for (var t = 0, e = 0; e < this._scene.lights.length; e++) {
                var n = this._scene.lights[e];
                n.isEnabled() && (n instanceof BABYLON.PointLight ? n.transferToEffect(this._effect, "vLightData" + t) : n instanceof BABYLON.DirectionalLight ? n.transferToEffect(this._effect, "vLightData" + t) : n instanceof BABYLON.SpotLight ? n.transferToEffect(this._effect, "vLightData" + t, "vLightDirection" + t) : n instanceof BABYLON.HemisphericLight && n.transferToEffect(this._effect, "vLightData" + t, "vLightGround" + t), n.diffuse.scaleToRef(n.intensity, this._scaledDiffuse), n.specular.scaleToRef(n.intensity, this._scaledSpecular), this._effect.setColor4("vLightDiffuse" + t, this._scaledDiffuse, n.range), this._effect.setColor3("vLightSpecular" + t, this._scaledSpecular))
            }
        }, e.prototype.bindShadows = function (t, e) {
            if (this._hasLights && this._scene.lightsEnabled)
                for (var n = 0, i = 0; i < this._scene.lights.length; i++) {
                    var o = this._scene.lights[i];
                    if (o.isEnabled()) {
                        var r = o.getShadowGenerator();
                        if (e.receiveShadows && r && (t.multiplyToRef(r.getTransformMatrix(), this._lightMatrix), this._effect.setTexture("shadowSampler" + n, r.getShadowMap()), this._effect._engine.setMatrix(this._uniformsLocations.lightMatrix[i], this._lightMatrix), this._effect._engine.setFloat(this._uniformsLocations.darkness[i], r.getDarkness())), n++, 4 == n)
                            break
                    }
                }
        }, e.prototype.dispose = function (e) {
            this.diffuseTexture && this.diffuseTexture.dispose(), this.bumpTexture && this.bumpTexture.dispose(), this.reflectionTexture && this.reflectionTexture.dispose(), t.prototype.dispose.call(this, e)
        }, e.prototype.clone = function (t) {
            var e = this.isDefault;
            this.isDefault = !1;
            var n = this.serialize();
            this.isDefault = e;
            var i = ujs.deserializeObject(n);
            return i.name = t, i.isDefault = this.isDefault, i
        }, e
    } (BABYLON.Material);
    t.StandardMaterial = e
} (hcs || (hcs = {})),
function (t) {
    var e = function (t) {
        function e(e, n, i) {
            t.call(this, e, n), this.params = i || {}, this.params.diffuseTexture && (this.diffuseTexture = this.params.diffuseTexture instanceof BABYLON.Texture ? this.params.diffuseTexture : new BABYLON.Texture(this.params.diffuseTexture, hcsdesign.engine3D.scene), this.bumpTexture = null), this.params.bumpTexture && (this.bumpTexture = this.params.bumpTexture instanceof BABYLON.Texture ? this.params.bumpTexture : new BABYLON.Texture(this.params.bumpTexture, hcsdesign.engine3D.scene)), this.category = -1, this._shaderName = "textured"
        }
        return __extends(e, t), e.prototype.build = function () {
            this.uv(), this.normal(), this.diffuse(), this.light(), this.setAlpha()
        }, e.prototype._batchedBind = function () { }, e.prototype._mandatoryBind = function (t, e) {
            this.bindView(), this.bindShadows(t, e), this.bindDiffuse(), this.bindAlpha(), this.bindLights()
        }, e
    } (t.StandardMaterial);
    t.TexturedMaterial = e
} (hcs || (hcs = {})),
function (t) {
    var e = function (e) {
        function n(n, i, o) {
            e.call(this, n, i), this.category = 2, this.params = o || {}, this.params.brillance = this.params.brillance || .5, this.params.brillance = BABYLON.Math.clamp(this.params.brillance, 0, 1), this.params.baseColor = this.params.baseColor || new BABYLON.Color3(.6, .6, .6), this.diffuseColor = new BABYLON.Color3(this.params.brillance * this.params.baseColor.r, this.params.brillance * this.params.baseColor.g, this.params.brillance * this.params.baseColor.b), this.reflectionTexture = new BABYLON.CubeTexture(t.Assets.flatEnvMapTexture, i), this._shaderName = "metal", this.setCustomDefines(["#define METAL"])
        }
        return __extends(n, e), n.prototype.setBaseColor = function (t) {
            this.params.baseColor = t, this.diffuseColor.copyFromFloats(this.params.brillance * t.r, this.params.brillance * t.g, this.params.brillance * t.b)
        }, n.prototype.build = function () {
            this.color(), this.normal(), this.env(), this.light()
        }, n.prototype._batchedBind = function () {
            this.bindEnv(), this.bindLights()
        }, n.prototype._mandatoryBind = function (t, e) {
            this.bindView(), this.bindShadows(t, e), this.bindColor()
        }, n
    } (t.StandardMaterial);
    t.MetalMaterial = e
} (hcs || (hcs = {})),
function (t) {
    var e = function (e) {
        function n(n, i, o) {
            e.call(this, n, i, o), this.category = 3, this.alpha = this.params.opacity || this.params.alpha || .3, this.alpha = BABYLON.Math.clamp(this.alpha, 0, 1), this.reflectionTexture = new BABYLON.CubeTexture(t.Assets.envMapTexture, i), this.setCustomDefines(["#define GLASS"]), this.setBaseColor(this.params.baseColor || {
                r: .6,
                g: .6,
                b: .6
            })
        }
        return __extends(n, e), n
    } (t.MetalMaterial);
    t.GlassMaterial = e
} (hcs || (hcs = {})),
function (t) {
    var e = function (e) {
        function n(n, i, o) {
            e.call(this, n, i, o), this.params.diffuseTexture || (this.diffuseTexture = new BABYLON.Texture(t.Assets.woodTextures.diffuse, hcsdesign.engine3D.scene)), this.category = 1, this.setCustomDefines(["#define WOOD"])
        }
        return __extends(n, e), n
    } (t.TexturedMaterial);
    t.WoodMaterial = e
} (hcs || (hcs = {})),
function (t) {
    var e = function (t) {
        function e(e, n, i) {
            t.call(this, e, n, i), this.category = 4, this.setCustomDefines(["#define LEATHER"])
        }
        return __extends(e, t), e
    } (t.TexturedMaterial);
    t.LeatherMaterial = e
} (hcs || (hcs = {})),
function (t) {
    var e = function (t) {
        function e(e, n, i) {
            t.call(this, e, n), this.category = 5, this.params = i || {}, this.params.factor = this.params.factor || 1, this.params.factor = BABYLON.Math.clamp(this.params.factor, 0, 1), this.diffuseColor = new BABYLON.Color3(this.params.factor, this.params.factor, this.params.factor), this._shaderName = "white", this.setCustomDefines(["#define WHITE"])
        }
        return __extends(e, t), e.prototype.setBaseColor = function (t) {
            this.params.factor = (t.r + t.g + t.b) / 3, this.diffuseColor.copyFromFloats(this.params.factor, this.params.factor, this.params.factor)
        }, e.prototype.build = function () {
            this.color(), this.normal(), this.light()
        }, e.prototype._batchedBind = function () { }, e.prototype._mandatoryBind = function (t, e) {
            this.bindView(), this.bindShadows(t, e), this.bindColor(), this.bindLights()
        }, e
    } (t.StandardMaterial);
    t.WhiteMaterial = e
} (hcs || (hcs = {})),
function (t) {
    var e = function (t) {
        function e(e, n, i) {
            this.params = i || {}, t.call(this, e, n, this.params), this.category = 6, this.diffuseColor = this.params.baseColor ? new BABYLON.Color3(this.params.baseColor.r, this.params.baseColor.g, this.params.baseColor.b) : new BABYLON.Color3(1, 1, 1), this.setCustomDefines(["#define PLASTIC"])
        }
        return __extends(e, t), e.prototype.setBaseColor = function (t) {
            this.params.baseColor = t, this.diffuseColor.copyFrom(t)
        }, e
    } (t.WhiteMaterial);
    t.PlasticMaterial = e
} (hcs || (hcs = {})),
function (t) {
    var e = function (t) {
        function e(e, n, i) {
            t.call(this, e, n, i), this.category = 7, this.setCustomDefines(["#define TILE"])
        }
        return __extends(e, t), e
    } (t.TexturedMaterial);
    t.TileMaterial = e
} (hcs || (hcs = {})),
function (t) {
    var e = function (e) {
        function n(n, i, o) {
            e.call(this, n, i, o), this.params.diffuseTexture || (this.diffuseTexture = new BABYLON.Texture(t.Assets.firePlaceWood.diffuse, hcsdesign.engine3D.scene)), this.category = 8, this.setCustomDefines(["#define MATT"])
        }
        return __extends(n, e), n
    } (t.TexturedMaterial);
    t.MattMaterial = e
} (hcs || (hcs = {}));
var hcs = window.hcs || {};
!function () {
    hcs.StandardMaterial.prototype.serialize = function (t) {
        if (this.isDefault)
            return null;
        var t = t || {};
        return t.class = {
            name: hcs.StandardMaterial.GetClassFromCategory(this.category)
        }, ujs.serializeObject(this, t, ["name", "backFaceCulling", "addColor", "params"]), t
    }, hcs.StandardMaterial.prototype.deserialize = function (e) {
        return e ? (ujs.deserializeObject(e, this, ["name", "backFaceCulling", "addColor"]), this.isDefault = !1, t(this), e.centroid && (this.centroid = e.centroid), e.side && (this.side = e.side), e.ambientColor && this.setBaseColor(ujs.deserializeObject(e.ambientColor)), e.emissiveColor && this.setBaseColor(ujs.deserializeObject(e.emissiveColor)), this) : null
    }, hcs.StandardMaterial.Deserialize = function (t) {
        var e = {};
        ujs.deserializeObject(t.params, e);
        var n = ujs.stringToFunction(t.class.name),
            i = new n(t.name, hcsdesign.engine3D.scene, e);
        return i.deserialize(t), i
    }, hcs.StandardMaterial.GetClassFromCategory = function (t) {
        switch (t) {
            case -1:
                return "hcs.StandardMaterial";
            case 1:
                return "hcs.WoodMaterial";
            case 2:
                return "hcs.MetalMaterial";
            case 3:
                return "hcs.GlassMaterial";
            case 4:
                return "hcs.LeatherMaterial";
            case 5:
                return "hcs.WhiteMaterial";
            case 6:
                return "hcs.PlasticMaterial";
            case 7:
                return "hcs.TileMaterial";
            case 8:
                return "hcs.MattMaterial";
            default:
                return Logger.warning("Category Error (hcs.StandardMaterial)"), null
        }
    }, hcs.WoodMaterial.Deserialize = hcs.StandardMaterial.Deserialize, hcs.MetalMaterial.Deserialize = hcs.StandardMaterial.Deserialize, hcs.GlassMaterial.Deserialize = hcs.StandardMaterial.Deserialize, hcs.LeatherMaterial.Deserialize = hcs.StandardMaterial.Deserialize, hcs.WhiteMaterial.Deserialize = hcs.StandardMaterial.Deserialize, hcs.PlasticMaterial.Deserialize = hcs.StandardMaterial.Deserialize, hcs.TileMaterial.Deserialize = hcs.StandardMaterial.Deserialize, hcs.MattMaterial.Deserialize = hcs.StandardMaterial.Deserialize, hcs.TexturedMaterial.prototype.serialize = function () {
        if (1 == this.isDefault)
            return null;
        var t = {};
        return hcs.StandardMaterial.prototype.serialize.call(this, t), ujs.serializeObject(this, t, ["diffuseTexture", "bumpTexture"]), t
    }, hcs.TexturedMaterial.prototype.deserialize = function (t) {
        return ujs.deserializeObject(t, this, ["diffuseTexture", "bumpTexture"]), hcs.StandardMaterial.prototype.deserialize.call(this, t), this
    }, hcs.GlassMaterial.prototype.serialize = function () {
        if (1 == this.isDefault)
            return null;
        var t = {};
        return hcs.StandardMaterial.prototype.serialize.call(this, t), ujs.serializeObject(this, t, ["alpha"]), t
    }, hcs.GlassMaterial.prototype.deserialize = function (t) {
        return ujs.deserializeObject(t, this, ["alpha"]), hcs.StandardMaterial.prototype.deserialize.call(this, t), this
    }, BABYLON.StandardMaterial.prototype.serialize = function () {
        var t = BABYLON.Material.prototype.serialize.call(this);
        return t.class = {
            name: "BABYLON.StandardMaterial"
        }, ujs.serializeObject(this, t, ["diffuseTexture", "ambientTexture", "opacityTexture", "reflectionTexture", "emissiveTexture", "specularTexture", "bumpTexture", "ambientColor", "diffuseColor", "specularColor", "specularPower", "emissiveColor", "addColor"]), t
    }, BABYLON.StandardMaterial.prototype.deserialize = function (e) {
        return BABYLON.Material.prototype.deserialize.call(this, e), ujs.deserializeObject(e, this, ["diffuseTexture", "ambientTexture", "opacityTexture", "reflectionTexture", "emissiveTexture", "specularTexture", "bumpTexture", "ambientColor", "diffuseColor", "specularColor", "specularPower", "emissiveColor", "addColor"]), t(this), this
    }, hcs.BlackMaterial = hcs.WhiteMaterial, hcs.PolishedMaterial = hcs.WoodMaterial, hcs.LuxensMaterial = hcs.PlasticMaterial, hcs.TransparentMaterial = hcs.GlassMaterial;
    var t = function (t) {
        if ((t instanceof hcs.GlassMaterial || t instanceof hcs.MetalMaterial) && t.addColor && t.addColor.color)
            t.setBaseColor(t.addColor.color);
        else if (t.addColor && t.addColor.color && t.diffuseTexture && t.diffuseTexture.url) {
            t.addColor.size = t.addColor.size || {
                width: 512,
                height: 512
            };
            var e = new Image;
            e.crossOrigin = "Anonymous";
            var n = t.addColor.color;
            e.src = t.diffuseTexture.url;
            var i = new BABYLON.DynamicTexture("canvas", t.addColor.size.width, hcsdesign.engine3D.scene, !0);
            i.url = t.diffuseTexture.url;
            var o = {
                u: t.diffuseTexture.uScale,
                v: t.diffuseTexture.vScale
            };
            t.diffuseTexture = i, t.diffuseColor = new BABYLON.Color3(n.r, n.g, n.b).scale(.2), e.onload = function () {
                var r = i.getContext();
                r.fillStyle = hcs.MaterialFactory.rgbToHex(n), r.clearRect(0, 0, t.addColor.size.width, t.addColor.size.height), r.drawImage(e, 0, 0, t.addColor.size.width, t.addColor.size.height), r.globalCompositeOperation = "soft-light", r.globalCompositeOperation = "color-burn", r.globalCompositeOperation = "multiply", r.fillRect(0, 0, t.addColor.size.width, t.addColor.size.height), i.wrapU = BABYLON.Texture.WRAP_ADDRESSMODE, i.wrapV = BABYLON.Texture.WRAP_ADDRESSMODE, i.uScale = o.u || 1, i.vScale = o.v || 1, i.update()
            }
        }
    }
} ();

var BaseStructure = function () {
    var t = 0,
            e = function (e) {
                this.id = t++, this.name = e || "Structure_" + t
            };
    return e.prototype.add = function (t, e) {
        if ("undefined" == typeof this[t] && (this[t] = []), this[t] instanceof Array) {
            var n = this[t].indexOf(e);
            if (-1 == n)
                return !1;
            this[t].push(e)
        } else
            this[t] = e;
        return !0
    }, e.prototype.initialize = function () { }, e.prototype.update = function () { }, e.prototype.serialize = function () { }, e.Deserialize = function () { }, e.prototype.updateReferences = function () { }, e.prototype.updateFieldArray = function (t, e, n) {
        n.length = 0;
        for (var i = 0, o = this.structureIds.length; o > i; i++)
            for (var r = 0, s = e.length; s > r; r++)
                e[r].id == this.structureIds[i] && n.push(e[r])
    }, e.prototype.getElementByName = function (t, e) {
        var n = function (t, e) {
            for (var n = 0, i = null, o = e.length; o > n && null === e; )
                e[n].name == t && (i = e[n]), n++;
            return i
        };
        if (this[e] instanceof Array)
            return n(t, this[e]);
        var i = null;
        for (var o in this)
            this[o] instanceof Array && (i = n(t, this[o]));
        return i
    }, e
} ();
var BaseComponent2D = function() {
    var t = function(t, e) {
        this.core = t, this.name = e || "Component2D", this.structure = null, this.keyboard = null, this.priority = 42, this.enabled = !0;
        var n = this;
        "undefined" != typeof t && (this.structure = this.core.structure, this.keyboardManager = this.core.keyboardManager, document.addEventListener("hcs.contextChanged", function(t) {
            n.enabled && t.context != t.previousContext && n.onContextChanged(t.context)
        }, !1))
    };
    return t.prototype.initialize = function() {
        this.startListening()
    }, t.prototype.startListening = function() {}, t.prototype.stopListening = function() {}, t.prototype.onContextChanged = function(t) {
        "2D" == t ? this.startListening() : this.stopListening()
    }, t.prototype.disable = function() {
        this.enabled = !1, this.stopListening()
    }, t.prototype.enable = function() {
        this.enabled = !0
    }, t.prototype.getTargeted = function() {
        return null
    }, t.prototype.update = function() {}, t.prototype.compute = function() {}, t.prototype.destroy = function() {}, t
}();
var BaseComponent3D = function() {
    var t = function(t, e) {
        if (this.core = t, this.engine3D = null, this.name = e || "Component3D", this.structure = null, this.keyboardManager = null, this.materialFactory = null, this.scene = null, this.draggableObjects = null, this.cameraController = null, this.cubeCameras = null, this.configuration = null, this.camera = null, this.enabled = !0, this.initialized = !1, "undefined" != typeof t) {
            this.name = e, this.engine3D = this.core.engine3D, this.structure = this.core.structure, this.keyboardManager = this.core.keyboardManager, this.configuration = this.core.configuration, this.scene = this.core.engine3D.scene, this.camera = this.core.engine3D.camera, this.cubeCameras = this.core.engine3D.cubeCameras, this.cameraController = this.core.engine3D.cameraController, this.materialFactory = this.core.engine3D.materialFactory;
            var n = this;
            document.addEventListener("hcs.contextChanged", function(t) {
                n.enabled && t.context != t.previousContext && n.onContextChanged(t.context)
            }, !1), document.addEventListener("hcs.engine3D.forceReload", this.reloadConfiguration, !1)
        }
    };
    return t.prototype.initialize = function() {}, t.prototype.startListening = function() {}, t.prototype.stopListening = function() {}, t.prototype.onContextChanged = function(t) {
        "3D" == t ? this.startListening() : this.stopListening()
    }, t.prototype.disable = function() {
        this.enabled = !1, this.stopListening()
    }, t.prototype.enable = function() {
        this.enabled = !0
    }, t.prototype.update = function() {}, t.prototype.compute = function() {}, t.prototype.reloadConfiguration = function() {}, t.prototype.getFloor = function(t) {
        var e = this.core.getComponentByName("FloorComponent3D"),
            t = t || hcsdesign.getSelectedStructure();
        return e.getFloor(t)
    }, t.prototype.getObjectStructure = function(t) {
        return Logger.warning("[BaseComponent3D] getObjectStructure - Fonction d��preci��e"), t.structure
    }, t.prototype.getParentRelativeToScene = function(t) {
        var e = t.parent;
        if ("structure" != e.name && "undefined" != typeof e.parent) {
            for (;
                "undefined" != typeof e.parent && "structure" != e.parent.name;)
                e = e.parent;
            t = e
        }
        return t
    }, t.prototype.getParentRelativeToGroup = function(t) {
        var e = t.parent;
        if ("structure" != e.name && -1 == e.name.indexOf("group_") && "undefined" != typeof e.parent) {
            for (;
                "undefined" != typeof e.parent && -1 == e.parent.name.indexOf("group_") && "structure" != e.parent.name;)
                e = e.parent;
            t = e
        }
        return t
    }, t.prototype.getObjectByName = function(t, e) {
        return this.core.getSelectedStructure().getElementByName(t, e)
    }, t.prototype.destroy = function() {}, t
}();
var BaseEditionComponent = function() {
    var t = function(t) {
        this.name = t || "EditionComponent"
    };
    return t.prototype.initialize = function() {}, t
}();
var MainMenuComponent = function() {
    var t = [{
            title: "房型设计",
            index: 1,
            icon: "",
            action: "hcs.request.changeEngine",
            id: "draw2D",
            params: {
                engine: "2D"
            },
            layout: "layout-list",
            context: "2D",
            items: []
        }, {
            title: "家具设计",
            index: 2,
            icon: "",
            action: "hcs.request.changeEngine",
            id: "furnishing3D",
            context: "3D",
            params: {
                engine: "3D"
            },
            layout: "layout-list",
            items: []
        }/*, {
            title: "装饰设计",
            index: 3,
            icon: "",
            action: "hcs.request.changeEngine",
            id: "decorate3D",
            context: "3D",
            params: {
                engine: "3D"
            },
            layout: "layout-list",
            items: []
        }*/],
        e = function(e) {
            BaseComponent2D.call(this, e, "MainMenuComponent"), this.menu = new hcs.UI.Menu(t, "mainMenuTabs", {
                selected: t[0],
                inception: !1
            }), this.menu.initialize(), this.menuTitleDom = document.getElementById("mainMenuTitle"), this.menuTitleDom.innerHTML = _(this.menu.selected.title), this.submenu = new hcs.UI.Menu(t[0].items, "mainMenuContentList"), document.addEventListener("hcs.menu.main.add", this.addItem.bind(this), !1), document.addEventListener("hcs.menu.main.replace", this.replaceItem.bind(this), !1), document.addEventListener("hcs.menu.main.deselect", this.deselectItem.bind(this), !1), document.addEventListener("hcs.menu.main.remove", this.removeItem.bind(this), !1), document.addEventListener("hcs.request.changeEngine", this.onChangeEngine.bind(this), !1), document.addEventListener("hcs.menu.main.remove", this.removeItem.bind(this), !1)
        };
    return e.prototype = new BaseComponent2D, e.prototype.onChangeEngine = function() {
        this.menuTitleDom.innerHTML = _(this.menu.selected.title), this.updateSubMenu()
    }, e.prototype.removeItem = function(t) {
        this.menu.deleteMenuItem(t.item), this.menu.updateHtml(), this.submenu.updateHtml()
    }, e.prototype.replaceItem = function(t) {
        if (t.item) {
            var e = t.item,
                n = t.merge || !1;
            this.menu.replaceMenuItem(e.id, e, n), this.submenu.updateHtml(e)
        }
    }, e.prototype.deselectItem = function(t) {
        var e = t.all || !1,
            n = t.itemId || !1;
        this.submenu.selected.items && 0 != this.submenu.selected.items.length && this.submenu.selected.items != {} || this.submenu.deselect(e, n)
    }, e.prototype.updateSubMenu = function() {
        this.menu.selected.items && (this.submenu = new hcs.UI.Menu(this.menu.selected.items, "mainMenuContentList"), this.submenu.initialize())
    }, e.prototype.addItem = function(t) {
        if (t.item && t.menuPath) {
            var e = t.item,
                n = t.menuPath,
                i = t.position > -1 ? t.position : 1e5;
            e.index = e.index > -1 ? e.index : i, this.menu.addMenuItem(n, e, i), this.submenu.updateHtml()
        }
    }, e.prototype.removeItem = function(t) {
        t.item && (this.menu.deleteMenuItem(t.item), this.menu.updateHtml(), this.submenu.updateHtml())
    }, e
}();
var TopMenuComponent = function(t) {
    var e = [],
        n = [],
        i = function() {
            BaseComponent2D.call(this, t, "TopMenuComponent"), this.menu = new hcs.UI.Menu(e, "toolbarMenu", {
                oneClick: !0
            }), this.submenu = new hcs.UI.Menu(n, "subMenuList", {
                oneClick: !0
            }), document.addEventListener("hcs.menu.top.add", this.addItem.bind(this), !1), document.addEventListener("hcs.menu.top.delete", this.removeItem.bind(this), !1), document.addEventListener("hcs.menu.top.replace", this.replaceItem.bind(this), !1), document.addEventListener("hcs.menu.top.sub.add", this.addSubItem.bind(this), !1), document.addEventListener("hcs.menu.top.sub.delete", this.removeSubItem.bind(this), !1), document.addEventListener("hcs.menu.top.sub.replace", this.replaceSubItem.bind(this), !1), document.addEventListener("hcs.menu.top.deselect", this.deselectItem.bind(this), !1)
        };
    return i.prototype = Object.create(BaseComponent2D.prototype), i.prototype._addItem = function(t, e) {
        if (e.item && e.menuPath) {
            var n = e.item,
                i = e.menuPath,
                o = e.position > -1 ? e.position : 1e5;
            n.index = n.index > -1 ? n.index : o, t.addMenuItem(i, n, o), t.updateHtml()
        }
    }, i.prototype._replaceItem = function(t, e) {
        if (e.item) {
            var n = e.item,
                i = "undefined" != typeof e.merge ? e.merge : !1;
            t.replaceMenuItem(n.id, n, i), t.updateHtml()
        }
    }, i.prototype._removeItem = function(t, e) {
        e.id && (t.deleteMenuItem(e.id), t.updateHtml())
    }, i.prototype.deselectItem = function() {
        this.menu.deselect(!0)
    }, i.prototype.addItem = function(t) {
        this._addItem(this.menu, t)
    }, i.prototype.replaceItem = function(t) {
        this._replaceItem(this.menu, t)
    }, i.prototype.removeItem = function(t) {
        this._removeItem(this.menu, t)
    }, i.prototype.addSubItem = function(t) {
        this._addItem(this.submenu, t)
    }, i.prototype.replaceSubItem = function(t) {
        this._replaceItem(this.submenu, t)
    }, i.prototype.removeSubItem = function(t) {
        this._removeItem(this.submenu, t)
    }, i
}();
var BaseTopMenuComponent2D = function() {
    var t = function(t, e) {
        BaseComponent2D.call(this, t, e), this._topMenuComponent = null, this._item = {}, this.isMainMenuItem = !0
    };
    return t.prototype = Object.create(BaseComponent2D.prototype), t.prototype.initialize = function() {
        BaseComponent2D.prototype.initialize.call(this), ujs.notify(this.isMainMenuItem ? "hcs.menu.top.add" : "hcs.menu.top.sub.add", {
            item: this._item,
            menuPath: "."
        })
    }, t.prototype.destroy = function() {
        BaseComponent2D.prototype.destroy.call(this), ujs.notify(this.isMainMenuItem ? "hcs.menu.top.delete" : "hcs.menu.top.sub.delete", {
            id: this._item.id,
            menuPath: "."
        })
    }, t
}();
var SaveComponent = function() {
    var t, e = !1,
        n = function(e) {
            BaseTopMenuComponent2D.call(this, e, "SaveComponent"), this._item = {
                title: "Save",
                icon: "images/save_icon.png",
                action: "hcs.request.saveStructure",
                id: "toolbarSave",
                items: [],
                index: "2"
            }, document.addEventListener("hcs.request.saveStructure", this.saveStructure.bind(this), !1), window.addEventListener("message", function(e) {
                var n = JSON.parse(e.data);
                "save-plan" == n.action ? t.saveStructure(e) : "update-urls" == n.action && (n.planUrl && (t.core.api.planUrl = n.planUrl), n.newUrl && (t.core.api.newUrl = n.newUrl), n.screenshotUrl && (t.core.api.screenshotUrl = n.screenshotUrl), n.saveUrl && (t.core.api.saveUrl = n.saveUrl))
            }), t = this
        };
    return n.prototype = Object.create(BaseTopMenuComponent2D.prototype), n.prototype.startProcess = function() {
        e = !0
    }, n.prototype.endProcess = function() {
        e = !1
    }, n.prototype.saveStructure = function(n, i, o) {
        if (e !== !0) {
            this.startProcess();
            var i = i || n.callback || function() {};
            if (n.callback = !1, "planStructure" !== this.structure.name)
                t.sendToServer(t.core.structure.name, void 0, i, o);
            else {
                var r = new Date,
                    s = this.core.api.title || [_("My plan") + " ", r.getDay(), "/", r.getMonth(), "/", r.getFullYear(), " - ", Math.floor(100 * Math.random())].join(""),
                    a = "",
                    l = function(e) {
                        s = "" !== e.textInput ? e.textInput : s, a = "" !== e.textAreaInput ? e.textAreaInput : a, t.sendToServer(s, a, i, o)
                    },
                    h = {
                        title: _("Save a Plan"),
                        message: _("Choose a name for your plan"),
                        buttonBText: _("Save"),
                        buttonAText: _("Cancel"),
                        buttonA: !0,
                        buttonB: !0,
                        input: !0,
                        inputValue: s,
                        textArea: !0,
                        textAreaPlaceHolder: _("Enter a description"),
                        onClose: t.endProcess,
                        onClickB: l,
                        onClickA: function() {}
                    };
                hcs.UI.MessageBox.close(), hcs.UI.MessageBox.show(h)
            }
        }
    }, n.prototype.onError = function() {
        var e = t.core.saveLocalStructure(!1, !0),
            n = {
                title: _("Save a Plan"),
                message: _("An error occured during save, please try later."),
                buttonA: !0,
                buttonAText: _("Download a backup"),
                onClose: t.endProcess,
                onClickA: function() {
                    var n = t.core.getOrigin();
                    parent.postMessage({
                        type: "downloadFile",
                        name: "plan",
                        content: "data:text/html;base64," + btoa(e)
                    }, n), hcs.UI.MessageBox.close(), t.endProcess()
                }
            };
        hcs.UI.MessageBox.show(n)
    }, n.prototype.sendToServer = function(e, n, i, o) {
        var r = this.core.getPreviewImage(320, 240),
            s = this.core.engine2D.isEnabled() ? "2D" : "3D";
        t.core.structure.name = e;
        var a = t.core.saveLocalStructure(!1, !0),
            l = ["title=", encodeURIComponent(e), "&plan=", encodeURIComponent(a), "&preview=", r, "&previewMode=", s];
        if (t.core.api.params) {
            var h = t.core.api.params;
            "object" == typeof h && (h = JSON.stringify(h)), "string" == typeof h && l.push("&params=" + h)
        }
        t.core.api.id && l.push("&id=" + t.core.api.id), t.core.api.apiKey && l.push("&apikey=" + t.core.api.apiKey), n && l.push("&description=" + encodeURIComponent(n)), ujs.ajax({
            method: "POST",
            url: t.core.api.saveUrl,
            withCredentials: !0,
            params: l.join(""),
            onerror: function(e) {
                t.onError(e), o && o()
            },
            success: function(e) {
                var n = JSON.parse(e),
                    r = _("An error occured during save, please try later.");
                if ("ok" === n.status) {
                    t.core.saveStackToLocal(), r = _("Your plan has been saved."), t.core.structure.planId = !0;
                    var s = function() {};
                    if (n["refresh-url"]) {
                        var a = t.core.getOrigin();
                        r += "<br />" + _("you will be redirected ..."), s = function() {
                            parent.postMessage({
                                type: "refresh",
                                url: n["refresh-url"]
                            }, a)
                        }
                    }
                    parent.postMessage({
                        type: "planSaved"
                    }, t.core.getOrigin()), hcs.UI.MessageBox.show({
                        title: _("Save a Plan"),
                        message: r,
                        buttonAText: _("Close"),
                        buttonA: !0,
                        autoHide: !0,
                        onClose: s,
                        force: !0
                    }), n.params && (t.core.api.params = n.params), i(!0)
                } else
                    n.connectionUrl ? t.core._loginIframe(n.connectionUrl, n.frameWidth || Math.round(window.innerWidth / 2), n.frameHeight || Math.round(window.innerHeight / 2)) : t.onError(), o && o();
                t.endProcess()
            }
        })
    }, n
}();
var NewComponent = function() {
    var t, e = function(e) {
        BaseTopMenuComponent2D.call(this, e, "NewComponent"), this._item = {
            title: _("New"),
            icon: "fa fa-file",
            action: "hcs.request.newPlan",
            id: "toolbarNew",
            items: [],
            index: "0"
        }, t = this, document.addEventListener("hcs.request.newPlan", function() {
            t.launchProcess(), t.core.engine2D.bestZoom()
        }, !1)
    };
    return e.prototype = Object.create(BaseTopMenuComponent2D.prototype), e.prototype.createNewPlan = function() {
        ujs.notify("hcs.request.closePopup"), t.core.structure.clear(), t.core._createDefaultStructure(), t.core.engine2D.reinitialize(), t.core.setSelectedEngine(t.core.ENGINE_2D), t.core.saveLocalStructure(!1), t.core.structure.planId = -1, t.core.structure.name = "planStructure", ujs.triggerEvent(document.getElementById("draw2D"), "click"), ujs.notify("hcs.request.newPlanReady"), t.core.engine2D.bestZoom()
    }, e.prototype.launchProcess = function() {
        if (!t.core.api.newUrl || !t.core.api.saveUrl)
            return void t.createNewPlan();
        var e = [t.core.api.newUrl];
        if (t.core.api.params) {
            var n = -1 !== t.core.api.newUrl.indexOf("?") ? "&" : "?";
            e.push([n, "params=", JSON.stringify(t.core.api.params)].join(""))
        }
        var i = function() {
                ujs.ajax({
                    method: "GET",
                    url: e.join(""),
                    withCredentials: !0,
                    success: function(e) {
                        var n = JSON.parse(e);
                        if ("ok" === n.status)
                            n.saveUrl && (t.core.api.saveUrl = n.saveUrl), n.title && (t.core.api.planTitle = n.title), n.params && (t.core.api.params = JSON.parse(n.params)), t.createNewPlan();
                        else if (n.connectionUrl)
                            t.core._loginIframe(n.connectionUrl, n.frameWidth || Math.round(window.innerWidth / 2), n.frameHeight || Math.round(window.innerHeight / 2));
                        else {
                            var i = {
                                title: _("Save a Plan"),
                                message: n.message || _("Error occured during save."),
                                buttonA: !0,
                                buttonAText: _("Ok"),
                                onClickA: function() {
                                    hcs.UI.MessageBox.close()
                                }
                            };
                            hcs.UI.MessageBox.show(i)
                        }
                    }
                })
            },
            o = function() {
                ujs.notify("hcs.request.saveStructure", {
                    callback: i
                })
            };
        hcs.UI.MessageBox.show({
            title: _("New Plan"),
            message: _("Do you want to save your current plan?"),
            buttonCText: _("Yes"),
            buttonBText: _("No"),
            buttonAText: _("Cancel"),
            buttonA: !0,
            buttonB: !0,
            buttonC: !0,
            onClickC: o,
            onClickB: i,
            onClickA: function() {
                hcs.UI.MessageBox.close()
            }
        })
    }, e
}();
var OptionsComponent = function() {
    var t = function(t) {
        BaseTopMenuComponent2D.call(this, t, "OptionsComponent"), this._item = {
            title: "Options",
            icon: "fa fa-cog",
            action: "optionMenu",
            id: "toolbarOption",
            selectionnable: !0,
            index: "3",
            items: [{
                title: "Change language",
                action: "hcs.request.changeLang",
                id: "toolbarChangeLanguage",
                index: 100
            }, {
                title: "<hr />",
                index: 1e5
            }, {
                title: "About Wanaplan",
                action: "hcs.ui.showAboutWindow",
                id: "toolbarAbout",
                index: 100001
            }]
        }
    };
    return t.prototype = Object.create(BaseTopMenuComponent2D.prototype), t
}();
var ExitComponent = function() {
    var t, e = function(e) {
        BaseTopMenuComponent2D.call(this, e, "ExitComponent"), this._item = {
            title: "Exit",
            icon: "fa fa-sign-out",
            action: "hcs.request.exit",
            id: "toolbarExit",
            items: []
        }, t = this, document.addEventListener("hcs.request.exit", function() {
            t.exit()
        }, !1)
    };
    return e.prototype = Object.create(BaseTopMenuComponent2D.prototype), e.prototype.doExit = function() {
        if (hcsdesign.api.params.exitUrl) {
            var e = t.core.getOrigin();
            parent.postMessage({
                type: "refresh",
                url: hcsdesign.api.params.exitUrl
            }, e)
        }
        parent.postMessage({
            type: "planExit"
        }, t.core.getOrigin()), ujs.notify("hcs.request.exited")
    }, e.prototype.exit = function() {
        var e = {
            title: _("Exit"),
            message: _("Are you sure you want to leave this page"),
            buttonA: !0,
            buttonB: !0,
            buttonBText: _("Exit"),
            buttonAText: _("Cancel"),
            onClickB: function(e) {
                return t.doExit(e), !0
            }
        };
        hcs.UI.MessageBox.show(e)
    }, e
}();
var ScreenshotMenuComponent = function() {
    var t = function(t) {
        BaseTopMenuComponent2D.call(this, t, "ScreenshotMenuComponent"), this.isMainMenuItem = !1, this._item = {
            title: "Capture",
            icon: "fa fa-camera",
            action: "hcs.request.takeScreenshot",
            id: "toolbarScreenshot",
            items: [],
            index: 500
        }
    };
    return t.prototype = Object.create(BaseTopMenuComponent2D.prototype), t
}();
var FullscreenComponent = function() {
    function t(t) {
        t.requestFullScreen || (t.requestFullScreen = t.msRequestFullscreen || t.webkitRequestFullscreen || t.mozRequestFullScreen || function() {
            return !1
        }), document.cancelFullScreen || (document.cancelFullScreen = document.msExitFullscreen || document.webkitCancelFullScreen || document.mozCancelFullScreen || function() {
            return !1
        })
    }

    function e() {
        return document.fullscreen || document.msFullscreenElement || document.webkitIsFullScreen || document.mozFullScreen
    }
    var n = function(t) {
        BaseTopMenuComponent2D.call(this, t, "FullscreenComponent"), this.isMainMenuItem = !1, this._item = {
            title: "Full Screen",
            icon: "fa fa-arrows-alt",
            action: "hcs.request.toggleFullscreen",
            id: "fullscreen-btn",
            items: [],
            index: 1001
        }
    };
    return n.prototype = Object.create(BaseTopMenuComponent2D.prototype), n.prototype.initialize = function() {
        if (BaseTopMenuComponent2D.prototype.initialize.call(this), document.addEventListener("hcs.request.toggleFullscreen", this.toggleFullscreen, !1), document.addEventListener("mozfullscreenchange", this.onFullScreenChange, !1), document.addEventListener("webkitfullscreenchange", this.onFullScreenChange, !1), document.addEventListener("MSFullscreenChange", this.onFullScreenChange, !1), document.addEventListener("fullscreenchange", this.onFullScreenChange, !1), hcsdesign.mode === hcsdesign.MODE_VIEWER) {
            var e = document.getElementById("fullscreen-btn");
            e.setAttribute("title", _("Toggle to fullscreen mode")), e.addEventListener("click", toggleFullscreen, !1)
        }
        t(document.body)
    }, n.prototype.destroy = function() {
        BaseTopMenuComponent2D.prototype.destroy.call(this), document.removeEventListener("hcs.request.toggleFullscreen", this.toggleFullscreen), document.removeEventListener("mozfullscreenchange", this.onFullScreenChange), document.removeEventListener("webkitfullscreenchange", this.onFullScreenChange), document.removeEventListener("MSFullscreenChange", this.onFullScreenChange), document.removeEventListener("fullscreenchange", this.onFullScreenChange)
    }, n.prototype.toggleFullscreen = function(n) {
        var i = document.body;
        n instanceof HTMLElement && (i = n, t(i)), e() ? document.cancelFullScreen() : i.requestFullScreen()
    }, n.prototype.onFullScreenChange = function() {
        var t = document.getElementById("fullscreen-btn").querySelector(".menu-icon > i");
        t.setAttribute("class", e() ? "fa fa-expand" : "fa fa-arrows-alt")
    }, n
}();
var TransparencyComponent = function() {
    var t = 0,
        e = t,
        n = function(t) {
            BaseComponent3D.call(this, t, "TransparencyComponent"), this._item = {
                title: _("Transparency"),
                id: "transparencyButton",
                icon: "images/icon-transparency.png",
                action: "hcs.request.switch-transparency",
                addClass: "hidden",
                index: 12
            }
        };
    return n.prototype = Object.create(BaseComponent3D.prototype), n.prototype.initialize = function() {
        BaseComponent3D.prototype.initialize.call(this), ujs.notify("hcs.menu.top.sub.add", {
            item: this._item,
            menuPath: "."
        })
    }, n.prototype.startListening = function() {
        if (this.switchTransparencyMode = this.switchTransparencyMode.bind(this), hcsdesign.mode === hcsdesign.MODE_VIEWER) {
            var t = document.getElementById("switch-transparency-btn");
            t.setAttribute("title", _("Toggle transparency")), t.addEventListener("click", this.switchTransparencyMode, !1)
        }
        document.addEventListener("hcs.request.switch-transparency", this.switchTransparencyMode, !1), document.addEventListener("hcs.engine3d.wallTransparency.on", this.onWallTransparencyOn, !1), document.addEventListener("hcs.engine3d.wallTransparency.off", this.onWallTransparencyOff, !1)
    }, n.prototype.stopListening = function() {
        document.removeEventListener("hcs.request.switch-transparency", this.switchTransparencyMode), document.removeEventListener("hcs.engine3d.wallTransparency.on", this.onWallTransparencyOn), document.removeEventListener("hcs.engine3d.wallTransparency.off", this.onWallTransparencyOff)
    }, n.prototype.switchTransparencyMode = function() {
        var n = hcsdesign.getComponentByName("WallComponent3D"),
            i = hcsdesign.engine3D.cameraFeatures;
        if (i.setCamera(hcsdesign.engine3D.camera), e = (e + 1) % 2, e === t) {
            i && i.stopTransparency();
            for (var o in hcsdesign.structure.members)
                n.switchTransparentStatusByStructure(hcsdesign.structure.members[o]);
            ujs.notify("hcs.engine3d.wallTransparency.off")
        } else if ("Camera" == i.camera.name) {
            for (var o in hcsdesign.structure.members)
                n.switchTransparentStatusByStructure(hcsdesign.structure.members[o]);
            i && i.startTransparency(), ujs.notify("hcs.engine3d.wallTransparency.on")
        }
    }, n.prototype.setTransparencyMode = function(t) {
        e != t && this.switchTransparencyMode()
    }, n.prototype.onContextChanged = function(t) {
        BaseComponent3D.prototype.onContextChanged.call(this, t), "3D" == t ? ujs.notify("hcs.menu.top.sub.replace", {
            item: {
                id: "transparencyButton",
                addClass: ""
            },
            merge: !0
        }, !0) : ujs.notify("hcs.menu.top.sub.replace", {
            item: {
                id: "transparencyButton",
                addClass: "hidden"
            },
            merge: !0
        }, !0)
    }, n.prototype.onWallTransparencyOn = function() {
        var t = hcsdesign.getComponentByName("TopMenuComponent");
        if (t) {
            var e = t.submenu;
            e.replaceMenuItem("transparencyButton", {
                icon: "images/icon-opacity.png"
            }, !0), e.updateHtml()
        }
    }, n.prototype.onWallTransparencyOff = function() {
        var t = hcsdesign.getComponentByName("TopMenuComponent");
        if (t) {
            var e = t.submenu;
            e.replaceMenuItem("transparencyButton", {
                icon: "images/icon-transparency.png"
            }, !0), e.updateHtml()
        }
    }, n.prototype.onEngineSwitched = function() {
        e !== t && this.switchTransparencyMode()
    }, n
}();
var CameraComponent = function() {
    var t, e = new BABYLON.Vector3(0, 170, 0),
        n = function(n) {
            BaseComponent3D.call(this, n, "CameraComponent"), t = this, this.ORBITCAMERA = 0, this.FPSCAMERA = 1, this.scene = n.engine3D.scene, this.cameraActiveId = 0, this.lookAt = null;
            var i = function() {
                this.bindLookAt(hcsdesign.getComponentByName("AvatarComponent3D").avatar), document.removeEventListener("hcs.engine3d.globaleFloorReady", i, !1)
            }.bind(this);
            document.addEventListener("hcs.engine3d.globaleFloorReady", i, !1), this.avatarPosition = e.clone(), this.camera = [new hcs.Input.OrbitCamera("Camera", -Math.PI / 3, Math.PI / 4, 1500, e.clone(), n.engine3D.scene), new hcs.Input.FirstPersonCamera("FPS", this.avatarPosition, n.engine3D.scene)], this.camera[0].attachControl(n.engine3D.canvas), this.camera[0].inertia = 0, this.camera[0].angularSensibility = 300, this.camera[0].radiusSpeedFactor = .005, this.camera[0].moveSpeedFactor = 5, this.camera[0].fov = .25 * Math.PI, this.camera[0].minZ = 15, this.camera[0].maxZ = 4e4, this.camera[1].minZ = 15, this.camera[1].maxZ = 4e4, this.camera[1].heightMin = 20, this.camera[1].heightMax = 240, this.camera[1].radiusSpeedFactor = .2, this.camera[1].angularSensibility = 400, this.camera[1].height = 170, this.camera[1].fov = 70 / 180 * Math.PI, n.engine3D.scene.activeCamera = this.camera[this.cameraActiveId], n.engine3D.camera = n.engine3D.scene.activeCamera
        };
    return n.prototype = new BaseComponent3D, n.prototype.startListening = function() {
        this.onCameraChanged = this.onCameraChanged.bind(this), this.onFloorLevelChanged = this.onFloorLevelChanged.bind(this), this.onControleEnd = this.onControleEnd.bind(this), this.onControleMove = this.onControleMove.bind(this), this.onNewPlanReady = this.onNewPlanReady.bind(this), this.onGlobaleFloorReady = this.onGlobaleFloorReady.bind(this), document.addEventListener("hcs.request.cameraChanged", this.onCameraChanged, !1), document.addEventListener("hcs.request.floorSelected", this.onFloorLevelChanged, !1), document.addEventListener("mousemove", this.onMouseMove, !1), document.addEventListener("mousewheel", this.onMouseZoom, !1), document.addEventListener("hcs.engine3d.dragcontrols.end", this.onControleEnd, !1), document.addEventListener("hcs.engine3d.dragcontrols.move", this.onControleMove, !1), document.addEventListener("hcs.request.newPlanReady", this.onNewPlanReady, !1), document.addEventListener("hcs.engine3d.globaleFloorReady", this.onGlobaleFloorReady, !1), hcsdesign.engine3D.pointerManager.touchManager.on("swipe", this.onMouseZoom)
    }, n.prototype.stopListening = function() {
        document.removeEventListener("hcs.request.cameraChanged", this.onCameraChanged, !1), document.removeEventListener("hcs.request.floorSelected", this.onFloorLevelChanged, !1), document.removeEventListener("hcs.request.newPlanReady", this.onNewPlanReady, !1), document.removeEventListener("mousemove", this.onMouseMove), document.removeEventListener("mousewheel", this.onMouseZoom), document.removeEventListener("hcs.engine3d.dragcontrols.end", this.onControleEnd), document.removeEventListener("hcs.engine3d.dragcontrols.move", this.onControleMove), document.removeEventListener("hcs.engine3d.globaleFloorReady", this.onGlobaleFloorReady), hcsdesign.engine3D.pointerManager.touchManager.off("swipe", this.onMouseZoom)
    }, n.prototype.toggleFXAA = function(t) {
        var e = hcsdesign.engine3D.scene.activeCamera;
        return "number" == typeof t && (e = hcsdesign.engine3D.scene.cameras[t]), e.__fxaa__cookie ? (e.__fxaa__cookie.dispose(), e.__fxaa__cookie = null) : e.__fxaa__cookie = new BABYLON.FxaaPostProcess("fxaa", 1, e), e.__fxaa__cookie ? !0 : !1
    }, n.prototype.toggleFSAA = function(t, e) {
        var e = "number" == typeof e || BABYLON.Texture.BILINEAR_SAMPLINGMODE,
            n = hcsdesign.engine3D.scene.activeCamera;
        return "number" == typeof t && (n = hcsdesign.engine3D.scene.cameras[t]), n.__fsaa__cookie ? (n.__fsaa__cookie.dispose(), n.__fsaa__cookie = null) : (n.__fsaa__cookie = new BABYLON.PassPostProcess("fsaa", 2, n), n.__fsaa__cookie.renderTargetSamplingMode = e), n.__fsaa__cookie ? !0 : !1
    }, n.prototype.disableAllPostProcess = function() {
        camera.__fsaa__cookie && (camera.__fsaa__cookie.dispose(), camera.__fsaa__cookie = null), camera.__fxaa__cookie && (camera.__fxaa__cookie.dispose(), camera.__fxaa__cookie = null)
    }, n.prototype.onMouseMove = function() {}, n.prototype.onMouseZoom = function() {
        ujs.notify("hcs.engine3D.camera.zoom")
    }, n.prototype.onGlobaleFloorReady = function() {
        var t = this.core.structure.members[this.core.structure.currentStructureIndex].elevation;
        this.camera[0].target.y = t + 170, this.camera[1].height = t + 170, this.camera[1].heightMin = t + 20, this.camera[1].heightMax = t + 240, this.avatarPosition.y = t + 170
    }, n.prototype.onCameraChanged = function() {
        this.cameraActiveId = (this.cameraActiveId + 1) % 2, this.scene.activeCamera = this.camera[this.cameraActiveId], hcsdesign.engine3D.camera = this.camera[this.cameraActiveId];
        var t = hcsdesign.engine3D.searchComponent("AvatarComponent3D");
        this.cameraActiveId ? (this.camera[1].rotation.copyFromFloats(0, -this.camera[0].alpha - Math.PI / 2, 0), this.camera[1].position.copyFromFloats(t.avatar.position.x, this.camera[1].height, t.avatar.position.z), this.camera[1].attachControl(hcsdesign.engine3D.canvas), this.camera[0].detachControl(hcsdesign.engine3D.canvas), t && t.setVisibility(!1)) : (this.lookAt && (this.lookAt.position.x = this.camera[1].position.x, this.lookAt.position.z = this.camera[1].position.z), this.camera[0].target.x = this.camera[1].position.x, this.camera[0].target.z = this.camera[1].position.z, this.camera[0].alpha = -this.camera[1].rotation.y - Math.PI / 2, this.camera[0].attachControl(hcsdesign.engine3D.canvas), this.camera[1].detachControl(hcsdesign.engine3D.canvas), t && t.setVisibility(!0)), ujs.notify("hcs.engine3d.cameraChanged", {
            activeCameraId: this.cameraActiveId,
            activeCamera: this.cameraActiveId ? "fpsCamera" : "orbitCamera"
        })
    }, n.prototype.onFloorLevelChanged = function(e) {
        t.camera[0].target.y = e.structure.elevation + 170, t.camera[1].height = e.structure.elevation + 170, t.camera[1].position.y = e.structure.elevation + 170, t.camera[1].heightMax = e.structure.elevation + 240, t.camera[1].heightMin = e.structure.elevation + 20
    }, n.prototype.onControleEnd = function(e) {
        e.selected && this.lookAt && e.selected.pickedMesh.id == this.lookAt.id && (t.camera[0].target.x = this.lookAt.position.x, t.camera[0].target.z = this.lookAt.position.z)
    }, n.prototype.onControleMove = function(e) {
        !e.selected && this.lookAt && (this.lookAt.position.x = t.camera[0].target.x, this.lookAt.position.z = t.camera[0].target.z)
    }, n.prototype.onNewPlanReady = function() {
        this.structure = this.core.getSelectedStructure(), "undefined" != typeof this.structure.elevation && (t.camera[0].target.y = this.structure.elevation + 170)
    }, n.prototype.getLookAt = function() {
        return this.lookAt
    }, n.prototype.bindLookAt = function(t) {
        this.lookAt = t
    }, n.prototype.getActiveCameraId = function() {
        return this.cameraActiveId
    }, n
}();
var GridStructure = function() {
    var t = function() {
        BaseStructure.call(this, "GridStructure"), this.materials = {}
    };
    return t.prototype = new BaseStructure, t.prototype.serialize = function() {
        return this.materials
    }, t.prototype.deserialize = function(t) {
        for (var e in t)
            this.materials[e] = t[e]
    }, t
}();
var GridComponent2D = function() {
    var t = function(t) {
        BaseComponent2D.call(this, t, "GridComponent2D"), this.priority = 1, this.displayGrid = !0
    };
    return t.prototype = new BaseComponent2D, t.prototype.startListening = function() {
        this.core.engine2D.registerEventCb("GridComponent2D.static-draw", this.priority, "static-draw", null, null, this.onStaticDraw.bind(this), null), this.core.engine2D.registerEventCb("GridComponent2D.drag-start", this.priority, "drag-start", 255 - this.core.engine2D.MODE_CONTEXTMENU, null, this.onDragStart.bind(this), null), this.core.engine2D.registerEventCb("GridComponent2D.zoom-in", this.priority, "zoom-in", 255 - this.core.engine2D.MODE_CONTEXTMENU, null, this.onZoomIn.bind(this), null), this.core.engine2D.registerEventCb("GridComponent2D.zoom-out", this.priority, "zoom-out", 255 - this.core.engine2D.MODE_CONTEXTMENU, null, this.onZoomOut.bind(this), null)
    }, t.prototype.stopListening = function() {
        this.core.engine2D.unregisterEventCb("GridComponent2D.static-draw"), this.core.engine2D.unregisterEventCb("GridComponent2D.drag-start"), this.core.engine2D.unregisterEventCb("GridComponent2D.zoom-in"), this.core.engine2D.unregisterEventCb("GridComponent2D.zoom-out")
    }, t.prototype.enableScrolling = function(t) {
        t && !this.scrollingEnabled ? (this.core.engine2D.registerEventCb("GridComponent2D.drag-start", this.priority, "drag-start", 255 - this.core.engine2D.MODE_CONTEXTMENU, null, this.onDragStart.bind(this), null), this.core.engine2D.registerEventCb("GridComponent2D.zoom-in", this.priority, "zoom-in", 255 - this.core.engine2D.MODE_CONTEXTMENU, null, this.onZoomIn.bind(this), null), this.core.engine2D.registerEventCb("GridComponent2D.zoom-out", this.priority, "zoom-out", 255 - this.core.engine2D.MODE_CONTEXTMENU, null, this.onZoomOut.bind(this), null), this.scrollingEnabled = !0) : (this.scrollingEnabled = !1, this.core.engine2D.unregisterEventCb("GridComponent2D.drag-start"), this.core.engine2D.unregisterEventCb("GridComponent2D.zoom-in"), this.core.engine2D.unregisterEventCb("GridComponent2D.zoom-out"))
    }, t.prototype.onStaticDraw = function(t, e, n) {
        if (this.displayGrid) {
            var i = this.core.getWidth(),
                o = this.core.getHeight(),
                r = 50 * n,
                s = Math.floor(e.x % r),
                a = Math.floor(e.y % r),
                l = 0,
                h = 0,
                c = this.core.configuration.boundingSize,
                u = this.core.getWidth() / 2 + (this.core.engine2D.getZoom() * Math.abs(c.min.x) - this.core.getWidth() / 2),
                p = this.core.getHeight() / 2 + (this.core.engine2D.getZoom() * Math.abs(c.min.y) - this.core.getHeight() / 2),
                d = this.core.getWidth() / 2 - (this.core.engine2D.getZoom() * Math.abs(c.max.x) - this.core.getWidth() / 2),
                m = this.core.getHeight() / 2 - (this.core.engine2D.getZoom() * Math.abs(c.max.y) - this.core.getHeight() / 2);
            s = e.x >= u ? e.x - u : s, l = e.x >= u ? s : 0, a = e.y >= p ? e.y - p : a, h = e.y >= p ? a : 0, i = e.x < d ? i + e.x - d : i, o = e.y < m ? o + e.y - m : o, t.strokeStyle = "#aaa", t.lineWidth = 1, t.beginPath();
            for (var g = a; o > g; g += r)
                t.moveTo(l, Math.floor(g) + .5), t.lineTo(i, Math.floor(g) + .5);
            for (var f = s; i > f; f += r)
                t.moveTo(Math.floor(f) + .5, h), t.lineTo(Math.floor(f) + .5, o);
            t.stroke(), t.strokeStyle = "#f0f0f0", t.lineWidth = 3, t.beginPath(), e.x >= u && (t.moveTo(Math.floor(s) + .5, h), t.lineTo(Math.floor(s) + .5, o)), e.x <= d && (t.moveTo(Math.floor(i) + .5, h), t.lineTo(Math.floor(i) + .5, o)), e.y >= p && (t.moveTo(l, Math.floor(a) + .5), t.lineTo(i, Math.floor(a) + .5)), e.y <= m && (t.moveTo(l, Math.floor(o) + .5), t.lineTo(i, Math.floor(o) + .5)), t.stroke(), t.fillStyle = "#770000", t.fillRect(e.x - 5, e.y - 5, 11, 11);
            var y = 100,
                _ = "1m";
            n > 2.5 && (y = 50, _ = "0.5m"), t.strokeStyle = "#999", t.beginPath(), t.lineWidth = 3, t.moveTo(20, o - 30.5), t.lineTo(Math.floor(20 + y * n), o - 30.5), t.stroke(), t.lineWidth = 2, t.moveTo(20, o - 29), t.lineTo(20, o - 35), t.moveTo(Math.floor(20 + y * n), o - 29), t.lineTo(Math.floor(20 + y * n), o - 35), t.stroke(), t.fillStyle = "#999", t.font = "10px Verdana", t.textAlign = "center", t.fillText(_, y / 2 * n + 20, o - 15)
        }
    }, t.prototype.onDragStart = function() {
        this.core.engine2D.registerEventCb("GridComponent2D.dragging", this.priority, "dragging", this.core.engine2D.MODE_DRAG, null, this.onDragging.bind(this), null), this.core.engine2D.registerEventCb("GridComponent2D.drag-end", this.priority, "drag-end", this.core.engine2D.MODE_DRAG, null, this.onDragEnd.bind(this), null)
    }, t.prototype.onDragging = function(t, e, n) {
        var i = this.core.engine2D.getTranslation();
        i = i.add(new BABYLON.Vector2(n.posDelta.x, n.posDelta.y)), this.core.engine2D.setTranslation(i)
    }, t.prototype.onDragEnd = function() {
        this.core.engine2D.unregisterEventCb("GridComponent2D.dragging"), this.core.engine2D.unregisterEventCb("GridComponent2D.drag-end")
    }, t.prototype.onZoomIn = function(t, e, n) {
        var i = this.core.engine2D.getZoom();
        if (this.core.engine2D.setZoom(1.05 * i), this.core.engine2D.getZoom() != i) {
            var o = this.core.engine2D.getTranslation(),
                r = n.pos.clone().subtractInPlace(o);
            r.scaleInPlace(.05), this.core.engine2D.setTranslation(o.subtractInPlace(r))
        }
    }, t.prototype.onZoomOut = function(t, e, n) {
        var i = this.core.engine2D.getZoom();
        this.core.engine2D.setZoom(.95 * i);
        i - this.core.engine2D.getZoom();
        if (this.core.engine2D.getZoom() != i) {
            var o = this.core.engine2D.getTranslation(),
                r = n.pos.clone().subtractInPlace(o);
            r.scaleInPlace(.05), this.core.engine2D.setTranslation(o.add(r))
        }
    }, t
}();
var GridBackgroundComponent2D = function() {
    var t = function(t) {
        BaseComponent2D.call(this, t, "GridBackgroundComponent2D"), this.priority = 1e3, this.background = !1, this.visibility = !0, this.scale = 1, this.translation = new BABYLON.Vector3(0, 0, 0)
    };
    return t.prototype = new BaseComponent2D, t.prototype.startListening = function() {
        this.onBackgroundChange = this.onBackgroundChange.bind(this), this.onAddBackground = this.onAddBackground.bind(this), this.onEndBackground = this.onEndBackground.bind(this), document.addEventListener("hcs.engine2d.backgroundChange", this.onBackgroundChange), document.addEventListener("hcs.engine2d.onAddBackground", this.onAddBackground), document.addEventListener("hcs.engine2d.onEndBackground", this.onEndBackground), this.core.engine2D.registerEventCb("GridBackgroundComponent2D.static-draw", this.priority, "static-draw", null, null, this.onStaticDraw.bind(this), null)
    }, t.prototype.stopListening = function() {
        document.removeEventListener("hcs.engine2d.backgroundChange", this.onBackgroundChange), document.removeEventListener("hcs.engine2d.onAddBackground", this.onAddBackground), document.removeEventListener("hcs.engine2d.onEndBackground", this.onEndBackground), this.core.engine2D.unregisterEventCb("GridBackgroundComponent2D.static-draw")
    }, t.prototype.initialize = function() {
        var t = {
            id: "gridBackgroundMenu",
            title: _("添加背景"),
            action: "hcs.engine2d.onAddBackground",
            cancelAction: "hcs.engine2d.onEndBackground"
        };
        ujs.notify("hcs.menu.main.add", {
            item: t,
            menuPath: "draw2D",
            position: 0
        })
    }, t.prototype.onStaticDraw = function(t, e, n) {
        if (this.background && this.visibility === !0) {
            var i = this.background;
            t.save(), t.globalAlpha = .4, t.translate(e.x - this.background.realWidth * n * this.scale / 2 + this.translation.x * n, e.y - this.background.realHeight * n * this.scale / 2 + this.translation.y * n), t.scale(n * this.scale, n * this.scale), t.drawImage(i, 0, 0), t.restore
        }
    }, t.prototype.onBackgroundChange = function(t) {
        this.visibility = t.visibility, this.scale = t.scale, this.background = t.img, this.core.engine2D.requestStaticDraw(), this.translation = t.translation || new BABYLON.Vector3(0, 0, 0), this.core.engine2D.requestStaticDraw(), this.core.structure.params.gridBackground = {
            scale: t.measure,
            translation: this.translation.asArray(),
            points: [t.points[0].asArray(), t.points[1].asArray()]
        }, ujs.notify("hcs.request.saveHistory", {})
    }, t.prototype.onEndBackground = function() {
        hcs.UI.BackgroundPopup.close(void 0, void 0, !0)
    }, t.prototype.onAddBackground = function() {
        hcs.UI.BackgroundPopup.show()
    }, t
}();
var GridComponent3D = function() {
    var t, e = function(e) {
        BaseComponent3D.call(this, e, "GridComponent3D"), this.structure = new GridStructure, t = this, this.setupLights(), this.createGround(), this.createSky(), this.lights = [], document.addEventListener("hcs.core.structure.loaded", this.onStructureLoaded.bind(this), !1)
    };
    return e.prototype = new BaseComponent3D, e.prototype.initialize = function() {}, e.prototype.onStructureLoaded = function() {
        var t = {},
            e = {};
        this.core.structure.params.grid && (t = this.core.structure.params.grid, this.createGround(t)), this.core.structure.params.sky && (e = this.core.structure.params.sky, this.createSky(e))
    }, e.prototype.startListening = function() {
        document.addEventListener("hcs.engine3D.changeGround", this.onChangeGround, !1), document.addEventListener("hcs.engine3D.changeSky", this.onChangeSky, !1)
    }, e.prototype.stopListening = function() {
        document.removeEventListener("hcs.engine3D.changeGround", this.onChangeGround, !1), document.removeEventListener("hcs.engine3D.changeSky", this.onChangeSky, !1)
    }, e.prototype.createGround = function(e) {
        var e = e || {},
            n = (e.name || "ground", e.url || hcs.Assets.globalPath + "js/Components/GridComponent/Images/grid2.jpg"),
            i = function(e) {
                var n = hcsdesign.engine3D.scene.getMeshByName("ground");
                if (!n) {
                    var i = t.core.configuration.boundingSize.getSize();
                    n = BABYLON.Mesh.CreateBloc("ground", i.x, 1, i.z, hcsdesign.engine3D.scene), n.position.copyFromFloats(0, -1, 0), (window.ejecta || GlobalHelper.isMobileDevice()) && (n.position.y = -10), n.isDecorable = !1, n.receiveShadows = !0
                }
                hcs.MaterialFactory.RepeatTextureXY(e, 16, 16), n.material = new BABYLON.StandardMaterial("ground", hcsdesign.engine3D.scene), n.material.diffuseTexture = e, n.material.ambientColor = new BABYLON.Color3(.9, .9, .9), n.material.diffuseColor = new BABYLON.Color3(1, 1, 1), n.material.specularColor = new BABYLON.Color3(.01, .01, .01), hcsdesign.engine3D.scene.lights.point.excludedMeshes.push(n)
            };
        i(new BABYLON.Texture(n, hcsdesign.engine3D.scene))
    }, e.prototype.createSky = function(e) {
        var e = e || {},
            n = e.url || hcs.Assets.globalPath + "js/Components/GridComponent/Images/background2.jpg",
            i = function(e) {
                var n = t.scene.getMeshByName("skysphere");
                n || (n = BABYLON.Mesh.CreateSphere("skysphere", 16, 3e4, hcsdesign.engine3D.scene), n.scaling.x *= -1, n.isDecorable = !1), n.material = new BABYLON.StandardMaterial("skysphere", hcsdesign.engine3D.scene), n.material.ambientTexture = e, hcs.MaterialFactory.MakeBasicMaterial(n.material), n.material.ambientColor.copyFromFloats(1, 1, 1)
            };
        i(new BABYLON.Texture(n, hcsdesign.engine3D.scene))
    }, e.prototype.setupLights = function() {
        hcsdesign.engine3D.scene.lights = [];
        var t = new BABYLON.DirectionalLight("Dir0", new BABYLON.Vector3(-1, -2, -1), hcsdesign.engine3D.scene);
        t.specular = new BABYLON.Color3(.15, .15, .15), t.diffuse = new BABYLON.Color3(.55, .55, .55), t.intensity = 1, t.position = new BABYLON.Vector3(1e3, 2e3, 1e3);
        var e = new BABYLON.PointLight("Point0", hcsdesign.engine3D.camera.position, hcsdesign.engine3D.scene);
        e.diffuse = new BABYLON.Color3(.65, .65, .65), e.specular = new BABYLON.Color3(1, 1, 1), e.intensity = .45, hcsdesign.engine3D.scene.lights.point = e, hcsdesign.engine3D.shadowGenerator = new BABYLON.ShadowGenerator(2048, t), hcsdesign.configuration.useShadow ? (hcsdesign.engine3D.shadowGenerator.useVarianceShadowMap = !1, hcsdesign.engine3D.shadowGenerator.usePoissonSampling = !0, hcsdesign.engine3D.shadowGenerator.setDarkness(.8), hcsdesign.engine3D.shadowGenerator.setTransparencyShadow(!0)) : hcsdesign.engine3D.shadowGenerator.dispose()
    }, e.prototype.reloadConfiguration = function() {}, e.prototype.onChangeGround = function(e) {
        t.createGround({
            name: e.name,
            url: e.url
        }), t.core.structure.params.grid = {
            name: e.name,
            url: e.url
        }, ujs.notify("hcs.request.saveHistory")
    }, e.prototype.onChangeSky = function(e) {
        t.createSky({
            name: e.name,
            url: e.url
        }), t.core.structure.params.sky = {
            name: e.name,
            url: e.url
        }, ujs.notify("hcs.request.saveHistory")
    }, e
}();
var HistoryEditionComponent = function() {
    var t = function(t) {
        BaseComponent3D.call(this, t, "HistoryEditionComponent"), this.historyComponent3D = null, this.isMainMenuItem = !1, this._items = [{
            title: _("Undo"),
            icon: "fa fa-reply",
            action: "hcs.request.undo",
            index: 10
        }, {
            title: _("Redo"),
            icon: "fa fa-share",
            action: "hcs.request.redo",
            index: 11
        }], this.undo = this.undo.bind(this), this.redo = this.redo.bind(this)
    };
    return t.prototype = Object.create(BaseComponent3D.prototype), t.prototype.initialize = function() {
        BaseComponent3D.prototype.initialize.call(this), this.historyComponent3D = hcsdesign.getComponentByName("HistoryComponent");
        for (var t = 0, e = this._items.length; e > t; t++)
            ujs.notify("hcs.menu.top.sub.add", {
                item: this._items[t],
                menuPath: "."
            });
        document.addEventListener("hcs.request.undo", this.undo, !1), document.addEventListener("hcs.request.redo", this.redo, !1)
    }, t.prototype.destroy = function() {
        console.log("destroy");
        for (var t = 0, e = this._items.length; e > t; t++)
            ujs.notify("hcs.menu.top.sub.delete", {
                id: this._items[t].id,
                menuPath: "."
            });
        document.removeEventListener("hcs.request.undo", this.undo), document.removeEventListener("hcs.request.redo", this.redo)
    }, t.prototype.undo = function() {
        hcsdesign.getSelectedEngine() == hcsdesign.ENGINE_2D ? hcsdesign.backFromHistory() : this.historyComponent3D.controlZ()
    }, t.prototype.redo = function() {
        hcsdesign.getSelectedEngine() == hcsdesign.ENGINE_2D ? hcsdesign.nextFromHistory() : this.historyComponent3D.controlY()
    }, t
}();
var HistoryComponent = function() {
    var t, e = function(e) {
        BaseComponent3D.call(this, e, "HistoryComponent"), t = this, this.componentList = [], this.history = [], this.currentHistoryIndex = -1, this.currentBalance = 0, this.maxHistoryLength = 50, this.callbackMap = []
    };
    e.prototype = new BaseComponent3D, e.prototype.startListening = function() {
        document.addEventListener("hcs.keyboardManager.keyDown", this.onKeyDown, !0), document.addEventListener("hcs.request.historyAction", this.onRotatorAction, !0)
    }, e.prototype.stopListening = function() {
        document.removeEventListener("hcs.keyboardManager.keyDown", this.onKeyDown, !0), document.removeEventListener("hcs.request.historyAction", this.onRotatorAction, !0)
    }, e.prototype.onContextChanged = function(t) {
        "3D" == t ? this.startListening() : (this.stopListening(), this.reset())
    };
    var n = function() {
        this.target = null, this.params = null, this.type = 0, this.componentInstance = null
    };
    return n.prototype.set = function(t, e, n, i) {
        this.target = t, this.params = e, this.type = n, this.componentInstance = i
    }, e.prototype.reset = function() {
        this.history.length = 0, this.currentHistoryIndex = -1, this.currentBalance = 0
    }, e.prototype.register = function(t) {
        this.componentList.push(t), this.callbackMap.push([])
    }, e.prototype.registerAction = function(t, e, n, i) {
        -1 == this.componentList.indexOf(i) && this.register(i);
        var o = {};
        this.callbackMap[this.componentList.indexOf(i)][t] = o, o.undo = e, o.redo = n
    }, e.prototype.actionDone = function(t, e, i, o) {
        this.currentHistoryIndex = (this.currentHistoryIndex + 1) % this.maxHistoryLength, this.currentBalance = 0, this.history[this.currentHistoryIndex] || (this.history[this.currentHistoryIndex] = new n), this.history[this.currentHistoryIndex].set(t, e, i, o)
    }, e.prototype.redo = function(t) {
        var e = this.callbackMap[this.componentList.indexOf(t.componentInstance)][t.type].redo;
        e(t.target, t.params)
    }, e.prototype.undo = function(t) {
        var e = this.callbackMap[this.componentList.indexOf(t.componentInstance)][t.type].undo;
        e(t.target, t.params)
    }, e.prototype.controlZ = function() {
        -1 != this.currentHistoryIndex && null != this.history[this.currentHistoryIndex] && (-this.currentBalance >= this.maxHistoryLength || (this.undo(this.history[this.currentHistoryIndex]), this.currentHistoryIndex = (this.currentHistoryIndex + this.maxHistoryLength - 1) % this.maxHistoryLength, this.currentBalance--))
    }, e.prototype.controlY = function() {
        -1 != this.currentHistoryIndex && (this.currentBalance >= 0 || (this.currentHistoryIndex = (this.currentHistoryIndex + 1) % this.maxHistoryLength, this.redo(this.history[this.currentHistoryIndex]), this.currentBalance++))
    }, e.prototype.onKeyDown = function(e) {
        var n = t.core.engine3D.keyboardManager.isPressed([17, 91, 224]);
        n && 90 == e.keyCode ? t.controlZ() : n && 89 == e.keyCode && t.controlY()
    }, e.prototype.onRotatorAction = function(t) {
        t.component.addHistory && t.component.addHistory(t.object, t.params, t.action)
    }, e
}();
var PrintComponent2D = function() {
    var t, e = function(e) {
        BaseTopMenuComponent2D.call(this, e, "PrintComponent2D"), this.isMainMenuItem = !1, this._item = {
            title: _("Print"),
            icon: "fa fa-print",
            action: "hcs.request.print",
            id: "print-icon-component",
            index: 20
        }, t = this
    };
    return e.prototype = Object.create(BaseTopMenuComponent2D.prototype), e.prototype.startListening = function() {
        document.addEventListener("hcs.request.print", this.onPrint, !1)
    }, e.prototype.stopListening = function() {
        document.removeEventListener("hcs.request.print", this.onPrint, !1)
    }, e.prototype.onPrint = function() {
        var e = 842,
            n = 596,
            i = document.createElement("canvas");
        i.width = e, i.height = n, i.style.width = e + "px", i.style.height = n + "px";
        var o = i.getContext("2d"),
            r = t.core.engine2D.getBestZoomAttributes(e, n),
            s = t.core.getComponentByName("WallComponent2D"),
            a = t.core.getComponentByName("RoomComponent2D"),
            l = t.core.getComponentByName("OvertureComponent2D"),
            h = t.core.getComponentByName("StairwayComponent2D"),
            c = t.core.getComponentByName("HopperComponent2D");
        a.onStaticDraw(o, r.translation, r.zoom, null), s.onStaticDraw(o, r.translation, r.zoom, null), l.onStaticDraw(o, r.translation, r.zoom, null), h.onStaticDraw(o, r.translation, r.zoom, null), c.onStaticDraw(o, r.translation, r.zoom, null);
        var u = t.core.getOrigin(),
            p = new Image,
            d = t.core.api.logoUrl || u + "/logo.png";
        p.src = "php/retrieveImage.php?image=" + d;
        var m = t.core.structure.name,
            g = o.measureText(m);
        o.fillText(m, 55 + g.width / 2, 20), p.onload = function() {
            o.drawImage(p, 0, 0, 48, 48)
        }, setTimeout(function() {
            var t, o = i.toDataURL("image/png");
            try {
                t = window.open("", "_blank", "width=" + e + ",height=" + n), t.document.write("<img src='" + o + "' />"), t.document.close(), t.focus(), t.print(), t.close()
            } catch (r) {
                parent.postMessage({
                    type: "printPopup",
                    img: o,
                    w: e,
                    h: n,
                    message: _("you must enable popup for this site")
                }, u)
            }
        }, 1e3)
    }, e
}();
var PrintComponent3D = function() {
    var t = function(t) {
        BaseComponent3D.call(this, t, "PrintComponent3D")
    };
    return t.prototype = Object.create(BaseComponent3D.prototype), t.prototype.startListening = function() {
        document.addEventListener("hcs.request.print", this.onPrint, !1)
    }, t.prototype.stopListening = function() {
        document.removeEventListener("hcs.request.print", this.onPrint, !1)
    }, t.prototype.onPrint = function() {
        var t = 842,
            e = 596,
            n = hcsdesign.getOrigin();
        GlobalHelper.createScreenshot3D(hcsdesign.engine3D.engine, void 0, function(i) {
            var o = i.toDataURL("image/png"),
                r = setTimeout(function() {
                    clearTimeout(r);
                    var i;
                    try {
                        i = window.open("", "_blank", "width=" + t + ",height=" + e), i.document.write("<img src='" + o + "' />"), i.document.close(), i.focus(), i.print(), i.close()
                    } catch (s) {
                        parent.postMessage({
                            type: "printPopup",
                            img: o,
                            w: t,
                            h: e,
                            message: _("you must enable popup for this site")
                        }, n)
                    }
                }, 1e3)
        })
    }, t
}();
var PerformanceComponent3D = function() {
    var t, e = 10,
        n = 1e4,
        i = 5e3,
        o = "wanadev.planner.performanceCheck",
        r = [],
        s = [],
        a = function(e) {
            BaseComponent3D.call(this, e, "PerformanceComponent3D"), this.waiter = document.getElementById("waiter"), this.waiter.innerHTML = _("正在计算中..."), this.waitSince = !1, this.stats = this.core.engine3D.stats, this.priority = 0, this.hasBeenAlreadyNotified = hcsLocalStorage.getItem(o), this.targetMaxLowFPSTime = n, this.hasFocus = !0, document.addEventListener("hcs.engine2D.contextMenuPerformance.close", this.onContextMenuPerformanceClose, !1), document.addEventListener("hcs.request.changePerformancesProperty", this.onContextMenuPropertyChanged, !1), document.addEventListener("hcs.request.changePerformances", this.onChangePerformance, !1), document.addEventListener("hcs.request.changeEngine", this.onChangeEngine, !1), t = this;
            var a = null,
                l = function(e) {
                    null !== a && (clearTimeout(a), a = null), "focus" === e.type ? a = setTimeout(function() {
                        clearTimeout(a), a = null, t.hasFocus = !0
                    }, i) : t.hasFocus = !1
                };
            r = [{
                content: [{
                    type: "html",
                    html: "<div class='warning'>" + _("Disable some of these functionnalities") + "<br />" + _("to get better performances in 3D mode.") + "</div>"
                }, {
                    type: "checkbox",
                    label: _("Antialiasing"),
                    value: t.configuration.useAntialiasing,
                    eventParams: {
                        cast: "bool",
                        property: "useAntialiasing",
                        eventName: "hcs.request.changePerformancesProperty"
                    }
                }, {
                    type: "checkbox",
                    label: _("Shadows"),
                    value: t.configuration.useShadow,
                    eventParams: {
                        cast: "bool",
                        property: "useShadow",
                        eventName: "hcs.request.changePerformancesProperty"
                    }
                }, {
                    type: "checkbox",
                    label: _("Enable detailled textures"),
                    value: t.configuration.useMultiTexturing,
                    eventParams: {
                        cast: "bool",
                        property: "useMultiTexturing",
                        eventName: "hcs.request.changePerformancesProperty"
                    }
                }]
            }], s = [{
                label: _("Apply and reload"),
                action: "hcs.engine2D.contextMenuPerformance.close"
            }], window.addEventListener("focus", l, !1), window.addEventListener("blur", l, !1)
        };
    return a.prototype = Object.create(BaseComponent3D.prototype), a.prototype.initialize = function() {
        var t = {
            title: _("Increase performances"),
            action: "hcs.request.changePerformances",
            index: 1
        };
        ujs.notify("hcs.menu.top.add", {
            item: t,
            menuPath: "toolbarOption"
        })
    }, a.prototype.addItem = function(t) {
        r[0].content.push(t)
    }, a.prototype.removeItem = function(t) {
        var e = "number" == typeof item ? t : r[0].content.indexOf(t);
        return e > -1 && r[0].content.splice(e, 1), e > -1
    }, a.prototype.onChangePerformance = function() {
        ujs.notify("hcs.menu.top.deselect");
        var t = {
            id: "performancesWindow",
            title: _("Settings"),
            x: hcsdesign.getWidth() / 2 - 100,
            y: 100
        };
        hcs.UI.ContextMenu.show(t, r, s)
    }, a.prototype.onContextMenuPerformanceClose = function() {
        ujs.notify("hcs.engine2D.contextMenu.close"), ujs.notify("hcs.engine3D.refreshGL")
    }, a.prototype.onContextMenuPropertyChanged = function(e) {
        var n = e.property,
            i = e.value;
        t.core.configuration.hasOwnProperty(n) && (t.core.configuration[n] = i, t.core.configuration.saveConfiguration())
    }, a.prototype.onChangeEngine = function() {
        t.waiter.classList.remove("hidden"), t.core.getSelectedEngine() == t.core.ENGINE_2D && setTimeout(function() {
            t.waiter.classList.add("hidden")
        }, 1e3)
    }, a.prototype.onContextChanged = function(t) {
        "2D" === t && this.waiter.classList.add("hidden")
    }, a.prototype.update = function() {
        this.checkPerf()
    }, a.prototype.checkPerf = function() {
        if (this.hasFocus) {
            var t = BABYLON.Tools.GetFps();
            if (e > t) {
                var i = (new Date).getTime();
                if (this.waitSince === !1)
                    this.waitSince = i;
                else if (i - this.waitSince > n && !this.hasBeenAlreadyNotified) {
                    var r = hcsdesign.engine2D.searchComponent("PedagoComponent");
                    this.hasBeenAlreadyNotified = !0, hcsLocalStorage.setItem(o, !0), hcs.UI.IFrame.show(document.body, {
                        width: 720,
                        height: 240,
                        src: r.getPageURL("graphics")
                    })
                }
                this.waiter.classList.remove("hidden")
            } else
                this.waitSince = !1, this.waiter.classList.add("hidden")
        }
    }, a
}();
var HardwareScalingComponent3D = function() {
    var t = function(t) {
        BaseComponent3D.call(this, t, "HardwareScalingComponent3D"), this.hardwareScalingLevel = 1, this.hardwareScaling = 1, this._e3d = hcsdesign.engine3D, this._camComponent = null, this._edtComponent = null, this._perfComponent = null, this._performanceItem = {}, this._initialized = !1
    };
    return t.prototype = Object.create(BaseComponent3D.prototype), t.prototype.initialize = function() {
        this._initialized || (this._onResize = this._onResize.bind(this), this.hardwareScalingLevel = hcsdesign.configuration.hardwareScalingLevel || 1, this.hardwareScaling = 1 / this.hardwareScalingLevel, this._camComponent = this._e3d.searchComponent("CameraComponent"), this._edtComponent = this._e3d.searchComponent("EditionComponent3D"), this._perfComponent = this._e3d.searchComponent("PerformanceComponent3D"), this.hardwareScalingLevel > 1 && (window.addEventListener("resize", this._onResize, !1), this.setHardwareScalingLevel(this.hardwareScalingLevel)), this._perfComponent && (this._performanceItem = {
            type: "select",
            label: _("Quality"),
            namesValues: [{
                text: _("Low"),
                value: 2
            }, {
                text: _("Simple"),
                value: 1.5
            }, {
                text: _("Good"),
                value: 1
            }],
            selectedKey: hcsdesign.configuration.hardwareScalingLevel,
            eventParams: {
                cast: "float",
                property: "hardwareScalingLevel",
                eventName: "hcs.request.changePerformancesProperty"
            }
        }, this._perfComponent.addItem(this._performanceItem)), this._initialized = !0)
    }, t.prototype.destroy = function() {
        this.setHardwareScalingLevel(1), hcsdesign.configuration.hardwareScalingLevel = 1, hcsdesign.configuration.saveConfiguration(), this._perfComponent && this._perfComponent.removeItem(this._performanceItem), this._camComponent && this._camComponent.disableAllPostProcess(), this._edtComponent && (this._edtComponent.dragControl.hardwareScaling = 1), window.removeEventListener("resize", this._onResize)
    }, t.prototype.setHardwareScalingLevel = function(t) {
        this.hardwareScaling = 1 / t, this.hardwareScalingLevel = t, this._e3d.engine.setHardwareScalingLevel(t), this._e3d.hardwareScaling = this.hardwareScaling, this._e3d.canvas.width = hcsdesign.getWidth() * this.hardwareScaling, this._e3d.canvas.height = hcsdesign.getHeight() * this.hardwareScaling, this.hardwareScalingLevel > 2 && this._camComponent && this._camComponent.toggleFSAA(), this._edtComponent && this._edtComponent.dragControl.setHardwareScaling(this.hardwareScaling)
    }, t.prototype._onResize = function() {
        this.hardwareScalingLevel > 1 && this.setHardwareScalingLevel(this.hardwareScalingLevel)
    }, t
}();
var RemoteControlComponent3D = function() {
    var t, e, n, i = !1,
        o = !1,
        r = function(e) {
            BaseComponent3D.call(this, e, "RemoteControlComponent3D"), t = this
        };
    return r.prototype = new BaseComponent3D, r.prototype.initialize = function() {
        this.createHTML(), document.addEventListener("mouseup", this.onMouseUp, !1), document.addEventListener("mousemove", this.onMouseMove, !1), window.addEventListener("mousewheel", this.onZoomUpdated, !1), document.addEventListener("touchend", this.onMouseUp, !1), document.addEventListener("touchcancel", this.onMouseUp, !1), document.addEventListener("touchmove", this.onMouseMove, !1), document.addEventListener("hcs.request.zoomUpdated", this.onZoomUpdated, !1), document.addEventListener("hcs.contextChanged", this.onZoomUpdated, !1), document.addEventListener("hcs.engine3d.cameraChanged", this.onCameraHasChanged.bind(this), !1), document.addEventListener("hcs.request.changeEngine", this.onCameraHasChanged.bind(this), !1)
    }, r.prototype.listenJoystickEvents = function() {
        this.joystick.addEventListener("mousedown", this.onJoystickMouseDown, !1), this.joystick.addEventListener("touchstart", this.onJoystickMouseDown, !1)
    }, r.prototype.listenCursorEvents = function() {
        this.cursor.addEventListener("mousedown", this.onCursorMouseDown, !1), this.cursor.addEventListener("touchstart", this.onCursorMouseDown, !1)
    }, r.prototype.onZoomUpdated = function() {
        var e = n.height;
        if (hcsdesign.getSelectedEngine() == hcsdesign.ENGINE_2D) {
            var i = hcsdesign.engine2D.getZoom(),
                o = e * (1 - i);
            o = 0 > o ? 0 : o
        } else {
            var r = hcsdesign.engine3D.camera;
            if ("Camera" == r.name)
                var s = r.radius,
                    o = e * (s - r.lowerRadiusLimit) / (r.upperRadiusLimit - r.lowerRadiusLimit);
            else
                var o = e * (r.heightMax - r.height) / (r.heightMax - r.heightMin)
        }
        t.cursor.style.marginTop = o + "px"
    }, r.prototype.onMouseMove = function(e) {
        if (i) {
            var o = e.pageY || e.clientY;
            e.touches && (e.preventDefault(), o = e.touches[0].pageY);
            var r = o - n.top,
                s = 0;
            if (r > 0 && r < n.height ? s = r : r > 0 && r > n.height ? s = n.height : 0 > r && (s = 0), hcsdesign.getSelectedEngine() == hcsdesign.ENGINE_2D) {
                {
                    var a = (n.height - s) / n.height;
                    hcsdesign.engine2D.getZoom()
                }
                hcsdesign.engine2D.setZoom(a)
            } else {
                var a = s / n.height,
                    l = hcsdesign.engine3D.camera;
                "Camera" == l.name ? l.radius = l.lowerRadiusLimit + (l.upperRadiusLimit - l.lowerRadiusLimit) * a : (l.height = l.heightMax + (l.heightMin - l.heightMax) * a, l.position.y = l.height), t.cursor.style.marginTop = s + "px", ujs.notify("hcs.engine3D.camera.zoom")
            }
        }
    }, r.prototype.onJoystickMouseDown = function(n) {
        o = !0, n.touches && n.preventDefault();
        var i = t.joystick.getBoundingClientRect(),
            r = {
                x: (n.touches ? n.touches[0].pageX : n.pageX || n.clientX) - i.left,
                y: (n.touches ? n.touches[0].pageY : n.pageY || n.clientY) - i.top
            },
            s = Math.floor(r.x / i.width * 3),
            a = Math.floor(r.y / i.height * 3);
        1 == s && 1 == a && ujs.notify("hcs.request.cameraChanged"), e = setInterval(function() {
            t.setTranslation(s, a)
        }, 1)
    }, r.prototype.setTranslation = function(t, e) {
        if (hcsdesign.getSelectedEngine() == hcsdesign.ENGINE_2D) {
            var n = 10,
                i = hcsdesign.engine2D.getTranslation();
            1 > t && (i.x -= n), t > 1 && (i.x += n), 1 > e && (i.y -= n), e > 1 && (i.y += n), hcsdesign.engine2D.setTranslation(i)
        } else {
            var o = hcsdesign.engine3D.camera;
            if ("Camera" == o.name) {
                var n = Math.PI / 300;
                1 > t && (o.alpha -= n), t > 1 && (o.alpha += n), 1 > e && (o.beta -= n), e > 1 && (o.beta += n)
            } else {
                var n = o._computeLocalCameraSpeed();
                o._localDirection || (o._localDirection = BABYLON.Vector3.Zero(), o._transformedDirection = BABYLON.Vector3.Zero()), o._localRotation || (o._localRotation = BABYLON.Vector3.Zero(), o._transformedRotation = BABYLON.Vector3.Zero()), 1 > t ? o._localRotation.copyFromFloats(0, -n / 15, 0) : 1 > e ? o._localDirection.copyFromFloats(0, 0, 50 * n) : t > 1 ? o._localRotation.copyFromFloats(0, n / 15, 0) : e > 1 && o._localDirection.copyFromFloats(0, 0, 50 * -n), o.getViewMatrix().invertToRef(o._cameraTransformMatrix), 1 > e || e > 1 ? (BABYLON.Vector3.TransformNormalToRef(o._localDirection, o._cameraTransformMatrix, o._transformedDirection), o.position.addInPlace(o._transformedDirection)) : (BABYLON.Vector3.TransformNormalToRef(o._localRotation, o._cameraTransformMatrix, o._transformedRotation), o.rotation.y += o._transformedRotation.y), o.position.y = o.height
            }
        }
    }, r.prototype.onCursorMouseDown = function() {
        i = !0
    }, r.prototype.onMouseUp = function() {
        i = !1, o && (clearInterval(e), o = !1)
    }, r.prototype.createHTML = function() {
        var e = document.createElement("div");
        e.setAttribute("id", "remoteController"), e.style.width = "50px", e.style.height = "210px", e.style.position = "relative", e.style.backgroundImage = "url('" + hcs.Assets.globalPath + hcs.Assets.remote.bg + "')", this.cursorContainer = document.createElement("div"), this.cursorContainer.setAttribute("style", "width:20px;height:150px;position:absolute;top:57px;left:15px;"), this.cursor = document.createElement("div"), this.cursor.setAttribute("style", "width:20px;height:7px;background:" + hcs.Assets.mainUIColor + ";border-radius:2px;cursor:pointer;border:1px solid " + ("#897364" == hcs.Assets.mainUIColor ? "#897364" : "#333") + ";margin-top:50px;"), this.listenCursorEvents(), this.cursorContainer.appendChild(this.cursor), e.appendChild(this.cursorContainer), this.cameraButton = document.createElement("div"), this.cameraButton.id = "camera-swap-btn", this.cameraButton.style.width = "18px", this.cameraButton.style.height = "18px", this.cameraButton.style.position = "absolute", this.cameraButton.style.backgroundSize = "cover", this.cameraButton.style.top = "16px", this.cameraButton.style.left = "16px", this.cameraButton.style.borderRadius = "7px", e.appendChild(this.cameraButton), t._setCameraIcon(!1), this.joystick = document.createElement("div"), this.joystick.setAttribute("style", "width:50px;height:50px;cursor:pointer;position:absolute;"), this.listenJoystickEvents(), e.appendChild(this.joystick);
        var i = document.getElementById("remote-controller");
        i || (i = document.createElement("div"), i.style.position = "absolute", i.style.top = "50px", i.style.left = "10px", i.style.height = "300px", i.style.width = "50px", document.getElementById("modalWidgets").appendChild(i)), i.appendChild(e), n = this.cursorContainer.getBoundingClientRect()
    }, r.prototype.destroy = function() {
        window.removeEventListener("mousewheel", this.onZoomUpdated), document.removeEventListener("mouseup", this.onMouseUp), document.removeEventListener("mousemove", this.onMouseMove), document.removeEventListener("touchend", this.onMouseUp), document.removeEventListener("touchcancel", this.onMouseUp), document.removeEventListener("touchmove", this.onMouseMove), document.removeEventListener("hcs.request.zoomUpdated", this.onZoomUpdated), document.removeEventListener("hcs.contextChanged", this.onZoomUpdated);
        var t = document.getElementById("remoteController");
        if (t) {
            var e = t.parentNode;
            e.removeChild(t), e.parentNode.removeChild(e)
        }
    }, r.prototype.onCameraHasChanged = function(t) {
        this._setCameraIcon(t.engine && "2D" == t.engine ? !1 : t.activeCamera)
    }, r.prototype._setCameraIcon = function(t) {
        this.cameraButton.style.display = t === !1 ? "none" : "block";
        var e;
        switch (t) {
            case "fpsCamera":
                e = hcs.Assets.remote.cam;
                break;
            case "orbitCamera":
            default:
                e = hcs.Assets.remote.man
        }
        this.cameraButton.style.backgroundImage = "url('" + hcs.Assets.globalPath + e + "')"
    }, r
}();
var MeasureStructure = function() {
    var t = function(t, e, n) {
        BaseStructure.call(this, "MeasureStructure"), this.points = t || [], this.parent = e, this.offsetVector = n
    };
    return t.prototype = new BaseStructure, t.prototype.center = function() {
        return BABYLON.Vector2.Lerp(this.points[0], this.points[1], .5)
    }, t.prototype.normal = function() {
        return this.offsetVector.clone().normalize()
    }, t.prototype.tryMerge = function(t) {
        var e = function(t, e, n) {
                var i, o = Math.PI / 80,
                    r = 3,
                    s = e.subtract(t),
                    a = n.subtract(e);
                return s.length() < r || a.length() < r ? !1 : (i = Math.abs(s.determinant(a)), o > i)
            },
            n = 1,
            i = function() {
                var e = this.points.length - 1,
                    i = t.points.length - 1;
                if (this.points[e].distanceTo(t.points[0]) < n)
                    t.points.shift(), this.points.pop(), this.points = this.points.concat(t.points);
                else if (this.points[0].distanceTo(t.points[0]) < n)
                    t.points.reverse(), t.points.pop(), this.points.shift(), this.points = t.points.concat(this.points);
                else if (this.points[e].distanceTo(t.points[i]) < n)
                    t.points.reverse(), t.points.shift(), this.points.pop(), this.points = this.points.concat(t.points);
                else {
                    if (!(this.points[0].distanceTo(t.points[i]) < n))
                        return !1;
                    t.points.pop(), this.points.shift(), this.points = t.points.concat(this.points)
                }
                return !0
            }.bind(this);
        return e(this.points[0], this.points[this.points.length - 1], t.points[0]) && e(this.points[0], this.points[this.points.length - 1], t.points[t.points.length - 1]) && this.parent.height === t.parent.height ? i() : !1
    }, t.prototype.mergeMeasures = function(t) {
        for (var e, n = t.length, i = t.length - 1; i >= 0; i--) {
            e = t[i];
            for (var o = 0; n > o; o++)
                o !== i && e.tryMerge(t[o]) && (t.splice(o, 1), n--, i--, o = 0)
        }
    }, t
}();
var MeasureComponent = function() {
    var t = [],
        e = [],
        n = function(t) {
            BaseComponent2D.call(this, t, "MeasureComponent")
        };
    return n.prototype = new BaseComponent2D, n.prototype.getTargeted = function(n) {
        for (var i, o, r = t.concat(e), s = 15, a = s, l = null, h = 0; h < r.length; h++)
            for (var c = 0; c < r[h].length; c++)
                o = r[h][c], i = n.distanceTo(o.center().add(o.offsetVector.scale(o.parent.measureDist))), a > i && (a = i, l = o);
        return l
    }, n.prototype.getInternalMeasures = function() {
        return t
    }, n.prototype.getExternalMeasures = function() {
        return e
    }, n.prototype.getAllMeasures = function() {
        return measures
    }, n.prototype.buildFromRooms = function(n, i) {
        n = n, i = i, t.length = 0, e.length = 0;
        for (var o = 0, r = n.length; r > o; o++)
            n[o].panes ? t.push(n[o].panes) : (n.splice(o, 1), o--);
        for (var o = 0, r = i.length; r > o; o++)
            i[o].panes ? e.push(i[o].panes) : (i.splice(o, 1), o--)
    }, n.prototype.mergeMeasures = function(t) {
        for (var e, n = t.length, i = t.length - 1; i >= 0; i--) {
            e = t[i];
            for (var o = 0; n > o; o++)
                o !== i && e.tryMerge(t[o]) && (t.splice(o, 1), n--, i--, o = 0)
        }
    }, n.prototype.drawTmpWallMesure = function(t, e, n) {
        var i = hcsdesign.getComponentByName("WallComponent2D")._tmpWall;
        if (i) {
            var o = new BABYLON.Vector2(i.points[1].position.y - i.points[0].position.y, i.points[0].position.x - i.points[1].position.x).normalize().scaleInPlace(40);
            this._drawMeasureSlice(t, e, n, i.points[0].position.add(o), i.points[1].position.add(o))
        }
    }, n.prototype.draw = function(n, i, o) {
        for (var r, s, a = hcsdesign.getComponentByName("OvertureComponent2D") && hcsdesign.getComponentByName("OvertureComponent2D").overtureDragged, l = new BABYLON.Vector2, h = [], c = t.concat(e), u = 0, p = c.length; p > u; u++) {
            h.push([]);
            for (var d = 0, m = c[u].length; m > d; d++)
                c[u][d].parent.measureDisplayed && (r = [], l.copyFrom(c[u][d].offsetVector).normalize().scaleInPlace(c[u][d].parent.measureDist), r.push(c[u][d].points[0].clone(), c[u][d].points[1].clone()), a && this._addOvertureIntersections(c[u][d].parent, r), s = new MeasureStructure(r, c[u][d].parent, l.clone()), h[u].push(s));
            this.mergeMeasures(h[u])
        }
        for (var u = 0, p = h.length; p > u; u++)
            for (var d = 0, m = h[u].length; m > d; d++)
                for (var g = 0, f = h[u][d].points.length - 1; f > g; g++)
                    this._drawMeasureSlice(n, i, o, h[u][d].points[g].add(h[u][d].offsetVector), h[u][d].points[g + 1].add(h[u][d].offsetVector))
    }, n.prototype._drawMeasureSlice = function(t, e, n, i, o) {
        var r = hcsdesign.engine2D.toRealCoord(i, e, n),
            s = hcsdesign.engine2D.toRealCoord(o, e, n),
            a = i.distanceTo(o),
            l = Math.round(a) / 100;
        return hcsdesign.engine2D.symbols2D.drawMeasure(t, r, s, l + "m"), l
    }, n.prototype._addOvertureIntersections = function(t, e) {
        for (var n = function(t, n) {
                return t.distanceToSquared(e[0]) - n.distanceToSquared(e[0])
            }, i = 0, o = t.overtures.length; o > i; i++)
            for (var r = t.overtures[i].getPolygon(), s = 0, a = r.length; a > s; s++)
                r[s].isOnSegment(e[0], e[e.length - 1]) && ujs.insertSorted(r[s], n, e)
    }, n
}();
var DebugComponent2D = function(t) {
    BaseComponent2D.call(this, t, "DebugComponent2D")
};
DebugComponent2D.prototype = Object.create(BaseComponent2D.prototype), DebugComponent2D.prototype.dumpStructureToFile = function() {
    var t = hcsdesign.structure.serialize(),
        e = new Blob([t], {
            type: "text/plain;charset=utf-8"
        });
    saveAs(e, "structure.json")
}, DebugComponent2D.prototype.wallState = function() {
    Logger.message("ETAT DES MURS :");
    var t = this.structure.getCurrentStructure(),
        e = t.getElements("walls"),
        n = t.getElements("points");
    for (var i in e) {
        Logger.message("Mur " + i + " :"), Logger.message("	" + e[i].points[0].position.x + "," + e[i].points[0].position.y + " ->" + e[i].points[1].position.x + "," + e[i].points[1].position.y), Logger.message("	Points rattach��s : ");
        for (var o in e[i].attachedPoints)
            Logger.message("		Point " + n.indexOf(e[i].attachedPoints[o]) + " : " + e[i].attachedPoints[o].position.x + "," + e[i].attachedPoints[o].position.y)
    }
}, DebugComponent2D.prototype.pointState = function() {
    Logger.message("ETAT DES POINTS :");
    var t = this.structure.getCurrentStructure(),
        e = t.getElements("points"),
        n = t.getElements("walls");
    for (var i in e)
        Logger.message("Point " + i + " :"), Logger.message("	" + e[i].position.x + "," + e[i].position.y), Logger.message("	Murs parents : ", n.indexOf(e[i].parents[0]), n.indexOf(e[i].parents[1]))
}, DebugComponent2D.prototype.roomState = function(t) {
    Logger.message("ETAT DES PIECES :");
    for (var e in t.rooms)
        Logger.message("Pi��ce " + e + " :"), Logger.message("	Aire : " + t.rooms[e].area), t.rooms[e].path.debug()
}, DebugComponent2D.prototype.ints = function(t) {
    Logger.message("Intersections :");
    var e = this.structure.getCurrentStructure(),
        n = (e.getElements("points"), e.getElements("walls"));
    for (var i in n) {
        Logger.message("Mur " + i + " :");
        for (var o = t._extractWallIntersections(n[i]), r = 0; r < o.a.length; r++)
            Logger.message("	a :" + o.a[r].x + "," + o.a[r].y);
        for (var r = 0; r < o.b.length; r++)
            Logger.message("	b :" + o.b[r].x + "," + o.b[r].y)
    }
};
var DEBUG = DEBUG || !0,
    wallState = wallState || function() {
        if (DEBUG) {
            var t = PLANNER_DEBUGGER.getComponentByName("DebugComponent2D", 1);
            t.wallState()
        } else
            Logger.message("debug is disabled !")
    },
    pointState = pointState || function() {
        if (DEBUG) {
            var t = PLANNER_DEBUGGER.getComponentByName("DebugComponent2D", 1);
            t.pointState()
        } else
            Logger.message("debug is disabled !")
    },
    roomState = roomState || function() {
        if (DEBUG) {
            var t = PLANNER_DEBUGGER.getComponentByName("DebugComponent2D", 1),
                e = PLANNER_DEBUGGER.getComponentByName("RoomComponent2D");
            t.roomState(e)
        } else
            Logger.message("debug is disabled !")
    },
    ints = ints || function() {
        if (DEBUG) {
            var t = PLANNER_DEBUGGER.getComponentByName("DebugComponent2D", 1),
                e = PLANNER_DEBUGGER.getComponentByName("WallComponent2D", 1);
            t.ints(e)
        } else
            Logger.message("debug is disabled !")
    },
    getWalls = getWalls || function() {
        return DEBUG ? PLANNER_DEBUGGER.getSelectedStructure().getElements("walls") : void Logger.message("debug is disabled !")
    },
    getPoints = getPoints || function() {
        return DEBUG ? PLANNER_DEBUGGER.getSelectedStructure().getElements("points") : void Logger.message("debug is disabled !")
    },
    getRooms = getRooms || function() {
        return DEBUG ? PLANNER_DEBUGGER.getSelectedStructure().getElements("rooms") : void Logger.message("debug is disabled !")
    },
    compareRooms = compareRooms || function() {
        if (DEBUG) {
            for (var t = [], e = 0, n = PLANNER_DEBUGGER.structure.getLength(); n > e; e++) {
                var i = PLANNER_DEBUGGER.structure.getElement(e);
                if (i instanceof FloorStructure && (t.push(i.getElements("rooms")), 2 == t.length))
                    break
            }
            var o = PLANNER_DEBUGGER.getComponentByName("RoomComponent2D", 1);
            Logger.message(o.identifyRooms(t[0], t[1]))
        } else
            Logger.message("debug is disabled !")
    };
var DebugComponent3D = function(t) {
    BaseComponent3D.call(this, t, "DebugComponent3D")
};
DebugComponent3D.prototype = Object.create(BaseComponent3D.prototype), DebugComponent3D.prototype.dumpSceneToFile = function() {
    var t = BABYLON.SceneSerializer.Serialize(hcsdesign.engine3D.scene),
        e = JSON.stringify(t),
        n = new Blob([e], {
            type: "text/plain;charset=utf-8"
        });
    saveAs(n, "scene.babylon")
}, DebugComponent3D.prototype.marks = [], DebugComponent3D.prototype.mark = function(t, e, n, i, o) {
    var i = i || 16755200;
    Logger.message("%c Point marked with this color", "color:" + i);
    var r = new THREE.SphereGeometry(o || 5),
        s = new THREE.MeshBasicMaterial({
            color: i
        }),
        a = new THREE.Mesh(r, s);
    return this.scene.add(a), this.marks.push(a), a.position.set(t, e, n), hcsdesign.engine3D.refreshRenderer(), this.marks.length - 1
}, DebugComponent3D.prototype.marklights = function() {
    Logger.message(this);
    for (var t = 0; t < this.scene.__lights.length; t++) {
        var e = this.scene.__lights[t].position;
        this.mark(e.x, e.y, e.z, 16776960)
    }
    return hcsdesign.engine3D.refreshRenderer(), this.scene.__lights
}, DebugComponent3D.prototype.removemark = function(t) {
    return this.scene.remove(this.marks[t]), this.marks.splice(t, 1), t
}, DebugComponent3D.prototype.removemarks = function() {
    for (var t = 0; t < this.marks.length; t++)
        this.scene.remove(this.marks[t]);
    return this.marks = [], "done"
};
var DEBUG = DEBUG || !0;
DebugComponent3D.prototype.concatGeom = function(t) {
    var e = function(t) {
            var e = -1 / 0;
            for (var n in t.faces)
                e = Math.max(e, t.faces[n].materialIndex);
            return e
        },
        n = new THREE.Geometry,
        i = [],
        o = new THREE.MeshFaceMaterial(i),
        r = 0,
        s = function() {
            for (var s = t.children.length - 1; s >= 0; s--)
                if ("structure" == t.children[s].type)
                    for (var a in t.children[s].children)
                        if (t.children[s].children[a] instanceof THREE.Mesh && t.children[s].children[a].structure instanceof WallStructure) {
                            var l = e(t.children[s].children[a].geometry) + 1;
                            THREE.GeometryUtils.merge(n, t.children[s].children[a], r), i = i.concat(t.children[s].children[a].material.materials), r += l, t.remove(t.children[s].children[a])
                        }
            Logger.message(i), o.materials = i;
            var h = new THREE.Mesh(n, o);
            Logger.message(h.material), t.add(h), Logger.message(hcsdesign.engine3D.renderer.autoUpdateObjects), hcsdesign.engine3D.renderer.autoUpdateObjects = !1
        };
    s()
};
var updateRenderer = function() {
    hcsdesign.engine3D.renderer.initWebGLObjects(hcsdesign.engine3D.scene)
};
var concatgeom = concatgeom || function() {
        var t = hcsdesign.getComponentByName("DebugComponent3D");
        return DEBUG ? t.concatGeom(hcsdesign.engine3D.scene) : (Logger.warning("debug is disabled !"), !1)
    },
    mark = mark || function(t, e, n, i, o) {
        var r = hcsdesign.getComponentByName("DebugComponent3D");
        return DEBUG ? r.mark(t, e, n, i, o) : (Logger.warning("debug is disabled !"), !1)
    },
    marklights = marklights || function() {
        var t = hcsdesign.getComponentByName("DebugComponent3D");
        return DEBUG ? t.marklights() : (Logger.warning("debug is disabled !"), !1)
    },
    removemark = removemark || function(t) {
        var e = hcsdesign.getComponentByName("DebugComponent3D");
        return DEBUG ? e.removemark(t) : (Logger.warning("debug is disabled !"), !1)
    },
    removemarks = removemarks || function() {
        var t = hcsdesign.getComponentByName("DebugComponent3D");
        return DEBUG ? t.removemarks() : (Logger.warning("debug is disabled !"), !1)
    },
    drawWalls = drawWalls || function() {
        var t = hcsdesign.getComponentByName("WallComponent3D");
        return DEBUG ? t.drawWalls() : (Logger.warning("debug is disabled !"), !1)
    },
    debugCSG = debugCSG || function() {
        var t = hcsdesign.getComponentByName("WallComponent3D");
        return DEBUG ? t.debugCSG() : (Logger.warning("debug is disabled !"), !1)
    },
    debugSS = debugSS || function() {
        var t = hcsdesign.getComponentByName("SubSlopeComponent3D");
        return DEBUG ? t.debug() : (Logger.warning("debug is disabled !"), !1)
    };
var AnalyticsComponent = function() {
    var t, e = {
            "hcs.contextChanged": {
                action: "contextChanged",
                label: "fromContext",
                value: "{previousContext}"
            },
            "hcs.request.toggleFullscreen": {
                action: "toggleFullscreen"
            },
            "hcs.request.print": {
                action: "requestPrint"
            },
            "hcs.engine2d.onAddBackground": {
                action: "addBackgroundClick"
            },
            "hcs.component.lock": {
                action: "onLockObject"
            },
            "hcs.request.undo": {
                action: "history",
                label: "undo"
            },
            "hcs.request.redo": {
                action: "history",
                label: "redo"
            },
            "hcs.request.switch-transparency": {
                action: "switchTransparency"
            },
            "hcs.engine3D.addObject": {
                action: "addObject"
            },
            "hcs.engine3D.addProgrammable": {
                action: "addObject"
            },
            "hcs.engine3D.addGroup": {
                action: "addObject"
            },
            "hcs.request.object.remove": {
                action: "removeObject"
            },
            "hcs.engine3D.info": {
                action: "infoObject"
            },
            "hcs.contextMenu.propertyChanged": {
                action: "objectParamsModified",
                label: "{property}",
                value: "{value}"
            },
            "hcs.engine3D.decorate": {
                action: "decorate"
            }
        },
        n = function(e) {
            BaseComponent2D.call(this, e, "AnalyticsComponent"), t = this
        };
    return n.prototype = Object.create(BaseComponent2D.prototype), n.prototype.initialize = function() {
        ga("send", "pageview", {
            dimension1: hcsdesign.api.apiKey,
            dimension2: hcsdesign.mode
        });
        for (var i in e)
            ! function(e, i) {
                var o = e.split(".").join("_");
                n.prototype[o] = function(e) {
                    var n = hcsdesign.getSelectedEngine() == hcsdesign.ENGINE_2D ? "2D" : "3D",
                        o = t.cleanValue(i.action, e),
                        r = t.cleanValue(i.label, e),
                        s = t.cleanValue(i.value, e);
                    ga("send", "event", {
                        eventCategory: n,
                        eventAction: o,
                        eventLabel: r,
                        eventValue: s,
                        hitCallback: function() {},
                        hitCallbackFail: function() {}
                    })
                }, document.addEventListener(e, n.prototype[o])
            }(i, e[i])
    }, n.prototype.cleanValue = function(t, e) {
        if (!t)
            return null;
        var e = e || {};
        if (-1 == t.toString().indexOf("{"))
            return t;
        var n = t.replace("{", "").replace("}", ""),
            t = ujs.getProperty(e, n);
        return t ? t : null
    }, n
}();
var GroupConfiguratorModComponent3D = function() {
    var t = function(t) {
        BaseComponent3D.call(this, t, "GroupConfiguratorModComponent3D"), this.edcmp = hcsdesign.getComponentByName("EditionComponent3D")
    };
    return t.prototype = new BaseComponent3D, t.prototype.initialize = function() {
        this._state = "idle", this._currentObject = null
    }, t.prototype.getState = function() {
        return this._state
    }, t.prototype.getCurrentObject = function() {
        return this._currentObject
    }, t.prototype.lockUnrelatedActions = function() {
        this.edcmp.lock(this, 14);
        for (var t = this.edcmp.widgets.length; t--;)
            this.edcmp.widgets[t].removeInfo && this.edcmp.widgets[t].removeInfo();
        return !0
    }, t.prototype.unlockUnrelatedActions = function() {
        if (this.edcmp.unlock(this, 14), this.edcmp.getSelectedObject())
            for (var t = this.edcmp.widgets.length; t--;)
                this.edcmp.widgets[t].addInfo && this.edcmp.widgets[t].addInfo();
        return !0
    }, t.prototype.requestStart = function() {
        return "ready" == this.getState() ? !1 : this.getCurrentObject() ? (this.lockUnrelatedActions(), this._state = "ready", void ujs.notify("hcs.engine3d.groupConfigurator.start")) : !1
    }, t.prototype.requestStop = function() {
        return "idle" == this.getState() ? !1 : (this._state = "idle", ujs.notify("hcs.engine3d.groupConfigurator.stop"), void this.unlockUnrelatedActions())
    }, t.prototype.startListening = function() {
        this.initBindForThisInstance(), this.stopListening(), document.addEventListener("hcs.request.groupConfigurator.start", this.myBind.onRequestStart), document.addEventListener("hcs.request.groupConfigurator.stop", this.myBind.onRequestStop), document.addEventListener("hcs.request.groupConfigurator.cancel", this.myBind.onRequestCancel), document.addEventListener("hcs.engine3D.object.remove", this.myBind.onDisposeObject, !1), document.addEventListener("hcs.engine3D.object.dispose", this.myBind.onDisposeObject, !1), document.addEventListener("hcs.engine3d.globaleFloorReady", this.myBind.onFloorChanged, !1), document.addEventListener("hcs.contextChanged ", this.myBind.onSwapEngine)
    }, t.prototype.stopListening = function() {
        this.initBindForThisInstance(), document.removeEventListener("hcs.request.groupConfigurator.start", this.myBind.onRequestStart), document.removeEventListener("hcs.request.groupConfigurator.stop", this.myBind.onRequestStop), document.removeEventListener("hcs.request.groupConfigurator.cancel", this.myBind.onRequestCancel), document.removeEventListener("hcs.engine3D.object.remove", this.myBind.onDisposeObject, !1), document.removeEventListener("hcs.engine3D.object.dispose", this.myBind.onDisposeObject, !1), document.removeEventListener("hcs.engine3d.globaleFloorReady", this.myBind.onFloorChanged, !1), document.removeEventListener("hcs.contextChanged ", this.myBind.onSwapEngine)
    }, t.prototype.initBindForThisInstance = function() {
        if (this.myBind)
            return this;
        var t = this;
        this.myBind = {};
        for (var e in this.handlers)
            (function() {
                var n = t.handlers[e];
                t.myBind[e] = function(e) {
                    n.call(t, e)
                }
            })();
        return this
    }, t.prototype.handlers = {
        onRequestStart: function(t) {
            this._currentObject = t.object || t.furniture || this.edcmp.getSelectedObject(), this.edcmp.isGroup(this._currentObject) || (this._currentObject = null), this.requestStart()
        },
        onRequestStop: function() {
            this.requestStop()
        },
        onRequestCancel: function() {
            this.cancel()
        },
        onSwapEngine: function(t) {
            "2D" == t.engine && ujs.notify("hcs.request.groupConfigurator.cancel")
        },
        onFloorChanged: function() {},
        onDisposeObject: function() {}
    }, t
}();
var GroupConfiguratorPanelComponent3D = function() {
    var t = function(t) {
        BaseComponent3D.call(this, t, "GroupConfiguratorPanelComponent3D"), this.confm = hcsdesign.getComponentByName("ConfiguratorModComponent3D"), this.hec = hcsdesign.getComponentByName("HistoryEditionComponent"), this.edcmp = hcsdesign.getComponentByName("EditionComponent3D"), this.camF = hcsdesign.engine3D.cameraFeatures
    };
    t.prototype = new BaseComponent3D, t.prototype.initialize = function() {
        this._options || this.setOptions()
    };
    var e = {};
    return t.prototype.setOptions = function(t) {
        this._options = this._options || {}, t = t || {};
        for (var n in e)
            this._options[n] = "undefined" == typeof t[n] ? e[n] : t[n];
        return this
    }, t.prototype.stopListening = function() {
        this.initBindForThisInstance(), document.removeEventListener("hcs.engine3d.groupConfigurator.start", this.myBind.onEditionStart, !1), document.removeEventListener("hcs.engine3d.groupConfigurator.stop", this.myBind.onEditionStop, !1), document.removeEventListener("hcs.widget.contextMenu.FurnitureEditorForGroup.closed", this.myBind.onEditBoxClosed, !1)
    }, t.prototype.startListening = function() {
        this.stopListening(), document.addEventListener("hcs.engine3d.groupConfigurator.start", this.myBind.onEditionStart, !1), document.addEventListener("hcs.engine3d.groupConfigurator.stop", this.myBind.onEditionStop, !1), document.addEventListener("hcs.widget.contextMenu.FurnitureEditorForGroup.closed", this.myBind.onEditBoxClosed, !1)
    }, t.prototype.initBindForThisInstance = function() {
        if (this.myBind)
            return this;
        var t = this;
        this.myBind = {};
        for (var e in this.handlers)
            (function() {
                var n = t.handlers[e];
                t.myBind[e] = function(e) {
                    n.call(t, e)
                }
            })();
        return this
    }, t.prototype.closeEditBox = function() {
        hcs.UI.ContextMenu.close()
    }, t.prototype.openEditBox = function(t) {
        if (t) {
            this._enabled = !0;
            var e = [{
                label: _("Remove"),
                action: "hcs.request.object.remove",
                "class": "remove"
            }, {
                label: _("Duplicate"),
                action: "hcs.request.object.clone"
            }, {
                label: _("Submit"),
                action: "hcs.widget.contextMenu.FurnitureEditorForGroup.closed"
            }];
            hcsdesign.isPublisher() && e.push({
                label: _("Add to products"),
                action: "hcs.request.object.addToProducts"
            });
            var n = [{
                content: [{
                    label: _("Group"),
                    type: "checkbox",
                    value: -1 == t.name.indexOf("group_virtual") ? !0 : !1,
                    eventParams: {
                        eventName: "hcs.engine3D.contextMenu.group"
                    }
                }]
            }];
            hcs.UI.ContextMenu.show({
                menuName: "FurnitureEditorForGroup",
                title: _("Group info"),
                width: 450,
                maxHeight: 200,
                height: 200,
                autoSize: !1
            }, n, e, !1, {
                furniture: t
            })
        }
    }, t.prototype.handlers = {
        onEditionStart: function() {
            this.openEditBox(this.edcmp.getSelectedObject())
        },
        onEditionStop: function() {
            this.closeEditBox()
        },
        onEditBoxClosed: function() {
            this._enabled = !1, ujs.notify("hcs.request.groupConfigurator.stop")
        }
    }, t
}();
var ConfiguratorModComponent3D = function() {
    var t = function(t) {
        BaseComponent3D.call(this, t, "ConfiguratorModComponent3D"), this.edcmp = hcsdesign.getComponentByName("EditionComponent3D")
    };
    return t.prototype = new BaseComponent3D, t.prototype.startListening = function() {
        this.initBindForThisInstance(), this.stopListening(), document.addEventListener("hcs.request.configurator.start", this.myBind.onRequestStart), document.addEventListener("hcs.request.configurator.stop", this.myBind.onRequestStop), document.addEventListener("hcs.request.configurator.cancel", this.myBind.onRequestCancel), document.addEventListener("hcs.engine3d.configurator.animationIn.end", this.myBind.onAnimationInEnd), document.addEventListener("hcs.engine3d.configurator.animationOut.end", this.myBind.onAnimationOutEnd), document.addEventListener("hcs.engine3d.configurator.animationIn.begin", this.myBind.onAnimationInStart), document.addEventListener("hcs.engine3d.configurator.animationOut.begin", this.myBind.onAnimationOutStart), document.addEventListener("hcs.engine3D.object.remove", this.myBind.onDisposeObject, !1), document.addEventListener("hcs.engine3D.object.dispose", this.myBind.onDisposeObject, !1), document.addEventListener("hcs.engine3D.object.refresh", this.myBind.onRefreshObject, !1), document.addEventListener("hcs.engine3d.globaleFloorReady", this.myBind.onFloorChanged, !1), document.addEventListener("hcs.contextChanged ", this.myBind.onSwapEngine)
    }, t.prototype.stopListening = function() {
        this.initBindForThisInstance(), document.removeEventListener("hcs.request.configurator.start", this.myBind.onRequestStart), document.removeEventListener("hcs.request.configurator.stop", this.myBind.onRequestStop), document.removeEventListener("hcs.request.configurator.cancel", this.myBind.onRequestCancel), document.removeEventListener("hcs.engine3d.configurator.animationIn.end", this.myBind.onAnimationInEnd), document.removeEventListener("hcs.engine3d.configurator.animationOut.end", this.myBind.onAnimationOutEnd), document.removeEventListener("hcs.engine3d.configurator.animationIn.begin", this.myBind.onAnimationInStart), document.removeEventListener("hcs.engine3d.configurator.animationOut.begin", this.myBind.onAnimationOutStart), document.removeEventListener("hcs.engine3D.object.remove", this.myBind.onDisposeObject, !1), document.removeEventListener("hcs.engine3D.object.dispose", this.myBind.onDisposeObject, !1), document.removeEventListener("hcs.engine3D.object.refresh", this.myBind.onRefreshObject, !1), document.removeEventListener("hcs.engine3d.globaleFloorReady", this.myBind.onFloorChanged, !1), document.removeEventListener("hcs.contextChanged ", this.myBind.onSwapEngine)
    }, t.prototype.initBindForThisInstance = function() {
        if (this.myBind)
            return this;
        var t = this;
        this.myBind = {};
        for (var e in this.handlers)
            (function() {
                var n = t.handlers[e];
                t.myBind[e] = function(e) {
                    n.call(t, e)
                }
            })();
        return this
    }, t.prototype.initialize = function() {
        this._state = "idle", this._currentObject = null
    }, t.prototype.getCurrentObject = function() {
        return this._currentObject
    }, t.prototype.getState = function() {
        return this._state
    }, t.prototype.requestStart = function() {
        return "idle" != this.getState() ? !1 : this.getCurrentObject() ? void(this._animateInandOut() ? ujs.notify("hcs.request.configurator.animationIn.start") : (ujs.notify("hcs.engine3d.configurator.animationIn.begin"), ujs.notify("hcs.engine3d.configurator.animationIn.end"))) : !1
    }, t.prototype.requestStop = function() {
        return "ready" != this.getState() ? !1 : void(this._animateInandOut() ? ujs.notify("hcs.request.configurator.animationOut.start") : (ujs.notify("hcs.engine3d.configurator.animationOut.begin"), ujs.notify("hcs.engine3d.configurator.animationOut.end")))
    }, t.prototype.cancel = function() {
        switch (this._canceling = !0, this._state) {
            case "animationIn":
                ujs.notify(this._animateInandOut() ? "hcs.request.configurator.animation.cancel" : "hcs.engine3d.configurator.animationIn.end"), this._state = "animationOut", ujs.notify("hcs.engine3d.configurator.animationOut.begin"), ujs.notify("hcs.engine3d.configurator.animationOut.end");
                break;
            case "animationOut":
                ujs.notify(this._animateInandOut() ? "hcs.request.configurator.animation.cancel" : "hcs.engine3d.configurator.animationOut.end");
                break;
            case "ready":
                this._state = "animationOut", ujs.notify("hcs.engine3d.configurator.animationOut.begin"), ujs.notify("hcs.engine3d.configurator.animationOut.end");
                break;
            case "idle":
        }
        this._canceling = !1, this._state = "idle"
    }, t.prototype._lockUnrelatedActions = function() {
        return this.edcmp.lock(this, 14), this.edcmp.disableWidget(), !0
    }, t.prototype._unlockUnrelatedActions = function() {
        return this.edcmp.unlock(this, 14), this.edcmp.enableWidget(), this.getCurrentObject() && this.getCurrentObject().parent && this.edcmp.isGroup(this.getCurrentObject().parent) && this.edcmp.selectObject(this.getCurrentObject().parent), !0
    }, t.prototype._animateInandOut = function() {
        return !!hcsdesign.getComponentByName("ConfiguratorInOutAnimationComponent3D")
    }, t.prototype.handlers = {
        onAnimationInStart: function() {
            this._lockUnrelatedActions(), this._state = "animationIn"
        },
        onAnimationInEnd: function() {
            this._state = "ready", this._canceling || ujs.notify("hcs.engine3d.configurator.start", {
                furniture: this.getCurrentObject()
            })
        },
        onAnimationOutStart: function() {
            this._state = "animationOut", this._unlockUnrelatedActions(), ujs.notify("hcs.engine3d.configurator.stop")
        },
        onAnimationOutEnd: function() {
            this._state = "idle", this._unlockUnrelatedActions()
        },
        onRequestStart: function(t) {
            this._currentObject = t.object || t.furniture || this.edcmp.getSelectedObject(), this.edcmp.isGroup(this._currentObject) && (this._currentObject = null), this.requestStart()
        },
        onRequestStop: function() {
            this.requestStop()
        },
        onRequestCancel: function() {
            this.cancel()
        },
        onSwapEngine: function(t) {
            "2D" == t.engine && ujs.notify("hcs.request.configurator.cancel")
        },
        onFloorChanged: function() {},
        onDisposeObject: function(t) {
            "idle" != this.getState() && t.object == this._currentObject && ujs.notify("hcs.request.configurator.cancel")
        },
        onRefreshObject: function() {
            "idle" != this.getState() && this.getCurrentObject() == event.object && this._lockUnrelatedActions()
        }
    }, t
}();
var ConfiguratorPanelComponent3D = function() {
    var t = function(t) {
        BaseComponent3D.call(this, t, "ConfiguratorPanelComponent3D"), this.confm = hcsdesign.getComponentByName("ConfiguratorModComponent3D"), this.hec = hcsdesign.getComponentByName("HistoryEditionComponent"), this.edcmp = hcsdesign.getComponentByName("EditionComponent3D"), this.camF = hcsdesign.engine3D.cameraFeatures
    };
    t.prototype = new BaseComponent3D, t.prototype.initialize = function() {
        this._options || this.setOptions()
    };
    var e = {};
    t.prototype.setOptions = function(t) {
        this._options = this._options || {}, t = t || {};
        for (var n in e)
            this._options[n] = "undefined" == typeof t[n] ? e[n] : t[n];
        return this
    }, t.prototype.stopListening = function() {
        this.initBindForThisInstance(), document.removeEventListener("hcs.engine3d.configurator.start", this.myBind.onEditionStart, !1), document.removeEventListener("hcs.engine3d.configurator.stop", this.myBind.onEditionStop, !1), document.removeEventListener("hcs.engine3D.object.refresh", this.myBind.onRefresh, !1), document.removeEventListener("hcs.engine3D.object.rotate", this.myBind.onRefresh, !1), document.removeEventListener("hcs.engine3D.object.translate", this.myBind.onRefresh, !1), document.removeEventListener("hcs.contextMenu.transformChanged", this.myBind.onTransformPropertyChanged, !1), document.removeEventListener("hcs.contextMenu.propertyChanged", this.myBind.onParamPropertyChanged, !1), document.removeEventListener("hcs.widget.contextMenu.FurnitureEditor.closed", this.myBind.onEditBoxClosed, !1)
    }, t.prototype.startListening = function() {
        this.stopListening(), document.addEventListener("hcs.engine3d.configurator.start", this.myBind.onEditionStart, !1), document.addEventListener("hcs.engine3d.configurator.stop", this.myBind.onEditionStop, !1), document.addEventListener("hcs.contextMenu.transformChanged", this.myBind.onTransformPropertyChanged, !1), document.addEventListener("hcs.contextMenu.propertyChanged", this.myBind.onParamPropertyChanged, !1), document.addEventListener("hcs.widget.contextMenu.FurnitureEditor.closed", this.myBind.onEditBoxClosed, !1)
    }, t.prototype.initBindForThisInstance = function() {
        if (this.myBind)
            return this;
        var t = this;
        this.myBind = {};
        for (var e in this.handlers)
            (function() {
                var n = t.handlers[e];
                t.myBind[e] = function(e) {
                    n.call(t, e)
                }
            })();
        return this
    }, t.prototype.closeEditBox = function() {
        hcs.UI.ContextMenu.close(), document.removeEventListener("hcs.engine3D.object.refresh", this.myBind.onRefresh, !1), document.removeEventListener("hcs.engine3D.object.rotate", this.myBind.onRefresh, !1), document.removeEventListener("hcs.engine3D.object.translate", this.myBind.onRefresh, !1)
    }, t.prototype.openEditBox = function(t) {
        if (t) {
            this._enabled = !0;
            var e = [{
                label: _("删除"),
                action: "hcs.request.object.remove",
                "class": "remove"
            }, {
                label: _("复制"),
                action: "hcs.request.object.clone"
            }, {
                label: _("确定"),
                action: "hcs.widget.contextMenu.FurnitureEditor.closed"
            }];
            hcsdesign.isPublisher() && e.push({
                label: _("增加到物品列表"),
                action: "hcs.request.object.addToProducts"
            });
            var n = t.structure,
                i = n.getAvailableProperties(),
                o = [{
                    title: _("设置"),
                    content: i
                }, {
                    title: _("位置 和 旋转"),
                    content: this._getPositionAndRotationMenu(n)
                }];
            hcs.UI.ContextMenu.show({
                menuName: "FurnitureEditor",
                title: _("物品属性"),
                width: 500,
                maxHeight: window.innerHeight - 140,
                height: window.innerHeight - 140,
                autoSize: !1,
                x: window.innerWidth - 400,
                id: "configuratorWindow"
            }, o, e, !1, {
                furniture: t
            }), document.addEventListener("hcs.engine3D.object.refresh", this.myBind.onRefresh, !1), document.addEventListener("hcs.engine3D.object.rotate", this.myBind.onRefresh, !1), document.addEventListener("hcs.engine3D.object.translate", this.myBind.onRefresh, !1)
        }
    }, t.prototype.refreshEditBox = function(t) {
        if (t && this._enabled) {
            var e = t.structure,
                n = e.getAvailableProperties(),
                i = [{
                    title: _("设置"),
                    content: n
                }, {
                    title: _("位置 和 旋转"),
                    content: this._getPositionAndRotationMenu(e)
                }];
            hcs.UI.ContextMenu.update(i)
        }
    }, t.prototype._setTransformProperty = function(t, e, n) {
        if (!t)
            return !1;
        var i = e.indexOf("rotation") >= 0;
        i && (n = n / 180 * Math.PI);
        var o = t.rotation.clone(),
            r = t.position.clone();
        ujs.setProperty(t, e, +n), ujs.notify("hcs.request.historyAction", {
            component: this.edcmp,
            object: t,
            params: {
                oldPosition: r,
                newPosition: t.position.clone(),
                oldRotation: o,
                newRotation: t.rotation.clone()
            },
            action: i ? this.edcmp.ROTATEACTION : this.edcmp.MOVEACTION
        }), t.computeWorldMatrix(!0), t.parent.markAsDirty(), ujs.notify(i ? "hcs.engine3D.object.translate" : "hcs.engine3D.object.rotate", {
            object: t
        })
    }, t.prototype._setParamProperty = function(t, e, n) {
        if (!t)
            return !1;
        var i = t.structure.programmableInstance;
        n = i.validateParam(e, n), ("undefined" == typeof n || null === n) && (n = ujs.getProperty(i, e));
        var o = {};
        o["programmableInstance." + e] = {
            newValue: n,
            exValue: ujs.getProperty(i, e)
        }, ujs.setProperty(i, e, n), this.edcmp.refreshObject(t, {
            modifiedProperties: o
        }), ujs.notify("hcs.request.saveHistory")
    }, t.prototype._saveFrameState = function() {
        for (var t = hcs.UI.ContextMenu.getPosition() || {
                x: 100,
                y: 100
            }, e = document.querySelectorAll(".advancedParams"), n = !(!e.length || e[0].classList.contains("hidden")), o = document.querySelectorAll(".window .tabbed-tabcontent"), r = [], s = o.length; s--;)
            r[s] = i(o[s]);
        this._frameSavedState = {
            advancedVisible: n,
            x: t.x,
            y: t.y,
            scroll: r
        }
    }, t.prototype._restoreFrameState = function() {
        if (this._frameSavedState) {
            this._frameSavedState.advancedVisible && hcs.Programmable.toggleVisible(), hcs.UI.ContextMenu.setPosition(this._frameSavedState.x, this._frameSavedState.y);
            for (var t = document.querySelectorAll(".window .tabbed-tabcontent"), e = t.length; e--;)
                n(t[e], this._frameSavedState.scroll[e].x, this._frameSavedState.scroll[e].y)
        }
    }, t.prototype._getPositionAndRotationMenu = function(t) {
        var e = [],
            n = function(t) {
                var e = 2 * Math.PI;
                return Math.round((t % e + e) % e / Math.PI * 180)
            };
        return e.push({
            type: "separator",
            label: _("旋转")
        }), e.push({
            label: _("x 轴"),
            type: "slider",
            unit: "°",
            value: {
                step: 1,
                min: 0,
                max: 360,
                value: n(t.rotation.x)
            },
            eventParams: {
                eventName: "hcs.contextMenu.transformChanged",
                property: "rotation.x"
            },
            id: "rotation-x"
        }), e.push({
            label: _("y 轴"),
            type: "slider",
            unit: "°",
            value: {
                step: 1,
                min: 0,
                max: 360,
                value: n(t.rotation.y)
            },
            eventParams: {
                eventName: "hcs.contextMenu.transformChanged",
                property: "rotation.y"
            },
            id: "rotation-y"
        }), e.push({
            label: _("z 轴"),
            type: "slider",
            unit: "°",
            value: {
                step: 1,
                min: 0,
                max: 360,
                value: n(t.rotation.z)
            },
            eventParams: {
                eventName: "hcs.contextMenu.transformChanged",
                property: "rotation.z"
            },
            id: "rotation-z"
        }), e.push({
            type: "separator",
            label: _("位置")
        }), e.push({
            label: _("x 轴"),
            type: "number",
            unit: "cm",
            value: {
                step: 10,
                min: -1e4,
                max: 1e4,
                value: Math.round(t.position.x)
            },
            eventParams: {
                eventName: "hcs.contextMenu.transformChanged",
                property: "position.x"
            },
            id: "position-x"
        }), e.push({
            label: _("y 轴"),
            type: "number",
            unit: "cm",
            value: {
                step: 10,
                min: -1e4,
                max: 1e4,
                value: Math.round(t.position.y)
            },
            eventParams: {
                eventName: "hcs.contextMenu.transformChanged",
                property: "position.y"
            },
            id: "position-y"
        }), e.push({
            label: _("z 轴"),
            type: "number",
            unit: "cm",
            value: {
                step: 10,
                min: -1e4,
                max: 1e4,
                value: Math.round(t.position.z)
            },
            eventParams: {
                eventName: "hcs.contextMenu.transformChanged",
                property: "position.z"
            },
            id: "position-z"
        }), e
    }, t.prototype.handlers = {
        onEditionStart: function() {
            this.openEditBox(this.confm.getCurrentObject())
        },
        onEditionStop: function() {
            this.closeEditBox()
        },
        onRefresh: function(t) {
            "ready" == this.confm.getState() && t.object == this.confm.getCurrentObject() && this.refreshEditBox(this.confm.getCurrentObject())
        },
        onParamPropertyChanged: function(t) {
            this._setParamProperty(this.confm.getCurrentObject(), t.property, t.value)
        },
        onTransformPropertyChanged: function(t) {
            this._setTransformProperty(this.confm.getCurrentObject(), t.property, t.value)
        },
        onEditBoxClosed: function() {
            this._enabled = !1, ujs.notify("hcs.request.configurator.stop")
        }
    };
    var n = function(t, e, n) {
            if (t.scrollTo)
                return void t.scrollTo(e, n);
            if (null != t.scrollLeft && null != t.scrollTop)
                return t.scrollLeft = e, void(t.scrollTop = n);
            if (null != t.scrollX && null != t.scrollY)
                return t.scrollX = e, void(t.scrollY = n);
            throw "unable to scroll"
        },
        i = function(t) {
            if (null != t.scrollLeft && null != t.scrollTop)
                return {
                    x: t.scrollLeft,
                    y: t.scrollTop
                };
            if (null != t.scrollX && null != t.scrollY)
                return {
                    x: t.scrollX,
                    y: t.scrollY
                };
            throw "unable to scroll"
        };
    return t
}();
var ConfiguratorInOutAnimationComponent3D = function() {
    var t = function(t) {
        BaseComponent3D.call(this, t, "ConfiguratorInOutAnimationComponent3D"), this.confm = hcsdesign.getComponentByName("ConfiguratorModComponent3D"), this.camComp = hcsdesign.getComponentByName("CameraComponent"), this.avatarComp = hcsdesign.getComponentByName("AvatarComponent3D"), this.camF = hcsdesign.engine3D.cameraFeatures, this.setOptions({
            alpha: !1,
            beta: !0,
            goBack: !0,
            velocity: 2
        })
    };
    t.prototype = Object.create(BaseComponent3D.prototype), t.prototype.initialize = function() {
        this._previous = {
            cameraState: null,
            wallTransparency: null,
            lookAtObject: null,
            lookAtY: null,
            controlLock: null
        }, this._options || this.setOptions()
    };
    var e = {
        duration: 250,
        velocity: !1,
        smooth: "ease",
        alpha: !0,
        beta: !0,
        radius: !0,
        goBack: !0
    };
    t.prototype.setOptions = function(t) {
        this._options = this._options || {}, t = t || {};
        for (var n in e)
            this._options[n] = "undefined" == typeof t[n] ? e[n] : t[n];
        return this
    }, t.prototype.replaceCameraTarget = function(t) {
        var e = hcsdesign.engine3D.scene.activeCamera,
            n = this.camF,
            i = n.computeCameraStateLooking(t, e);
        i = {
            target: i.target
        };
        var o = {
                target: e.target.clone()
            },
            r = this._options.velocity ? this._coputeDelta(o, i) / (.1 * this._options.velocity) : .5 * this._options.duration;
        return n.computeAnimation(e, o, i, {
            duration: r,
            name: "cameraAnimation",
            isACamera: !0,
            smooth: "ease"
        })
    }, t.prototype.focusObject = function(t) {
        var e = hcsdesign.engine3D.camera,
            n = this.camF;
        if ("In" != this._currentAnimation && !this._focus) {
            this._previous.cameraState = {
                target: e.target.clone(),
                alpha: e.alpha,
                beta: e.beta,
                radius: e.radius
            };
            var i = {
                    target: e.target.clone(),
                    alpha: e.alpha,
                    beta: e.beta,
                    radius: e.radius
                },
                o = n.computeCameraStateLooking(t, e);
            o.alpha = BABYLON.Math.ClosestAngle(o.alpha, i.alpha), o.beta = BABYLON.Math.ClosestAngle(o.beta, i.beta), this.stopCurrentAnimation(), i = this._filterCameraState(i), o = this._filterCameraState(o);
            var r = this._options.velocity ? this._coputeDelta(i, o) / this._options.velocity : this._options.duration;
            this._cancelor = n.computeAnimation(e, i, o, {
                duration: r,
                callback: this.myBind.afterAnimation,
                name: "cameraFocusOn_" + t.name,
                isACamera: !0,
                smooth: "ease"
            }), this._currentAnimation = "In", ujs.notify("hcs.engine3d.configurator.animationIn.begin")
        }
    }, t.prototype.stopCurrentAnimation = function() {
        if (this._cancelor) {
            this._cancelor.cancel(), this._listenBreakEvent(!1);
            var t = this._currentAnimation;
            switch (this._cancelor = null, this._currentAnimation = null, t) {
                case "In":
                case "Out":
                    ujs.notify("hcs.engine3d.configurator.animation" + t + ".end")
            }
        }
    }, t.prototype.cancel = function() {
        this.stopCurrentAnimation()
    }, t.prototype.restoreCameraState = function() {
        var t = hcsdesign.engine3D.camera,
            e = this.camF;
        if ("Out" != this._currentAnimation && this._focus) {
            var n = {
                    target: t.target.clone(),
                    alpha: t.alpha,
                    beta: t.beta,
                    radius: t.radius
                },
                i = this._previous.cameraState;
            i.alpha = BABYLON.Math.ClosestAngle(i.alpha, n.alpha), i.beta = BABYLON.Math.ClosestAngle(i.beta, n.beta), this.stopCurrentAnimation(), n = this._filterCameraState(n), i = this._filterCameraState(i);
            var o = this._options.velocity ? this._coputeDelta(n, i) / this._options.velocity : this._options.duration;
            this._cancelor = e.computeAnimation(t, n, i, {
                duration: o,
                callback: this.myBind.afterAnimation,
                name: "cameraFocusOff",
                isACamera: !0,
                smooth: "ease"
            }), this._currentAnimation = "Out", this._previous.cameraState = !1, ujs.notify("hcs.engine3d.configurator.animationOut.begin"), this._listenBreakEvent(!0)
        }
    }, t.prototype.startListening = function() {
        this.stopListening(), document.addEventListener("hcs.request.configurator.animation.cancel", this.myBind.onRequestCancel), document.addEventListener("hcs.request.configurator.animationIn.start", this.myBind.onRequestAnimationIn), document.addEventListener("hcs.request.configurator.animationOut.start", this.myBind.onRequestAnimationOut), document.addEventListener("hcs.engine3d.configurator.animationIn.begin", this.myBind.onAnimationInStart), document.addEventListener("hcs.engine3d.configurator.animationIn.end", this.myBind.onAnimationInEnd), document.addEventListener("hcs.engine3d.configurator.animationOut.begin", this.myBind.onAnimationOutStart), document.addEventListener("hcs.engine3d.configurator.animationOut.end", this.myBind.onAnimationOutEnd), document.addEventListener("hcs.engine3D.object.refresh", this.myBind.onRefresh), document.addEventListener("hcs.engine3D.object.translate", this.myBind.onRefresh), document.addEventListener("hcs.engine3D.object.rotate", this.myBind.onRefresh), this._listening = !0
    }, t.prototype.stopListening = function() {
        this.initBindForThisInstance(), document.removeEventListener("hcs.request.configurator.animation.cancel", this.myBind.onRequestCancel), document.removeEventListener("hcs.request.configurator.animationIn.start", this.myBind.onRequestAnimationIn), document.removeEventListener("hcs.request.configurator.animationOut.start", this.myBind.onRequestAnimationOut), document.removeEventListener("hcs.engine3d.configurator.animationIn.begin", this.myBind.onAnimationInStart), document.removeEventListener("hcs.engine3d.configurator.animationIn.end", this.myBind.onAnimationInEnd), document.removeEventListener("hcs.engine3d.configurator.animationOut.begin", this.myBind.onAnimationOutStart), document.removeEventListener("hcs.engine3d.configurator.animationOut.end", this.myBind.onAnimationOutEnd), document.removeEventListener("hcs.engine3D.object.refresh", this.myBind.onRefresh), document.removeEventListener("hcs.engine3D.object.translate", this.myBind.onRefresh), document.removeEventListener("hcs.engine3D.object.rotate", this.myBind.onRefresh), this._listening = !1
    }, t.prototype.initBindForThisInstance = function() {
        if (this.myBind)
            return this;
        var t = this;
        this.myBind = {};
        for (var e in this.handlers)
            (function() {
                var n = t.handlers[e];
                t.myBind[e] = function(e) {
                    n.call(t, e)
                }
            })();
        return this
    }, t.prototype.avatarUnbind = function() {
        var t = this.camComp,
            e = hcsdesign.engine3D.camera;
        this._previous.lookAtObject = t.lookAt, this._previous.lookAtY = e.target.y, t.bindLookAt(null)
    }, t.prototype.avatarRebind = function() {
        var t = this.camComp,
            e = hcsdesign.engine3D.camera;
        t.cameraActiveId ? t.camera[0].target.y = this.avatarComp.avatar.position.y + 170 : (e.target.y = this._previous.lookAtY, e.target.y = this.avatarComp.avatar.position.y + 170, t.bindLookAt(this._previous.lookAtObject))
    }, t.prototype._listenBreakEvent = function(t) {
        for (var e = n.length; e--;)
            document.removeEventListener(n[e], this.myBind.onRequestCancel, !1);
        if (t)
            for (var e = n.length; e--;)
                document.addEventListener(n[e], this.myBind.onRequestCancel, !1)
    }, t.prototype._filterCameraState = function(t) {
        var e = {
            target: t.target
        };
        for (var n in t)
            switch (n) {
                case "beta":
                case "alpha":
                case "radius":
                    this._options[n] && (e[n] = t[n])
            }
        return e
    }, t.prototype._coputeDelta = function(t, e) {
        var n, i = 0;
        for (var o in t) {
            switch (o) {
                case "beta":
                case "alpha":
                    n = Math.abs(e[o] - t[o]) / Math.PI * 800;
                    break;
                case "radius":
                    n = .6 * Math.abs(e[o] - t[o]);
                    break;
                case "target":
                    n = 1.6 * BABYLON.Vector3.Distance(t[o], e[o])
            }
            n > i && (i = n)
        }
        return i
    }, t.prototype.handlers = {
        afterAnimation: function() {
            this.stopCurrentAnimation()
        },
        onAnimationInStart: function() {
            this.avatarUnbind()
        },
        onAnimationInEnd: function() {
            this._focus = !0
        },
        onAnimationOutStart: function() {
            this._focus = !1
        },
        onAnimationOutEnd: function() {
            this.avatarRebind()
        },
        onRequestAnimationOut: function() {
            this._options.goBack ? this.restoreCameraState() : (ujs.notify("hcs.engine3d.configurator.animationOut.begin"), ujs.notify("hcs.engine3d.configurator.animationOut.end"))
        },
        onRequestAnimationIn: function() {
            this.confm.getCurrentObject() && this.focusObject(this.confm.getCurrentObject())
        },
        onRequestCancel: function() {
            this.cancel()
        },
        onRefresh: function(t) {
            (this._focus || this._currentAnimation) && t.object == this.confm.getCurrentObject() && this.replaceCameraTarget(t.object)
        }
    };
    var n = ["hcs.engine3D.dragging", "hcs.engine3D.camera.zoom", "hcs.engine3D.click"];
    return t
}();
var ConfiguratorXrayComponent3D = function() {
    var t = function(t) {
        BaseComponent3D.call(this, t, "ConfiguratorXrayComponent3D"), this.confm = hcsdesign.getComponentByName("ConfiguratorModComponent3D"), this.hec = hcsdesign.getComponentByName("TransparencyComponent"), this.camF = hcsdesign.engine3D.cameraFeatures
    };
    t.prototype = new BaseComponent3D, t.prototype.initialize = function() {
        this._options || this.setOptions(), this._savedMaterials = {}, this._clonedMaterials = {}, e = new BABYLON.StandardMaterial("xrayTransparentDefaultMaterial", this.scene)
    };
    var e, n = function(t, n) {
            t.getTotalVertices() && (t.material || (t.material = e), "undefined" == typeof t.material.alternativeOpacity && (t.material.alternativeOpacity = "undefined" != typeof t.material.alpha ? t.material.alpha : 1), t.material.alpha = n, t.material.transparent = 1 != t.material.alpha)
        },
        i = function(t) {
            n(t, 0)
        },
        o = function(t) {
            n(t, .1)
        },
        r = function(t) {
            t.getTotalVertices() && (t.material.alpha = "undefined" == typeof t.material.alternativeOpacity ? 1 : t.material.alternativeOpacity, t.material.transparent = 1 != t.material.alpha, t.material == e && (t.material = null))
        },
        s = {
            wallTransparency: !0,
            hideAll: !0,
            partialTransparency: !0
        };
    return t.prototype.setOptions = function(t) {
        this._options = this._options || {}, t = t || {};
        for (var e in s)
            this._options[e] = "undefined" == typeof t[e] ? s[e] : t[e];
        return this._setHideStrategy(), this
    }, t.prototype.stopListening = function() {
        this.initBindForThisInstance(), document.removeEventListener("hcs.engine3d.configurator.animationIn.begin", this.myBind.onAnimationInStart, !1), document.removeEventListener("hcs.engine3d.configurator.animationOut.end", this.myBind.onAnimationOutEnd, !1), document.removeEventListener("hcs.engine3D.camera.move", this.myBind.onCameraMove, !1)
    }, t.prototype.startListening = function() {
        this.stopListening(), document.addEventListener("hcs.engine3d.configurator.animationIn.begin", this.myBind.onAnimationInStart, !1), document.addEventListener("hcs.engine3d.configurator.animationOut.end", this.myBind.onAnimationOutEnd, !1)
    }, t.prototype.initBindForThisInstance = function() {
        if (this.myBind)
            return this;
        var t = this;
        this.myBind = {};
        for (var e in this.handlers)
            (function() {
                var n = t.handlers[e];
                t.myBind[e] = function(e) {
                    n.call(t, e)
                }
            })();
        return this
    }, t.prototype.start = function() {
        document.removeEventListener("hcs.engine3D.camera.move", this.myBind.onCameraMove, !1), this._stopSharingMaterial(this.confm.getCurrentObject()), this._flagMeshes(), this._changeOnCameraMove && document.addEventListener("hcs.engine3D.camera.move", this.myBind.onCameraMove, !1), this._options.wallTransparency && this._startWallTransparency()
    }, t.prototype.stop = function() {
        if (document.removeEventListener("hcs.engine3D.camera.move", this.myBind.onCameraMove, !1), this._continueSharingMaterial(this.confm.getCurrentObject()), this._restoreMeshes(), this._options.wallTransparency)
            try {
                this._stopWallTransparency()
            } catch (t) {
                console.warn("TODO  fix wallTransparency when floor have changed")
            }
    }, t.prototype._stopSharingMaterial = function(t) {
        var e, n = this._savedMaterials,
            i = this._clonedMaterials;
        t.traverse(function(o) {
            o.material && !n[e = t.name + ":" + o.material.id + ":" + o.name] && o.material.clone && (n[e] = o.material, i[e] = o.material = o.material.clone())
        })
    }, t.prototype._continueSharingMaterial = function(t) {
        var e, n = this._savedMaterials,
            i = this._clonedMaterials;
        t.traverse(function(o) {
            o.material && n[e = t.name + ":" + o.material.id + ":" + o.name] && (i[e] != o.material || (o.material = n[e], o.material.dispose()), i[e] = null, n[e] = null, delete i[e], delete n[e])
        })
    }, t.prototype._flagMeshes = function() {
        var t = this.camera,
            e = this.confm.getCurrentObject(),
            n = this._options.partialTransparency ? o : i;
        this._hideStrategyInit || this._hideStrategyInit(e, t);
        for (var s, a = hcsdesign.engine3D.scene.meshes, l = a.length; l--;)
            s = a[l], s.name && "Object" == s.name.substr(0, 6) && s != e && s.traverse(this._hideStrategyAccept(s, e, t) ? n : r)
    }, t.prototype._restoreMeshes = function() {
        for (var t, e = this.confm.getCurrentObject(), n = hcsdesign.engine3D.scene.meshes, i = n.length; i--;)
            t = n[i], t.name && "Object" == t.name.substr(0, 6) && t != e && t.traverse(r)
    }, t.prototype._startWallTransparency = function() {
        var t = this.hec,
            e = this.camF;
        this._previousWallTransparency = e.wallTransparency, t.setTransparencyMode(!0)
    }, t.prototype._stopWallTransparency = function() {
        {
            var t = this.hec;
            this.camF
        }
        t.setTransparencyMode(this._previousWallTransparency)
    }, t.prototype._setHideStrategy = function(t) {
        switch ("undefined" == typeof t && (t = "do not hide", this._options.hideAll && (t = "hide all")), t) {
            case "hide all":
                this._hideStrategyInit = function() {}, this._hideStrategyAccept = function() {
                    return !0
                }, this._changeOnCameraMove = !1;
                break;
            case "do not hide":
            default:
                this._hideStrategyInit = function() {}, this._hideStrategyAccept = function() {
                    return !1
                }, this._changeOnCameraMove = !1
        }
    }, t.prototype.handlers = {
        onAnimationInStart: function() {
            this.start()
        },
        onAnimationOutEnd: function() {
            this.stop()
        },
        onCameraMove: function() {
            this._flagMeshes()
        }
    }, t
}();
var MasterReshaperComponent3D = function() {
    var t = function(t) {
        BaseComponent3D.call(this, t, "MasterReshaperComponent3D"), this.edcmp = hcsdesign.getComponentByName("EditionComponent3D"), this.confm = hcsdesign.getComponentByName("ConfiguratorModComponent3D"), this._listeners = []
    };
    return t.prototype = new BaseComponent3D, t.prototype.initialize = function() {}, t.prototype.startListening = function() {
        this.stopListening(), document.addEventListener("hcs.engine3d.configurator.cancel", this.myBind.onConfiguratorCancel, !1), document.addEventListener("hcs.engine3d.configurator.start", this.myBind.onConfiguratorStart, !1), document.addEventListener("hcs.engine3d.configurator.stop", this.myBind.onConfiguratorStop, !1)
    }, t.prototype.stopListening = function() {
        this.initBindForThisInstance(), document.removeEventListener("hcs.engine3d.configurator.cancel", this.myBind.onConfiguratorCancel, !1), document.removeEventListener("hcs.engine3d.configurator.start", this.myBind.onConfiguratorStart, !1), document.removeEventListener("hcs.engine3d.configurator.stop", this.myBind.onConfiguratorStop, !1), document.removeEventListener("hcs.engine3D.drag-start", this.myBind.onDragStart, !1), document.removeEventListener("hcs.engine3D.drag-end", this.myBind.onDragEnd, !1), document.removeEventListener("hcs.engine3D.dragging", this.myBind.onDragging, !1), document.removeEventListener("hcs.engine3D.mouse-move", this.myBind.onMouseMove, !1), document.removeEventListener("hcs.engine3D.object.refresh", this.myBind.onRefresh, !1), document.removeEventListener("hcs.engine3D.object.translate", this.myBind.onRefresh, !1), document.removeEventListener("hcs.engine3D.object.rotate", this.myBind.onRefresh, !1)
    }, t.prototype.initBindForThisInstance = function() {
        if (this.myBind)
            return this;
        var t = this;
        this.myBind = {};
        for (var e in this.handlers)
            (function() {
                var n = t.handlers[e];
                t.myBind[e] = function(e) {
                    n.call(t, e)
                }
            })();
        return this
    }, t.prototype.notify = function(t, e) {
        var n = this._listeners[t];
        if (n)
            for (var i = 0; i < n.length; i++)
                n[i](e)
    }, t.prototype.on = function(t, e) {
        return this._listeners[t] || (this._listeners[t] = []), this._listeners[t].push(e), this
    }, t.prototype.off = function(t, e) {
        var n = this._listeners[t];
        return n ? (n.indexOf(e) > -1 && n.splice(e, 1), this) : this
    }, t.prototype.requireHand = function(t) {
        return this._currentConfigurator == t ? !0 : (this._currentConfigurator && this._currentConfigurator.cancelHand(), this._currentConfigurator = t, !0)
    }, t.prototype.releaseHand = function(t) {
        this._currentConfigurator == t && (this._currentConfigurator = null, t.cancelHand());
        var e = this.edcmp,
            n = e.getLocker();
        e.unlock(n, 1), e.lock(n, 2)
    }, t.prototype.start = function(t) {
        this.furniture = t.furniture, this.notify("editionStart", t), document.removeEventListener("hcs.engine3D.drag-start", this.myBind.onDragStart, !1), document.removeEventListener("hcs.engine3D.mouse-move", this.myBind.onMouseMove, !1), document.removeEventListener("hcs.engine3D.object.refresh", this.myBind.onRefresh, !1), document.removeEventListener("hcs.engine3D.object.translate", this.myBind.onDragStart, !1), document.removeEventListener("hcs.engine3D.object.rotate", this.myBind.onMouseMove, !1), document.addEventListener("hcs.engine3D.drag-start", this.myBind.onDragStart, !1), document.addEventListener("hcs.engine3D.mouse-move", this.myBind.onMouseMove, !1), document.addEventListener("hcs.engine3D.object.refresh", this.myBind.onRefresh, !1), document.addEventListener("hcs.engine3D.object.translate", this.myBind.onRefresh, !1), document.addEventListener("hcs.engine3D.object.rotate", this.myBind.onRefresh, !1)
    }, t.prototype.cancel = t.prototype.stop = function(t) {
        this.notify("editionEnd", t), document.removeEventListener("hcs.engine3D.drag-start", this.myBind.onDragStart, !1), document.removeEventListener("hcs.engine3D.drag-end", this.myBind.onDragEnd, !1), document.removeEventListener("hcs.engine3D.dragging", this.myBind.nDragging, !1), document.removeEventListener("hcs.engine3D.mouse-move", this.myBind.onMouseMove, !1), document.removeEventListener("hcs.engine3D.object.refresh", this.myBind.onRefresh, !1), document.removeEventListener("hcs.engine3D.object.translate", this.myBind.onRefresh, !1), document.removeEventListener("hcs.engine3D.object.rotate", this.myBind.onRefresh, !1)
    }, t.prototype.handlers = {
        onConfiguratorStart: function(t) {
            this.start(t)
        },
        onConfiguratorStop: function(t) {
            this.stop(t)
        },
        onConfiguratorCancel: function(t) {
            this.cancel(t)
        },
        onDragStart: function(t) {
            t.furniture = this.furniture;
            var e = this.furniture;
            if (t.collided = this.scene.pick(t.mstate.pos.x, t.mstate.pos.y, function(t) {
                    return t.getTopLevelObject(!0) == e
                }), this.notify("dragStart", t), document.removeEventListener("hcs.engine3D.drag-end", this.myBind.onDragEnd, !1), document.removeEventListener("hcs.engine3D.dragging", this.myBind.onDragging, !1), this.dragging = !1, document.addEventListener("hcs.engine3D.drag-end", this.myBind.onDragEnd, !1), document.addEventListener("hcs.engine3D.dragging", this.myBind.onDragging, !1), this._currentConfigurator) {
                this.dragging = !0;
                var n = this.edcmp;
                n.lock(n.getLocker(), 1)
            }
        },
        onDragging: function(t) {
            if (this.notify("dragging", t), this._currentConfigurator) {
                this.dragging = !0;
                var e = this.edcmp;
                e.lock(e.getLocker(), 1)
            }
        },
        onDragEnd: function(t) {
            if (this.notify("dragEnd", t), this.dragging = !1, this._currentConfigurator) {
                var e = this.edcmp,
                    n = e.getLocker();
                e.unlock(n, 1), e.lock(n, 2), document.removeEventListener("hcs.engine3D.drag-end", this.myBind.onDragEnd, !1), document.removeEventListener("hcs.engine3D.dragging", this.myBind.nDragging, !1)
            }
        },
        onMouseMove: function(t) {
            if (!this.dragging && (this._listeners.leave && this._listeners.leave.length || this._listeners.hover && this._listeners.hover.length)) {
                t.furniture = this.furniture;
                var e = this.furniture;
                t.collided = this.scene.pick(t.mstate.pos.x, t.mstate.pos.y, function(t) {
                    return t.getTopLevelObject(!0) == e
                });
                var n = t.collided && t.collided.pickedMesh;
                !n && this._hover && this.notify("leave", t), n && this.notify("hover", t), this._hover = n
            }
        },
        onRefresh: function(t) {
            t.object == this.furniture && this.notify("refresh", t)
        }
    }, t
}();
var DimensionReshaperComponent3D = function() {
    var t = function(t) {
        BaseComponent3D.call(this, t, "DimensionReshaperComponent3D"), this._listeners = [], this._options || this.setOptions(), this.setOptions({
            roundDimension: .25,
            displayHandleOnResize: !0,
            keepAnimateHandleOnResize: !0
        })
    };
    t.prototype = Object.create(BaseComponent3D.prototype), t.prototype.initBindForThisInstance = function() {
        if (this.myBind)
            return this;
        var t = this;
        this.myBind = {};
        for (var e in this.handlers)
            (function() {
                var n = t.handlers[e];
                t.myBind[e] = function(e) {
                    n.call(t, e)
                }
            })();
        return this
    }, t.prototype.initialize = function() {
        var t = hcsdesign.getComponentByName("MasterReshaperComponent3D");
        if (!t)
            return console.warn("MasterReshaperComponent3D not found, the configurator " + this.name + " components will be disabled.");
        this.master = t, this._options || this.setOptions();
        var e = hcsdesign.getComponentByName("HandlesDisplayerForDimensionReshaperFactoryComponent3D"),
            n = hcsdesign.getComponentByName("BoundingLimitDisplayerForDimensionReshaperFactoryComponent3D"),
            i = hcsdesign.getComponentByName("MesureDisplayerForDimensionReshaperFactoryComponent3D");
        this.displayer = {}, n && (this.displayer.boundingLimit = n.create(this.camera, this.scene, "green")), n && this._options.displayNewBoundingLimit && (this.displayer.boundingLimitNew = n.create(this.camera, this.scene, "yellow")), e && (this.displayer.handles = e.create(this.camera, this.scene)), i && (this.displayer.mesure = i.create(this.camera, this.scene)), this.initBindForThisInstance(), t.on("editionStart", this.myBind.onEditionStart), t.on("editionEnd", this.myBind.onEditionEnd), t.on("dragStart", this.myBind.onDragStart), t.on("dragging", this.myBind.onDragging), t.on("dragEnd", this.myBind.onDragEnd), t.on("refresh", this.myBind.onAfterRefresh), this.displayer.boundingLimit && this._options.displayBoundingLimitOnHover && (t.on("hover", this.myBind.onHover), t.on("leave", this.myBind.onLeave))
    };
    var e = {
        displayHandleOnResize: !0,
        keepAnimateHandleOnResize: !1,
        animateHandleOnHover: !0,
        displayNewBoundingLimit: !0,
        displayBoundingLimitOnHover: !0,
        displayBoundingLimitOnDrag: !0,
        roundDimension: 1,
        debug: !1
    };
    return t.prototype.setOptions = function(t) {
        this._options = this._options || {}, t = t || {};
        for (var n in e)
            this._options[n] = "undefined" == typeof t[n] ? e[n] : t[n];
        return this
    }, t.prototype.askStartResize = function(t, e, n, i) {
        return this._asker && i == this.displayer.handles ? !1 : t && !this._getPropertyName(t, e) ? !1 : this.master.requireHand(this) ? (this._direction = e, this._pickedPoint = n, this._asker = i || this, this.myBind.onDragging(event), !0) : !1
    }, t.prototype.cancelHand = function() {
        this._touchedFace = null, this._direction = null, this._pickedPoint = null, this._asker = null, this.master.releaseHand(this)
    }, t.prototype.computeDimension = function(t, e, n) {
        var i = t.getBoundingBox(),
            o = i.maximum.subtract(i.minimum);
        o.multiplyInPlace(t.scaling, o);
        var r = i.center.clone(),
            s = t.getWorldMatrix();
        BABYLON.Vector3.TransformCoordinatesToRef(r, s, r);
        var a = this.rotationToWorld(t),
            l = new BABYLON.Matrix;
        if (a.toRotationMatrix(l), !e)
            return {
                position: r,
                dimension: o,
                rotationMatrix: l,
                rotationQuat: a
            };
        var h = e.scale(.5 * n);
        BABYLON.Vector3.TransformCoordinatesToRef(h, l, h), h.addInPlace(r);
        var c = e.multiply(e);
        return c.scaleInPlace(n), c.addInPlace(o), {
            position: r,
            dimension: o,
            newPosition: h,
            newDimension: c,
            rotationMatrix: l,
            rotationQuat: a
        }
    }, t.prototype.rotationToWorld = function(t) {
        for (var e = t.getTopLevelObject(), n = new BABYLON.Quaternion(0, 0, 0, 1), i = new BABYLON.Quaternion; t && (BABYLON.Quaternion.RotationYawPitchRollToRef(t.rotation.y, t.rotation.x, t.rotation.z, i), n = i.multiply(n), t != e);)
            t = t.parent;
        return n
    }, t.prototype.getbestAxis = function(t, e, n) {
        n = n || this._direction, e = e || this._pickedPoint || t.position;
        var i = hcsdesign.engine3D,
            o = i.scene.activeCamera,
            r = o.position.subtract(e),
            s = this.computeDimension(t).rotationMatrix.clone();
        s.invert(), BABYLON.Vector3.TransformCoordinatesToRef(r, s, r);
        for (var a = r.multiply(r).asArray(), l = n.asArray(), h = null, c = 3; c--;)
            (null === h || a[c] > a[h]) && Math.abs(l[c]) < .7 && (h = c);
        var u = [0, 0, 0];
        return u[h] = r.asArray()[h] < 0 ? 1 : -1, BABYLON.Vector3.FromArray(u)
    }, t.prototype._getCollider = function() {
        if (this._collider)
            return this._collider;
        this._objectPool = this._objectPool || {};
        var t = this.scene;
        return this._collider = BABYLON.Mesh.CreateBox("boundingboxConfigurator.collider", 1, t)
    }, t.prototype._getTouchedFace = function(t, e) {
        var n = this._getCollider();
        n.isVisible = !0;
        var i = t.pickedMesh,
            o = i.getTopLevelObject(!0),
            r = this.computeDimension(o);
        n.position = r.position, n.scaling = r.dimension, n.rotationQuaternion = r.rotationQuat;
        var s = hcsdesign.engine3D,
            a = s.scene.createPickingRay(e.mstate.pos.x, e.mstate.pos.y),
            l = a.intersectMeshes([n], !0, !0);
        if (this._options.debug || (n.isVisible = !1), !l || !l.hit)
            return null;
        var h = n.getIndices(),
            c = n.getVerticesData(BABYLON.VertexBuffer.NormalKind),
            u = BABYLON.Vector3.FromArray(c, 3 * h[3 * l.faceId]),
            p = s.scene.activeCamera,
            d = p.position.subtract(p.target);
        d.normalize();
        var m = BABYLON.Vector3.TransformNormal(u, n.getWorldMatrix());
        if (m.normalize(), BABYLON.Vector3.Dot(d, m) > .6)
            return null;
        var h = i.getIndices(),
            c = i.getVerticesData(BABYLON.VertexBuffer.NormalKind),
            g = BABYLON.Vector3.FromArray(c, 3 * h[3 * t.faceId]),
            f = BABYLON.Vector3.TransformNormal(g, i.getWorldMatrix());
        return f.normalize(), BABYLON.Vector3.Dot(m, f) < .35 ? null : u
    }, t.prototype._computeL = function(t, e, n, i) {
        var o = this._getCollider();
        o.isVisible = !0;
        var r = this.computeDimension(t);
        o.position = n.clone(), o.rotationQuaternion = r.rotationQuat, o.scaling.x = o.scaling.y = o.scaling.z = 1;
        var s = 9e3,
            a = this.getbestAxis(t, n, e);
        a.multiplyInPlace(a), a.scaleInPlace(-s + .1);
        var l = new BABYLON.Vector3(s, s, s);
        l.addInPlace(a), o.scaling = l, o.markAsDirty();
        var h = hcsdesign.engine3D,
            c = h.scene.createPickingRay(i.mstate.pos.x, i.mstate.pos.y),
            u = c.intersectMeshes([o], !0, !0);
        if (this._options.debug || (o.isVisible = !1), !u || !u.pickedPoint)
            return 0;
        var p = r.rotationMatrix.clone();
        p.invert();
        var d = u.pickedPoint.subtract(n);
        BABYLON.Vector3.TransformCoordinatesToRef(d, p, d);
        var m = BABYLON.Vector3.Dot(d, e);
        return m
    }, t.prototype._getPropertyName = function(t, e) {
        var n = t.structure.programmableInstance.objectName,
            i = t.structure.programmableInstance.params;
        if (Math.abs(e.x) > .9)
            switch (n) {
                case "Bed":
                    return "mattress.width";
                case "Bath":
                case "GlassConsole":
                case "BabylonImporter":
                case "Light":
                    return null;
                case "Tv":
                    return "screen.width";
                case "PhotoFrame":
                case "photoFrame":
                    return "structure.width";
                case "BenchIkea":
                    return "global.width";
                case "spotMultiple":
                    return "tube.width";
                default:
                    return "undefined" != typeof i.width ? "width" : null
            }
        if (Math.abs(e.y) > .9)
            switch (n) {
                case "spotMultiple":
                case "Sofa":
                case "BabylonImporter":
                case "Bed":
                    return null;
                case "BenchIkea":
                    return "feet.height";
                case "PhotoFrame":
                case "photoFrame":
                    return "structure.height";
                case "Tv":
                    return "screen.height";
                case "Shower":
                    return t.structure.programmableInstance.nbWall ? "height" : null;
                case "GlassConsole":
                    return i.bar && "undefined" != typeof i.bar.height ? "bar.height" : null;
                case "Basic":
                    if ("undefined" != typeof t.structure.programmableInstance.horizontal && !t.structure.programmableInstance.horizontal)
                        return null;
                default:
                    return "undefined" != typeof i.height ? "height" : null
            }
        if (Math.abs(e.z) > .9)
            switch (n) {
                case "Bed":
                    return "mattress.length";
                case "PhotoFrame":
                case "photoFrame":
                    return "structure.depth";
                case "BenchIkea":
                    return "plank.depth";
                case "Bath":
                case "BabylonImporter":
                case "GlassConsole":
                case "spotMultiple":
                case "Curtains":
                case "Tv":
                case "TowelDry":
                case "Light":
                    return null;
                case "Basic":
                    if ("undefined" != typeof t.structure.programmableInstance.horizontal)
                        return t.structure.programmableInstance.horizontal ? null : "height";
                default:
                    return "undefined" != typeof i.depth ? "depth" : null
            }
    }, t.prototype._computePropertyValue = function(t, e, n) {
        var i = t.structure,
            o = this.computeDimension(t, e, n),
            r = Math.abs(BABYLON.Vector3.Dot(o.dimension, e)),
            s = Math.abs(BABYLON.Vector3.Dot(o.newDimension, e)),
            a = ujs.setProperty(i.programmableInstance.params, this._getPropertyName(t, e)) || 0,
            l = s - (r - a);
        return l = Math.abs(e.y) > .9 ? Math.max(1, l) : Math.abs(l)
    }, t.prototype._roundL = function(t) {
        return Math.round(t / this._options.roundDimension) * this._options.roundDimension
    }, t.prototype._enlargeYourObject = function(t, e, n) {
        if (!(Math.abs(n) < 1e-4)) {
            var i = t.structure,
                o = hcsdesign.getComponentByName("EditionComponent3D"),
                r = {},
                s = this._getPropertyName(t, e),
                a = this._roundL(this._computePropertyValue(t, e, n));
            r["programmableInstance.params." + s] = {
                newValue: a,
                exValue: ujs.getProperty(i.programmableInstance.params, s)
            }, ujs.setProperty(i.programmableInstance.params, s, a);
            var l = BABYLON.Matrix.RotationYawPitchRoll(t.rotation.y, t.rotation.x, t.rotation.z),
                h = new BABYLON.Vector3(.5 * n * e.x, 0, .5 * n * e.z);
            BABYLON.Vector3.TransformCoordinatesToRef(h, l, h), h.addInPlace(t.position), r.position = {
                newValue: h.clone(),
                exValue: t.position.clone()
            }, t.position.copyFrom(h), o.refreshObject(t, {
                modifiedProperties: r
            }), ujs.notify("hcs.request.saveHistory")
        }
    }, t.prototype.handlers = {
        onDragStart: function(t) {
            t.collided && t.collided.pickedMesh && (this._touchedFace = this._getTouchedFace(t.collided, t), this._touchedFace && (this.displayer.handles && !this._options.keepAnimateHandleOnResize && this.displayer.handles.stopAnimeHandle(), this.displayer.handles && !this._options.displayHandleOnResize && this.displayer.handles.dispose(), this.askStartResize(this.object, this._touchedFace, t.collided.pickedPoint)))
        },
        onDragEnd: function(t) {
            if (this._direction) {
                this.myBind.onDragging(t);
                var e = this._roundL(this._l);
                this._enlargeYourObject(this.object, this._direction, e), this.displayer.boundingLimit && this.displayer.boundingLimit.hide(), this.displayer.boundingLimitNew && this.displayer.boundingLimitNew.hide(), this.displayer.mesure && this.displayer.mesure.hide(), this.displayer.handles && this.displayer.handles.dispose(), this._direction = null, this.master.releaseHand(this)
            }
        },
        onDragging: function(t) {
            if (this._direction) {
                this._l = this._computeL(this.object, this._direction, this._pickedPoint, t);
                var e = this._roundL(this._l);
                this.displayer.boundingLimit && this._options.displayBoundingLimitOnDrag && this.displayer.boundingLimit.display(this.object, this._direction, 0), this.displayer.boundingLimitNew && this._options.displayBoundingLimitOnDrag && this.displayer.boundingLimitNew.display(this.object, this._direction, e), this.displayer.handles && this._options.displayHandleOnResize && this.displayer.handles.placeHandleOnObject(this.object, this._direction, e), this.displayer.mesure && this.displayer.mesure.display(this.object, this._direction, this._pickedPoint, e)
            }
        },
        onHover: function(t) {
            return this._touchedFace = this._getTouchedFace(t.collided, t), this._touchedFace && this._getPropertyName(this.object, this._touchedFace) && this.master.requireHand(this) ? (this.displayer.boundingLimit && this._options.displayBoundingLimitOnHover && this.displayer.boundingLimit.display(this.object, this._touchedFace), this.displayer.handles && this._options.animateHandleOnHover && (this._previousHoverFace && BABYLON.Vector3.Dot(this._previousHoverFace, this._touchedFace) < .9 && this.displayer.handles.stopAnimeHandle(), this.displayer.handles.startAnimeHandle(this._touchedFace)), void(this._previousHoverFace = this._touchedFace)) : this.myBind.onLeave(t)
        },
        onLeave: function() {
            this.displayer.boundingLimit.hide(), this.displayer.handles && this.displayer.handles.stopAnimeHandle(), this._previousHoverFace = this._touchedFace = null, this.master.releaseHand(this)
        },
        onAfterRefresh: function() {
            this.displayer.handles && this.displayer.handles.start(this.object)
        },
        onEditionStart: function(t) {
            this.object = t.furniture, this.displayer.handles && this.displayer.handles.start(this.object)
        },
        onEditionEnd: function() {
            this.displayer.handles && this.displayer.handles.stop(), this.displayer.boundingLimit && this.displayer.boundingLimit.hide(), this.displayer.boundingLimitNew && this.displayer.boundingLimitNew.hide(), this.displayer.mesure && this.displayer.mesure.hide(), this._direction = null, this.master.releaseHand(this), this.object = null
        }
    }, t
}();
var HandlesDisplayerForDimensionReshaperFactoryComponent3D = function() {
    var t = function(t) {
        BaseComponent3D.call(this, t, "HandlesDisplayerForDimensionReshaperFactoryComponent3D")
    };
    t.prototype = new BaseComponent3D, t.prototype.create = function(t, n) {
        var i = new e;
        return i.initialize(t, n), i
    };
    var e = function() {};
    return e.prototype.initialize = function(t, e) {
        this.scene = e, this.camera = t, this.dimensionConfigurator = hcsdesign.getComponentByName("DimensionReshaperComponent3D"), this._spriteManager = new BABYLON.SpriteManager("handleMgr", hcs.Assets.toolbarTextures.arrowTexture, 6, 128, this.scene), this._sprite = {}, this._animated = {}, this._availableHandles = {}, this.initBindForThisInstance()
    }, e.prototype.initBindForThisInstance = function() {
        if (this.myBind)
            return this;
        var t = this;
        this.myBind = {};
        for (var e in this.handlers)
            (function() {
                var n = t.handlers[e];
                t.myBind[e] = function(e) {
                    n.call(t, e)
                }
            })();
        return this
    }, e.prototype.start = function(t) {
        this.stop(), this.object = t, this._computeAvailableHandles(t), document.addEventListener("hcs.engine3D.camera.move", this.myBind.onCameraMove), document.addEventListener("hcs.engine3D.drag-start", this.myBind.onMouseDown), this.myBind.onCameraMove()
    }, e.prototype.stop = function() {
        document.removeEventListener("hcs.engine3D.camera.move", this.myBind.onCameraMove), document.removeEventListener("hcs.engine3D.drag-start", this.myBind.onMouseDown), this.dispose()
    }, e.prototype.startAnimeHandle = function(t) {
        var e = 2 * Math.abs(t.y) + 4 * Math.abs(t.z) + (t.x + t.z + t.y < 0 ? 0 : 1);
        if (!this._animated[e]) {
            var n = this.scene;
            n.beginAnimation(this._getHandle(e), 0, 100, !0, 3), this._animated[e] = !0
        }
    }, e.prototype.stopAnimeHandle = function(t) {
        if (t) {
            var e;
            if (e = "string" == typeof t ? t : 2 * Math.abs(t.y) + 4 * Math.abs(t.z) + (t.x + t.z + t.y < 0 ? 0 : 1), this._sprite[e] && this._animated[e]) {
                var n = this.scene;
                n.stopAnimation(this._sprite[e]), this._animated[e] = !1, this._sprite[e].animations && this._sprite[e].animations.length && this._sprite[e].position.copyFrom(this._sprite[e].animations[0]._keys[0].value)
            }
        } else
            for (var i in this._sprite)
                this.stopAnimeHandle(i + "")
    }, e.prototype.placeHandleOnObject = function(t, e, n) {
        var i = this.dimensionConfigurator.computeDimension(t, e || new BABYLON.Vector3(0, 0, 0), n || 0);
        return this.placeHandles(i.newPosition, i.newDimension, i.rotationMatrix)
    }, e.prototype.placeHandles = function(t, e, n) {
        var i = this.camera,
            o = new BABYLON.Vector3,
            r = new BABYLON.Vector3,
            s = new BABYLON.Vector3,
            a = i.getViewMatrix().clone();
        a.m[12] = a.m[13] = a.m[14] = 0;
        for (var l = i.position.subtract(i.target).normalize(), h = 15, c = 0; 6 > c; c++)
            if (2 != c && this._availableHandles[c]) {
                var u = [0, 0, 0];
                if (u[c >> 1] = c % 2 ? 1 : -1, BABYLON.Vector3.FromArrayToRef(u, 0, o), BABYLON.Vector3.TransformCoordinatesToRef(o, n, s), Math.abs(BABYLON.Vector3.Dot(s, l)) < .6) {
                    r.x = o.x * (.5 * e.x + h), r.y = o.y * (.5 * e.y + h), r.z = o.z * (.5 * e.z + h), BABYLON.Vector3.TransformCoordinatesToRef(r, n, r), r.addInPlace(t);
                    var p = this._getHandle(c + "", r, s);
                    p.position.copyFrom(r), BABYLON.Vector3.TransformCoordinatesToRef(s, a, o), p.angle = Math.atan2(o.y, o.x)
                } else
                    this._disposeHandle(c + "")
            }
    }, e.prototype.dispose = function() {
        this._disposeHandle()
    }, e.prototype._disposeHandle = function(t) {
        if ("undefined" != typeof t)
            this._sprite[t] && (this.stopAnimeHandle(t), this._sprite[t].dispose(), this._sprite[t] = null);
        else
            for (var e in this._sprite)
                this._disposeHandle(e)
    }, e.prototype._getHandle = function(t, e, n) {
        if (this._sprite[t])
            return this._sprite[t];
        this.scene;
        if (this._sprite[t] = new BABYLON.Sprite("handle_" + t, this._spriteManager), this._sprite[t].size = 20, e && n) {
            var i = new BABYLON.Animation("jump_handle_animation", "position", 60, BABYLON.Animation.ANIMATIONTYPE_VECTOR3, BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE),
                o = e.clone(),
                r = n.scale(10);
            r.addInPlace(o), i.setKeys([{
                frame: 0,
                value: o
            }, {
                frame: 50,
                value: r
            }, {
                frame: 100,
                value: o
            }]), this._sprite[t].animations = this._sprite[t].animations || [], this._sprite[t].animations.push(i)
        }
        return this._sprite[t]
    }, e.prototype._computeAvailableHandles = function(t) {
        this._availableHandles = {};
        for (var e = new BABYLON.Vector3, n = 0; 6 > n; n++)
            if (2 != n) {
                var i = [0, 0, 0];
                i[n >> 1] = n % 2 ? 1 : -1, BABYLON.Vector3.FromArrayToRef(i, 0, e), this._availableHandles[n] = !!this.dimensionConfigurator._getPropertyName(t, e)
            }
    }, e.prototype.handlers = {
        onCameraMove: function() {
            var t = this.object;
            this.placeHandleOnObject(t)
        },
        onMouseDown: function(t) {
            var e = [];
            for (var n in this._sprite || {})
                this._sprite[n] && e.push(this._sprite[n]._colliderMesh);
            var i = hcsdesign.engine3D,
                o = i.scene.createPickingRay(t.mstate.pos.x, t.mstate.pos.y),
                r = o.intersectMeshes(e, !0, !0);
            if (r && r.pickedMesh) {
                var n = parseInt(r.pickedMesh.name.match(/[0-9]*$/)[0]),
                    s = [0, 0, 0];
                s[n >> 1] = n % 2 ? 1 : -1, this.dimensionConfigurator.askStartResize(this.object, BABYLON.Vector3.FromArray(s), r.pickedMesh.position.clone(), this)
            }
        }
    }, t
}();
var BoundingLimitDisplayerForDimensionReshaperFactoryComponent3D = function() {
    var t = function(t) {
        BaseComponent3D.call(this, t, "BoundingLimitDisplayerForDimensionReshaperFactoryComponent3D")
    };
    t.prototype = new BaseComponent3D, t.prototype.create = function(t, n, i) {
        var o = new e;
        return o.initialize(t, n, i), o
    };
    var e = function() {};
    return e.prototype.initialize = function(t, e, n) {
        if (this.scene = e, this.camera = t, this.dimensionConfigurator = hcsdesign.getComponentByName("DimensionReshaperComponent3D"), "undefined" == typeof n && (n = "green"), "string" == typeof n) {
            var i, o = new BABYLON.StandardMaterial("texture_dimension_configurator_placeholder", e);
            switch (n) {
                case "yellow":
                    i = (new BABYLON.Color3).fromHex(hcs.Assets.complementaryUIColor);
                    break;
                default:
                    i = (new BABYLON.Color3).fromHex(hcs.Assets.mainUIColor)
            }
            hcs.MaterialFactory.MakeBasicColor(o, i), o.backFaceCulling = !1, o.alpha = .6, n = o
        }
        return this.mat = n, this
    }, e.prototype._getBoundingLimitGhost = function() {
        if (this._boundingLimitGhost)
            return this._boundingLimitGhost;
        var t = this.scene;
        return this._boundingLimitGhost = BABYLON.Mesh.CreateBox("boundingboxConfigurator.boundingLimitGhost", 1, t), this._boundingLimitGhost.material = this.mat, this._boundingLimitGhost
    }, e.prototype.display = function(t, e, n) {
        n = n || 0;
        var i = this._getBoundingLimitGhost();
        i.isVisible = !0;
        var o = this.dimensionConfigurator.computeDimension(t);
        o.dimension.scaleInPlace(1.01), i.position = o.position, i.rotationQuaternion = o.rotationQuat, i.scaling = o.dimension;
        var r = .5,
            s = new BABYLON.Vector3(.5 * r + .5 * o.dimension.x + n, .5 * r + .5 * o.dimension.y + n, .5 * r + .5 * o.dimension.z + n);
        s.multiplyInPlace(e), BABYLON.Vector3.TransformCoordinatesToRef(s, o.rotationMatrix, s), i.position.addInPlace(s);
        var a = new BABYLON.Vector3(r - o.dimension.x, r - o.dimension.y, r - o.dimension.z);
        a.multiplyInPlace(e), a.multiplyInPlace(e), i.scaling.addInPlace(a), i.markAsDirty()
    }, e.prototype.hide = function() {
        var t = this._getBoundingLimitGhost();
        t.isVisible = !1
    }, e.prototype.dispose = function() {
        this._boundingLimitGhost.remove(), this._boundingLimitGhost = null
    }, t
}();
var MesureDisplayerForDimensionReshaperFactoryComponent3D = function() {
    var t = function(t) {
        BaseComponent3D.call(this, t, "MesureDisplayerForDimensionReshaperFactoryComponent3D")
    };
    t.prototype = new BaseComponent3D, t.prototype.create = function(t, n) {
        var i = new e;
        return i.initialize(t, n), i
    };
    var e = function() {};
    return e.prototype.initialize = function(t, e) {
        return this.camera = t, this.scene = e, this.dimensionConfigurator = hcsdesign.getComponentByName("DimensionReshaperComponent3D"), this
    }, e.prototype.hide = function() {
        this._cote && (this._cote.plan.isVisible = !1)
    }, e.prototype.dispose = function() {
        this._cote.plan.dispose(), this._cote.texture.dispose(), this._cote = null
    }, e.prototype.display = function(t, e, n, i) {
        var o = this._getCote();
        o.plan.isVisible = !0;
        var r = this.dimensionConfigurator.computeDimension(t, e, i),
            s = this.dimensionConfigurator.getbestAxis(t, n, e),
            a = e.clone(),
            l = BABYLON.Vector3.Cross(s, a),
            h = hcsdesign.engine3D,
            c = h.scene.activeCamera,
            u = c.target.subtract(c.position),
            p = BABYLON.Vector3.TransformCoordinates(l, r.rotationMatrix);
        BABYLON.Vector3.Dot(p, u) > 0 && l.scaleInPlace(-1), p = BABYLON.Vector3.TransformCoordinates(l, r.rotationMatrix);
        var d = (BABYLON.Vector3.TransformCoordinates(a, r.rotationMatrix), BABYLON.Quaternion.RotationFromXtoX_2(new BABYLON.Vector3(0, 1, 0), l, new BABYLON.Vector3(0, 0, 1), s)),
            m = r.rotationQuat,
            g = m.multiply(d);
        o.plan.rotationQuaternion = g;
        var f = c.getViewMatrix().clone();
        f.m[12] = f.m[13] = f.m[14] = 0;
        var y = BABYLON.Vector3.TransformCoordinates(p, f);
        Math.abs(y.x) > Math.abs(y.y) ? y.y = 0 : y.x = 0;
        var _ = (Math.floor(Math.atan2(y.y, y.x) / (Math.PI / 2)) + 3) % 4,
            v = Math.abs(r.newDimension.dot(a));
        v = this.dimensionConfigurator._roundL(v), this._writeCote(v, _, u.length()), o.plan.position = r.newPosition.clone();
        var b = new BABYLON.Vector3(.5 * r.newDimension.x + .5 * o.plan.scaling.y, .5 * r.newDimension.y + .5 * o.plan.scaling.y, .5 * r.newDimension.z + .5 * o.plan.scaling.y).multiply(l);
        BABYLON.Vector3.TransformCoordinatesToRef(b, r.rotationMatrix, b), o.plan.position.addInPlace(b);
        var w = r.rotationMatrix.clone();
        w.invert();
        var x = n.subtract(r.newPosition);
        BABYLON.Vector3.TransformCoordinatesToRef(x, w, x), x = x.multiply(s).multiply(s), BABYLON.Vector3.TransformCoordinatesToRef(x, r.rotationMatrix, x), o.plan.position.addInPlace(x)
    }, e.prototype._resizeAndComputeRatio = function(t, e) {
        var n = this._getCote(),
            i = n.texture.getSize(),
            o = Math.min(i.width / t, i.height / e);
        return n.plan.scaling.x = i.width / o, n.plan.scaling.y = n.plan.scaling.x * i.height / i.width, o
    }, e.prototype._getCote = function() {
        if (this._cote)
            return this._cote;
        var t = this.scene,
            e = BABYLON.Mesh.CreatePlane("cote_plan", 1, t);
        e.scaling.x = 1e3, e.scaling.y = 1e3;
        var n = new BABYLON.StandardMaterial("cote_texture", t);
        hcsdesign.engine3D.scene.getEngine().getCaps().maxAnisotropy = 128;
        var i = new BABYLON.DynamicTexture("cote_texture", {
            width: 512,
            height: 256
        }, t, !0);
        return i.hasAlpha = !0, n.diffuseTexture = i, n.useAlphaFromDiffuseTexture = !0, e.material = n, this._cote = {
            texture: i,
            plan: e
        }
    }, e.prototype._writeCote = function(t, e, n) {
        var i = this._getCote(),
            o = i.texture.getContext();
        o.save();
        var r = .5,
            s = .08,
            a = 1.65,
            l = .3,
            h = 4 * (2 + n / 300),
            c = !1,
            u = i.texture.getSize(),
            p = (Math.round(t) + " cm").replace(/\d/g, "0");
        o.font = "normal " + 1e3 * r + "pt calibri";
        var d = o.measureText(p).width / 1e3;
        o.font = "normal " + 700 * r + "pt calibri", d += o.measureText(".00").width / 1e3, c = (e % 2 == 0 ? d : 2 * r) * h > t - 2 * l * h;
        var m = h * ((c ? 1.5 * r : 0) + (e % 2 == 1 ? d + a : a + 2 * r)),
            g = this._resizeAndComputeRatio(t, m);
        2 * l * h > .6 * t && (l *= .6 * t / (2 * l * h)), o.save(), o.clearRect(0, 0, u.width, u.height), o.lineWidth = s * h * g, o.strokeStyle = "#000000", o.fillStyle = "#000000", o.font = "normal " + r * h * g + "pt calibri", d *= g * h;
        var f = e % 2 == 1 ? r * h * g * 1.4 : 1.01 * d,
            y = u.height - a * h * g - r * g * h,
            _ = .5 * u.width - .5 * t * g + s * h * g,
            v = .5 * u.width + .5 * t * g - s * h * g;
        c ? (o.beginPath(), o.moveTo(_, y), o.lineTo(v, y), o.stroke()) : (o.beginPath(), o.moveTo(_, y), o.lineTo((_ + v) / 2 - f / 2, y), o.stroke(), o.beginPath(), o.moveTo(v, y), o.lineTo((_ + v) / 2 + f / 2, y), o.stroke()), o.beginPath(), o.moveTo(_ + l * g * h, y + l * g * h), o.lineTo(_, y), o.lineTo(_ + l * g * h, y - l * g * h), o.stroke(), o.beginPath(), o.moveTo(v - l * g * h, y + l * g * h), o.lineTo(v, y), o.lineTo(v - l * g * h, y - l * g * h), o.stroke(), o.globalAlpha = .7, o.lineWidth = .5 * s * h * g, o.beginPath(), o.moveTo(_ - .5 * s * h * g, y + .1 * (u.height - y)), o.lineTo(_ - .5 * s * h * g, y + .9 * (u.height - y)), o.stroke(), o.lineWidth = .5 * s * h * g, o.beginPath(), o.moveTo(v + .5 * s * h * g, y + .1 * (u.height - y)), o.lineTo(v + .5 * s * h * g, y + .9 * (u.height - y)), o.stroke(), o.globalAlpha = 1;
        var b = e * Math.PI / 2;
        o.translate((_ + v) / 2, y - (c ? r * h * g * 1.5 : 0)), o.rotate(b), 1 == e && o.translate(r * h * g - d / 2, 0), 3 == e && o.translate(-r * h * g + d / 2, 0), o.translate(-d / 2, r * h * g * .5);
        var w = (t >> 0) + "";
        o.fillText(w, 0, 0), o.translate(o.measureText(w).width, 0);
        var w = "." + Math.floor(t % 1 * 100);
        w = 2 == w.length ? w + "0" : w, o.font = "normal " + r * h * g * .7 + "pt calibri", o.fillText(w, 0, 0), o.translate(o.measureText(w).width, 0);
        var w = " cm";
        o.font = "normal " + r * h * g + "pt calibri", o.fillText(w, 0, 0), o.restore(), i.texture.update()
    }, t
}();
var MagnetismComponent2D = function() {
    var t = function(t) {
        BaseComponent2D.call(this, t, "MagnetismComponent2D"), this.priority = 100, this._precision = 10, this._draggedWall = null, this._magnetism = [], this._wallCandidates = [], this._wallFirstPoint = null, this._virtualPoints = {}, this.core.engine2D.registerEventCb("MagnetismComponent2D.dynamic-draw", 0, "dynamic-draw", 255 - this.core.engine2D.MODE_CONTEXTMENU - this.core.engine2D.MODE_NORMAL, null, this.onDynamicDraw.bind(this), null), this.core.engine2D.registerEventCb("MagnetismComponent2D.point-mag.mouse-move", this.priority, "mouse-move", null, null, this.onPointMagMove.bind(this), null), this.core.engine2D.registerEventCb("MagnetismComponent2D.point-mag.drag-start", this.priority, "drag-start", null, null, this.onPointMagDragStart.bind(this), null), this.core.engine2D.registerEventCb("MagnetismComponent2D.point-mag.click", this.priority, "click", null, null, this.onPointMagClick.bind(this), null), this.core.engine2D.registerEventCb("MagnetismComponent2D.wall-mag.drag-start", this.priority, "drag-start", null, null, this.onWallMagDragStart.bind(this), null)
    };
    return t.prototype = new BaseComponent2D, t.prototype.addVirtualPoint = function(t, e) {
        if (this._virtualPoints[t] || (this._virtualPoints[t] = []), e instanceof PointStructure)
            return this._virtualPoints[t].push(e), this._virtualPoints[t].length - 1;
        if (e instanceof BABYLON.Vector2) {
            var n = new PointStructure;
            return n.position = e, this._virtualPoints[t].push(n), this._virtualPoints[t].length - 1
        }
        Logger.error("Error: MagnetismComponent2D.addVirtualPoint: `point` is neither a `PointStructure` neither a `BABYLON.Vector3`.")
    }, t.prototype.removeVirtualPoint = function(t, e) {
        this._virtualPoints[t] && (null == e ? this._virtualPoints[t].length = 0 : delete this._virtualPoints[t][e])
    }, t.prototype.applyPointMag = function(t) {
        this._magFromPoint(t)
    }, t.prototype._shortCircuitMagnetism = function(t) {
        return (t.modifiers & t.MODIFIER_CTRL) > 1 ? !0 : !1
    }, t.prototype._magFromPoint = function(t, e) {
        if (!this._shortCircuitMagnetism(t)) {
            var n = (this.core.engine2D.getTranslation(), this.core.engine2D.getZoom()),
                i = this._precision / Math.sqrt(n),
                o = this.structure.getCurrentStructure().getElements("points").slice(0);
            for (var r in this._virtualPoints)
                if (this._virtualPoints[r].constructor === Array)
                    for (var s in this._virtualPoints[r])
                        o.push(this._virtualPoints[r][s]);
            var a = !1,
                l = !1;
            for (var s in o) {
                if (e instanceof PointStructure) {
                    if (o[s] == e)
                        continue;
                    var h = !1;
                    for (var c in e.parents)
                        if (!h && e.parents[c] instanceof WallStructure && e.parents[c].attachedPoints)
                            for (var u in e.parents[c].attachedPoints)
                                if (e.parents[c].attachedPoints[u] == o[s]) {
                                    h = !0;
                                    break
                                }
                    if (h)
                        continue
                }
                if ((!a && Math.abs(o[s].position.x - t.planPos.x) <= i || a && Math.abs(o[s].position.x - t.planPos.x) < 1) && (t.planPos.x = o[s].position.x, this._magnetism.push([o[s].position, t.planPos]), a = !0), (!l && Math.abs(o[s].position.y - t.planPos.y) <= i || l && Math.abs(o[s].position.y - t.planPos.y) < 1) && (t.planPos.y = o[s].position.y, this._magnetism.push([o[s].position, t.planPos]), l = !0), a && l)
                    break
            }
            this.core.engine2D.requestDynamicDraw()
        }
    }, t.prototype._globalWallMag = function(t, e) {
        var n, i, o = Math.PI / 150,
            r = 30,
            s = this.structure.getCurrentStructure().getElements("walls"),
            a = new BABYLON.Vector2,
            l = t.getWallVector().normalize(),
            h = e.planPos.clone();
        h.subtractInPlace(t.getPoints(0).position);
        for (var c = h.clone().projectOnVector(l), u = h.subtractInPlace(c), p = t.getPoints(0).position.add(u), d = (t.getPoints(1).position.add(u), function(t, e) {
                return e ? a.copyFrom(t).addInPlace(e).subtractInPlace(p).normalize() : a.copyFrom(t).subtractInPlace(p).normalize(), n = a.determinant(l), Math.abs(n) < o
            }), m = function(t, e) {
                var n = Math.PI / 100,
                    i = t.getWallVector(),
                    o = e.getWallVector(),
                    r = Math.atan(i.y, i.x) - Math.atan(o.y, o.x);
                return Math.abs(r) < n || Math.abs(r + Math.PI) < n || Math.abs(r - Math.PI) < n || Math.abs(r + 2 * Math.PI) < n || Math.abs(r - 2 * Math.PI) < n
            }, g = function(n, i) {
                var o = n.getWallVector(),
                    s = t.getNormalVector(),
                    a = i ? t.getPoints(0).position.add(i) : t.getPoints(0).position.clone(),
                    l = (o.determinant(n.getPoints(0).position) - o.determinant(a)) / o.determinant(s);
                return s.scaleInPlace(l), Math.abs(l) < r ? (e.forcePosition = i ? s.add(a).addInPlace(i) : s.add(a), !0) : !1
            }.bind(this), f = 0, y = s.length; y > f; f++)
            if (s[f] != t && m(s[f], t)) {
                if ((d(s[f].getPoints(0).position) || d(s[f].getPoints(1).position)) && g(s[f]))
                    return;
                if (s[f].thickness > t.thickness) {
                    if (i = s[f].getNormalVector((s[f].thickness - t.thickness) / 2), (d(s[f].getPoints(0).position, i) || d(s[f].getPoints(1).position, i)) && g(s[f], i))
                        return;
                    if (i.scaleInPlace(-1), (d(s[f].getPoints(0).position, i) || d(s[f].getPoints(1).position, i)) && g(s[f], i))
                        return
                }
            }
    }, t.prototype._magFromWalls = function(t, e) {
        var n = Math.PI / 18;
        if (!this._shortCircuitMagnetism(t) && this._wallFirstPoint) {
            for (var i, o = (this.core.engine2D.getTranslation(), this.core.engine2D.getZoom()), r = (this._precision / Math.sqrt(o), e || this.structure.getCurrentStructure().getElements("walls"), t.planPos.x - this._wallFirstPoint.x), s = t.planPos.y - this._wallFirstPoint.y, a = Math.atan2(s, r), l = 0, h = this._wallCandidates.length; h > l; l++)
                if (i = Math.abs(this._wallCandidates[l].angle - a) % (Math.PI / 2), n > i || Math.PI / 2 - i < n) {
                    var c;
                    i = Math.abs((this._wallCandidates[l].angle - a) % Math.PI), c = i < Math.PI / 4 || i > 3 * Math.PI / 4 ? 0 : Math.PI / 2, c += this._wallCandidates[l].angle;
                    var u = Math.cos(c),
                        p = Math.sin(c),
                        d = new BABYLON.Vector2(u, p),
                        m = new BABYLON.Vector2(r, s),
                        g = m.clone().projectOnVector(d);
                    t.planPos.copyFrom(g).addInPlace(this._wallFirstPoint);
                    break
                }
            this.core.engine2D.requestDynamicDraw()
        }
    }, t.prototype.onDynamicDraw = function(t, e, n) {
        t.lineWidth = 2, t.strokeStyle = "#009900";
        for (var i in this._magnetism) {
            var o = this._magnetism[i][0].scale(n).addInPlace(e),
                r = this._magnetism[i][1].scale(n).addInPlace(e);
            t.beginPath(), t.moveTo(Math.round(o.x), Math.round(o.y)), t.lineTo(Math.round(r.x), Math.round(r.y)), t.stroke(), t.closePath()
        }
        this._magnetism = []
    }, t.prototype.onPointMagMove = function(t, e, n) {
        this.core.engine2D.getMode() == this.core.engine2D.MODE_DRAW && (this._magFromPoint(n), this._magFromWalls(n))
    }, t.prototype.onPointMagDragStart = function(t, e, n, i) {
        (e instanceof PointStructure || this.core.engine2D.getMode() == this.core.engine2D.MODE_DRAW) && (this.onPointMagClick(t, e, n, i), this.core.engine2D.registerEventCb("MagnetismComponent2D.point-mag.draging", this.priority, "dragging", this.core.engine2D.MODE_DRAG, null, this.onPointMagDragging.bind(this), e), this.core.engine2D.registerEventCb("MagnetismComponent2D.point-mag.drag-end", this.priority, "drag-end", this.core.engine2D.MODE_DRAG, null, this.onPointMagClick.bind(this), e))
    }, t.prototype.onPointMagDragging = function(t, e, n, i) {
        this._magFromPoint(n, i), this._magFromWalls(n, i)
    }, t.prototype.onPointMagClick = function(t, e, n) {
        if (e instanceof PointStructure)
            this._magFromPoint(n, e), this._magFromWalls(n);
        else {
            if (e instanceof WallStructure && this.core.engine2D.getMode() == this.core.engine2D.MODE_NORMAL)
                return;
            this._magFromPoint(n), this._magFromWalls(n)
        }
    }, t.prototype.onWallMagDragStart = function(t, e) {
        return e instanceof WallStructure ? (this.core.engine2D.registerEventCb("MagnetismComponent2D.wall-mag.dragging", this.priority, "dragging", null, null, this.onWallMagDragging.bind(this), null), void(this._draggedWall = e)) : void(this._draggedWall = null)
    }, t.prototype.onWallMagDragging = function(t, e, n) {
        this._draggedWall && this._globalWallMag(this._draggedWall, n)
    }, t.prototype.onWallDrawStart = function(t) {
        var e = this.structure.getCurrentStructure().getElements("walls"),
            n = 15;
        this._wallCandidates.length = 0, this._wallFirstPoint = t.position;
        for (var i = 0, o = e.length; o > i; i++)
            if (e[i].distanceFrom(this._wallFirstPoint) < n) {
                var r = e[i].getWallVector();
                this._wallCandidates.push({
                    wall: e[i],
                    angle: Math.atan2(r.y, r.x)
                })
            }
    }, t.prototype.onWallDrawEnd = function() {
        this._wallFirstPoint = null
    }, t
}();
var MagnetismComponent3D = function() {
    var t, e, n = !1,
        i = function(n) {
            BaseComponent3D.call(this, n, "MagnetismComponent3D"), this._lastPosition = new BABYLON.Vector3, this._lastFictivePosition = new BABYLON.Vector3, this._speedVector = new BABYLON.Vector3, this._physicSpeedVector = new BABYLON.Vector3, this._correctedSpeedVector = new BABYLON.Vector3, this._tmpVector = new BABYLON.Vector3, e = hcsdesign.engine3D.searchComponent("EditionComponent3D"), t = this, this.collisionList = [], this.currentCollisionBox = null
        },
        o = .1,
        r = function(t, e) {
            if (e) {
                {
                    t.getWorldMatrix()
                }
                this.box = new BABYLON.BoundingBox(e.minimum, e.maximum), this.box.angle = e.angle
            } else {
                var n = t.getBoundingBox(!0);
                this.box = new BABYLON.BoundingBox(n.minimum, n.maximum)
            }
            this.object = t, t.structure && (this.object.magnetismCollider = t.structure.magnetismCollider), this.corner = [new BABYLON.Vector3, new BABYLON.Vector3, new BABYLON.Vector3, new BABYLON.Vector3], this.axis = [new BABYLON.Vector3, new BABYLON.Vector3], this.origin = [0, 0], this.yRange = [0, 0], this.object.structure && this.object.structure.easeMagnetism && this.correctSmallBoxes(), this.update()
        },
        s = [];
    r.prototype.showBox = function() {
        if (!this._debugCube) {
            var t = hcsdesign.engine3D.scene;
            this._debugCube = BABYLON.Mesh.CreateBox("boundingboxConfigurator.boundingLimitGhost", 1, t), this._debugCube.material = new BABYLON.StandardMaterial("BB_debug", t), this._debugCube.material.wireframe = !0, this._debugCube.material.alpha = .29, s.push(this._debugCube)
        }
        for (var e = this._debugCube, n = new BABYLON.Vector3(0, 0, 0), i = 4; i--;)
            n.addInPlace(this.corner[i]);
        n.scaleInPlace(.25), n.y = (this.yRange[1] + this.yRange[0]) / 2;
        var o = this.corner[0].subtract(this.corner[1]),
            r = this.corner[2].subtract(this.corner[1]);
        e.position.copyFrom(n), e.scaling.x = o.length(), e.scaling.z = r.length(), e.scaling.y = this.yRange[1] - this.yRange[0], e.rotation.y = -Math.atan2(o.z, o.x)
    }, r.prototype.correctSmallBoxes = function() {
        var t = this.object.structure.preferredYAngle || 0,
            e = new BABYLON.Vector3(0, 0, 1);
        e = BABYLON.Vector3.TransformCoordinates(e, BABYLON.Matrix.RotationAxis(new BABYLON.Vector3(0, 1, 0), t)), e.scaleInPlace(80), this.corner[0].copyFromFloats(this.box.minimum.x, this.box.minimum.y, this.box.minimum.z), this.corner[1].copyFromFloats(this.box.maximum.x, this.box.minimum.y, this.box.minimum.z), this.corner[2].copyFromFloats(this.box.maximum.x, this.box.minimum.y, this.box.maximum.z), this.corner[3].copyFromFloats(this.box.minimum.x, this.box.minimum.y, this.box.maximum.z);
        for (var n = 0; 4 > n; n++)
            this.corner[n].addInPlace(e), BABYLON.BoundingBox.ExpandFromPoint(this.corner[n], this.box.minimum, this.box.maximum)
    }, r.prototype.update = function() {
        if (this.object.computeWorldMatrix(!0), BABYLON.Vector3.TransformCoordinatesFromFloatsToRef(this.box.minimum.x, this.box.minimum.y, this.box.minimum.z, this.object.getWorldMatrix(), this.corner[0]), BABYLON.Vector3.TransformCoordinatesFromFloatsToRef(this.box.maximum.x, this.box.minimum.y, this.box.minimum.z, this.object.getWorldMatrix(), this.corner[1]), BABYLON.Vector3.TransformCoordinatesFromFloatsToRef(this.box.maximum.x, this.box.minimum.y, this.box.maximum.z, this.object.getWorldMatrix(), this.corner[2]), BABYLON.Vector3.TransformCoordinatesFromFloatsToRef(this.box.minimum.x, this.box.minimum.y, this.box.maximum.z, this.object.getWorldMatrix(), this.corner[3]), this.box.angle) {
            var t = -this.box.angle,
                e = this.box.center;
            e.y = 0;
            for (var i = BABYLON.Matrix.FromValues(Math.cos(t), 0, Math.sin(t), 0, 0, 1, 0, 0, -Math.sin(t), 0, Math.cos(t), 0, 0, 0, 0, 1), o = 0; 4 > o; o++)
                this.corner[o].subtractInPlace(e), BABYLON.Vector3.TransformCoordinatesToRef(this.corner[o], i, this.corner[o]), this.corner[o].addInPlace(e)
        }
        this.axis[0].copyFrom(this.corner[1]), this.axis[0].subtractInPlace(this.corner[0]), this.axis[1].copyFrom(this.corner[3]), this.axis[1].subtractInPlace(this.corner[0]);
        for (var o = 0; 2 > o; o++)
            0 == this.axis[o].lengthSquared() && (this.axis[o].copyFrom(this.axis[(o + 1) % 2].cross(new BABYLON.Vector3(0, 1, 0))), this.axis[o].normalize().scaleInPlace(.1));
        for (var r, o = 0; 2 > o; o++)
            r = this.axis[o].lengthSquared(), 0 != r ? this.axis[o].scaleInPlace(1 / r) : this.axis[o] = new BABYLON.Vector3(0, 0, 0), this.origin[o] = this.corner[0].dot(this.axis[o]);
        this.yRange = [BABYLON.Vector3.TransformCoordinates(this.box.minimum, this.object.getWorldMatrix()).y, BABYLON.Vector3.TransformCoordinates(this.box.maximum, this.object.getWorldMatrix()).y], n && this.showBox()
    }, r.prototype.overlaps1Way = function(t, e, n) {
        for (var i, r, s, a = +1 / 0, l = 0, h = null, c = 0; 2 > c; c++) {
            n && (s = n.dot(this.axis[c]));
            for (var u = t.corner[0].dot(this.axis[c]), p = 1 / this.axis[c].length(), d = u, m = u, g = 1; 4 > g; g++)
                u = t.corner[g].dot(this.axis[c]), d > u ? d = u : u > m && (m = u);
            if (d > 1 + this.origin[c] || m < this.origin[c])
                return !1;
            i = (this.origin[c] + 1 - d) * p, r = (m - this.origin[c]) * p, l = n && Math.abs(s) > o ? s > 0 ? i : -r : i > r ? -r : i, Math.abs(l) < Math.abs(a) && (h = this.axis[c], a = l)
        }
        return e && (e.overlapAxis = h, e.overlapValue = a), !0
    }, r.prototype.overlaps = function(t) {
        return this.overlaps1Way(t) && t.overlaps1Way(this)
    }, r.prototype.worstOverlap = function(t, e) {
        var n = {},
            i = {},
            o = this.overlaps1Way(t, n, e),
            r = t.overlaps1Way(this, i, e ? e.clone().scaleInPlace(-1) : null);
        return o || r ? Math.abs(n.overlapValue) < Math.abs(i.overlapValue) ? n : (i.overlapValue = -i.overlapValue, i) : null
    };
    var a = function(t, e) {
        var n = 9999;
        this.box = {
            minimum: new BABYLON.Vector3(-n, t, -n),
            maximum: new BABYLON.Vector3(n, e, n),
            angle: 0,
            center: new BABYLON.Vector3(0, (t + e) / 2, 0)
        }, this.object = {
            getWorldMatrix: function() {
                return BABYLON.Matrix.Identity()
            },
            computeWorldMatrix: function() {},
            name: ""
        }, this.corner = [];
        for (var i = 4; i--;)
            this.corner.push(new BABYLON.Vector3);
        this.axis = [];
        for (var i = 2; i--;)
            this.axis.push(new BABYLON.Vector3);
        this.origin = [];
        for (var i = 2; i--;)
            this.origin.push(new BABYLON.Vector3);
        this.update()
    };
    a.prototype.overlaps1Way = r.prototype.overlaps1Way, a.prototype.worstOverlap = r.prototype.worstOverlap, a.prototype.overlaps = r.prototype.overlaps, a.prototype.showBox = r.prototype.showBox, a.prototype.update = r.prototype.update, i.prototype = Object.create(BaseComponent3D.prototype), i.prototype.initialize = function() {
        e || (e = hcsdesign.engine3D.searchComponent("EditionComponent3D"))
    }, i.prototype.buildCollisionList = function(e) {
        var i = t.getFloor();
        if (n)
            for (; s.length;)
                s.shift().dispose();
        this.collisionList.length = 0;
        for (var o = function(t) {
                if (t.structure && (t.magnetismCollider = t.structure.magnetismCollider), t.magnetismCollider & (hcs.Constants.MAGNETISM.OBJECT | hcs.Constants.MAGNETISM.VERTICAL))
                    t.getBoundingBox(!0), this.collisionList.push(new r(t));
                else if (-1 != t.name.indexOf("WallMesh_") && e.magnetismCollider & hcs.Constants.MAGNETISM.WALL)
                    for (var n in t.boundingBoxes)
                        "OvertureStructure" !== t.objectInstances[n].name && "SubSlopeStructure" !== t.objectInstances[n].name && this.collisionList.push(new r(t, t.boundingBoxes[n]))
            }.bind(this), l = i.getChildren(), h = 0, c = l.length; c > h; h++)
            if (-1 != l[h].name.indexOf("group_")) {
                if (l[h].name != e.name)
                    for (var u = l[h].getChildren(), p = 0, d = u.length; d > p; p++)
                        o(u[p])
            } else
                o(l[h]);
        var m = t.getFloor().structure;
        this.collisionList.push(new a(m.elevation - 20, m.elevation + 5)), this.collisionList.push(new a(m.elevation + m.height, m.elevation + m.height + 20))
    }, i.prototype.updateCollisionList = function(t) {
        for (var e = 0, n = this.collisionList.length; n > e; e++)
            (!t || t && t == this.collisionList[e]) && this.collisionList[e].update()
    }, i.prototype.onContextChanged = function(t) {
        "3D" == t ? this.initialized || (e.on("selectObject", this.onDragStart.bind(this)), e.on("dragstart", this.onDragStart.bind(this)), e.on("dragging", this.onDragging.bind(this)), e.on("objectMoves", this.onDragging.bind(this))) : this.initialized && (e.off("selectObject", this.onDragStart.bind(this)), e.off("dragstart", this.onDragStart.bind(this)), e.off("dragging", this.onDragging.bind(this)), e.off("objectMoves", this.onDragging.bind(this)))
    }, i.prototype.onDragStart = function(e) {
        var n = -1 != e.object.name.indexOf("group_");
        if (n && (e.object.magnetismCollider = hcs.Constants.MAGNETISM.WALL), e.object.structure && (e.object.magnetismCollider = e.object.structure.magnetismCollider), e.object.magnetismCollider) {
            if (t.buildCollisionList(e.object), !n && e.object.magnetismCollider & (hcs.Constants.MAGNETISM.OBJECT | hcs.Constants.MAGNETISM.VERTICAL)) {
                t.currentCollisionBox = null;
                for (var i = 0; !t.currentCollisionBox && i < t.collisionList.length;)
                    t.collisionList[i].object == e.object && (t.currentCollisionBox = t.collisionList[i]), i++;
                t.collisionList.splice(i - 1, 1)
            } else
                t.currentCollisionBox = new r(e.object);
            t._lastPosition.copyFrom(e.object.position), t._lastFictivePosition.copyFrom(e.object.position)
        }
    }, i.prototype.lateralCollisionCandidate = function(e) {
        return t.currentCollisionBox.object.magnetismCollider & hcs.Constants.MAGNETISM.OBJECT && -1 == e.object.name.indexOf("WallMesh_") && e.object.magnetismCollider & hcs.Constants.MAGNETISM.OBJECT || t.currentCollisionBox.object.magnetismCollider & hcs.Constants.MAGNETISM.WALL && -1 != e.object.name.indexOf("WallMesh_")
    }, i.prototype.onDragging = function(n) {
        if (n.object.magnetismCollider) {
            var i = 1,
                o = 10;
            if (!t.currentCollisionBox)
                return void Logger.warning("L'��v��nement DragStart n'a pas ��t�� correctement trait�� par le magn��tisme 3D");
            t.currentCollisionBox.update();
            var r = -1,
                s = !1,
                a = 0;
            t._speedVector.copyFrom(t.currentCollisionBox.object.position).subtractInPlace(t._lastFictivePosition);
            for (var l = Math.abs(t._speedVector.y) > .1;
                (0 > r || r > i) && o > a;) {
                r = 0;
                for (var h = 0, c = t.collisionList.length; c > h; h++)
                    if (!(t.collisionList[h].yRange[1] <= t.currentCollisionBox.yRange[0] || t.collisionList[h].yRange[0] >= t.currentCollisionBox.yRange[1]) && t.collisionList[h].overlaps(t.currentCollisionBox)) {
                        if (l && (t.currentCollisionBox.object.magnetismCollider & hcs.Constants.MAGNETISM.VERTICAL || "room" == t.collisionList[h].object.name)) {
                            if (t._lastFictivePosition.copyFrom(t.currentCollisionBox.object.position), t.solveCollision(t.collisionList[h], !0) < 5)
                                continue;
                            t._speedVector.y = Math.abs(t.currentCollisionBox.yRange[1] - t.collisionList[h].yRange[0]) <= Math.abs(t.currentCollisionBox.yRange[0] - t.collisionList[h].yRange[1]) ? t.collisionList[h].yRange[0] - t.currentCollisionBox.yRange[1] : t.collisionList[h].yRange[1] - t.currentCollisionBox.yRange[0], t.currentCollisionBox.object.position.addInPlace(t._speedVector);
                            break
                        }
                        if ("room" == t.collisionList[h].object.name)
                            continue;
                        if (t.lateralCollisionCandidate(t.collisionList[h]) && e.getSelectedObject() !== n.object) {
                            if (!s) {
                                var u = t.currentCollisionBox.object.rotation.y;
                                t.collisionList[h].object.name.indexOf("WallMesh_") >= 0 && t.angleMagnetism(t.currentCollisionBox, t.collisionList[h]);
                                for (var p = 0, d = t.collisionList.length; d > p; p++)
                                    if (h != p && t.lateralCollisionCandidate(t.collisionList[p]) && "room" != t.collisionList[p].object.name && t.collisionList[p].overlaps(t.currentCollisionBox) && t.solveCollision(t.collisionList[p], !0) > 5) {
                                        t.currentCollisionBox.object.rotation.y = u, t.currentCollisionBox.object.computeWorldMatrix(!0), t.currentCollisionBox.update();
                                        break
                                    }
                                s = !0
                            }
                            t._physicSpeedVector.copyFrom(t.currentCollisionBox.object.position).subtractInPlace(t._lastPosition), r = Math.max(t.solveCollision(t.collisionList[h], !1, t._physicSpeedVector), r)
                        }
                    }
                a++
            }
            0 >= r && t._lastFictivePosition.copyFrom(t.currentCollisionBox.object.position), a == o && t.currentCollisionBox.object.position.copyFrom(t._lastPosition), t._lastPosition.copyFrom(t.currentCollisionBox.object.position)
        }
    }, i.prototype.angleMagnetism = function(e, n) {
        for (var i = Math.PI / 1e3, o = 2 * Math.PI, r = e.object.structure && void 0 !== e.object.structure.preferredYAngle ? e.object.structure.preferredYAngle : 0, s = e.object.getChildren(), a = s.length - 1; a >= 0; a--)
            if ("selector" === s[a].name)
                return;
        var l = void 0 !== n.box.angle ? n.box.angle : n.object.rotation.y + Math.PI;
        l += Math.PI;
        var h = e.object.rotation.y,
            c = (t.core.engine3D.keyboardManager.isPressed([17, 91]), l % o),
            u = h % o;
        Math.abs(c - (u - r)) > o / 2 && (u > c ? c += o : u += o);
        var p = c - (u - r);
        Math.abs(p) > i && -1 == e.object.name.indexOf("group_") && (e.object.rotation.y += p, e.object.computeWorldMatrix(!0), e.update())
    }, i.prototype.solveCollision = function(e, n, i) {
        t._lastFictivePosition.copyFrom(t.currentCollisionBox.object.position);
        var o = t.currentCollisionBox.worstOverlap(e, i);
        if (o && o.overlapAxis) {
            var r = o.overlapAxis.clone().normalize().scaleInPlace(-o.overlapValue);
            return n || t.currentCollisionBox.object.position.addInPlace(r), t.currentCollisionBox.update(), r.length()
        }
        return 0
    };
    return i
}();
var AvatarComponent3D = function() {
    var t, e = function(e) {
        BaseComponent3D.call(this, e, "AvatarComponent3D"), this.avatar = null, this.structure = this.core.getSelectedStructure(), this._avatarEnabled = !0, hcsdesign.api.params.avatarEnabled === !1 && (this._avatarEnabled = !1), t = this, BABYLON.SceneLoader.ImportMesh("", hcs.Assets.globalPath + "js/Components/AvatarComponent/avatar/", "girl.babylon", e.engine3D.scene, function(n) {
            t.avatar = new BABYLON.Mesh("avatar", e.engine3D.scene), t.avatar.isVisible = !1;
            for (var i = 0, o = n.length; o > i; i++)
                n[i].parent = t.avatar, t._avatarEnabled ? (n[i].material.backFaceCulling = !1, n[i].receiveShadows = !0, e.engine3D.castShadows(n[i])) : n[i].isVisible = !1;
            t.avatar.position.y += 5;
            var r = hcsdesign.getComponentByName("EditionComponent3D");
            r && r.addUnremovableDraggable(t.avatar)
        }), this.globalBoundingBox = this.core.configuration.boundingSize, this.onNewPlanReady = this.onNewPlanReady.bind(this), document.addEventListener("hcs.request.newPlanReady", this.onNewPlanReady, !1)
    };
    return e.prototype = Object.create(BaseComponent3D.prototype), e.prototype.onFloorSelected = function(t) {
        var e = t.structure;
        this.structure = e, "undefined" != typeof e.elevation && (this.avatar.position.y = e.elevation + 5)
    }, e.prototype.startListening = function() {
        this.onFloorSelected = this.onFloorSelected.bind(this), document.addEventListener("hcs.request.floorSelected", this.onFloorSelected, !1)
    }, e.prototype.stopListening = function() {
        document.removeEventListener("hcs.request.floorSelected", this.onFloorSelected, !1)
    }, e.prototype.onNewPlanReady = function() {
        this.structure = this.core.getSelectedStructure(), "undefined" != typeof this.structure.elevation && (this.avatar.position.y = this.structure.elevation + 5)
    }, e.prototype.setVisibility = function(t) {
        this._avatarEnabled && this.avatar.traverse(function(e) {
            e.isVisible = t
        })
    }, e.prototype.update = function() {
        this.avatar && (null == this.avatar || this.avatar.visible || (this.avatar.position.y = this.core.getSelectedStructure().elevation + 5), this.avatar.position.x = this.avatar.position.x < this.globalBoundingBox.min.x ? this.globalBoundingBox.min.x : this.avatar.position.x, this.avatar.position.z = this.avatar.position.z < this.globalBoundingBox.min.z ? this.globalBoundingBox.min.z : this.avatar.position.z, this.avatar.position.x = this.avatar.position.x > this.globalBoundingBox.max.x ? this.globalBoundingBox.max.x : this.avatar.position.x, this.avatar.position.z = this.avatar.position.z > this.globalBoundingBox.max.z ? this.globalBoundingBox.max.z : this.avatar.position.z)
    }, e
}();
FloorStructure = function() {
    var t = function() {
        BaseStructure.call(this, "FloorStructure"), this.label = "", this.points = [], this.walls = [], this.overtures = [], this.internalRooms = [], this.externalRooms = [], this.objects = [], this.stairways = [], this.hoppers = [], this.subslopes = [], this.SubSlopeOverture = [], this.elevation = 0, this.height = 250, this.needsUpdate = !0, this.dirtyGeometry = !0
    };
    return t.prototype = new BaseStructure, t.prototype.dirty = function() {
        this.dirtyGeometry = !0
    }, t.prototype.tidy = function() {
        this.dirtyGeometry = !1
    }, t.prototype.isDirty = function() {
        return this.dirtyGeometry
    }, t.prototype.serialize = function() {
        var t = {
            "class": {
                name: "FloorStructure"
            }
        };
        return ujs.serializeObject(this, t, ["id", "name", "label", "elevation", "height", "internalRooms", "externalRooms", "points", "walls", "overtures", "objects", "stairways", "hoppers"]), t
    }, t.prototype.deserialize = function(t) {
        return ujs.deserializeObject(t, this, ["id", "name", "label", "elevation", "height", "internalRooms", "externalRooms", "points", "walls", "overtures", "objects", "stairways", "hoppers"]), this
    }, t.prototype.updateReferences = function() {
        for (var t = this, e = [this.points, this.walls, this.overtures, this.internalRooms, this.externalRooms, this.objects], n = function(e) {
                for (var n = 0, i = e.length; i > n; n++)
                    e[n].updateReferences(t)
            }, i = function(e) {
                for (var n = e.length - 1; n >= 0; n--)
                    e[n].checkCoherence && e[n].checkCoherence(t)
            }, o = 0, r = e.length; r > o; o++)
            n(e[o]), i(e[o]);
        for (var o = 0, r = this.walls.length; r > o; o++)
            this.walls[o].getPolygon(this), this.walls[o].update(this)
    }, t.prototype.insertElement = function(t, e) {
        this[t] || (this[t] = []);
        var n = !1;
        for (var i in this[t])
            if (this[t][i] == e) {
                n = !0;
                break
            }
        n || (e.id = this[t].length, this[t].push(e))
    }, t.prototype.getElements = function(t) {
        return this[t] ? this[t] : []
    }, t.prototype.getElementByIdentifier = function(t, e, n) {
        for (var i = this.getElements(e), n = n || "id", o = 0; o < i.length; o++)
            if (i[o][n] == t)
                return i[o];
        return null
    }, t.prototype.removeElement = function(t, e) {
        if (this[t]) {
            var n = 0;
            for (var i in this[t])
                if (this[t][i] == e) {
                    this[t].splice(i, 1), n = i;
                    break
                }
            this.reindexElements(this[t], n)
        }
    }, t.prototype.replaceElements = function(t, e) {
        this[t] = [].concat(e), this.reindexElements(this[t], 0)
    }, t.prototype.clone = function() {
        var e = this.serialize(),
            n = new t;
        return n.deserialize(e), n.label = "", n
    }, t.prototype.reindexElements = function(t, e) {
        for (var e = e || 0, n = e; n < t.length; n++)
            t[n].id = n
    }, t
}();
var FloorComponent3D = function() {
    var t = null,
        e = function(e) {
            BaseComponent3D.call(this, e, "FloorComponent3D"), this._floors = [], this.priority = 1, this._current = 0, t = this, this.onNewPlanReady = this.onNewPlanReady.bind(this), document.addEventListener("hcs.request.newPlanReady", this.onNewPlanReady)
        };
    return e.prototype = new BaseComponent3D, e.prototype.compute = function() {}, e.prototype.startListening = function() {
        this.onSelectFloor = this.onSelectFloor.bind(this), this.onDeleteFloor = this.onDeleteFloor.bind(this), document.addEventListener("hcs.request.floorSelected", this.onSelectFloor), document.addEventListener("hcs.request.floorDeleted", this.onDeleteFloor)
    }, e.prototype.stopListening = function() {
        document.removeEventListener("hcs.request.floorSelected", this.onSelectFloor), document.removeEventListener("hcs.request.floorDeleted", this.onDeleteFloor)
    }, e.prototype.onContextChanged = function(t) {
        "3D" == t ? (this.startListening(), this.createFloor()) : this.stopListening()
    }, e.prototype.onSelectFloor = function(t) {
        var e = t.id;
        this.createFloor(+e > +this._current ? this._current : e), this._current = e
    }, e.prototype.onDeleteFloor = function(t) {
        this.deleteFloor({
            id: t.id
        })
    }, e.prototype.onNewPlanReady = function() {
        for (var t = hcsdesign.engine3D.scene.meshes.slice(0), e = t.length - 1; e >= 0; e--)
            "structure" == t[e].type && t[e].dispose();
        return !0
    }, e.prototype.deleteFloor = function(t) {
        for (var e = hcsdesign.engine3D.scene.meshes.slice(0), n = e.length - 1; n >= 0; n--)
            e[n].name && -1 != e[n].name.indexOf("FloorMesh") && e[n].structureId >= t.id && e[n].dispose()
    }, e.prototype.getFloor = function(t) {
        for (var t = t || hcsdesign.getSelectedStructure(), e = "FloorMesh_" + t.id, n = 0; n < hcsdesign.engine3D.scene.meshes.length; n++)
            if (hcsdesign.engine3D.scene.meshes[n].name == e)
                return hcsdesign.engine3D.scene.meshes[n];
        return null
    }, e.prototype.createFloor = function(t) {
        var e, t = t || 0,
            n = +hcsdesign.getSelectedStructure().id || 0;
        this._current = n;
        for (var i = n + 1; i < this.structure.getLength(); i++)
            e = this.structure.getElement(i), this.deleteFloor(e);
        for (var o = t; n >= o; o++)
            if (e = this.structure.getElement(o), this.deleteFloor(e), e instanceof FloorStructure) {
                var r = this.createFloorMesh(e);
                r.position.y = e.elevation, r.computeWorldMatrix(), ujs.notify("hcs.engine3d.floorReady", {
                    floor: r,
                    structure: e
                })
            }
        ujs.notify("hcs.engine3d.globaleFloorReady", {
            maxFloorId: n
        }), this.initialized = !0
    }, e.prototype.createFloorMesh = function(t) {
        var e = new BABYLON.Mesh("FloorMesh_" + t.id, hcsdesign.engine3D.scene);
        return e.isVisible = !1, e.structureId = t.id, e.structure = t, e.id = t.id, e.type = "structure", e
    }, e
}();
var FloorController = function() {
    var t = null,
        e = function(e) {
            BaseComponent2D.call(this, e, "FloorController"), this._dragging = !1, this.core = e, t = this
        };
    return e.prototype = Object.create(BaseComponent2D.prototype), e.prototype.update = function() {
        hcsdesign.getSelectedStructure().isDirty() && this.updateHTML()
    }, e.prototype.onContextChanged = function() {}, e.prototype.initialize = function() {
        this.updateHTML(), this.startListening();
        ({
            context: "2D",
            values: [{
                type: "checkbox",
                label: _("Display the lower floor"),
                eventParams: {
                    eventName: "hcs.request.object.seeBottomFloor",
                    cast: "int"
                }
            }]
        })
    }, e.prototype.startListening = function() {
        document.addEventListener("hcs.structure.locale.loaded", this.updateHTML)
    }, e.prototype.stopListening = function() {
        document.removeEventListener("hcs.structure.locale.loaded", this.updateHTML)
    }, e.prototype.updateHTML = function() {
        t.removeHTML();
        var e = t.buildHTML();
        document.getElementById("modalWidgets").appendChild(e)
    }, e.prototype.removeHTML = function() {
        (fcElement = document.getElementById("floor-controller")) && document.getElementById("modalWidgets").removeChild(fcElement)
    }, e.prototype.buildHTML = function() {
        var e = document.createElement("div");
        e.setAttribute("id", "floor-controller"), e.setAttribute("style", "top: 10px;left: 10px;position:absolute;");
        for (var n = this.core.structure.getCurrentStructure() ? this.core.structure.getCurrentStructure().id : 0, i = 0; i < this.core.structure.getLength(); i++) {
            var o = this.structure.getElement(i);
            if (o instanceof FloorStructure) {
                var r = document.createElement("a");
                if (r.setAttribute("rel", i), r.setAttribute("draggable", !0), r.setAttribute("class", "floor-item"), i == n && ujs.addClass(r, "selected"), r.innerHTML = o.label ? o.label : 0 == i ? _("GND") : _("Floor") + " " + i, r.setAttribute("title", r.innerHTML), r.addEventListener("click", this.onItemClick, !1), r.addEventListener("dragstart", function(e) {
                        e.dataTransfer.setData("Text", this.id), t._dragging = this.getAttribute("rel")
                    }, !0), r.addEventListener("dragover", function(t) {
                        this.classList.add("dragover"), t.preventDefault()
                    }), r.addEventListener("dragleave", function() {
                        this.classList.remove("dragover")
                    }), r.addEventListener("drop", function(e) {
                        var n = this.getAttribute("rel");
                        this.classList.remove("dragover"), t.insertFloorBefore(t._dragging, n), t.updateHTML(), e.preventDefault()
                    }), e.appendChild(r), !this.core.engine3D.isViewer) {
                    var s = document.createElement("div");
                    s.setAttribute("class", "settings"), s.setAttribute("title", _("Change settings")), s.setAttribute("rel", i), s.innerHTML = "i", s.addEventListener("click", this.onItemContextMenu, !0), r.appendChild(s);
                    var a = document.createElement("div");
                    a.setAttribute("class", "delete"), a.setAttribute("title", _("Remove this floor")), a.setAttribute("rel", i), a.innerHTML = "x", a.addEventListener("click", this.onItemDelete, !1), r.appendChild(a)
                }
            }
        }
        if (!this.core.engine3D.isViewer) {
            var l = document.createElement("div");
            l.setAttribute("class", "floor-item"), l.innerHTML = _("+ add"), l.addEventListener("click", this.onAddItemClick), e.appendChild(l)
        }
        return e
    }, e.prototype.insertFloorBefore = function(e, n) {
        var i = this.structure.getElement(e);
        this.structure.removeElement(i), this.structure.addMemberAtIndex(n, i);
        for (var o = 0, r = 0; r < hcsdesign.structure.getLength(); r++) {
            var i = t.structure.getElement(r);
            i instanceof FloorStructure && (i.elevation = o, o += i.height)
        }
        this.selectFloor(n)
    }, e.prototype.onItemClick = function() {
        (id = this.getAttribute("rel")) && t.selectFloor(id)
    }, e.prototype.onItemContextMenu = function(e) {
        if (id = this.getAttribute("rel")) {
            var n = hcsdesign.structure.getElement(id),
                i = [{
                    name: "label",
                    label: _("Name"),
                    type: "text",
                    cast: "string",
                    value: n.label
                }, {
                    name: "height",
                    label: _("Height"),
                    type: "number",
                    cast: "int",
                    unit: "cm",
                    value: {
                        min: 5,
                        max: 500,
                        step: 1,
                        value: n.height
                    }
                }];
            hcsdesign.engine2D.displayContextMenu(i, n, t.onContextMenuPropertyChanged.bind(t))
        }
        e.stopPropagation()
    }, e.prototype.onContextMenuPropertyChanged = function(t, e, n) {
        if (t.hasOwnProperty(e)) {
            var i = t[e];
            if (t[e] = n, "height" == e) {
                for (var o = 0; o < t.walls.length; o++)
                    (t.walls[o].height > t.height || t.walls[o].height == i) && (t.walls[o].height = t.height);
                this.core.structure.updateFloorElevations(), ujs.notify("hcs.request.floorSelected", {
                    id: this.core.getSelectedStructure().id,
                    structure: this.core.getSelectedStructure()
                })
            }
        }
        this.updateHTML(), this.core.engine2D.requestStaticDraw()
    }, e.prototype.onItemDelete = function(e) {
        if (confirm(_("confirm the deletion")) && !(hcsdesign.structure.getLength() <= 1)) {
            if (id = this.getAttribute("rel")) {
                var n = hcsdesign.structure.getElement(id);
                hcsdesign.structure.removeElement(n);
                for (var i = 0, o = 0; o < hcsdesign.structure.getLength(); o++) {
                    var r = t.structure.getElement(o);
                    r instanceof FloorStructure && (r.elevation = i, i += r.height)
                }
                ujs.notify("hcs.request.floorDeleted", {
                    id: id
                }, !0), t.selectFloor(0 == id ? id : id - 1)
            }
            e.stopPropagation()
        }
    }, e.prototype.onAddItemClick = function() {
        var e = '<form id="addFloorOptions">' + _("The following items will be duplicated") + '<table style="width:100%;">';
        e += "<tr>", e += '<td><input type="checkbox" name="duplicateOptions[]" value="walls" checked="checked" /></td>', e += "<td>" + _("墙") + "</td>", e += "</tr>", e += "<tr>", e += '<td><input type="checkbox" name="duplicateOptions[]" value="overtures" checked="checked" /></td>', e += "<td>" + _("门") + "和" + _("窗") + "</td>", e += "</tr>", e += "<tr>", e += '<td><input type="checkbox" name="duplicateOptions[]" value="cloisons" /></td>', e += "<td>" + _("隔板") + "</td>", e += "</tr>", e += "<tr>", e += '<td><input type="checkbox" name="duplicateOptions[]" value="stairways" /></td>', e += "<td>" + _("Stairways") + "</td>", e += "</tr>", e += "<tr>", e += '<td><input type="checkbox" name="duplicateOptions[]" value="objects" /></td>', e += "<td>" + _("Objects") + "</td>", e += "</tr>", e += "</table></form>";
        var n = {title: _("Create a new floor"),message: e,y: 30,x: 10,buttonA: !0,buttonB: !0,buttonBText: _("Create"),buttonAText: _("Cancel"),onClickB: function(e) {
            for (var n = document.getElementsByName("duplicateOptions[]"), i = [], o = 0; o < n.length; o++)
                n[o].checked && i.push(n[o].value);
            return t.onAddItemConfirm(e, i), !0
        }};
        hcs.UI.MessageBox.show(n)
    }, e.prototype.onAddItemConfirm = function(e, n) {
        var i = t.duplicateForFloor(n);
        if (i.id > 0) {
            var o = hcsdesign.structure.getElement(i.id - 1);
            i.elevation = o.elevation + o.height
        }
        var r = function() {
            t.selectFloor(i.id)
        };
        ujs.notify("hcs.request.floorAdded", {
            id: i.id,
            callback: r
        }, !0)
    }, e.prototype.duplicateForFloor = function(t) {
        var t = t || [],
            e = hcsdesign.structure.getCurrentStructure(),
            n = e.clone();
        hcsdesign.structure.addElement(n), n.updateReferences(hcsdesign.structure), n.hoppers = [];
        for (var i = 0, o = n.walls.length; o > i; i++)
            n.walls[i].materials = {}, n.walls[i].subSlopes = [];
        for (var r = n.internalRooms.concat(n.externalRooms), i = 0, o = r.length; o > i; i++)
            r[i].panesMaterials = {}, r[i].materials = {};
        if (n.subslopes = [], -1 == t.indexOf("objects") && (n.objects = []), -1 == t.indexOf("stairways") && (n.stairways = []), -1 == t.indexOf("walls")) {
            for (var i = n.walls.length - 1; i >= 0; i--) {
                var s = n.walls[i];
                s.remove(n)
            }
            n.externalRooms.length = 0, n.internalRooms.length = 0
        } else if (-1 == t.indexOf("cloisons"))
            for (var i = n.walls.length - 1; i >= 0; i--) {
                var s = n.walls[i];
                (s.type != s.TYPE_NORMAL || s.thickness < 15) && s.remove(n)
            }
        if (-1 == t.indexOf("overtures")) {
            n.overtures = [];
            for (var i = n.walls.length - 1; i >= 0; i--) {
                var s = n.walls[i];
                s.overtures.length = 0
            }
        } else
            for (var i = n.overtures.length - 1; i >= 0; i--) {
                n.overtures[i]
            }
        return n
    }, e.prototype.onSelectFloor = function(e) {
        e.id > -1 && t.selectFloor(e.id)
    }, e.prototype.selectFloor = function(e) {
        hcsdesign.structure.setCurrentStructureIndex(e), hcsdesign.structure.members[e].dirty(), hcsdesign.engine2D.update(!0), hcsdesign.engine2D.requestStaticDraw(), t.updateHTML();
        var n = hcsdesign.getComponentByName("HistoryComponent");
        n && n.reset(), ujs.notify("hcs.request.floorSelected", {
            id: e,
            structure: hcsdesign.structure.getCurrentStructure()
        }, !0)
    }, e
}();
var PointStructure = function() {
    var t = function() {
        BaseStructure.call(this, "PointStructure"), this.position = new BABYLON.Vector2(0, 0), this.attachedTo = null, this.needsUpdate = !0, this.parents = [], this._parentIds = null
    };
    return t.prototype = new BaseStructure, t.prototype.serialize = function() {
        this.position.x = Math.round(10 * this.position.x) / 10, this.position.y = Math.round(10 * this.position.y) / 10;
        for (var t = {
                "class": {
                    name: "PointStructure"
                },
                _parentIds: []
            }, e = 0, n = this.parents.length; n > e; e++)
            t._parentIds.push(this.parents[e].id);
        return ujs.serializeObject(this, t, ["name", "id", "position"]), t
    }, t.prototype.deserialize = function(t) {
        ujs.deserializeObject(t, this, ["name", "id", "position"]), this._parentIds = t._parentIds
    }, t.prototype.checkCoherence = function() {}, t.prototype.updateReferences = function(t) {
        this.parents.length = 0;
        for (var e = 0, n = this._parentIds.length; n > e; e++)
            for (var i = 0, o = t.walls.length; o > i; i++)
                t.walls[i].id == this._parentIds[e] && this.parents.push(t.walls[i]);
        delete this._parentIds
    }, t.Deserialize = function(e) {
        var n = new t;
        return n.deserialize(e), n
    }, t.prototype.update = function(t) {
        this.tryMerge(t).tryAttach(t)
    }, t.prototype.translate = function(t) {
        this.position.addInPlace(t)
    }, t.prototype.remove = function(t) {
        this.unAttach(), void 0 != t && t.removeElement("points", this)
    }, t.prototype.replaceParent = function(t, e) {
        var n = this.parents.indexOf(t); - 1 != n && this.parents.splice(n, 1), void 0 !== e && this.parents.push(e)
    }, t.prototype.tryMerge = function(t) {
        if (!this.parents[0])
            return this;
        if (this.parents[0] && this.parents[1])
            return this;
        for (var e = 15, n = t.getElements("points"), i = 0, o = n.length; o > i; i++)
            if (n[i] !== this && !(this.position.distanceTo(n[i].position) > e || n[i].parents[0] && n[i].parents[1])) {
                var r, s;
                if (r = this.wallAttached(t), s = n[i].wallAttached(t), !r && !s || r == n[i].parents[0] && s == this.parents[0]) {
                    n[i].parents.push(this.parents[0]);
                    var a = this.parents[0].points.indexOf(this);
                    this.parents[0].points[a] = n[i], n[i].unAttach(), this.unAttach();
                    var l = n[i];
                    return this.remove(t), l.parents[0].update(t), l
                }
            }
        return this
    }, t.prototype.forceMerge = function(t, e) {
        if (this.parents[0]) {
            var n = t.parents[0];
            n && (this.parents.push(n), n.points[n.points.indexOf(t)] = this), this.unAttach(e), t.unAttach(e), t.remove(e), t.parents.length = 0, this.parents[0].needsUpdate = !0, this.parents[1] && (this.parents[1].needsUpdate = !0)
        } else
            t.position.lerp(this.position, .5), t.unAttach(e), t.needsUpdate = !0
    }, t.prototype.tryAttach = function(t, e) {
        if (!this.parents[0])
            return !1;
        if (this.parents[0] && this.parents[1])
            return !1;
        if (this.isAttached(t))
            return !1;
        for (var n, i = 5, o = t.getElements("walls"), r = [], s = null, a = 0, l = o.length; l > a; a++)
            if ((void 0 === e || e !== o[a]) && o[a] != this.parents[0] && o[a] != this.parents[1] && this.parents[0] && (n = this.parents[0].points[(this.parents[0].points.indexOf(this) + 1) % 2], o[a] != n.wallAttached(t) && o[a].points[0].wallAttached(t) !== this.parents[0] && o[a].points[1].wallAttached(t) !== this.parents[0])) {
                var h = o[a].distanceFromRect(this.position, 0, t);
                if (!(h > i + o[a].thickness)) {
                    var c = o[a].getNearestPointOnRect(this.position, 0, t),
                        u = o[a].getPoints(0).position.subtract(c),
                        p = o[a].getPoints(1).position.subtract(c),
                        d = u.lengthSquared() > p.lengthSquared() ? u : p;
                    r.push({
                        wall: o[a],
                        vector: d.normalize()
                    })
                }
            }
        if (n) {
            for (var m = -1, g = n.position.subtract(this.position).normalize(), a = 0, l = r.length; l > a; a++) {
                var f = g.dot(r[a].vector);
                f >= m && (s = r[a].wall, m = f)
            }
            return s ? (s.attachedPoints.push(this), this.attachedTo = s, this.position = s.getNearestPointOnPolygon(this.position), s.needsUpdate = !0, this.parents[0].needsUpdate = !0, !0) : !1
        }
    }, t.prototype.isAttached = function() {
        return null != this.attachedTo
    }, t.prototype.wallAttached = function() {
        return this.attachedTo
    }, t.prototype.unAttach = function() {
        return this.attachedTo ? (this.attachedTo.attachedPoints.splice(this.attachedTo.attachedPoints.indexOf(this), 1), this.attachedTo = null, !0) : !1
    }, t
}();
var PointComponent2D = function() {
    var t = function(t) {
        BaseComponent2D.call(this, t, "PointComponent2D"), this._SIZE = 13, this._ANGLERADIUS = 55, this.anglePointList = [], this.dragging = !1, hcsdesign.engine2D.registerEventCb("PointComponent2D.double-click", this.priority, "double-click", hcsdesign.engine2D.MODE_NORMAL, PointStructure, this.onDoubleClick.bind(this), null), hcsdesign.engine2D.registerEventCb("PointComponent2D.hover", this.priority, "hover", hcsdesign.engine2D.MODE_NORMAL | hcsdesign.engine2D.MODE_DRAW, PointStructure, this.onHover.bind(this), null), hcsdesign.engine2D.registerEventCb("PointComponent2D.leave", this.priority, "leave", hcsdesign.engine2D.MODE_NORMAL | hcsdesign.engine2D.MODE_DRAW, PointStructure, this.onLeave.bind(this), null), hcsdesign.engine2D.registerEventCb("PointComponent2D.dragstart", this.priority, "drag-start", hcsdesign.engine2D.MODE_NORMAL, PointStructure, this.onDragStart.bind(this), null), this.priority = 90
    };
    return t.prototype = new BaseComponent2D, BaseComponent2D.prototype.getTargeted = function(t) {
        var e = this.structure.getCurrentStructure(),
            n = e.getElements("points"),
            i = null;
        for (var o in n)
            n[o].position.distanceTo(t) < this._SIZE + 5 && (null == i ? i = n[o] : !i.isAttached(e) && n[o].isAttached(e) && (i = n[o]));
        return i
    }, t.prototype.update = function() {
        this.tryMergeAttachAll()
    }, t.prototype.tryMergeAttachAll = function(t) {
        for (var e = this.structure.getCurrentStructure(), n = e.getElements("points"), i = n.length - 1; i >= 0; i--)
            (n[i].needsUpdate || t) && (n[i].needsUpdate = !1, n[i].update(e), e.dirty())
    }, t.prototype.drawAngle = function(t, e, n, i) {
        var o, r, s, a;
        if (2 === i.parents.length)
            o = i.parents[0], r = i.parents[1], s = 0 === o.points.indexOf(i) ? o.getWallVector() : o.getWallVector().scaleInPlace(-1), a = 0 === r.points.indexOf(i) ? r.getWallVector() : r.getWallVector().scaleInPlace(-1);
        else {
            if (1 !== i.parents.length || null == i.attachedTo)
                return;
            o = i.parents[0], r = i.attachedTo, s = 0 === o.points.indexOf(i) ? o.getWallVector() : o.getWallVector().scaleInPlace(-1), a = r.getWallVector(), s.dot(a) < 0 && a.scaleInPlace(-1)
        }
        var l = s.dot(a) / (s.length() * a.length()),
            h = s.determinant(a) / (s.length() * a.length()),
            c = Math.acos(BABYLON.Math.clamp(l, -1, 1)) * (h > 0 ? 1 : -1),
            u = BABYLON.Math.NormalizeAngle(Math.atan2(s.y, s.x), !0);
        hcsdesign.engine2D.symbols2D.drawAngle(t, {
            x: e.x + n * i.position.x,
            y: e.y + n * i.position.y
        }, n, this._ANGLERADIUS, u, u + c, 0 > h)
    }, t.prototype.onDynamicDraw = function(t, e, n, i) {
        var o = {
            x: e.x + i.position.x * n,
            y: e.y + i.position.y * n
        };
        hcsdesign.engine2D.symbols2D.drawPointHover(t, o, n);
        for (var r = 0, s = this.anglePointList.length; s > r; r++)
            this.drawAngle(t, e, n, this.anglePointList[r])
    }, t.prototype.onDragStart = function(t, e) {
        if (e) {
            e.unAttach(this.structure.getCurrentStructure()), this.anglePointList.push(e);
            for (var n = 0, i = e.parents.length; i > n; n++)
                for (var o = 0, r = e.parents[n].points.length; r > o; o++)
                    e.parents[n].points[o] !== e && this.anglePointList.push(e.parents[n].points[o])
        }
        return this.dragging = !0, hcsdesign.engine2D.registerEventCb("PointComponent2D.dragging", this.priority, "dragging", hcsdesign.engine2D.MODE_DRAG, null, this.onDragging.bind(this), e), hcsdesign.engine2D.registerEventCb("PointComponent2D.drag-end", this.priority, "drag-end", hcsdesign.engine2D.MODE_DRAG, null, this.onDragEnd.bind(this), e), hcsdesign.engine2D.registerEventCb("PointComponent2D.drag.hover", this.priority, "hover", hcsdesign.engine2D.MODE_DRAG, PointStructure, this.onHover.bind(this), e), hcsdesign.engine2D.registerEventCb("PointComponent2D.drag.leave", this.priority, "leave", hcsdesign.engine2D.MODE_DRAG, PointStructure, this.onLeave.bind(this), e), !1
    }, t.prototype.onDragging = function(t, e, n, i) {
        0 == i.parents.length && this.onDragEnd(), i.position.copyFrom(n.planPos);
        for (var o = 0, r = i.parents.length; r > o; o++)
            i.parents[o] && (i.parents[o].needsUpdate = !0);
        hcsdesign.engine2D.requestStaticDraw()
    }, t.prototype.onDragEnd = function(t, e, n, i) {
        if (this.anglePointList.length = 0, this.dragging = !1, i) {
            var o = this.structure.getCurrentStructure();
            i.unAttach(o);
            var r = i.tryMerge(o);
            r === i && i.tryAttach(o);
            var s = [r.parents[0], r.parents[1]],
                a = o.getElements("walls");
            s[0] && -1 != a.indexOf(s[0]) && (s[0] = s[0].tryMerge(o)), s[1] && -1 != a.indexOf(s[1]) && (s[1] = s[1].tryMerge(o)), s[0] && -1 != a.indexOf(s[0]) && s[0].splitAtIntersections(o), s[1] && -1 != a.indexOf(s[1]) && s[1].splitAtIntersections(o), hcsdesign.getComponentByName("WallComponent2D").update(), hcsdesign.getComponentByName("WallComponent2D").simplifyWalls(), this.update(), o.dirty(), hcsdesign.engine2D.requestStaticDraw(), hcsdesign.engine2D.unregisterEventCb("PointComponent2D.drag.hover"), hcsdesign.engine2D.unregisterEventCb("PointComponent2D.drag.leave"), hcsdesign.getComponentByName("WallComponent2D").update()
        }
    }, t.prototype.onHover = function(t, e, n, i) {
        var e = i || e;
        return this.dragging || this.anglePointList.push(e), hcsdesign.engine2D.registerEventCb("PointComponent2D.dynamic-draw", this.priority, "dynamic-draw", null, null, this.onDynamicDraw.bind(this), e), hcsdesign.engine2D.requestDynamicDraw(), !1
    }, t.prototype.onLeave = function(t, e, n, i) {
        this.dragging || (this.anglePointList.length = 0, hcsdesign.engine2D.unregisterEventCb("PointComponent2D.dynamic-draw")), hcsdesign.engine2D.requestDynamicDraw()
    }, t.prototype.onDoubleClick = function(t, e, n) {
        var i = hcsdesign.getSelectedStructure(),
            o = hcsdesign.getComponentByName("WallComponent2D", hcsdesign.ENGINE_2D);
        if (e.isAttached(i)) {
            var r = e.wallAttached(i);
            n.planPos = e.position.clone(), o.onDoubleClick(t, r, n, null)
        } else {
            if (n.modifiers != n.MODIFIER_SHIFT)
                return;
            var r = null;
            for (var s in e.parents)
                e.parents[s] instanceof WallStructure && (r = e.parents[s]);
            o.onAddWall({
                wallType: r.type,
                thickness: r.thickness,
                putPoint: !0
            })
        }
        i.dirty()
    }, t
}();
var Graph = function() {
    var t = function(t) {
        this.position = t, this.neighbors = [], this.parents = [], this.parentWallSide = [], this.visited = !1
    };
    t.prototype.connect = function(t, e) {
        t && (this.neighbors.push(t), this.parents[0] == t.parents[0] || e || (this.parents.push(t.parents[0]), this.parentWallSide.push(t.parentWallSide[0])))
    };
    var e = function() {
        this.nodes = []
    };
    return e.prototype.mergeNodes = function() {
        for (var t = function(t, e, n) {
                for (var i = n.length - 1; i >= 0; i--)
                    for (var o = 0; 2 > o; o++)
                        n[i].neighbors[o] == t && (n[i].neighbors[o] = e)
            }, e = .01, n = this.nodes.length - 1; n >= 0; n--)
            for (var i = 0; n > i; i++)
                if (!(this.nodes[n].position.distanceTo(this.nodes[i].position) > e)) {
                    if (!(this.nodes[n].neighbors.length > 1 || this.nodes[i].neighbors.length > 1)) {
                        if (2 == this.nodes[n].parents[0].type || 2 == this.nodes[i].parents[0].type) {
                            var o = new BABYLON.Vector3;
                            o.subVectors(this.nodes[n].neighbors[0].position, this.nodes[n].position).normalize();
                            var r = new BABYLON.Vector3;
                            r.subVectors(this.nodes[i].neighbors[0].position, this.nodes[i].position).normalize();
                            var s = o.add(r).add(this.nodes[n].position),
                                a = this.nodes[n].parents[0].vectorTo(s),
                                l = this.nodes[i].parents[0].vectorTo(s);
                            if (Math.sign(a.dot(this.nodes[n].parentWallSide[0])) != Math.sign(l.dot(this.nodes[i].parentWallSide[0])))
                                continue
                        }
                        var h = this.nodes.splice(n, 1);
                        this.nodes[i].connect(h[0].neighbors[0], !0), this.nodes[i].parents.push(h[0].parents[0]), this.nodes[i].parentWallSide.push(h[0].parentWallSide[0]), t(h[0], this.nodes[i], this.nodes);
                        break
                    }
                    Logger.warning("Tentative de fusion de 3 points")
                }
    }, e.prototype.processMissingConnections = function() {
        for (var t = 50, e = this.nodes.length - 1; e >= 0; e--)
            if (!(this.nodes[e].neighbors.length > 1))
                for (var n = 0; e > n; n++)
                    if (!(this.nodes[e].position.distanceTo(this.nodes[n].position) > t || this.nodes[n].neighbors.length > 1)) {
                        this.nodes[e].connect(this.nodes[n]), this.nodes[n].connect(this.nodes[e]);
                        break
                    }
    }, e.prototype.createFromWalls = function(e, n) {
        n = n || e;
        for (var i, o, r, s, a, l, h, c, u = e.getElements("walls"), p = function(e, n, r) {
                if (e.length < 2)
                    return Logger.warning("Erreur de structure des intersections"), null;
                for (var s, a, l = [], h = 0, c = e.length; c > h; h++)
                    l.push(new t(e[h]));
                for (var h = 0, c = l.length; c > h; h++)
                    s = l[h], l[h + 1] && (l[h].position.entersWall || -.5) < (l[h + 1].position.entersWall || .5) && (a = l[h + 1], s.neighbors.push(a), a.neighbors.push(s), s.parents.push(n), a.parents.push(n), s.parentWallSide.push(r), a.parentWallSide.push(r), this.nodes.push(s), this.nodes.push(a)), 0 == h && (i = s), h == c - 1 && (o = s);
                return {
                    f: i,
                    l: o
                }
            }, d = 0, m = u.length; m > d; d++)
            r = u[d].getIntersections(e), c = p.call(this, r.a, u[d], u[d].getNormalVector(1)), s = c.f, l = c.l, c = p.call(this, r.b, u[d], u[d].getNormalVector(-1)), a = c.f, h = c.l, 1 != u[d].points[0].parents.length || u[d].points[0].wallAttached(e) || s && (s.connect(a), a.connect(s)), 1 != u[d].points[1].parents.length || u[d].points[1].wallAttached(e) || l && (l.connect(h), h.connect(l));
        this.mergeNodes(), this.processMissingConnections()
    }, e.prototype.createCycles = function() {
        for (var t = [], e = function(t) {
                var e = [];
                e.push(t), t.visited = !0;
                for (var n, i = t.neighbors[0], o = t, r = 0; i.position != e[0].position;) {
                    if (e.push(i), i.visited = !0, n = i.neighbors.indexOf(o), -1 == n)
                        return Logger.warning("Erreur dans la structure du graphe"), null;
                    if (o = i, i = i.neighbors[(n + 1) % 2], r++, r > 250 || null == i)
                        return null
                }
                return e
            }, n = 0, i = this.nodes.length; i > n; n++)
            if (!this.nodes[n].visited) {
                var o = e(this.nodes[n]);
                o && t.push(o)
            }
        return t
    }, e
}();
WallStructure = function() {
    var t = function() {
        BaseStructure.call(this, "WallStructure"), this.points = [new PointStructure, new PointStructure], this._edgePolygons = [
            [],
            []
        ], this.attachedPoints = [], this.overtures = [], this.height = 250, this.thickness = 30, this.measureDist = 15, this.measureDisplayed = !0, this.materials = {}, this.subSlopes = [], this.needsUpdate = !0, this.instance = "virtual", this.TYPE_NORMAL = 1, this.TYPE_SEPARATOR = 2, this.type = this.TYPE_NORMAL, this._pointsIds = [], this._attachedPointsIds = [], this._overturesIds = []
    };
    return t.prototype = new BaseStructure, t.prototype.serialize = function() {
        for (var t = {
                "class": {
                    name: "WallStructure"
                },
                _pointsIds: [],
                _attachedPointsIds: [],
                _overturesIds: []
            }, e = 0, n = this.points.length; n > e; e++)
            t._pointsIds.push(this.points[e].id);
        for (var e = 0, n = this.attachedPoints.length; n > e; e++)
            t._attachedPointsIds.push(this.attachedPoints[e].id);
        for (var e = 0, n = this.overtures.length; n > e; e++)
            t._overturesIds.push(this.overtures[e].id);
        return ujs.serializeObject(this, t, ["id", "type", "name", "instance", "height", "thickness", "measureDist", "measureDisplayed", "subSlopes"]), t
    }, t.prototype.deserialize = function(t) {
        ujs.deserializeObject(t, this, ["id", "type", "name", "instance", "height", "thickness", "measureDist", "materials", "measureDisplayed", "subSlopes", "_overturesIds", "_pointsIds", "_attachedPointsIds"]), this.thickness = Math.max(.1, this.thickness)
    }, t.prototype.checkCoherence = function(t) {
        if (this.points.length < 2)
            this.remove(t);
        else if (this.getLength() < 5)
            this.remove(t);
        else {
            var e = this.points[0],
                n = this.points[1];
            (Math.abs(e.position.x) > 5e3 || Math.abs(e.position.y) > 5e3) && (Math.abs(n.position.x) > 5e3 || Math.abs(n.position.y) > 5e3) && this.remove(t)
        }
    }, t.prototype.computeDefault = function(t) {
        var e = this.getNormalVector(this.thickness / 2),
            n = this.getPoints(t).position,
            i = n.add(e),
            o = (n.clone(), n.subtract(e));
        this._edgePolygons[t] = 0 == t ? [i, o] : [o, i]
    }, t.prototype.computeWeak = function(t) {
        this.computeDefault(t);
        var e = 0 == t ? -1 : 1;
        this._edgePolygons[t][1].addInPlace(this.getWallVector().normalize().scaleInPlace(e * this.getPoints(t).attachedTo.thickness / 4))
    }, t.prototype.computeStrong = function(t) {
        var e = Math.PI / 16,
            n = function(t, n, i, o) {
                return BABYLON.Vector2.Intersect(t, n, i, o, e)
            },
            i = this.getAxis(t),
            o = i[0],
            r = i[1],
            s = this.getPoints(t),
            a = s.parents.indexOf(this),
            l = s.parents[(a + 1) % 2],
            h = l.points.indexOf(s);
        if (!l)
            return void Logger.warning("Point avec un seul parent ne devrait pas ��tre appel�� par computeStrong");
        i = l.getAxis(h);
        var c, u, p, d, m = i[0],
            g = i[1];
        return h == t ? (c = n.call(this, o[0], o[1], g[0], g[1]), u = s.position.clone(), p = n.call(this, r[0], r[1], m[0], m[1])) : (c = n.call(this, o[0], o[1], m[0], m[1]), u = s.position.clone(), p = n.call(this, r[0], r[1], g[0], g[1])), c || (c = o[t]), p || (p = r[t]), d = [c, u, p], 1 == t && d.reverse(), this._edgePolygons[t] = d, d
    }, t.prototype.updateReferences = function(t) {
        var e = function(t, e, n) {
            n.length = 0;
            for (var i = 0, o = t.length; o > i; i++)
                for (var r = 0, s = e.length; s > r; r++)
                    e[r].id == t[i] && n.push(e[r])
        };
        e(this._pointsIds, t.points, this.points), e(this._attachedPointsIds, t.points, this.attachedPoints), e(this._overturesIds, t.overtures, this.overtures);
        for (var n = 0, i = this.subSlopes.length; i > n; n++)
            this.subSlopes[n].wall = this;
        for (var n = 0, i = this.overtures.length; i > n; n++)
            this.overtures[n].parentWall = this;
        for (var n = 0; n < this.attachedPoints.length; n++)
            this.attachedPoints[n].attachedTo = this;
        delete this._pointsIds, delete this._attachedPointsIds, delete this._overturesIds
    }, t.Deserialize = function(t) {
        return Logger.warning("Deserialize is virtual"), console.warn("Impossible de deserialiser un mur virtuel, l'instance par d��faut choisie est polygonWall"), PolygonWall.Deserialize(t)
    }, t.prototype.getPoints = function(t) {
        return 0 != t && 1 != t ? [this.points[0], this.points[1]] : this.points[t]
    }, t.prototype.isTargeted = function(t) {
        var e = this.getPoints(),
            n = this.getWallVector(),
            i = new BABYLON.Vector2,
            o = new BABYLON.Vector2;
        if (i = t.subtract(e[0].position), o.copyFrom(i), i.projectOnVector(n), o.subtractInPlace(i), o.length() <= this.thickness / 2 + WallComponent2D.WALL_OFFSET) {
            var r = i.dot(n);
            if (r > 0 && r < n.lengthSquared())
                return !0
        }
        return !1
    }, t.prototype.setPoints = function(t, e) {
        for (var n in this.points)
            for (var i = this.points[n].parents.length - 1; i >= 0; i--)
                this.points[n].parents[i] == this && this.points[n].parents.splice(i, 1);
        if (t instanceof Array)
            2 == t.length && (this.points[0] = t[0], this.points[1] = t[1]);
        else {
            if (!(t instanceof PointStructure) || 0 != e && 1 != e)
                throw {
                    name: "Argument Error",
                    level: "Show Stopper",
                    message: "Bad Arguments for WallStructure.setPoints"
                };
            this.points[e] = t
        }
        for (var n in this.points)
            this.points[n].parents.push(this)
    }, t.prototype.getPolygon = function() {
        return 0 == this._edgePolygons[0].length && this.computeDefault(0), 0 == this._edgePolygons[1].length && this.computeDefault(1), this._edgePolygons[0].concat(this._edgePolygons[1])
    }, t.prototype.getWallVector = function() {
        return this.points[1].position.subtract(this.points[0].position)
    }, t.prototype.getLength = function() {
        return this.getWallVector().length()
    }, t.prototype.draw = function(t) {
        var e = this.getPolygon();
        t.beginPath(), t.moveTo(e[0].x, e[0].y);
        for (var n = 1; n < e.length; n++)
            t.lineTo(e[n].x, e[n].y);
        t.fill(), this.type === this.TYPE_SEPARATOR && (t.lineWidth = 4, t.stroke())
    }, t.prototype.update = function(t) {
        this.updateAttachedPoints(t)
    }, t.prototype.translate = function() {
        Logger.warning("translate is virtual")
    }, t.prototype.getIntersections = function(t) {
        var e, n, i, o = t.getElements("walls"),
            r = 5,
            s = r * r,
            a = [];
        for (var l in o)
            if (o[l] !== this && (n = this, i = o[l], e = BABYLON.Vector2.Intersect(n.points[0].position, n.points[1].position, i.points[0].position, i.points[1].position), void 0 !== e && !(n.distanceFrom(e) > BABYLON.Vector2.Precision || i.distanceFrom(e) > BABYLON.Vector2.Precision))) {
                var h = [n.points[0].position, n.points[1].position, i.points[0].position, i.points[1].position],
                    c = !1;
                for (var u in h)
                    c = c || e.distanceToSquared(h[u]) < s;
                if (!c) {
                    var p = new PointStructure;
                    p.parents = [n, i], p.position.copyFrom(e), a.push(p)
                }
            }
        return a.sort(function(t, e) {
            return t.position.distanceToSquared(t.parents[0].points[0].position) - e.position.distanceToSquared(t.parents[0].points[0].position)
        }), a
    }, t.prototype.splitAtIntersections = function() {
        Logger.warning("splitAtIntersections is virtual")
    }, t.prototype.reorganizeOnSplit = function(t, e) {
        if (!(e.length <= 1)) {
            for (var n = [], i = [], o = 0, r = e.length; r > o; o++)
                n = n.concat(e[o].overtures), i = i.concat(e[o].attachedPoints), e[o].attachedPoints = [], e[o].subSlopes.forEach(function(t) {
                    t.remove()
                });
            for (var o = 0, r = n.length; r > o; o++) {
                var s = n[o].parentWall.getWallVector();
                s.normalize(), s.scaleInPlace(n[o].position.x);
                for (var a = s.add(n[o].parentWall.getPoints(0).position), l = 0; e[l] && !e[l].isPointOn(a);)
                    l++;
                e[l] ? (n[o].computePositionOnWallChange(e[l]), n[o].setParentWall(e[l])) : Logger.warning("Erreur d'attachage !")
            }
            for (var o = 0, r = i.length; r > o; o++) {
                for (var l = 0; e[l] && !e[l].isPointInPolygon(i[o].position);)
                    l++;
                e[l] ? (e[l].attachedPoints.push(i[o]), i[o].attachedTo = e[l]) : Logger.warning("Erreur d'attachage !")
            }
        }
    }, t.prototype.weakToStrong = function(t, e) {
        if (t.attachedTo != this)
            return Logger.warning("weakToStrong doit ��tre appel�� sur un point attach�� du mur"), !1;
        var n = this.getPoints(t.position.distanceTo(this.getPoints(0).position) < t.position.distanceTo(this.getPoints(1).position) ? 0 : 1);
        return n.attachedTo ? (n.unAttach(), t.unAttach(), t.forceMerge(n, e)) : (t.unAttach(), this.points[this.points.indexOf(n)] = t, t.parents.push(this), n.attachedTo = this, this.attachedPoints.push(n), n.parents.splice(n.parents.indexOf(this), 1), 0 == n.parents.length ? n.remove(e) : n.parents[0].needsUpdate = !0), t.parents[0].needsUpdate = !0, t.parents[1].needsUpdate = !0, !0
    }, t.prototype.tryMerge = function() {
        Logger.warning("tryMerge is virtual")
    }, t.prototype.updateAttachedPoints = function() {
        Logger.warning("updateAttachedPoints is virtual")
    }, t.prototype.updateOvertures = function(t) {
        for (var e = 0, n = this.overtures.length; n > e; e++)
            this.overtures[e] && (this.overtures[e].projectOnWall(), this.overtures[e].clampSize(!0, t))
    }, t.prototype.getNearestPoint = function(t, e) {
        var n, e = e || 0,
            i = this.getWallVector(),
            o = i.length(),
            r = t.subtract(this.getPoints(0).position);
        return r.projectOnVector(i), n = r.dot(i), -e * o >= n ? this.getPoints(0).position.subtract(i.normalize().scaleInPlace(e)) : n >= i.lengthSquared() + o * e ? this.getPoints(1).position.add(i.normalize().scaleInPlace(e)) : this.getPoints(0).position.add(r)
    }, t.prototype.getNearestPointOnAxe = function(t) {
        var e, n = this.getWallVector(),
            i = t.subtract(this.points[0].position);
        return i.projectOnVector(n), e = i.dot(n), this.points[0].position.add(i)
    }, t.prototype.getNearestPointOnRect = function() {
        Logger.warning("getNearestPointOnRect is virtual")
    }, t.prototype.isPointInPolygon = function(t) {
        var e = this.getPolygon();
        return e[0] && t.isPointInPolygon(e) ? !0 : !1
    }, t.prototype.getNearestPointOnPolygon = function(t) {
        if (this.isPointInPolygon(t))
            return t.clone();
        var e = this.getPolygon();
        if (!e[0])
            return Logger.warning("getNearestPointOnPolygon a ��t�� appel�� sur un mur au polygone vide"), null;
        for (var n, i, o = +1 / 0, r = null, s = 0, a = e.length; a > s; s++)
            i = t.projectOnSegment(e[s], e[(s + 1) % a]), n = i.distanceTo(t), o > n && (r = i, o = n);
        return r
    }, t.prototype.getBoundingBox = function() {
        for (var t = +1 / 0, e = -1 / 0, n = +1 / 0, i = -1 / 0, o = this.getPolygon(), r = 0, s = o.length; s > r; r++)
            o[r].x < t && (t = o[r].x), o[r].x > e && (e = o[r].x), o[r].y < n && (n = o[r].y), o[r].y > i && (i = o[r].y);
        return {
            min: new BABYLON.Vector2(t, n),
            max: new BABYLON.Vector2(e, i)
        }
    }, t.prototype.getNearestWall = function(t, e) {
        for (var n, i = e.getElements("walls"), o = null, r = +1 / 0, s = 0, a = i.length; a > s; s++)
            n = i[s].distanceFrom(t), r > n && (o = i[s], r = n);
        return o
    }, t.prototype.distanceFrom = function(t) {
        var e = this.getNearestPoint(t),
            n = new BABYLON.Vector2;
        return n = t.subtract(e), n.length()
    }, t.prototype.distanceFromRect = function(t, e, n) {
        var i = this.getNearestPointOnRect(t, e, n),
            o = new BABYLON.Vector2;
        return o = t.subtract(i), o.length()
    }, t.prototype.vectorTo = function(t) {
        var e = this.getNearestPoint(t),
            n = new BABYLON.Vector2;
        return n = t.subtract(e)
    }, t.prototype.isPointOn = function(t, e) {
        var e = e || 1e-5,
            n = this.distanceFrom(t);
        return e >= n
    }, t.prototype.getNormalVector = function(t) {
        var t = void 0 === t ? 1 : t,
            e = new BABYLON.Vector2(this.points[0].position.y - this.points[1].position.y, this.points[1].position.x - this.points[0].position.x);
        return e.normalize(), e.scaleInPlace(t), e
    }, t.prototype.sortAttached = function() {
        var t = this;
        t.attachedPoints.sort(function(e, n) {
            return e.position.distanceToSquared(t.points[0].position) - n.position.distanceToSquared(t.points[0].position)
        })
    }, t.prototype.getAllPoints = function(t) {
        var e = [this.getPoints(0)];
        return this.sortAttached(), e = e.concat(this.attachedPoints), e.push(this.getPoints(1)), -1 == t && e.reverse(), e
    }, t.prototype.remove = function(t) {
        for (var e = 0, n = this.points.length; n > e; e++)
            for (var i = this.points[e].parents.length - 1; i >= 0; i--)
                this.points[e].parents[i] == this && this.points[e].parents.splice(i, 1);
        for (var o, e = this.attachedPoints.length - 1; e >= 0; e--)
            o = this.attachedPoints[e], o.unAttach(), o.needsUpdate = !0, o.parents[0] && (o.parents[0].needsUpdate = !0);
        if (void 0 != t) {
            for (var e = 0, n = this.points.length; n > e; e++)
                o = this.points[e], 0 == o.parents.length ? (o.unAttach(t), o.remove(t)) : o.needsUpdate = !0;
            for (var e = this.overtures.length - 1; e >= 0; e--)
                this.overtures[e].remove(t);
            t.removeElement("walls", this)
        }
    }, t.prototype.addToStructure = function(t) {
        for (var e in this.points)
            t.insertElement("points", this.points[e]);
        t.insertElement("walls", this)
    }, t.prototype.paralleleTo = function(t) {
        return void 0 === BABYLON.Vector2.Intersect(this.getPoints(0).position, this.getPoints(1).position, t.getPoints(0).position, t.getPoints(1).position)
    }, t.prototype.addMaterial = function(t, e, n, i) {
        return Logger.warning("WallStructure.addMaterial is deprecated"), null
    }, t
}();
var WallPane3D = function() {
    var t = function(t, e, n) {
        MeasureStructure.call(this, t, e, n), this.materialInfo = null, this.room = null, this.materialIndex = -1
    };
    return t.prototype = new MeasureStructure, t.prototype.setRoom = function(t) {
        this.room = t
    }, t.prototype.nearestPane = function(t) {
        for (var e, n = this.center(), i = null, o = +1 / 0, r = 0, s = t.length; s > r; r++)
            t[r] !== this && (e = t[r].center().distanceTo(n), o > e && (o = e, i = t[r]));
        return i
    }, t.prototype.nearestMaterial = function(t) {
        for (var e, n = this.center(), i = null, o = +1 / 0, r = 0, s = t.length; s > r; r++)
            e = t[r].center.distanceTo(n), o > e && (o = e, i = r);
        return i
    }, t.prototype.addMaterial = function(t) {
        this.materialInfo || (this.materialInfo = MaterialInfo.MakeFromPane(this));
        var e = this.materialInfo.material ? this.materialInfo.material.clone(this.materialInfo.material.name) : null;
        return this.materialInfo.material = t, this.room.panesMaterials[this.room.panes.indexOf(this)] = this.materialInfo, e
    }, t.prototype.serialize = function() {
        return this.materialInfo ? this.materialInfo.serialize() : null
    }, t.Deserialize = function(t) {
        var e = new MaterialInfo;
        return e.deserialize(t), e
    }, t
}();
PolygonWall = function() {
    var t = function() {
        WallStructure.call(this, "PolygonWall"), this.polygonPoints = [], this.instance = "polygon"
    };
    return t.prototype = new WallStructure, t.prototype.serialize = function() {
        var t = WallStructure.prototype.serialize.call(this);
        return t.class.name = "PolygonWall", t
    }, t.prototype.deserialize = function(t) {
        WallStructure.prototype.deserialize.call(this, t)
    }, t.Deserialize = function(e) {
        var n = new t;
        return n.deserialize(e), n
    }, t.prototype.getAxis = function() {
        var t = (this.getWallVector(), this.getNormalVector(this.thickness / 2)),
            e = this.getPoints(0).position,
            n = this.getPoints(1).position;
        return [
            [e.add(t), n.add(t)],
            [e.subtract(t), n.subtract(t)]
        ]
    }, t.prototype.translate = function(e, n) {
        for (var i = function(e, i, o) {
                var r = new t,
                    s = new PointStructure;
                s.position.copyFrom(e.position), s.parents = [r, i], e.parents = [o, r], r.points = [e, s], r.thickness = Math.min(i.thickness, o.thickness), r.height = o.height, r.type = i.type;
                var a = i.points[0] == e ? 0 : 1;
                i.points[a] = s, n.insertElement("walls", r), n.insertElement("points", s)
            }, o = Math.PI / 8, r = this.points[0].position.add(e), s = this.points[1].position.add(e), a = null, l = null, h = 0, c = this.points[0].parents.length; c > h; h++)
            this.points[0].parents[h] != this && (a = this.points[0].parents[h], a.needsUpdate = !0);
        for (var h = 0, c = this.points[1].parents.length; c > h; h++)
            this.points[1].parents[h] != this && (l = this.points[1].parents[h], l.needsUpdate = !0);
        var u, p = .01,
            d = function(t, a, l) {
                if (null !== t) {
                    var h = t.getPoints(0).position,
                        c = t.getPoints(1).position;
                    if (t.getLength() < p && (c = h.add(e)), u = BABYLON.Vector2.GetAbsoluteSine(r, s, h, c), o > u && void 0 !== n)
                        t.getLength() > 0 && i(this.points[a], t, this);
                    else {
                        var d = BABYLON.Vector2.Intersect(r, s, h, c);
                        d && l.copyFromFloats(d.x, d.y)
                    }
                }
            }.bind(this);
        d(a, 0, r), d(l, 1, s);
        this.getPoints(0).position.clone(), this.getPoints(1).position.clone();
        this.getPoints(0).position.x = r.x, this.getPoints(0).position.y = r.y, this.getPoints(1).position.x = s.x, this.getPoints(1).position.y = s.y;
        var m, g = function(t) {
            var e = this.getPoints(0).position,
                i = this.getPoints(1).position,
                o = t.parents[0];
            return m = BABYLON.Vector2.Intersect(e, i, o.getPoints(0).position, o.getPoints(1).position), void 0 === m ? (t.unAttach(n), !1) : (m = new BABYLON.Vector2(m.x, m.y), this.distanceFromRect(m, 0, n) > BABYLON.Vector2.Precision ? !0 : !1)
        };
        if (void 0 !== n) {
            a && a.updateOvertures(n), l && l.updateOvertures(n), this.updateAttachedPoints(n);
            for (var f, h = 0; 2 > h; h++)
                f = this.getPoints(h).attachedTo, f && (g.call(f, this.getPoints(h)) ? (m && this.getPoints(h).position.copyFrom(m), f.weakToStrong(this.getPoints(h), n)) : this.getPoints(h).position.copyFrom(m))
        }
    }, t.prototype.getIntersections = function(t) {
        var e, n, i, o = t.getElements("walls"),
            r = 5,
            s = r * r,
            a = [];
        for (var l in o)
            if (o[l] !== this && (n = this, i = o[l], e = BABYLON.Vector2.Intersect(n.points[0].position, n.points[1].position, i.points[0].position, i.points[1].position), void 0 !== e && !(n.distanceFrom(e) > BABYLON.Vector2.Precision || i.distanceFrom(e) > BABYLON.Vector2.Precision))) {
                var h = [n.points[0].position, n.points[1].position, i.points[0].position, i.points[1].position],
                    c = !1;
                for (var u in h)
                    c = c || e.distanceToSquared(h[u]) < s;
                if (!c) {
                    var p = new PointStructure;
                    p.parents = [n, i], p.position.copyFrom(e), a.push(p)
                }
            }
        return a.sort(function(t, e) {
            return t.position.distanceToSquared(t.parents[0].points[0].position) - e.position.distanceToSquared(t.parents[0].points[0].position)
        }), a
    }, t.prototype.splitAtIntersections = function(e) {
        var n = this.getIntersections(e),
            i = [this];
        for (var o in n) {
            var r = new t,
                s = new PointStructure;
            s.position.copyFrom(n[o].position), s.parents = [r], r.points = [this.getPoints(0), s], r.getPoints(0).replaceParent(this, r), r.thickness = this.thickness, r.type = this.type, r.height = this.height, n[o].parents[1].attachedPoints.push(s), s.attachedTo = n[o].parents[1], n[o].parents[1].attachedPoints.push(n[o]), n[o].attachedTo = n[o].parents[1], this.points[0] = n[o], this.points[0].parents = [this], e.insertElement("walls", r), e.insertElement("points", n[o]), e.insertElement("points", s), i.push(r), r.needsUpdate = !0
        }
        this.needsUpdate = !0, t.prototype.reorganizeOnSplit(e, i)
    }, t.prototype.tryMerge = function(e) {
        for (var n = e.getElements("walls"), i = (e.getElements("points"), function(t, e, n, i) {
                return -1 != i.indexOf(t) && i.splice(i.indexOf(t), 1), -1 != i.indexOf(e) && i.splice(i.indexOf(e), 1), void 0 !== n && i.push(n), i
            }), o = 15, r = Math.PI / 18, s = 0, a = n.length; a > s; s++)
            if (n[s] != this) {
                var l, h, c, u, p = this,
                    d = n[s],
                    m = p.getPoints(),
                    g = d.getPoints();
                if (l = p.distanceFrom(g[0].position), h = p.distanceFrom(g[1].position), c = d.distanceFrom(m[0].position), u = d.distanceFrom(m[1].position), !(l > o && h > o && c > o && u > o) && p.thickness == d.thickness && p.type == d.type && p.height == d.height) {
                    var f, y = p.getWallVector(),
                        _ = d.getWallVector(),
                        v = new BABYLON.Vector2(y.x, y.y).normalize(),
                        b = new BABYLON.Vector2(_.x, _.y).normalize();
                    if (f = Math.abs(v.determinant(b)), !(f > r)) {
                        for (var w, x, C, M, D, B = -1 / 0, A = [m[0], m[1], g[0], g[1]], E = 0; 4 > E; E++)
                            for (var T = 0; 4 > T; T++)
                                if (E != T && (D = A[E].position.subtract(A[T].position).length(), D > B)) {
                                    w = A[E], x = A[T];
                                    for (var S = -1, L = -1, O = 0; 4 > O; O++)
                                        O != E && O != T && (-1 != S ? -1 == L && (L = O) : S = O);
                                    C = A[S], M = A[L], B = D
                                }
                        var P, I;
                        if (P = C.wallAttached(e), I = M.wallAttached(e), !P || P !== I) {
                            var N = new t;
                            N.points[0] = w, N.points[1] = x, N.attachedPoints = p.attachedPoints.concat(d.attachedPoints);
                            for (var R = 0; R < N.attachedPoints.length; R++)
                                N.attachedPoints[R].attachedTo = N;
                            N.thickness = p.thickness, N.type = p.type, N.height = p.height;
                            for (var E = p.overtures.length - 1; E >= 0; E--)
                                p.overtures[E].computePositionOnWallChange(N), p.overtures[E].setParentWall(N);
                            for (var E = d.overtures.length - 1; E >= 0; E--)
                                d.overtures[E].computePositionOnWallChange(N), d.overtures[E].setParentWall(N);
                            e.insertElement("walls", N), w.parents = i(p, d, N, w.parents), x.parents = i(p, d, N, x.parents), w.unAttach(e), x.unAttach(e), w.position = d.getLength() > 5 ? d.getNearestPointOnAxe(w.position) : p.getNearestPointOnAxe(w.position), x.position = d.getLength() > 5 ? d.getNearestPointOnAxe(x.position) : p.getNearestPointOnAxe(x.position);
                            for (var E = 0, a = N.attachedPoints.length; a > E; E++)
                                N.attachedPoints[E].position = N.getNearestPoint(N.attachedPoints[E].position);
                            for (var k = [C, M], E = 0; 2 > E; E++)
                                if (k[E] !== w && k[E] !== x)
                                    if (void 0 != k[E].parents[0] && void 0 != k[E].parents[1]) {
                                        if (k[E].parents[0] == p && k[E].parents[1] == d || k[E].parents[0] == d && k[E].parents[1] == p)
                                            k[E].unAttach(e), k[E].remove(e);
                                        else if (k[E].parents = i(p, d, void 0, k[E].parents), k[E].position = N.getNearestPoint(k[E].position), k[E].parents[0] !== N) {
                                            var V = k[E].tryMerge(e);
                                            V === k[E] && (N.attachedPoints.push(k[E]), k[E].attachedTo = N, k[E].position = N.getNearestPoint(k[E].position))
                                        }
                                    } else
                                        k[E].unAttach(e), k[E].remove(e);
                            return p.remove(e), d.remove(e), w.needsUpdate = !0, x.needsUpdate = !0, N.tryMerge(e)
                        }
                    }
                }
            }
        return this
    }, t.prototype.updateAttachedPoints = function(t) {
        for (var e = this.attachedPoints.length - 1; e >= 0; e--) {
            var n = this.attachedPoints[e].parents[0],
                i = this.getPoints(0).position,
                o = this.getPoints(1).position;
            if (n) {
                var r = BABYLON.Vector2.Intersect(i, o, n.getPoints(0).position, n.getPoints(1).position, Math.PI / 18),
                    s = this.attachedPoints[e];
                if (void 0 !== r) {
                    if (this.distanceFrom(r) > BABYLON.Vector2.Precision) {
                        this.attachedPoints[e].position.copyFrom(r);
                        var s = this.attachedPoints[e];
                        this.weakToStrong(this.attachedPoints[e], t)
                    } else
                        this.attachedPoints[e].position.copyFrom(r);
                    n.needsUpdate = !0, n.updateOvertures(t)
                } else
                    s.unAttach(t), s.needsUpdate = !0
            } else
                Logger.warning("Un point attach�� n'a plus de parent !"), Logger.warning(this)
        }
    }, t.prototype.getNearestPointOnRect = function(t, e) {
        for (var e = e || 0, n = this.getPolygon(), i = [], o = this.getWallVector().normalize(), r = 0, s = n.length; s > r; r++)
            i.push(this.getNearestPointOnAxe(n[r]));
        for (var a, l = +1 / 0, h = -1 / 0, c = new BABYLON.Vector2, u = this.getPoints(0).position, r = 0, s = i.length; s > r; r++)
            a = c.copyFrom(i[r]).subtractInPlace(u).dot(o), l > a && (l = a), a > h && (h = a);
        var a, p = o.scale(l).addInPlace(u),
            d = o.scale(h).addInPlace(u),
            m = d.subtract(p),
            g = m.length(),
            f = t.subtract(p);
        return f.projectOnVector(m), a = f.dot(m), -e * g >= a ? p.subtract(m.normalize().scaleInPlace(e)) : a >= m.lengthSquared() + g * e ? d.add(m.normalize().scaleInPlace(e)) : p.add(f)
    }, t
}();
CurvedWall = function() {
    var t = function() {
        PolygonWall.call(this, "CurvedWall"), this.TYPE_NORMAL = 1, this.TYPE_SEPARATOR = 2, this.type = this.TYPE_NORMAL, this.polygonPoints = [], this.instance = "curved", this.cp = null
    };
    return t.prototype = new PolygonWall, t.prototype.serialize = function() {
        var t = PolygonWall.prototype.serialize.call(this);
        return t.type = this.type, t.cp = {
            x: this.cp.x,
            y: this.cp.y,
            z: this.cp.z
        }, t
    }, t.prototype.isTargeted = function(t) {
        var e = document.createElement("canvas"),
            n = e.getContext("2d");
        if (this.draw(n), n.isPointInPath(t.x, t.y))
            return delete e, !0;
        var i = this.getCp();
        return t.distanceTo(i) < 10 ? (delete e, i) : (n.beginPath(), n.moveTo(this.getPoints(0).position.x, this.getPoints(0).position.y), n.quadraticCurveTo(i.x, i.y, this.getPoints(1).position.x, this.getPoints(1).position.y), n.lineTo(i.x, i.y), n.closePath(), n.isPointInPath(t.x, t.y) ? (delete e, !0) : (delete e, !1))
    }, t.prototype.computeDefault = function(t) {
        this.computeCp();
        var e = this.getCp(),
            n = this.getPoints(t).position.clone().subtractInPlace(e).normalize().scaleInPlace(this.thickness / 2),
            i = new BABYLON.Vector3(n.y, -n.x, 0),
            o = this.getPoints(t).position,
            r = o.clone().subtractInPlace(i),
            s = o.clone(),
            a = o.clone().add(i);
        this._edgePolygons[t] = [a, s, r]
    }, t.prototype.translate = function(t, e) {
        PolygonWall.prototype.translate.call(this, t, e), this.getCp().add(t)
    }, t.prototype.computeCp = function(t) {
        var t = t || !1;
        if (this.cp && !t)
            var e = this.cp;
        else {
            var e = this.getPoints(0).position.clone().lerp(this.getPoints(1).position, .5);
            e.add(this.getNormalVector(this.getLength() / 2))
        }
        var n = this.getNormalVector(this.thickness / 2),
            i = e.clone().subtractInPlace(n),
            o = e.clone().add(n);
        this.cp = e, this._edgePolygons[2] = [i, o]
    }, t.prototype.deserialize = function(t) {
        PolygonWall.prototype.deserialize.call(this, t), this.type = t.type, this.cp = new BABYLON.Vector3(t.cp.x, t.cp.y, t.cp.z)
    }, t.prototype.getAxis = function(t) {
        var e = this.getCp(),
            n = this.getPoints(t).position.clone().subtractInPlace(e).normalize().scaleInPlace(this.thickness / 2),
            i = new BABYLON.Vector3(n.y, -n.x, 0),
            o = this.getPoints(t).position,
            r = e,
            s = o.clone().add(i),
            a = r.clone().add(i),
            l = o.clone().subtractInPlace(i),
            h = r.clone().subtractInPlace(i);
        return 1 == t ? [
            [h, l],
            [a, s]
        ] : [
            [s, a],
            [l, h]
        ]
    }, t.prototype.getCp = function() {
        return this.cp || this.computeCp(), this.cp
    }, t.prototype.draw = function(t) {
        var e = this._edgePolygons[0],
            n = this._edgePolygons[1];
        "undefined" == typeof this._edgePolygons[2] && this.computeCp();
        var i = this._edgePolygons[2];
        t.beginPath(), t.moveTo(e[2].x, e[2].y), t.quadraticCurveTo(i[0].x, i[0].y, n[0].x, n[0].y), t.lineTo(n[1].x, n[1].y), t.lineTo(n[2].x, n[2].y), t.quadraticCurveTo(i[1].x, i[1].y, e[0].x, e[0].y), t.lineTo(e[1].x, e[1].y), t.fill()
    }, t
}();
var WallComponent2D = function() {
    var t = function(t) {
        BaseComponent2D.call(this, t, "WallComponent2D"), this.TYPE_NORMAL = 1, this.TYPE_SEPARATOR = 2, this._COLORS = ["#333333", "#616161", "#BEBEBE", "#EEEEEE"], this._PATTERNS = [null, null, null, null], this._PATTERN_IMGS = [new Image, new Image, null, null], this._PATTERN_IMGS[0].addEventListener("load", function() {
            this._PATTERNS[0] = hcsdesign.engine2D.canvas.getContext("2d").createPattern(this._PATTERN_IMGS[0], "repeat"), hcsdesign.engine2D.requestStaticDraw()
        }.bind(this), !1), this._PATTERN_IMGS[1].addEventListener("load", function() {
            this._PATTERNS[1] = hcsdesign.engine2D.canvas.getContext("2d").createPattern(this._PATTERN_IMGS[1], "repeat"), hcsdesign.engine2D.requestStaticDraw()
        }.bind(this), !1), this._PATTERN_IMGS[0].src = hcs.Assets.globalPath + "js/Components/CoreComponents/Wall/Images/pattern.png", this._PATTERN_IMGS[1].src = hcs.Assets.globalPath + "js/Components/CoreComponents/Wall/Images/pattern_tmp.png", this.priority = 10, this._tmpWall = null, this._tmpThickness = 20, this._tmpType = this.TYPE_NORMAL, this._tmpDragStartPt = null, this._lastPlanPos = new BABYLON.Vector3, this._updateList = [], this._applyHeightToAll = !1, this._minWallLengthRatio = .01, this._draggingMinWallLengthRatio = .5, this.displayMesure = !0
    };
    return t.prototype = new BaseComponent2D, t.WALL_OFFSET = 10, t.prototype.startListening = function() {
        this.onAddWall = this.onAddWall.bind(this), this.onAddWallEnd = this.onAddWallEnd.bind(this), document.addEventListener("hcs.engine2d.onAddWall", this.onAddWall, !1), document.addEventListener("hcs.engine2d.onAddWallEnd", this.onAddWallEnd, !1), this.core.engine2D.registerEventCb("WallComponent2D.static-draw", this.priority, "static-draw", null, null, this.onStaticDraw.bind(this), null), this.core.engine2D.registerEventCb("WallComponent2D.hover", this.priority, "hover", this.core.engine2D.MODE_NORMAL | this.core.engine2D.MODE_DRAW | this.core.engine2D.MODE_CONTEXTMENU, WallStructure, this.onHover.bind(this), null), this.core.engine2D.registerEventCb("WallComponent2D.leave", this.priority, "leave", this.core.engine2D.MODE_NORMAL | this.core.engine2D.MODE_DRAW | this.core.engine2D.MODE_CONTEXTMENU, WallStructure, this.onLeave.bind(this), null), this.core.engine2D.registerEventCb("WallComponent2D.double-click", this.priority, "double-click", this.core.engine2D.MODE_NORMAL, WallStructure, this.onDoubleClick.bind(this), null), this.core.engine2D.registerEventCb("WallComponent2D.context-menu", this.priority, "click", this.core.engine2D.MODE_NORMAL, WallStructure, this.onContextMenu.bind(this), null), GlobalHelper.isMobileDevice() && hcsdesign.engine2D.registerEventCb("WallComponent2D.mobile-drag-start", this.priority, "drag-start", hcsdesign.engine2D.MODE_NORMAL, null, this.onMobileDragStart.bind(this), null)
    }, t.prototype.stopListening = function() {
        document.removeEventListener("hcs.engine2d.onAddWall", this.onAddWall, !1), document.removeEventListener("hcs.engine2d.onAddWallEnd", this.onAddWallEnd, !1), this.core.engine2D.unregisterEventCb("WallComponent2D.static-draw"), this.core.engine2D.unregisterEventCb("WallComponent2D.hover"), this.core.engine2D.unregisterEventCb("WallComponent2D.leave"), this.core.engine2D.unregisterEventCb("WallComponent2D.double-click"), this.core.engine2D.unregisterEventCb("WallComponent2D.context-menu"), GlobalHelper.isMobileDevice() && hcsdesign.engine2D.unregisterEventCb("WallComponent2D.drag-start")
    }, t.prototype.initialize = function() {
        this.startListening();
        var t = {
            title: _("房间和墙"),
            id: "rooms_walls",
            items: [
                {
                    title: _("承重墙"),
                    action: "hcs.engine2d.onAddWall",
                    cancelAction: "hcs.engine2d.onAddWallEnd",
                    params: {
                        wallType: this.TYPE_NORMAL,
                        thickness: 30,
                        putPoint: !1
                    }
                },
                {
                    title: _("墙"),
                    action: "hcs.engine2d.onAddWall",
                    cancelAction: "hcs.engine2d.onAddWallEnd",
                    params: {
                        wallType: this.TYPE_NORMAL,
                        thickness: 7,
                        putPoint: !1
                    }
                }/*,
                {
                    title: _("房间分割线"),
                    cancelAction: "hcs.engine2d.onAddWallEnd",
                    action: "hcs.engine2d.onAddWall",
                    params: {
                        wallType: this.TYPE_SEPARATOR,
                        thickness: .2,
                        putPoint: !1
                    }
                }*/
            ]};
        ujs.notify("hcs.menu.main.add", {item: t,menuPath: "draw2D",position: .5})
    }, t.prototype.update = function(t) {
        var e, n = t || this.structure.getCurrentStructure(),
            i = n.getElements("walls");
        this._updateList.length = 0;
        for (var o = i.length - 1; o >= 0; o--)
            i[o].needsUpdate && (this._updateList.push(i[o]), i[o].needsUpdate = !1);
        for (var o = this._updateList.length - 1; o >= 0; o--) {
            for (var r = 0; 2 > r; r++)
                1 == this._updateList[o].getPoints(r).parents.length && this._updateList[o].computeDefault(r);
            this._updateList[o].computeCp && this._updateList[o].computeCp()
        }
        for (var o = this._updateList.length - 1; o >= 0; o--)
            for (var r = 0; 2 > r; r++)
                if (2 == this._updateList[o].getPoints(r).parents.length)
                    for (var s = 0; 2 > s; s++)
                        e = this._updateList[o].getPoints(r).parents[s].getPoints().indexOf(this._updateList[o].getPoints(r)), this._updateList[o].getPoints(r).parents[s].computeStrong(e);
        for (var o = this._updateList.length - 1; o >= 0; o--) {
            for (var r = 0; 2 > r; r++)
                this._updateList[o].getPoints(r).attachedTo && this._updateList[o].computeWeak(r);
            this._updateList[o].needsUpdate = !1, this._updateList[o].update(n)
        }
        this._updateList.length && n.dirty()
    }, t.prototype.getTargeted = function(t) {
        var e = this.structure.getCurrentStructure().getElements("walls");
        for (var n in e)
            if (e[n].isTargeted(t))
                return e[n];
        return null
    }, t.prototype.simplifyWalls = function() {
        for (var t = this.structure.getCurrentStructure(), e = t.getElements("walls"), n = t.getElements("points"), i = e.length - 1; i >= 0; i--) {
            var o, r;
            e[i].getLength() < this._minWallLengthRatio * e[i].thickness && (o = e[i].points[0], r = e[i].points[1], e[i].remove(t), -1 != n.indexOf(o) && o.forceMerge(r, t))
        }
    }, t.prototype._drawWall = function(t, e, n, i, o) {
        var o = o || {},
            r = (o.measureDisplayed === !1 ? !1 : !0, o.styleId || 0);
        t.fillStyle = this._PATTERNS[r] || this._COLORS[r], t.strokeStyle = this._COLORS[r], t.save(), t.translate(e.x, e.y), t.scale(n, n), i.draw(t), t.restore()
    }, t.prototype._drawMeasures = function(t, e, n) {
        hcsdesign.getComponentByName("MeasureComponent").draw(t, e, n)
    }, t.prototype._addWallFirstPoint = function(t, e) {
        var n = hcsdesign.getComponentByName("MagnetismComponent2D", hcsdesign.ENGINE_2D),
            i = (hcsdesign.getComponentByName("PointComponent2D", hcsdesign.ENGINE_2D), hcsdesign.getSelectedStructure());
        this._tmpWall = new PolygonWall, this._tmpWall.height = i.height, this._tmpWall.thickness = this._tmpThickness, this._tmpWall.type = this._tmpType || this._tmpWall.TYPE_NORMAL;
        var o = e || new PointStructure,
            r = new PointStructure;
        e || (o.position = t.planPos.clone()), r.position = t.planPos.clone(), e || (n && n.addVirtualPoint(this.name, o), hcsdesign.engine2D.setEnableAutoScroll(!0)), n && n.onWallDrawStart(o), this._tmpWall.setPoints([o, r]), hcsdesign.engine2D.requestStaticDraw()
    }, t.prototype._addWallNewPoint = function(t) {
        {
            var e = hcsdesign.getSelectedStructure(),
                n = hcsdesign.getComponentByName("MagnetismComponent2D", hcsdesign.ENGINE_2D);
            hcsdesign.getComponentByName("PointComponent2D", hcsdesign.ENGINE_2D)
        }
        n.removeVirtualPoint(this.name, null), this._tmpWall.getPoints(1).position = t.planPos.clone(), this._tmpWall.addToStructure(e);
        var i = !1,
            o = this._tmpWall.tryMerge(e);
        for (var r in this._tmpWall.points) {
            var s = o.points[r],
                a = o.points[r].tryMerge(e);
            s != a && (a.parents[0].update(e), a.parents[1].update(e), 1 == r && (i = !0))
        }
        return o.splitAtIntersections(e), i
    }, t.prototype._addWallUpdate = function(t) {
        var e = this._tmpWall.getPoints(1);
        e.position = t.planPos.clone(), this._tmpWall.setPoints(e, 1), this._tmpWall.needsUpdate = !0, hcsdesign.engine2D.requestDynamicDraw()
    }, t.prototype.onStaticDraw = function(t, e, n) {
        var i = !1;
        if (i = this.structure.getElement(+this.structure.getCurrentStructure().id - 1))
            for (var o = i.getElements("walls"), r = 0; r < o.length; r++)
                if (o[r].thickness >= 15) {
                    var s = {
                        measureDisplayed: !1,
                        styleId: 3
                    };
                    this._drawWall(t, e, n, o[r], s)
                }
        var a = this.structure.getCurrentStructure().getElements("walls");
        for (var r in a) {
            var s = {
                styleId: a[r].type == a[r].TYPE_SEPARATOR ? 2 : 0
            };
            this._drawWall(t, e, n, a[r], s)
        }
        this.displayMesure && (hcsdesign.getComponentByName("MeasureComponent").buildFromRooms(hcsdesign.getSelectedStructure().internalRooms, hcsdesign.getSelectedStructure().externalRooms), this._drawMeasures(t, e, n))
    }, t.prototype.onDragStart = function(t, e, n) {
        return e.targeted = e && e.isTargeted(n.planPos) instanceof BABYLON.Vector3 ? e.cp : !1, this._lastPlanPos.copyFrom(n.planPos), hcsdesign.engine2D.registerEventCb("WallComponent2D.dragging", this.priority, "dragging", hcsdesign.engine2D.MODE_DRAG, null, this.onDragging.bind(this), e), hcsdesign.engine2D.registerEventCb("WallComponent2D.drag-end", this.priority, "drag-end", hcsdesign.engine2D.MODE_DRAG, null, this.onDragEnd.bind(this), e), hcsdesign.engine2D.registerEventCb("WallComponent2D.dynamic-draw", this.priority, "dynamic-draw", hcsdesign.engine2D.MODE_DRAG, null, this.onSelectionDynamicDraw.bind(this), e), hcsdesign.engine2D.registerEventCb("WallComponent2D.drag.hover", this.priority, "hover", hcsdesign.engine2D.MODE_DRAG, WallStructure, this.onHover.bind(this), e), hcsdesign.engine2D.registerEventCb("WallComponent2D.drag.leave", this.priority, "leave", hcsdesign.engine2D.MODE_DRAG, WallStructure, this.onLeave.bind(this), e), !1
    }, t.prototype.onDragging = function(t, e, n, i) {
        var o;
        if (o = n.forcePosition ? n.forcePosition.clone().subtractInPlace(i.getPoints(0).position) : n.planPos.clone().subtractInPlace(this._lastPlanPos), this._lastPlanPos.copyFrom(n.planPos), i.needsUpdate = !0, i.targeted)
            return i.cp.addInPlace(mouseVector), hcsdesign.engine2D.requestStaticDraw(), !1;
        var r = o.clone().projectOnVector(i.getWallVector()),
            s = o.subtractInPlace(r);
        return i.translate(s, this.structure.getCurrentStructure()), i.getLength() < this._draggingMinWallLengthRatio * i.thickness && (i.remove(this.structure.getCurrentStructure()), hcsdesign.engine2D.setMode(hcsdesign.engine2D.MODE_NORMAL), this.simplifyWalls(), hcsdesign.getSelectedStructure().dirty(), hcsdesign.engine2D.requestStaticDraw(), hcsdesign.engine2D.unregisterEventCb("WallComponent2D.dynamic-draw")), hcsdesign.engine2D.requestStaticDraw(), !1
    }, t.prototype.onDragEnd = function(t, e, n, i) {
        var o = this.structure.getCurrentStructure(),
            r = o.getElements("walls");
        PolygonMerger.merge(r);
        var s = i.tryMerge(o),
            a = s.points[0],
            l = s.points[1];
        a.needsUpdate = !0, l.needsUpdate = !0;
        var h = a.parents[(a.parents.indexOf(s) + 1) % 2],
            c = l.parents[(l.parents.indexOf(s) + 1) % 2];
        h && h.splitAtIntersections(o), c && c.splitAtIntersections(o), s.splitAtIntersections(o);
        for (var u = 0, p = s.attachedPoints.length; p > u; u++)
            s.attachedPoints[u].parents[0] && s.attachedPoints[u].parents[0].splitAtIntersections(o);
        h && h.tryMerge(o), c && c.tryMerge(o);
        for (var u = 0, p = s.attachedPoints.length; p > u; u++)
            s.attachedPoints[u].parents[0] && s.attachedPoints[u].parents[0].tryMerge(o);
        this.update(), this.simplifyWalls(), hcsdesign.getComponentByName("PointComponent2D").update(), hcsdesign.getSelectedStructure().dirty(), hcsdesign.engine2D.requestStaticDraw(), hcsdesign.engine2D.unregisterEventCb("WallComponent2D.dynamic-draw"), hcsdesign.engine2D.unregisterEventCb("WallComponent2D.drag.hover"), hcsdesign.engine2D.unregisterEventCb("WallComponent2D.drag.leave"), this.update()
    }, t.prototype.onHover = function(t, e, n, i) {
        var e = i || e;
        return hcsdesign.engine2D.registerEventCb("WallComponent2D.dynamic-draw", this.priority, "dynamic-draw", null, null, this.onSelectionDynamicDraw.bind(this), e), hcsdesign.engine2D.registerEventCb("WallComponent2D.drag-start", this.priority, "drag-start", hcsdesign.engine2D.MODE_NORMAL, WallStructure, this.onDragStart.bind(this), null), hcsdesign.engine2D.requestDynamicDraw(), !1
    }, t.prototype.onLeave = function(t, e, n, i) {
        hcsdesign.engine2D.unregisterEventCb("WallComponent2D.dynamic-draw"), hcsdesign.engine2D.unregisterEventCb("WallComponent2D.drag-start"), hcsdesign.engine2D.requestDynamicDraw()
    }, t.prototype.onMobileDragStart = function(t, e, n, i) {
        return e ? this.onDragStart(t, e, n, i) : void 0
    }, t.prototype.onSelectionDynamicDraw = function(t, e, n, i) {
        var o = i.getPoints(),
            r = {
                x: o[0].position.x * n + e.x,
                y: o[0].position.y * n + e.y
            },
            s = {
                x: o[1].position.x * n + e.x,
                y: o[1].position.y * n + e.y
            };
        if ("curved" == i.instance) {
            var a = i.getCp(),
                l = {
                    x: a.x * n + e.x,
                    y: a.y * n + e.y
                };
            hcsdesign.engine2D.symbols2D.drawPoint(t, l), hcsdesign.engine2D.symbols2D.drawMeasure(t, r, l), hcsdesign.engine2D.symbols2D.drawMeasure(t, s, l), hcsdesign.engine2D.symbols2D.drawArc(t, r, l, s)
        } else
            hcsdesign.engine2D.symbols2D.drawSegment(t, r, s)
    }, t.prototype.onDoubleClick = function(t, e, n) {
        var i = hcsdesign.getSelectedStructure(),
            o = new PointStructure;
        o.position = e.getNearestPoint(n.planPos);
        var r = new PolygonWall;
        r.height = e.height, r.type = e.type, r.thickness = e.thickness, r.points = [o, e.getPoints(1)], e.points[1] = o, o.parents = [r, e], r.getPoints(1).parents.splice(r.getPoints(1).parents.indexOf(e), 1), r.getPoints(1).parents.push(r), r.reorganizeOnSplit(i, [r, e]), i.insertElement("points", o), i.insertElement("walls", r), hcsdesign.engine2D.requestStaticDraw()
    }, t.prototype.onAddWall = function(t) {
        if (/*hcsdesign.helpBubbleManager.display("hcs.2d.draw-wall"), */this._tmpThickness = t.thickness, this._tmpType = t.wallType, this._tmpRounded = t.rounded || !1, hcsdesign.engine2D.setMode(hcsdesign.engine2D.MODE_DRAW), hcsdesign.engine2D.registerEventCb("WallComponent2D.add-wall.dynamic-draw", this.priority, "dynamic-draw", hcsdesign.engine2D.MODE_DRAW, null, this.onAddWallDynamicDraw.bind(this), null), hcsdesign.engine2D.registerEventCb("WallComponent2D.add-wall.click", this.priority, "click", hcsdesign.engine2D.MODE_DRAW, null, this.onAddWallClick.bind(this), null), hcsdesign.engine2D.registerEventCb("WallComponent2D.add-wall.drag-start", this.priority, "drag-start", hcsdesign.engine2D.MODE_DRAW, null, this.onAddWallDragStart.bind(this), null), hcsdesign.engine2D.registerEventCb("WallComponent2D.add-wall.mouse-move", this.priority, "mouse-move", hcsdesign.engine2D.MODE_DRAW, null, this.onAddWallMouseMove.bind(this), null), hcsdesign.engine2D.registerEventCb("WallComponent2D.add-wall.draw-end", this.priority, "draw-end", hcsdesign.engine2D.MODE_DRAW, null, this.onAddWallDrawEnd.bind(this), null), 1 == t.putPoint) {
            var e = hcsdesign.engine2D.getMouseState(),
                n = hcsdesign.getComponentByName("MagnetismComponent2D", hcsdesign.ENGINE_2D);
            n.applyPointMag(e), this.onAddWallClick(t, null, e, null)
        }
    }, t.prototype.onAddWallEnd = function() {
        hcsdesign.engine2D.setMode(hcsdesign.engine2D.MODE_NORMAL)
    }, t.prototype.onAddWallClick = function(t, e, n, i) {
        var o = hcsdesign.getComponentByName("MagnetismComponent2D");
        if ("touchUp" == t.type && null != this._tmpWall && this.onAddWallMouseMove(t, e, n, i), hcsdesign.getSelectedStructure().dirty(), !i && null != this._tmpWall && this._tmpWall.getLength() <= 10)
            return hcsdesign.getComponentByName("PointComponent2D").update(), hcsdesign.engine2D.setMode(hcsdesign.engine2D.MODE_NORMAL), ujs.notify("hcs.menu.main.deselect"), o && o.onWallDrawEnd(), void hcsdesign.engine2D.requestStaticDraw();
        var r = !1;
        if (!i && null != this._tmpWall && (e instanceof WallStructure || e instanceof PointStructure) && (r = !0), null == this._tmpWall)
            this._addWallFirstPoint(n);
        else {
            var s = this._addWallNewPoint(n);
            r || s ? (this._tmpWall = null, hcsdesign.getComponentByName("PointComponent2D").update(), hcsdesign.getSelectedStructure().update(), hcsdesign.engine2D.setMode(hcsdesign.engine2D.MODE_NORMAL), ujs.notify("hcs.menu.main.deselect"), o && o.onWallDrawEnd(), hcsdesign.engine2D.requestStaticDraw()) : this._addWallFirstPoint(n, this._tmpWall.getPoints(1))
        }
    }, t.prototype.onAddWallDragStart = function(t, e, n) {
        return 0 == (n.buttons & n.BUTTON_LEFT) ? !0 : (this._tmpDragStartPt = n.planPos.clone(), hcsdesign.engine2D.registerEventCb("WallComponent2D.add-wall.drag-end", this.priority, "drag-end", hcsdesign.engine2D.MODE_DRAG, null, this.onAddWallDragEnd.bind(this), null), hcsdesign.engine2D.registerEventCb("WallComponent2D.add-wall.dragging", this.priority, "dragging", hcsdesign.engine2D.MODE_DRAG, null, this.onAddWallMouseMove.bind(this), null), !1)
    }, t.prototype.onAddWallDragEnd = function(t, e, n, i) {
        hcsdesign.getSelectedStructure().dirty();
        var o = hcsdesign.getComponentByName("MagnetismComponent2D");
        if (!i && null != this._tmpWall && this._tmpWall.getLength() <= 10)
            return hcsdesign.getComponentByName("PointComponent2D").update(), hcsdesign.engine2D.setMode(hcsdesign.engine2D.MODE_NORMAL), ujs.notify("hcs.menu.main.deselect"), void(o && o.onWallDrawEnd());
        var r = !1;
        if (null != this._tmpWall && (e instanceof WallStructure || e instanceof PointStructure) && (r = !0), null == this._tmpWall)
            this._addWallFirstPoint(n);
        else {
            var s = this._addWallNewPoint(n);
            r || s ? (this._tmpWall = null, hcsdesign.getComponentByName("PointComponent2D").update(), hcsdesign.getSelectedStructure().dirty(), hcsdesign.engine2D.setMode(hcsdesign.engine2D.MODE_NORMAL), ujs.notify("hcs.menu.main.deselect"), o && o.onWallDrawEnd()) : this._addWallFirstPoint(n, this._tmpWall.getPoints(1))
        }
    }, t.prototype.onAddWallMouseMove = function(t, e, n) {
        if (null != this._tmpWall && null == this._tmpDragStartPt)
            this._tmpWall.needsUpdate = !0, this._addWallUpdate(n);
        else if (null != this._tmpDragStartPt && this._tmpDragStartPt.distanceTo(n.planPos) > 10) {
            var n = n;
            n.planPos = this._tmpDragStartPt, this._tmpDragStartPt = null, this.onAddWallClick(t, e, n, !0)
        }
    }, t.prototype.onAddWallDynamicDraw = function(t, e, n) {
        if (null != this._tmpWall) {
            this._tmpWall.getLength() > 5 && (this._tmpWall.computeCp && this._tmpWall.computeCp(!0), this._tmpWall.computeDefault(0), this._tmpWall.computeDefault(1), this._drawWall(t, e, n, this._tmpWall, {
                styleId: 1
            }), this.displayMesure && hcsdesign.getComponentByName("MeasureComponent").drawTmpWallMesure(t, e, n));
            var i = {
                x: this._tmpWall.points[0].position.x,
                y: this._tmpWall.points[0].position.y
            };
            i.x = i.x * n + e.x, i.y = i.y * n + e.y, 1 == this._tmpWall.points[0].parents.length ? hcsdesign.engine2D.symbols2D.drawCancelGrip(t, i, [!1, !1, !1, !1], 0) : hcsdesign.engine2D.symbols2D.drawCheckGrip(t, i, [!1, !1, !1, !1], 0);
            var o = hcsdesign.engine2D.getTarget();
            (o instanceof WallStructure || o instanceof PointStructure) && hcsdesign.engine2D.setCursorIcon(hcsdesign.engine2D.symbols2D.drawCursorCheck.bind(hcsdesign.engine2D.symbols2D))
        }
    }, t.prototype.onAddWallDrawEnd = function() {
        null != this._tmpWall && this._tmpWall.remove(), this._tmpWall = null, this._tmpDragStartPt = null;
        var t = hcsdesign.getComponentByName("MagnetismComponent2D", hcsdesign.ENGINE_2D);
        t.removeVirtualPoint(this.name, null), hcsdesign.engine2D.requestStaticDraw()
    }, t.prototype.onContextMenu = function(t, e) {
        var n = [];
        e.type != e.TYPE_SEPARATOR && (n.push({
            name: "thickness",
            label: _("厚度"),
            type: "slider",
            cast: "int",
            unit: "cm",
            value: {
                min: 3,
                max: 100,
                step: 1,
                value: e.thickness
            }
        }), n.push({
            name: "height",
            label: _("高度"),
            type: "slider",
            cast: "int",
            unit: "cm",
            value: {
                min: 20,
                max: 1e3,
                step: 10,
                value: e.height
            }
        }), n.push({
            name: "_applyHeightToAll",
            label: _("将高度应用到所有的墙"),
            type: "checkbox",
            cast: "bool",
            value: this._applyHeightToAll
        })), n.push({
            name: "measureDist",
            label: _("度量信息离目标物体的距离"),
            type: "slider",
            cast: "int",
            unit: "cm",
            value: {
                min: 5,
                max: 50,
                step: 1,
                value: e.measureDist
            }
        }), n.push({
            name: "measureDisplayed",
            label: _("显示度量信息"),
            type: "checkbox",
            cast: "bool",
            value: e.measureDisplayed
        }), hcsdesign.engine2D.displayContextMenu(n, e, this.onContextMenuPropertyChanged.bind(this), this.onContextMenuRemove.bind(this))
    }, t.prototype.onContextMenuPropertyChanged = function(t, e, n) {
        "_applyHeightToAll" == e ? this._applyHeightToAll = n : t[e] = n;
        var i = hcsdesign.getSelectedStructure(),
            o = i.getElements("walls");
        if ("height" != e && "_applyHeightToAll" != e || !this._applyHeightToAll) {
            for (var r = 0, s = 1; s < o.length; s++)
                o[r].height < o[s].height && (r = s);
            i.height = o[r].height
        } else {
            for (var s = 0; s < o.length; s++)
                o[s].height = t.height;
            i.height = t.height
        }
        hcsdesign.structure.updateFloorElevations(), t.needsUpdate = !0, hcsdesign.engine2D.requestStaticDraw()
    }, t.prototype.onContextMenuRemove = function(t) {
        var e = hcsdesign.getSelectedStructure();
        t.remove(e)
    }, t
}();
var WallComponent3D = function() {
    var t, e = function(e) {
        BaseComponent3D.call(this, e, "WallComponent3D"), this.walls = [], this.initialized = !1, this.defaultWallTexture = null, this.priority = 10, t = this, this._defaultMaterial = new hcs.WhiteMaterial("defaultWall", hcsdesign.engine3D.scene, {
            factor: 1
        })
    };
    e.prototype = new BaseComponent3D, e.prototype.onRoomsReady = function(e) {
        var n = e.floor || t.getFloor(),
            i = e.structure || t.core.getSelectedStructure();
        t.walls.length = 0;
        var o = t.draw(i);
        ujs.notify("hcs.engine3d.wallsReady", {
            floor: n,
            structure: i,
            walls: o
        })
    }, e.prototype.startListening = function() {
        document.addEventListener("hcs.engine3d.roomsReady", this.onRoomsReady, !1)
    }, e.prototype.stopListening = function() {
        document.addEventListener("hcs.engine3d.roomsReady", this.onRoomsReady, !1)
    }, e.prototype.get3DWallFrom2D = function(t) {
        return hcsdesign.engine3D.scene.getMeshByName("WallMesh_" + t.id)
    }, e.prototype.replaceWall = function(t, e) {
        -1 != hcsdesign.engine3D.scene.meshes.indexOf(t) && (e.name = t.name, e.id = t.id, e.boundingBoxes = t.boundingBoxes, e.objectInstances = t.objectInstances, e.decorate = t.decorate, e.receiveShadows = t.receiveShadows, t.dispose())
    };
    var n = function(t, e) {
        for (var n, i, o, r = 0, s = this.subMeshes.length; s > r; r++)
            3 * e.faceId >= this.subMeshes[r].indexStart && 3 * e.faceId < this.subMeshes[r].indexStart + this.subMeshes[r].indexCount && (n = this.objectInstances[r], n && (i = this.material.subMaterials[r].name, this.material.subMaterials[r] = t, n.materialInfo ? o = n.addMaterial(t) : "OvertureStructure" == n.name ? (o = n.material.clone(n.material.name), n.material = t) : (o = n.materials[i].clone(i), n.materials[i] = t, n.materials[i].name = i)));
        return o
    };
    return e.prototype.draw = function(t) {
        t = t || hcsdesign.getSelectedStructure();
        var e = hcsdesign.getComponentByName("RoomComponent2D").getInternalRooms(),
            i = hcsdesign.getComponentByName("RoomComponent2D").getExternalRooms(),
            o = hcsdesign.getComponentByName("MeasureComponent"),
            r = o.getInternalMeasures(),
            s = (o.getExternalMeasures(), t.getElements("walls")),
            a = hcsdesign.getComponentByName("FloorComponent3D").getFloor(t),
            l = new BABYLON.Mesh("WallMesh_" + t.id, hcsdesign.engine3D.scene),
            h = [],
            c = [],
            u = [],
            p = [],
            d = {};
        l.objectInstances = [], l.material = new BABYLON.MultiMaterial("wall_material", hcsdesign.engine3D.scene), l.material.subMaterials.push(new hcs.WhiteMaterial("white", hcsdesign.engine3D.scene), new hcs.WhiteMaterial("white", hcsdesign.engine3D.scene));
        var m, g, f, y, _, v, b, w, x, C = {},
            M = 0,
            D = 0,
            B = 1;
        l.boundingBoxes = [];
        var A, E = [],
            T = new BABYLON.Vector3,
            S = new BABYLON.Vector3,
            L = function(t, e, n, i, o, r) {
                var r = r || 0;
                E.length = 0, h.push(t.x, r, -t.y, e.x, r, -e.y), E.push(t.x, r, -t.y, e.x, r, -e.y), h.push(t.x, n, -t.y, e.x, n, -e.y), E.push(t.x, n, -t.y, e.x, n, -e.y), T.copyFromFloats(e.x - t.x, r, -e.y + t.y), S.copyFromFloats(0, n, 0), A = BABYLON.Tools.PlaneUVProjection(E, T, S, 512);
                for (var s = 0, a = A.length; a > s; s++)
                    u.push(A[s]);
                o ? (w = !0, p.push(D + 3, D + 1, D), p.push(D, D + 2, D + 3)) : (p.push(D, D + 1, D + 3), p.push(D + 3, D + 2, D), w = !1)
            },
            O = function(t) {
                for (var e, n, i = 0, o = t.length; o > i; i++) {
                    m = t[i].parent, g = new BABYLON.Vector3(t[i].offsetVector.x, 0, -t[i].offsetVector.y), L(t[i].points[0], t[i].points[1], m.height, e, g), n = t[i].materialInfo && t[i].materialInfo.material ? t[i].materialInfo.material : this._defaultMaterial.clone("defaultWall"), t[i].addMaterial(n), t[i].materialIndex = B + 1, l.material.subMaterials.push(n), f = new BABYLON.Vector3(h[3 * p[3 * M + 1]], h[3 * p[3 * M + 1] + 1], h[3 * p[3 * M + 1] + 2]), y = new BABYLON.Vector3(h[3 * p[3 * M + 2]], h[3 * p[3 * M + 2] + 1], h[3 * p[3 * M + 2] + 2]), x = f.clone().lerp(y, .5), b = -Math.atan2(y.z - f.z, y.x - f.x), v = y.distanceTo(f);
                    var r = new BABYLON.Vector3(-v / 2, 0, 0).add(x),
                        s = new BABYLON.Vector3(v / 2, m.height, 0).add(x);
                    _ = new BABYLON.BoundingBox(new BABYLON.Vector3(Math.min(r.x, s.x), Math.min(r.y, s.y), Math.min(r.z, s.z)), new BABYLON.Vector3(Math.max(r.x, s.x), Math.max(r.y, s.y), Math.max(r.z, s.z))), _.angle = b, C[B] = {
                        indexStart: 3 * M,
                        indexCount: 6,
                        objectInstance: t[i],
                        boundingBox: _
                    }, B++, D += 4, M += 2, "undefined" == typeof d[m.id] && (d[m.id] = []), d[m.id].push([t[i].points[0], t[i].points[1]])
                }
            }.bind(this),
            P = hcsdesign.structure.version;
        "1.2.0.1" == P && this.migrateMaterials(t.walls, r);
        for (var I = 0, N = e.length; N > I; I++)
            e[I].dispatchMaterials(), currentPanes = e[I].panes, O(currentPanes);
        for (var I = 0, N = i.length; N > I; I++)
            i[I].dispatchMaterials(), currentPanes = i[I].panes, O(currentPanes, !0);
        C[0] = {
            indexStart: 3 * M,
            indexCount: 0
        };
        for (var R = PolygonMerger.getCachedDeletedEdges(), I = 0, N = R.length; N > I; I++) {
            var k = !0;
            R[I].parent.type != R[I].parent.TYPE_SEPARATOR && (L(R[I].points[0].position, R[I].points[1].position, R[I].parent.height, 0, k, 0), C[0].indexCount += 6, D += 4, M += 2)
        }
        for (var V, F, Y, z, j = [], I = 0, N = s.length; N > I; I++)
            s[I].type !== s[I].TYPE_SEPARATOR && (V = s[I].getPolygon(), V && (F = BABYLON.Mesh.TriangulateNewMesh("wallTop", V, null, hcsdesign.engine3D.scene), F && (Y = F.duplicate(), Y.invertFaces(), F.position.y = s[I].height, j.push(F), j.push(Y))));
        z = BABYLON.Mesh.mergeMeshes("wallTop", j, hcsdesign.engine3D.scene), BABYLON.Mesh.ComputeFlatNormal(h, c, p), l.setVerticesData(BABYLON.VertexBuffer.PositionKind, h), l.setVerticesData(BABYLON.VertexBuffer.NormalKind, c), l.setVerticesData(BABYLON.VertexBuffer.UVKind, u), l.setIndices(p), l.subMeshes = [];
        for (var I in C) {
            var W = BABYLON.SubMesh.CreateFromIndices(+I, C[I].indexStart, C[I].indexCount, l);
            W.boundingBox = C[I].boundingBox, W.objectInstance = C[I].objectInstance
        }
        var G = BABYLON.Mesh.mergeMeshes("WallMesh_" + t.id, [z, l], hcsdesign.engine3D.scene, !0);
        return G.material = l.material, G.isDecorable = !0, hcsdesign.engine3D.castShadows(G), G.receiveShadows = !0, G.parent = a, G.decorate = n, this._mesh = G, G
    }, e.prototype.migrateMaterials = function(t, e) {
        for (var n, i, o, r, s = 0, a = t.length; a > s; s++)
            if (t[s].materials) {
                Logger.message("Conversion des materiaux du mur " + s);
                for (var l in t[s].materials)
                    if (r = +1 / 0, n = t[s].materials[l].centroid, i = t[s].materials[l].side, n.y = n.z, i.y = i.z, n.z = 0, i.z = 0, n) {
                        for (var h = null, c = 0, u = e.length; u > c; c++)
                            for (var p = 0, d = e[c].length; d > p; p++)
                                o = e[c][p].center().distanceTo(n), e[c][p].center().distanceTo(n) < r && e[c][p].offsetVector.dot(i) > 0 && void 0 !== t[s].materials[l].params.baseColor && (r = o, h = e[c][p]);
                        h ? (h.addMaterial(t[s].materials[l]), Logger.message("Material " + l + " : succ��s.")) : Logger.message("Echec non critique pour le material " + l + " : mat��riau par d��faut.")
                    }
            }
        Logger.message("Conversion termin��e");
        var m = hcsdesign.structure.version.split(".");
        m[1] = +m[1] + 1, hcsdesign.structure.version = m.join(".")
    }, e.prototype.switchTransparentStatusByStructure = function(t) {
        var e = (hcsdesign.getComponentByName("FloorComponent3D").getFloor(t), this.get3DWallFrom2D(t));
        if (e)
            for (var n, i, o = 0, r = e.subMeshes.length; r > o; o++)
                n = e.subMeshes[o], i = n.getMaterial(), void 0 !== i.alternativeMaterialIndex && switchMaterialIndex(i)
    }, e.prototype.createInstances = function(t) {
        if (t) {
            for (var e = [], n = [], i = [], o = !0, r = [], s = 0, a = 0, l = t.subMeshes.length; l > a; a++) {
                var h = t.subMeshes[a];
                if (h.objectInstance) {
                    e[s] = h.objectInstance;
                    var c;
                    h.objectInstance.materialInfo ? c = h.objectInstance.materialInfo.material : "OvertureStructure" == h.objectInstance.name || "SubSlopeOvertureStructure" == h.objectInstance.name ? c = h.objectInstance.material : "SubSlopeStructure" == h.objectInstance.name && (c = o ? h.objectInstance.materials.bottom : h.objectInstance.materials.top, o = !o), h.materialIndex = s, i[s] = c, h.boundingBox && (n[s] = h.boundingBox), s++
                } else
                    0 == a || 1 == a ? (i[s] = new hcs.WhiteMaterial("white", hcsdesign.engine3D.scene, {
                        factor: 0
                    }), h.materialIndex = 0, s++) : r.push(a)
            }
            for (var u = r.length - 1; u >= 0; u--)
                t.subMeshes.splice(r[u], 1);
            t.objectInstances = e, t.boundingBoxes = n, t.material.subMaterials = i
        }
    }, e
}();
var RoomStructure = function() {
    var t = 0,
        e = function() {
            BaseStructure.call(this, "roomStructure"), this.points = [], this.holes = [], this.walls = [], this.parentWallSides = [], this.panes = null, this.cycle = null, this.name = "room_" + t++, this.label = _("房间"), this.color = "#FFFFFF", this.area = 0, this.areaPosition = new BABYLON.Vector2, this.textWidth = 0, this.textHeight = 12, this.materials = {}, this.panesMaterials = [], this.elevation = 0, this.height = 0, this.thickness = 5, this.ceiling = 2
        };
    e.prototype = new BaseStructure, e.Deserialize = function(t) {
        var e = new RoomStructure;
        if (t.color) {
            var n = t.color.indexOf("0x"); - 1 != n && (t.color = "#" + t.color.slice(2))
        }
        return e.deserialize(t), e
    }, e.prototype.serialize = function() {
        var t = {
            "class": {
                name: "RoomStructure"
            }
        };
        return ujs.serializeObject(this, t, ["id", "label", "color", "isExternal", "elevation", "thickness", "area", "points", "materials", "panes", "ceiling"]), t
    }, e.prototype.deserialize = function(t) {
        return ujs.deserializeObject(t, this, ["id", "label", "color", "isExternal", "elevation", "thickness", "area", "points", "materials", "panes", "ceiling"]), this.panesMaterials = this.panes, this.panes = [], this.processRoomArea(), this
    }, e.prototype.getCenter = function() {
        return this.areaPosition.clone()
    }, e.prototype.setColor = function(t) {
        this.color = t
    }, e.prototype.getWallPanes = function() {
        return this.panes
    }, e.prototype.updatePaneMaterial = function(t, e) {
        t.addMaterial(e), t.materialInfo.center = t.center(), t.materialInfo.normal = t.offsetVector
    }, e.prototype.copy = function(t) {
        this.materials = t.materials, this.panesMaterials = t.panesMaterials, this.elevation = t.elevation, this.thickness = t.thickness, this.color = t.color, this.label = t.label, (2 != t.ceiling || this.ceiling) && (this.ceiling = t.ceiling)
    };
    var n = function(t) {
        for (var e = 0; 2 > e; e++)
            for (var n = 3; n >= 2; n--)
                if (t[e] == t[n])
                    return t[e];
        return Logger.warning("Parenting problem in cycle"), null
    };
    return e.prototype.createFromCycle = function(t) {
        if (t.length < 3)
            return null;
        for (var n = new e, i = t[t.length - 1].position, o = 0, r = t.length; r > o; o++)
            if (!i.distanceTo(t[o].position < .001) && t[o].parents[0] && t[o].parents[1]) {
                n.points.push(t[o].position), n.walls.push(t[o].parents[1]), n.parentWallSides.push(t[o].parentWallSide[1]), n.height = n.walls[0].height;
                for (var s = 0, a = 1, l = n.walls.length; l > a; a++)
                    n.walls[a] && n.walls[a].type === n.walls[a].TYPE_SEPARATOR && s++, s / n.walls.length > .25 && (n.ceiling = !1), n.walls[a] && n.walls[a].height && n.height !== n.walls[a].height && (n.ceiling = !1, n.height = Math.max(n.walls[a].height, n.height))
            } else
                t.splice(o, 1), o--, r--;
        return n.cycle = t, n.createWallPanes(), n.addFloorOnOvertures(t), n
    }, e.prototype.createWallPanes = function() {
        for (var t, e = [], n = 0, i = this.points.length; i > n; n++)
            this.walls[n] && this.walls[n].type !== this.walls[n].TYPE_SEPARATOR && (t = new WallPane3D([this.points[n], this.points[(n + 1) % i]], this.walls[n], this.parentWallSides[n]), t.setRoom(this), e.push(t));
        return this.panes = e, e
    }, e.prototype.dispatchMaterials = function() {
        var t, e = [],
            n = this.panes.slice(0);
        if (0 !== n.length) {
            for (var i in this.panesMaterials)
                if (this.panesMaterials[i] && this.panesMaterials[i].center && this.panesMaterials[i].normal) {
                    t = null;
                    for (var o, r, s, a = +1 / 0, l = 0, h = n.length; h > l; l++)
                        r = n[l].center(), s = n[l].normal(), o = this.panesMaterials[i].center.distanceTo(r), a > o && this.panesMaterials[i].normal.clone().normalize().dot(s) >= 0 && (a = o, t = l);
                    if (null !== t && (e.push(this.panesMaterials[i]), this.panesMaterials[i].normal = n[t].normal(), this.panesMaterials[i].center = n[t].center(), n[t].materialInfo = this.panesMaterials[i], n.splice(t, 1), 0 === n.length))
                        break
                }
            this.panesMaterials = e
        }
    }, e.prototype.addFloorOnOvertures = function() {
        for (var t = function(t, e) {
                for (var n = 0, i = 0; i < e.length; i++)
                    if (e[i] != t && t.width <= e[i].width && (n = e[i].position.subtract(t.position).length(), n - (e[i].width + t.width) / 2 < 0))
                        return !0;
                return !1
            }, e = this.cycle, i = this.points, o = 0, r = function(t, e) {
                return t.position.x - e.position.x
            }, s = function(t, e) {
                return e.position.x - t.position.x
            }, a = 0, l = e.length; l > a; a++) {
            var h = e[a],
                c = e[(a + 1) % e.length],
                u = [h.parents[0], h.parents[1], c.parents[0], c.parents[1]],
                p = n(u);
            if (p && p.overtures.length > 0) {
                var d = p.getNearestPoint(h.position),
                    m = p.getNearestPoint(c.position),
                    g = d.subtract(p.getPoints(0).position).length(),
                    f = m.subtract(p.getPoints(0).position).length();
                p.overtures.sort(m.subtract(d).dot(p.getWallVector()) > 0 ? r : s);
                for (var y = 0, _ = p.overtures.length; _ > y; y++)
                    if (p.overtures[y].parentWall && p.overtures[y].elevation == this.elevation && t(p.overtures[y], p.overtures) !== !0 && (p.overtures[y].position.x >= g && p.overtures[y].position.x <= f || p.overtures[y].position.x >= f && p.overtures[y].position.x <= g)) {
                        var v, b = h.parents.indexOf(p),
                            w = c.parents.indexOf(p);
                        v = h.parentWallSide[b].equals(c.parentWallSide[w]) ? h.parentWallSide[b].clone() : h.parentWallSide[(b + 1) % 2].equals(c.parentWallSide[w]) ? h.parentWallSide[(b + 1) % 2].clone() : c.parentWallSide[(w + 1) % 2].clone(), v.scaleInPlace(p.thickness / 2);
                        var x = p.overtures[y].getAbsolutePos(),
                            C = x.position.subtract(x.vector.scale(p.overtures[y].width / 2)),
                            M = x.position.add(x.vector.scale(p.overtures[y].width / 2)),
                            D = [C.add(v), C.add(v.clone().normalize().scale(.01)), M.add(v.clone().normalize().scale(.01)), M.add(v)];
                        m.subtract(d).dot(C.subtract(M)) > 0 && D.reverse(), D[0].isOverture = !0, D[1].isOverture = !0, D[2].isOverture = !0, D[3].isOverture = !0, i[a + o] && D[0].distanceTo(i[a + o]) < .01 ? i.splice(a + o, 1, D[0], D[1], D[2], D[3]) : i[a + o + 1] && D[3].distanceTo(i[a + o + 1]) < .01 ? i.splice(a + o + 1, 1, D[0], D[1], D[2], D[3]) : i.splice(a + 1 + o, 0, D[0], D[1], D[2], D[3]), o += 4
                    }
            }
        }
    }, e.prototype.eql = function(t) {
        for (var e = 0; e < this.points.length; e++)
            if (this.points[e].isInArray(t.points, !1) === !1)
                return !1;
        return !0
    }, e.prototype.isPointIn = function(t) {
        return this.points ? t.isPointInPolygon(this.points) ? !0 : !1 : void 0
    }, e.prototype.getRoomArea = function(t) {
        return this.area > 0 && !t ? this.area : this.processRoomArea()
    }, e.prototype.processRoomArea = function() {
        var t = this.points,
            e = t[0],
            n = 0,
            i = 0,
            o = 0;
        for (var r in t)
            n += (e.x + t[r].x) * (e.x * t[r].y - t[r].x * e.y), i += (e.y + t[r].y) * (e.x * t[r].y - t[r].x * e.y), o += e.x * t[r].y - t[r].x * e.y, e = t[r];
        o += e.x * t[0].y - t[0].x * e.y, n += (e.x + t[0].x) * (e.x * t[0].y - t[0].x * e.y), i += (e.y + t[0].y) * (e.x * t[0].y - t[0].x * e.y);
        var s = .5 * o;
        return this.area = Math.abs(s), this.areaPosition.x = 1 * n / (6 * s), this.areaPosition.y = 1 * i / (6 * s), Math.abs(s)
    }, e.prototype.orientedArea = function() {
        for (var t = this.points.length, e = 0, n = t - 1, i = 0; t > i; n = i++)
            e += this.points[n].x * this.points[i].y - this.points[i].x * this.points[n].y;
        return .5 * e
    }, e.prototype.reversePath = function() {
        this.points.reverse()
    }, e.prototype.toVec2Array = function() {
        for (var t = [], e = 0, n = this.points.length; n > e; e++)
            t.push(new BABYLON.Vector2(this.points[e].x, this.points[e].y));
        return t
    }, e.prototype.getOverlappingRectArea = function(t) {
        var e = this.getBoundingBox(),
            n = t.getBoundingBox();
        e.intersect(n);
        var i = e.maximum.x - e.minimum.x,
            o = e.maximum.y - e.minimum.y,
            r = i * o;
        return r = 0 > i || 0 > o ? 0 : r
    }, e.prototype.getLikelihood = function(t) {
        var e = 0,
            n = 0,
            i = 1,
            o = this.getRoomArea(),
            r = t.getRoomArea(),
            s = this.areaPosition.clone(),
            a = t.areaPosition.clone(),
            l = 1 - Math.abs(o - r) / Math.max(o, r),
            h = this.getOverlappingRectArea(t) / Math.min(o, r),
            c = 1 / (1 + s.distanceTo(a));
        return e * h + n * l + i * c
    }, e.prototype.getBoundingBox = function() {
        return BABYLON.BoundingBox.CreateFromPoints(this.points)
    }, e.prototype.getAvailableProperties = function() {
        return []
    }, e.prototype.remove = function() {}, e
}();
var RoomHierarchy = function() {
    var t = function() {
        this.room = null, this.center = null, this.parent = null, this.children = []
    };
    t.prototype.contains = function(t) {
        return t.center ? this.room.isPointIn(t.center) : !1
    }, t.prototype.insert = function(t) {
        if (this.contains(t)) {
            for (var e = 0, n = this.children.length; n > e; e++)
                if (this.children[e].insert(t))
                    return !0;
            for (var e = this.children.length - 1; e >= 0; e--)
                t.insert(this.children[e]) && this.children.splice(e, 1);
            return this.children.push(t), t.parent = this, !0
        }
        return !1
    }, t.fromRoom = function(e) {
        if (e.points.length < 3)
            return null;
        var n = new t;
        return n.room = e, n.center = e.points[0].clone().lerp(e.points[1], .5), n
    };
    var e = function() {
        t.call(this)
    };
    e.prototype = new t, e.prototype.contains = function() {
        return !0
    };
    var n = function(n) {
        this.tree = new e;
        for (var i = 0, o = n.length; o > i; i++)
            this.tree.insert(t.fromRoom(n[i]))
    };
    return n.prototype.discrimineRooms = function(t, e) {
        for (var n = function(i, o) {
                o ? e.push(i.room) : t.push(i.room);
                for (var r = 0, s = i.children.length; s > r; r++)
                    n(i.children[r], !o)
            }, i = 0, o = this.tree.children.length; o > i; i++)
            n(this.tree.children[i], !0)
    }, n.prototype.adjustRooms = function() {
        for (var t = null, e = function(n, i) {
                n.room.isExternal = i;
                for (var o = 0, r = n.children.length; r > o; o++)
                    i || (t = n.children[o], n.room.area -= t.room.area, n.room.holes.push(t.room.points.slice(0))), e(n.children[o], !i)
            }, n = 0, i = this.tree.children.length; i > n; n++)
            e(this.tree.children[n], !0)
    }, n
}();
var RoomComponent2D = function() {
    var t = function(t) {
        BaseComponent2D.call(this, t, "RoomComponent2D"), this.priority = 9, this.rooms = [], this._remainings = 0, this.internalRooms = [], this.externalRooms = [], this.useCache = !1, this.displayRoomName = !0, this.core.engine2D.registerEventCb("RoomComponent2D.static-draw", this.priority, "static-draw", null, null, this.onStaticDraw.bind(this), null), this.core.engine2D.registerEventCb("RoomComponent2D.room.click", this.priority, "click", this.core.engine2D.MODE_NORMAL, RoomStructure, this.onContextMenu.bind(this), {})
    };
    return t.prototype = new BaseComponent2D, t.prototype.update = function(t) {
        return !t && !hcsdesign.getSelectedStructure().isDirty() || hcsdesign.engine2D.getMode() & hcsdesign.engine2D.MODE_CONTEXTMENU ? void 0 : (t = t || hcsdesign.getSelectedStructure(), this.useCache ? (this.useCache = !1, this.computeRooms(t, PolygonMerger.getCachedCycles())) : this.computeRooms(t))
    }, t.prototype.removeBiggestArea = function() {
        for (var t, e = 0, n = 0, i = this.rooms.length; i > n; n++)
            this.rooms[n].getRoomArea() > e && (t = n, e = this.rooms[n].getRoomArea());
        return this.internalRooms.splice(t, 1), this.rooms.splice(t, 1)
    }, t.prototype.getExternalWalls = function(t) {
        return Logger.warning("getExternalWalls is deprecated"), null
    }, t.prototype.getAllSubSlopes = function(t) {
        var t = t || hcsdesign.getSelectedStructure(),
            e = t.getElements("internalRooms");
        0 != e.length && e[0].cycle || (this.update(t), e = t.getElements("internalRooms"));
        for (var n = [], i = function(t, e) {
                var n = 1e-4;
                return t.subtract(e).lengthSquared() < n
            }, o = function(t, e) {
                for (var o = 0, r = n.length; r > o; o++)
                    if (t == n[o].wall && i(e, n[o].side[0]))
                        return n[o];
                return null
            }, r = function(t, e) {
                if (t.parents[e]) {
                    var i = o(t.parents[e], t.parentWallSide[e]);
                    i || (i = n[n.push(new SubSlopeStructure) - 1], i.wall = t.parents[e]), i.points.push(t.position), i.side.push(t.parentWallSide[e]), i.neighbors.push(t.parents[(e + 1) % 2])
                }
            }, s = 0; s < e.length; s++)
            if (!e[s].isExternal)
                for (var a = 0; a < e[s].cycle.length; a++)
                    r(e[s].cycle[a], 0), r(e[s].cycle[a], 1);
        return n
    }, t.prototype.getInternalRooms = function() {
        return this.internalRooms
    }, t.prototype.getExternalRooms = function() {
        return this.externalRooms
    }, t.prototype.identifyRooms = function(t, e) {
        var n, i, o = function(t, e) {
                return e.area - t.area
            },
            r = [];
        t.length <= e.length ? (n = t, i = e.slice(0)) : (n = e, i = t.slice(0)), n.sort(o), i.sort(o);
        for (var s = 0, a = n.length; a > s; s++) {
            for (var l = i[0], h = n[s].getLikelihood(i[0]), c = 0; c < i.length; c++) {
                var u = n[s].getLikelihood(i[c]);
                u > h && (l = i[c], h = u)
            }
            i.splice(i.indexOf(l), 1), r.push(l)
        }
        return r
    }, t.prototype.dispatchRooms = function(t, e) {
        var n = e.getElements(t),
            i = this.identifyRooms(this[t], n);
        if (n.length > 0)
            if (this[t].length <= n.length)
                for (var o = 0; o < i.length; o++)
                    this[t][o].copy(i[o]);
            else
                for (var o = 0; o < i.length; o++)
                    i[o].copy(n[o])
    }, t.prototype.computeRooms = function(t, e) {
        var n, i = t || this.structure.getCurrentStructure(),
            o = [];
        if (this.internalRooms.length = 0, this.externalRooms.length = 0, n = e || PolygonMerger.merge(i.getElements("walls"))) {
            for (var r = 0, s = n.length; s > r; r++) {
                var a = RoomStructure.prototype.createFromCycle(n[r]);
                a.points.length < 3 || (a.processRoomArea(), o.push(a))
            }
            this.rooms = o;
            var l = new RoomHierarchy(o);
            if (window.ejecta && o.length) {
                this.internalRooms = [];
                for (var r = 0, s = o.length - 1; s > r; r++)
                    this.internalRooms.push(o[r])
            }
            l.discrimineRooms(this.internalRooms, this.externalRooms), l.adjustRooms(), this.dispatchRooms("internalRooms", i), this.dispatchRooms("externalRooms", i), this.internalRooms.forEach(function(t) {
                t.dispatchMaterials()
            }), this.externalRooms.forEach(function(t) {
                t.dispatchMaterials()
            }), i.replaceElements("internalRooms", this.internalRooms), i.replaceElements("externalRooms", this.externalRooms)
        }
    }, t.prototype.getTargeted = function(t) {
        for (var e = this.structure.getCurrentStructure().getElements("internalRooms"), n = this.core.engine2D.getZoom(), i = 0, o = e.length; o > i; i++) {
            var r = e[i].areaPosition;
            if (!e[i].textWidth) {
                var s = hcsdesign.engine2D.canvas.getContext("2d");
                e[i].textWidth = s.measureText(e[i].label).width
            }
            var a = r.x - e[i].textWidth / 2 / n,
                l = r.x + e[i].textWidth / 2 / n,
                h = r.y - e[i].textHeight / n,
                c = r.y + e[i].textHeight / n;
            if (t.x <= l && t.x >= a && t.y <= c && t.y >= h)
                return e[i]
        }
        return null
    }, t.prototype.onContextMenu = function(t, e) {
        var n = [];
        n.push({
            name: "label",
            label: _("房间名"),
            type: "text",
            cast: "string",
            value: e.label
        }), /*n.push({
            name: "ceiling",
            label: _("天花板"),
            type: "checkbox",
            value: e.ceiling
        }),*/ n.push({
            name: "elevation",
            label: _("地面高度"),
            type: "slider",
            cast: "int",
            unit: "cm",
            value: {
                min: 0,
                max: 80,
                step: 1,
                value: e.elevation
            }
        })/*, n.push({
            name: "thickness",
            label: _("Thickness"),
            type: "slider",
            cast: "int",
            unit: "cm",
            value: {
                min: 5,
                max: 100,
                step: 1,
                value: e.thickness
            }
        }),*/ /*this.core.engine2D.displayContextMenu(n, e, this.onContextMenuPropertyChanged.bind(this))*/
    }, t.prototype.onContextMenuPropertyChanged = function(t, e, n) {
        t[e] = n
    }, t.prototype.onStaticDraw = function(t, e, n) {
        this.drawRooms(t, e, n)
    }, t.prototype.drawRooms = function(t, e, n) {
        var i = hcsdesign.getSelectedStructure();
        for (var o in i.internalRooms)
            i.internalRooms[o].area > 250 && this.drawRoom(i.internalRooms[o], t, e, n)
    }, t.prototype.isPointInRooms = function(t) {
        for (var e = 0; e < this.rooms.length; e++) {
            var n = this.rooms[e];
            if (n.isPointIn(t))
                return n
        }
        return !1
    }, t.prototype.drawRoom = function(t, e, n, i) {
        if (t && 0 != t.draw) {
            var e = e || this.ctx;
            e.fillStyle = t.color || "#ffffff", e.beginPath();
            for (var o = 0; o < t.points.length; o++) {
                var r = t.points[o].scale(i).addInPlace(n);
                0 == o ? e.moveTo(r.x, r.y) : e.lineTo(r.x, r.y)
            }
            if (e.fill(), this.displayRoomName) {
//                var s = t.areaPosition.scale(i).addInPlace(n);
//                e.font = "normal 9pt sans-serif", e.textBaseline = "middle", e.textAlign = "center", e.fillStyle = this.core.engine2D.symbols2D.COLOR_ANNOTATION, e.fillText(t.label, s.x, s.y - 7), e.fillText(Math.round(t.area / 100) / 100 + " m²", s.x, s.y + 7)
            }
        }
    }, t
}();
var RoomComponent3D = function() {
    var t, e = function(e) {
        BaseComponent3D.call(this, e, "RoomComponent3D"), this._defaultRoomTextures = {
            diffuseTexture: new BABYLON.Texture(hcs.Assets.roomTextures.diffuse, hcsdesign.engine3D.scene),
            specularTexture: new BABYLON.Texture(hcs.Assets.roomTextures.specular, hcsdesign.engine3D.scene),
            bumpTexture: new BABYLON.Texture(hcs.Assets.roomTextures.normal, hcsdesign.engine3D.scene)
        }, this._defaultMaterial = new hcs.WoodMaterial("floor", hcsdesign.engine3D.scene), this._defaultMaterial.diffuseTexture = this._defaultRoomTextures.diffuseTexture, this._defaultMaterial.bumpTexture = this._defaultRoomTextures.bumpTexture, this._defaultCeiling = new hcs.WhiteMaterial("CeilingBasic", hcsdesign.engine3D.scene), this._commonMaterials = [new hcs.WhiteMaterial("FloorSide_common", hcsdesign.engine3D.scene), new hcs.WhiteMaterial("Ceiling_common", hcsdesign.engine3D.scene)], this._materialOffset = 0, t = this
    };
    e.prototype = new BaseComponent3D, e.prototype.getSideMaterial = function() {
        return this._defaultMaterial
    }, e.prototype.setSideMaterial = function(t) {
        this._defaultMaterial = t
    }, e.prototype.getCeilingMaterial = function() {
        return this._defaultCeiling
    }, e.prototype.setCeilingMaterial = function(t) {
        this._defaultCeiling = t
    }, e.prototype.onContextChanged = function(t) {
        "3D" == t ? this.initialized || (document.addEventListener("hcs.engine3d.floorReady", this.onFloorReady, !1), this.initialized = !0) : this.initialized && (document.removeEventListener("hcs.engine3d.floorReady", this.onFloorReady, !1), this.initialized = !1)
    }, e.prototype.onFloorReady = function(e) {
        var n = e.floor || t.getFloor(),
            i = e.structure || t.core.getSelectedStructure();
        hcsdesign.getComponentByName("RoomComponent2D").update(i);
        var o = i.getElements("hoppers"),
            r = hcsdesign.structure.getElement(i.id + 1),
            s = i.getElements("internalRooms");
        if (r)
            var a = t.build(s, o, n, r.hoppers);
        else
            var a = t.build(s, o, n, []);
        t.mesh = a, ujs.notify("hcs.engine3d.roomsReady", {
            floor: n,
            structure: i
        })
    };
    var n = function(t, e) {
        for (var n, i, o = 0, r = this.subMeshes.length; r > o; o++)
            3 * e.faceId >= this.subMeshes[o].indexStart && 3 * e.faceId < this.subMeshes[o].indexStart + this.subMeshes[o].indexCount && (n = this.objectInstances[this.subMeshes[o].materialIndex], n && (i = this.material.subMaterials[this.subMeshes[o].materialIndex].clone(this.material.subMaterials[this.subMeshes[o].materialIndex].name), t.name = i.name, n.materials[i.name] = t, this.material.subMaterials[this.subMeshes[o].materialIndex] = t));
        return i
    };
    return e.prototype.build = function(t, e, i, o) {
        for (var r = [], s = 0, a = 0, l = t.length; l > a; a++) {
            var h = this.createRoom(t[a], 0, t[a].height);
            s < t[a].height && (s = t[a].elevation), h && (r.push(h.floor), r.push(h.ceiling))
        }
        var c = BABYLON.Mesh.mergeMeshes("RoomMesh_" + i.structure.id, r, hcsdesign.engine3D.scene, !0);
        if (c.material = new BABYLON.MultiMaterial("RoomMaterial", hcsdesign.engine3D.scene), c.isDecorable = !0, c.decorate = n, c.parent = i, i.roomMesh = c, c.receiveShadows = !0, hcsdesign.engine3D.scene.lights.point.excludedMeshes.push(c), HopperComponent3D) {
            for (var u = 0; u < e.length; u++)
                c = HopperComponent3D.Build(c, e[u], 0, s + 5);
            for (var u = 0; u < o.length; u++)
                c = HopperComponent3D.Build(c, o[u], i.structure.height - 10)
        }
        return c
    }, e.prototype.normalizePolygon = function(t) {
        for (var e = [], n = 0, i = t.length; i > n; n++)
            t[n].isOverture || e.push(t[n]);
        return e
    }, e.prototype.createRoom = function(t, e, n) {
        var i, o = (this.core.getComponentByName("HopperComponent3D", this.core.ENGINE_3D), t.points);
        if (o.length < 3)
            return !1;
        if (i = BABYLON.Mesh.ExtrudeNewMesh("room", o, null, {
                amount: 5 + t.elevation
            }, hcsdesign.engine3D.scene))
            var r = BABYLON.Mesh.TriangulateNewMesh("ceiling", o, [], hcsdesign.engine3D.scene, n - .1);
        else {
            var s = this.normalizePolygon(t.points);
            i = BABYLON.Mesh.ExtrudeNewMesh("room", s, null, {
                amount: 5 + t.elevation
            }, hcsdesign.engine3D.scene);
            var r = BABYLON.Mesh.TriangulateNewMesh("ceiling", s, [], hcsdesign.engine3D.scene, n - .1);
            if (!i)
                return null
        }
        r.invertFaces(), r.invertNormales(), t.materials.floor = t.materials.floor || this._defaultMaterial.clone("floor"), t.materials.ceiling = t.materials.ceiling || this._defaultCeiling.clone("ceiling"), t.ceiling ? t.materials.ceiling.oldAlpha && (t.materials.ceiling.alpha = t.materials.ceiling.oldAlpha) : (t.materials.ceiling.oldAlpha = t.materials.ceiling.alpha, t.materials.ceiling.alpha = 0);
        var a = i.getBoundingBox();
        a.ceil = !1;
        var l = r.getBoundingBox();
        l.ceil = !0, i.receiveShadows = !0;
        for (var h = 0, c = t.holes.length; c > h; h++)
            i = this.carveHole(i, t.holes[h], t.elevation + n), r = this.carveHole(r, t.holes[h], t.elevation + n);
        return i.subMeshes[0].objectInstance = t, i.subMeshes[0].boundingBox = a, r.subMeshes[0].objectInstance = t, r.subMeshes[0].boundingBox = l, {
            floor: i,
            ceiling: r
        }
    }, e.prototype.carveHole = function(t, e, n) {
        var i = BABYLON.CSG.FromMesh(t),
            o = BABYLON.Mesh.ExtrudeNewMesh("hopper_temp", e, null, {
                amount: n
            }, hcsdesign.engine3D.scene);
        if (!o)
            return t;
        o.parent = t.parent, o.material = this._commonMaterials[0];
        var r = BABYLON.CSG.FromMesh(o),
            s = i.subtract(r),
            a = s.toMesh("room_global", t.material, hcsdesign.engine3D.scene, !1);
        return a.parent = t.parent, o.dispose(), this.replaceRoom(t, a), a
    }, e.prototype.replaceRoom = function(t, e) {
        -1 != hcsdesign.engine3D.scene.meshes.indexOf(t) && (e.name = t.name, e.id = t.id, e.parent = t.parent, e.boundingBoxes = t.boundingBoxes, e.objectInstances = t.objectInstances, e.decorate = t.decorate, e.receiveShadows = t.receiveShadows, hcsdesign.engine3D.scene.lights.point.excludedMeshes.push(e), t.dispose(), this.mesh = e)
    }, e.prototype.createInstances = function(t) {
        if (t) {
            for (var e, n = [], i = [], o = [], r = 0, s = 0, a = t.subMeshes.length; a > s; s++) {
                var l = t.subMeshes[s];
                if (l.objectInstance) {
                    if (n[s] = l.objectInstance, l.boundingBox)
                        if (l.boundingBox.ceil)
                            var h = l.objectInstance.materials.ceiling;
                        else
                            var h = l.objectInstance.materials.floor;
                    else
                        var h = l.objectInstance.material;
                    o[s] = h
                } else
                    e || (e = s), r++;
                l.materialIndex = s, l.boundingBox && (i[s] = l.boundingBox)
            }
            e && t.subMeshes.splice(e, r), t.objectInstances = n, t.boundingBoxes = i, t.material.subMaterials = o
        }
    }, e
}();
OvertureStructure = function() {
    var t = function() {
        BaseStructure.call(this, "OvertureStructure");
        this.type = "Door", this.position = new BABYLON.Vector2, this.width = 73, this.height = 200, this.thickness = 7, this.elevation = 0, this.hinge = 0, this.side = -1, this.nbCasement = 1, this.parentWall = null, this.minsize = 15, this.sliding = !1, this.galandage = !1, this.batiThickness = 5, this.programmableInstance = null, this.plinte = 1
    };
    return t.prototype = new BaseStructure, t.prototype.serialize = function() {
        var t = {
            "class": {
                name: "OvertureStructure"
            }
        };
        return ujs.serializeObject(this, t, null, ["parentWall"]), t
    }, t.Deserialize = function(t) {
        var e = new OvertureStructure;
        return ujs.deserializeObject(t, e), e
    }, t.prototype.checkCoherence = function(t) {
        this.getParentWall() ? (this.width = Math.min(this.width, this.parentWall.getWallVector().length() - 24), this.width < 0 && this.remove(t)) : this.remove(t)
    }, t.prototype.getParentWall = function() {
        return this.parentWall
    }, t.prototype.setParentWall = function(t) {
        if (t != this.parentWall) {
            null != this.parentWall && this.parentWall.overtures.splice(this.parentWall.overtures.indexOf(this), 1), this.parentWall = t;
            for (var e = 0; e < this.parentWall.overtures.length; e++) {
                var n = this.parentWall.overtures[e];
                if (this.id == n.id)
                    return
            }
            this.parentWall.overtures.push(this)
        }
    }, t.prototype.computePositionOnWallChange = function(t) {
        var e = this.parentWall,
            n = this.position.x,
            i = e.getWallVector().normalize().scaleInPlace(n),
            o = t.getPoints(0).position.subtract(e.getPoints(0).position),
            r = i.subtract(o),
            s = r.length();
        return this.position.x = s, this.side *= Math.sign(e.getWallVector().dot(t.getWallVector())), s
    }, t.prototype.projectOnWall = function() {
        if (this.parentWall) {
            var t, e = this.parentWall,
                n = e.getLength();
            t = n < this.width ? .5 * this.width : ujs.Math.clamp(Math.abs(this.position.x), .5 * this.width, e.getLength() - .5 * this.width), this.position.x = t * Math.sign(this.position.x)
        }
    }, t.prototype.getAbsolutePos = function() {
        var t = this.parentWall.getWallVector().normalize(),
            e = t.scale(this.position.x).addInPlace(this.parentWall.getPoints(0).position);
        return {
            position: e,
            vector: t
        }
    }, t.prototype.getAngle = function() {
        var t = this.parentWall.getWallVector().normalize();
        return Math.atan2(t.y, t.x)
    }, t.prototype.getPolygon = function() {
        var t = new BABYLON.Vector2,
            e = new BABYLON.Vector2,
            n = this.getAbsolutePos(),
            i = this.parentWall.getNormalVector(this.parentWall.thickness / 2);
        return t = n.position.subtract(n.vector.scale(this.width / 2)), e = n.position.add(n.vector.scale(this.width / 2)), [t.add(i), e.add(i), e.subtract(i), t.subtract(i)]
    }, t.prototype.clampSize = function(t, e) {
        var t = t || !1;
        if (!this.parentWall || this.parentWall.getLength() < this.minsize && t)
            return void this.remove(e);
        var n = this.getAbsolutePos();
        this.width = BABYLON.Math.clamp(this.width, this.minsize, Math.min(2 * n.position.distanceTo(this.parentWall.getPoints(0).position), 2 * n.position.distanceTo(this.parentWall.getPoints(1).position)))
    }, t.prototype.remove = function(t) {
        this.parentWall && this.parentWall.overtures.splice(this.parentWall.overtures.indexOf(this), 1), this.parentWall = null, void 0 != t && t.removeElement("overtures", this)
    }, t
}();
var OvertureComponent2D = function() {
    var t = function(t) {
        BaseComponent2D.call(this, t, "OvertureComponent2D"), this.COLOR = "#888", this.MINSIZE = 30, this.priority = 60, this.overtureDragged = !1, this._applyToAll = !1
    };
    return t.prototype = new BaseComponent2D, t.prototype.startListening = function() {
        this.onAddOverture = this.onAddOverture.bind(this), this.onAddOvertureEnd = this.onAddOvertureEnd.bind(this), this.onStaticDraw = this.onStaticDraw.bind(this), this.onHover = this.onHover.bind(this), this.onLeave = this.onLeave.bind(this), this.onContextMenu = this.onContextMenu.bind(this), this.onDoubleClick = this.onDoubleClick.bind(this), document.addEventListener("hcs.engine2d.onAddOverture", this.onAddOverture, !1), document.addEventListener("hcs.engine2d.onAddOvertureEnd", this.onAddOvertureEnd, !1), hcsdesign.engine2D.registerEventCb("OvertureComponent2D.static-draw", this.priority, "static-draw", null, null, this.onStaticDraw, null), hcsdesign.engine2D.registerEventCb("OvertureComponent2D.drag-start", this.priority, "drag-start", hcsdesign.engine2D.MODE_NORMAL, OvertureStructure, this.onDragStart.bind(this), null), hcsdesign.engine2D.registerEventCb("OvertureComponent2D.hover", this.priority, "hover", hcsdesign.engine2D.MODE_NORMAL | hcsdesign.engine2D.MODE_DRAG | hcsdesign.engine2D.MODE_CONTEXTMENU, OvertureStructure, this.onHover, null), hcsdesign.engine2D.registerEventCb("OvertureComponent2D.leave", this.priority, "leave", hcsdesign.engine2D.MODE_NORMAL | hcsdesign.engine2D.MODE_CONTEXTMENU, OvertureStructure, this.onLeave, null), hcsdesign.engine2D.registerEventCb("OvertureComponent2D.context-menu", this.priority, "click", hcsdesign.engine2D.MODE_NORMAL, OvertureStructure, this.onContextMenu, null), hcsdesign.engine2D.registerEventCb("OvertureComponent2D.double-click", this.priority, "double-click", hcsdesign.engine2D.MODE_NORMAL, OvertureStructure, this.onDoubleClick, null)
    }, t.prototype.stopListening = function() {
        document.removeEventListener("hcs.engine2d.onAddOverture", this.onAddOverture, !1), document.removeEventListener("hcs.engine2d.onAddOvertureEnd", this.onAddOvertureEnd, !1), hcsdesign.engine2D.unregisterEventCb("OvertureComponent2D.static-draw"), hcsdesign.engine2D.unregisterEventCb("OvertureComponent2D.drag-start"), hcsdesign.engine2D.unregisterEventCb("OvertureComponent2D.hover"), hcsdesign.engine2D.unregisterEventCb("OvertureComponent2D.leave"), hcsdesign.engine2D.unregisterEventCb("OvertureComponent2D.context-menu"), hcsdesign.engine2D.unregisterEventCb("OvertureComponent2D.double-click")
    }, t.prototype.initialize = function() {
        var t, e = [
            ["doors", _("门洞"), "Door", 0, 90, 204, 0, !1, !1],
            ["doors", _("房门"), "Door", 0, 73, 204, 1, !1, !1],
            /*["doors", _("双开门"), "Door", 0, 140, 204, 2, !1, !1],
            ["doors", _("滑门"), "Door", 0, 140, 204, 2, !0, !1],
            ["doors", _("车库门"), "Garage", 0, 240, 200, 3, !1, !1],*/
            /*["bay_windows", _("固定式凸窗"), "Window", 0, 80, 215, 1, !0, !1],
            ["bay_windows", _("法式门"), "Window", 0, 80, 215, 1, !1, !1],
            ["bay_windows", _("双开法式门"), "Window", 0, 120, 215, 2, !1, !1],
            ["bay_windows", _("滑式凸窗"), "Window", 0, 160, 215, 2, !0, !1],*/
            ["windows", _("窗户"), "Window", 90, 80, 125, 0, !1, !1],
            /*["windows", _("固定式窗"), "Window", 90, 60, 125, 1, !0, !1],*/
            ["windows", _("单面推窗"), "Window", 90, 80, 125, 1, !1, !1],
            /*["windows", _("双开窗"), "Window", 90, 100, 125, 2, !1, !1],*/
            ["windows", _("滑动窗"), "Window", 90, 100, 125, 2, !0, !1]
        ];
        t = {
            title: _("门"),
            id: "doors",
            items: []
        }, ujs.notify("hcs.menu.main.add", {
            item: t,
            menuPath: "draw2D",
            position: 1
        }), /*t = {
            title: _("凸窗"),
            id: "bay_windows",
            items: []
        }, ujs.notify("hcs.menu.main.add", {
            item: t,
            menuPath: "draw2D",
            position: 2
        }),*/ t = {
            title: _("窗"),
            id: "windows",
            items: []
        }, ujs.notify("hcs.menu.main.add", {
            item: t,
            menuPath: "draw2D",
            position: 2
        });
        for (var n in e)
            t = {
                title: e[n][1],
                action: "hcs.engine2d.onAddOverture",
                cancelAction: "hcs.engine2d.onAddOvertureEnd",
                params: {
                    overtureType: e[n][2],
                    elevation: e[n][3],
                    width: e[n][4],
                    height: e[n][5],
                    nbCasement: e[n][6],
                    sliding: e[n][7],
                    galandage: e[n][8]
                }
            }, "Door" === e[n][2] && (t.params.stretched_texture = !0), ujs.notify("hcs.menu.main.add", {
                item: t,
                menuPath: "draw2D." + e[n][0],
                position: n
            })
    }, t.prototype.getTargeted = function(t) {
        var e, n, i = this.structure.getCurrentStructure(),
            o = i.getElements("walls"),
            r = new BABYLON.Vector2,
            s = new BABYLON.Vector2,
            a = 0,
            l = 0,
            h = 0,
            c = null,
            u = null;
        for (l = 0, h = o.length; h > l; l++)
            if (r = t.subtract(o[l].getPoints(0).position), s.copyFrom(r), n = o[l].getWallVector(), r.projectOnVector(n), s.subtractInPlace(r), s.length() <= o[l].thickness / 2 + 5)
                for (a = o[l].overtures.length - 1; a >= 0; a--)
                    if (c = o[l].overtures[a].position.x - o[l].overtures[a].width / 2 - 13, u = o[l].overtures[a].position.x + o[l].overtures[a].width / 2 + 13, e = r.length() * Math.sign(r.dot(n)), e > c && u > e)
                        return o[l].overtures[a];
        return null
    }, t.prototype._drawOverture = function(t, e, n, i) {
        if (i.getParentWall() || i.remove(hcsdesign.getSelectedStructure()), t.save(), t.strokeStyle = this.COLOR, t.translate(Math.round(i.getParentWall().getPoints(0).position.x * n) + e.x, Math.round(i.getParentWall().getPoints(0).position.y * n) + e.y), t.rotate(Math.atan2(-i.getParentWall().getWallVector().x, i.getParentWall().getWallVector().y) + Math.PI / 2), t.translate(Math.round(i.position.x * n), 0), t.fillStyle = "#fff", t.fillRect(Math.round(-i.width / 2 * n), Math.round(-i.getParentWall().thickness / 2 * n) - 1, Math.round(i.width * n), Math.round(i.getParentWall().thickness * n) + 2), t.fillStyle = this.COLOR, t.fillRect(Math.round(-i.width / 2 * n), Math.round(-i.getParentWall().thickness / 2 * n), Math.round(i.width * n), Math.round(i.getParentWall().thickness * n)), i.sliding) {
            t.strokeStyle = "rgba(255, 255, 255, .8)", t.fillStyle = "rgba(255, 255, 255, .4)", t.beginPath();
            var o = Math.round((i.getParentWall().thickness / 2 - 4) * n) + .5,
                r = Math.round(i.width / 2 * n);
            if (1 == i.nbCasement)
                t.rect(-r + .5, Math.round(-o / 2) - .5, Math.round(i.width * n) - 1, Math.round(o));
            else {
                var s = i.width / i.nbCasement * n;
                t.moveTo(r - .5, -.5), t.lineTo(-r + .5, -.5);
                for (var a = 0, l = -r + .5, h = o; a <= i.nbCasement; a++, l += s, h = -h)
                    l > r - s / 2 && r + s / 2 > l && (l = r - .5), a > 0 && t.lineTo(Math.round(l) - .5, -h), a < i.nbCasement && t.lineTo(Math.round(l) - .5, h);
                t.closePath()
            }
            t.fill(), t.stroke()
        } else
            "Garage" == i.type ? (-1 == i.side && t.rotate(Math.PI), t.strokeRect(Math.round(-i.width / 2 * n) + .5, Math.round(-i.getParentWall().thickness / 2 * n) + .5, Math.round(i.width * n), Math.round(i.height * n)), t.beginPath(), t.moveTo(Math.round(-i.width / 2 * n), Math.round(+i.getParentWall().thickness / 2 * n)), t.lineTo(0, Math.round((i.height - i.getParentWall().thickness / 2) * n)), t.lineTo(Math.round(i.width / 2 * n), Math.round(+i.getParentWall().thickness / 2 * n)), t.stroke()) : 1 == i.nbCasement ? (-1 == i.side && t.rotate(Math.PI), t.beginPath(), 0 == i.hinge ? (t.arc(Math.round(-i.width / 2 * n) + .5, Math.round(i.getParentWall().thickness / 2 * n) + .5, Math.round(i.width * n), 0, Math.PI / 2, !1), t.lineTo(Math.round(-i.width / 2 * n) + .5, Math.round(i.getParentWall().thickness / 2 * n) + .5)) : (t.arc(Math.round(i.width / 2 * n) + .5, Math.round(i.getParentWall().thickness / 2 * n) + .5, Math.round(i.width * n), Math.PI, Math.PI / 2, !0), t.lineTo(Math.round(i.width / 2 * n) + .5, Math.round(i.getParentWall().thickness / 2 * n) + .5)), t.stroke()) : 2 == i.nbCasement && (-1 == i.side && t.rotate(Math.PI), t.beginPath(), t.arc(Math.round(-i.width / 2 * n) + .5, Math.round(i.getParentWall().thickness / 2 * n) + .5, Math.round(i.width / 2 * n), 0, Math.PI / 2, !1), t.lineTo(Math.round(-i.width / 2 * n) + .5, Math.round(i.getParentWall().thickness / 2 * n) + .5), t.stroke(), t.beginPath(), t.arc(Math.round(i.width / 2 * n) + .5, Math.round(i.getParentWall().thickness / 2 * n) + .5, Math.round(i.width / 2 * n), Math.PI, Math.PI / 2, !0), t.lineTo(Math.round(i.width / 2 * n) + .5, Math.round(i.getParentWall().thickness / 2 * n) + .5), t.stroke());
        t.restore()
    }, t.prototype.compute = function() {
        for (var t = this.structure.getCurrentStructure(), e = t.getElements("walls"), n = 0; n < e.length; n++)
            for (var i = e[n].overtures.length - 1; i >= 0; i--)
                e[n].overtures[i].parentWall && e[n].overtures[i].parentWall.id != e[n].id && e[n].overtures.splice(i, 1)
    }, t.prototype.onStaticDraw = function(t, e, n) {
        var i = this.structure.getCurrentStructure().getElements("overtures");
        for (var o in i)
            this._drawOverture(t, e, n, i[o])
    }, t.prototype.onDragStart = function(t, e, n) {
        var i = e.getAbsolutePos(),
            o = i.position.subtract(i.vector.clone().scaleInPlace(e.width / 2)),
            r = i.position.add(i.vector.clone().scaleInPlace(e.width / 2));
        return hcsdesign.engine2D.registerEventCb("overtureComponent2D.drag-end", this.priority, "drag-end", hcsdesign.engine2D.MODE_DRAG, null, this.onDragEnd.bind(this), e), hcsdesign.engine2D.registerEventCb("overtureComponent2D.dynamic-draw", this.priority, "dynamic-draw", hcsdesign.engine2D.MODE_DRAG, null, this.onSelectionDynamicDraw.bind(this), e), n.planPos.distanceTo(o) <= 13 || n.planPos.distanceTo(r) <= 13 ? hcsdesign.engine2D.registerEventCb("overtureComponent2D.dragging", this.priority, "dragging", hcsdesign.engine2D.MODE_DRAG, null, this.onDraggingResize.bind(this), e) : hcsdesign.engine2D.registerEventCb("overtureComponent2D.dragging", this.priority, "dragging", hcsdesign.engine2D.MODE_DRAG, null, this.onDraggingMove.bind(this), e), this.overtureDragged = !0, !1
    }, t.prototype.onDraggingMove = function(t, e, n, i) {
        var o = this.structure.getCurrentStructure(),
            r = n.planPos.clone(),
            s = WallStructure.prototype.getNearestWall(r, o),
            a = s.getNearestPoint(r),
            l = a.distanceTo(s.getPoints(0).position);
        return i.position.x = l, i.setParentWall(s), i.projectOnWall(), hcsdesign.engine2D.requestStaticDraw(), !1
    }, t.prototype.onDraggingResize = function(t, e, n, i) {
        var o = n.planPos.clone(),
            r = i.parentWall.getNearestPoint(o),
            s = i.getAbsolutePos();
        return i.width = 2 * r.distanceTo(s.position) + 10, i.clampSize(), hcsdesign.engine2D.requestStaticDraw(), !1
    }, t.prototype.onDragEnd = function(t, e, n, i) {
        hcsdesign.engine2D.unregisterEventCb("overtureComponent2D.dynamic-draw"), this.overtureDragged = !1, i.width = Math.round(i.width), hcsdesign.getSelectedStructure().dirty(), hcsdesign.engine2D.requestStaticDraw()
    }, t.prototype.onHover = function(t, e) {
        return hcsdesign.engine2D.registerEventCb("overtureComponent2D.dynamic-draw", this.priority, "dynamic-draw", hcsdesign.engine2D.MODE_NORMAL, null, this.onSelectionDynamicDraw.bind(this), e), hcsdesign.engine2D.requestDynamicDraw(), !1
    }, t.prototype.onLeave = function() {
        hcsdesign.engine2D.unregisterEventCb("overtureComponent2D.dynamic-draw"), hcsdesign.engine2D.requestDynamicDraw()
    }, t.prototype.onSelectionDynamicDraw = function(t, e, n, i) {
        if (!i.parentWall)
            return !1;
        var o = i.parentWall.getPoints(0).position,
            r = i.parentWall.getWallVector().normalize(),
            s = o.add(r.clone().scaleInPlace(i.position.x - i.width / 2)),
            a = o.add(r.clone().scaleInPlace(i.position.x + i.width / 2)),
            l = {
                x: s.x * n + e.x,
                y: s.y * n + e.y
            },
            h = {
                x: a.x * n + e.x,
                y: a.y * n + e.y
            };
        hcsdesign.engine2D.symbols2D.drawGripSegment(t, l, h, [!1, !1, !1, !0], [!1, !0, !1, !1], i.getAngle())
    }, t.prototype.onAddOverture = function(t) {
        overture = new OvertureStructure, overture.type = t.overtureType, overture.elevation = t.elevation, overture.width = t.width, overture.height = t.height, overture.nbCasement = t.nbCasement, overture.sliding = t.sliding, overture.galandage = t.galandage, void 0 != t.hinge && (overture.hinge = t.hinge), void 0 != t.side && (overture.side = t.side), void 0 != t.batiThickness && (overture.batiThickness = t.batiThickness), void 0 != t.stretched_texture && (overture.stretched_texture = t.stretched_texture), hcsdesign.engine2D.registerEventCb("OvertureComponent2D.addOverture.wall.hover", this.priority, "hover", hcsdesign.engine2D.MODE_DRAW, WallStructure, this.onAddOvertureUpdate.bind(this), overture), hcsdesign.engine2D.registerEventCb("OvertureComponent2D.addOverture.all.move", this.priority, "mouse-move", hcsdesign.engine2D.MODE_DRAW, null, this.onAddOvertureUpdate.bind(this), overture), hcsdesign.engine2D.registerEventCb("OvertureComponent2D.addOverture.all.click", this.priority, "click", hcsdesign.engine2D.MODE_DRAW, null, this.onAddOvertureEnd.bind(this), overture), hcsdesign.engine2D.registerEventCb("OvertureComponent2D.addOverture.all.drag-start", this.priority, "drag-start", hcsdesign.engine2D.MODE_DRAW, null, this.onAddOvertureDragStart.bind(this), overture), this.core.engine2D.registerEventCb("OvertureComponent2D.addOverture.all.leave-draw-zone", this.priority, "leave-draw-zone", this.core.engine2D.MODE_DRAW, null, this.onAddOvertureLeaveZone.bind(this), overture), hcsdesign.engine2D.setMode(hcsdesign.engine2D.MODE_DRAW)
    }, t.prototype.onAddOvertureDragStart = function(t, e, n, i) {
        return 0 != (n.buttons & n.BUTTON_LEFT) ? (hcsdesign.engine2D.registerEventCb("OvertureComponent2D.addOverture.all.dragging", this.priority, "dragging", hcsdesign.engine2D.MODE_DRAG, null, this.onAddOvertureUpdate.bind(this), i), hcsdesign.engine2D.registerEventCb("OvertureComponent2D.addOverture.all.drag-end", this.priority, "drag-end", hcsdesign.engine2D.MODE_DRAG, null, this.onAddOvertureEnd.bind(this), i), !1) : void 0
    }, t.prototype.onAddOvertureUpdate = function(t, e, n, i) {
        hcsdesign.engine2D.setCursorIcon(hcsdesign.engine2D.symbols2D.drawCursorCheck.bind(hcsdesign.engine2D.symbols2D));
        var o = this.structure.getCurrentStructure();
        return e instanceof WallStructure && i.setParentWall(e), o.insertElement("overtures", i), this.onDraggingMove(t, e, n, i), hcsdesign.engine2D.requestStaticDraw(), !1
    }, t.prototype.onAddOvertureEnd = function(t, e, n, i) {
        return "deselect" != t.from && ujs.notify("hcs.menu.main.deselect"), "touchUp" == t.type && this.onAddOvertureUpdate(t, e, n, i), hcsdesign.engine2D.setMode(hcsdesign.engine2D.MODE_NORMAL), /*hcsdesign.helpBubbleManager.display("hcs.2d.properties"), */hcsdesign.getSelectedStructure().dirty(), hcsdesign.engine2D.requestStaticDraw(), !1
    }, t.prototype.onAddOvertureLeaveZone = function(t, e) {
        this.core.engine2D.unregisterEventCb("OvertureComponent2D.addOverture.wall.hover"), this.core.engine2D.unregisterEventCb("OvertureComponent2D.addOverture.all.click"), this.core.engine2D.unregisterEventCb("OvertureComponent2D.addOverture.all.move"), this.core.engine2D.unregisterEventCb("OvertureComponent2D.addOverture.all.drag-start"), this.core.engine2D.unregisterEventCb("OvertureComponent2D.addOverture.all.leave-draw-zone");
        var n = this.core.getSelectedStructure();
        return e.remove(n), this.core.engine2D.setMode(this.core.engine2D.MODE_NORMAL), hcsdesign.getSelectedStructure().dirty(), hcsdesign.engine2D.requestStaticDraw(), !1
    }, t.prototype.onContextMenu = function(t, e) {
        var n = [];
        if (n.push({
                name: "width",
                label: _("宽度"),
                type: "slider",
                cast: "int",
                unit: "cm",
                value: {
                    min: 20,
                    max: e.parentWall.getLength(),
                    step: 1,
                    value: e.width
                }
            }), n.push({
                name: "height",
                label: _("高度"),
                type: "slider",
                cast: "int",
                unit: "cm",
                value: {
                    min: 20,
                    max: e.parentWall.height,
                    step: 1,
                    value: e.height
                }
            }), n.push({
                name: "elevation",
                label: _("离地面的高度"),
                type: "slider",
                cast: "int",
                unit: "cm",
                value: {
                    min: 0,
                    max: e.parentWall.height,
                    step: 1,
                    value: e.elevation
                }
            }), /*n.push({
                name: "plinte",
                label: _("Plinte"),
                type: "slider",
                cast: "int",
                value: {
                    min: 0,
                    max: 1,
                    step: 1,
                    value: e.plttt
                }
            }), "Door" == e.type && n.push({
                name: "stretched_texture",
                label: _("stretched texture"),
                type: "checkbox",
                cast: "bool",
                value: e.stretched_texture
            }),*/ "Garage" == e.type && n.push({
                name: "nbCasement",
                label: _("Number of casements"),
                type: "slider",
                cast: "int",
                value: {
                    min: 1,
                    max: 6,
                    step: 1,
                    value: e.nbCasement
                }
            }), "Garage" != e.type) {
            var i = _("Door" == e.type ? "门" : "Window" == e.type ? "窗" : "");
            n.push({
                name: "_applyToAll",
                label: _("将宽度、高度、离地面高度应用到所有的{typetarget}").replace("{typetarget}", i),
                type: "checkbox",
                cast: "bool",
                value: this._applyToAll
            })
        }
        (e.sliding || "Window" == e.type) && n.push({
            name: "nbCasement",
            label: _("窗的个数"),
            type: "slider",
            cast: "int",
            value: {
                min: 1,
                max: 5,
                step: 1,
                value: e.nbCasement
            }
        }), e.nbCasement % 2 != 1 || e.sliding || "Garage" == e.type || n.push({
            name: "hinge",
            label: _("开窗方向"),
            type: "button",
            cast: "int",
            value: _("切换")
        }), e.nbCasement > 0 && !e.sliding && n.push({
            name: "side",
            label: _("内外方向"),
            type: "button",
            cast: "int",
            value: _("切换")
        }), hcsdesign.engine2D.displayContextMenu(n, e, this.onContextMenuPropertyChanged.bind(this), this.onContextMenuRemove.bind(this))
    }, t.prototype.onContextMenuPropertyChanged = function(t, e, n) {
        switch (e) {
            case "hinge":
                t.hinge = (t.hinge + 1) % 2;
                break;
            case "side":
                t.side = -t.side;
                break;
            case "_applyToAll":
                this._applyToAll = n;
                break;
            default:
                t[e] = n
        }
        if (this._applyToAll && ("elevation" == e || "height" == e || "width" == e))
            for (var i = hcsdesign.getSelectedStructure(), o = i.getElements("overtures"), r = 0; r < o.length; r++)
                o[r].type == t.type && (o[r][e] = n);
        hcsdesign.engine2D.requestStaticDraw()
    }, t.prototype.onContextMenuRemove = function(t) {
        var e = hcsdesign.getSelectedStructure();
        t.remove(e)
    }, t.prototype.onDoubleClick = function(t, e) {
        return /*hcsdesign.helpBubbleManager.display("hcs.2d.dup-overture"),*/ this.onAddOverture({
            overtureType: e.type,
            elevation: e.elevation,
            width: e.width,
            height: e.height,
            nbCasement: e.nbCasement,
            sliding: e.sliding,
            hinge: e.hinge,
            side: e.side,
            batiThickness: e.batiThickness
        }), !0
    }, t
}();
var OvertureComponent3D = function() {
    var t, e = 0,
        n = function(e) {
            BaseComponent3D.call(this, e, "OvertureComponent3D"), this.priority = 11, t = this, this._defaultMaterial = new hcs.WhiteMaterial("bati", hcsdesign.engine3D.scene, {
                factor: 1
            })
        };
    return n.prototype = new BaseComponent3D, n.prototype.startListening = function() {
        document.addEventListener("hcs.engine3d.wallsReady", this.onWallsReady, !1), document.addEventListener("hcs.engine3d.subslopesReady", this.onSubslopesReady, !1)
    }, n.prototype.stopListening = function() {
        document.removeEventListener("hcs.engine3d.wallsReady", this.onWallsReady, !1), document.removeEventListener("hcs.engine3d.subslopesReady", this.onSubslopesReady, !1)
    }, n.prototype.onWallsReady = function(e) {
        for (var n = e.floor || t.getFloor(), i = e.structure || t.core.getSelectedStructure(), o = e.walls || [], r = hcsdesign.getComponentByName("WallComponent3D").get3DWallFrom2D(i), s = new BABYLON.CSG.FromMesh(r), a = i.getElements("overtures"), l = new BABYLON.CSG, h = 0; h < a.length; h++)
            l.unionInPlace(t.overtureBox(a[h], i, n));
        t.carveWithOvertureMeshes(l, s, r, n);
        for (var h = 0; h < a.length; h++)
            t.createOverture(a[h], i, n);
        ujs.notify("hcs.engine3d.overturesReady", {
            floor: n,
            structure: i,
            walls: o
        })
    }, n.prototype.onSubslopesReady = function(e) {
        for (var n = e.floor || t.getFloor(), i = e.structure || t.core.getSelectedStructure(), o = e.walls || [], r = i.getElements("subslopes"), s = 0; s < r.length; s++)
            for (var a = 0; a < r[s].overtures.length; a++)
                o = t.carveSubslopeOverture(r[s], r[s].overtures[a], i, n), t.createOverture(r[s].overtures[a], i, n);
        var l = hcsdesign.engine3D.searchComponent("WallComponent3D");
        l && l.createInstances(o);
        var h = hcsdesign.engine3D.searchComponent("RoomComponent3D");
        h && h.createInstances(h.mesh), n.roomMesh = o, ujs.notify("hcs.engine3d.subslopeOverturesReady", {
            floor: n,
            structure: i,
            walls: o
        })
    }, n.prototype.createOverture = function(t, n, i) {
        function o(t) {
            t.traverse(function(t) {
                "vitre" !== t.name && (hcsdesign.engine3D.castShadows(t), t.receiveShadows = !0)
            })
        }

        function r(t, e) {
            var n = void 0 !== t.alternativeOpacity ? t.alternativeOpacity : e;
            t.alternativeOpacity = t.alpha, t.alpha = n, t.opacitySwitched = !t.opacitySwitched, t.transparent = 1 != t.alpha
        }
        var s, i = i || this.core.getComponentByName("FloorComponent3D").getFloor(n),
            a = function(n) {
                var s = n.getObject3D(hcsdesign.engine3D.scene);
                s.structure = t, s.animate = n.animate.bind(n), s.decorate = n.decorate.bind(s), o(s), s.structure.programmableInstance = n, t.programmableInstance = n, s.isDecorable = !0, s.parent = i, s.name = "Overture_" + e++;
                var a = t.programmableInstance.materials;
                if (t.programmableInstance.getDefaultMaterials && (a = ujs.mergeObjects(t.programmableInstance.getDefaultMaterials(hcsdesign.engine3D.scene), a)), t.programmableInstance.materials = a, s.initMaterials(a), t.material.opacitySwitched)
                    for (var l in n.materials)
                        n.materials.hasOwnProperty(l) && !n.materials[l].opacitySwitched && r(n.materials[l], .2)
            }.bind(this);
        switch (t.type) {
            case "Door":
                s = "Aperture.Door.js";
                break;
            case "Window":
                s = "Aperture.Window.js";
                break;
            case "Garage":
                s = "Aperture.Garage.js";
                break;
            case "Velux":
                s = "Aperture.Velux.js";
                break;
            case "Dormer":
                s = "Aperture.Dormer.js";
                break;
            default:
                s = "Aperture.js"
        }
        var l = t.programmableInstance ? t.programmableInstance.materials : null,
            h = {
                type: t.type,
                width: t.width,
                height: t.height,
                thickness: t.thickness,
                elevation: t.elevation,
                angle: -t.angle || 0,
                angleX: -t.angleX || 0,
                hinge: t.hinge,
                side: t.side,
                nbCasement: t.nbCasement,
                minsize: t.minsize,
                sliding: t.sliding,
                galandage: t.galandage,
                batiThickness: t.batiThickness,
                wallThickness: t.wallThickness,
                dormerRoof: t.dormerRoof || {},
                plinte: t.plinte,
                stretched_texture: t.stretched_texture
            };
        return hcs.Programmable.createInstance(s, h, l, t, a, !1, this.engine3D), !0
    }, n.prototype.overtureBox = function(t, e, n) {
        var e = e || this.core.getSelectedStructure(),
            n = n || this.core.getComponentByName("FloorComponent3D").getFloor(e),
            i = t.getAbsolutePos().position;
        i.z = -i.y, i.y = t.elevation + t.height / 2; {
            var o = 5,
                r = t.parentWall.getWallVector(),
                s = Math.atan2(-r.y, r.x);
            t.parentWall.thickness + o, hcsdesign.getComponentByName("WallComponent3D").get3DWallFrom2D(e)
        }
        t.material = t.material || this._defaultMaterial.clone("DefaultMaterial");
        var a = new BABYLON.Mesh.CreateBloc("CSGtemp", t.width, t.height, t.parentWall.thickness + 10, hcsdesign.engine3D.scene),
            l = a.getBoundingBox();
        l.angle = s, l.center = i, a.subMeshes[0].objectInstance = t, a.subMeshes[0].boundingBox = l, a.position = i, a.rotation.y = -s, a.parent = n;
        var h = new BABYLON.CSG.FromMesh(a);
        return a.dispose(), h
    }, n.prototype.carveWithOvertureMeshes = function(t, e, n, i) {
        var o = o || this.core.getSelectedStructure(),
            i = i || this.core.getComponentByName("FloorComponent3D").getFloor(o);
        e.subtractInPlace(t);
        var r = e.toMesh(n.name, n.material, hcsdesign.engine3D.scene, !0);
        return r.isDecorable = !0, r.parent = i, hcsdesign.getComponentByName("WallComponent3D").replaceWall(n, r), hcsdesign.engine3D.castShadows(r), r
    }, n.prototype.carveSubslopeOverture = function(t, e, n, i) {
        var n = n || this.core.getSelectedStructure(),
            i = i || this.core.getComponentByName("FloorComponent3D").getFloor(n),
            o = t.polygonPoints[2].dot(e.wallOrtho),
            r = t.polygonPoints[0].dot(e.wallOrtho),
            s = Math.atan2(o - r, -(t.hiHeight - t.lowHeight)),
            a = t.wall.thickness,
            l = -a / Math.tan(s),
            h = new BABYLON.Vector3(e.center.x, 0, -e.center.y);
        h.y = e.offset / t.offset * (-l + t.hiHeight - t.lowHeight) + t.lowHeight + l / 2;
        var c = t.wall.getWallVector(),
            u = new BABYLON.Vector2(c.y, -c.x),
            p = new BABYLON.Vector2(t.polygonPoints[2].x - t.polygonPoints[0].x, t.polygonPoints[2].y - t.polygonPoints[0].y);
        p.projectOnVector(u);
        var d = p.x * u.x + p.y * u.y;
        0 > d && (c.x = -c.x, c.y = -c.y, u.x = -u.x, u.y = -u.y);
        var m = Math.atan2(-c.y, c.x);
        e.elevation = h.y, e.angle = m, e.angleX = s;
        var g = hcsdesign.getComponentByName("WallComponent3D").get3DWallFrom2D(n),
            f = new BABYLON.Mesh.CreateBloc("CSGtemp", e.width, e.height, 20, hcsdesign.engine3D.scene),
            y = f.getBoundingBox();
        y.angle = m, y.center = h, f.material = new BABYLON.StandardMaterial("CSGtemp", hcsdesign.engine3D.scene), f.subMeshes[0].objectInstance = e, f.position = h, f.rotation.y = -m + Math.PI, f.rotation.x = s, f.parent = i;
        var _ = new BABYLON.CSG.FromMesh(g),
            v = new BABYLON.CSG.FromMesh(f),
            b = _.subtract(v);
        e.material = e.material || new BABYLON.StandardMaterial("bati", hcsdesign.engine3D.scene);
        var w = b.toMesh(g.name, g.material, hcsdesign.engine3D.scene, !0);
        return f.dispose(), w.isDecorable = !0, w.parent = i, hcsdesign.getComponentByName("WallComponent3D").replaceWall(g, w), hcsdesign.engine3D.castShadows(w), w
    }, n
}();
SubSlopeStructure = function() {
    var t = function() {
        BaseStructure.call(this, "SubSlopeStructure"), this.points = [], this.side = [], this.wall = null, this.neighbors = [], this.overtures = [], this.offset = 0, this.materials = {}, this.lowHeight = 80, this.hiHeight = 250, this.polygonPoints = [new BABYLON.Vector2, new BABYLON.Vector2, new BABYLON.Vector2, new BABYLON.Vector2], this.needsUpdate = !0
    };
    return t.prototype = new BaseStructure, t.prototype.serialize = function() {
        var t = {
            "class": {
                name: "SubSlopeStructure"
            }
        };
        return ujs.serializeObject(this, t, ["offset", "lowHeight", "hiHeight", "overtures", "materials"]), t
    }, t.Deserialize = function(t) {
        var e = new SubSlopeStructure;
        ujs.deserializeObject(t, e, ["offset", "lowHeight", "_overturesIds", "hiHeight", "overtures", "materials"]);
        for (var n in e.overtures)
            e.overtures[n].parent = e;
        return e.checkCoherence(), e
    }, t.prototype.checkCoherence = function() {
        var t;
        this.lowHeight > this.hiHeight && (t = this.hiHeight, this.hiHeight = this.lowHeight, this.lowHeight = t), 0 === this.lowHeight && (this.lowHeight = 1), 0 == this.materials.length && (this.materials = {}), this.offset > 4e3 && (this.offset = 4e3)
    }, t.prototype.indexClosest = function(t) {
        return this.wall.distanceFrom(t[0]) < this.wall.distanceFrom(t[1]) ? 0 : 1
    }, t.prototype.isSameSide = function(t) {
        var e = this.wall.distanceFrom(t[0]) < this.wall.distanceFrom(t[1]) ? 0 : 1,
            n = t[(e + 1) % 2].subtract(t[e]);
        return n.dot(this.side[0]) >= 0
    }, t.prototype.getVector = function() {
        return this.points[1].subtract(this.points[0])
    }, t.prototype.distanceFrom = function(t) {
        var e = t.points[1].subtract(t.points[0]),
            n = e.lengthSquared(),
            i = this.points[1].subtract(t.points[0]),
            o = this.points[0].subtract(t.points[0]),
            r = i.projectOnVector(e),
            s = o.projectOnVector(e);
        r.dot(e) < 0 && r.copyFromFloats(0, 0, 0), s.dot(e) < 0 && s.copyFromFloats(0, 0, 0), r.dot(e) > n && r.copyFrom(e), s.dot(e) > n && s.copyFrom(e);
        var a = t.points[0].add(r),
            l = t.points[0].add(s);
        return Math.min(a.distanceTo(this.points[1]), l.distanceTo(this.points[0]))
    }, t.prototype.getPolygonPoints = function() {
        this.polygonPoints[1].x = this.wall.points[0].position.x + this.wall.thickness / 2, this.polygonPoints[1].y = this.wall.points[0].position.y + this.wall.thickness / 2, this.polygonPoints[0].x = this.wall.points[1].position.x + this.wall.thickness / 2, this.polygonPoints[0].y = this.wall.points[1].position.y - this.wall.thickness / 2, this.polygonPoints[3].x = this.wall.points[0].position.x - this.offset - this.wall.thickness / 2, this.polygonPoints[3].y = this.wall.points[0].position.y + this.wall.thickness / 2, this.polygonPoints[2].x = this.wall.points[1].position.x - this.offset - this.wall.thickness / 2, this.polygonPoints[2].y = this.wall.points[1].position.y - this.wall.thickness / 2
    }, t.prototype.computePolygonPoints = function(t) {
        if ((t || this.needsUpdate) && 0 != this.side.length) {
            var e = this.side[0].scale(this.offset),
                n = function(t, n) {
                    if (n >= 2) {
                        if (t.offset <= 0)
                            return void(this.polygonPoints[n] = this.polygonPoints[n - 2].add(e.clone().normalize().scaleInPlace(this.offset + this.wall.thickness)));
                        var i = t.side[0].scale(t.offset),
                            o = this.points[0].add(e),
                            r = this.points[1].add(e),
                            s = t.points[0].add(i),
                            a = t.points[1].add(i),
                            l = BABYLON.Vector2.Intersect(o, r, s, a, Math.PI / 50);
                        if (!l)
                            return Logger.warning("No intersect"), void(this.polygonPoints[n] = this.polygonPoints[n - 2].add(e));
                        this.polygonPoints[n].copyFrom(l)
                    } else {
                        var o = this.polygonPoints[0],
                            r = this.polygonPoints[1],
                            s = t.points[0].subtract(t.side[0].scale(t.wall.thickness)),
                            a = t.points[1].subtract(t.side[0].scale(t.wall.thickness)),
                            l = BABYLON.Vector2.Intersect(o, r, s, a, Math.PI / 50);
                        if (!l)
                            return;
                        this.polygonPoints[n].copyFrom(l)
                    }
                };
            if (this.needsUpdate = !1, this.polygonPoints[0].copyFrom(this.points[0]), this.polygonPoints[1].copyFrom(this.points[1]), this.offset > 0) {
                var i = this.wall.thickness;
                this.polygonPoints[0].subtractInPlace(this.side[0].scale(i)), this.polygonPoints[1].subtractInPlace(this.side[0].scale(i))
            }
            var o = function(t) {
                var i = .001;
                if (this.neighbors[t]) {
                    for (var o = 0; o < this.neighbors[t].subSlopes.length && this.distanceFrom(this.neighbors[t].subSlopes[o]) > i;)
                        o++;
                    var r = this.neighbors[t].subSlopes[o];
                    r && r.wall != this.wall ? (n.call(this, r, t), n.call(this, r, t + 2)) : this.polygonPoints[t + 2] = this.polygonPoints[t].add(e.clone().normalize().scaleInPlace(this.offset + this.wall.thickness))
                } else
                    this.polygonPoints[t + 2] = this.polygonPoints[t].add(e.clone().normalize().scaleInPlace(this.offset + this.wall.thickness))
            };
            o.call(this, 0), o.call(this, 1)
        }
    }, t.prototype.isPointIn = function(t) {
        var e = [this.polygonPoints[0], this.polygonPoints[1], this.polygonPoints[3], this.polygonPoints[2]];
        return t.isPointInPolygon(e)
    }, t.prototype.plane = function() {
        if (this.offset <= 0)
            return null;
        var t = [new BABYLON.Vector3(this.polygonPoints[0].x, this.lowHeight, -this.polygonPoints[0].y), new BABYLON.Vector3(this.polygonPoints[1].x, this.lowHeight, -this.polygonPoints[1].y), new BABYLON.Vector3(this.polygonPoints[3].x, this.hiHeight, -this.polygonPoints[3].y), new BABYLON.Vector3(this.polygonPoints[2].x, this.hiHeight, -this.polygonPoints[2].y)],
            e = t[2].subtract(t[1]),
            n = t[0].subtract(t[1]);
        if (e.cross(n), e.y < 0) {
            var i = t[0];
            t[0] = t[1], t[1] = i, i = t[2], t[2] = t[3], t[3] = i
        }
        return t
    }, t.prototype.remove = function() {
        this.offset = 0, this.lowHeight = 80, this.hiHeight = 250, this.needsUpdate = !0, this.overtures.length = 0
    }, t.prototype.getNearestSubSlope = function(t, e) {
        for (var n, i = e.getElements("SubSlopeStructure"), o = null, r = +1 / 0, s = 0, a = i.length; a > s; s++)
            n = i[s].distanceFrom(t), r > n && (o = i[s], r = n);
        return o
    }, t.prototype.addMaterial = function(t, e, n) {
        n.colorOnly ? this.materials[n.materialIndex] ? (this.materials[n.materialIndex].color.r = n.color.r, this.materials[n.materialIndex].color.g = n.color.g, this.materials[n.materialIndex].color.b = n.color.b) : (this.materials[n.materialIndex] = n, n.colorOnly = !1) : this.materials[n.materialIndex] = n
    }, t
}();
SubSlopeOvertureStructure = function() {
    var t = function() {
        BaseStructure.call(this, "SubSlopeOvertureStructure"), this.type = "Velux", this.width = 100, this.height = 150, this.thickness = 5, this.nbCasement = 1, this.sliding = 0, this.dormerRoof = {}, this.wallThickness = 10, this.parent = null, this.position = new BABYLON.Vector2, this.polygon = []
    };
    return t.prototype = new BaseStructure, t.prototype.serialize = function() {
        var t = {
            "class": {
                name: "SubSlopeOvertureStructure"
            }
        };
        return ujs.serializeObject(this, t, null, ["parent", "wall"]), t
    }, t.Deserialize = function(t) {
        var e = new SubSlopeOvertureStructure;
        return ujs.deserializeObject(t, e), e
    }, t.prototype.getParent = function() {
        return this.parent
    }, t.prototype.setParent = function(t) {
        if (t != this.parent) {
            null != this.parent && this.parent.overtures.splice(this.parent.overtures.indexOf(this), 1), this.parent = t;
            for (var e = 0; e < this.parent.overtures.length; e++) {
                var n = this.parent.overtures[e];
                if (this.id == n.id)
                    return
            }
            this.parent.overtures.push(this)
        }
    }, t.prototype.isTargeted = function(t) {
        return t.isPointInPolygon(this.polygon)
    }, t.prototype.remove = function() {
        this.parent.overtures.splice(this.parent.overtures.indexOf(this), 1)
    }, t.prototype.remove = function() {
        this.parent.overtures.splice(this.parent.overtures.indexOf(this), 1)
    }, t.prototype.getAbsolutePosition = function() {
        var t = new BABYLON.Vector2;
        return t = this.parent.wall.points[0].position.clone().lerp(this.parent.wall.points[1].position, .5).add(this.position), {
            position: t,
            vector: null
        }
    }, t.prototype.to3D = function() {}, t
}();
SubSlopeComponent2D = function() {
    var t = function(t) {
        BaseComponent2D.call(this, t, "SubSlopeComponent2D"), this.priority = 100, this.subSlopes = [], this.needsUpdate = !0, this._applyHeightToAll = !1, this._HANDLERADIUS = 10, this._HANDLESTATICSTYLE = "rgba(137,115,100,0.8)", this._HANDLESTYLE = this._HANDLESTATICSTYLE
    };
    return t.prototype = new BaseComponent2D, t.prototype.startListening = function() {
        this.onEditSubSlope = this.onEditSubSlope.bind(this), this.onModeSubSlopeEnd = this.onModeSubSlopeEnd.bind(this), document.addEventListener("hcs.engine2d.onEditSubSlope", this.onEditSubSlope, !1), document.addEventListener("hcs.engine2d.onModeSubSlopeEnd", this.onModeSubSlopeEnd, !1), hcsdesign.engine2D.registerEventCb("SubSlopeComponent2D.static-draw", this.priority, "static-draw", hcsdesign.engine2D.MODE_SUBSLOPE | hcsdesign.engine2D.MODE_DRAG, null, this.onStaticDraw.bind(this), null), hcsdesign.engine2D.registerEventCb("SubSlopeComponent2D.hover", this.priority, "hover", hcsdesign.engine2D.MODE_SUBSLOPE, SubSlopeStructure, this.onHover.bind(this), null), hcsdesign.engine2D.registerEventCb("SubSlopeComponent2D.leave", this.priority, "leave", hcsdesign.engine2D.MODE_SUBSLOPE, SubSlopeStructure, this.onLeave.bind(this), null), hcsdesign.engine2D.registerEventCb("SubSlopeComponent2D.dragstart", this.priority, "drag-start", hcsdesign.engine2D.MODE_SUBSLOPE, SubSlopeStructure, this.onDragStart.bind(this), null), hcsdesign.engine2D.registerEventCb("SubSlopeComponent2D.subslope-end", this.priority, "subslope-end", null, null, this.onSubSlopeEnd.bind(this), null), hcsdesign.engine2D.registerEventCb("SubSlopeComponent2D.context-menu", this.priority, "click", hcsdesign.engine2D.MODE_SUBSLOPE, SubSlopeStructure, this.onContextMenu.bind(this), null)
    }, t.prototype.stopListening = function() {
        document.removeEventListener("hcs.engine2d.onEditSubSlope", this.onEditSubSlope, !1), document.removeEventListener("hcs.engine2d.onModeSubSlopeEnd", this.onModeSubSlopeEnd, !1), hcsdesign.engine2D.unregisterEventCb("SubSlopeComponent2D.static-draw"), hcsdesign.engine2D.unregisterEventCb("SubSlopeComponent2D.hover"), hcsdesign.engine2D.unregisterEventCb("SubSlopeComponent2D.leave"), hcsdesign.engine2D.unregisterEventCb("SubSlopeComponent2D.dragstart"), hcsdesign.engine2D.unregisterEventCb("SubSlopeComponent2D.subslope-end"), hcsdesign.engine2D.unregisterEventCb("SubSlopeComponent2D.context-menu")
    }, t.prototype.initialize = function() {
        this.startListening();
        /*var t = {
            id: "subslopes",
            title: _("斜顶"),
            index: 90,
            action: "hcs.engine2d.onEditSubSlope",
            cancelAction: "hcs.engine2d.onModeSubSlopeEnd"
        };
        ujs.notify("hcs.menu.main.add", {
            item: t,
            menuPath: "0",
            position: 90
        })*/
    }, t.prototype.onEditSubSlope = function() {
        this.needsUpdate = !0, hcsdesign.engine2D.setMode(hcsdesign.engine2D.MODE_SUBSLOPE), hcsdesign.engine2D.requestStaticDraw()
    }, t.prototype.onModeSubSlopeEnd = function() {
        hcsdesign.engine2D.setMode(hcsdesign.engine2D.MODE_NORMAL)
    }, t.prototype.onSubSlopeEnd = function() {
        hcsdesign.engine2D.requestStaticDraw()
    }, t.prototype.onStaticDraw = function(t, e, n) {
        0 != (hcsdesign.engine2D.getMode() & hcsdesign.engine2D.MODE_SUBSLOPE) && (this.getSubSlopes(), this.update(), this.draw(t, e, n))
    }, t.prototype.onHover = function(t, e) {
        return this._HANDLESTYLE = "rgba(137,115,100,0.8)", hcsdesign.engine2D.registerEventCb("SubSlopeComponent2D.dynamic-draw", this.priority, "dynamic-draw", null, null, this.onDynamicDraw.bind(this), e), hcsdesign.engine2D.requestDynamicDraw(), !1
    }, t.prototype.onLeave = function() {
        this._HANDLESTYLE = "rgba(137,115,100,0.8)", hcsdesign.engine2D.unregisterEventCb("SubSlopeComponent2D.dynamic-draw"), hcsdesign.engine2D.requestDynamicDraw()
    }, t.prototype.onDragStart = function(t, e) {
        return hcsdesign.engine2D.registerEventCb("SubSlopeComponent2D.dragging", this.priority, "dragging", hcsdesign.engine2D.MODE_DRAG, null, this.onDragging.bind(this), e), hcsdesign.engine2D.registerEventCb("SubSlopeComponent2D.drag-end", this.priority, "drag-end", hcsdesign.engine2D.MODE_DRAG, null, this.onDragEnd.bind(this), e), !1
    }, t.prototype.onDragging = function(t, e, n, i) {
        var o = hcsdesign.getSelectedStructure(),
            r = n.posDelta.scaleInPlace(1 / hcsdesign.engine2D.getZoom()),
            s = r.clone().projectOnVector(i.polygonPoints[3].subtract(i.polygonPoints[2])),
            a = r.subtractInPlace(s),
            l = [];
        l[0] = i.polygonPoints[0], l[1] = i.polygonPoints[1], l[2] = i.polygonPoints[3], l[3] = i.polygonPoints[2];
        for (var h = i.overtures.length, c = 0; h > c; c++)
            if (void 0 != i.overtures[c])
                for (var u = 0; u < i.overtures[c].polygon.length; u++)
                    if (!i.overtures[c].polygon[u].isPointInPolygon(l) && a.dot(i.side[0]) < 0 && (i.overtures[c].position.x += r.x, i.overtures[c].position.y += r.y, 1 == u || 2 == u)) {
                        i.overtures[c].remove(i.overtures[c]);
                        break
                    }
        var p = i.wall.getWallVector(),
            d = new BABYLON.Vector2;
        d.x = p.y, d.y = p.x;
        for (var m = 0; m < i.neighbors.length; m++) {
            var p = i.neighbors[m].getWallVector(),
                g = new BABYLON.Vector2(r.x, r.y);
            g.projectOnVector(p);
            var f = [];
            f[0] = i.neighbors[m].subSlopes[0].polygonPoints[0], f[1] = i.neighbors[m].subSlopes[0].polygonPoints[1], f[2] = i.neighbors[m].subSlopes[0].polygonPoints[3], f[3] = i.neighbors[m].subSlopes[0].polygonPoints[2];
            for (var y = 0; y < i.neighbors[m].subSlopes[0].overtures.length; y++)
                for (var _ = 0; 4 > _; _++)
                    !i.neighbors[m].subSlopes[0].overtures[y].polygon[_].isPointInPolygon(f) && a.dot(i.side[0]) > 0 && (i.neighbors[m].subSlopes[0].overtures[y].position.x += g.x, i.neighbors[m].subSlopes[0].overtures[y].position.y += g.y)
        }
        i.offset += a.dot(i.side[0]), i.offset < 0 && (i.offset = 0);
        var v = function(t, e) {
                for (var n = 0; n < t.subSlopes.length; n++) {
                    var i = t.subSlopes[n].neighbors.indexOf(e.wall);
                    if (-1 != i)
                        return i
                }
                return -1
            },
            b = function(t, e) {
                for (var n = 0; n < t.subSlopes.length; n++) {
                    var i = t.subSlopes[n].points[1].subtract(t.subSlopes[n].points[0]),
                        o = e.subtract(t.subSlopes[n].points[0]),
                        r = i.lengthSquared(),
                        s = i.dot(o);
                    if (s >= 0 && r >= s)
                        return t.subSlopes[n]
                }
                return null
            };
        if (i.offset >= 0 && i.neighbors[0] && i.neighbors[1]) {
            var w, x, C;
            i.neighbors[0].subSlopes[0] && (w = v(i.neighbors[0], i), x = i.neighbors[0].subSlopes[0].indexClosest(i.points), -1 == w && (C = b(i.neighbors[0], i.points[x]), this.splitSubSlope(C, i))), i.neighbors[1].subSlopes[0] && (w = v(i.neighbors[1], i), x = i.neighbors[1].subSlopes[0].indexClosest(i.points), -1 == w && (C = b(i.neighbors[1], i.points[x]), this.splitSubSlope(C, i)))
        }
        for (var M = o.getElements("subslopes"), c = 0; c < M.length; c++)
            - 1 != M[c].neighbors.indexOf(i.wall) && (M[c].needsUpdate = !0);
        i.needsUpdate = !0, hcsdesign.engine2D.requestStaticDraw()
    }, t.prototype.onDragEnd = function() {
        hcsdesign.engine2D.requestDynamicDraw(), ujs.notify("hcs.subslope.drag-end")
    }, t.prototype.onDynamicDraw = function(t, e, n, i) {
        if (0 != (hcsdesign.engine2D.getMode() & hcsdesign.engine2D.MODE_SUBSLOPE)) {
            var o = BABYLON.Vector2.Lerp(i.polygonPoints[3], i.polygonPoints[2], .5);
            o.scaleInPlace(n), o.addInPlace(e)
        }
    }, t.prototype.update = function(t) {
        if ((t || hcsdesign.getSelectedStructure().isDirty()) && this.getSubSlopes(!0, t), 0 != (hcsdesign.engine2D.getMode() & hcsdesign.engine2D.MODE_SUBSLOPE))
            for (var t = hcsdesign.getSelectedStructure(), e = t.getElements("subslopes"), n = 0, i = e.length; i > n; n++)
                e[n].computePolygonPoints()
    }, t.prototype.getTargeted = function(t) {
        if (0 != (hcsdesign.engine2D.getMode() & hcsdesign.engine2D.MODE_SUBSLOPE)) {
            for (var e = hcsdesign.getSelectedStructure(), n = e.getElements("subslopes"), i = 0; i < n.length; i++) {
                var o = BABYLON.Vector2.Lerp(n[i].polygonPoints[3], n[i].polygonPoints[2], .5);
                if (t.distanceTo(o) < this._HANDLERADIUS / hcsdesign.engine2D.getZoom())
                    return n[i]
            }
            return null
        }
    }, t.prototype.getSubSlopes = function(t, e) {
        var e = e || hcsdesign.getSelectedStructure(),
            n = e.getElements("subslopes");
        if (!this.needsUpdate && !t)
            return n;
        for (var i = function(t) {
                if (!(t.points.length <= 2)) {
                    for (var e, n = t.points[0], i = t.points[1].subtract(n).normalize(), o = 0, r = t.points[1].subtract(n).dot(i), s = 0, a = 1, l = 1, h = t.points.length; h > l; l++)
                        e = t.points[l].subtract(n).dot(i), o > e ? (s = l, o = e) : e > r && (a = l, r = e);
                    t.points = [t.points[s], t.points[a]], t.side = [t.side[s], t.side[a]], t.neighbors = [t.neighbors[s], t.neighbors[a]]
                }
            }, o = hcsdesign.getComponentByName("RoomComponent2D").getAllSubSlopes(e), r = e.getElements("walls"), s = [], a = [], l = 0; l < r.length; l++) {
            for (var h = [], c = 0; c < r[l].subSlopes.length; c++)
                h.push({
                    offset: r[l].subSlopes[c].offset,
                    lowHeight: r[l].subSlopes[c].lowHeight,
                    hiHeight: r[l].subSlopes[c].hiHeight,
                    materials: r[l].subSlopes[c].materials,
                    overtures: r[l].subSlopes[c].overtures
                });
            r[l].subSlopes.length = 0, s.push(h), a.push(r[l])
        }
        for (var l = o.length - 1; l >= 0; l--)
            if (o[l].wall.thickness < 20)
                o.splice(l, 1);
            else if (o[l].points.length < 2)
            o.splice(l, 1);
        else if (o[l].points[1].distanceTo(o[l].points[0]) < 10)
            o.splice(l, 1);
        else {
            i(o[l]), o[l].wall.subSlopes.push(o[l]), o[l].offset = 0;
            var u = s[a.indexOf(o[l].wall)];
            if (u && u.length > 0 && u[o[l].wall.subSlopes.length - 1]) {
                var p = u[o[l].wall.subSlopes.length - 1].offset;
                o[l].offset = void 0 !== p ? p : 0;
                var d = u[o[l].wall.subSlopes.length - 1].lowHeight;
                o[l].lowHeight = void 0 !== d ? d : 0;
                var m = u[o[l].wall.subSlopes.length - 1].hiHeight;
                o[l].hiHeight = void 0 !== m ? m : 0;
                var g = u[o[l].wall.subSlopes.length - 1].materials;
                o[l].materials = void 0 !== g ? g : {};
                var f = u[o[l].wall.subSlopes.length - 1].overtures;
                o[l].overtures = void 0 !== f ? f : [];
                for (var y = o[l].overtures.slice(), c = 0; c < y.length; c++)
                    y[c].setParent(o[l])
            }
        }
        this.subSlopes = o;
        for (var l = o.length - 1; l >= 0; l--)
            o[l].computePolygonPoints();
        return e.replaceElements("subslopes", o), this.needsUpdate = !1, o
    }, t.prototype.splitSubSlope = function(t, e) {
        var n = hcsdesign.getSelectedStructure(),
            i = n.getElements("subslopes"),
            o = t.indexClosest(e.points),
            r = new SubSlopeStructure,
            s = function() {
                for (var n = 10 + t.wall.thickness / 2, i = 0; i < e.wall.subSlopes.length; i++)
                    if (!(e.wall.subSlopes[i].side[0].subtract(e.side[0]).lengthSquared() < 1e-4)) {
                        if (e.wall.subSlopes[i].distanceFrom(t) < n)
                            return {
                                ss: e.wall.subSlopes[i],
                                index: t.indexClosest(e.wall.subSlopes[i].points)
                            };
                        Logger.message("Probl®®me : sous-pente adjacente non-trouv®¶e")
                    }
            },
            a = s();
        if (a) {
            var l = a.ss.side[0].dot(t.getVector()) > 0 ? 1 : 0;
            r.points = [a.ss.points[a.index], t.points[l]], t.points[l] = e.points[o], r.neighbors = [e.wall, t.neighbors[l]], t.neighbors[l] = e.wall, r.side[0] = r.side[1] = t.side[0], i.push(r), t.wall.subSlopes.push(r), r.wall = t.wall, t.needsUpdate = !0
        }
    }, t.prototype.draw = function(t, e, n) {
        for (var i = this.getSubSlopes(), o = 0, r = i.length; r > o; o++)
            this.drawOnWall(t, e, n, i[o])
    }, t.prototype.drawOnWall = function(t, e, n, i) {
        t.fillStyle = hcsdesign.engine2D.symbols2D.COLOR_ACTIVE_FILL, t.strokeStyle = hcsdesign.engine2D.symbols2D.COLOR_ACTIVE_STROKE, t.lineWidth = 2, t.beginPath();
        for (var o = [i.polygonPoints[0].clone(), i.polygonPoints[1].clone(), i.polygonPoints[3].clone(), i.polygonPoints[2].clone()], r = new BABYLON.Vector2, s = 0, a = i.polygonPoints.length; a > s; s++)
            r = o[s], r.scaleInPlace(n), r.addInPlace(e), r.x = Math.round(r.x), r.y = Math.round(r.y), 0 == s ? t.moveTo(r.x, r.y) : t.lineTo(r.x, r.y);
        t.fill(), i.offset > 0 && (t.closePath(), t.stroke());
        var l = o[2].lerp(o[3], .5),
            h = Math.atan2(i.side[0].y, i.side[0].x);
        hcsdesign.engine2D.symbols2D.drawGrip(t, l, [!1, !1, !1, !1], 0), hcsdesign.engine2D.symbols2D.drawArrows(t, l, [!1, !0, !1, !1], 12, h, !0)
    }, t.prototype.onContextMenu = function(t, e) {
        var n = [];
        n.push({
            name: "lowHeight",
            label: _("相对低的高度"),
            type: "slider",
            cast: "int",
            unit: "cm",
            value: {
                min: 1,
                max: 500,
                step: 1,
                value: e.lowHeight
            }
        }), n.push({
            name: "hiHeight",
            label: _("相对高的高度"),
            type: "slider",
            cast: "int",
            unit: "cm",
            value: {
                min: 1,
                max: 500,
                step: 1,
                value: e.hiHeight
            }
        }), n.push({
            name: "offset",
            label: _("长度"),
            type: "slider",
            cast: "int",
            unit: "cm",
            value: {
                step: 1,
                min: 0,
                max: 5e3,
                value: Math.round(e.offset)
            }
        }), n.push({
            name: "Length",
            label: _("角度"),
            type: "html",
            html: "<label>" + _("角度") + '</label><span class="field">' + Math.round(180 * Math.atan2(e.hiHeight - e.lowHeight, e.offset) / Math.PI) + "°</span>"
        }), n.push({
            name: "_applyHeightToAll",
            label: _("将高度应用到所有的斜顶"),
            type: "checkbox",
            cast: "bool",
            value: this._applyHeightToAll
        }), hcsdesign.engine2D.displayContextMenu(n, e, this.onContextMenuPropertyChanged.bind(this), this.onContextMenuRemove.bind(this))
    }, t.prototype.onContextMenuPropertyChanged = function(t, e, n) {
        if (!("lowHeight" == e && n > t.hiHeight || "hiHeight" == e && n < t.lowHeight)) {
            t[e] = n;
            var i = hcsdesign.getSelectedStructure(),
                o = i.getElements("walls");
            if (("hiHeight" == e || "lowHeight" == e || "_applyHeightToAll" == e) && t._applyHeightToAll) {
                for (var r = 0; r < o.length; r++)
                    for (var s = 0; s < o[r].subSlopes.length; s++)
                        o[r].subSlopes[s].lowHeight = t.lowHeight, o[r].subSlopes[s].hiHeight = t.hiHeight;
                i.height = t.height
            }
            hcsdesign.engine2D.requestStaticDraw()
        }
    }, t.prototype.onContextMenuRemove = function(t) {
        var e = hcsdesign.getSelectedStructure();
        t.remove(e)
    }, t
}();
SubSlopeOvertureComponent2D = function() {
    var t = function(t) {
        BaseComponent2D.call(this, t, "SubSlopeOvertureComponent2D"), this.priority = 99, this._tmpOverture = null, this._addState = 0, this._targetedAt = null, this._targetedAtSide = null, this._overture1Magnetism = null, this._overture2Magnetism = null
    };
    return t.prototype = new BaseComponent2D, t.prototype.getTargeted = function(t) {
        if (0 != (hcsdesign.engine2D.getMode() & hcsdesign.engine2D.MODE_SUBSLOPE)) {
            var e = this.structure.getCurrentStructure(),
                n = e.getElements("walls");
            if (!(hcsdesign.engine2D.getMode() & hcsdesign.engine2D.MODE_DRAG))
                for (var i = 0, o = n.length; o > i; i++)
                    for (var r = 0, s = n[i].subSlopes.length; s > r; r++)
                        for (var a = 0, l = n[i].subSlopes[r].overtures.length; l > a; a++)
                            for (var h = 0; h < n[i].subSlopes[r].overtures[a].polygon.length; h++) {
                                var c = this.isPointInOvertureSide(t, n[i].subSlopes[r].overtures[a]);
                                if (ov = n[i].subSlopes[r].overtures[a], c !== !1)
                                    return this._targetedAtSide = c, hcsdesign.engine2D.requestDynamicDraw(), n[i].subSlopes[r].overtures[a];
                                if (this._targetedAtSide = null, ov.isTargeted(t))
                                    return ov
                            }
            return !1
        }
    }, t.prototype.initialize = function() {
        /*var t = {
                title: _("天窗"),
                index: 90,
                id: "Velux",
                action: "hcs.engine2d.onAddSubSlopeOverture"
            },
            e = {
                title: _("屋顶窗"),
                index: 91,
                id: "Dormer",
                action: "hcs.engine2d.onAddSubSlopeOverture"
            };
        ujs.notify("hcs.menu.main.add", {
            item: t,
            menuPath: "draw2D.subslopes",
            position: 90
        }), ujs.notify("hcs.menu.main.add", {
            item: e,
            menuPath: "draw2D.subslopes",
            position: 91
        })*/
    }, t.prototype.startListening = function() {
        this.onAddSubSlopeOverture = this.onAddSubSlopeOverture.bind(this), this.onDragEndSubSlope = this.onDragEndSubSlope.bind(this), this.onDoubleClick = this.onDoubleClick.bind(this), document.addEventListener("hcs.engine2d.onAddSubSlopeOverture", this.onAddSubSlopeOverture, !1), document.addEventListener("hcs.subslope.drag-end", this.onDragEndSubSlope, !1), hcsdesign.engine2D.registerEventCb("SubSlopeOvertureComponent2D.static-draw", this.priority, "static-draw", null, null, this.onStaticDraw.bind(this), null), hcsdesign.engine2D.registerEventCb("SubSlopeOvertureComponent2D.hover", this.priority, "hover", null, SubSlopeOvertureStructure, this.onHover.bind(this), null), hcsdesign.engine2D.registerEventCb("SubSlopeOvertureComponent2D.leave", this.priority, "leave", null, SubSlopeOvertureStructure, this.onLeave.bind(this), null), hcsdesign.engine2D.registerEventCb("SubSlopeOvertureComponent2D.drag-start", this.priority, "drag-start", hcsdesign.engine2D.MODE_SUBSLOPE, SubSlopeOvertureStructure, this.onDragStart.bind(this), null), hcsdesign.engine2D.registerEventCb("SubSlopeOvertureComponent2D.context-menu", this.priority, "click", hcsdesign.engine2D.MODE_SUBSLOPE, SubSlopeOvertureStructure, this.onContextMenu.bind(this), null), hcsdesign.engine2D.registerEventCb("SubSlopeOvertureComponent2D.drag.dynamic-draw", this.priority, "dynamic-draw", hcsdesign.engine2D.MODE_DRAG, SubSlopeOvertureStructure, this.onDragDynamicDraw.bind(this), {}), this.core.engine2D.registerEventCb("SubSlopeOvertureComponent2D.double-click", this.priority, "double-click", hcsdesign.engine2D.MODE_SUBSLOPE, SubSlopeOvertureStructure, this.onDoubleClick, null)
    }, t.prototype.stopListening = function() {
        document.removeEventListener("hcs.engine2d.onAddSubSlopeOverture", this.onAddSubSlopeOverture, !1), document.removeEventListener("hcs.subslope.drag-end", this.onDragEndSubSlope, !1), hcsdesign.engine2D.unregisterEventCb("SubSlopeOvertureComponent2D.static-draw"), hcsdesign.engine2D.unregisterEventCb("SubSlopeOvertureComponent2D.hover"), hcsdesign.engine2D.unregisterEventCb("SubSlopeOvertureComponent2D.leave"), this.core.engine2D.unregisterEventCb("SubSlopeOvertureComponent2D.double-click")
    }, t.prototype.onHover = function(t, e) {
        return hcsdesign.engine2D.registerEventCb("SubSlopeOvertureComponent2D.hopper.drag-start", this.priority, "drag-start", hcsdesign.engine2D.MODE_NORMAL, SubSlopeOvertureStructure, this.onDragStart.bind(this), {}), hcsdesign.engine2D.registerEventCb("SubSlopeOvertureComponent2D.dynamic-draw", this.priority, "dynamic-draw", hcsdesign.engine2D.MODE_SUBSLOPE, null, this.onSelectionDynamicDraw.bind(this), e), hcsdesign.engine2D.registerEventCb("SubSlopeOvertureComponent2D.hopper-hover.dynamic-draw", this.priority, "dynamic-draw", null, SubSlopeOvertureStructure, this.onHoverSubSlopeOverture.bind(this), e), hcsdesign.engine2D.requestDynamicDraw(), !1
    }, t.prototype.onHoverSubSlopeOverture = function(t, e, n, i) {
        this.drawTarget(i, t, n)
    }, t.prototype.onDragEndSubSlope = function() {
        for (var t = this.structure.getCurrentStructure(), e = t.getElements("subslopes"), n = 0; n < e.length; n++) {
            var i = [];
            i[0] = e[n].polygonPoints[0], i[1] = e[n].polygonPoints[1], i[2] = e[n].polygonPoints[3], i[3] = e[n].polygonPoints[2];
            for (var o = 0; o < e[n].overtures.length; o++)
                for (var r = 0; 4 > r; r++)
                    if (!e[n].overtures[o].polygon[r].isPointInPolygon(i)) {
                        e[n].overtures[o].remove(), hcsdesign.engine2D.requestStaticDraw();
                        break
                    }
        }
    }, t.prototype.onLeave = function() {
        hcsdesign.engine2D.unregisterEventCb("SubSlopeOvertureComponent2D.dynamic-draw"), hcsdesign.engine2D.requestDynamicDraw()
    }, t.prototype.onDragDynamicDraw = function(t, e, n) {
        if (hcsdesign.engine2D.getMode() & hcsdesign.engine2D.MODE_SUBSLOPE)
            for (var i = this.structure.getCurrentStructure(), o = i.getElements("subslopes"), r = 0; r < o.length; r++) {
                var s = new Array,
                    a = o[r].wall,
                    l = a.getWallVector().normalize(),
                    h = new BABYLON.Vector2(l.y, -l.x),
                    c = o[r].overtures.length;
                this.reorganizeSubslopes(o[r].overtures, o[r], l);
                for (var u = 0; c - 1 > u; u++)
                    s[u] = this.calculateDistance(o[r].overtures[u], o[r].overtures[u + 1], l, 1), this.drawCotes(o[r].overtures[u], o[r].overtures[u + 1], t, e, n, s[u]);
                for (var p = 0; c > p; p++)
                    if (o[r].overtures[p]) {
                        var d = this.getIntersectPoint(o[r].overtures[p], o[r], h, 2);
                        this.drawCotesSS(o[r].overtures[p], o[r], t, e, n, d, h)
                    }
                if (o[r].overtures[0]) {
                    var m = [],
                        g = this.getIntersectPoint(o[r].overtures[0], o[r], l, 0),
                        f = this.getIntersectPoint(o[r].overtures[c - 1], o[r], l, 1),
                        y = this.getIntersectPoint(o[r].overtures[0], o[r], l, 1),
                        _ = this.getIntersectPoint(o[r].overtures[c - 1], o[r], l, 0),
                        v = new BABYLON.Vector2(o[r].overtures[0].getAbsolutePosition().position.x - o[r].polygonPoints[0].x, o[r].overtures[0].getAbsolutePosition().position.y - o[r].polygonPoints[0].y);
                    v.projectOnVector(l);
                    var b = new BABYLON.Vector2(o[r].polygonPoints[0].x + v.x, o[r].polygonPoints[0].y + v.y);
                    m[1] = Math.sqrt((b.x - o[r].polygonPoints[0].x) * (b.x - o[r].polygonPoints[0].x) + (b.y - o[r].polygonPoints[0].y) * (b.y - o[r].polygonPoints[0].y));
                    var w = new BABYLON.Vector2(o[r].overtures[c - 1].getAbsolutePosition().position.x - o[r].polygonPoints[0].x, o[r].overtures[c - 1].getAbsolutePosition().position.y - o[r].polygonPoints[0].y);
                    w.projectOnVector(l);
                    var x = new BABYLON.Vector2(o[r].polygonPoints[0].x + w.x, o[r].polygonPoints[0].y + w.y);
                    m[2] = Math.sqrt((x.x - o[r].polygonPoints[0].x) * (x.x - o[r].polygonPoints[0].x) + (x.y - o[r].polygonPoints[0].y) * (x.y - o[r].polygonPoints[0].y));
                    var C = new BABYLON.Vector2(o[r].overtures[0].getAbsolutePosition().position.x - o[r].polygonPoints[1].x, o[r].overtures[0].getAbsolutePosition().position.y - o[r].polygonPoints[1].y);
                    C.projectOnVector(l);
                    var M = new BABYLON.Vector2(o[r].polygonPoints[1].x + C.x, o[r].polygonPoints[1].y + C.y);
                    m[3] = Math.sqrt((M.x - o[r].polygonPoints[1].x) * (M.x - o[r].polygonPoints[1].x) + (M.y - o[r].polygonPoints[1].y) * (M.y - o[r].polygonPoints[1].y));
                    var D = new BABYLON.Vector2(o[r].overtures[c - 1].getAbsolutePosition().position.x - o[r].polygonPoints[1].x, o[r].overtures[c - 1].getAbsolutePosition().position.y - o[r].polygonPoints[1].y);
                    D.projectOnVector(l);
                    var B = new BABYLON.Vector2(o[r].polygonPoints[1].x + D.x, o[r].polygonPoints[1].y + D.y);
                    m[4] = Math.sqrt((B.x - o[r].polygonPoints[1].x) * (B.x - o[r].polygonPoints[1].x) + (B.y - o[r].polygonPoints[1].y) * (B.y - o[r].polygonPoints[1].y));
                    for (var A = 1 / 0, E = 1; 4 >= E; E++)
                        m[E] < A && (A = m[E]);
                    Math.abs(A - m[1]) < .1 || Math.abs(A - m[4]) < .1 ? (this.drawCotesSS(o[r].overtures[0], o[r], t, e, n, g, l), this.drawCotesSS(o[r].overtures[c - 1], o[r], t, e, n, f, l)) : (this.drawCotesSS(o[r].overtures[0], o[r], t, e, n, y, l), this.drawCotesSS(o[r].overtures[c - 1], o[r], t, e, n, _, l))
                }
            }
    }, t.prototype.calculateDistance = function(t, e, n, i) {
        var o, r = new BABYLON.Vector2(e.position.x - t.position.x, e.position.y - t.position.y);
        return r.projectOnVector(n), o = Math.sqrt(r.x * r.x + r.y * r.y), o -= 0 === i ? t.height / 2 + t.height / 2 : t.width / 2 + t.width / 2
    }, t.prototype.getIntersectPoint = function(t, e, n, i) {
        var o = new BABYLON.Vector2;
        if (2 != i)
            var r = e.polygonPoints[0 + i].x,
                s = e.polygonPoints[0 + i].y,
                a = e.polygonPoints[2 + i].x,
                l = e.polygonPoints[2 + i].y;
        else
            var r = e.polygonPoints[0].x,
                s = e.polygonPoints[0].y,
                a = e.polygonPoints[1].x,
                l = e.polygonPoints[1].y;
        var h = t.getAbsolutePosition().position.x,
            c = t.getAbsolutePosition().position.y,
            u = t.getAbsolutePosition().position.x + n.x,
            p = t.getAbsolutePosition().position.y + n.y;
        if (Math.abs(a - r) > .1 && Math.abs(u - h) > .1) {
            var d = (l - s) / (a - r),
                m = (s * (a - r) - r * (l - s)) / (a - r),
                g = (p - c) / (u - h),
                f = (c * (u - h) - h * (p - c)) / (u - h);
            o.x = (f - m) / (d - g), d * ((f - m) / (d - g)) + m, o.y = d * ((f - m) / (d - g)) + m
        } else if (Math.abs(a - r) < .1)
            o.x = r, o.y = c;
        else {
            o.x = h;
            var d = (l - s) / (a - r),
                m = (s * (a - r) - r * (l - s)) / (a - r);
            o.y = d * h + m
        }
        return o
    }, t.prototype.onSelectionDynamicDraw = function(t, e, n, i) {
        var o = i.parent.wall,
            r = o.points[0].position.clone().lerp(o.points[1].position, .5).add(i.position),
            s = {
                x: r.x * n + e.x,
                y: r.y * n + e.y
            };
        hcsdesign.engine2D.symbols2D.drawGrip(t, s, [!0, !0, !0, !0], 0)
    }, t.prototype.changeAddStateVelux = function() {
        this._addState = 1, hcsdesign.engine2D.registerEventCb("component.add-hopper.click", this.priority, "click", hcsdesign.engine2D.MODE_SUBSLOPE, null, this.onAddVeluxClick.bind(this), {}), hcsdesign.engine2D.registerEventCb("component.dynamic-component.mouse-move", this.priority, "mouse-move", hcsdesign.engine2D.MODE_SUBSLOPE, null, this.onMouseMove.bind(this), {}), hcsdesign.engine2D.registerEventCb("component.dynamic-component.dynamic-draw", this.priority, "dynamic-draw", hcsdesign.engine2D.MODE_SUBSLOPE, null, this.onDynamicDraw.bind(this), {}), hcsdesign.engine2D.requestStaticDraw()
    }, t.prototype.changeAddStateSubSlopeOverture = function() {
        this._addState = 1, hcsdesign.engine2D.registerEventCb("component.add-hopper.click", this.priority, "click", hcsdesign.engine2D.MODE_SUBSLOPE, null, this.onAddSubSlopeOvertureClick.bind(this), {}), hcsdesign.engine2D.registerEventCb("component.dynamic-component.mouse-move", this.priority, "mouse-move", hcsdesign.engine2D.MODE_SUBSLOPE, null, this.onMouseMove.bind(this), {}), hcsdesign.engine2D.registerEventCb("component.dynamic-component.dynamic-draw", this.priority, "dynamic-draw", hcsdesign.engine2D.MODE_SUBSLOPE, null, this.onDynamicDraw.bind(this), {}), hcsdesign.engine2D.requestStaticDraw()
    }, t.prototype.onAddVelux = function() {
        this._tmpOverture = new SubSlopeOvertureStructure, this._tmpOverture.type = "Velux", this.changeAddStateVelux()
    }, t.prototype.onAddSubSlopeOverture = function(t) {
        this._tmpOverture = new SubSlopeOvertureStructure, this._tmpOverture.type = t.id, t.width && (this._tmpOverture.width = t.width), t.height && (this._tmpOverture.height = t.height), this.changeAddStateSubSlopeOverture()
    }, t.prototype.onAddSubSlopeOvertureClick = function() {
        hcsdesign.helpBubbleManager.display("hcs.2d.subslopeOverture-menu"), 1 == this._addState && (this._tmpOverture.parent.overtures.push(this._tmpOverture), hcsdesign.engine2D.requestStaticDraw(), ujs.notify("hcs.menu.main.deselect"), this._addState = 0, this._tmpOverture = null, hcsdesign.engine2D.requestDynamicDraw())
    }, t.prototype.onMouseMove = function(t, e, n) {
        if (this._tmpOverture) {
            this._tmpOverture._tmpPos = n.planPos;
            for (var i = hcsdesign.getSelectedStructure(), o = i.getElements("walls"), r = 0; r < o.length; r++)
                for (var s = 0; s < o[r].subSlopes.length; s++)
                    if (o[r].subSlopes[s].isPointIn(n.planPos)) {
                        this._tmpOverture.parent = o[r].subSlopes[s];
                        var a = o[r].subSlopes[s].wall,
                            l = a.getWallVector().normalize(),
                            h = new BABYLON.Vector2(l.y, -l.x);
                        return this._tmpOverture.position.copyFrom(this._tmpOverture._tmpPos).subtractInPlace(a.points[0].position.clone().lerp(a.points[1].position, .5)), this.appliedMagnetism(this._tmpOverture, o[r].subSlopes[s], h, l), void hcsdesign.engine2D.requestStaticDraw()
                    }
        }
    }, t.prototype.onContextMenu = function(t, e) {
        var n, i = [],
            o = Math.atan((e.parent.hiHeight - e.parent.lowHeight) / e.parent.offset);
        n = "Dormer" == e.type ? 2 * e.wallThickness : 0, "Dormer" != e.type && i.push({
            name: "height",
            label: _("高度"),
            type: "slider",
            cast: "int",
            unit: "cm",
            value: {
                min: 20,
                max: 500,
                step: 1,
                value: e.height
            }
        }), i.push({
            name: "width",
            label: _("宽度"),
            type: "slider",
            cast: "int",
            unit: "cm",
            value: {
                min: 20,
                max: 500,
                step: 1,
                value: Math.round(e.width) + n
            }
        }), "Dormer" == e.type && (i.push({
            name: "dormerRoofHeight",
            label: _("屋顶高度"),
            type: "slider",
            cast: "int",
            value: {
                min: 0,
                max: e.width,
                step: 1,
                value: Math.round(e.dormerRoof.height > -1 ? e.dormerRoof.height : e.width / 2)
            }
        }), i.push({
            name: "nbCasement",
            label: _("窗的个数"),
            type: "slider",
            cast: "int",
            value: {
                min: 1,
                max: 6,
                step: 1,
                value: e.nbCasement
            }
        }), i.push({
            name: "height",
            label: _("高度"),
            type: "slider",
            cast: "int",
            unit: "cm",
            value: {
                min: 20,
                max: 500,
                step: 1,
                value: Math.round(e.height * Math.sin(o))
            }
        }), i.push({
            name: "depth",
            label: _("深度"),
            type: "html",
            html: "<label>" + _("深度") + '</label><span class="field">' + Math.round(e.height * Math.cos(o)) + " cm</span>"
        })), hcsdesign.engine2D.displayContextMenu(i, e, this.onContextMenuPropertyChanged.bind(this), this.onContextMenuRemove.bind(this))
    }, t.prototype.onContextMenuPropertyChanged = function(t, e, n) {
        var i = Math.atan((t.parent.hiHeight - t.parent.lowHeight) / t.parent.offset);
        if (-1 != e.indexOf("sticks_")) {
            var o = e.split("_");
            t.sticks[o[1]] = n
        } else if ("cut" == e) {
            var r = t.points[this._targetedAtSide],
                s = t.points[this._targetedAtSide + 1],
                a = r.clone().lerp(s, .5);
            t.insertPointAt(this._targetedAtSide + 1, a)
        } else if ("enable_sticks" == e)
            for (var l = 0; l < t.points.length; l++)
                t.sticks[l] = !0;
        else if ("disable_sticks" == e)
            for (var l = 0; l < t.points.length; l++)
                t.sticks[l] = !1;
        else
            "dormerRoofHeight" == e ? t.dormerRoof.height = n : t[e] = "height" == e ? n / Math.sin(i) : "width" == e && "Dormer" == t.type ? n - 2 * t.wallThickness : n;
        hcsdesign.engine2D.requestStaticDraw()
    }, t.prototype.onContextMenuRemove = function(t) {
        var e = hcsdesign.getSelectedStructure();
        t.remove(e), hcsdesign.engine2D.requestDynamicDraw()
    }, t.prototype.onStaticDraw = function(t, e, n) {
        if (0 != (hcsdesign.engine2D.getMode() & hcsdesign.engine2D.MODE_SUBSLOPE))
            for (var i = hcsdesign.getSelectedStructure(), o = i.getElements("walls"), r = 0; r < o.length; r++)
                for (var s = 0; s < o[r].subSlopes.length; s++)
                    for (var a = 0; a < o[r].subSlopes[s].overtures.length; a++)
                        this.draw(o[r].subSlopes[s].overtures[a], t, e, n)
    }, t.prototype.onDynamicDraw = function(t, e, n) {
        1 == this._addState && (hcsdesign.engine2D.setCursorIcon(hcsdesign.engine2D.symbols2D.drawCursorCheck.bind(hcsdesign.engine2D.symbols2D)), this.draw(this._tmpOverture, t, e, n, !1)), this.drawMagnetism(this._overture1Magnetism, this._overture2Magnetism, t, e, n)
    }, t.prototype.onDragStart = function(t, e) {
        return hcsdesign.engine2D.registerEventCb("SubSlopeOvertureComponent2D.drag-end", this.priority, "drag-end", hcsdesign.engine2D.MODE_DRAG, null, this.onDragEnd.bind(this), e), hcsdesign.engine2D.registerEventCb("SubSlopeOvertureComponent2D.dynamic-draw", this.priority, "dynamic-draw", hcsdesign.engine2D.MODE_DRAG, null, this.onSelectionDynamicDraw.bind(this), e), hcsdesign.engine2D.registerEventCb("component.dynamic-component.dynamic-draw", this.priority, "dynamic-draw", hcsdesign.engine2D.MODE_SUBSLOPE, null, this.onDynamicDraw.bind(this), {}), hcsdesign.engine2D.registerEventCb("SubSlopeOvertureComponent2D.dragging", this.priority, "dragging", hcsdesign.engine2D.MODE_DRAG, null, this.onDraggingMove.bind(this), e), !1
    }, t.prototype.onDraggingMove = function(t, e, n, i) {
        for (var o = i.parent.wall, r = o.getWallVector().normalize(), s = new BABYLON.Vector2(r.y, -r.x), a = this.structure.getCurrentStructure(), l = a.getElements("subslopes"), h = 0; h < l.length; h++)
            l[h].isPointIn(n.planPos) && (i.wall = l[h].wall);
        var o = i.wall,
            c = (o.getWallVector().normalize(), o.points[0].position.clone().lerp(o.points[1].position, .5), n.posDelta.scale(1 / hcsdesign.engine2D.getZoom())),
            u = new BABYLON.Vector2(c.x, c.y),
            p = new BABYLON.Vector2(c.x, c.y);
        if (u.projectOnVector(r), p.projectOnVector(s), null === this._targetedAtSide) {
            var d = n.planPos.subtract(i.parent.wall.points[0].position.clone().lerp(i.parent.wall.points[1].position, .5)),
                m = (new BABYLON.Vector2((c.x * r.x + c.x * s.x) / (r.x * r.x + r.y * r.y), (c.x * r.y - c.x * s.y) / (r.x * r.x + r.y * r.y)), []);
            m[0] = n.planPos.add(r.scale(i.width / 2)).add(s.scale(i.height / 2)), m[1] = n.planPos.subtract(r.scale(i.width / 2)).add(s.scale(i.height / 2)), m[2] = n.planPos.add(r.scale(i.width / 2)).subtract(s.scale(i.height / 2)), m[3] = n.planPos.subtract(r.scale(i.width / 2)).subtract(s.scale(i.height / 2)), i.parent.computePolygonPoints(), this.isInSubSlope(i.parent.polygonPoints, m, i.width, i.height) && (i.position = d, this.appliedMagnetism(i, i.parent, s, r))
        } else {
            var g = Math.atan((i.parent.hiHeight - i.parent.lowHeight) / i.parent.offset),
                f = Math.cos(g),
                y = new BABYLON.Vector2(i.parent.polygonPoints[2].x - i.parent.polygonPoints[0].x, i.parent.polygonPoints[2].y - i.parent.polygonPoints[0].y);
            y.projectOnVector(s);
            var _ = y.x * s.x + y.y * s.y;
            0 > _ && (r.x = -r.x, r.y = -r.y, s.x = -s.x, s.y = -s.y);
            var v = i.polygon[this._targetedAtSide],
                b = this._targetedAtSide + 1 < i.polygon.length ? this._targetedAtSide + 1 : 0,
                w = i.polygon[b],
                m = (new BABYLON.Vector2(v.y - w.y, w.x - v.x), []);
            if (m[0] = i.polygon[0], m[1] = i.polygon[1], m[2] = i.polygon[2], m[3] = i.polygon[3], this._targetedAtSide % 2 === 0) {
                i.position.addInPlace(u.scale(.5));
                var x = r.dot(u) > 0 ? 1 : -1,
                    C = 0 === this._targetedAtSide ? 1 : -1;
                i.width += C * x * u.length(), this.appliedMagnetism(i, i.parent, s, r)
            } else {
                i.position.addInPlace(p.scale(.5));
                var x = s.dot(p) > 0 ? 1 : -1,
                    C = 1 === this._targetedAtSide ? -1 : 1;
                i.height += 1 / f * C * x * p.length()
            }
        }
        return i.modified = !0, hcsdesign.engine2D.requestStaticDraw(), !1
    }, t.prototype.onDoubleClick = function(t, e) {
        return this.core.helpBubbleManager.display("hcs.2d.dup-overture"), this.onAddSubSlopeOverture({
            id: e.type,
            width: e.width,
            height: e.height
        }), !0
    }, t.prototype.isInSubSlope = function(t, e) {
        var n = [];
        return n[0] = t[0], n[1] = t[1], n[2] = t[3], n[3] = t[2], e[0].isPointInPolygon(n) && e[1].isPointInPolygon(n) && e[2].isPointInPolygon(n) && e[3].isPointInPolygon(n) ? !0 : !1
    }, t.prototype.appliedMagnetism = function(t, e, n) {
        var i = [];
        i.push(t);
        for (var o, r = 0; r < e.overtures.length; r++)
            if (e.overtures[r].id != t.id && (o = n.x * (e.overtures[r].position.x - t.position.x) + n.y * (e.overtures[r].position.y - t.position.y), Math.abs(o) < 6)) {
                i.push(e.overtures[r]);
                var s = new BABYLON.Vector2;
                s.x = e.overtures[r].position.x - t.position.x, s.y = e.overtures[r].position.y - t.position.y, s.projectOnVector(n), t.position.addInPlace(s.scale(1)), this._overture1Magnetism = t, this._overture2Magnetism = e.overtures[r]
            }
    }, t.prototype.appliedSideMagnetism = function(t, e, n, i, o) {
        if (3 == o)
            for (var r = 0; r < e.overtures.length; r++) {
                var s = n.length(),
                    a = t.height / (2 * s),
                    l = e.overtures[r].height / (2 * s),
                    h = new BABYLON.Vector2(t.position.x + n.x * a, t.position.y + n.y * a),
                    c = new BABYLON.Vector2(e.overtures[r].position.x + n.x * l, e.overtures[r].position.y + n.y * l),
                    u = new BABYLON.Vector2(h.x - c.x, h.y - c.y);
                if (e.overtures[r].id != t.id && Math.abs(u.x * n.x + u.y * n.y) < 7) {
                    u.projectOnVector(n);
                    var p = n.dot(u) > 0 ? -1 : 1;
                    t.height += p * u.length(), t.position.x -= .5 * u.x, t.position.y -= .5 * u.y
                }
            } else
                for (var r = 0; r < e.overtures.length; r++) {
                    var s = n.length(),
                        a = -t.height / (2 * s),
                        l = -e.overtures[r].height / (2 * s),
                        h = new BABYLON.Vector2(t.position.x + n.x * a, t.position.y + n.y * a),
                        c = new BABYLON.Vector2(e.overtures[r].position.x + n.x * l, e.overtures[r].position.y + n.y * l),
                        u = new BABYLON.Vector2(h.x - c.x, h.y - c.y);
                    if (e.overtures[r].id != t.id && Math.abs(u.x * n.x + u.y * n.y) < 7) {
                        u.projectOnVector(n);
                        var p = n.dot(u) > 0 ? 1 : -1;
                        t.height += p * u.length(), t.position.x -= .5 * u.x, t.position.y -= .5 * u.y
                    }
                }
    }, t.prototype.reorganizeSubslopes = function(t, e, n) {
        for (var i = n, o = (new BABYLON.Vector2(i.y, -i.x), []), r = (i.x * (e.polygonPoints[0].x - e.polygonPoints[1].x) + i.y * (e.polygonPoints[0].y - e.polygonPoints[1].y), 0); r < t.length; r++) {
            var s = new BABYLON.Vector2(t[r].position.x - e.polygonPoints[0].x, t[r].position.y - e.polygonPoints[0].y);
            s.projectOnVector(i);
            var a = new BABYLON.Vector2(e.polygonPoints[0].x + s.x, e.polygonPoints[0].y + s.y),
                l = Math.sqrt((a.x - e.polygonPoints[0].x) * (a.x - e.polygonPoints[0].x) + (a.y - e.polygonPoints[0].y) * (a.y - e.polygonPoints[0].y));
            o.push(l)
        }
        for (var h = 1; h < o.length; h++) {
            for (var c = o[h], u = t[h], p = h; p > 0 && o[p - 1] > c;)
                o[p] = o[p - 1], t[p] = t[p - 1], p--;
            o[p] = c, t[p] = u
        }
    }, t.prototype.onDragEnd = function(t, e, n, i) {
        hcsdesign.engine2D.unregisterEventCb("SubSlopeOvertureComponent2D.dynamic-draw"), hcsdesign.engine2D.requestStaticDraw(), this.checkCoherence(i), this._overture1Magnetism = null, this._overture2Magnetism = null
    }, t.prototype.checkCoherence = function(t) {
        t.width < 0 && (t.width = -t.width), t.height < 0 && (t.height = -t.height)
    }, t.prototype.isPointInOvertureSide = function(t, e) {
        for (var n = 0; n < e.polygon.length; n++) {
            var i = e.polygon[n].clone(),
                o = n + 1 < e.polygon.length ? e.polygon[n + 1] : e.polygon[0],
                r = Math.abs(i.distanceTo(t) + o.distanceTo(t) - i.distanceTo(o));
            if (1 > r)
                return n
        }
        return !1
    }, t.prototype.drawTarget = function(t, e, n) {
        if (null !== this._targetedAt) {
            var i = hcsdesign.engine2D.toRealCoord(t.polygon[this._targetedAt]);
            hcsdesign.engine2D.symbols2D.drawPointHover(e, i, n)
        } else if (null !== this._targetedAtSide) {
            var o = hcsdesign.engine2D.toRealCoord(t.polygon[this._targetedAtSide]),
                r = hcsdesign.engine2D.toRealCoord(this._targetedAtSide + 1 < t.polygon.length ? t.polygon[this._targetedAtSide + 1] : t.polygon[0]);
            hcsdesign.engine2D.symbols2D.drawSegment(e, o, r)
        }
    }, t.prototype.draw = function(t, e, n, i, o) {
        if (e.save(), e.beginPath(), o ? (e.fillStyle = hcsdesign.engine2D.symbols2D.COLOR_ACTIVE_FILL, e.strokeStyle = hcsdesign.engine2D.symbols2D.COLOR_ACTIVE_STROKE_DARKER) : (e.fillStyle = hcsdesign.engine2D.symbols2D.COLOR_INACTIVE_FILL, e.strokeStyle = hcsdesign.engine2D.symbols2D.COLOR_INACTIVE_STROKE), null !== t.position && null !== t.parent) {
            var r = t.parent.wall,
                s = r.getWallVector().normalize(),
                a = new BABYLON.Vector2(s.y, -s.x),
                l = new BABYLON.Vector2(r.subSlopes[0].polygonPoints[2].x - r.subSlopes[0].polygonPoints[0].x, r.subSlopes[0].polygonPoints[2].y - r.subSlopes[0].polygonPoints[0].y);
            l.projectOnVector(a);
            var h = l.x * a.x + l.y * a.y;
            0 > h && (s.x = -s.x, s.y = -s.y, a.x = -a.x, a.y = -a.y);
            var c = r.points[0].position.clone().lerp(r.points[1].position, .5).add(t.position),
                u = 40 * t.parent.offset / (t.parent.hiHeight - t.parent.lowHeight);
            t.offset = t.position.dot(a), t.wallOrtho = a, t.center = c;
            var p = Math.atan((t.parent.hiHeight - t.parent.lowHeight) / t.parent.offset),
                d = Math.cos(p);
            "Dormer" == t.type ? (t.polygon[0] = c.add(s.scale(t.width / 2)).add(a.scale(t.height / (2 / d))).add(s.scale(t.wallThickness)), t.polygon[1] = c.add(s.scale(t.width / 2)).subtract(a.scale(t.height / (2 / d))).subtract(a.scale(t.wallThickness)).add(s.scale(t.wallThickness)), t.polygon[2] = c.subtract(s.scale(t.width / 2)).subtract(a.scale(t.height / (2 / d))).subtract(a.scale(t.wallThickness)).subtract(s.scale(t.wallThickness)), t.polygon[3] = c.subtract(s.scale(t.width / 2)).add(a.scale(t.height / (2 / d))).subtract(s.scale(t.wallThickness))) : (t.polygon[0] = c.add(s.scale(t.width / 2)).add(a.scale(t.height / (2 / d))), t.polygon[1] = c.add(s.scale(t.width / 2)).subtract(a.scale(t.height / (2 / d))), t.polygon[2] = c.subtract(s.scale(t.width / 2)).subtract(a.scale(t.height / (2 / d))), t.polygon[3] = c.subtract(s.scale(t.width / 2)).add(a.scale(t.height / (2 / d))));
            var m = c.add(a.scale(t.height / (2 / d) + u)),
                g = c.subtract(a.scale(t.height / (2 / d))),
                f = hcsdesign.engine2D.toRealCoord(t.polygon[0], n, i),
                y = hcsdesign.engine2D.toRealCoord(t.polygon[1], n, i),
                _ = hcsdesign.engine2D.toRealCoord(t.polygon[2], n, i),
                v = hcsdesign.engine2D.toRealCoord(t.polygon[3], n, i),
                b = hcsdesign.engine2D.toRealCoord(m, n, i),
                w = hcsdesign.engine2D.toRealCoord(g, n, i);
            "Velux" == t.type ? (e.moveTo(Math.round(f.x) + .5, Math.round(f.y) + .5), e.lineTo(Math.round(y.x) + .5, Math.round(y.y) + .5), e.lineTo(Math.round(_.x) + .5, Math.round(_.y) + .5), e.lineTo(Math.round(v.x) + .5, Math.round(v.y) + .5)) : (e.moveTo(Math.round(b.x) + .5, Math.round(b.y) + .5), e.lineTo(Math.round(v.x) + .5, Math.round(v.y) + .5), e.lineTo(Math.round(_.x) + .5, Math.round(_.y) + .5), e.lineTo(Math.round(y.x) + .5, Math.round(y.y) + .5), e.lineTo(Math.round(f.x) + .5, Math.round(f.y) + .5), e.lineTo(Math.round(b.x) + .5, Math.round(b.y) + .5), e.lineTo(Math.round(w.x) + .5, Math.round(w.y) + .5)), e.closePath(), e.fill(), e.stroke(), e.restore()
        }
    }, t.prototype.drawMagnetism = function(t, e, n, i, o) {
        if (n.save(), n.beginPath(), n.fillStyle = hcsdesign.engine2D.symbols2D.COLOR_ACTIVE_FILL, n.strokeStyle = hcsdesign.engine2D.symbols2D.COLOR_ACTIVE_STROKE, null !== t) {
            var r = t.getAbsolutePosition().position,
                s = e.getAbsolutePosition().position,
                a = hcsdesign.engine2D.toRealCoord(r, i, o),
                l = hcsdesign.engine2D.toRealCoord(s, i, o),
                h = t.parent.wall,
                c = h.getWallVector().normalize(),
                u = Math.abs(c.x * (r.y - s.y)),
                p = Math.abs(c.y * (r.x - s.x));
            Math.abs(u - p) < .01 && (n.moveTo(a.x, a.y), n.lineTo(l.x, l.y))
        }
        n.closePath(), n.fill(), n.stroke(), n.restore()
    }, t.prototype.drawCotes = function(t, e, n, i, o, r) {
        n.fillStyle = hcsdesign.engine2D.symbols2D.COLOR_INACTIVE_FILL, n.strokeStyle = hcsdesign.engine2D.symbols2D.COLOR_INACTIVE_STROKE;
        var s = t.parent.wall,
            a = s.getWallVector().normalize(),
            l = new BABYLON.Vector2(a.y, -a.x),
            h = t.getAbsolutePosition().position,
            c = e.getAbsolutePosition().position,
            u = h.add(c).scaleInPlace(.5),
            p = a,
            d = l,
            m = h.dot(p),
            g = c.dot(p);
        if (m > g) {
            var f = g;
            g = m, m = f, m += e.width / 2 + ("Dormer" == e.type ? e.wallThickness : 0), g -= t.width / 2 + ("Dormer" == t.type ? t.wallThickness : 0)
        } else
            m += t.width / 2 + ("Dormer" == t.type ? t.wallThickness : 0), g -= e.width / 2 + ("Dormer" == e.type ? e.wallThickness : 0);
        var y = u.dot(d),
            _ = new BABYLON.Vector2(p.x * m + d.x * y, p.y * m + d.y * y),
            v = new BABYLON.Vector2(p.x * g + d.x * y, p.y * g + d.y * y),
            b = hcsdesign.engine2D.toRealCoord(_, i, o),
            w = hcsdesign.engine2D.toRealCoord(v, i, o),
            x = Math.round(r) / 100;
        hcsdesign.engine2D.symbols2D.drawMeasure(n, b, w, x + "m"), n.closePath(), n.fill(), n.stroke(), n.restore()
    }, t.prototype.drawCotesSS = function(t, e, n, i, o, r, s) {
        n.fillStyle = hcsdesign.engine2D.symbols2D.COLOR_INACTIVE_FILL, n.strokeStyle = hcsdesign.engine2D.symbols2D.COLOR_INACTIVE_STROKE;
        var a = t.parent.wall,
            l = a.getWallVector().normalize(),
            h = new BABYLON.Vector2(l.y, -l.x),
            c = t.getAbsolutePosition().position,
            u = r,
            p = Math.atan((e.hiHeight - e.lowHeight) / e.offset),
            d = Math.cos(p),
            m = new BABYLON.Vector2(c.x - u.x, c.y - u.y);
        if (Math.abs(s.x * h.x + s.y * h.y) < .1)
            if ("Dormer" == t.type) {
                c = c.subtract(m.normalize().scale(t.width / 2 + t.wallThickness));
                var g = 0
            } else {
                c = c.subtract(m.normalize().scale(t.width / 2));
                var g = 0
            } else if ("Dormer" == t.type) {
            c = c.subtract(m.normalize().scale(d * t.height / 2)).subtract(h.scale(t.wallThickness));
            var g = Math.atan((e.hiHeight - e.lowHeight) / e.offset)
        } else {
            c = c.subtract(m.normalize().scale(d * t.height / 2));
            var g = Math.atan((e.hiHeight - e.lowHeight) / e.offset)
        }
        var f = Math.sqrt((r.x - c.x) * (r.x - c.x) + (r.y - c.y) * (r.y - c.y)) / Math.cos(g);
        f = Math.round(f) / 100;
        var y = hcsdesign.engine2D.toRealCoord(c, i, o),
            _ = hcsdesign.engine2D.toRealCoord(u, i, o);
        hcsdesign.engine2D.symbols2D.drawMeasure(n, y, _, f + "m"), n.closePath(), n.fill(), n.stroke(), n.restore()
    }, t
}();
SubSlopeComponent3D = function() {
    var t, e = function(e) {
        BaseComponent3D.call(this, e, "SubSlopeComponent3D"), this.currentID = 0, t = this
    };
    return e.prototype = new BaseComponent3D, e.prototype.startListening = function() {
        document.addEventListener("hcs.engine3d.wallsReady", this.onWallsReady, !1)
    }, e.prototype.stopListening = function() {
        document.removeEventListener("hcs.engine3d.wallsReady", this.onWallsReady, !1)
    }, e.prototype.onWallsReady = function(e) {
        var n = e.floor || t.getFloor(),
            i = e.structure || t.core.getSelectedStructure();
        t.core.getComponentByName("SubSlopeComponent2D").getSubSlopes(!0), t.drawSSForStructure(i, n, hcsdesign.engine3D.scene)
    }, e.prototype.buildCSG = function(t, e, n, i) {
        var o, r, s = s || !1;
        n = n || this.core.getComponentByName("FloorComponent3D").getFloor(e);
        var a = t[0].subtract(t[1]),
            l = t[3].subtract(t[2]),
            h = [],
            c = [],
            u = [],
            p = [];
        if (a.dot(l) > 0) {
            for (r = 0; r < t.length; r++)
                h.push(t[r].x, t[r].y, t[r].z);
            h.push(t[0].x, t[2].y, t[0].z), h.push(t[1].x, t[3].y, t[1].z), c.push(0, 2, 3), c.push(2, 0, 1), c.push(5, 3, 2), c.push(3, 5, 4), c.push(4, 1, 0), c.push(1, 4, 5), c.push(5, 2, 1), c.push(3, 4, 0)
        } else {
            var d = t[0].subtract(t[3]),
                m = t[3].subtract(t[2]).length(),
                g = t[1].subtract(t[0]).length(),
                f = m / g + 1,
                y = d.scale(1 / f).subtract(t[0]).scale(-1),
                _ = [t[0], t[1], y];
            for (r = 0; r < _.length; r++)
                h.push(_[r].x, _[r].y, _[r].z);
            h.push(_[2].x, t[2].y, _[2].z), h.push(t[0].x, t[2].y, t[0].z), h.push(t[1].x, t[2].y, t[1].z), c.push(0, 1, 2), c.push(2, 3, 0), c.push(3, 4, 0), c.push(1, 5, 2), c.push(3, 2, 5), c.push(4, 3, 5), c.push(1, 0, 4), c.push(1, 4, 5)
        }
        u = BABYLON.Tools.PlaneUVProjection(h, new BABYLON.Vector3(1, 0, 0), new BABYLON.Vector3(0, 0, 1)), BABYLON.Mesh.ComputeFlatNormal(h, p, c);
        var v = new BABYLON.Mesh("carveMesh", i);
        return v.setVerticesData(BABYLON.VertexBuffer.PositionKind, h, s), v.setVerticesData(BABYLON.VertexBuffer.NormalKind, p, s), v.setVerticesData(BABYLON.VertexBuffer.UVKind, u, s), v.setIndices(c), v.parent = n, o = BABYLON.CSG.FromMesh(v), v.dispose(), o
    }, e.prototype.addSubSlope = function(t, e, n, i, o, r) {
        var s, a, l, h, c, u, p, d = d || !1,
            m = [],
            g = [],
            f = [],
            y = [];
        o = o || this.core.getComponentByName("FloorComponent3D").getFloor(i);
        var _ = new hcs.WhiteMaterial("bottom", hcsdesign.engine3D.scene, {
                factor: 1
            }),
            v = n.materials.bottom || _;
        n.materials.bottom || (n.materials.bottom = v), v.name = "bottom";
        var b = n.materials.top || _.clone("top");
        n.materials.top || (n.materials.top = b), b.name = "top";
        var w = e[0].subtract(e[1]),
            x = e[3].subtract(e[2]);
        if (w.dot(x) > 0) {
            for (g.push(0, 2, 3), g.push(2, 0, 1), g.push(7, 5, 4), g.push(5, 7, 6), s = 0; s < e.length; s++)
                m.push(e[s].x, e[s].y, e[s].z);
            for (s = 0; s < e.length; s++)
                m.push(e[s].x, e[s].y + .1, e[s].z);
            l = new BABYLON.Vector3(e[1].x - e[0].x, e[1].y - e[0].y, e[1].z - e[0].z), l.normalize(), h = new BABYLON.Vector3(e[2].x - e[1].x, e[2].y - e[1].y, e[2].z - e[1].z), h.normalize(), u = BABYLON.Vector3.Cross(l, h), c = BABYLON.Vector3.Cross(u, l), f = BABYLON.Tools.PlaneUVProjection(m, l, c, 512), BABYLON.Mesh.ComputeFlatNormal(m, y, g), a = new BABYLON.Mesh("subslope_" + this.currentID++, r), a.setVerticesData(BABYLON.VertexBuffer.PositionKind, m, d), a.setVerticesData(BABYLON.VertexBuffer.NormalKind, y, d), a.setVerticesData(BABYLON.VertexBuffer.UVKind, f, d), a.setIndices(g), a.subMeshes.shift(), p = BABYLON.SubMesh.CreateFromIndices(0, 0, 6, a), p.objectInstance = n, p = BABYLON.SubMesh.CreateFromIndices(1, 6, 6, a), p.objectInstance = n
        } else {
            var C = e[0].subtract(e[3]),
                M = e[3].subtract(e[2]).length(),
                D = e[1].subtract(e[0]).length(),
                B = M / D + 1,
                A = C.scale(1 / B).subtract(e[0]).scale(-1),
                E = [e[0], e[1], A];
            for (s = 0; s < E.length; s++)
                m.push(E[s].x, E[s].y, E[s].z);
            for (s = 0; s < E.length; s++)
                m.push(E[s].x, E[s].y + .1, E[s].z);
            g.push(0, 1, 2), g.push(5, 4, 3), l = new BABYLON.Vector3(e[1].x - e[0].x, e[1].y - e[0].y, e[1].z - e[0].z), l.normalize(), h = new BABYLON.Vector3(e[2].x - e[1].x, e[2].y - e[1].y, e[2].z - e[1].z), h.normalize(), u = BABYLON.Vector3.Cross(l, h), c = BABYLON.Vector3.Cross(u, l), f = BABYLON.Tools.PlaneUVProjection(m, l, c, 512), BABYLON.Mesh.ComputeFlatNormal(m, y, g), a = new BABYLON.Mesh("subslope_" + this.currentID++, r), a.setVerticesData(BABYLON.VertexBuffer.PositionKind, m, d), a.setVerticesData(BABYLON.VertexBuffer.NormalKind, y, d), a.setVerticesData(BABYLON.VertexBuffer.UVKind, f, d), a.setIndices(g), a.subMeshes.shift(), p = BABYLON.SubMesh.CreateFromIndices(0, 0, 3, a), p.objectInstance = n, p = BABYLON.SubMesh.CreateFromIndices(1, 3, 3, a), p.objectInstance = n
        }
        a.position.y = .2;
        var T = t,
            S = BABYLON.Mesh.mergeMeshes("mat", [T, a], r, !0);
        S.name = T.name, S.id = T.id, S.decorate = T.decorate, S.receiveShadows = T.receiveShadows, S.material = T.material, S.isDecorable = !0, hcsdesign.engine3D.castShadows(S)
    }, e.prototype.buildFromCSG = function(t, e, n, i, o, r) {
        var s = t,
            a = e,
            l = i.clone();
        a.subtractInPlace(i);
        var h = a.toMesh("mat", s.material, r, !0);
        this.core.getComponentByName("WallComponent3D").replaceWall(s, h), h.material = s.material, h.isDecorable = !0, hcsdesign.engine3D.castShadows(h);
        var c = n;
        c.subtractInPlace(l);
        var u = c.toMesh("mat", o.roomMesh.material, r, !0);
        return u.isDecorable = !0, this.core.getComponentByName("RoomComponent3D").replaceRoom(o.roomMesh, u), u.parent = o, o.roomMesh = u, h
    }, e.prototype.drawSSForStructure = function(t, e, n) {
        var i, o, r, s = [],
            a = t.getElements("subslopes"),
            l = 0,
            h = this.core.getComponentByName("WallComponent3D").get3DWallFrom2D(t),
            c = BABYLON.CSG.FromMesh(h),
            u = BABYLON.CSG.FromMesh(e.roomMesh),
            p = new BABYLON.CSG;
        for (o = 0, r = a.length; r > o; o++)
            if (i = a[o].plane(), i && (l++, s.push(i)), i) {
                var d = this.buildCSG(i, a[o], e, n);
                d ? p.unionInPlace(d) : l--
            }
        for (h = this.core.getComponentByName("WallComponent3D").get3DWallFrom2D(t), this.buildFromCSG(h, c, u, p, e, n), o = 0, r = a.length; r > o; o++)
            i = a[o].plane(), h = this.core.getComponentByName("WallComponent3D").get3DWallFrom2D(t), i && this.addSubSlope(h, i, a[o], t, e, n);
        h = this.core.getComponentByName("WallComponent3D").get3DWallFrom2D(t), h.parent = e, ujs.notify("hcs.engine3d.subslopesReady", {
            floor: e,
            structure: t,
            walls: h
        })
    }, e
}();
StairwayStructure = function() {
    var t = function() {
        BaseStructure.call(this, "StairwayStructure"), this.points = [], this.type = "straight", this.width = 90, this.height = 250, this.stair_height = 20, this.stair_thickness = 3, this.stair_width = 25, this.rail_a = !0, this.rail_b = !0, this.limon = -1, this.stick_spacement = 20, this.have_contremarche = !0, this.elevation = 0, this.diameter = 6, this.bearing = !0, this.stair_offset = 3, this.materials = void 0, this.room = null, this.orientation = !0
    };
    return t.prototype = new BaseStructure, t.prototype.isTargeted = function() {
        return !1
    }, t.prototype.draw = function() {
        return !1
    }, t.prototype.isValid = function() {
        return !0
    }, t.serialize = function(t) {
        for (var e = [], n = 0, i = t.length; i > n; n++)
            e.push(t[n].serialize());
        return e
    }, t.deserialize = function(t) {
        for (var e = [], n = 0, i = t.length; i > n; n++) {
            if ("spiral" == t[n].type)
                var o = new SpiralStairwayStructure;
            else
                var o = new StraightStairwayStructure;
            o.deserialize(t[n]), o.isValid() !== !1 && e.push(o)
        }
        return e
    }, t.prototype.serialize = function() {
        var t = {
            "class": {
                name: "StraightStairwayStructure"
            }
        };
        return ujs.serializeObject(this, t, ["id", "type", "name", "width", "height", "stair_offset", "stair_thickness", "is_closed", "rail_b", "rail_a", "have_contremarche", "elevation", "z", "area", "points", "bearing", "diameter", "limon", "orientation", "materials"]), t
    }, t.prototype.deserialize = function(t) {
        this.id = t.id, this.type = t.type || "straight", this.name = t.name, this.width = t.width || 90, this.height = t.height || 250, this.z = t.z || 0, this.is_closed = t.is_closed, this.area = t.area, this.points.length = 0, this.have_contremarche = t.have_contremarche, this.elevation = t.elevation, this.rail_a = t.rail_a, this.rail_b = t.rail_b, this.stair_offset = "undefined" != typeof t.stair_offset ? t.stair_offset : 3, this.materials = t.materials || {}, this.bearing = "undefined" == typeof t.bearing ? !0 : t.bearing, this.diameter = "undefined" == typeof t.diameter ? 6 : t.diameter, this.stair_thickness = "undefined" == typeof t.stair_thickness ? 3 : t.stair_thickness, this.limon = "undefined" == typeof t.limon ? 10 : t.limon, this.orientation = "undefined" == typeof t.orientation ? !0 : t.orientation;
        for (var e = 0, n = t.points.length; n > e; e++)
            this.points.push(new BABYLON.Vector3(t.points[e].x, t.points[e].y, t.points[e].z))
    }, t.prototype.getHopperPoints = function() {
        for (var t = -1 / 0, e = -1 / 0, n = 1 / 0, i = 1 / 0, o = [], r = 0; r < this.points.length - 1; r++)
            o = o.concat(this.getStepBoundPoints(r));
        for (var r = 0; r < o.length; r++) {
            var s = o[r];
            s.x > t && (t = s.x), s.x < n && (n = s.x), s.y > e && (e = s.y), s.y < i && (i = s.y)
        }
        return [new BABYLON.Vector2(t, e), new BABYLON.Vector2(n, e), new BABYLON.Vector2(n, i), new BABYLON.Vector2(t, i)]
    }, t.prototype.getStepBoundPoints = function(t) {
        var e = this.points[t],
            n = this.points[t + 1];
        t + 2 < this.points.length && (n = n.clone().add(n.clone().subtractInPlace(e.clone()).normalize().scaleInPlace(this.width / 2))), t > 0 && (e = e.clone().add(n.clone().subtractInPlace(e.clone()).normalize().scaleInPlace(this.width / 2)));
        var i = new BABYLON.Vector3(e.y - n.y, n.x - e.x, 0).normalize(),
            o = e.clone().add(i.clone().scaleInPlace(this.width / 2)),
            r = e.clone().subtractInPlace(i.clone().scaleInPlace(this.width / 2)),
            s = n.clone().subtractInPlace(i.clone().scaleInPlace(this.width / 2)),
            a = n.clone().add(i.clone().scaleInPlace(this.width / 2));
        return [o, r, s, a]
    }, t.prototype.getNormalAtPoint = function(t) {
        var e = this.points[t - 1].clone(),
            n = this.points[t].clone(),
            i = new BABYLON.Vector3(e.y - n.y, n.x - e.x, 0);
        return i.normalize(), i
    }, t.prototype.remove = function(t) {
        t.removeElement("stairways", this)
    }, t.prototype.addMaterial = function(t, e, n) {
        this.materials[e.name] = n, t.traverse(function(t) {
            t.name == e.name && t != e && (t.material = e.material.clone())
        })
    }, t.prototype.getAvailableProperties = function() {
        var t = [];
        return t.push({
            name: "width",
            label: _("Width"),
            type: "number",
            cast: "int",
            unit: "cm",
            value: {
                min: 3,
                max: 100,
                step: 1,
                value: this.width
            }
        }), t.push({
            name: "rail_a",
            label: _("Right guard-rail"),
            type: "checkbox",
            value: this.rail_a
        }), t.push({
            name: "rail_b",
            label: _("Left guard-rail"),
            type: "checkbox",
            value: this.rail_b
        }), t.push({
            name: "have_contremarche",
            label: _("riser"),
            type: "checkbox",
            value: this.have_contremarche
        }), t
    }, t
}(), StraightStairwayStructure = function() {
    var t = function() {
        StairwayStructure.call(this), this.type = "straight", this._steps = []
    };
    return t.prototype = new StairwayStructure, t.prototype.isValid = function() {
        return this.points.length <= 1 ? !1 : !0
    }, t.prototype.isTargeted = function(t) {
        for (var e, n = !1, i = !1, o = !1, r = 0; r < this.points.length; r++)
            e = this.getBoundPoints(r), this.isInPoly(t, e) && (n = r, o = !0), this.points[r].distanceTo(t) < 10 && (i = r, o = !0);
        return o ? {
            point: i,
            step: n
        } : !1
    }, t.prototype.draw = function(t, e) {
        e && this.points.push(e), this.computeSteps(), e && this.points.pop(e);
        for (var n = 0; n < this._steps.length; n++)
            this.drawStep(t, this._steps[n])
    }, t.prototype.serialize = function() {
        var t = {
            "class": {
                name: "StraightStairwayStructure"
            }
        };
        return ujs.serializeObject(this, t, ["id", "type", "name", "width", "height", "stair_offset", "stair_thickness", "is_closed", "rail_b", "rail_a", "have_contremarche", "elevation", "z", "area", "points", "bearing", "diameter", "limon", "orientation", "materials"]), t
    }, t.Deserialize = function(t) {
        var e = new StraightStairwayStructure;
        return ujs.deserializeObject(t, e, ["id", "type", "name", "width", "height", "stair_offset", "stair_thickness", "is_closed", "rail_b", "rail_a", "have_contremarche", "elevation", "z", "area", "points", "bearing", "diameter", "limon", "orientation", "materials"]), e.computeSteps(), e
    }, t.prototype.computeSteps = function() {
        this._steps.length = 0;
        for (var t, e, n, i, o = 0; o < this.points.length - 1; o++) {
            e = this.getBoundPoints(o - 1), n = this.getBoundPoints(o), i = this.getBoundPoints(o + 1);
            var r = n[0].clone(),
                s = n[1].clone(),
                a = n[2].clone(),
                l = n[3].clone(),
                h = this.points[o].clone(),
                c = this.points[o + 1].clone(),
                u = null,
                p = null,
                d = null,
                m = null,
                g = null,
                f = null;
            i && (ia1 = BABYLON.Vector2.Intersect(n[0], n[3], i[0], i[3]), "undefined" != typeof ia1 && (l.x = ia1.x, l.y = ia1.y), ib1 = BABYLON.Vector2.Intersect(n[1], n[2], i[1], i[2]), "undefined" != typeof ib1 && (a.x = ib1.x, a.y = ib1.y), h.distanceTo(l) > h.distanceTo(a) ? (c = h.add(a.subtract(h).projectOnVector(c.subtract(h))), m = a.clone(), p = c.add(c.subtract(a)), g = l.clone()) : (c = h.add(l.subtract(h).projectOnVector(c.subtract(h))), m = l.clone(), p = c.add(c.subtract(l)), g = a.clone())), e && (ia0 = BABYLON.Vector2.Intersect(n[0], n[3], e[0], e[3]), "undefined" != typeof ia0 && (r.x = ia0.x, r.y = ia0.y), ib0 = BABYLON.Vector2.Intersect(n[1], n[2], e[1], e[2]), "undefined" != typeof ib0 && (s.x = ib0.x, s.y = ib0.y), c.distanceTo(r) > c.distanceTo(s) ? (h = c.add(s.subtract(c).projectOnVector(h.subtract(c))), d = s.clone(), u = h.add(h.subtract(s)), f = r.clone()) : (h = c.add(r.subtract(c).projectOnVector(h.subtract(c))), d = r.clone(), u = h.add(h.subtract(r)), f = s.clone())), t = {
                id: o,
                boundPolygon: n,
                areaPolygon: [r, s, a, l],
                stairsSegment: [h, c],
                bearingPolygon0: [d, u, f],
                bearingPolygon1: [m, p, g]
            }, this._steps.push(t)
        }
    }, t.prototype.getBoundPoints = function(t) {
        if (this.points[t] && this.points[t + 1]) {
            var e = this.points[t + 1].subtract(this.points[t]).normalize(),
                n = new BABYLON.Vector3(e.y, -e.x, 0).scaleInPlace(this.width / 2),
                i = this.points[t].add(n),
                o = this.points[t + 1].add(n),
                r = this.points[t + 1].subtract(n),
                s = this.points[t].subtract(n);
            return [i, s, r, o]
        }
        return !1
    }, t.prototype.drawStepBearing = function(t, e, n) {
        var n = n || 0;
        if (!this.bearing && e[0]) {
            var i, o = e[1].distanceTo(e[2]),
                r = 25,
                s = Math.floor(o / r);
            t.beginPath();
            for (var a = 1; s - n >= a; a++)
                i = e[1].clone().lerp(e[2], 1 / s * a), t.moveTo(e[0].x, e[0].y), t.lineTo(i.x, i.y);
            t.stroke()
        }
    }, t.prototype.drawStep = function(t, e) {
        var n = e.areaPolygon,
            i = n[3].subtract(n[0]).normalize(),
            o = new BABYLON.Vector3(i.y, -i.x, 0).scaleInPlace(10),
            r = n[0].add(o),
            s = n[3].add(o),
            a = Math.round(r.distanceTo(s)) / 100;
        if (a > .5 && hcsdesign.engine2D.symbols2D.drawMeasure(t, r, s, a + "m", "#cccccc"), this.points.length > 2) {
            var l = n[1].subtract(o),
                h = n[2].subtract(o),
                c = Math.round(l.distanceTo(h)) / 100;
            c > .5 && hcsdesign.engine2D.symbols2D.drawMeasure(t, l, h, c + "m", "#cccccc")
        }
        t.beginPath(), t.moveTo(n[0].x, n[0].y), t.lineTo(n[3].x, n[3].y), t.moveTo(n[1].x, n[1].y), t.lineTo(n[2].x, n[2].y), t.stroke(), this.drawStepStairs(t, e.stairsSegment), this.drawStepBearing(t, e.bearingPolygon0, 1), this.drawStepBearing(t, e.bearingPolygon1)
    }, t.prototype.drawStepStairs = function(t, e) {
        var n = e[0].clone(),
            i = e[1],
            o = i.subtract(n).normalize(),
            r = new BABYLON.Vector3(o.y, -o.x, 0).scaleInPlace(this.width / 2),
            s = n.distanceTo(i),
            a = 20,
            l = Math.floor(s / a),
            h = s / l,
            c = Math.atan2(o.y, o.x);
        hcsdesign.engine2D.symbols2D.drawArrows(t, n, [0, 1, 0, 0], 0, c, !1, {
            size: 10
        }), hcsdesign.engine2D.symbols2D.drawArrows(t, i, [0, 1, 0, 0], -10, c, !1, {
            size: 10
        });
        var u = o.scale(h);
        t.beginPath();
        for (var p, d, m = 0; l >= m; m++)
            p = n.add(r), d = n.subtract(r), t.moveTo(p.x, p.y), t.lineTo(d.x, d.y), n.addInPlace(u);
        t.stroke()
    }, t.prototype.isInPoly = function(t, e) {
        var n, i, o = 0;
        for (n = 0, i = e.length - 1; n < e.length; i = n++)
            e[n].y > t.y != e[i].y > t.y && t.x < (e[i].x - e[n].x) * (t.y - e[n].y) / (e[i].y - e[n].y) + e[n].x && (o = !o);
        return o
    }, t
}();
SpiralStairwayStructure = function() {
    var t = function() {
        StairwayStructure.call(this), this.type = "spiral"
    };
    return t.prototype = new StairwayStructure, t.prototype.serialize = function() {
        var t = {
            "class": {
                name: "SpiralStairwayStructure"
            }
        };
        return ujs.serializeObject(this, t, ["id", "type", "name", "width", "height", "stair_offset", "stair_thickness", "is_closed", "rail_b", "rail_a", "have_contremarche", "z", "area", "points", "bearing", "diameter", "limon", "orientation", "materials"]), t
    }, t.Deserialize = function(t) {
        var e = new SpiralStairwayStructure;
        return ujs.deserializeObject(t, e, ["id", "type", "name", "width", "height", "stair_offset", "stair_thickness", "is_closed", "rail_b", "rail_a", "have_contremarche", "z", "area", "points", "bearing", "diameter", "limon", "orientation", "materials"]), e
    }, t.prototype.computeSpiralPoints = function() {
        var t = 0,
            e = -Math.PI / 2,
            n = this.points[0],
            i = new BABYLON.Vector3(this.width * Math.cos(t), this.width * Math.sin(t), 0),
            o = new BABYLON.Vector3(this.width * Math.cos(e), this.width * Math.sin(e), 0);
        this.points[1] = n.clone().add(i), this.points[2] = n.clone().add(o)
    }, t.prototype.isTargeted = function(t) {
        var e = !1,
            n = 0;
        if (t.distanceTo(this.points[0]) < this.width && (e = !0), this.points[1] && this.points[0]) {
            var i = t.distanceTo(this.points[1]),
                o = t.distanceTo(this.points[2]);
            10 > i ? (n = 1, e = !0) : 10 > o && (e = !0, n = 2)
        }
        return e ? {
            point: n
        } : !1
    }, t.prototype.getHopperPoints = function() {
        var t = this.points[0].clone(),
            e = t.clone();
        e.y -= this.width;
        var n = e.clone();
        n.x -= this.width;
        var i = n.clone();
        i.y += 2 * this.width;
        var o = i.clone();
        o.x += 2 * this.width;
        var r = o.clone();
        return r.y -= this.width, [t, e, n, i, o, r]
    }, t.prototype.draw = function(t, e) {
        var n = this.points[0] || e,
            i = this.points[1] || e.clone().add(new BABYLON.Vector3(this.width, 0, 0)),
            o = this.points[2] || i.clone(),
            r = this.width,
            s = Math.atan2(i.y - n.y, i.x - n.x),
            a = Math.atan2(o.y - n.y, o.x - n.x);
        s == a && (a = 2 * Math.PI), t.beginPath();
        this.orientation ? 1 : -1;
        this.orientation ? t.arc(n.x, n.y, r, s, a, !1) : t.arc(n.x, n.y, r, a, s, !1), t.moveTo(n.x, n.y), t.lineTo(i.x, i.y), t.moveTo(n.x, n.y), t.lineTo(o.x, o.y), t.stroke();
        var l = [0, 0, 1, 0];
        this.orientation || (l = [1, 0, 0, 0]), hcsdesign.engine2D.symbols2D.drawArrows(t, n.clone().lerp(i, .5), l, 0, s, !1, {
            size: 10
        }), hcsdesign.engine2D.symbols2D.drawArrows(t, n.clone().lerp(o, .5), l, -10, a, !1, {
            size: 10
        }), t.save(), t.beginPath(), this.orientation ? t.arc(n.x, n.y, r, a, s, !1) : t.arc(n.x, n.y, r, s, a, !1), t.strokeStyle = "#eeeeee";
        for (var h, c = 0; 10 >= c; c++)
            h = 15 * c / 80 * Math.PI, t.moveTo(n.x, n.y), p2x = n.x + Math.cos(h) * r, p2y = n.y + Math.sin(h) * r, t.lineTo(p2x, p2y);
        t.stroke(), t.restore(), t.save(), t.fillStyle = "#ffffff", t.beginPath(), t.arc(n.x, n.y, this.diameter, 0, 2 * Math.PI, !1), t.stroke(), t.fill(), t.restore()
    }, t
}();
StairwayComponent2D = function() {
    var t = null,
        e = function(e) {
            BaseComponent2D.call(this, e, "StairwayComponent2D"), this.priority = 50, this._tmpStairway = !1, this._tmpPoint = null, this._targetedAt = null, this._targetedAtPoint = null, this._SIZE = 13, t = this, this.onFloorAdded = this.onFloorAdded.bind(this), document.addEventListener("hcs.request.floorAdded", this.onFloorAdded), document.addEventListener("hcs.core.structure.loaded", this.onStructureLoaded.bind(this))
        };
    return e.prototype = new BaseComponent2D, e.prototype.startListening = function() {
        this.onAddStairway = this.onAddStairway.bind(this), document.addEventListener("hcs.engine2d.onAddStairway", this.onAddStairway, !1), this.core.engine2D.registerEventCb("StairwayComponent2D.stair.static-draw", this.priority, "static-draw", null, null, this.onStaticDraw.bind(this), {}), this.core.engine2D.registerEventCb("StairwayComponent2D.stair.hover", this.priority, "hover", this.core.engine2D.MODE_NORMAL | this.core.engine2D.MODE_DRAG | this.core.engine2D.MODE_CONTEXTMENU, StairwayStructure, this.onHover.bind(this), {}), this.core.engine2D.registerEventCb("StairwayComponent2D.stair.leave", this.priority, "leave", this.core.engine2D.MODE_NORMAL | this.core.engine2D.MODE_CONTEXTMENU, StairwayStructure, this.onLeave.bind(this), {}), this.core.engine2D.registerEventCb("StairwayComponent2D.stair.click", this.priority, "click", this.core.engine2D.MODE_NORMAL, StairwayStructure, this.onContextMenu.bind(this), {}), this.core.engine2D.registerEventCb("StairwayComponent2D.stair.dblclick", this.priority, "double-click", this.core.engine2D.MODE_NORMAL, StairwayStructure, this.onDoubleClick.bind(this), {})
    }, e.prototype.stopListening = function() {
        document.removeEventListener("hcs.engine2d.onAddStairway", this.onAddStairway, !1), this.core.engine2D.unregisterEventCb("StairwayComponent2D.stair.static-draw"), this.core.engine2D.unregisterEventCb("StairwayComponent2D.stair.hover"), this.core.engine2D.unregisterEventCb("StairwayComponent2D.stair.leave"), this.core.engine2D.unregisterEventCb("StairwayComponent2D.stair.click"), this.core.engine2D.unregisterEventCb("StairwayComponent2D.stair.dblclick")
    }, e.prototype.onStructureLoaded = function() {
        for (var t, e = 0; e < this.structure.members.length; e++) {
            t = this.structure.members[e];
            for (var n = t.stairways.length - 1; n >= 0; n--)
                t.stairways[n] instanceof StairwayStructure || t.stairways.splice(n, 1)
        }
    }, e.prototype.onFloorAdded = function(t) {
        var e = t.id,
            n = this.structure.getElement(+e),
            i = this.structure.getElement(+e - 1),
            o = t.callback || function() {};
        if (i)
            for (var r = i.getElements("stairways"), s = 0; s < r.length; s++) {
                var a = new HopperStructure;
                a.points = r[s].getHopperPoints(), a.stairwayId = r[s].id, n.insertElement("hoppers", a)
            }
        o.call(this)
    }, e.prototype.onLeave = function() {
        this.core.engine2D.unregisterEventCb("StairwayComponent2D.stair-hover.dynamic-draw"), this.core.engine2D.unregisterEventCb("StairwayComponent2D.stair.drag-start"), this.core.engine2D.requestDynamicDraw()
    }, e.prototype.onHoverStair = function(t, e, n, i) {
        t.strokeStyle = this.core.engine2D.symbols2D.COLOR_ACTIVE_STROKE_DARKER, this.draw(i, t, e, n), this.drawTarget(i, t, e, n)
    }, e.prototype.onHoverStairMouseMove = function(t, e, n) {
        var i = e.isTargeted(n.planPos);
        e.targeted = i, this.core.engine2D.requestDynamicDraw()
    }, e.prototype.onHover = function(t, e) {
        return (this.core.engine2D.getMode() & (this.core.engine2D.MODE_DRAW | this.core.engine2D.MODE_SUBSLOPE)) > 0 ? !1 : (this.core.engine2D.registerEventCb("StairwayComponent2D.stair-hover.mouse-move", this.priority, "mouse-move", null, StairwayStructure, this.onHoverStairMouseMove.bind(this), e), this.core.engine2D.registerEventCb("StairwayComponent2D.stair-hover.dynamic-draw", this.priority, "dynamic-draw", null, StairwayStructure, this.onHoverStair.bind(this), e), this.core.engine2D.registerEventCb("StairwayComponent2D.stair.drag-start", this.priority, "drag-start", this.core.engine2D.MODE_NORMAL, StairwayStructure, this.onDragStart.bind(this), {}), this.core.engine2D.requestDynamicDraw(), !1)
    }, e.prototype.onDragEnd = function(t, e, n, i) {
        this._targetedAtPoint = !1, this._targetedAt = !1;
        for (var o = 0; o < i.points.length - 1; o++)
            "spiral" != i.type && i.points[o].distanceTo(i.points[o + 1]) < i.width / 2 && (i.points.splice(o + 1, i.points.length), this.core.engine2D.requestStaticDraw(), this.core.engine2D.requestDynamicDraw());
        var r = this.core.getSelectedStructure();
        if (topStructure = this.structure.getElement(+r.id + 1)) {
            var s = null;
            if (s = topStructure.getElementByIdentifier(i.id, "hoppers", "stairwayId"))
                0 == s.modified && (s.points = i.getHopperPoints());
            else {
                var s = new HopperStructure;
                s.points = i.getHopperPoints(), s.stairwayId = i.id, topStructure.insertElement("hoppers", s)
            }
        }
    }, e.prototype.onDrawDragging = function(t, e, n, i) {
        return this.onMouseMove(t, e, n, i), !1
    }, e.prototype.onDrawDragStart = function(t, e, n, i) {
        0 == this._tmpStairway.points.length && this.onAddStairwayClick(t, e, n, i), this.core.engine2D.registerEventCb("StairwayComponent2D.stair-draw.drag", this.priority, "dragging", null, null, this.onDrawDragging.bind(this), e), this.core.engine2D.registerEventCb("StairwayComponent2D.stair-draw.drag-end", this.priority, "drag-end", null, null, this.onAddStairwayClick.bind(this), e)
    }, e.prototype.onDragStart = function(t, e) {
        this.core.engine2D.registerEventCb("StairwayComponent2D.stair-hover.drag", this.priority, "dragging", null, null, this.onDragStair.bind(this), e), this.core.engine2D.registerEventCb("StairwayComponent2D.stair-hover.drag-end", this.priority, "drag-end", null, null, this.onDragEnd.bind(this), e)
    }, e.prototype.onDragStairSpiral = function(t, e, n, i) {
        var o = n.posDelta.clone().scaleInPlace(1 / this.core.engine2D.getZoom());
        if (i.targeted.point > 0) {
            var r = n.planPos.clone(),
                s = i.points[0],
                a = s.clone().add(new BABYLON.Vector3(i.width, 0, 0)),
                l = s.clone().add(new BABYLON.Vector3(-i.width, 0, 0)),
                h = s.clone().add(new BABYLON.Vector3(0, i.width, 0)),
                c = s.clone().add(new BABYLON.Vector3(0, -i.width, 0)),
                u = s.clone().add(r.clone().subtractInPlace(s).normalize().scaleInPlace(i.width));
            i.points[i.targeted.point] = u.distanceTo(a) < 20 ? a : u.distanceTo(l) < 20 ? l : u.distanceTo(h) < 20 ? h : u.distanceTo(c) < 20 ? c : u
        } else
            for (var p = 0; p < i.points.length; p++)
                i.points[p].addInPlace(o);
        return this.core.engine2D.requestStaticDraw(), !1
    }, e.prototype.onDragStair = function(t, e, n, i) {
        if ("spiral" == i.type)
            return this.onDragStairSpiral(t, e, n, i), !1; {
            var o = i.targeted.step,
                r = i.points[o],
                s = i.points[o + 1],
                a = n.posDelta.clone().scaleInPlace(1 / this.core.engine2D.getZoom());
            this.core.getComponentByName("RoomComponent2D")
        }
        if (i.targeted.point !== !1 && -1 === [0, i.points.length - 1].indexOf(+i.targeted.point))
            for (var l = 0; l < i.points.length; l++)
                i.points[l].addInPlace(a);
        else if (i.targeted.point !== !1 && -1 !== [0, i.points.length - 1].indexOf(+i.targeted.point))
            i.points[i.targeted.point].addInPlace(a);
        else if (o !== !1)
            if (i.points.length > 2) {
                var h = new BABYLON.Vector3(r.y - s.y, s.x - r.x, 0).normalize();
                a.projectOnVector(h), r.addInPlace(a), s.addInPlace(a)
            } else
                for (var l = 0; l < i.points.length; l++)
                    i.points[l].addInPlace(a);
        return this.core.engine2D.requestStaticDraw(), !1
    }, e.prototype.getTargeted = function(t) {
        for (var e = this.core.getSelectedStructure(), n = e.getElements("stairways"), i = 0; i < n.length; i++) {
            var o = n[i];
            if (!(this.core.engine2D.getMode() & this.core.engine2D.MODE_DRAG) && o.isTargeted(t))
                return o
        }
        return null
    }, e.prototype.initialize = function() {
        _item = {
            title: _("楼梯"),
            id: "stairways",
            items: [{
                title: _("一般式楼梯"),
                action: "hcs.engine2d.onAddStairway",
                params: {
                    stairwayType: "straight",
                    bearing: !1
                }
            }, {
                title: _("楼梯平台"),
                action: "hcs.engine2d.onAddStairway",
                params: {
                    stairwayType: "straight",
                    bearing: !0
                }
            }, {
                title: _("悬式楼梯"),
                action: "hcs.engine2d.onAddStairway",
                params: {
                    stairwayType: "straight",
                    bearing: !1,
                    have_contremarche: !1,
                    limon: 0,
                    rail_a: !1,
                    rail_b: 0,
                    stair_offset: 0
                }
            }, {
                title: _("螺旋梯"),
                action: "hcs.engine2d.onAddStairway",
                params: {
                    stairwayType: "spiral"
                }
            }]
        }, ujs.notify("hcs.menu.main.add", {
            item: _item,
            menuPath: "draw2D",
            position: 5
        })
    }, e.prototype.onAddStairway = function(t) {
        this._tmpStairway = "spiral" == t.stairwayType ? new SpiralStairwayStructure : new StraightStairwayStructure, this._tmpStairway.height = this.core.getSelectedStructure().height;
        for (var e in this._tmpStairway)
            this._tmpStairway.hasOwnProperty(e) && "undefined" != typeof t[e] && "type" != e && (this._tmpStairway[e] = t[e]);
        this._tmpPoint = null, this.core.helpBubbleManager.display("hcs.2d.draw-staires"), this.core.engine2D.setMode(hcsdesign.engine2D.MODE_DRAW), this.core.engine2D.registerEventCb("StairwayComponent2D.add-stair.click", this.priority, "click", this.core.engine2D.MODE_DRAW, null, this.onAddStairwayClick.bind(this), {}), this.core.engine2D.registerEventCb("StairwayComponent2D.dynamic-stair.mouse-move", this.priority, "mouse-move", this.core.engine2D.MODE_DRAW, null, this.onMouseMove.bind(this), {}), this.core.engine2D.registerEventCb("StairwayComponent2D.dynamic-stair.dynamic-draw", this.priority, "dynamic-draw", this.core.engine2D.MODE_DRAW, null, this.onDynamicDraw.bind(this), {}), this.core.engine2D.registerEventCb("StairwayComponent2D.stair.drag-start-draw", this.priority, "drag-start", this.core.engine2D.MODE_DRAW, null, this.onDrawDragStart.bind(this), {})
    }, e.prototype.onDoubleClick = function(t, e) {
        e.targeted && e.targeted.point == e.points.length - 1 && (this.onAddStairway({}), this._tmpStairway = e, this.core.engine2D.setMode(this.core.engine2D.MODE_DRAW))
    }, e.prototype.finalizeTmpStairway = function() {
        var t = this.core.getSelectedStructure();
        if (this._tmpStairway.isValid()) {
            t.insertElement("stairways", this._tmpStairway);
            var e = !1;
            if (e = this.structure.getElement(+t.id + 1)) {
                var n = new HopperStructure;
                n.points = this._tmpStairway.getHopperPoints(), n.stairwayId = this._tmpStairway.id, e.insertElement("hoppers", n)
            }
        }
        this._tmpStairway = new StairwayStructure, this._tmpPoint = null, this.core.engine2D.requestStaticDraw(), this.core.engine2D.setMode(this.core.engine2D.MODE_NORMAL), ujs.notify("hcs.menu.main.deselect")
    }, e.prototype.onAddStairwayClick = function(t, e, n, i) {
        if ("touchUp" == t.type && this.onDrawDragging(t, e, n, i), 0 == this._tmpStairway.points.length || this._tmpPoint) {
            if (this._tmpPoint = this._tmpPoint || n.planPos, this._tmpPoint = this._tmpPoint || n.planPos, this._tmpStairway.points.push(this._tmpPoint.clone()), 1 == this._tmpStairway.points.length) {
                var o = this.core.getComponentByName("RoomComponent2D");
                this._tmpStairway.room = o.isPointInRooms(this._tmpPoint)
            }
            "spiral" == this._tmpStairway.type && (this._tmpStairway.computeSpiralPoints(), this.finalizeTmpStairway()), this._tmpPoint = !1
        } else
            this.finalizeTmpStairway()
    }, e.prototype.onMouseMove = function(t, e, n) {
        if (0 != !this._tmpStairway.points.length || this._tmpPoint || this.core.engine2D.setCursorIcon(this.core.engine2D.symbols2D.drawCursorCheck.bind(this.core.engine2D.symbols2D)), this._tmpStairway.points.length < 2)
            this._tmpPoint = n.planPos.clone();
        else {
            var i = this._tmpStairway.points;
            if (i[i.length - 1].distanceTo(n.planPos) < this._tmpStairway.width / 2)
                return void(this._tmpPoint = null);
            var o = new BABYLON.Ray(i[i.length - 1], this._tmpStairway.getNormalAtPoint(i.length - 1)),
                r = o.closestPointToPoint(n.planPos);
            this._tmpPoint = r.distanceTo(n.planPos) > 20 ? n.planPos.clone() : r
        }
    }, e.prototype._getMagneticRays = function(t, e) {
        var n = [];
        if (e.room) {
            for (var i = 0; i < e.room.points.length - 1; i++) {
                var o = e.room.points[i],
                    r = e.room.points[i + 1];
                n.push(new BABYLON.Ray(t, o.clone().subtractInPlace(r.clone()).normalize()))
            }
            var o = e.room.points[i],
                r = e.room.points[0];
            n.push(new BABYLON.Ray(t, o.clone().subtractInPlace(r.clone()).normalize()))
        } else
            n.push(new BABYLON.Ray(t, new BABYLON.Vector3(0, 1, 0))), n.push(new BABYLON.Ray(t, new BABYLON.Vector3(1, 0, 0)));
        return n
    }, e.prototype.onStaticDraw = function(t, e, n) {
        for (var i = this.core.getSelectedStructure(), o = i.getElements("stairways"), r = 0; r < o.length; r++)
            this.draw(o[r], t, e, n);
        var s = !1;
        if (s = this.structure.getElement(+i.id - 1))
            for (var a = s.getElements("stairways"), r = 0; r < a.length; r++)
                t.save(), t.strokeStyle = "#eeeeee", this.draw(a[r], t, e, n), t.restore()
    }, e.prototype.onDynamicDraw = function(t, e, n) {
        this.draw(this._tmpStairway, t, e, n, this._tmpPoint), t.save(), t.fillStyle = "rgba(60,82,129,0.8)";
        var i = this._tmpStairway;
        if (1 == i.points.length) {
            var o = this.core.engine2D.toRealCoord(i.points[0], e, n);
            if (this._tmpPoint) {
                var r = Math.atan2(this._tmpPoint.y - i.points[0].y, this._tmpPoint.x - i.points[0].x);
                this.core.engine2D.symbols2D.drawGrip(t, o, [!1, !0, !1, !1], r)
            } else
                this.core.engine2D.symbols2D.drawGrip(t, o, [!0, !0, !0, !0])
        } else if (i.points.length > 1) {
            var s = i.points[i.points.length - 1],
                a = i.points[i.points.length - 2],
                r = Math.atan2(s.y - a.y, s.x - a.x),
                o = this.core.engine2D.toRealCoord(s, e, n);
            this.core.engine2D.symbols2D.drawCheckGrip(t, o, [!0, !1, !0, !1], r)
        }
        t.restore()
    }, e.prototype.onContextMenu = function(t, e) {
        var n = [];
        n.push({
            name: "width",
            label: _("Width"),
            type: "slider",
            cast: "int",
            unit: "cm",
            value: {
                min: 40,
                max: 300,
                step: 1,
                value: e.width
            }
        }), n.push({
            name: "height",
            label: _("Height"),
            type: "slider",
            cast: "int",
            unit: "cm",
            value: {
                min: 20,
                max: 500,
                step: 1,
                value: e.height
            }
        }), n.push({
            name: "elevation",
            label: _("Elevation"),
            type: "slider",
            cast: "int",
            unit: "cm",
            value: {
                min: 0,
                max: 250,
                step: 1,
                value: e.elevation
            }
        }), n.push({
            name: "stair_offset",
            label: _("Stair Offset"),
            type: "slider",
            cast: "int",
            unit: "cm",
            value: {
                min: 0,
                max: 10,
                step: 1,
                value: e.stair_offset
            }
        }), n.push({
            name: "stair_thickness",
            label: _("Stair thickness"),
            type: "slider",
            cast: "int",
            unit: "cm",
            value: {
                min: 0,
                max: 50,
                step: 1,
                value: e.stair_thickness
            }
        }), n.push({
            name: "have_contremarche",
            label: _("riser"),
            type: "checkbox",
            value: e.have_contremarche
        }), "straight" == e.type ? (n.push({
            name: "bearing",
            label: _("bearing"),
            type: "checkbox",
            value: e.bearing
        }), n.push({
            name: "rail_a",
            label: _("Right guard-rail"),
            type: "checkbox",
            value: e.rail_a
        }), n.push({
            name: "rail_b",
            label: _("Left guard-rail"),
            type: "checkbox",
            value: e.rail_b
        }), n.push({
            name: "limon",
            label: _("Limon (-1 => default)"),
            type: "text",
            value: e.limon
        })) : "spiral" == e.type && (n.push({
            name: "rail_a",
            label: _("Guard-rail"),
            type: "checkbox",
            value: e.rail_a
        }), n.push({
            name: "diameter",
            label: _("Core diameter"),
            type: "slider",
            cast: "int",
            unit: "cm",
            value: {
                min: 1,
                max: 40,
                step: 1,
                value: e.diameter
            }
        }), n.push({
            name: "orientation",
            label: _("Orientation (clockwise)"),
            type: "checkbox",
            value: e.orientation
        })), this.core.engine2D.displayContextMenu(n, e, this.onContextMenuPropertyChanged.bind(this), this.onContextMenuRemove.bind(this))
    }, e.prototype.onContextMenuPropertyChanged = function(t, e, n) {
        t[e] = n, this.core.engine2D.requestStaticDraw()
    }, e.prototype.onContextMenuRemove = function(t) {
        var e = this.core.getSelectedStructure();
        if (topStructure = this.structure.getElement(+e.id + 1)) {
            var n = topStructure.getElementByIdentifier(t.id, "hoppers", "stairwayId");
            n && n.remove(topStructure)
        }
        t.remove(e)
    }, e.prototype.draw = function(t, e, n, i, o) {
        e.save(), e.translate(n.x, n.y), e.scale(i, i), t.draw(e, o), e.restore()
    }, e.prototype.drawTargetSpiral = function(t, e) {
        if (t.targeted && t.targeted.point > 0)
            this.core.engine2D.symbols2D.drawPointHover(e, this.core.engine2D.toRealCoord(t.points[t.targeted.point]));
        else {
            var n = this.core.engine2D.toRealCoord(t.points[0]);
            n.x = Math.round(n.x) + .5, n.y = Math.round(n.y) + .5, this.core.engine2D.symbols2D.drawGrip(e, n, [!0, !0, !0, !0]);
            for (var i = 1; i < t.points.length; i++)
                this.core.engine2D.symbols2D.drawPoint(e, this.core.engine2D.toRealCoord(t.points[i]))
        }
    }, e.prototype.drawTarget = function(t, e, n, i) {
        if (t) {
            if ("spiral" == t.type)
                return void this.drawTargetSpiral(t, e, n, i);
            if (t.targeted && t.targeted.point !== !1) {
                var o = this.core.engine2D.toRealCoord(t.points[t.targeted.point]);
                this.core.engine2D.symbols2D.drawGrip(e, o, [!0, !0, !0, !0])
            } else if (t.targeted && t.targeted.step !== !1) {
                {
                    var o = this.core.engine2D.toRealCoord(t.points[t.targeted.step]),
                        r = this.core.engine2D.toRealCoord(t.points[t.targeted.step + 1]);
                    Math.atan2(r.y - o.y, r.x - o.x)
                }
                this.core.engine2D.symbols2D.drawSegment(e, o, r)
            }
        }
    }, e
}();
var StairwayComponent3D = function() {
    function t(t) {
        t.traverse(function(t) {
            hcsdesign.engine3D.castShadows(t), t.receiveShadows = !0
        })
    }
    var e, n = function(t) {
        BaseComponent3D.call(this, t, "StairwayComponent3D"), this._scenes = [], this.priority = 1, e = this
    };
    return n.prototype = new BaseComponent3D, n.prototype.compute = function() {}, n.prototype.startListening = function() {
        document.addEventListener("hcs.engine3d.floorReady", this.onFloorReady, !1)
    }, n.prototype.stopListening = function() {
        document.removeEventListener("hcs.engine3d.floorReady", this.onFloorReady, !1)
    }, n.prototype.onFloorReady = function(t) {
        for (var n = t.floor || e.getFloor(), i = t.structure || e.core.getSelectedStructure(), o = 0; o < i.stairways.length; o++)
            e.createStairway(i.stairways[o], n, hcsdesign.engine3D.scene)
    }, n.prototype.createScene = function() {
        for (var t = this.core.getComponentByName("FloorComponent3D"), e = 0; e < this.structure.getLength(); e++) {
            var n = this.structure.getElement(e);
            if (n instanceof FloorStructure)
                for (var i = t.getFloor(n), o = 0; o < n.stairways.length; o++)
                    this.createStairway(n.stairways[o], i, hcsdesign.engine3D.scene)
        }
    }, n.prototype.initMaterials = function(t, e) {
        for (var n in e)
            t.traverse(function(t) {
                t.name === n && (t.material = e[n])
            })
    }, n.prototype.createStairway = function(e, n, i) {
        var o = (this.core.getComponentByName("ObjectComponent3D", this.core.ENGINE_3D), function(o) {
                var r = o.getObject3D(i);
                t(r), r.structure = e, r.structure.programmableInstance = o, r.name = "Stairway_" + e.id, r.isDecorable = !0, r.decorate = o.decorate, r.parent = n;
                var s = o.materials;
                o.getDefaultMaterials && (s = ujs.mergeObjects(o.getDefaultMaterials(hcsdesign.engine3D.scene), s)), this.initMaterials(r, s), e.materials = s, o.materials = s
            }.bind(this)),
            r = e.programmableInstance ? e.programmableInstance.materials : e.materials;
        return "spiral" == e.type ? hcs.Programmable.createInstance("Stairs.Spiral.js", e, r, e, o) : hcs.Programmable.createInstance("Stairs.js", e, r, e, o), !0
    }, n
}();
HopperStructure = function() {
    var t = function(t) {
        BaseStructure.call(this, "HopperStructure"), this.points = t || [new BABYLON.Vector2(0, 0), new BABYLON.Vector2(100, 0), new BABYLON.Vector2(100, 100), new BABYLON.Vector2(0, 100)], this.materials = {}, this.sticks = {}, this.stairwayId = null, this.modified = !1
    };
    return t.prototype = new BaseStructure, t.prototype.serialize = function() {
        var t = {
            "class": {
                name: "HopperStructure"
            }
        };
        return ujs.serializeObject(this, t, ["points", "materials", "sticks", "stairwayId"]), t
    }, t.Deserialize = function(e) {
        var n = new t;
        return ujs.deserializeObject(e, n, ["points", "materials", "sticks", "stairwayId"]), n.isValid() ? n : null
    }, t.prototype.isValid = function() {
        if (this.points.length < 2)
            return Logger.warning("Invalid Hopper"), !1;
        for (var t, e = 0, n = this.points.length; n > e; e++)
            if (t = this.points[e].distanceTo(this.points[(e + 1) % n]), 1 / 0 == t || isNaN(t) || 0 === t)
                return Logger.warning("Invalid Hopper"), !1;
        return !0
    }, t.prototype.remove = function(t) {
        t.removeElement("hoppers", this)
    }, t.prototype.insertPointAt = function(t, e) {
        this.points.splice(t, 0, e)
    }, t.prototype.move = function(t) {
        for (var e = 0; e < this.points.length; e++)
            this.points[e].addInPlace(t)
    }, t
}();
HopperComponent2D = function() {
    var t = null,
        e = function(e) {
            BaseComponent2D.call(this, e, "HopperComponent2D"), this.priority = 80, this._tmpHopper = new HopperStructure, this._targetedAt = null, this._targetedAtSide = null, t = this
        };
    return e.prototype = new BaseComponent2D, e.prototype.startListening = function() {
        this.onAddHopper = this.onAddHopper.bind(this), document.addEventListener("hcs.engine2d.onAddHopper", this.onAddHopper, !1), hcsdesign.engine2D.registerEventCb("HopperComponent2D.hopper.static-draw", this.priority, "static-draw", null, null, this.onStaticDraw.bind(this), {}), hcsdesign.engine2D.registerEventCb("HopperComponent2D.hopper.hover", this.priority, "hover", hcsdesign.engine2D.MODE_NORMAL | hcsdesign.engine2D.MODE_DRAG | hcsdesign.engine2D.MODE_CONTEXTMENU, HopperStructure, this.onHover.bind(this), {}), hcsdesign.engine2D.registerEventCb("HopperComponent2D.hopper.leave", this.priority, "leave", hcsdesign.engine2D.MODE_NORMAL | hcsdesign.engine2D.MODE_CONTEXTMENU, HopperStructure, this.onLeave.bind(this), {}), hcsdesign.engine2D.registerEventCb("HopperComponent2D.hopper.click", this.priority, "click", hcsdesign.engine2D.MODE_NORMAL, HopperStructure, this.onContextMenu.bind(this), {}), hcsdesign.engine2D.registerEventCb("HopperComponent2D.hopper.dblclick", this.priority, "double-click", hcsdesign.engine2D.MODE_NORMAL, HopperStructure, this.onDblClick.bind(this), {})
    }, e.prototype.stopListening = function() {
        document.removeEventListener("hcs.engine2d.onAddHopper", this.onAddHopper, !1), hcsdesign.engine2D.unregisterEventCb("HopperComponent2D.hopper.static-draw"), hcsdesign.engine2D.unregisterEventCb("HopperComponent2D.hopper.hover"), hcsdesign.engine2D.unregisterEventCb("HopperComponent2D.hopper.leave"), hcsdesign.engine2D.unregisterEventCb("HopperComponent2D.hopper.click"), hcsdesign.engine2D.unregisterEventCb("HopperComponent2D.hopper.dblclick")
    }, e.prototype.getTargeted = function(t) {
        for (var e = hcsdesign.getSelectedStructure(), n = e.getElements("hoppers"), i = (hcsdesign.engine2D.getZoom(), 0); i < n.length; i++) {
            if (!(hcsdesign.engine2D.getMode() & hcsdesign.engine2D.MODE_DRAG))
                for (var o = 0; o < n[i].points.length; o++) {
                    if (n[i].points[o].distanceTo(t) < 13)
                        return this._targetedAt = o, this._targetedAtSide = null, hcsdesign.engine2D.requestDynamicDraw(), n[i];
                    var r = this.isPointInHopperSide(t, n[i]);
                    if (r !== !1)
                        return this._targetedAtSide = r, this._targetedAt = null, hcsdesign.engine2D.requestDynamicDraw(), n[i]
                }
            if (this.isPointInHopper(t, n[i]))
                return hcsdesign.engine2D.getMode() & hcsdesign.engine2D.MODE_DRAG || (this._targetedAt = null, this._targetedAtSide = null, hcsdesign.engine2D.requestDynamicDraw()), n[i]
        }
    }, e.prototype.onLeave = function() {
        hcsdesign.engine2D.unregisterEventCb("HopperComponent2D.hopper-hover.dynamic-draw"), hcsdesign.engine2D.unregisterEventCb("HopperComponent2D.hopper.drag-start"), hcsdesign.engine2D.requestDynamicDraw()
    }, e.prototype.onHover = function(t, e) {
        return hcsdesign.engine2D.registerEventCb("HopperComponent2D.hopper-hover.dynamic-draw", this.priority, "dynamic-draw", null, HopperStructure, this.onHoverHopper.bind(this), e), hcsdesign.engine2D.registerEventCb("HopperComponent2D.hopper.drag-start", this.priority, "drag-start", hcsdesign.engine2D.MODE_NORMAL, HopperStructure, this.onDragStart.bind(this), {}), hcsdesign.engine2D.requestDynamicDraw(), !1
    }, e.prototype.onHoverHopper = function(t, e, n, i) {
        this.draw(i, t, e, n, !0), this.drawTarget(i, t, n)
    }, e.prototype.onDblClick = function(t, e, n) {
        if (e instanceof HopperStructure) {
            var i = this.isPointInHopperSide(n.planPos, e);
            if (i !== !1) {
                var o = e.points[i],
                    r = i + 1 < e.points.length ? e.points[i + 1] : e.points[0],
                    s = n.planPos.projectOnSegment(o, r);
                e.insertPointAt(i + 1, s), this._targetedAtSide = null, this._targetedAt = i + 1, hcsdesign.engine2D.requestDynamicDraw()
            }
        }
    }, e.prototype.onDrag = function(t, e, n, i) {
        if (null !== this._targetedAt) {
            for (var o = n.planPos.clone(), r = 0; r < i.points.length; r++)
                r != this._targetedAt && (Math.abs(o.x - i.points[r].x) < 10 && (o.x = i.points[r].x), Math.abs(o.y - i.points[r].y) < 10 && (o.y = i.points[r].y));
            this.getRoom(i).isPointIn(o) && (i.points[this._targetedAt] = o)
        } else if (null !== this._targetedAtSide) {
            var s = n.posDelta.scale(1 / hcsdesign.engine2D.getZoom()),
                a = i.points[this._targetedAtSide],
                l = this._targetedAtSide + 1 < i.points.length ? this._targetedAtSide + 1 : 0,
                h = i.points[l],
                c = new BABYLON.Vector2(a.y - h.y, h.x - a.x);
            s.projectOnVector(c), this.getRoom(i).isPointIn(i.points[this._targetedAtSide].add(s)) && this.getRoom(i).isPointIn(i.points[l].add(s)) && (i.points[this._targetedAtSide].addInPlace(s), i.points[l].addInPlace(s))
        } else {
            var s = n.posDelta.scale(1 / hcsdesign.engine2D.getZoom());
            i.move(s)
        }
        return i.modified = !0, hcsdesign.engine2D.requestStaticDraw(), !1
    }, e.prototype.compute = function() {
        for (var t = hcsdesign.getSelectedStructure(), e = 0; e < t.getElements("hoppers").length; e++)
            this.computeHopper(t.getElements("hoppers")[e])
    }, e.prototype.computeHopper = function(t) {
        for (var e = t.points.length - 1; e >= 0; e--) {
            var n = e - 1 >= 0 ? e - 1 : t.points.length - 1;
            t.points[e].distanceTo(t.points[n]) < 2 && t.points.splice(e, 1)
        }
        t.points.length < 3 && (t.remove(hcsdesign.getSelectedStructure()), hcsdesign.engine2D.requestStaticDraw(), hcsdesign.engine2D.requestDynamicDraw(), this._targetedAt = null, this._targetedAtSide = null)
    }, e.prototype.onDragEnd = function(t, e, n, i) {
        this.computeHopper(i)
    }, e.prototype.onDragStart = function(t, e) {
        this.getRoom(e, !0), hcsdesign.engine2D.registerEventCb("hopperComponent2D.hopper.drag", this.priority, "dragging", null, null, this.onDrag.bind(this), e), hcsdesign.engine2D.registerEventCb("hopperComponent2D.stair-hover.drag-end", this.priority, "drag-end", null, null, this.onDragEnd.bind(this), e)
    }, e.prototype.onAddHopper = function() {
        hcsdesign.engine2D.setMode(hcsdesign.engine2D.MODE_DRAW), hcsdesign.engine2D.registerEventCb("hopperComponent2D.add-hopper.click", this.priority, "click", hcsdesign.engine2D.MODE_DRAW, null, this.onAddHopperClick.bind(this), {}), hcsdesign.engine2D.registerEventCb("hopperComponent2D.dynamic-stair.mouse-move", this.priority, "mouse-move", hcsdesign.engine2D.MODE_DRAW, null, this.onMouseMove.bind(this), {}), hcsdesign.engine2D.registerEventCb("hopperComponent2D.dynamic-stair.dynamic-draw", this.priority, "dynamic-draw", hcsdesign.engine2D.MODE_DRAW, null, this.onDynamicDraw.bind(this), {})
    }, e.prototype.onAddHopperClick = function() {
        var t = hcsdesign.getSelectedStructure();
        t.insertElement("hoppers", this._tmpHopper), this._tmpHopper = new HopperStructure, hcsdesign.engine2D.requestStaticDraw(), hcsdesign.engine2D.setMode(hcsdesign.engine2D.MODE_NORMAL), ujs.notify("hcs.menu.main.deselect")
    }, e.prototype.onMouseMove = function(t, e, n) {
        var i = n.planPos.subtract(this._tmpHopper.points[0].clone());
        i.x -= 50, i.y -= 50, this._tmpHopper.move(i)
    }, e.prototype.onContextMenu = function(t, e) {
        var n = [];
        null !== this._targetedAtSide ? (n.push({
            name: "sticks_" + this._targetedAtSide,
            label: _("Enable the guard-rail on this side"),
            type: "checkbox",
            cast: "int",
            value: e.sticks[this._targetedAtSide]
        }), n.push({
            name: "cut",
            label: _("Add point"),
            type: "button",
            value: _("Add")
        })) : (n.push({
            name: "enable_sticks",
            label: _("四周有护栏"),
            type: "button",
            value: _("选择")
        }), n.push({
            name: "disable_sticks",
            label: _("四周没有护栏"),
            type: "button",
            value: _("选择")
        })), hcsdesign.engine2D.displayContextMenu(n, e, this.onContextMenuPropertyChanged.bind(this), this.onContextMenuRemove.bind(this))
    }, e.prototype.onContextMenuPropertyChanged = function(t, e, n) {
        if (-1 != e.indexOf("sticks_")) {
            var i = e.split("_");
            t.sticks[i[1]] = n
        } else if ("cut" == e) {
            var o = t.points[this._targetedAtSide],
                r = t.points[this._targetedAtSide + 1],
                s = o.clone().lerp(r, .5);
            t.insertPointAt(this._targetedAtSide + 1, s)
        } else if ("enable_sticks" == e)
            for (var a = 0; a < t.points.length; a++)
                t.sticks[a] = !0;
        else if ("disable_sticks" == e)
            for (var a = 0; a < t.points.length; a++)
                t.sticks[a] = !1;
        else
            t[e] = n;
        hcsdesign.engine2D.requestStaticDraw()
    }, e.prototype.onContextMenuRemove = function(t) {
        var e = hcsdesign.getSelectedStructure();
        t.remove(e)
    }, e.prototype.onStaticDraw = function(t, e, n) {
        for (var i = hcsdesign.getSelectedStructure(), o = i.getElements("hoppers"), r = 0; r < o.length; r++)
            this.draw(o[r], t, e, n)
    }, e.prototype.onDynamicDraw = function(t, e, n) {
        hcsdesign.engine2D.setCursorIcon(hcsdesign.engine2D.symbols2D.drawCursorCheck.bind(hcsdesign.engine2D.symbols2D)), this.draw(this._tmpHopper, t, e, n)
    }, e.prototype.initialize = function() {
        var t = {
            title: _("储料仓"),
            index: 80,
            action: "hcs.engine2d.onAddHopper"
        };
        ujs.notify("hcs.menu.main.add", {
            item: t,
            menuPath: "draw2D",
            position: 80
        })
    }, e.prototype.drawTarget = function(t, e, n) {
        if (null !== this._targetedAt) {
            var i = hcsdesign.engine2D.toRealCoord(t.points[this._targetedAt]);
            hcsdesign.engine2D.symbols2D.drawPointHover(e, i, n)
        } else if (null !== this._targetedAtSide) {
            var o = hcsdesign.engine2D.toRealCoord(t.points[this._targetedAtSide]),
                r = hcsdesign.engine2D.toRealCoord(this._targetedAtSide + 1 < t.points.length ? t.points[this._targetedAtSide + 1] : t.points[0]);
            hcsdesign.engine2D.symbols2D.drawSegment(e, o, r)
        }
    }, e.prototype.draw = function(t, e, n, i, o) {
        e.save(), e.beginPath(), o ? (e.fillStyle = hcsdesign.engine2D.symbols2D.COLOR_ACTIVE_FILL, e.strokeStyle = hcsdesign.engine2D.symbols2D.COLOR_ACTIVE_STROKE_DARKER) : (e.fillStyle = hcsdesign.engine2D.symbols2D.COLOR_INACTIVE_FILL, e.strokeStyle = hcsdesign.engine2D.symbols2D.COLOR_INACTIVE_STROKE);
        for (var r = 0; r < t.points.length; r++) {
            var s = hcsdesign.engine2D.toRealCoord(t.points[r], n, i);
            0 == r ? e.moveTo(Math.round(s.x) + .5, Math.round(s.y) + .5) : e.lineTo(Math.round(s.x) + .5, Math.round(s.y) + .5)
        }
        e.closePath(), e.fill(), e.stroke(), e.beginPath();
        for (var r = 0; r < t.points.length; r++)
            if (t.sticks[r]) {
                var a = hcsdesign.engine2D.toRealCoord(t.points[r], n, i),
                    l = r + 1 < t.points.length ? r + 1 : 0,
                    h = hcsdesign.engine2D.toRealCoord(t.points[l], n, i);
                e.lineWidth = 4, e.beginPath(), e.moveTo(Math.round(a.x), Math.round(a.y)), e.lineTo(Math.round(h.x), Math.round(h.y)), e.stroke()
            }
        e.restore()
    }, e.prototype.getRoom = function(t, e) {
        var e = e || !1;
        if (t.room && e === !1)
            return t.room;
        var n = hcsdesign.getComponentByName("RoomComponent2D"),
            i = n.isPointInRooms(t.points[0]);
        return i !== !1 ? (t.room = i, t.room) : !1
    }, e.prototype.isPointInHopperSide = function(t, e) {
        for (var n = 0; n < e.points.length; n++) {
            var i = e.points[n].clone(),
                o = n + 1 < e.points.length ? e.points[n + 1] : e.points[0],
                r = Math.abs(i.distanceTo(t) + o.distanceTo(t) - i.distanceTo(o));
            if (1 > r)
                return n
        }
        return !1
    }, e.prototype.isPointInHopper = function(t, e) {
        return t.isPointInPolygon(e.points) ? !0 : !1
    }, e
}();
var HopperComponent3D = function() {
    var t, e = function(e) {
        BaseComponent3D.call(this, e, "HopperComponent3D"), t = this;
        var n = hcsdesign.getComponentByName("RoomComponent3D");
        this._commonHopperMaterial = n.getSideMaterial()
    };
    return e.prototype = new BaseComponent3D, e.prototype.startListening = function() {
        document.addEventListener("hcs.engine3d.floorReady", this.onFloorReady, !1)
    }, e.prototype.stopListening = function() {
        document.removeEventListener("hcs.engine3d.floorReady", this.onFloorReady, !1)
    }, e.prototype.onFloorReady = function(e) {
        for (var n = e.floor || t.getFloor(), i = e.structure || hcsdesign.getSelectedStructure(), o = 0; o < i.hoppers.length; o++)
            t.createHopperSticks(i.hoppers[o], n)
    }, e.prototype.decorate = function(t, e) {
        var n = e.pickedMesh.material;
        return this.traverse(function(n) {
            n.name === e.pickedMesh.name && (n.material = t)
        }), this.structure.materials[e.pickedMesh.name] = t, n
    }, e.prototype.createScene = function() {
        for (var t = this.core.getComponentByName("FloorComponent3D"), e = 0; e < this.structure.getLength(); e++) {
            var n = this.structure.getElement(e);
            if (n instanceof FloorStructure)
                for (var i = t.getFloor(n), o = 0; o < n.hoppers.length; o++)
                    this.createHopperSticks(n.hoppers[o], i)
        }
    }, e.prototype.mergeGeometries = function(t, e, n) {
        var i = [],
            o = [],
            r = [];
        if (t.computeWorldMatrix(!0), t.traverse(function(t) {
                t.computeWorldMatrix(!0), t.isVisible && ("rail_stick" == t.name ? i.push(t) : "rails" == t.name ? o.push(t) : "bas" == t.name && r.push(t))
            }), i.length) {
            var s = BABYLON.Mesh.mergeMeshes("rail_stick", i, n);
            s.parent = t
        }
        if (o.length) {
            var a = BABYLON.Mesh.mergeMeshes("rails", o, n);
            a.parent = t
        }
        if (r.length) {
            var l = BABYLON.Mesh.mergeMeshes("bas", r, n);
            l.parent = t
        }
    }, e.prototype.createHopperSticks = function(t, e) {
        if (Object.keys(t.sticks).length) {
            var n = t.materials;
            n = ujs.mergeObjects(this.getDefaultMaterials(hcsdesign.engine3D.scene), n);
            var i = new BABYLON.Mesh("sticks", hcsdesign.engine3D.scene);
            i.isVisible = !1;
            for (var o in t.sticks) {
                var r = t.sticks[o] ? o : !1;
                if (r !== !1) {
                    var s = new BABYLON.Mesh("rails", hcsdesign.engine3D.scene);
                    s.isVisible = !1;
                    var a = t.points[+r],
                        l = t.points[+r + 1 >= t.points.length ? 0 : +r + 1],
                        h = a.clone().lerp(l.clone(), .5),
                        c = Math.atan2(l.y - a.y, l.x - a.x),
                        u = a.distanceTo(l),
                        p = BABYLON.Mesh.CreateBloc("bas", u, 10, 5, hcsdesign.engine3D.scene);
                    p.parent = s, p.position.y = 5, p.name = "bas", p.isDecorable = !0;
                    var d = BABYLON.Mesh.CreateBloc("rails", u, 3, 5, hcsdesign.engine3D.scene);
                    d.position.y = 90, d.name = "rails", d.isDecorable = !0, d.parent = s;
                    var m = 20,
                        g = Math.round(u / m),
                        m = u / g,
                        f = new BABYLON.Mesh("stick", hcsdesign.engine3D.scene);
                    f.isVisible = !1;
                    for (var y = BABYLON.Mesh.CreateCylinder("rail_stick", 90, 2, 2, 6, 1, !0, hcsdesign.engine3D.scene), _ = 0; g > _; _++) {
                        var v = y.clone();
                        v.position.x = 3 + _ * m, v.position.z = 0, v.position.y = 45, v.parent = f
                    }
                    y.dispose(), f = BABYLON.Mesh.mergeMeshesRec("rail_stick", [f], hcsdesign.engine3D.scene), f.position.x -= u / 2, f.isDecorable = !0, f.parent = s, s.rotation.y = c, s.position.x = h.x, s.position.z = -h.y, s.parent = i
                }
            }
            this.mergeGeometries(i, n, hcsdesign.engine3D.scene), i.isDecorable = !0, i.decorate = this.decorate, i.structure = t, i.parent = e, this.initMaterials(i, n), t.materials = n
        }
        return !1
    }, e.prototype.getDefaultMaterials = function(t) {
        var e = {};
        return e.rails = new hcs.WhiteMaterial("rails", t, {
            factor: .8
        }), e.rail_stick = new hcs.MetalMaterial("rail_stick", t, {
            brillance: .2
        }), e.bas = new hcs.WhiteMaterial("bas", t, {
            factor: .8
        }), e
    }, e.prototype.prepareMaterials = function(t, e) {
        var n = t || {};
        for (var i in e.materials)
            this.materialFactory.copyFromParams(n[i], e.materials[i]);
        return n
    }, e.prototype.initMaterials = function(t, e) {
        for (var n in e)
            t.traverse(function(t) {
                t.name === n && (t.material = e[n])
            })
    }, e.Build = function(e, n, i, o) {
        if (e && 0 !== e.getTotalVertices()) {
            var r = BABYLON.CSG.FromMesh(e),
                i = i || 0,
                s = e.parent.structure.height < 100 ? e.parent.structure.height - 1 : 100,
                s = 100 > o ? o + 1 : 100,
                a = BABYLON.Mesh.ExtrudeNewMesh("hopper_temp", n.points, null, {
                    amount: s
                }, hcsdesign.engine3D.scene);
            if (!a)
                return e;
            a.position.y += i, a.parent = e.parent, n.material = n.material || t._commonHopperMaterial, a.subMeshes[0].objectInstance = n;
            var l = BABYLON.CSG.FromMesh(a);
            r.subtractInPlace(l);
            var h = r.toMesh("room_global", e.material, hcsdesign.engine3D.scene, !0);
            return h.parent = e.parent, hcsdesign.getComponentByName("RoomComponent3D").replaceRoom(e, h), 0 != i && h.subMeshes.splice(h.subMeshes.length - 1, 1), h.isDecorable = !0, h.parent.roomMesh = h, a.dispose(), h
        }
    }, e.Debug = function() {
        var t = BABYLON.Mesh.CreateSphere("sphere", 1, 40, hcsdesign.engine3D.scene),
            e = BABYLON.Mesh.CreateBox("box", 40, hcsdesign.engine3D.scene);
        t.position.y += 51, e.position.y += 25;
        var n = BABYLON.CSG.FromMesh(t),
            i = BABYLON.CSG.FromMesh(e),
            o = new BABYLON.MultiMaterial("multiMat", hcsdesign.engine3D.scene),
            r = new BABYLON.StandardMaterial("mat0", hcsdesign.engine3D.scene),
            s = new BABYLON.StandardMaterial("mat1", hcsdesign.engine3D.scene);
        r.diffuseColor.copyFromFloats(.8, .2, .2), r.backFaceCulling = !1, s.diffuseColor.copyFromFloats(.2, .8, .2), s.backFaceCulling = !1, o.subMaterials.push(r, s);
        var a = i.subtract(n),
            l = a.toMesh("csg", o, hcsdesign.engine3D.scene, !0);
        l.position = new BABYLON.Vector3(-100, 0, 0), a = n.subtract(i), l = a.toMesh("csg2", o, hcsdesign.engine3D.scene, !0), l.position = new BABYLON.Vector3(100, 0, 0), a = n.intersect(i), l = a.toMesh("csg3", o, hcsdesign.engine3D.scene, !0), l.position = new BABYLON.Vector3(0, 0, 100)
    }, e
}();
var GeneralOptionComponent2D = function() {
    var t = function(t) {
        BaseComponent2D.call(this, t, "GeneralOptionComponent2D")
    };
    return t.prototype = Object.create(BaseComponent2D.prototype), t.prototype.initialize = function() {
        this.priority = 0, this.startListening(), this.gridComp = hcsdesign.getComponentByName("GridComponent2D"), this.roomComp = hcsdesign.getComponentByName("RoomComponent2D"), this.wallComp = hcsdesign.getComponentByName("WallComponent2D")
    }, t.prototype.startListening = function() {
        this.stopListening(), document.addEventListener("hcs.engine2D.contextMenu.generalOption.propertyChange", this.myBind.onPropertyChange, !1), document.addEventListener("hcs.request.2Doptions", this.myBind.onRequestPanel, !1), document.addEventListener("hcs.contextChanged", this.myBind.onContextChange, !1), this._listening = !0, this._injectMenu()
    }, t.prototype.stopListening = function() {
        this.initBindForThisInstance(), document.removeEventListener("hcs.engine2D.contextMenu.generalOption.propertyChange", this.myBind.onPropertyChange, !1), document.removeEventListener("hcs.request.2Doptions", this.myBind.onRequestPanel, !1), document.removeEventListener("hcs.contextChanged", this.myBind.onContextChange, !1), this._listening = !1, this._removeMenu()
    }, t.prototype.initBindForThisInstance = function() {
        if (this.myBind)
            return this;
        var t = this;
        this.myBind = {};
        for (var e in this.handlers)
            (function() {
                var n = t.handlers[e];
                t.myBind[e] = function(e) {
                    n.call(t, e)
                }
            })();
        return this
    }, t.prototype.openGeneralOptionPanel = function() {
        var t = hcsdesign.engine2D;
        t.setMode(t.MODE_CONTEXTMENU), hcs.UI.ContextMenu.show({
            title: _("General Settings")
        }, [{
            title: "Tab 1",
            content: this._getPanelParam()
        }], [{
            label: _("Ok"),
            action: "hcs.engine2D.contextMenu.close"
        }], 0)
    }, t.prototype._getPanelParam = function() {
        var t = [];
        return this.gridComp && t.push({
            label: _("display grid"),
            type: "checkbox",
            value: this.gridComp.displayGrid,
            eventParams: {
                cast: "boolean",
                property: "displayGrid",
                eventName: "hcs.engine2D.contextMenu.generalOption.propertyChange"
            }
        }), this.roomComp && t.push({
            label: _("display room name"),
            type: "checkbox",
            value: this.roomComp.displayRoomName,
            eventParams: {
                cast: "boolean",
                property: "displayRoomName",
                eventName: "hcs.engine2D.contextMenu.generalOption.propertyChange"
            }
        }), this.wallComp && t.push({
            label: _("display mesure"),
            type: "checkbox",
            value: this.wallComp.displayMesure,
            eventParams: {
                cast: "boolean",
                property: "displayMesure",
                eventName: "hcs.engine2D.contextMenu.generalOption.propertyChange"
            }
        }), t
    }, t.prototype._injectMenu = function() {
        hcsdesign.getComponentByName("TopMenuComponent") && hcsdesign.getComponentByName("TopMenuComponent").menu.json.length && (this._removeMenu(), setTimeout(function() {
            ujs.notify("hcs.menu.top.add", {
                item: {
                    id: "2D-options",
                    title: _("2D options"),
                    action: "hcs.request.2Doptions",
                    index: 2
                },
                menuPath: "toolbarOption"
            })
        }, 0))
    }, t.prototype._removeMenu = function() {
        ujs.notify("hcs.menu.top.delete", {
            id: "2D-options"
        })
    }, t.prototype.handlers = {
        onRequestPanel: function() {
            ujs.notify("hcs.menu.top.deselect"), this.openGeneralOptionPanel()
        },
        onPropertyChange: function(t) {
            var e = t.property,
                n = t.value;
            switch (e) {
                case "displayMesure":
                    this.wallComp && (this.wallComp.displayMesure = n);
                    break;
                case "displayRoomName":
                    this.roomComp && (this.roomComp.displayRoomName = n);
                    break;
                case "displayGrid":
                    this.gridComp && (this.gridComp.displayGrid = n)
            }
            hcsdesign.engine2D.requestStaticDraw()
        }
    }, t
}();
ObjectStructure = function() {
    var t = 0,
        e = function(e, n) {
            BaseStructure.call(this, "Object_" + t++), Logger.warning("TODO : retravailler constructeur de objectStructure");
            var n = n || {};
            this.objectId = e || 0, this.position = n.position || new BABYLON.Vector3(0, 0, 0), this.rotation = n.rotation || new BABYLON.Vector3(0, 0, 0), this.scaling = n.scaling || new BABYLON.Vector3(1, 1, 1), this.modelRotation = n.modelRotation || new BABYLON.Vector3(0, 0, 0), this.preferredYAngle = n.preferredYAngle, this.objectInstance = null, this.programmableInstance = null, this.filename = null, this.builderId = null, this.customData = {}
        };
    return e.prototype = new BaseStructure, e.prototype.serialize = function() {
        if (!this.isDeleted) {
            var t, e = {
                "class": {
                    name: "ObjectStructure"
                }
            };
            return this.objectInstance && (t = this.objectInstance.parent, this.objectInstance.changeFrame(this.objectInstance.getFloor())), ujs.serializeObject(this, e, ["objectId", "customData", "builderId", "filename", "baseUrl", "position", "rotation", "scaling", "programmableInstance"], ["group"]), t && (this.objectInstance.changeFrame(t), this.objectInstance.getFloor().markAsDirty()), e
        }
    }, e.prototype.deserialize = function(t) {
        return ujs.deserializeObject(t, this, ["objectId", "customData", "builderId", "filename", "baseUrl", "position", "rotation", "scaling", "programmableInstance"]), this
    }, e.Deserialize = function(t) {
        var n = new e;
        return n.deserialize(t), n
    }, e.prototype.checkCoherence = function(t) {
        (Math.abs(this.position.x) > 5e3 || Math.abs(this.position.z) > 5e3) && t.removeElement("objects", this), this.programmableInstance || t.removeElement("objects", this)
    }, e.prototype.clone = function() {
        var t = this.serialize();
        return e.Deserialize(t)
    }, e.prototype.getAvailableProperties = function() {
        var t = [];
        return null !== this.programmableInstance && (t = this.programmableInstance.getAvailableProperties(this)), t
    }, e.prototype.getMagnetismCollider = function() {
        return void 0 !== this.magnetismCollider ? this.magnetismCollider : void 0 !== this.params.magnetismCollider ? this.params.magnetismCollider : hcs.Constants.MAGNETISM.DEFAULT
    }, e.prototype.animate = function(t, e) {
        null !== this.programmableInstance && this.programmableInstance.animate && this.programmableInstance.animate(t, e)
    }, e.prototype.getProperty = function(t) {
        if (this.programmableInstance) {
            var e = "get" + t + "Param";
            if (this.programmableInstance[e]) {
                var n = this.programmableInstance[e].call(this);
                if (n)
                    return ujs.getProperty(this.programmableInstance, n)
            }
        }
        return 0
    }, e.prototype.changeProperty = function(t, e) {
        if (this.programmableInstance) {
            var n = "get" + t + "Param";
            if (this.programmableInstance[n]) {
                var i = this.programmableInstance[n].call(this);
                i && (ujs.setProperty(this, i, e), ujs.setProperty(this.programmableInstance, i, e))
            }
        }
    }, e
}();
var hcs = window.hcs || {};
hcs.Programmable = function() {
    var t, e = function(e, n, i) {
        this.params = {}, this.mergeParams(i), this.materials = null, this.structure = n, n && (this.magnetismCollider = this.structure.magnetismCollider), this.id = 0, this.async = !1, this.objectName = "Programmable", t = this
    };
    return e.prototype.getDefaultMaterials = function() {
        return {}
    }, e.prototype.decorate = function(t, e) {
        var n = e.pickedMesh.material;
        return this.traverse(function(n) {
            n.name === e.pickedMesh.name && (t.backFaceCulling = n.material.backFaceCulling, n.material = t)
        }), this.structure.programmableInstance.materials[e.pickedMesh.name] = t, n
    }, e.prototype.animate = function() {
        Logger.message("No animation here :(")
    }, e.prototype.importDAE = function() {
        return console.warn("Can't use DAE with BABYLON"), null
    }, e.prototype.importBabylon = function(t, e) {
        var n = t.split("/"),
            i = n[n.length - 1],
            o = i.split(".")[0];
        delete n[n.length - 1], n = n.join("/"), -1 === n.indexOf("http://") && -1 == n.indexOf("https://") && (n = hcs.Assets.globalPath + n);
        var r = new BABYLON.Mesh(o, hcsdesign.engine3D.scene);
        return r.isVisible = !1, BABYLON.SceneLoader.ImportMesh("", n, i, hcsdesign.engine3D.scene, function(t) {
            for (var n = 0, i = t.length; i > n; n++)
                t[n].parent = r, t[n].receiveShadows = !0, hcsdesign.engine3D.castShadows(t[n]);
            e && e(r)
        }), r
    }, e.prototype.importOBJ = function() {
        return console.warn("Can't load OBJ file with BABYLON"), null
    }, e.prototype.mergeParams = function(t) {
        var t = t || {};
        this.params = this.getDefaultParams(), this.params = ujs.mergeObjects(this.params, t, !0)
    }, e.prototype.getDefaultParams = function() {
        return {}
    }, e.prototype.getParamType = function(t) {
        var e = t.split(".").slice(-1)[0];
        switch (e) {
            case "stretched_texture":
            case "rounded":
            case "active":
                return "boolean"
        }
        var n = this.getDefaultParams(),
            i = typeof ujs.getProperty(n, t);
        switch (i) {
            case "boolean":
            case "string":
            case "number":
                return i;
            case "undefined":
            default:
                return console.warn('enable to determine the type of the param "' + t + '" in the programmable ' + this.objectName), "number"
        }
    }, e.prototype.validateParam = function() {
        var t = function(t, e) {
                if (e = e || {}, t = t.replace(/\s/g, ""), !/^-?\d*\.?\d*]*$/.exec(t) || !/\d/.exec(t)) {
                    if (!(t = /-?\d+\.?\d*]*/.exec(t)))
                        return e["default"] || null;
                    t = t[0]
                }
                var n = +t;
                if (e.round) {
                    var i = e.round === !0 ? 1 : e.round;
                    n = Math.round(n * i) / i
                }
                return "number" == typeof e.max && (n = Math.min(n, e.max)), "number" == typeof e.min && (n = Math.max(n, e.min)), n
            },
            e = function(t) {
                return !!+t << 0
            },
            n = function(e, n) {
                if (n = n || {}, n.intList = n.intList || n.intListSeparator || n.inListOptions, n.intList) {
                    for (var i = n.intListSeparator || ",", o = ("" + e).split(i), r = o.length; r--;)
                        if ("undefined" == typeof(o[r] = t(o[r], n.inListOptions)) || null == o[r])
                            return null;
                    e = o.join(i)
                }
                return e
            };
        return function(i, o) {
            var r = null,
                s = null;
            switch ("params" == i.split(".")[0] && (i = i.split(".").slice(1).join(".")), r = this.getParamType(i), "string" != typeof r && (s = r, r = r.type), r) {
                case "boolean":
                    return e(o, s);
                case "string":
                    return n(o, s);
                default:
                case "number":
                    return t(o, s)
            }
        }
    }(), e.prototype.prepareMaterials = function(t) {
        return this.materials = t, t
    }, e.prototype.applyShadow = function() {
        console.warn("Not used in BABYLON")
    }, e.createInstance = function(t, e, n, i, o, r, s) {
        var a = t.split(".");
        a.length = a.length - 1;
        var e = e || {},
            l = function() {
                var t = ujs.getProperty(hcs.Programmable, a.join(".")),
                    r = e.params || e,
                    l = new t(s, i, r);
                l.materials = n || l.getDefaultMaterials(hcsdesign.engine3D.scene);
                e.id;
                o(l)
            },
            h = a.length,
            c = function(t, e, n) {
                if (t >= h)
                    return void l();
                var i = n || hcs.Constants.PROGRAMMABLE_PATH;
                HTMLHelper.addScript([i, "/", e, ".js"].join(""), void 0, function() {
                    var i = e + "/" + a[t + 1];
                    c(t + 1, i, n)
                })
            };
        c(0, a[0], r)
    }, e.prototype.serialize = function() {
        var t = {
            "class": {
                name: "hcs.Programmable"
            }
        };
        return ujs.serializeObject(this, t, ["objectName", "id", "params", "materials"]), t
    }, e.prototype.deserialize = function(t) {
        return ujs.deserializeObject(t, this, ["objectName", "id", "params", "materials"]), this
    }, e.Deserialize = function(t) {
        var n = new e(hcsdesign.engine3D, null, t.params);
        return n.deserialize(t), n
    }, e.prototype.getAvailableProperties = function() {
        var t = this.generateFormForObject("params", this);
        if (this.localizeAndSortParams) {
            for (var e = this.localizeAndSortParams(), n = t.length - 1; n >= 0; n--) {
                var i = t[n].name ? t[n].name.replace("params.", "") : void 0,
                    o = i.split(".")[0];
                e.invisible && (e.invisible.hasOwnProperty(i) || e.invisible.hasOwnProperty(o)) ? delete t[n] : e.basic && e.basic.hasOwnProperty(i) ? t[n].label = t[n].label ? e.basic[i] : "" : e.advanced && e.advanced.hasOwnProperty(i) ? (t[n].label = t[n].label ? e.advanced[i] : "", t[n]["class"] = "hidden advancedParams") : delete t[n]
            }
//            Object.keys(e.advanced).length > 0 && t.push({
//                type: "html",
//                html: "<a href='' onclick='hcs.Programmable.toggleVisible();return false;' style='display:none'>" + _("show advanced params") + "</a>"
//            })
        }
        return t
    }, e.prototype.generateFormForObject = function(t, e, n, i, o) {
        var n = n || [],
            r = null,
            i = i || "",
            o = o || 0;
        if (e[t] instanceof Object) {
            i = i ? i + "." + t : t, "params" != t && (r = {
                name: i,
                label: t,
                type: "separator",
                html: t
            }, n.push(r)), o++;
            for (var s in e[t])
                this.generateFormForObject(s, e[t], n, i, o);
            n.push({
                type: "separator",
                name: i
            })
        } else {
            var a = i ? i + "." + t : t,
                l = this.getParamType(a.split(".").slice(1).join("."));
            l = l.type ? l : {
                type: l
            };
            var h, c;
            switch (l.type) {
                case "boolean":
                    h = "checkbox", c = !!e[t];
                    break;
                case "number":
                    h = "number", c = {
                        value: +e[t]
                    }, "undefined" != typeof l.max && (c.max = l.max), "undefined" != typeof l.min && (c.min = l.min), "undefined" != typeof l.round && (c.step = l.round);
                    break;
                default:
                    h = "text", c = e[t]
            }
            r = {
                name: a,
                label: new Array(2 * o).join("&nbsp") + t,
                type: h,
                value: c,
                eventParams: {
                    eventName: "hcs.contextMenu.propertyChanged",
                    property: a
                },
                id: a.split(".").join("-")
            }, n.push(r)
        }
        return n
    }, e.prototype.createPoignee = function() {
        return console.warn("Can't use it with BABYLON"), null
    }, e.prototype.getWidthParam = function() {
        return this.params.width ? "params.width" : !1
    }, e.prototype.getHeightParam = function() {
        return this.params.height ? "params.height" : !1
    }, e.prototype.getDepthParam = function() {
        return this.params.depth ? "params.depth" : !1
    }, e.prototype.generateMissingFacesUvs = function() {
        return console.warn("Can't use it with BABYLON"), null
    }, e
}(), hcs.Programmable.toggleVisible = function() {
    for (var t = document.querySelectorAll(".advancedParams"), e = 0; e < t.length; e++)
        t[e].classList.toggle("hidden")
};
var DecorationComponent3D = function() {
    function t(t) {
        "object" == typeof t && ("keydown" == t.type && 27 != t.keyCode || "mousedown" == t.type && 0 == t.button) || (n = null, ujs.notify("hcs.menu.main.deselect"), hcsdesign.engine3D.mode = hcsdesign.engine3D.MODE_NORMAL, hcsdesign.engine3D.canvas.classList.remove("brush"))
    }
    var e, n = null,
        i = 0,
        o = function(t) {
            BaseComponent3D.call(this, t, "DecorationComponent3D"), this.tabs = [], window.ejecta || (this.tabs = document.getElementsByClassName("menu-tab")), e = this, this.historycmp = null, this.PAINTACTION = 0, this.setupHistory(), this.standardMaps = ["map", "bumpMap", "normalMap", "specularMap"], document.addEventListener("hcs.core.structure.loaded", this.initializeLastColor.bind(this), !1)
        };
    return o.prototype = new BaseComponent3D, o.prototype.initializeLastColor = function() {
        var t = this.core.structure.lastMaterialsUsed.length > 0 ? "" : " hidden",
            e = this.core.structure.lastMaterialsUsed.length > 0 ? this.cleanJson(this.core.structure.lastMaterialsUsed) : [],
            n = {
                id: "last_colors",
                title: _("最近使用颜色"),
                index: 5,
                addClass: "last-color-item" + t,
                layout: "layout-table-60",
                items: e
            };
        ujs.notify("hcs.menu.main.add", {
            item: n,
            menuPath: /*"decorate3D",*/ "furnishing3D",
            position: 0
        })
    }, o.prototype.destroy = function() {
        ujs.notify("hcs.menu.main.remove", {
            item: "furnishing3D"
        }), ujs.notify("hcs.menu.main.remove", {
            item: "decorate3D"
        })
    }, o.prototype.cleanJson = function(t) {
        for (var e in t)
            t.hasOwnProperty(e) && (t[e] instanceof Object ? t[e] = this.cleanJson(t[e]) : "string" == typeof t[e] && -1 !== t[e].indexOf("http://") && (t[e] = GlobalHelper.stripDomainUrl(t[e], "hcsdesign.")));
        return t
    }, o.prototype.initialize = function() {
        var t = this,
            e = "http://v2.hcsdesign.fr/data/menu.content.compiled.json";
        window.ejecta && (e = "Wanaplan/" + e);
        var n = function() {
            ujs.ajax({
                url: e,
                method: "GET",
                params: ["t=", Math.round(100 * Math.random())].join(""),
                success: function(e) {
                    var n = JSON.parse(e);
                    n = t.cleanJson(n), ujs.notify("hcs.menu.main.add", {
                        item: n,
                        menuPath: "decorate3D",
                        position: 0
                    })
                }
            })
        };
        ujs.ajax({
            url: hcs.Constants.TEXTURES_FILE,
            method: "GET",
            params: ["t=", Math.round(100 * Math.random())].join(""),
            success: function(e) {
                try {
                    var i = JSON.parse(e);
                    i = t.cleanJson(i), ujs.notify("hcs.menu.main.add", {
                        item: i,
                        menuPath: "decorate3D",
                        position: 0
                    })
                } catch (o) {
                    Logger.message("BAD JSON FILE"), n()
                }
            },
            onerror: n
        })
    }, o.prototype.startListening = function() {
        document.addEventListener("hcs.request.changeEngine", this.onChangeEngine, !1), document.addEventListener("hcs.engine3D.paint", this.onPaintHandler, !1), document.addEventListener("hcs.engine3D.click.collided", this.onClick, !1), document.addEventListener("keydown", t, !1)
    }, o.prototype.stopListening = function() {
        document.removeEventListener("hcs.request.changeEngine", this.onChangeEngine, !1), document.removeEventListener("hcs.engine3D.paint", this.onPaintHandler), document.removeEventListener("hcs.engine3D.click.collided", this.onClick, !1), document.removeEventListener("keydown", t)
    }, o.prototype.onContextChanged = function(e) {
        if ("3D" == e) {
            if (!this.initialized) {
                this.startListening();
                for (var n = 0, i = this.tabs.length; i > n; n++)
                    this.tabs[n].addEventListener("click", t, !1);
                this.initialized = !0
            }
        } else if (this.initialized) {
            for (var n = 0, i = this.tabs.length; i > n; n++)
                this.tabs[n].removeEventListener("click", t, !1);
            this.initialized = !1
        }
    }, o.prototype.onPaintHandler = function(t) {
        e.core.helpBubbleManager.display("hcs.3d.paint");
        var i = t.params || {};
        n = {
            title: t.title,
            action: "hcs.engine3D.paint",
            params: i,
            texture: !0
        }, hcsdesign.engine3D.mode = e.engine3D.MODE_PAINT, hcsdesign.engine3D.canvas.classList.add("brush"), ujs.notify("hcs.engine3D.brushReady")
    }, o.prototype.updateLastItemMenu = function(t) {
        for (var e = !1, n = 0; n < hcsdesign.structure.lastMaterialsUsed.length; n++)
            t.title == hcsdesign.structure.lastMaterialsUsed[n].title && (e = !0);
        e === !1 && (hcsdesign.structure.lastMaterialsUsed.push(ujs.cloneObject(t)), ujs.notify("hcs.menu.main.replace", {
            item: {
                id: "last_colors",
                addClass: "last-color-item",
                items: hcsdesign.structure.lastMaterialsUsed
            },
            merge: !0
        }, !0)), this.core.structure.lastMaterialsUsed.length > 21 && this.core.structure.lastMaterialsUsed.splice(0, this.core.structure.lastMaterialsUsed.length - 21)
    }, o.prototype.onClick = function(o) {
        if (null != n) {
            var r = hcs.MaterialFactory.ImportWNPMaterial(n.params);
            r.isDefault = !1;
            var s = o.collided.pickedMesh.getTopLevelObject();
            if (s.isDecorable) {
                if (s.decorate)
                    var a = s.decorate(r, o.collided);
                else
                    var a = e.decorate(o.collided.pickedMesh, r, o.collided);
                r.backFaceCulling = a ? a.backFaceCulling : !1
            }
            e.updateLastItemMenu(n), ujs.notify("hcs.request.historyAction", {
                component: e,
                object: s,
                params: {
                    oldMaterial: a,
                    newMaterial: r,
                    collided: o.collided
                },
                action: e.PAINTACTION
            }), n && e.updateLastItemMenu(n), ujs.notify("hcs.engine3D.decorate", {
                material: r
            }), 1 >= i && t()
        }
    }, o.prototype.decorate = function(t, e) {
        t.material = e
    }, o.prototype.applyMaterial = function(t, n, i) {
        t.decorate ? t.decorate(n, i) : e.decorate(i.pickedMesh, n, i)
    }, o.prototype.getMaterial = function() {
        return material
    }, o.prototype.addHistory = function(t, e, n) {
        this.historycmp && this.historycmp.actionDone(t, e, n, this)
    }, o.prototype.undoPaint = function(t, n) {
        e.historyPaint(t, n, n.oldMaterial)
    }, o.prototype.redoPaint = function(t, n) {
        e.historyPaint(t, n, n.newMaterial)
    }, o.prototype.historyPaint = function(t, n, i) {
        e.applyMaterial(t, i, n.collided), ujs.notify("hcs.request.saveHistory")
    }, o.prototype.setupHistory = function() {
        this.historycmp = this.core.getComponentByName("HistoryComponent"), this.historycmp && this.historycmp.registerAction(this.PAINTACTION, this.undoPaint, this.redoPaint, this)
    }, o
}();
var LuxensComponent3D = function() {
    var t = function(t) {
        BaseComponent3D.call(this, t, "LuxensComponent3D")
    };
    t.prototype = new BaseComponent3D, t.prototype.initialize = function() {
        _item = {
            title: _("家具颜色"),
            id: "luxens",
            items: e,
            layout: "layout-table-26"
        }, ujs.notify("hcs.menu.main.add", {
            item: _item,
            menuPath: /*"decorate3D",*/ "furnishing3D",
            position: 10
        })
    }, t.getLuxens = function() {
        return e
    };
    var e = [{
        texture: !0,
        title: "Blanc 1",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "hcs.WhiteMaterial",
            color: {
                r: 1,
                g: 1,
                b: 1
            }
        }
    }, {
        texture: !0,
        title: "Blanc 2",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "hcs.WhiteMaterial",
            color: {
                r: .96,
                g: .96,
                b: .96
            }
        }
    }, {
        texture: !0,
        title: "Blanc3",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "hcs.WhiteMaterial",
            color: {
                r: .9,
                g: .9,
                b: .9
            }
        }
    }, {
        texture: !0,
        title: "Noir 1",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: 0,
                g: 0,
                b: 0
            }
        }
    }, {
        texture: !0,
        title: "Noir 2",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .05,
                g: .05,
                b: .05
            }
        }
    }, {
        texture: !0,
        title: "Noir 3",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .07,
                g: .07,
                b: .07
            }
        }
    }, {
        texture: !0,
        title: "Blanc calcaire 1",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .85,
                g: .85,
                b: .82
            }
        }
    }, {
        texture: !0,
        title: "Blanc calcaire 2",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .91,
                g: .9,
                b: .82
            }
        }
    }, {
        texture: !0,
        title: "Blanc calcaire 3",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .92,
                g: .93,
                b: .89
            }
        }
    }, {
        texture: !0,
        title: "Blanc calcaire 4",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .92,
                g: .93,
                b: .89
            }
        }
    }, {
        texture: !0,
        title: "Blanc calcaire 5",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .88,
                g: .89,
                b: .86
            }
        }
    }, {
        texture: !0,
        title: "Blanc calcaire 6",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .91,
                g: .88,
                b: .84
            }
        }
    }, {
        texture: !0,
        title: "Blanc ivoire 1",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .85,
                g: .8,
                b: .71
            }
        }
    }, {
        texture: !0,
        title: "Blanc ivoire 2",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .93,
                g: .87,
                b: .77
            }
        }
    }, {
        texture: !0,
        title: "Blanc ivoire 3",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .91,
                g: .87,
                b: .76
            }
        }
    }, {
        texture: !0,
        title: "Blanc ivoire 4",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .94,
                g: .91,
                b: .83
            }
        }
    }, {
        texture: !0,
        title: "Blanc ivoire 5",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .91,
                g: .89,
                b: .84
            }
        }
    }, {
        texture: !0,
        title: "Blanc ivoire 6",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .93,
                g: .89,
                b: .76
            }
        }
    }, {
        texture: !0,
        title: "Blanc coquille 1",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .84,
                g: .78,
                b: .73
            }
        }
    }, {
        texture: !0,
        title: "Blanc coquille 2",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .86,
                g: .83,
                b: .77
            }
        }
    }, {
        texture: !0,
        title: "Blanc coquille 3",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .91,
                g: .86,
                b: .78
            }
        }
    }, {
        texture: !0,
        title: "Blanc coquille 4",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .9,
                g: .86,
                b: .81
            }
        }
    }, {
        texture: !0,
        title: "Blanc coquille 5",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .93,
                g: .89,
                b: .84
            }
        }
    }, {
        texture: !0,
        title: "Blanc coquille 6",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .96,
                g: .88,
                b: .75
            }
        }
    }, {
        texture: !0,
        title: "Gris galet 1",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .31,
                g: .32,
                b: .35
            }
        }
    }, {
        texture: !0,
        title: "Gris galet 2",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .39,
                g: .38,
                b: .41
            }
        }
    }, {
        texture: !0,
        title: "Gris galet 3",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .49,
                g: .49,
                b: .5
            }
        }
    }, {
        texture: !0,
        title: "Gris galet 4",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .58,
                g: .62,
                b: .63
            }
        }
    }, {
        texture: !0,
        title: "Gris galet 5",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .7,
                g: .71,
                b: .72
            }
        }
    }, {
        texture: !0,
        title: "Gris galet 6",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .78,
                g: .79,
                b: .8
            }
        }
    }, {
        texture: !0,
        title: "Gris zingué 1",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .2,
                g: .22,
                b: .23
            }
        }
    }, {
        texture: !0,
        title: "Gris zingué 2",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .29,
                g: .33,
                b: .36
            }
        }
    }, {
        texture: !0,
        title: "Gris zingué 3",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .29,
                g: .36,
                b: .43
            }
        }
    }, {
        texture: !0,
        title: "Gris zingué 4",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .47,
                g: .51,
                b: .54
            }
        }
    }, {
        texture: !0,
        title: "Gris zingué 5",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .6,
                g: .65,
                b: .69
            }
        }
    }, {
        texture: !0,
        title: "Gris zingué 6",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .69,
                g: .73,
                b: .78
            }
        }
    }, {
        texture: !0,
        title: "Gris smoke 1",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .26,
                g: .27,
                b: .27
            }
        }
    }, {
        texture: !0,
        title: "Gris smoke 2",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .36,
                g: .37,
                b: .33
            }
        }
    }, {
        texture: !0,
        title: "Gris smoke 3",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .4,
                g: .42,
                b: .36
            }
        }
    }, {
        texture: !0,
        title: "Gris smoke 4",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .47,
                g: .51,
                b: .45
            }
        }
    }, {
        texture: !0,
        title: "Gris smoke 5",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .58,
                g: .62,
                b: .59
            }
        }
    }, {
        texture: !0,
        title: "Gris smoke 6",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .73,
                g: .75,
                b: .74
            }
        }
    }, {
        texture: !0,
        title: "Gris gris 1",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .08,
                g: .08,
                b: .08
            }
        }
    }, {
        texture: !0,
        title: "Gris gris 2",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .4,
                g: .41,
                b: .39
            }
        }
    }, {
        texture: !0,
        title: "Gris gris 3",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .52,
                g: .52,
                b: .5
            }
        }
    }, {
        texture: !0,
        title: "Gris gris 4",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .59,
                g: .56,
                b: .51
            }
        }
    }, {
        texture: !0,
        title: "Gris gris 5",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .65,
                g: .64,
                b: .57
            }
        }
    }, {
        texture: !0,
        title: "Gris gris 6",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .79,
                g: .81,
                b: .77
            }
        }
    }, {
        texture: !0,
        title: "Gris poivré 1",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .12,
                g: .11,
                b: .1
            }
        }
    }, {
        texture: !0,
        title: "Gris poivré 2",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .3,
                g: .27,
                b: .26
            }
        }
    }, {
        texture: !0,
        title: "Gris poivré 3",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .41,
                g: .4,
                b: .37
            }
        }
    }, {
        texture: !0,
        title: "Gris poivré 4",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .57,
                g: .53,
                b: .54
            }
        }
    }, {
        texture: !0,
        title: "Gris poivré 5",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .69,
                g: .67,
                b: .67
            }
        }
    }, {
        texture: !0,
        title: "Gris poivré 6",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .82,
                g: .78,
                b: .75
            }
        }
    }, {
        texture: !0,
        title: "Gris doré 1",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .38,
                g: .33,
                b: .27
            }
        }
    }, {
        texture: !0,
        title: "Gris doré 2",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .41,
                g: .38,
                b: .31
            }
        }
    }, {
        texture: !0,
        title: "Gris doré 3",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .53,
                g: .45,
                b: .36
            }
        }
    }, {
        texture: !0,
        title: "Gris doré 4",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .56,
                g: .52,
                b: .46
            }
        }
    }, {
        texture: !0,
        title: "Gris doré 5",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .64,
                g: .58,
                b: .48
            }
        }
    }, {
        texture: !0,
        title: "Gris doré 6",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .8,
                g: .77,
                b: .72
            }
        }
    }, {
        texture: !0,
        title: "Brun taupe 1",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .27,
                g: .24,
                b: .23
            }
        }
    }, {
        texture: !0,
        title: "Brun taupe 2",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .35,
                g: .29,
                b: .27
            }
        }
    }, {
        texture: !0,
        title: "Brun taupe 3",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .46,
                g: .41,
                b: .37
            }
        }
    }, {
        texture: !0,
        title: "Brun taupe 4",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .53,
                g: .47,
                b: .46
            }
        }
    }, {
        texture: !0,
        title: "Brun taupe 5",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .67,
                g: .57,
                b: .56
            }
        }
    }, {
        texture: !0,
        title: "Brun taupe 6",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .81,
                g: .75,
                b: .75
            }
        }
    }, {
        texture: !0,
        title: "Brun gatsby 1",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .25,
                g: .18,
                b: .19
            }
        }
    }, {
        texture: !0,
        title: "Brun gatsby 2",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .3,
                g: .22,
                b: .22
            }
        }
    }, {
        texture: !0,
        title: "Brun gatsby 3",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .43,
                g: .31,
                b: .27
            }
        }
    }, {
        texture: !0,
        title: "Brun gatsby 4",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .61,
                g: .5,
                b: .43
            }
        }
    }, {
        texture: !0,
        title: "Brun gatsby 5",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .73,
                g: .63,
                b: .54
            }
        }
    }, {
        texture: !0,
        title: "Brun gatsby 6",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .85,
                g: .78,
                b: .68
            }
        }
    }, {
        texture: !0,
        title: "Brun brun 1",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .27,
                g: .22,
                b: .18
            }
        }
    }, {
        texture: !0,
        title: "Brun brun 2",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .42,
                g: .31,
                b: .22
            }
        }
    }, {
        texture: !0,
        title: "Brun brun 3",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .47,
                g: .39,
                b: .31
            }
        }
    }, {
        texture: !0,
        title: "Brun brun 4",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .67,
                g: .57,
                b: .42
            }
        }
    }, {
        texture: !0,
        title: "Brun brun 5",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .81,
                g: .69,
                b: .52
            }
        }
    }, {
        texture: !0,
        title: "Brun brun 6",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .83,
                g: .75,
                b: .62
            }
        }
    }, {
        texture: !0,
        title: "Brun argileux 1",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .27,
                g: .25,
                b: .24
            }
        }
    }, {
        texture: !0,
        title: "Brun argileux 2",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .31,
                g: .29,
                b: .2
            }
        }
    }, {
        texture: !0,
        title: "Brun argileux 3",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .53,
                g: .42,
                b: .23
            }
        }
    }, {
        texture: !0,
        title: "Brun argileux 4",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .57,
                g: .51,
                b: .36
            }
        }
    }, {
        texture: !0,
        title: "Brun argileux 5",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .71,
                g: .68,
                b: .58
            }
        }
    }, {
        texture: !0,
        title: "Brun argileux 6",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .81,
                g: .79,
                b: .69
            }
        }
    }, {
        texture: !0,
        title: "Brun chocolat 1",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .22,
                g: .17,
                b: .14
            }
        }
    }, {
        texture: !0,
        title: "Brun chocolat 2",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .32,
                g: .21,
                b: .16
            }
        }
    }, {
        texture: !0,
        title: "Brun chocolat 3",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .36,
                g: .21,
                b: .15
            }
        }
    }, {
        texture: !0,
        title: "Brun chocolat 4",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .5,
                g: .35,
                b: .25
            }
        }
    }, {
        texture: !0,
        title: "Brun chocolat 5",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .8,
                g: .66,
                b: .49
            }
        }
    }, {
        texture: !0,
        title: "Brun chocolat 6",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .91,
                g: .81,
                b: .71
            }
        }
    }, {
        texture: !0,
        title: "Brun havane 1",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .16,
                g: .12,
                b: .12
            }
        }
    }, {
        texture: !0,
        title: "Brun havane 2",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .25,
                g: .14,
                b: .14
            }
        }
    }, {
        texture: !0,
        title: "Brun havane 3",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .5,
                g: .28,
                b: .24
            }
        }
    }, {
        texture: !0,
        title: "Brun havane 4",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .62,
                g: .39,
                b: .29
            }
        }
    }, {
        texture: !0,
        title: "Brun havane 5",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .77,
                g: .5,
                b: .39
            }
        }
    }, {
        texture: !0,
        title: "Brun havane 6",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .88,
                g: .73,
                b: .63
            }
        }
    }, {
        texture: !0,
        title: "Rouge velours 1",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .27,
                g: .12,
                b: .12
            }
        }
    }, {
        texture: !0,
        title: "Rouge velours 2",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .43,
                g: .12,
                b: .16
            }
        }
    }, {
        texture: !0,
        title: "Rouge velours 3",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .48,
                g: .13,
                b: .18
            }
        }
    }, {
        texture: !0,
        title: "Rouge velours 4",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .58,
                g: .22,
                b: .22
            }
        }
    }, {
        texture: !0,
        title: "Rouge velours 5",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .81,
                g: .32,
                b: .31
            }
        }
    }, {
        texture: !0,
        title: "Rouge velours 6",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .85,
                g: .45,
                b: .43
            }
        }
    }, {
        texture: !0,
        title: "Rouge rubis 1",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .25,
                g: .11,
                b: .11
            }
        }
    }, {
        texture: !0,
        title: "Rouge rubis 2",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .4,
                g: .08,
                b: .14
            }
        }
    }, {
        texture: !0,
        title: "Rouge rubis 3",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .6,
                g: .07,
                b: .24
            }
        }
    }, {
        texture: !0,
        title: "Rouge rubis 4",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .64,
                g: .14,
                b: .27
            }
        }
    }, {
        texture: !0,
        title: "Rouge rubis 5",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .75,
                g: .33,
                b: .43
            }
        }
    }, {
        texture: !0,
        title: "Rouge rubis 6",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .89,
                g: .61,
                b: .63
            }
        }
    }, {
        texture: !0,
        title: "Rouge gourmand 1",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .27,
                g: .05,
                b: .09
            }
        }
    }, {
        texture: !0,
        title: "Rouge gourmand 2",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .54,
                g: .02,
                b: .15
            }
        }
    }, {
        texture: !0,
        title: "Rouge gourmand 3",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .65,
                g: 0,
                b: .18
            }
        }
    }, {
        texture: !0,
        title: "Rouge gourmand 4",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .84,
                g: .07,
                b: .2
            }
        }
    }, {
        texture: !0,
        title: "Rouge gourmand 5",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .87,
                g: .15,
                b: .28
            }
        }
    }, {
        texture: !0,
        title: "Rouge gourmand 6",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .99,
                g: .76,
                b: .76
            }
        }
    }, {
        texture: !0,
        title: "Rouge-rouge 1",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .4,
                g: .12,
                b: .12
            }
        }
    }, {
        texture: !0,
        title: "Rouge-rouge 2",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .59,
                g: .06,
                b: .14
            }
        }
    }, {
        texture: !0,
        title: "Rouge-rouge 3",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .65,
                g: 0,
                b: .11
            }
        }
    }, {
        texture: !0,
        title: "Rouge-rouge 4",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .85,
                g: .07,
                b: .09
            }
        }
    }, {
        texture: !0,
        title: "Rouge-rouge 5",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .91,
                g: .16,
                b: .19
            }
        }
    }, {
        texture: !0,
        title: "Rouge-rouge 6",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .99,
                g: .88,
                b: .84
            }
        }
    }, {
        texture: !0,
        title: "Rouge corail 1",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .55,
                g: .12,
                b: .13
            }
        }
    }, {
        texture: !0,
        title: "Rouge corail 2",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .69,
                g: .16,
                b: .21
            }
        }
    }, {
        texture: !0,
        title: "Rouge corail 3",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .74,
                g: .15,
                b: .16
            }
        }
    }, {
        texture: !0,
        title: "Rouge corail 4",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .87,
                g: .24,
                b: .25
            }
        }
    }, {
        texture: !0,
        title: "Rouge corail 5",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .92,
                g: .26,
                b: .19
            }
        }
    }, {
        texture: !0,
        title: "Rouge corail 6",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: 1,
                g: .54,
                b: .45
            }
        }
    }, {
        texture: !0,
        title: "Orange vitaminé 1",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .69,
                g: .21,
                b: .13
            }
        }
    }, {
        texture: !0,
        title: "Orange vitaminé 2",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .82,
                g: .18,
                b: .09
            }
        }
    }, {
        texture: !0,
        title: "Orange vitaminé 3",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: 1,
                g: .23,
                b: .11
            }
        }
    }, {
        texture: !0,
        title: "Orange vitaminé 4",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: 1,
                g: .31,
                b: .16
            }
        }
    }, {
        texture: !0,
        title: "Orange vitaminé 5",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: 1,
                g: .38,
                b: .29
            }
        }
    }, {
        texture: !0,
        title: "Orange vitaminé 6",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: 1,
                g: .81,
                b: .69
            }
        }
    }, {
        texture: !0,
        title: "Orange fusion 1",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .95,
                g: .24,
                b: .07
            }
        }
    }, {
        texture: !0,
        title: "Orange fusion 2",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .81,
                g: .43,
                b: .29
            }
        }
    }, {
        texture: !0,
        title: "Orange fusion 3",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .97,
                g: .37,
                b: .11
            }
        }
    }, {
        texture: !0,
        title: "Orange fusion 4",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: 1,
                g: .39,
                b: .15
            }
        }
    }, {
        texture: !0,
        title: "Orange fusion 5",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: 1,
                g: .55,
                b: .28
            }
        }
    }, {
        texture: !0,
        title: "Orange fusion 6",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: 1,
                g: .65,
                b: .42
            }
        }
    }, {
        texture: !0,
        title: "Orange-orange 1",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .62,
                g: .29,
                b: .11
            }
        }
    }, {
        texture: !0,
        title: "Orange-orange 2",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .76,
                g: .29,
                b: .07
            }
        }
    }, {
        texture: !0,
        title: "Orange-orange 3",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .87,
                g: .38,
                b: .09
            }
        }
    }, {
        texture: !0,
        title: "Orange-orange 4",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: 1,
                g: .45,
                b: .04
            }
        }
    }, {
        texture: !0,
        title: "Orange-orange 5",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: 1,
                g: .56,
                b: .12
            }
        }
    }, {
        texture: !0,
        title: "Orange-orange 6",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: 1,
                g: .74,
                b: .41
            }
        }
    }, {
        texture: !0,
        title: "Orange doré 1",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .73,
                g: .33,
                b: .06
            }
        }
    }, {
        texture: !0,
        title: "Orange doré 2",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .84,
                g: .45,
                b: 0
            }
        }
    }, {
        texture: !0,
        title: "Orange doré 3",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .99,
                g: .48,
                b: .07
            }
        }
    }, {
        texture: !0,
        title: "Orange doré 4",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: 1,
                g: .56,
                b: .15
            }
        }
    }, {
        texture: !0,
        title: "Orange doré 5",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: 1,
                g: .56,
                b: 0
            }
        }
    }, {
        texture: !0,
        title: "Orange doré 6",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: 1,
                g: .82,
                b: .51
            }
        }
    }, {
        texture: !0,
        title: "Jaune solaire 1",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .96,
                g: .52,
                b: .21
            }
        }
    }, {
        texture: !0,
        title: "Jaune solaire 2",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .8,
                g: .54,
                b: .16
            }
        }
    }, {
        texture: !0,
        title: "Jaune solaire 3",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: 1,
                g: .63,
                b: 0
            }
        }
    }, {
        texture: !0,
        title: "Jaune solaire 4",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: 1,
                g: .66,
                b: .22
            }
        }
    }, {
        texture: !0,
        title: "Jaune solaire 5",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: 1,
                g: .74,
                b: .29
            }
        }
    }, {
        texture: !0,
        title: "Jaune solaire 6",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: 1,
                g: .89,
                b: .61
            }
        }
    }, {
        texture: !0,
        title: "Jaune pépite 1",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .67,
                g: .46,
                b: .19
            }
        }
    }, {
        texture: !0,
        title: "Jaune pépite 2",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .77,
                g: .6,
                b: .34
            }
        }
    }, {
        texture: !0,
        title: "Jaune pépite 3",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .92,
                g: .62,
                b: 0
            }
        }
    }, {
        texture: !0,
        title: "Jaune pépite 4",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: 1,
                g: .73,
                b: .2
            }
        }
    }, {
        texture: !0,
        title: "Jaune pépite 5",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: 1,
                g: .78,
                b: .38
            }
        }
    }, {
        texture: !0,
        title: "Jaune pépite 6",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .95,
                g: .88,
                b: .69
            }
        }
    }, {
        texture: !0,
        title: "Jaune louxor 1",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .77,
                g: .55,
                b: .08
            }
        }
    }, {
        texture: !0,
        title: "Jaune louxor 2",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: 1,
                g: .72,
                b: 0
            }
        }
    }, {
        texture: !0,
        title: "Jaune louxor 3",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .94,
                g: .72,
                b: 0
            }
        }
    }, {
        texture: !0,
        title: "Jaune louxor 4",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: 1,
                g: .8,
                b: .19
            }
        }
    }, {
        texture: !0,
        title: "Jaune louxor 5",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: 1,
                g: .9,
                b: .4
            }
        }
    }, {
        texture: !0,
        title: "Jaune louxor 6",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .98,
                g: .86,
                b: .48
            }
        }
    }, {
        texture: !0,
        title: "Jaune-jaune 1",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .56,
                g: .4,
                b: .12
            }
        }
    }, {
        texture: !0,
        title: "Jaune-jaune 2",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .83,
                g: .68,
                b: 0
            }
        }
    }, {
        texture: !0,
        title: "Jaune-jaune 3",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .93,
                g: .69,
                b: 0
            }
        }
    }, {
        texture: !0,
        title: "Jaune-jaune 4",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .94,
                g: .73,
                b: 0
            }
        }
    }, {
        texture: !0,
        title: "Jaune-jaune 5",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .96,
                g: .87,
                b: .32
            }
        }
    }, {
        texture: !0,
        title: "Jaune-jaune 6",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .94,
                g: .91,
                b: .64
            }
        }
    }, {
        texture: !0,
        title: "Jaune anis 1",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .55,
                g: .47,
                b: .14
            }
        }
    }, {
        texture: !0,
        title: "Jaune anis 2",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .71,
                g: .62,
                b: .07
            }
        }
    }, {
        texture: !0,
        title: "Jaune anis 3",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .76,
                g: .81,
                b: 0
            }
        }
    }, {
        texture: !0,
        title: "Jaune anis 4",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .82,
                g: .78,
                b: 0
            }
        }
    }, {
        texture: !0,
        title: "Jaune anis 5",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .91,
                g: .79,
                b: .09
            }
        }
    }, {
        texture: !0,
        title: "Jaune anis 6",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .93,
                g: .91,
                b: .4
            }
        }
    }, {
        texture: !0,
        title: "Vert botanique 1",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .4,
                g: .35,
                b: .23
            }
        }
    }, {
        texture: !0,
        title: "Vert botanique 2",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .48,
                g: .49,
                b: .11
            }
        }
    }, {
        texture: !0,
        title: "Vert botanique 3",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .6,
                g: .58,
                b: 0
            }
        }
    }, {
        texture: !0,
        title: "Vert botanique 4",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .64,
                g: .65,
                b: .21
            }
        }
    }, {
        texture: !0,
        title: "Vert botanique 5",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .71,
                g: .7,
                b: .32
            }
        }
    }, {
        texture: !0,
        title: "Vert botanique 6",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .82,
                g: .78,
                b: .44
            }
        }
    }, {
        texture: !0,
        title: "Vert kaki 1",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .34,
                g: .38,
                b: .25
            }
        }
    }, {
        texture: !0,
        title: "Vert kaki 2",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .45,
                g: .47,
                b: .31
            }
        }
    }, {
        texture: !0,
        title: "Vert kaki 3",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .58,
                g: .58,
                b: .36
            }
        }
    }, {
        texture: !0,
        title: "Vert kaki 4",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .58,
                g: .59,
                b: .31
            }
        }
    }, {
        texture: !0,
        title: "Vert kaki 5",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .67,
                g: .72,
                b: .4
            }
        }
    }, {
        texture: !0,
        title: "Vert kaki 6",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .75,
                g: .78,
                b: .46
            }
        }
    }, {
        texture: !0,
        title: "Vert pistache 1",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .21,
                g: .35,
                b: .19
            }
        }
    }, {
        texture: !0,
        title: "Vert pistache 2",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .32,
                g: .39,
                b: .21
            }
        }
    }, {
        texture: !0,
        title: "Vert pistache 3",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .43,
                g: .62,
                b: 0
            }
        }
    }, {
        texture: !0,
        title: "Vert pistache 4",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .59,
                g: .67,
                b: .13
            }
        }
    }, {
        texture: !0,
        title: "Vert pistache 5",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .72,
                g: .81,
                b: .36
            }
        }
    }, {
        texture: !0,
        title: "Vert pistache 6",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .81,
                g: .89,
                b: .35
            }
        }
    }, {
        texture: !0,
        title: "Vert-vert 1",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .15,
                g: .23,
                b: .17
            }
        }
    }, {
        texture: !0,
        title: "Vert-vert 2",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .33,
                g: .46,
                b: .18
            }
        }
    }, {
        texture: !0,
        title: "Vert-vert 3",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .33,
                g: .62,
                b: .21
            }
        }
    }, {
        texture: !0,
        title: "Vert-vert 4",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .34,
                g: .69,
                b: .13
            }
        }
    }, {
        texture: !0,
        title: "Vert-vert 5",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .56,
                g: .78,
                b: .25
            }
        }
    }, {
        texture: !0,
        title: "Vert-vert 6",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .78,
                g: .84,
                b: .61
            }
        }
    }, {
        texture: !0,
        title: "Vert lagon 1",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: 0,
                g: .29,
                b: .24
            }
        }
    }, {
        texture: !0,
        title: "Vert lagon 2",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .13,
                g: .44,
                b: .33
            }
        }
    }, {
        texture: !0,
        title: "Vert lagon 3",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: 0,
                g: .58,
                b: .45
            }
        }
    }, {
        texture: !0,
        title: "Vert lagon 4",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: 0,
                g: .63,
                b: .55
            }
        }
    }, {
        texture: !0,
        title: "Vert lagon 5",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .22,
                g: .69,
                b: .64
            }
        }
    }, {
        texture: !0,
        title: "Vert lagon 6",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .52,
                g: .83,
                b: .81
            }
        }
    }, {
        texture: !0,
        title: "Vert cèdre 1",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: 0,
                g: .13,
                b: .12
            }
        }
    }, {
        texture: !0,
        title: "Vert cèdre 2",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .23,
                g: .33,
                b: .3
            }
        }
    }, {
        texture: !0,
        title: "Vert cèdre 3",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .3,
                g: .47,
                b: .36
            }
        }
    }, {
        texture: !0,
        title: "Vert cèdre 4",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .42,
                g: .55,
                b: .47
            }
        }
    }, {
        texture: !0,
        title: "Vert cèdre 5",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .56,
                g: .71,
                b: .69
            }
        }
    }, {
        texture: !0,
        title: "Vert cèdre 6",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .71,
                g: .82,
                b: .73
            }
        }
    }, {
        texture: !0,
        title: "Bleu baltique 1",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .18,
                g: .33,
                b: .41
            }
        }
    }, {
        texture: !0,
        title: "Bleu baltique 2",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .25,
                g: .46,
                b: .54
            }
        }
    }, {
        texture: !0,
        title: "Bleu baltique 3",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .36,
                g: .56,
                b: .65
            }
        }
    }, {
        texture: !0,
        title: "Bleu baltique 4",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .33,
                g: .64,
                b: .66
            }
        }
    }, {
        texture: !0,
        title: "Bleu baltique 5",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .49,
                g: .64,
                b: .64
            }
        }
    }, {
        texture: !0,
        title: "Bleu baltique 6",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .7,
                g: .78,
                b: .78
            }
        }
    }, {
        texture: !0,
        title: "Bleu atoll 1",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: 0,
                g: .31,
                b: .38
            }
        }
    }, {
        texture: !0,
        title: "Bleu atoll 2",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: 0,
                g: .46,
                b: .5
            }
        }
    }, {
        texture: !0,
        title: "Bleu atoll 3",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .13,
                g: .55,
                b: .6
            }
        }
    }, {
        texture: !0,
        title: "Bleu atoll 4",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: 0,
                g: .62,
                b: .71
            }
        }
    }, {
        texture: !0,
        title: "Bleu atoll 5",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .19,
                g: .76,
                b: .78
            }
        }
    }, {
        texture: !0,
        title: "Bleu atoll 6",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .51,
                g: .73,
                b: .74
            }
        }
    }, {
        texture: !0,
        title: "Bleu turquoise 1",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: 0,
                g: .2,
                b: .3
            }
        }
    }, {
        texture: !0,
        title: "Bleu turquoise 2",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: 0,
                g: .38,
                b: .53
            }
        }
    }, {
        texture: !0,
        title: "Bleu turquoise 3",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: 0,
                g: .48,
                b: .63
            }
        }
    }, {
        texture: !0,
        title: "Bleu turquoise 4",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .13,
                g: .62,
                b: .71
            }
        }
    }, {
        texture: !0,
        title: "Bleu turquoise 5",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .34,
                g: .65,
                b: .71
            }
        }
    }, {
        texture: !0,
        title: "Bleu turquoise 6",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .56,
                g: .81,
                b: .84
            }
        }
    }, {
        texture: !0,
        title: "Bleu cyclades 1",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: 0,
                g: .33,
                b: .53
            }
        }
    }, {
        texture: !0,
        title: "Bleu cyclades 2",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: 0,
                g: .32,
                b: .57
            }
        }
    }, {
        texture: !0,
        title: "Bleu cyclades 3",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: 0,
                g: .49,
                b: .75
            }
        }
    }, {
        texture: !0,
        title: "Bleu cyclades 4",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .18,
                g: .5,
                b: .7
            }
        }
    }, {
        texture: !0,
        title: "Bleu cyclades 5",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .29,
                g: .6,
                b: .78
            }
        }
    }, {
        texture: !0,
        title: "Bleu cyclades 6",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .48,
                g: .76,
                b: .89
            }
        }
    }, {
        texture: !0,
        title: "Bleu-bleu 1",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: 0,
                g: .14,
                b: .36
            }
        }
    }, {
        texture: !0,
        title: "Bleu-bleu 2",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: 0,
                g: .21,
                b: .5
            }
        }
    }, {
        texture: !0,
        title: "Bleu-bleu 3",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .14,
                g: .38,
                b: .66
            }
        }
    }, {
        texture: !0,
        title: "Bleu-bleu 4",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .29,
                g: .52,
                b: .78
            }
        }
    }, {
        texture: !0,
        title: "Bleu-bleu 5",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .4,
                g: .57,
                b: .76
            }
        }
    }, {
        texture: !0,
        title: "Bleu-bleu 6",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .53,
                g: .72,
                b: .87
            }
        }
    }, {
        texture: !0,
        title: "Bleu orageux 1",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .06,
                g: .11,
                b: .25
            }
        }
    }, {
        texture: !0,
        title: "Bleu orageux 2",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .24,
                g: .27,
                b: .36
            }
        }
    }, {
        texture: !0,
        title: "Bleu orageux 3",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .19,
                g: .25,
                b: .56
            }
        }
    }, {
        texture: !0,
        title: "Bleu orageux 4",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .25,
                g: .31,
                b: .57
            }
        }
    }, {
        texture: !0,
        title: "Bleu orageux 5",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .53,
                g: .63,
                b: .78
            }
        }
    }, {
        texture: !0,
        title: "Bleu orageux 6",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .62,
                g: .69,
                b: .8
            }
        }
    }, {
        texture: !0,
        title: "Violet-violet 1",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .22,
                g: .19,
                b: .28
            }
        }
    }, {
        texture: !0,
        title: "Violet-violet 2",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .29,
                g: .22,
                b: .36
            }
        }
    }, {
        texture: !0,
        title: "Violet-violet 3",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .4,
                g: .18,
                b: .44
            }
        }
    }, {
        texture: !0,
        title: "Violet-violet 4",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .5,
                g: .32,
                b: .57
            }
        }
    }, {
        texture: !0,
        title: "Violet-violet 5",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .69,
                g: .49,
                b: .73
            }
        }
    }, {
        texture: !0,
        title: "Violet-violet 6",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .77,
                g: .71,
                b: .85
            }
        }
    }, {
        texture: !0,
        title: "Violet tulipe 1",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .24,
                g: .17,
                b: .25
            }
        }
    }, {
        texture: !0,
        title: "Violet tulipe 2",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .37,
                g: .25,
                b: .36
            }
        }
    }, {
        texture: !0,
        title: "Violet tulipe 3",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .48,
                g: .18,
                b: .41
            }
        }
    }, {
        texture: !0,
        title: "Violet tulipe 4",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .62,
                g: .29,
                b: .59
            }
        }
    }, {
        texture: !0,
        title: "Violet tulipe 5",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .73,
                g: .47,
                b: .68
            }
        }
    }, {
        texture: !0,
        title: "Violet tulipe 6",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .81,
                g: .7,
                b: .82
            }
        }
    }, {
        texture: !0,
        title: "Violet aubergine 1",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .22,
                g: .11,
                b: .16
            }
        }
    }, {
        texture: !0,
        title: "Violet aubergine 2",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .37,
                g: .2,
                b: .33
            }
        }
    }, {
        texture: !0,
        title: "Violet aubergine 3",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .48,
                g: .35,
                b: .4
            }
        }
    }, {
        texture: !0,
        title: "Violet aubergine 4",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .55,
                g: .43,
                b: .49
            }
        }
    }, {
        texture: !0,
        title: "Violet aubergine 5",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .69,
                g: .58,
                b: .64
            }
        }
    }, {
        texture: !0,
        title: "Violet aubergine 6",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .72,
                g: .65,
                b: .71
            }
        }
    }, {
        texture: !0,
        title: "Violet figue 1",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .35,
                g: .14,
                b: .22
            }
        }
    }, {
        texture: !0,
        title: "Violet figue 2",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .46,
                g: .18,
                b: .33
            }
        }
    }, {
        texture: !0,
        title: "Violet figue 3",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .47,
                g: .13,
                b: .31
            }
        }
    }, {
        texture: !0,
        title: "Violet figue 4",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .52,
                g: .3,
                b: .39
            }
        }
    }, {
        texture: !0,
        title: "Violet figue 5",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .62,
                g: .4,
                b: .49
            }
        }
    }, {
        texture: !0,
        title: "Violet figue 6",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .86,
                g: .62,
                b: .77
            }
        }
    }, {
        texture: !0,
        title: "Rose antique 1",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .29,
                g: .13,
                b: .16
            }
        }
    }, {
        texture: !0,
        title: "Rose antique 2",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .42,
                g: .15,
                b: .22
            }
        }
    }, {
        texture: !0,
        title: "Rose antique 3",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .59,
                g: .21,
                b: .36
            }
        }
    }, {
        texture: !0,
        title: "Rose antique 4",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .74,
                g: .45,
                b: .55
            }
        }
    }, {
        texture: !0,
        title: "Rose antique 5",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .82,
                g: .64,
                b: .64
            }
        }
    }, {
        texture: !0,
        title: "Rose antique 6",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .95,
                g: .84,
                b: .84
            }
        }
    }, {
        texture: !0,
        title: "Rose-rose 1",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .49,
                g: .09,
                b: .31
            }
        }
    }, {
        texture: !0,
        title: "Rose-rose 2",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .67,
                g: .11,
                b: .38
            }
        }
    }, {
        texture: !0,
        title: "Rose-rose 3",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .69,
                g: .28,
                b: .51
            }
        }
    }, {
        texture: !0,
        title: "Rose-rose 4",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .82,
                g: .3,
                b: .6
            }
        }
    }, {
        texture: !0,
        title: "Rose-rose 5",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .92,
                g: .44,
                b: .69
            }
        }
    }, {
        texture: !0,
        title: "Rose-rose 6",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .95,
                g: .69,
                b: .8
            }
        }
    }, {
        texture: !0,
        title: "Rose shocking 1",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .46,
                g: .07,
                b: .2
            }
        }
    }, {
        texture: !0,
        title: "Rose shocking 2",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .75,
                g: .18,
                b: .37
            }
        }
    }, {
        texture: !0,
        title: "Rose shocking 3",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .75,
                g: .12,
                b: .36
            }
        }
    }, {
        texture: !0,
        title: "Rose shocking 4",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .89,
                g: .25,
                b: .42
            }
        }
    }, {
        texture: !0,
        title: "Rose shocking 5",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .97,
                g: .53,
                b: .71
            }
        }
    }, {
        texture: !0,
        title: "Rose shocking 6",
        icon: "",
        action: "hcs.engine3D.paint",
        items: [],
        params: {
            materialType: "luxens",
            color: {
                r: .95,
                g: .71,
                b: .76
            }
        }
    }];
    return t
}();
var OutsideComponent3D = function() {
    var t = function(t) {
        BaseComponent3D.call(this, t, "OutsideComponent3D")
    };
    t.prototype = new BaseComponent3D, t.prototype.initialize = function() {
        var t = {
                title: _("地面"),
                id: "ground",
                items: e,
                layout: "layout-table-60"
            },
            i = {
                title: _("天空"),
                id: "sky",
                items: n,
                layout: "layout-table-60"
            },
            o = {
                title: _("外界环境"),
                id: "outside",
                items: [t, i],
                layout: "layout-list"
            };
        ujs.notify("hcs.menu.main.add", {
            item: o,
            menuPath: /*"decorate3D",*/ "furnishing3D",
            position: 1e3
        })
    };
    var e = [{
            title: "Grid (default)",
            texture: !0,
            icon: "",
            action: "hcs.engine3D.changeGround",
            id: "0",
            items: [],
            params: {
                materialType: "hcs.MattMaterial",
                url: "textures/textureset/ground/ground01.jpg",
                id: "0"
            }
        }, {
            title: "Macadam",
            texture: !0,
            icon: "",
            action: "hcs.engine3D.changeGround",
            id: "1",
            items: [],
            params: {
                materialType: "hcs.MattMaterial",
                url: "textures/textureset/ground/ground02.jpg",
                id: "1"
            }
        }, {
            title: "Soil",
            texture: !0,
            icon: "",
            action: "hcs.engine3D.changeGround",
            id: "2",
            items: [],
            params: {
                materialType: "hcs.MattMaterial",
                url: "textures/textureset/ground/ground03.jpg",
                id: "2"
            }
        }, {
            title: "Grass",
            texture: !0,
            icon: "",
            action: "hcs.engine3D.changeGround",
            id: "3",
            items: [],
            params: {
                materialType: "hcs.MattMaterial",
                url: "textures/textureset/ground/ground04.jpg",
                id: "3"
            }
        }, {
            title: "Grass 2",
            texture: !0,
            icon: "",
            action: "hcs.engine3D.changeGround",
            id: "4",
            items: [],
            params: {
                materialType: "hcs.MattMaterial",
                url: "textures/textureset/ground/ground05.jpg",
                id: "4"
            }
        }, {
            title: "Grass 3",
            texture: !0,
            icon: "",
            action: "hcs.engine3D.changeGround",
            id: "5",
            items: [],
            params: {
                materialType: "hcs.MattMaterial",
                url: "textures/textureset/ground/ground06.jpg"
            }
        }, {
            title: "Grass 4",
            texture: !0,
            icon: "",
            action: "hcs.engine3D.changeGround",
            id: "6",
            items: [],
            params: {
                materialType: "hcs.MattMaterial",
                url: "textures/textureset/ground/ground07.jpg"
            }
        }, {
            title: "Grass 5",
            texture: !0,
            icon: "",
            action: "hcs.engine3D.changeGround",
            id: "7",
            items: [],
            params: {
                materialType: "hcs.MattMaterial",
                url: "textures/textureset/ground/ground08.jpg"
            }
        }, {
            title: "Grass 6",
            texture: !0,
            icon: "",
            action: "hcs.engine3D.changeGround",
            id: "8",
            items: [],
            params: {
                materialType: "hcs.MattMaterial",
                url: "textures/textureset/ground/ground09.jpg"
            }
        }, {
            title: "Soil",
            texture: !0,
            icon: "",
            action: "hcs.engine3D.changeGround",
            id: "9",
            items: [],
            params: {
                materialType: "hcs.MattMaterial",
                url: "textures/textureset/ground/ground10.jpg"
            }
        }, {
            title: "Gray gravel",
            texture: !0,
            icon: "",
            action: "hcs.engine3D.changeGround",
            id: "10",
            items: [],
            params: {
                materialType: "hcs.MattMaterial",
                url: "textures/textureset/ground/ground11.jpg"
            }
        }, {
            title: "Brick",
            texture: !0,
            icon: "",
            action: "hcs.engine3D.changeGround",
            id: "11",
            items: [],
            params: {
                materialType: "hcs.MattMaterial",
                url: "textures/textureset/ground/ground12.jpg"
            }
        }, {
            title: "Brick 2",
            texture: !0,
            icon: "",
            action: "hcs.engine3D.changeGround",
            id: "12",
            items: [],
            params: {
                materialType: "hcs.MattMaterial",
                url: "textures/textureset/ground/ground13.jpg"
            }
        }, {
            title: "Brick 3",
            texture: !0,
            icon: "",
            action: "hcs.engine3D.changeGround",
            id: "13",
            items: [],
            params: {
                materialType: "hcs.MattMaterial",
                url: "textures/textureset/ground/ground14.jpg"
            }
        }, {
            title: "Brick 4",
            texture: !0,
            icon: "",
            action: "hcs.engine3D.changeGround",
            id: "14",
            items: [],
            params: {
                materialType: "hcs.MattMaterial",
                url: "textures/textureset/ground/ground15.jpg"
            }
        }],
        n = [{
            title: "Default sky",
            texture: !0,
            icon: "",
            action: "hcs.engine3D.changeSky",
            id: "0",
            items: [],
            params: {
                materialType: "lambert",
                url: "textures/textureset/sky/sky01.jpg"
            }
        }, {
            title: "Sky 1",
            texture: !0,
            icon: "",
            action: "hcs.engine3D.changeSky",
            id: "1",
            items: [],
            params: {
                materialType: "lambert",
                url: "textures/textureset/sky/sky02.jpg"
            }
        }, {
            title: "Sky 2",
            texture: !0,
            icon: "",
            action: "hcs.engine3D.changeSky",
            id: "2",
            items: [],
            params: {
                materialType: "lambert",
                url: "textures/textureset/sky/sky03.jpg"
            }
        }, {
            title: "Sky 3",
            texture: !0,
            icon: "",
            action: "hcs.engine3D.changeSky",
            id: "3",
            items: [],
            params: {
                materialType: "lambert",
                url: "textures/textureset/sky/sky04.jpg"
            }
        }];
    return t
}();
var ObjectComponent3D = function() {
    function t(t) {
        t.traverse(function(t) {
            hcsdesign.engine3D.castShadows(t), t.receiveShadows = !0
        })
    }
    var e, n = (new BABYLON.Vector3(50, 50, 50), new BABYLON.Vector3(0, 0, 0), "js/Components/CoreComponents/Object/Programmable/"),
        i = null,
        o = -1,
        r = (ujs.getById("container3d"), function(t) {
            BaseComponent3D.call(this, t, "ObjectComponent3D"), i = t.version, e = this
        });
    return r.prototype = new BaseComponent3D, r.prototype.initialize = function() {
        /*hcs.Constants.PRODUCTS_CATEGORY_FILE && ujs.ajax({
            url: hcs.Constants.PRODUCTS_CATEGORY_FILE,
            method: "GET",
            params: ["t=", Math.round(100 * Math.random())].join(""),
            success: function(t) {
                try {
                    productsMenu = JSON.parse(t), ujs.notify("hcs.menu.main.add", {
                        item: productsMenu,
                        menuPath: "1",
                        position: 0
                    })
                } catch (e) {
                    Logger.message("BAD JSON FILE")
                }
            }.bind(this)
        })*/
		xmlHttp = new XMLHttpRequest();
		xmlHttp.open("GET", 'data/1/categories.json', false);
		xmlHttp.send(null);
		//console.warn(xmlHttp.responseText);
		productsMenu = JSON.parse(xmlHttp.responseText);
		ujs.notify("hcs.menu.main.add", {item: productsMenu,menuPath: "1",position: 0})
    }, r.prototype.onFloorReady = function(t) {
        for (var n = t.floor || e.getFloor(), i = t.structure || hcsdesign.getSelectedStructure(), o = i.getElements("objects"), r = 0; r < o.length; r++)
            o[r].isRecentlyAdded = !1, e.buildObject(o[r], o[r].programmableInstance, n)
    }, r.prototype.loadProgrammableFile = function(t, e, o) {
        var r = e || t + ".js";
        "undefined" == typeof hcs.Programmable[t] ? HTMLHelper.addScript(n + r + "?t=" + i, void 0, o) : o(void 0)
    }, r.prototype.startListening = function() {
        document.addEventListener("hcs.request.floorSelected", this.onFloorChanged, !1), document.addEventListener("hcs.engine3d.floorReady", this.onFloorReady, !1), document.addEventListener("hcs.engine3D.addObject", this.onAddObject, !1), document.addEventListener("hcs.engine3D.addGroup", this.onAddGroup, !1), document.addEventListener("hcs.engine3D.addProgrammable", this.onAddObject, !1), document.addEventListener("hcs.engine3D.object.remove", this.onRemoveObject, !1)
    }, r.prototype.stopListening = function() {
        document.removeEventListener("hcs.request.floorSelected", this.onFloorChanged, !1), document.removeEventListener("hcs.engine3d.floorReady", this.onFloorReady, !1), document.removeEventListener("hcs.engine3D.addObject", this.onAddObject), document.removeEventListener("hcs.engine3D.addGroup", this.onAddGroup), document.removeEventListener("hcs.engine3D.addProgrammable", this.onAddObject, !1), document.removeEventListener("hcs.engine3D.object.remove", this.onRemoveObject, !1)
    }, r.prototype.onAddGroup = function(t) {
        var n = t.objectParams,
            i = JSON.parse(n.params),
            o = JSON.parse(n.materials),
            r = (new Date).getTime(),
            s = e.getFloor(),
            a = hcsdesign.getComponentByName("AvatarComponent3D", this.engine3D),
            l = a.avatar.position.clone();
        l.y -= 5 + +s.position.y;
        for (var h in i)
            t.objectType = i[h].type || "programmable", i[h].position.z *= -1, t.position = l.add(i[h].position), t.rotation = i[h].rotation, t.objectParams = {
                params: i[h].params,
                builder_id: i[h].builder_id,
                path: i[h].filename,
                materials: JSON.stringify(o[h]),
                customData: {
                    groupId: r
                }
            }, e.onAddObject(t)
    }, r.prototype.onAddObject = function(t) {
        var n = hcsdesign.getSelectedStructure(),
            i = e.getFloor(),
            o = t.objectParams,
            r = new ObjectStructure;
        if (r.builderId = o.builder_id, "string" == typeof o.params && "" !== o.params && (o.params = JSON.parse(o.params)), "string" == typeof o.materials && "" !== o.materials && (o.materials = "[]" === o.materials ? {} : ujs.deserializeObject(JSON.parse(o.materials))), o.customData && (r.customData = o.customData), r.filename = o.path, r.baseUrl = o.baseUrl || null, t.position)
            r.position.x = t.position.x, r.position.y = t.position.y, r.position.z = t.position.z;
        else {
            var s = hcsdesign.getComponentByName("AvatarComponent3D", this.engine3D);
            avatarPosition = s.avatar.position, r.position.x = avatarPosition.x, r.position.z = avatarPosition.z, r.position.y += 5
        }
        t.rotation && (r.rotation.x = t.rotation.x, r.rotation.y = t.rotation.y, r.rotation.z = t.rotation.z), n.insertElement("objects", r), r.isRecentlyAdded = !0, e.buildObject(r, o, i)
    }, r.prototype.onRemoveObject = function(t) {
        for (var e, n = 0; n < hcsdesign.structure.getLength(); n++)
            e = hcsdesign.structure.getElement(n), e.removeElement("objects", t.structure)
    }, r.prototype.refreshObject = function(t, e) {
        for (var n = t.structure.programmableInstance, i = (t.getFloor(), t.getChildren()), o = i.length; o--;)
            i[o].dispose();
        this.buildObject(t.structure, n, t.parent, function(n) {
            t.position = n.position, t.rotation = n.rotation, t.parent = n.parent;
            for (var i = n.getVerticesDataKinds(), o = i.length; o--;)
                t.setVerticesData(i[o], n.getVerticesData(i[o]).slice());
            if (t.setIndices(n.getIndices().slice()), n._vertexBuffers) {
                var r = BABYLON.Tools.ExtractMinAndMax(n.getVerticesData(BABYLON.VertexBuffer.PositionKind), 0, n.getTotalVertices());
                t._boundingInfo = new BABYLON.BoundingInfo(r.minimum, r.maximum)
            }
            t.material = n.material;
            for (var s = n.getChildren(), o = s.length; o--;)
                s[o].parent = t;
            t.computeWorldMatrix(!0), t.getBoundingBox(!0), n.silentDispose = !0, n.dispose(), n.silentDispose = !1, ujs.notify("hcs.engine3D.object.refresh", {
                object: t
            }), e && e(t)
        }, !0)
    }, r.prototype.buildObject = function(t, n, i, o, r) {
        var s, o = o || function() {},
            i = i || e.getFloor();
        t.programmableInstance ? s = t.programmableInstance.materials : n.materials && (s = n.materials);
        var a, l = function(n) {
                return n ? (t.programmableInstance = a, t.objectInstance = n, void e.addObjectToScene(n, t, i, o, r)) : (Logger.warning("[ObjectComponent3D] onObject3dLoaded : unable to build the following object : "), void Logger.warning(a))
            },
            h = t.baseUrl || null;
        t.filename && hcs.Programmable.createInstance(t.filename, n, s, t, function(t) {
            if (a = t, a.async)
                a.getObject3D(hcsdesign.engine3D.scene, l);
            else {
                var e = a.getObject3D(hcsdesign.engine3D.scene);
                l(e)
            }
        }, h, e.engine3D)
    }, r.prototype.addObjectToScene = function(t, n, i, o, r) {
        var o = o || function() {};
        return e.prepareObject3D(t, n, i), o(t), r || ujs.notify("hcs.engine3D.object.create", {
            object: t,
            objectStructure: n
        }), t
    }, r.prototype.prepareObject3D = function(n, i, r) {
        n.structure = i, n.name = "Object_" + ++o, i.id = o, n.parent = r, n.position.copyFrom(i.position), n.rotation.copyFrom(i.rotation), n.scaling.copyFrom(i.scaling), i.position = n.position, i.rotation = n.rotation, i.scaling = n.scaling, i.position.x = +i.position.x, i.position.y = +i.position.y, i.position.z = +i.position.z, i.rotationQuaternion && (n.rotationQuaternion = i.rotationQuaternion), n.structure.group && (n.parent = n.structure.group, n.changeFrame(r)), n.computeWorldMatrix(!0), r.markAsDirty(), n.isDecorable = !0, n.decorate = i.programmableInstance.decorate.bind(n), n.animate = i.programmableInstance.animate.bind(i.programmableInstance);
        var s = i.programmableInstance.materials;
        if (i.programmableInstance.getDefaultMaterials) {
            var a = i.programmableInstance.getDefaultMaterials(hcsdesign.engine3D.scene);
            s = ujs.mergeObjects(a, i.programmableInstance.materials)
        }
        n.initMaterials(s), n.onDispose = function() {
            n.silentDispose || ujs.notify("hcs.engine3D.object.dispose", {
                object: n
            })
        }, t(n);
        var l = hcsdesign.getComponentByName("EditionComponent3D");
        return l && e.getFloor().structureId == r.structureId && l.addDraggable(n), n
    }, r
}();
var EditionComponent3D = function() {
    var t = null,
        e = !1,
        n = -1,
        i = null,
        o = !1,
        r = 1,
        s = 2,
        a = 4,
        l = 8,
        h = [],
        c = function(e) {
            BaseComponent3D.call(this, e, "EditionComponent3D"), t = this, this.scene = hcsdesign.engine3D.scene, this.camera = hcsdesign.engine3D.camera, this.rotatorWidget = new hcs.Widget.Rotator(this), this.infoWidget = new hcs.Widget.Info(this), this.infoWidget.setClickCallback(this.onIAction.bind(this)), this.elevationWidget = new hcs.Widget.Elevation(this), this.cloneWidget = new hcs.Widget.Clone(this), this.groupWidget = new hcs.Widget.Group(this), this.removeWidget = new hcs.Widget.Remove(this), this.widgets = [], this.widgets.push(this.rotatorWidget), this.widgets.push(this.infoWidget), this.widgets.push(this.elevationWidget), this.widgets.push(this.cloneWidget), this.widgets.push(this.removeWidget), this.widgets.push(this.groupWidget), this.dragControl = new hcs.DragControls(this.scene, hcsdesign.engine3D.canvas), this.dragControl.constrains("xz"), this.addUnremovableDraggable = this.dragControl.addUnremovableDraggable, this.addDraggable = this.dragControl.addDraggable, this.removeDraggable = this.dragControl.removeDraggable, this.resetDraggable = this.dragControl.resetDraggable
        };
    c.prototype = new BaseComponent3D, c.prototype.addWidget = function(t) {
        return this.widgets.push(t), t
    }, c.prototype.on = function(e, n) {
        return h[e] || (h[e] = []), h[e].push(n), t
    }, c.prototype.off = function(e, n) {
        var i = h[e];
        return i ? (i.indexOf(n) > -1 && i.splice(n, 1), t) : t
    };
    var u = function(t, e) {
        var n = h[t];
        if (n)
            for (var i = 0; i < n.length; i++)
                n[i](e)
    };
    c.prototype.initialize = function() {
        this.ephemeralInfos = document.getElementById("ephemeralInfos"), this.historycmp = null, this.MOVEACTION = 0, this.ROTATEACTION = 1, this.GROUPACTION = 3, this.DELETEACTION = 4, this.ADDACTION = 5, this.isViewer || (this.dragControl.on("mousedown", function(e) {
            e.hit && (t.camera.enabled = !1, ujs.notify("hcs.engine3D.editorComponent.hideEditBox"))
        }, !1), this.dragControl.on("mouseup", function() {
            t.camera.enabled = !0
        }, !1)), this.setupHistory()
    }, c.prototype.startListening = function() {
        this.onMouseDown = this.onMouseDown.bind(this), this.onMouseMove = this.onMouseMove.bind(this), this.onMouseUp = this.onMouseUp.bind(this), this.onClick = this.onClick.bind(this), this.onDoubleClick = this.onDoubleClick.bind(this), this.onGroup = this.onGroup.bind(this), this.onKeyDown = this.onKeyDown.bind(this), this.onCloneObject = this.onCloneObject.bind(this), this.onAddToProducts = this.onAddToProducts.bind(this), this.onRemoveObject = this.onRemoveObject.bind(this), this.onCreateObject = this.onCreateObject.bind(this), this.onDisposeObject = this.onDisposeObject.bind(this), this.onFloorChanged = this.onFloorChanged.bind(this), this.onNewPlan = this.onNewPlan.bind(this), this.onDragEnd = this.onDragEnd.bind(this), this.onDragging = this.onDragging.bind(this), this.onDragStart = this.onDragStart.bind(this), hcsdesign.engine3D.canvas.addEventListener("pointerdown", this.onMouseDown, !1), hcsdesign.engine3D.canvas.addEventListener("pointermove", this.onMouseMove, !1), hcsdesign.engine3D.canvas.addEventListener("pointerup", this.onMouseUp, !1), this.dragControl.on("dragstart", this.onDragStart), this.dragControl.on("drag", this.onDragging), this.dragControl.on("dragend", this.onDragEnd), document.addEventListener("hcs.engine3D.click.collided", this.onClick, !1), document.addEventListener("hcs.engine3D.dblclick.collided", this.onDoubleClick, !1), document.addEventListener("hcs.engine3D.contextMenu.group", this.onGroup, !1), document.addEventListener("hcs.keyboardManager.keyDown", this.onKeyDown, !0), document.addEventListener("hcs.request.object.clone", this.onCloneObject, !1), document.addEventListener("hcs.request.object.addToProducts", this.onAddToProducts, !1), document.addEventListener("hcs.request.object.remove", this.onRemoveObject, !1), document.addEventListener("hcs.engine3D.object.create", this.onCreateObject, !1), document.addEventListener("hcs.engine3D.object.refresh", this.onRefreshObject, !1), document.addEventListener("hcs.engine3D.object.dispose", this.onDisposeObject, !1), document.addEventListener("hcs.engine3d.globaleFloorReady", this.onFloorChanged, !1), document.addEventListener("hcs.request.newPlanReady", this.onNewPlan, !1)
    }, c.prototype.stopListening = function() {
        hcsdesign.engine3D.canvas.removeEventListener("pointerdown", this.onMouseDown), hcsdesign.engine3D.canvas.removeEventListener("pointermove", this.onMouseMove, !1), hcsdesign.engine3D.canvas.removeEventListener("pointerup", this.onMouseUp, !1), this.dragControl.off("dragstart", this.onDragStart), this.dragControl.off("drag", this.onDragging), this.dragControl.off("dragend", this.onDragEnd), document.removeEventListener("hcs.engine3D.click.collided", this.onClick, !1), document.removeEventListener("hcs.engine3D.dblclick.collided", this.onDoubleClick, !1), document.removeEventListener("hcs.engine3D.contextMenu.group", this.onGroup, !1), document.removeEventListener("hcs.keyboardManager.keyDown", this.onKeyDown, !0), document.removeEventListener("hcs.request.object.clone", this.onCloneObject, !1), document.removeEventListener("hcs.request.object.addToProducts", this.onAddToProducts, !1), document.removeEventListener("hcs.request.object.remove", this.onRemoveObject, !1), document.removeEventListener("hcs.engine3D.object.create", this.onCreateObject, !1), document.removeEventListener("hcs.engine3D.object.dispose", this.onDisposeObject, !1), document.removeEventListener("hcs.engine3d.globaleFloorReady", this.onFloorChanged, !1), document.removeEventListener("hcs.request.newPlan", this.onNewPlan, !1), this.disableWidget()
    }, c.prototype.onIAction = function() {
        var t = this.getSelectedObject();
        ujs.notify(this.isGroup(t) ? "hcs.request.groupConfigurator.start" : "hcs.request.configurator.start")
    }, c.prototype.onMouseDown = function(t) {
        t.collided = hcsdesign.engine3D.collideWithScene(t.clientX, t.clientY), u("mousedown", t);
        var e = hcsdesign.engine3D.keyboardManager.isPressed([17, 91, 224]);
        this.dragControl.constrains(e ? "y" : "xz")
    }, c.prototype.onMouseUp = function(t) {
        u("mouseup", t)
    }, c.prototype.onMouseMove = function(t) {
        u("mousemove", t)
    }, c.prototype.onDragStart = function(t) {
        var e = t.pickedMesh;
        t.oldPosition = e.position.clone(), t.oldRotation = e.rotation.clone(), u("dragstart", {
            object: e
        })
    }, c.prototype.onDragEnd = function(e) {
        var n = e.pickedMesh;
        u("dragend", {
            object: n
        }), t.ephemeralInfos.classList.add("hidden");
        var i = n.getTopLevelObject(!0);
        ujs.notify("hcs.request.historyAction", {
            component: t,
            object: i,
            params: {
                oldPosition: e.oldPosition,
                newPosition: n.position.clone(),
                oldRotation: e.oldRotation,
                newRotation: n.rotation.clone()
            },
            action: t.MOVEACTION
        })
    }, c.prototype.onDragging = function(e) {
        var n = e.pickedMesh;
        u("dragging", {
            object: n
        });
        var i = n.position,
            o = "<table>";
        o += "<tr>", o += "<td>x: " + Math.round(i.x) + "</td>", o += "<td>z: " + Math.round(i.z) + "</td>", o += "<td>" + _("elevation:") + Math.round(i.y) + "</td>", o += "</tr>", t.ephemeralInfos.innerHTML = o, t.ephemeralInfos.classList.remove("hidden")
    }, c.prototype.onClick = function(n) {
        if (this.engine3D.mode == this.engine3D.MODE_NORMAL && (u("click", n), !o)) {
            var i = n.collided;
            if (i && i.hit) {
                t.dragControl.setDraggingMode(t.dragControl.GROUPS);
                var r = hcsdesign.engine3D.keyboardManager.isPressed([17, 91, 224]),
                    s = i.pickedMesh.getTopLevelObject();
                if (this.isGroup(s) || this.isSelectableObject(s)) {
                    if (r)
                        this.addToGroup(s, this.getSelectedObject()), this.deselectObject(), s = i.pickedMesh.getTopLevelObject();
                    else {
                        var a = i.pickedMesh.getTopLevelObject(!0);
                        (a.parent === this.getSelectedObject() || a === this.getSelectedObject()) && (this.deselectObject(), s = a, t.dragControl.setDraggingMode(t.dragControl.OBJECTS))
                    }
                    this.centerGroup(s), this.selectObject(s), 2 == n.button && u("special")
                } else
                    this.deleteGroup(), this.deselectObject();
                s !== e && this.deleteGroup()
            }
        }
    }, c.prototype.onDoubleClick = function(t) {
        var e = t.collided ? t.collided.pickedMesh.getTopLevelObject(!0) : null,
            n = e ? e.animate : null;
        n && n(e, t.collided.pickedMesh)
    }, c.prototype.onKeyDown = function(e) {
        var n = hcsdesign.engine3D.keyboardManager.isPressed([17, 91, 224]);
        n && i && 68 == e.keyCode && t.onCloneObject(), 46 == e.keyCode && t.getSelectedObject() && ujs.notify("hcs.request.object.remove", {
            object: t.getSelectedObject(),
            structure: t.getSelectedObject().structure
        })
    }, c.prototype.onRemoveObject = function(e) {
        t.removeObject(e.object || t.getSelectedObject())
    }, c.prototype.onNewPlan = function() {
        t.deselectObject()
    }, c.prototype.onCreateObject = function(e) {
        var n, i = e.objectStructure.customData.groupId,
            o = e.object.getFloor();
        void 0 !== i && null !== i ? (n = o.getChildByName("group_" + i), n || (n = t.createGroup(i, o), e.object.structure.isRecentlyAdded && this.addHistory(n, {
            floor: o,
            isGroup: !0
        }, t.ADDACTION)), t.addToGroup(e.object, n, !0), t.setGroupId(e.object, i)) : e.object.structure.isRecentlyAdded && this.addHistory(e.object, {
            floor: o
        }, t.ADDACTION), e.object.traverse(function(t) {
            t.isVisible && (t.wasVisible = !0)
        })
    }, c.prototype.onRefreshObject = function(t) {
        t.object === i && u("refresh", t)
    }, c.prototype.onDisposeObject = function(t) {
        u("dispose", t.object), t.object === i && this.deselectObject()
    }, c.prototype.onFloorChanged = function() {
        t.deselectObject(), t.resetDraggable()
    }, c.prototype.lock = function(e, n) {
        o && o !== e || (n = "undefined" != typeof n ? n : s + r + a + l, n & s && (this.dragControl.enabled = !1, this.dragControl.reset()), n & r && (this.camera.enabled = !1), n & l && (t.camera.cameraTranslationenabled = !1), hcsdesign.keyboardManager && n & a && (hcsdesign.keyboardManager.preventDefault = !1), o = e)
    }, c.prototype.unlock = function(e, n) {
        o && o !== e && e !== this || (n = "undefined" != typeof n ? n : s + r + a + l, n & s && (this.dragControl.enabled = !0, this.dragControl.reset()), n & r && (this.camera.enabled = !0), n & l && (t.camera.cameraTranslationenabled = !0), hcsdesign.keyboardManager && n & a && (hcsdesign.keyboardManager.preventDefault = !0), o = null)
    }, c.prototype.disableWidget = function() {
        u("deselectObject")
    }, c.prototype.enableWidget = function() {
        i && u("selectObject", {
            object: i
        })
    }, c.prototype.getLocker = function() {
        return o
    }, c.prototype.isGroup = function(t) {
        return -1 !== t.name.indexOf("group_")
    }, c.prototype.isVirtualGroup = function(t) {
        return t && t.name.indexOf("group_virtual") >= 0
    }, c.prototype.isSelectableObject = function(t) {
        return -1 !== t.name.indexOf("Object_")
    }, c.prototype.getSelectedObject = function() {
        return i
    }, c.prototype.selectObject = function(t) {
        i = t, u("selectObject", {
            object: t
        })
    }, c.prototype.deselectObject = function() {
        u("deselectObject"), i = null
    }, c.prototype.moveObject = function(e, n) {
        if (t.isSelectableObject(e) || t.isGroup(e)) {
            e.position.addInPlace(n);
            var i = e.getFloor();
            i && i.markAsDirty(), u("objectMoves", {
                object: e,
                delta: n
            }), ujs.notify("hcs.engine3D.object.translate", {
                object: e
            })
        }
    }, c.prototype.rotateObject = function(e, n) {
        (t.isSelectableObject(e) || t.isGroup(e)) && (e.rotation.addInPlace(n), u("objectRotates", {
            object: e,
            delta: n
        }), ujs.notify("hcs.engine3D.object.rotate", {
            object: e
        }))
    };
    var p = function(e, n) {
        var i = n.pickedMesh.material.subMaterials ? n.pickedMesh.material.subMaterials[n.pickedSubMeshIndex] : n.pickedMesh.material;
        if (t.isGroup(this))
            for (var o = this.getChildren(), r = 0, s = o.length; s > r; r++)
                o[r].decorate && o[r].decorate(e, n);
        return i
    };
    return c.prototype.createGroup = function(e, i) {
        var o;
        return null !== e && void 0 !== e ? (o = new BABYLON.Mesh("group_" + e, hcsdesign.engine3D.scene), t.setGroupId(o, e), n = Math.max(n, e)) : o = new BABYLON.Mesh("group_virtual", hcsdesign.engine3D.scene), o.isDecorable = !0, o.decorate = p.bind(o), o.isVisible = !1, o.parent = i, this.addDraggable(o), o
    }, c.prototype.mergeGroup = function(e, n) {
        var i = !!n && this.isGroup(n),
            o = !!e && this.isGroup(e);
        if (i && (!o || o && this.isVirtualGroup(e)))
            return this.mergeGroup(n, e);
        var r, s = o ? e.getChildren() : e ? [e] : [],
            a = i ? n.getChildren() : n ? [n] : [];
        r = o ? e : t.createGroup(null, e.parent), i && this.deleteGroup(n);
        for (var l = s.concat(a), h = l.length; h--;) {
            if (r.getChildByName(l[h].name))
                continue;
            l[h].changeFrame(l[h].parent), l[h].changeFrame(r), l[h].structure.group = r, this.isVirtualGroup(r) || this.setGroupId(l[h], r.groupId)
        }
        return r
    }, c.prototype.addToGroup = function(n, i, o) {
        n && (i = this.mergeGroup(n, i || e), e = this.isVirtualGroup(i) ? i : !1, o || this.addHistory(n, {
            wasAdd: 1,
            object: n,
            group: i
        }, t.GROUPACTION))
    }, c.prototype.removeFromGroup = function(n, i) {
        var i = i || e;
        if (i && n.parent === i) {
            var o = i.parent,
                r = i.getWorldMatrix().clone(),
                s = o.getWorldMatrix().clone();
            s.invert();
            var a = r.multiply(s);
            n.parent = o, n.position.copyFrom(BABYLON.Vector3.TransformCoordinates(n.position, a)), n.rotation.addInPlace(i.rotation), n.rotation.subtractInPlace(i.parent.rotation), t.removeGroupId(n), n.changeFrame(i.parent)
        }
    }, c.prototype.deleteGroup = function(n, i) {
        var n = n || e;
        if (n) {
            t.removeGroupId(n);
            var o = n.parent,
                r = n.getChildren().slice(),
                s = n.getWorldMatrix().clone(),
                a = o.getWorldMatrix().clone();
            a.invert();
            for (var l = s.multiply(a), h = 0, c = r.length; c > h; h++)
                r[h].parent = o, r[h].position.copyFrom(BABYLON.Vector3.TransformCoordinates(r[h].position, l)), r[h].rotation.addInPlace(n.rotation), r[h].rotation.subtractInPlace(n.parent.rotation);
            this.removeDraggable(n), n.dispose(), n === e && (e = null), i && this.addHistory(n, {
                component: t,
                params: {
                    wasAdd: 0,
                    object: r,
                    group: n
                },
                action: t.GROUPACTION
            }, t.GROUPACTION)
        }
    }, c.prototype.deleteSelectedGroup = function() {
        t.deleteGroup(i), t.deselectObject()
    }, c.prototype.centerGroup = function(t) {
        if (t && this.isGroup(t)) {
            var e = t.getBoundingBox(!0).center.clone();
            e.y = t.getBoundingBox().minimum.y;
            var n = t.getChildren(),
                i = t.getWorldMatrix().clone(),
                o = t.parent.getWorldMatrix().clone();
            o.invert();
            for (var r = i.multiply(o), s = BABYLON.Vector3.TransformNormal(e, r), a = n.length - 1; a >= 0; a--) {
                var l = n[a];
                l.position.subtractInPlace(e), l.computeWorldMatrix(!0)
            }
            t.position.addInPlace(s), t.computeWorldMatrix(!0), t.getFloor().markAsDirty()
        }
    }, c.prototype.refreshObject = function(t, e) {
        e = e || {};
        var n = hcsdesign.getComponentByName("ObjectComponent3D");
        !e.noHistory && e.modifiedProperties && ujs.notify("hcs.request.historyAction", {
            component: this,
            object: t,
            params: e.modifiedProperties || {},
            action: this.REFRESHACTION
        }), n.refreshObject(t, e.callback)
    }, c.prototype.setGroupId = function(e, n) {
        if (t.isGroup(e)) {
            e.groupId = n;
            for (var i = e.getChildren(), o = 0, r = i.length; r > o; o++)
                t.setGroupId(i[o], n)
        } else
            t.isSelectableObject(e) && (e.structure.customData.groupId = n)
    }, c.prototype.removeGroupId = function(e) {
        if (t.isGroup(e))
            for (var n = e.getChildren(), i = 0, o = n.length; o > i; i++)
                t.removeGroupId(n[i]);
        else
            t.isSelectableObject(e) && (e.structure.customData.groupId = null, e.structure.group = null)
    }, c.prototype.virtualToRealGroup = function() {
        e && (e.name = "group_" + ++n, t.setGroupId(e, n), e = null)
    }, c.prototype.onGroup = function(e) {
        e.value ? t.virtualToRealGroup(e) : t.deleteSelectedGroup()
    }, c.prototype.onCloneGroup = function(e) {
        var i = e.getChildren(),
            o = hcsdesign.getComponentByName("ObjectComponent3D");
        t.virtualToRealGroup(), t.deleteGroup(), t.deselectObject();
        var r = t.createGroup(++n, e.getFloor());
        r.computeWorldMatrix(!0);
        var s = e.getBoundingBox(),
            a = new BABYLON.Vector3(s.maximum.x - s.minimum.x, 0, 0);
        a = BABYLON.Vector3.TransformNormal(a, e.getWorldMatrix());
        for (var l = 0, h = i.length; h > l; l++) {
            var c = i[l];
            if (t.isSelectableObject(c)) {
                var u = c.structure.clone();
                hcsdesign.getSelectedStructure().insertElement("objects", u);
                var p = function(e) {
                    t.deselectObject(), e.position.addInPlace(a), t.selectObject(e), ujs.notify("hcs.request.saveHistory")
                };
                u.customData.groupId = r.groupId, o.buildObject(u, u.programmableInstance, c.getFloor(), p)
            }
        }
    }, c.prototype.onCloneObject = function() {
        var e = hcsdesign.getComponentByName("ObjectComponent3D"),
            n = i;
        if (null != n)
            if (t.isGroup(n))
                t.onCloneGroup(n);
            else if (t.isSelectableObject(n)) {
            var o = n.structure.clone();
            hcsdesign.getSelectedStructure().insertElement("objects", o);
            var r = function(e) {
                t.deselectObject(), t.selectObject(e);
                var n = e.getBoundingBox(),
                    i = new BABYLON.Vector3(n.maximum.x - n.minimum.x, 0, 0);
                i = BABYLON.Vector3.TransformNormal(i, e.getWorldMatrix()), e.position.addInPlace(i), ujs.notify("hcs.request.saveHistory"), ujs.notify("hcs.engine3D.object.clone")
            };
            e.buildObject(o, o.programmableInstance, n.getFloor(), r)
        }
    }, c.prototype.removeObject = function(e, n) {
        if (e) {
            this.deselectObject();
            var i = e.getFloor();
            if (this.isGroup(e)) {
                var o = e.getChildren();
                e.isDeleted = !0, this.addHistory(e, {
                    floor: i,
                    isGroup: !0
                }, t.DELETEACTION);
                for (var r = 0, s = o.length; s > r; r++)
                    this.removeObject(o[r], !0)
            } else
                i.structure.removeElement("objects", e.structure), n || (this.addHistory(e, {
                    floor: i
                }, t.DELETEACTION), e.structure.isDeleted = !0), e.traverse(function(t) {
                    t.isVisible && (t.wasVisible = !0), t.isVisible = !1
                })
        }
    }, c.prototype.onAddToProducts = function() {
        var e = hcs.Constants.BACK_URL + "ws/add-model";
        if (i && i.structure && t.isSelectableObject(i)) {
            var n = i.structure,
                o = n.filename || "object";
            ujs.ajax({
                method: "POST",
                url: e,
                withCredentials: !0,
                params: "action=add&model=model&is_active=0&name=" + o + "&encoded=1&builder_id=" + n.builderId + "&params=" + JSON.stringify(n.programmableInstance.params) + "&materials=" + JSON.stringify(ujs.serializeObject(n.programmableInstance.materials)),
                success: function(t) {
                    Logger.message(t), hcs.UI.MessageBox.show({
                        title: _("Object added"),
                        message: _("Object is now available in the backoffice"),
                        buttonAText: _("Close"),
                        buttonA: !0
                    })
                }
            })
        } else if (i && t.isGroup(i)) {
            for (var r = i, s = {}, a = {}, o = "Group", l = 0; l < r.getChildren().length; l++) {
                var h = r.getChildren()[l];
                if (h.structure && -1 !== h.name.indexOf("Object_")) {
                    var c = h.position.clone();
                    s[l] = {
                        builder_id: h.structure.builderId,
                        type: h.structure.type,
                        filename: h.structure.filename,
                        params: h.structure.programmableInstance.params,
                        rotation: {
                            x: h.rotation.x,
                            y: h.rotation.y,
                            z: h.rotation.z
                        },
                        position: {
                            x: c.x,
                            y: c.y + r.position.y,
                            z: c.z
                        }
                    }, a[l] = ujs.serializeObject(h.structure.programmableInstance.materials)
                }
            }
            ujs.ajax({
                method: "POST",
                url: e,
                withCredentials: !0,
                params: "action=add&model=model&is_active=0&name=" + o + "&encoded=1&builder_id=0&params=" + JSON.stringify(s) + "&materials=" + JSON.stringify(a),
                success: function(t) {
                    Logger.message(t)
                }
            })
        }
    }, c.prototype.update = function() {}, c.prototype.addHistory = function(t, e, n) {
        if (this.historycmp)
            switch (n) {
                case this.MOVEACTION:
                case this.ROTATEACTION:
                case this.GROUPACTION:
                case this.DELETEACTION:
                case this.ADDACTION:
                case this.REFRESHACTION:
                default:
                    "avatar" !== t.id && this.historycmp.actionDone(t, e, n, this)
            }
    }, c.prototype.undoMove = function(e, n) {
        t.historyMove(e, n.oldPosition, n.oldRotation)
    }, c.prototype.redoMove = function(e, n) {
        t.historyMove(e, n.newPosition, n.newRotation)
    }, c.prototype.undoRotate = c.prototype.undoMove, c.prototype.redoRotate = c.prototype.redoMove, c.prototype.historyMove = function(t, e, n) {
        t.position.copyFromFloats(e.x, e.y, e.z), t.rotation.copyFromFloats(n.x, n.y, n.z), ujs.notify("hcs.request.saveHistory"), ujs.notify("hcs.engine3D.object.translate", {
            object: t
        }), ujs.notify("hcs.engine3D.object.rotate", {
            object: t
        })
    }, c.prototype.undoRefresh = function(e, n) {
        t.historyRefresh(e, n, "exValue")
    }, c.prototype.redoRefresh = function(e, n) {
        t.historyRefresh(e, n, "newValue")
    }, c.prototype.historyRefresh = function(t, e, n) {
        var i = hcsdesign.getComponentByName("ObjectComponent3D");
        for (var o in e)
            "position" == o ? (t.position.copyFrom(e[o][n]), t.structure.position = t.position) : ujs.setProperty(t.structure, o, e[o][n]);
        i.refreshObject(t)
    }, c.prototype.undoGroup = function(e, n) {
        t.historyGroup(e, n)
    }, c.prototype.redoGroup = function(e, n) {
        t.historyGroup(e, n)
    }, c.prototype.historyGroup = function(e, n) {
        n.wasAdd ? (t.deselectObject(), 2 == n.group.getChildren().length ? t.deleteGroup(n.group, !0) : t.removeFromGroup(n.object, n.group, !0)) : t.addToGroup(n.object, n.group, !0)
    }, c.prototype.undoDelete = function(e, n) {
        t.historyDelete(e, n)
    }, c.prototype.redoDelete = function(e, n) {
        t.historyDelete(e, n)
    }, c.prototype.undoAdd = c.prototype.redoDelete, c.prototype.redoAdd = c.prototype.undoDelete, c.prototype.historyDelete = function(t, e) {
        e.isGroup ? t.isDeleted = !t.isDeleted : t.structure.isDeleted = !t.structure.isDeleted;
        var n = e.isGroup ? t.isDeleted : t.structure.isDeleted;
        if (t.traverse(function(t) {
                t.isVisible = !n && t.wasVisible
            }), e.isGroup)
            for (var i = t.getChildren(), o = 0; o < i.length; o++)
                n ? e.floor.structure.removeElement("objects", i[o].structure) : e.floor.structure.insertElement("objects", i[o].structure);
        else
            n ? e.floor.structure.removeElement("objects", t.structure) : e.floor.structure.insertElement("objects", t.structure)
    }, c.prototype.setupHistory = function() {
        this.historycmp = this.core.getComponentByName("HistoryComponent"), this.historycmp && (this.historycmp.registerAction(this.MOVEACTION, this.undoMove, this.redoMove, this), this.historycmp.registerAction(this.ROTATEACTION, this.undoRotate, this.redoRotate, this), this.historycmp.registerAction(this.REFRESHACTION, this.undoRefresh, this.redoRefresh, this), this.historycmp.registerAction(this.GROUPACTION, this.undoGroup, this.redoGroup, this), this.historycmp.registerAction(this.DELETEACTION, this.undoDelete, this.redoDelete, this), this.historycmp.registerAction(this.ADDACTION, this.undoAdd, this.redoAdd, this))
    }, c
}();
var MobileComponent = function() {
    function t() {
        var t = window.innerWidth;
        640 > t ? WallComponent2D.WALL_OFFSET = 75 : t >= 640 && 800 > t ? WallComponent2D.WALL_OFFSET = 50 : t >= 800 && 1280 > t && (WallComponent2D.WALL_OFFSET = 35)
    }
    var e = function(t, e) {
        if (BaseComponent2D.call(this, t, "MobileComponent"), this.dirty = !GlobalHelper.isMobileDevice(), this._isMenuVisible = !0, this._menuModified = !1, this._subMenuContainer = document.getElementById("subMenuContainer"), this._toggleIcon = null, this._mainUI = document.getElementById("main-ui"), this._drawableSurfaces = document.getElementsByClassName("drawableSurface"), "boolean" == typeof e && e === !0 && (this.dirty = !1), !this.dirty) {
            var n = GlobalHelper.getCapabilities();
            HTMLHelper.addStylesheet("css/mobile.css"), hcsdesign.configuration.loadConfiguration(), hcsdesign.configuration.hasMobileConfig || (n.extensions.elementIndexUint ? (hcsdesign.configuration.useMultiTexturing = !0, hcsdesign.configuration.useMultiLights = !0) : (hcsdesign.configuration.useMultiTexturing = !1, hcsdesign.configuration.useMultiLights = !1), hcsdesign.configuration.useShadow = !1, hcsdesign.configuration.hasMobileConfig = !0, hcsdesign.configuration.saveConfiguration()), this._toggleMenu = this._toggleMenu.bind(this), this.onCoreInitialized = this.onCoreInitialized.bind(this), this.onContextChanged = this.onContextChanged.bind(this), document.addEventListener("hcs.core.initialized", this.onCoreInitialized, !1), document.addEventListener("hcs.mobile.toggleMenu", this._toggleMenu, !1)
        }
    };
    return e.prototype = Object.create(BaseComponent2D.prototype), e.prototype.initialize = function() {
        var e = hcsdesign.engine2D.searchComponent("PointComponent2D");
        e && (e._SIZE = 45);
        var n = hcsdesign.engine3D.searchComponent("CameraComponent");
        n && (GlobalHelper.isAppleDevice() && (n.camera[0].minZ = 250, n.camera[0].maxZ = 45e3), window.PointerEvent || (n.camera[0].detachControl(hcsdesign.engine3D.canvas), n.camera[0].attachControlForMobile(hcsdesign.engine3D.canvas))), window.addEventListener("resize", t, !1), t(), this._editionController = document.getElementById("edition-controller")
    }, e.prototype.onCoreInitialized = function() {
        document.removeEventListener("hcs.core.initialized", this.onCoreInitialized), GlobalHelper.hasWebGL() && (hcsdesign.configuration.useMultiLights || (hcsdesign.engine3D.scene.lights[1].dispose(), hcsdesign.engine3D.scene.lights[0].intensity = .8, hcsdesign.engine3D.scene.lights[0].setDirectionToTarget(new BABYLON.Vector3(0, -1, 0))), hcsdesign.configuration.useMultiTexturing || (BABYLON.StandardMaterial.reflectionTextureEnabled = !1, BABYLON.StandardMaterial.SpecularTextureEnabled = !1, BABYLON.StandardMaterial.BumpTextureEnabled = !1), hcsdesign.configuration.useShadow || hcsdesign.engine3D.shadowGenerator.dispose(), hcsdesign.engine3D.scene.lights[0].intensity = .45, hcsdesign.engine3D.scene.lights[1].intensity = .05), PerformanceComponent3D.prototype.update = function() {}, hcsdesign.engine2D.removeComponentByName("PrintComponent2D"), hcsdesign.engine3D.removeComponentByName("PrintComponent3D"), hcsdesign.engine3D.removeComponentByName("RemoteControlComponent3D"), ujs.notify("hcs.menu.top.sub.replace", {
            item: {
                id: "item1",
                addClass: "hidden"
            },
            merge: !0
        }, !0);
        var t = {
            title: _("Toggle"),
            icon: "fa fa-chevron-circle-right",
            action: "hcs.mobile.toggleMenu",
            id: "toggle-mobile-button",
            items: [],
            index: "0"
        };
        ujs.notify("hcs.menu.top.sub.add", {
            item: t,
            menuPath: "."
        }), window.innerWidth < 800 && (this._toggleMenu(), hcsdesign.engine2D.removeComponentByName("ScreenshotMenuComponent"), hcsdesign.engine2D.removeComponentByName("FullscreenComponent"), hcsdesign.engine3D.removeComponentByName("HistoryEditionComponent"))
    }, e.prototype.addPointerCallback = function() {
        document.addEventListener("hcs.input.pointerchanged", function(t) {
            hcsdesign.engine3D.onMouseEvent(t, t.inputStatus)
        }, !1)
    }, e.prototype._toggleMenu = function() {
        this._toggleIcon = document.getElementById("toggle-mobile-button").getElementsByTagName("i")[0], hcsdesign.setMenuWidth(this._isMenuVisible ? 0 : void 0), this._isMenuVisible ? (this._mainUI.style.display = "none", this._subMenuContainer.style.right = "0px", this._toggleIcon.setAttribute("class", "fa fa-chevron-circle-left"), this._editionController && (this._editionController.style.right = "40px"), this._drawableSurfaces[0].classList.remove("with-menu"), this._drawableSurfaces[1].classList.remove("with-menu"), hcsdesign.setSize(window.innerWidth, window.innerHeight)) : (this._mainUI.style.display = "block", this._subMenuContainer.style.right = hcsdesign.getMenuWidth() + "px", this._toggleIcon.setAttribute("class", "fa fa-chevron-circle-right"), this._editionController && (this._editionController.style.right = window.innerWidth - 320 + "px"), this._drawableSurfaces[0].classList.add("with-menu"), this._drawableSurfaces[1].classList.add("with-menu"), hcsdesign.setSize(window.innerWidth - hcsdesign.getMenuWidth(), window.innerHeight)), this._isMenuVisible = !this._isMenuVisible
    }, e
}();
var MobileInputComponent = function() {
    var t = null,
        e = !1,
        n = 0,
        i = function(e) {
            BaseComponent2D.call(this, e, "MobileInputComponent"), this._evtBinded = !1, this._bindListeners(), t = this
        };
    return i.prototype = Object.create(BaseComponent2D.prototype), i.prototype.destroy = function() {
        this._unbindListeners()
    }, i.prototype._bindListeners = function() {
        this._evtBinded || (this._evtBinded = !0, window.addEventListener("touchstart", this._onInputChanged, !1), window.addEventListener("mousemove", this._onInputChanged, !1), window.addEventListener("pointerdown", this._onInputChanged, !1), window.addEventListener("MSPointerDown", this._onInputChanged, !1))
    }, i.prototype._unbindListeners = function() {
        this._evtBinded && (this._evtBinded = !1, window.removeEventListener("touchstart", this._onInputChanged), window.removeEventListener("mousemove", this._onInputChanged), window.removeEventListener("pointerdown", this._onInputChanged), window.removeEventListener("MSPointerDown", this._onInputChanged))
    }, i.prototype._onInputChanged = function(i) {
        return "onpointerdown" in window ? void(0 === n ? (n++, e = "mousemove" === i.type) : t.removeInputSupport("mousemove" === i.type ? "touch" : "mouse")) : void t.removeInputSupport("touchstart" === i.type || "touch" === i.pointerType ? "mouse" : "touch")
    }, i.prototype.removeInputSupport = function(t) {
        var e = hcsdesign.engine2D._pointerManager,
            n = hcsdesign.engine3D.pointerManager;
        if ("mouse" === t) {
            e.removeMouseSupport(), n && n.removeMouseSupport();
            var i = hcsdesign.engine2D.searchComponent("MobileComponent");
            i || (console.log("create new"), i = new MobileComponent(hcsdesign, !0), hcsdesign.engine2D.addInstancedComponent(i), i.onCoreInitialized()), i.addPointerCallback(), GlobalHelper.__forceMobileDevice(!0)
        } else
        //            e.removeTouchSupport(), n && n.removeTouchSupport();
            this._unbindListeners(), hcsdesign.engine2D.removeComponent(this, !0)
    }, i
}();
var PedagoComponent = function() {
    var t = function(t) {
        // called in window.onload
        BaseComponent2D.call(this, t, "PedagoComponent"), this.pedagoPath = "js/Components/PedagoComponent/pedago/pages/"
    };
    return t.prototype = Object.create(BaseComponent2D.prototype), t.prototype.checkBrowserCapability = function() {
        /*
         * function : ��������������
         */
        // step 01: check hasCanvas2D()
        GlobalHelper.hasCanvas2D() || this.redirectToPage("no-webgl");
        // step 02 : check hasWebGL()
        var t = hcsLocalStorage.getItem("hcs.core.force2D"); // will return null when window.onload call.
        return t ? !0 : GlobalHelper.hasWebGL() ? !0 : (this.redirectToPage(GlobalHelper.isAppleDevice() ? "ios" : "Mac" == BrowserDetect.OS && "Safari" == BrowserDetect.browser ? "safari" : GlobalHelper.isAndroidDevice() && navigator.userAgent.match(/chrome/i) ? "no-webgl-chrome-android" : GlobalHelper.isMobileDevice() ? "mobile" : "no-webgl"), !1)
    }, t.prototype.getPageURL = function(t) {
        return [this.pedagoPath, t, ".php"].join("")
    }, t.prototype.redirectToPage = function(t) {
        window.location.href = this.getPageURL(t)
    }, t
}();
var LockComponent = function() {
    var t = "js/Components/LockComponent/Assets/",
        e = function(t) {
            BaseComponent3D.call(this, t, "LockComponent"), this._editionComponent = null, this._isLocked = !1
        };
    return e.prototype = Object.create(BaseComponent3D.prototype), e.prototype.onContextChanged = function(t) {
        "2D" === t ? ujs.notify("hcs.menu.top.sub.replace", {
            item: {
                id: "lock-icon",
                addClass: "hidden"
            },
            merge: !0
        }, !0) : ujs.notify("hcs.menu.top.sub.replace", {
            item: {
                id: "lock-icon",
                addClass: ""
            },
            merge: !0
        }, !0)
    }, e.prototype.initialize = function() {
        HTMLHelper.addStylesheet(t + "lockComponent.css", {
            media: "screen"
        }), this._editionComponent = hcsdesign.engine3D.searchComponent("EditionComponent3D"), this.toggleLock = this.toggleLock.bind(this);
        var e = {
            action: "hcs.component.lock",
            id: "lock-icon",
            index: 1,
            addClass: "hidden",
            icon: "fa fa-unlock",
            title: _("Lock/Unlock")
        };
        ujs.notify("hcs.menu.top.sub.add", {
            item: e,
            menuPath: "."
        }), document.addEventListener("hcs.component.lock", this.toggleLock, !1)
    }, e.prototype.destroy = function() {
        ujs.notify("hcs.menu.top.sub.delete", {
            id: "lock-icon",
            menuPath: "."
        }), document.removeEventListener("hcs.component.lock", this.toggleLock)
    }, e.prototype.toggleLock = function() {
        this._isLocked = !this._isLocked;
        var t = document.getElementById("lock-icon"),
            e = t.children[0].children[0];
        this._isLocked ? (this._editionComponent.dragControl.lock(), e.setAttribute("class", "fa fa-lock")) : (this._editionComponent.dragControl.unlock(), e.setAttribute("class", "fa fa-unlock"))
    }, e
}();
var EditMeasureComponent = function() {
    var t = function(t) {
        BaseComponent2D.call(this, t, "EditMeasureComponent")
    };
    return t.prototype = new BaseComponent2D, t.prototype.initialize = function() {}, t.prototype.startListening = function() {
        this.onClick = this.onClick.bind(this), this.onDblClick = this.onDblClick.bind(this), this.destroyDialog = this.destroyDialog.bind(this), document.addEventListener("click", this.onClick, !1), document.addEventListener("dblclick", this.onDblClick, !1), document.addEventListener("hcs.contextChanged", this.destroyDialog, !1)
    }, t.prototype.stopListening = function() {
        document.removeEventListener("click", this.onClick, !1), document.removeEventListener("dblclick", this.onDblClick, !1), this.destroyDialog()
    }, t.prototype.destroyDialog = function() {
        var t = photonui.getWidget("Dialog_measure");
        null != t && t.destroy()
    }, t.prototype.onClick = function(t) {
        var e = photonui.getWidget("Dialog_measure");
        null != e && (t.pageX < e.position.x || t.pageX > e.position.x + e.offsetWidth || t.pageY < e.position.y || t.pageY > e.position.y + e.offsetHeight) && e.destroy()
    }, t.prototype.getSideToMove = function(t, e) {
        var n;
        return n = t <= Math.PI / 4 && t >= -Math.PI / 4 ? e ? 0 : 1 : t >= .75 * Math.PI || t <= -3 / 4 * Math.PI ? e ? 1 : 0 : t > Math.PI / 4 && t < .75 * Math.PI ? e ? 0 : 1 : e ? 1 : 0
    }, t.prototype.displacePoint = function(t, e, n, i) {
        var o = this.getSideToMove(n, i),
            r = t.points,
            s = r[1].subtract(r[0]),
            a = this.getSideToMove(Math.atan2(s.y, s.x), i),
            l = t.parent,
            h = l.getWallVector();
        displacevector = 0 == o ? h.normalize().scale(e).negate() : h.normalize().scale(e);
        var c = l.getPoints(o),
            u = !1;
        if (-1 == l.getPolygon().indexOf(r[a]))
            for (var p, d = 150, m = 0; m < l.attachedPoints.length; m++)
                if (attachedPoint = l.attachedPoints[m], p = r[a].distanceTo(attachedPoint.position), d > p)
                    for (var g = 0; g < attachedPoint.parents.length; g++) {
                        var f = attachedPoint.parents[g].getPoints(),
                            y = f[(f.indexOf(attachedPoint) + 1) % 2].position.subtract(attachedPoint.position);
                        BABYLON.Vector2.Dot(t.normal(), y) > 0 && (d = p, c = l.attachedPoints[m], u = !0)
                    }
        if (u)
            for (var g = 0; g < c.parents.length; g++)
                c.parents[g].translate(displacevector);
        else {
            for (var _ = !1, g = 0; g < c.parents.length; g++)
                c.parents[g] != l && (c.parents[g].translate(displacevector), _ = !0);
            var v = c.wallAttached();
            _ || null == v || (v.translate(displacevector), _ = !0), _ || c.translate(displacevector)
        }
        for (var b = API.getWalls(), g = 0; g < b.length; g++)
            b[g].updateAttachedPoints(API.getCurrentFloor()), b[g].updateOvertures(API.getCurrentFloor()), b[g].needsUpdate = !0;
        API.e2D.requestStaticDraw()
    }, t.prototype.onDblClick = function(t) {
        var e = API.getComponent("MeasureComponent").getTargeted(API.e2D.getMousePos());
        if (null != e) {
            var n = photonui.getWidget("Dialog_measure");
            if (null != n) {
                if (t.pageX >= n.position.x || t.pageX <= n.position.x + n.offsetWidth || t.pageY >= n.position.y || t.pageY <= n.position.y + n.offsetHeight)
                    return;
                n.destroy()
            }
            n = new photonui.Window({
                name: "Dialog_measure",
                title: _("Settings"),
                x: t.pageX,
                y: t.pageY,
                visible: !0,
                padding: 10
            });
            var i = new photonui.GridLayout,
                o = e.points[e.points.length - 1].subtract(e.points[0]).length(),
                r = new photonui.NumericField({
                    name: "num_length",
                    value: Math.round(o)
                }),
                s = new photonui.Label({
                    text: _("Length") + " (cm) :",
                    forInput: r
                });
            i.addChild(s, {
                gridX: 0,
                gridY: 0
            }), i.addChild(r, {
                gridX: 1,
                gridY: 0,
                gridWidth: 2
            });
            var a, l, h = e.parent.getWallVector().normalize(),
                c = Math.atan2(h.y, h.x);
            c <= Math.PI / 4 && c >= -Math.PI / 4 || c >= .75 * Math.PI || c <= -3 / 4 * Math.PI ? (a = new photonui.Button({
                name: "btn-left",
                text: _("Left")
            }), l = new photonui.Button({
                name: "btn-right",
                text: _("Right")
            })) : (a = new photonui.Button({
                name: "btn-left",
                text: _("Top")
            }), l = new photonui.Button({
                name: "btn-right",
                text: _("Bottom")
            }));
            var u = new photonui.Label({
                text: _("Apply to") + " :"
            });
            i.addChild(u, {
                gridX: 0,
                gridY: 1
            }), i.addChild(a, {
                gridX: 1,
                gridY: 1
            }), i.addChild(l, {
                gridX: 2,
                gridY: 1
            }), n.child = i, photonui.getWidget("btn-left").registerCallback("clickleft", "click", function() {
                this.displacePoint(e, r.value - o, c, !0), n.destroy()
            }, this), photonui.getWidget("btn-right").registerCallback("clickright", "click", function() {
                this.displacePoint(e, r.value - o, c, !1), n.destroy()
            }, this), photonui.getWidget("num_length").registerCallback("keyup_num", "keyup", function(t, i) {
                13 == i.keyCode && (this.displacePoint(e, r.value - o, c, !1), n.destroy())
            }, this), n.registerCallback("close", "close-button-clicked", n.destroy, n)
        }
    }, t
}();
var HideAvatarComponent = function() {
    var t = function(t) {
        BaseComponent3D.call(this, t, "HideAvatarComponent")
    };
    return t.prototype = new BaseComponent3D, t.prototype.initialize = function() {
        BaseComponent3D.prototype.initialize.call(this)
    }, t.prototype.startListening = function() {
        this.onZoom = this.onZoom.bind(this), document.addEventListener("hcs.engine3D.camera.zoom", this.onZoom, !1)
    }, t.prototype.stopListening = function() {
        document.removeEventListener("hcs.engine3D.camera.zoom", this.onZoom, !1)
    }, t.prototype.onZoom = function() {
        var t = 500,
            e = API.getComponent("CameraComponent");
        if (e.cameraActiveId == e.ORBITCAMERA) {
            var n = e.camera[e.cameraActiveId].position,
                i = API.getComponent("AvatarComponent3D"),
                o = i.avatar.position;
            i.setVisibility(n.distanceTo(o) <= t ? !1 : !0)
        }
    }, t
}();
var hcs = window.hcs || {};
hcs.LoopTimer = function() {
    var t = function() {
        var t = 0,
            e = 0;
        this.start = function() {
            t = (new Date).getTime()
        }, this.update = function() {
            var n = (new Date).getTime();
            e = n - t, t = n
        }, this.getElapsedTime = function() {
            return t
        }, this.getDeltaTime = function() {
            return e
        }
    };
    return t
}();

var socket = io.connect();
var hcsdesign = null;

var hcsLocalStorage = {
    fallback: true,
    items : {},
    setItem: function(key, val) {
        socket.emit('set', { key: key, val: val });
        this.items[key] = val;
    },
    getItem: function(key) {
        return this.items[key] || null;
    },
    removeItem: function(key) {
        socket.emit('del', { key: key });
        delete this.items[key];
    }
}

socket.emit('init', { uuid: 'bae9e1d5-47ca-4fc2-af27-0e27da13de65' }, function (data) {
    
    hcsLocalStorage.items = data;

    BABYLON.Engine.ShadersRepository = "js/Vendors/Babylon/Shaders/";
    function t(t, e) {
        var e = e || 1;
        switch ("fr" == t.toLowerCase() && (l.Constants.LANG = "fr"), t.toLowerCase()) {
            case "es":
                c.setLocale("es_ES", e);
                break;
            case "de":
                c.setLocale("de_DE", e);
                break;
            case "fr":
                c.setLocale("fr_FR", e);
                break;
            case "it":
                c.setLocale("it_IT", e);
                break;
            case "pt":
                c.setLocale("pt_PT", e);
                break;
            case "pl":
                c.setLocale("pl_PL", e);
                break;
            case "jp":
                c.setLocale("jp_JP", e);
                break;
            default:
                c.setLocale("C", e)
        }
    }

    function e() {
        var loc = "http://v2.hcsdesign.fr/#b3JpZ2luPWh0dHA6Ly93d3cud2FuYXBsYW4uY29tJmFwaUtleT1jZjk4NjZiNjQwZjZjNmMyNzEyMmM5Y2NjYThkOWRkNyZzYXZlVXJsPWh0dHA6Ly93d3cud2FuYXBsYW4uY29tL2FwaS9wbGFuL3NhdmUvJm5ld1VybD1odHRwOi8vd3d3LndhbmFwbGFuLmNvbS9hcGkvcGxhbi9uZXcvJmF1dG9SZXNpemU9dHJ1ZSZwYXJhbXM9W29iamVjdCBPYmplY3RdJndpZHRoPTEyNzcmaGVpZ2h0PTM4MSZpZD0xJnBhcmFtcz17fQ==";
        var e = hcsLocalStorage.getItem("hcs.core.force2D"),
            n = "",
            //        s = document.location.href.split("#");
            s = loc.split("#");
        // s[0] = "http://v2.hcsdesign.fr/"
        // s[1] = apiKey
        // n = "origin=http://www.hcsdesign.com&apiKey=cf9866b640f6c6c27122c9ccca8d9dd7&saveUrl=htt…ewUrl=http://www.hcsdesign.com/api/plan/new/&autoResize=true&params=[object Object]&width=1277&height=146&id=1&params={}"
        s[1] && (n = a(s[1]));
        var p = function(t) {
                for (var e = {}, n = t.split("&"), i = 0; i < n.length; i++) {
                    var o = n[i].split("=");
                    e[o[0]] = o[1]
                }
                return e
            },
            d = p(n); // 将n装换成map（参数为key，值为value，例如{width=1277, height=146...}）
        if (!GlobalHelper.hasWebGL() && e && (d.allow3D = !1),
            d.apiKey /*|| (document.location.href = "http://www.hcsdesign.com")*/ , u = d.lang ? d.lang : u, t(u),
            hcsdesign = new l.Core(h, c, d), hcsdesign.engine2D.addComponent(GridComponent2D), hcsdesign.engine2D.addComponent(PointComponent2D), hcsdesign.engine2D.addComponent(WallComponent2D), hcsdesign.engine2D.addComponent(RoomComponent2D), /* hcsdesign.engine2D.addComponent(StairwayComponent2D), hcsdesign.engine2D.addComponent(HopperComponent2D),*/ hcsdesign.engine2D.addComponent(SubSlopeComponent2D), hcsdesign.engine2D.addComponent(SubSlopeOvertureComponent2D), hcsdesign.engine2D.addComponent(OvertureComponent2D), hcsdesign.engine2D.addComponent(MobileComponent), hcsdesign.engine2D.addComponent(MobileInputComponent), /*hcsdesign.engine2D.addComponent(AnalyticsComponent), hcsdesign.engine2D.addComponent(FloorController),*/ hcsdesign.engine2D.addComponent(MeasureComponent), hcsdesign.engine3D.addComponent(CameraComponent), hcsdesign.engine3D.addComponent(GridComponent3D), hcsdesign.engine3D.addComponent(AvatarComponent3D), hcsdesign.engine3D.addComponent(RoomComponent3D), hcsdesign.engine3D.addComponent(OvertureComponent3D), hcsdesign.engine3D.addComponent(SubSlopeComponent3D), hcsdesign.engine3D.addComponent(WallComponent3D), hcsdesign.engine3D.addComponent(StairwayComponent3D), hcsdesign.engine3D.addComponent(HopperComponent3D), hcsdesign.engine3D.addComponent(ObjectComponent3D), hcsdesign.engine3D.addComponent(FloorComponent3D), hcsdesign.engine3D.addComponent(RemoteControlComponent3D), hcsdesign.engine3D.addComponent(TransparencyComponent), r(), o(d), i(d), hcsdesign.setSelectedEngine(hcsdesign.ENGINE_2D), hcsdesign.mode == hcsdesign.MODE_VIEWER) {
            var m = +d.startOn2D ? hcsdesign.ENGINE_2D : hcsdesign.ENGINE_3D;
            hcsdesign.initialize(function() {
                hcsdesign.engine2D.requestStaticDraw(), hcsdesign.engine2D.update(!0), hcsdesign.setSelectedEngine(m), hcsdesign.hideSplashScreen()
            })
        } else
            hcsdesign.initialize(); // hcsdesign = new l.Core(h, c, d) == new hcs.Core(h, c, d) 因此hcsdesign 是hcs.Core的函数对象
    }

    function n(t) {
        if (t.mode == hcsdesign.mode || 0 == t.mode) {
            var e = t.configuration || {};
            if (1 != t.type)
                return;
            var i = hcsdesign["engine" + (t.engine || "2D")];
            if (!i)
                return void Logger.message(t.name + " not loaded");
            var o = window[t.name];
            if (o) {
                var r = i.addComponent(o);
                if (r.configuration = e, r && e["extends"])
                    for (var s = 0; s < e["extends"].length; s++) {
                        var a = i.searchComponent(e["extends"][s]);
                        a && a.disable()
                    }
            } else {
                var l = t.url || !1;
                if (l) {
                    var h = function() {
                        n(t)
                    };
                    HTMLHelper.addScript(l, void 0, h)
                } else
                    Logger.message(t.name + " not loaded")
            }
        }
    }

    function i(t) {
        var e = t.params.env || "";
        ujs.ajax({
            method: "get",
            url: l.Constants.WNP_URL + "/data/api/" + t.apiKey + e + ".json",
            success: function(t) {
                var e = JSON.parse(t);
                if ("ok" == e.status)
                    for (var i = e.components, o = 0; o < i.length; o++)
                        n(i[o])
            }
        })
    }

    function o(t) {
        if (t.components)
            for (var e = 0; e < t.components.length; e++)
                n(t.components[e])
    }

    function r() {
        hcsdesign.mode == hcsdesign.MODE_EDITOR ? (hcsdesign.engine2D.addComponent(MainMenuComponent), hcsdesign.engine2D.addComponent(TopMenuComponent), hcsdesign.engine2D.addComponent(SaveComponent), hcsdesign.engine2D.addComponent(NewComponent), hcsdesign.engine2D.addComponent(OptionsComponent), hcsdesign.engine2D.addComponent(ExitComponent), hcsdesign.engine2D.addComponent(ScreenshotMenuComponent), hcsdesign.engine2D.addComponent(FullscreenComponent), hcsdesign.engine3D.addComponent(HistoryComponent), hcsdesign.engine3D.addComponent(HistoryEditionComponent), hcsdesign.engine2D.addComponent(GeneralOptionComponent2D), /*hcsdesign.engine2D.addComponent(GridBackgroundComponent2D), */hcsdesign.engine2D.addComponent(MagnetismComponent2D), hcsdesign.engine2D.addComponent(PrintComponent2D), hcsdesign.engine2D.addComponent(DebugComponent2D), hcsdesign.engine2D.addComponent(EditMeasureComponent), hcsdesign.engine3D.addComponent(PrintComponent3D), hcsdesign.engine3D.addComponent(EditionComponent3D), hcsdesign.engine3D.addComponent(GroupConfiguratorModComponent3D), hcsdesign.engine3D.addComponent(ConfiguratorModComponent3D), hcsdesign.engine3D.addComponent(GroupConfiguratorPanelComponent3D), hcsdesign.engine3D.addComponent(ConfiguratorPanelComponent3D), hcsdesign.engine3D.addComponent(ConfiguratorInOutAnimationComponent3D), hcsdesign.engine3D.addComponent(ConfiguratorXrayComponent3D), hcsdesign.engine3D.addComponent(MesureDisplayerForDimensionReshaperFactoryComponent3D), hcsdesign.engine3D.addComponent(HandlesDisplayerForDimensionReshaperFactoryComponent3D), hcsdesign.engine3D.addComponent(BoundingLimitDisplayerForDimensionReshaperFactoryComponent3D), hcsdesign.engine3D.addComponent(MasterReshaperComponent3D), hcsdesign.engine3D.addComponent(DimensionReshaperComponent3D), hcsdesign.engine3D.addComponent(MagnetismComponent3D), hcsdesign.engine3D.addComponent(DecorationComponent3D), hcsdesign.engine3D.addComponent(LuxensComponent3D), hcsdesign.engine3D.addComponent(OutsideComponent3D), hcsdesign.engine3D.addComponent(DebugComponent3D), hcsdesign.engine3D.addComponent(LockComponent), hcsdesign.engine3D.addComponent(PerformanceComponent3D), hcsdesign.engine3D.addComponent(HardwareScalingComponent3D), hcsdesign.engine3D.addComponent(HideAvatarComponent)) : hcsdesign.mode == hcsdesign.MODE_VIEWER
    }

    function s() {
        requestAnimationFrame(s), hcsdesign.update(), hcsdesign.draw()
    }
    var a = window.atob || function(t) {
        return t
    };
    window.hcs_DEBUG = !1, Logger.setDebugMode(window.hcs_DEBUG);
    var l = window.hcs || {},
        h = l.Constants.VERSION;
    window.hcs_DEBUG && (h += Math.round(100 * Math.random()));
    var c = new I18njs("./l10n/"),
        u = navigator.language || navigator.browserLanguage || "fr_FR",
        p = hcsLocalStorage.getItem(l.Constants.LC_LANG_KEY);
    if (null !== p)
        u = p;
    else {
        var d = u.split("-");
        u = d instanceof Array ? d[0] : d
    }
    t(u, h);
        var com = new PedagoComponent;
        if (com.checkBrowserCapability()) { // 检查浏览器兼容性
            if (!GlobalHelper.isMobileDevice() && "Windows" == BrowserDetect.OS)
            // 设置延迟加载函数
                var n = setTimeout(function() {
                // 由 setTimeout() 返回的 ID 值-n。该值标识要取消的延迟执行代码块。
                // 当hcsdesign.isFullyInitialized为true时，跳转至http://v2.hcsdesign.fr/b3JpZ2luPWh0dHA6Ly93d3cud2FuYXBsYW4uY29tJmFwaUtleT1jZjk4NjZiNjQwZjZjNmMyNzEyMmM5Y2NjYThkOWRkNyZzYXZlVXJsPWh0dHA6Ly93d3cud2FuYXBsYW4uY29tL2FwaS9wbGFuL3NhdmUvJm5ld1VybD1odHRwOi8vd3d3LndhbmFwbGFuLmNvbS9hcGkvcGxhbi9uZXcvJmF1dG9SZXNpemU9dHJ1ZSZwYXJhbXM9W29iamVjdCBPYmplY3RdJndpZHRoPTEyNzcmaGVpZ2h0PTM4MSZpZD0xJnBhcmFtcz17fQ==/js/Components/PedagoComponent/pedago/pages/grapics.php
                clearTimeout(n), hcsdesign.isFullyInitialized || com.redirectToPage("graphics")
            }, 15e3);
            e(), hcsdesign.engine2D.addInstancedComponent(com), s()
        }
    
});