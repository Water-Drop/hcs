var Wanaplan=function(){function e(e){"printPopup"==e.data.type?n(e.data):"targetBlank"==e.data.type?window.open(e.data.url,"_blank"):"downloadFile"==e.data.type?t(e.data.name,e.data.content):"refresh"==e.data.type&&e.data.url?(window.onbeforeunload=null,window.location.href=e.data.url):"planSaved"===e.data.type?v.onSavePlan():"planExit"===e.data.type&&v.onExitPlan()}function t(e,t){var n=document.createElement("a");n.setAttribute("href","data:text/html;base64,"+w(t)),n.setAttribute("target","_blank"),n.setAttribute("download",e),n.setAttribute("style","display:none"),parent.document.body.appendChild(n),n.click()}function n(e){var t=e.w||100,n=e.h||100,a=e.img||!1,i=window.open("","_blank","width="+t+",height="+n);return"undefined"==typeof i?void alert(e.message):(i.document.write("<img src='"+a+"' />"),i.document.close(),i.focus(),i.print(),void i.close())}function a(){y.setAttribute("width",i()),y.setAttribute("height",o())}function i(){return g.offsetWidth||document.innerWidth}function o(){return g.offsetHeight||document.innerHeight}function r(e,t,n,a){var a=a||"",i=function(){s({method:"GET",url:h,data:"apiKey="+e,success:function(e){if(e){if(++E>1)return;var a=JSON.parse(e);if("ok"===a.status)return void t(a)}n()}})};s({method:"GET",url:f+""+e+a+".json",success:function(e){if(e){if(++E>1)return;var a=JSON.parse(e);if("ok"===a.status)return void t(a)}n()},onerror:i})}function s(e){var t=e.url,n=e.method||"GET",a=e.data||"",i=e.success||null,o=e.onerror||function(){},r="undefined"!=typeof window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");if("undefined"==typeof r||"undefined"==typeof r.open)return!1;if(e.mimeType&&r.overrideMimeType(e.mimeType),"POST"==n)r.open("POST",t,!0),r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.onreadystatechange=function(){4==r.readyState&&200==r.status?null!=i&&i(r.responseText):o()},r.send(a);else{var s=""!=a?t+"?"+a:t;r.open("GET",s,!0),r.onreadystatechange=function(){4==r.readyState&&200==r.status?null!=i&&i(r.responseText):o()},r.send(null)}}function l(){var e=document.createElement("canvas");if("undefined"!=typeof e&&"undefined"!=typeof e.getContext){var t=e.getContext("webgl")||e.getContext("experimental-webgl");return t?!0:!1}return!1}function d(){return navigator.userAgent.match(/OS 5(_\d)+ like Mac OS X/i)}function u(){var e=document.head.getElementsByTagName("meta"),t=!1;if(o&&e.length)for(var n=0,a=e.length,i=null;a>n&&t===!1;)i=e[n].getAttribute("name"),t="viewport"===i?!0:t,n++;if(!t){var o=document.createElement("meta");o.setAttribute("name","viewport"),o.setAttribute("content","width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no"),document.head.appendChild(o)}}var c="http://v2.wanaplan.fr/",p="http://back1.wanaplan.org/",f=c+"data/api/",h=p+"api/check-api",m=c+"viewer.html",w=window.btoa||function(e){return e},y=null,g=null,v={onReady:function(){},onSavePlan:function(){},onExitPlan:function(){}},b=function(e){var e=e||{},t={origin:location.origin,apiKey:e.apiKey||0,planUrl:e.planUrl,saveUrl:e.saveUrl,newUrl:e.newUrl,exitUrl:e.exitUrl,logoUrl:e.logoUrl||void 0,screenshotUrl:e.screenshotUrl,autoResize:"undefined"!=typeof e.autoResize?e.autoResize:!0,additionalCSS:e.css,additionalJS:e.js,params:e.params||{},title:e.title,publisher:e.publisher,screenshotMode:e.screenshotMode};if(e.onSavePlan&&(v.onSavePlan=e.onSavePlan),e.onExitPlan&&(v.onExitPlan=e.onExitPlan),e.onReady&&(v.onReady=e.onReady),g=e.container||document.body,"string"==typeof e.container&&(g=document.getElementById(e.container)),t.width=e.width||i(),t.height=e.height||o(),!window.Float32Array||d()){var n="no-webgl";d()&&(n="mobile"),y=document.createElement("iframe"),y.setAttribute("width",t.width),y.setAttribute("height",t.height),y.setAttribute("src",[c,"js/Components/PedagoComponent/pedago/pages/"+n+".php"].join("")),t.autoResize&&(window.addEventListener?window.addEventListener("resize",a,!1):window.attachEvent("onresize",a)),g.appendChild(y),window.onfocus=function(){y.focus()}}else{var s=t.params.env||"";r(e.apiKey,function(e){t.id=e.id;for(var n in e.params)e.params.hasOwnProperty(n)&&!t.params[n]&&(t.params[n]=e.params[n]);S(t)},function(){},s)}},S=function(t){var n=[];for(var i in t)t.hasOwnProperty(i)&&"undefined"!=typeof t[i]&&n.push(i+"="+t[i]);t.screenshotUrl&&n.push("screenshotUrl="+t.screenshotUrl),t.additionalCSS&&n.push("css="+t.additionalCSS),t.params&&n.push("params="+JSON.stringify(t.params)),t.title&&n.push("title="+t.title),t.screenshotMode&&n.push("screenshotMode="+t.screenshotMode),u(),y=document.createElement("iframe"),y.addEventListener("load",v.onReady),y.setAttribute("width",t.width),y.setAttribute("height",t.height),y.setAttribute("src",[c,"#",w(n.join("&"))].join("")),y.setAttribute("seamless","seamless"),y.setAttribute("allowfullscreen","true"),y.setAttribute("sandbox","allow-same-origin allow-scripts allow-top-navigation allow-popups allow-forms"),t.autoResize&&window.addEventListener("resize",a,!1),window.addEventListener("message",e,!1),g.appendChild(y),window.onfocus=function(){y.focus()}},A=function(e){var t=e||{};t.apiKey=e.apiKey||0,t.additionalCSS=e.css,t.screenshotFullSize="undefined"!=typeof e.screenshotFullSize?e.screenshotFullSize:!1;var n=["isViewer=true","&apiKey=",t.apiKey,"&planUrl=",t.planUrl],a=null,i=function(){var e=document.createElement("img"),n=t.planUrl.split("/"),i=n[n.length-1],o=i.split(".")[0],r="https://pbs.twimg.com/profile_images/378800000595649008/7b109404925ac69c3840e0a1088cc741.jpeg";o&&(r=["http://www.kozikaza.com/wanaplan/decoder/",o,".png"].join("")),e.src=r,e.onload=function(){t.screenshotFullSize?(e.style.width=a.offsetWidth+"px",e.style.height=a.offsetHeight+"px"):(e.style.position="relative",e.style.left=a.offsetWidth/2-e.width/2+"px",e.style.top=a.offsetHeight/2-e.height/2+"px"),a.appendChild(e)}};if("."===t.container[0]?(t.container=t.container.split(".")[1],"undefined"!=typeof document.getElementsByClassName?a=document.getElementsByClassName(t.container)[0]:(a=document.querySelectorAll("."+t.container),a=a[0])):(t.container="#"===t.container[0]?t.container.split("#")[1]:t.container,a=document.getElementById(t.container)),("undefined"==typeof a||null===a)&&(document.querySelectorAll||(document.querySelectorAll=function(e){var t=document,n=t.documentElement.firstChild,a=t.createElement("STYLE");return n.appendChild(a),t.__qsaels=[],a.styleSheet.cssText=e+"{x:expression(document.__qsaels.push(this))}",window.scrollBy(0,0),t.__qsaels}),a=document.querySelectorAll("."+t.container),a=a[0]),"undefined"!=typeof t.startOn2D&&n.push("&startOn2D="+(t.startOn2D?1:0)),"undefined"!=typeof t.allow2D&&n.push("&allow2D="+(t.allow2D?1:0)),"undefined"!=typeof t.allow3D&&n.push("&allow3D="+(t.allow3D?1:0)),"undefined"!=typeof t.enablePlayer&&n.push("&enablePlayer="+(t.enablePlayer?1:0)),"undefined"!=typeof t.lang&&n.push("&lang="+(t.lang?1:0)),"undefined"!=typeof t.additionalCSS&&n.push("&css="+t.additionalCSS),l()){u();var o=document.createElement("iframe");o.setAttribute("width",a.offsetWidth),o.setAttribute("height",a.offsetHeight),o.setAttribute("src",[m,"#",w(n.join(""))].join("")),o.setAttribute("seamless","seamless"),o.setAttribute("allowfullscreen","true"),o.setAttribute("sandbox","allow-same-origin allow-scripts allow-top-navigation allow-forms"),e.loadCallback&&(o.onload=e.loadCallback),a.appendChild(o),e.onReady&&e.onReady()}else i(),e.onReady&&e.onReady()},E=0;return{initialize:b,hasWebGL:l,preview:A,previews:A}}();